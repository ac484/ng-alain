import{a as B,c as $,d as U,e as j,g as G,h as S}from"./chunk-YEDFFJWX.js";import{a as oe,b as re,c as ae}from"./chunk-JOZFRAZK.js";import"./chunk-PPH6YN4H.js";import"./chunk-VAGS5EVQ.js";import{a as Y,b as Z,c as ee,g as te,h as ne,i as ie}from"./chunk-JQVOEMVA.js";import"./chunk-WPYE5ZYA.js";import{a as q,b as K}from"./chunk-4JD3AECT.js";import"./chunk-73EUL726.js";import"./chunk-IXMPFHCN.js";import{d as W}from"./chunk-H3VOFVRR.js";import{f as Q,g as X}from"./chunk-PLG4CJNN.js";import{a as H,c as J}from"./chunk-MYHEUEYZ.js";import"./chunk-56KVT4S4.js";import"./chunk-T7KOHHK2.js";import"./chunk-RO5CAZDG.js";import"./chunk-D4VY2E2X.js";import"./chunk-I3H5DCHT.js";import"./chunk-IA67MZC2.js";import{m as F}from"./chunk-XRAWGIG7.js";import{h as O,q as P,s as V,t as A}from"./chunk-557TQC7D.js";import{Mc as I,Nc as L}from"./chunk-EIQVRW2S.js";import{Ha as x,Ib as T,Kb as N,Md as k,Nb as R,Ob as M,Pb as C,Qb as r,Rb as o,Sb as c,Wc as E,Zb as h,ac as u,db as p,dc as m,pb as w,sa as z,sc as a,tc as D,uc as y,ya as d,za as f}from"./chunk-A26OGSUO.js";import{i as v}from"./chunk-57BLH6QZ.js";var pe=(l,t)=>t.id;function ue(l,t){if(l&1){let e=h();r(0,"nz-result",7)(1,"div",9)(2,"button",3),u("click",function(){d(e);let i=m();return f(i.refresh())}),a(3,"\u91CD\u8A66"),o()()()}if(l&2){let e=m();C("nzSubTitle",e.error())}}function de(l,t){if(l&1){let e=h();r(0,"nz-list-item")(1,"nz-list-item-meta")(2,"nz-list-item-meta-title")(3,"span",11),a(4),o()(),r(5,"nz-list-item-meta-description")(6,"div",12)(7,"nz-tag",13),a(8),o(),r(9,"span",14),c(10,"span",15),a(11),o(),r(12,"span",14),c(13,"span",16),a(14),o()()()(),r(15,"div",17)(16,"button",3),u("click",function(){let i=d(e).$implicit,s=m(2);return f(s.previewFile(i))}),c(17,"span",18),a(18," Google Docs \u6AA2\u8996 "),o(),r(19,"button",5),u("click",function(){let i=d(e).$implicit,s=m(2);return f(s.downloadFile(i))}),c(20,"span",19),a(21," \u4E0B\u8F09 "),o(),r(22,"button",20),u("click",function(){let i=d(e).$implicit,s=m(2);return f(s.deleteFile(i))}),c(23,"span",21),a(24," \u522A\u9664 "),o()()()}if(l&2){let e=t.$implicit,n=m(2);p(4),D(e.fileName),p(3),C("nzColor",e.fileType==="pdf"?"blue":"green"),p(),y(" ",e.fileType.toUpperCase()," "),p(3),y(" ",n.formatFileSize(e.fileSize)," "),p(3),y(" ",n.formatDate(e.createdAt)," ")}}function fe(l,t){if(l&1){let e=h();r(0,"nz-empty",10)(1,"button",3),u("click",function(){d(e);let i=m(2);return f(i.goToScan())}),c(2,"span",4),a(3," \u958B\u59CB\u6383\u63CF "),o()()}}function _e(l,t){if(l&1&&(r(0,"nz-list",8),R(1,de,25,5,"nz-list-item",null,pe,!1,fe,4,0,"nz-empty",10),o()),l&2){let e=m();C("nzDataSource",e.scanResults())("nzItemLayout","horizontal")("nzLoading",e.isLoading()),p(),M(e.scanResults())}}var _=class _{constructor(){this.storage=z(B);this.router=z(F);this.message=z(W);this.isLoading=x(!0);this.error=x("");this.scanResults=x([]);this.hasError=E(()=>this.error()!=="")}ngOnInit(){this.loadScanResults()}loadScanResults(){return v(this,null,function*(){this.isLoading.set(!0),this.error.set("");try{let t=S(this.storage,"pdf-uploads"),e=yield G(t),n=[];for(let i of e.items){let s=yield j(i),se=yield U(i),g=s.name,ce=g.endsWith(".pdf")?"pdf":"txt",b=g.match(/(\d+)_pages-(\d+)-(\d+)\.(pdf|txt)$/),me=b?new Date(parseInt(b[1])):new Date;n.push({id:g,fileName:g,fileType:ce,createdAt:me,fileSize:s.size,url:se})}n.sort((i,s)=>s.createdAt.getTime()-i.createdAt.getTime()),this.scanResults.set(n)}catch(t){console.error("Error loading scan results:",t),this.error.set("\u8F09\u5165\u6383\u63CF\u7D50\u679C\u5931\u6557"),this.scanResults.set([])}finally{this.isLoading.set(!1)}})}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,n=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(t)/Math.log(e));return`${parseFloat((t/Math.pow(e,i)).toFixed(2))} ${n[i]}`}formatDate(t){return new Date(t).toLocaleString()}downloadFile(t){let e=document.createElement("a");e.href=t.url,e.download=t.fileName,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),this.message.success(`${t.fileType.toUpperCase()} \u6587\u4EF6\u5DF2\u4E0B\u8F09`)}deleteFile(t){let e=S(this.storage,`pdf-uploads/${t.fileName}`);$(e).then(()=>{this.message.success("\u6A94\u6848\u5DF2\u522A\u9664"),this.loadScanResults()}).catch(n=>{console.error("\u522A\u9664\u6A94\u6848\u5931\u6557:",n),this.message.error("\u522A\u9664\u6A94\u6848\u5931\u6557")})}previewFile(t){if(t.fileType==="pdf"){let n=`https://docs.google.com/viewer?url=${encodeURIComponent(t.url)}&embedded=true`;this.router.navigate(["/tree/document-viewer"],{queryParams:{url:n,fileName:t.fileName}})}else window.open(t.url,"_blank")}goToScan(){this.router.navigate(["/tree/pdf-scan"])}refresh(){this.loadScanResults()}};_.\u0275fac=function(e){return new(e||_)},_.\u0275cmp=w({type:_,selectors:[["app-scan-result"]],decls:11,vars:1,consts:[["nzTitle","\u6A94\u6848\u5217\u8868"],[1,"results-container"],[1,"header-actions"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","scan"],["nz-button","",3,"click"],["nz-icon","","nzType","reload"],["nzStatus","error","nzTitle","\u8F09\u5165\u5931\u6557",3,"nzSubTitle"],[3,"nzDataSource","nzItemLayout","nzLoading"],["nz-result-extra",""],["nzNotFoundImage","simple","nzNotFoundContent","\u76EE\u524D\u6C92\u6709\u6A94\u6848"],[1,"file-name"],[1,"file-info"],[3,"nzColor"],[1,"info-item"],["nz-icon","","nzType","file"],["nz-icon","","nzType","clock-circle"],[1,"action-buttons"],["nz-icon","","nzType","eye"],["nz-icon","","nzType","download"],["nz-button","","nzDanger","",3,"click"],["nz-icon","","nzType","delete"]],template:function(e,n){e&1&&(r(0,"nz-card",0)(1,"div",1)(2,"div",2)(3,"button",3),u("click",function(){return n.goToScan()}),c(4,"span",4),a(5," \u6383\u63CF "),o(),r(6,"button",5),u("click",function(){return n.refresh()}),c(7,"span",6),a(8," \u91CD\u65B0\u6574\u7406 "),o()(),T(9,ue,4,1,"nz-result",7)(10,_e,4,4,"nz-list",8),o()()),e&2&&(p(9),N(n.hasError()?9:10))},dependencies:[k,X,Q,A,V,O,P,L,I,ae,re,oe,K,q,ie,te,ne,ee,Y,Z,J,H],styles:[".results-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.header-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px;justify-content:flex-end}.file-name[_ngcontent-%COMP%]{font-weight:500;color:#333}.file-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-top:8px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:#666;font-size:13px}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:16px;flex-wrap:wrap}@media (max-width: 576px){.action-buttons[_ngcontent-%COMP%]{flex-direction:column}}@media (max-width: 768px){.results-container[_ngcontent-%COMP%]{max-width:100%;padding:0 16px}.header-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.file-info[_ngcontent-%COMP%]{flex-direction:column;gap:8px}}"],changeDetection:0});var le=_;export{le as ScanResultComponent};
