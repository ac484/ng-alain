import{d as j}from"./chunk-3BRCAVEI.js";import{a as zt,b as ft,d as Ct,e as vt,f as yt,g as Et,h as Bt}from"./chunk-Z7WXXQUY.js";import{c as mt,h as ut}from"./chunk-RPA27FBE.js";import{f as lt,g as pt,l as ct,m as dt,n as st}from"./chunk-P7UYZ3AD.js";import{f as tt,i as et,k as nt,m as it,n as rt,o as ot,q as at}from"./chunk-NCOKEU53.js";import{e as Q,f as U}from"./chunk-QSPVGXGB.js";import{D as J,F as K,N as X,O as Y,P as Z,j as q,k as d,m as G,n as L,t as $,w as H,z as W}from"./chunk-ATEC24AJ.js";import{Cb as D,Ja as e,Lc as x,Mb as g,Oa as l,Qa as b,Qc as I,Rb as i,Sb as y,Tb as p,Tc as _,Th as w,Uc as T,Wa as N,_h as R,ai as k,bi as O,ec as S,gd as M,jc as E,lc as h,ma as z,mb as r,mc as A,na as f,nb as n,ob as t,pb as C,td as P,tj as St,uj as At,wb as B,xd as V,zb as v}from"./chunk-2RGJ5SZT.js";import"./chunk-57BLH6QZ.js";var bt=()=>[],Nt=()=>({minRows:3,maxRows:5});function Dt(F,a){if(F&1){let m=B();n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),E(5,"currency"),t(),n(6,"td")(7,"nz-tag",26),i(8),t()(),n(9,"td"),i(10),E(11,"date"),t(),n(12,"td")(13,"button",27),v("click",function(){let u=z(m).$implicit,s=D();return f(s.requestPayment(u))}),i(14," \u8ACB\u6B3E "),t()()()}if(F&2){let m=a.$implicit;e(2),y(m.round),e(2),y(A(5,6,m.amount,"TWD","symbol","1.0-0")),e(3),r("nzColor",m.status==="paid"?"success":"processing"),e(),p(" ",m.status==="paid"?"\u5DF2\u4ED8\u6B3E":"\u5F85\u4ED8\u6B3E"," "),e(2),y(h(11,11,m.date,"yyyy-MM-dd")),e(3),r("disabled",m.status==="paid")}}var c=class c{constructor(a,m,o,u,s){this.fb=a;this.route=m;this.router=o;this.message=u;this.http=s;this.paymentForm=this.fb.group({round:[null,[d.required]],amount:[null,[d.required,d.min(0)]],date:[null,[d.required]],description:[""]})}ngOnInit(){this.contractId=this.route.snapshot.paramMap.get("id")||void 0,this.contractId&&this.loadContractData()}loadContractData(){this.http.get(`/contract/${this.contractId}`).subscribe(a=>{this.contract=a})}requestPayment(a){this.message.info(`\u8ACB\u6B3E\u7B2C${a.round}\u8F2A\uFF0C\u91D1\u984D\uFF1A${a.amount}`)}onSubmit(){if(this.paymentForm.valid){let a=this.paymentForm.value;this.http.post(`/contract/${this.contractId}/payment`,a).subscribe(()=>{this.message.success("\u8ACB\u6B3E\u63D0\u4EA4\u6210\u529F"),this.loadContractData(),this.paymentForm.reset()})}else Object.values(this.paymentForm.controls).forEach(a=>{a.invalid&&a.markAsTouched()})}onCancel(){this.router.navigate(["/contract/detail",this.contractId])}};c.\u0275fac=function(m){return new(m||c)(l(J),l(P),l(V),l(j),l(M))},c.\u0275cmp=b({type:c,selectors:[["app-contract-payment"]],decls:71,vars:30,consts:[["paymentTable",""],["title","\u5408\u7D04\u8ACB\u6B3E"],["title","\u5408\u7D04\u8CC7\u8A0A",2,"margin-bottom","16px",3,"nzSize"],[2,"display","grid","grid-template-columns","1fr 1fr","gap","16px"],["title","\u8ACB\u6B3E\u8F2A\u6B21",2,"margin-bottom","16px"],[3,"nzData","nzPageSize"],[4,"ngFor","ngForOf"],["title","\u65B0\u589E\u8ACB\u6B3E"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","",3,"nzSpan"],["nzErrorTip","\u8ACB\u9078\u64C7\u8ACB\u6B3E\u8F2A\u6B21",3,"nzSpan"],["formControlName","round","placeholder","\u8ACB\u9078\u64C7\u8ACB\u6B3E\u8F2A\u6B21"],["nzValue","1","nzLabel","\u7B2C1\u8F2A"],["nzValue","2","nzLabel","\u7B2C2\u8F2A"],["nzValue","3","nzLabel","\u7B2C3\u8F2A"],["nzValue","4","nzLabel","\u7B2C4\u8F2A"],["nzValue","5","nzLabel","\u7B2C5\u8F2A"],["nzErrorTip","\u8ACB\u8F38\u5165\u8ACB\u6B3E\u91D1\u984D",3,"nzSpan"],["formControlName","amount","placeholder","\u8ACB\u8F38\u5165\u8ACB\u6B3E\u91D1\u984D",2,"width","100%",3,"nzMin","nzStep"],["nzErrorTip","\u8ACB\u9078\u64C7\u8ACB\u6B3E\u65E5\u671F",3,"nzSpan"],["formControlName","date","placeholder","\u8ACB\u9078\u64C7\u8ACB\u6B3E\u65E5\u671F",2,"width","100%"],[3,"nzSpan"],["nz-input","","formControlName","description","placeholder","\u8ACB\u8F38\u5165\u8ACB\u6B3E\u8AAA\u660E",3,"nzAutosize"],[3,"nzOffset","nzSpan"],["nz-button","","nzType","primary","type","submit",3,"disabled"],["nz-button","",2,"margin-left","8px",3,"click"],[3,"nzColor"],["nz-button","","nzType","primary","nzSize","small",3,"click","disabled"]],template:function(m,o){if(m&1){let u=B();n(0,"nz-card",1)(1,"nz-card",2)(2,"div",3)(3,"div")(4,"strong"),i(5,"\u5408\u7D04\u6A19\u984C\uFF1A"),t(),i(6),t(),n(7,"div")(8,"strong"),i(9,"\u5BA2\u6236\uFF1A"),t(),i(10),t(),n(11,"div")(12,"strong"),i(13,"\u73FE\u884C\u91D1\u984D\uFF1A"),t(),i(14),E(15,"currency"),t(),n(16,"div")(17,"strong"),i(18,"\u9032\u5EA6\uFF1A"),t(),i(19),t()()(),n(20,"nz-card",4)(21,"nz-table",5,0)(23,"thead")(24,"tr")(25,"th"),i(26,"\u8F2A\u6B21"),t(),n(27,"th"),i(28,"\u91D1\u984D"),t(),n(29,"th"),i(30,"\u72C0\u614B"),t(),n(31,"th"),i(32,"\u65E5\u671F"),t(),n(33,"th"),i(34,"\u64CD\u4F5C"),t()()(),n(35,"tbody"),N(36,Dt,15,14,"tr",6),t()()(),n(37,"nz-card",7)(38,"form",8),v("ngSubmit",function(){return z(u),f(o.onSubmit())}),n(39,"nz-form-item")(40,"nz-form-label",9),i(41,"\u8ACB\u6B3E\u8F2A\u6B21"),t(),n(42,"nz-form-control",10)(43,"nz-select",11),C(44,"nz-option",12)(45,"nz-option",13)(46,"nz-option",14)(47,"nz-option",15)(48,"nz-option",16),t()()(),n(49,"nz-form-item")(50,"nz-form-label",9),i(51,"\u8ACB\u6B3E\u91D1\u984D"),t(),n(52,"nz-form-control",17),C(53,"nz-input-number",18),t()(),n(54,"nz-form-item")(55,"nz-form-label",9),i(56,"\u8ACB\u6B3E\u65E5\u671F"),t(),n(57,"nz-form-control",19),C(58,"nz-date-picker",20),t()(),n(59,"nz-form-item")(60,"nz-form-label",21),i(61,"\u8ACB\u6B3E\u8AAA\u660E"),t(),n(62,"nz-form-control",21)(63,"textarea",22),i(64,"              "),t()()(),n(65,"nz-form-item")(66,"nz-form-control",23)(67,"button",24),i(68," \u63D0\u4EA4\u8ACB\u6B3E "),t(),n(69,"button",25),v("click",function(){return z(u),f(o.onCancel())}),i(70," \u53D6\u6D88 "),t()()()()()()}if(m&2){let u=g(22);e(),r("nzSize","small"),e(5),p("",o.contract==null?null:o.contract.title," "),e(4),p("",o.contract==null?null:o.contract.client," "),e(4),p("",A(15,23,o.contract==null?null:o.contract.currentAmount,"TWD","symbol","1.0-0")," "),e(5),p("",o.contract==null?null:o.contract.progress,"% "),e(2),r("nzData",(o.contract==null?null:o.contract.paymentRounds)||S(28,bt))("nzPageSize",5),e(15),r("ngForOf",u.data),e(2),r("formGroup",o.paymentForm),e(2),r("nzSpan",4),e(2),r("nzSpan",20),e(8),r("nzSpan",4),e(2),r("nzSpan",20),e(),r("nzMin",0)("nzStep",1e3),e(2),r("nzSpan",4),e(2),r("nzSpan",20),e(3),r("nzSpan",4),e(2),r("nzSpan",20),e(),r("nzAutosize",S(29,Nt)),e(3),r("nzOffset",4)("nzSpan",20),e(),r("disabled",!o.paymentForm.valid)}},dependencies:[T,x,K,$,q,G,L,H,W,Bt,ft,zt,vt,Ct,Et,yt,ct,pt,lt,st,dt,ut,mt,Z,X,Y,O,k,w,R,At,St,at,it,tt,et,ot,nt,rt,U,Q,_,I],encapsulation:2});var Ft=c;export{Ft as ContractPaymentComponent};
