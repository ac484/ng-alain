import{a as ae,b as D}from"./chunk-TCORJ3X4.js";import{a as pe,b as ce}from"./chunk-U2X5E77I.js";import"./chunk-YBLXCQV2.js";import"./chunk-V3HXMN7M.js";import"./chunk-VAGS5EVQ.js";import{a as le}from"./chunk-MT5GF2ID.js";import"./chunk-FDGOABD7.js";import{f as ne,g as ie,h as oe,k as re}from"./chunk-AMLXISNF.js";import{a as X,c as Y,i as Z,j as ee,k as te}from"./chunk-QQO7XJAL.js";import"./chunk-UFDAWFON.js";import"./chunk-JOLA3FC3.js";import{d as q,g as H,m as J,z as U}from"./chunk-XYNR6SEP.js";import"./chunk-MGISIUMH.js";import"./chunk-NFE23O5F.js";import"./chunk-WLLA6Y4L.js";import"./chunk-RYWOVSD3.js";import"./chunk-YS2VRPJW.js";import"./chunk-UDEZOTLA.js";import"./chunk-AJZQPTXH.js";import"./chunk-AAISIDER.js";import"./chunk-KGMFTY4O.js";import"./chunk-LLGIJQAU.js";import"./chunk-BXOHVWQF.js";import"./chunk-JFSGAE4Z.js";import"./chunk-DW5T6CU6.js";import{A as V,Ad as L,Cd as Q,Dd as W,Gc as $,Jd as K,Lc as T,Mc as v,Nb as C,Ob as r,Oh as j,Pb as l,Pc as E,Ph as G,Qb as f,Ub as P,Vb as k,Xb as x,_b as u,bb as s,bc as _,fc as I,gb as h,gc as F,hc as O,lc as N,nb as b,qc as m,rc as w,sc as M,tb as g,vc as B,wc as A,xa as c,xc as R,ya as d}from"./chunk-F2J3MLFC.js";import{a as y,b as S}from"./chunk-57BLH6QZ.js";var me=()=>[];function ue(a,n){a&1&&f(0,"nz-icon",12)}function fe(a,n){if(a&1){let t=x();P(0),r(1,"nz-icon",16),u("click",function(){c(t);let i=_().$implicit,o=_();return d(o.openFolder(i))}),l(),r(2,"span",17),m(3),l(),r(4,"span",18),m(5),T(6,"lowercase"),l(),k()}if(a&2){let t=_(),e=t.$implicit,i=t.origin;s(),C("nzType",e.isExpanded?"folder-open":"folder"),s(2),w(e.title),s(2),M("created by ",v(6,3,i.author))}}function _e(a,n){if(a&1&&(f(0,"nz-icon",19),r(1,"span",20),m(2),l(),r(3,"span",21),m(4),T(5,"lowercase"),l()),a&2){let t=_(),e=t.$implicit,i=t.origin;s(2),w(e.title),s(2),M("modified by ",v(5,2,i.author))}}function ze(a,n){if(a&1){let t=x();r(0,"span",13)(1,"span",14),u("contextmenu",function(i){let o=c(t).$implicit,p=_(),se=N(15);return d(p.contextMenu(i,se,o))}),g(2,fe,7,5,"ng-container",15)(3,_e,6,4,"ng-template",null,3,E),l()()}if(a&2){let t=n.$implicit,e=N(4);s(2),C("ngIf",!t.isLeaf)("ngIfElse",e)}}var z=class z{constructor(n,t){this.nzContextMenuService=n;this.crudService=t;this.searchValue="";this.contextNode=null;this.treeData$=this.crudService.getNodes().pipe(V(e=>Ce(e)))}openFolder(n){if(n instanceof le)n.isExpanded=!n.isExpanded;else{let t=n.node;t&&(t.isExpanded=!t.isExpanded)}}activeNode(n){this.activatedNode=n.node}onDrop(n){console.log("\u62D6\u66F3\u5B8C\u6210:",n)}contextMenu(n,t,e){this.contextNode=e??null,this.nzContextMenuService.create(n,t)}addNode(){this.crud.showAddModal(this.contextNode?.key)}editNode(){this.contextNode&&this.crud.showEditModal(this.contextNode.origin)}deleteNode(){this.contextNode&&this.crud.deleteNode(this.contextNode.origin)}addRootNode(){this.crud.showAddModal(null)}selectDropdown(n){alert(n)}};z.\u0275fac=function(t){return new(t||z)(h(te),h(ae))},z.\u0275cmp=b({type:z,selectors:[["app-tree-panel"]],viewQuery:function(t,e){if(t&1&&I(D,5),t&2){let i;F(i=O())&&(e.crud=i.first)}},decls:23,vars:8,consts:[["suffixIcon",""],["nzTreeTemplate",""],["menu","nzDropdownMenu"],["fileIcon",""],[1,"toolbar"],["nz-button","","nzType","default",2,"margin-bottom","8px",3,"click"],["nz-icon","","nzType","cluster"],[3,"nzSuffix"],["type","text","nz-input","","placeholder","\u641C\u5C0B\u7BC0\u9EDE",3,"ngModelChange","ngModel"],["nzBlockNode","","nzDraggable","","nzVirtualHeight","300px",3,"nzClick","nzDblClick","nzOnDrop","nzData","nzSearchValue","nzTreeTemplate"],["nz-menu",""],["nz-menu-item","",3,"click"],["nzType","search"],[1,"custom-node"],[3,"contextmenu"],[4,"ngIf","ngIfElse"],[3,"click","nzType"],[1,"folder-name"],[1,"folder-desc"],["nzType","file"],[1,"file-name"],[1,"file-desc"]],template:function(t,e){if(t&1){let i=x();f(0,"app-firebase-crud"),r(1,"div",4)(2,"button",5),u("click",function(){return c(i),d(e.addRootNode())}),f(3,"span",6),m(4,"\u5EFA\u7ACB\u6839\u7D50\u9EDE "),l()(),r(5,"nz-input-group",7)(6,"input",8),R("ngModelChange",function(p){return c(i),A(e.searchValue,p)||(e.searchValue=p),d(p)}),l()(),g(7,ue,1,0,"ng-template",null,0,E),f(9,"br"),r(10,"nz-tree",9),T(11,"async"),u("nzClick",function(p){return c(i),d(e.activeNode(p))})("nzDblClick",function(p){return c(i),d(e.openFolder(p))})("nzOnDrop",function(p){return c(i),d(e.onDrop(p))}),l(),g(12,ze,5,2,"ng-template",null,1,E),r(14,"nz-dropdown-menu",null,2)(16,"ul",10)(17,"li",11),u("click",function(){return c(i),d(e.addNode())}),m(18,"\u65B0\u589E\u7BC0\u9EDE"),l(),r(19,"li",11),u("click",function(){return c(i),d(e.editNode())}),m(20,"\u7DE8\u8F2F\u7BC0\u9EDE"),l(),r(21,"li",11),u("click",function(){return c(i),d(e.deleteNode())}),m(22,"\u522A\u9664\u7BC0\u9EDE"),l()()()}if(t&2){let i=N(8),o=N(13);s(5),C("nzSuffix",i),s(),B("ngModel",e.searchValue),s(4),C("nzData",v(11,5,e.treeData$)??$(7,me))("nzSearchValue",e.searchValue)("nzTreeTemplate",o)}},dependencies:[K,L,U,q,H,J,ce,pe,ee,Y,X,Z,G,j,re,ne,oe,ie,D,Q,W],styles:["nz-tree[_ngcontent-%COMP%]{overflow:hidden;margin:0 -24px;padding:0 24px}.custom-node[_ngcontent-%COMP%]{cursor:pointer;line-height:24px;margin-left:4px;display:inline-block}.file-name[_ngcontent-%COMP%], .folder-name[_ngcontent-%COMP%]{margin-left:4px}.file-desc[_ngcontent-%COMP%], .folder-desc[_ngcontent-%COMP%]{padding:0 8px;display:inline-block;background:#87ceff;color:#fff;position:relative;left:12px}"]});var de=z;function Ce(a){let n=new Map,t=[];return a.forEach(e=>{n.set(e.key,S(y({},e),{children:[]}))}),n.forEach(e=>{e.parentKey&&n.has(e.parentKey)?n.get(e.parentKey).children.push(e):t.push(e)}),t}export{de as TreePanelComponent};
