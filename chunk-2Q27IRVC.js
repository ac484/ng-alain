import{C as Ji,I as wt,J as wh,K as Jt,L as vh,R as Th,S as Ih,T as Eh,U as Ah,W as bh,Z as sa,d as dh,f as fh,i as na,j as mh,k as gh,l as ph,m as qr,t as ra,u as ia,v as yh,y as _h}from"./chunk-2DVOMO4J.js";import{h as ea,i as V}from"./chunk-57BLH6QZ.js";var Sh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Rh={};var ce,oa;(function(){var r;function t(v,p){function w(){}w.prototype=p.prototype,v.D=p.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(T,I,A){for(var y=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)y[oe-2]=arguments[oe];return p.prototype[I].apply(T,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,w){w||(w=0);var T=Array(16);if(typeof p=="string")for(var I=0;16>I;++I)T[I]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(I=0;16>I;++I)T[I]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=v.g[0],w=v.g[1],I=v.g[2];var A=v.g[3],y=p+(A^w&(I^A))+T[0]+3614090360&4294967295;p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[1]+3905402710&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[2]+606105819&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[3]+3250441966&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(A^w&(I^A))+T[4]+4118548399&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[5]+1200080426&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[6]+2821735955&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[7]+4249261313&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(A^w&(I^A))+T[8]+1770035416&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[9]+2336552879&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[10]+4294925233&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[11]+2304563134&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(A^w&(I^A))+T[12]+1804603682&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[13]+4254626195&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[14]+2792965006&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[15]+1236535329&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(I^A&(w^I))+T[1]+4129170786&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[6]+3225465664&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[11]+643717713&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[0]+3921069994&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(w^I))+T[5]+3593408605&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[10]+38016083&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[15]+3634488961&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[4]+3889429448&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(w^I))+T[9]+568446438&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[14]+3275163606&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[3]+4107603335&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[8]+1163531501&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(w^I))+T[13]+2850285829&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[2]+4243563512&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[7]+1735328473&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[12]+2368359562&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(w^I^A)+T[5]+4294588738&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[8]+2272392833&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[11]+1839030562&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[14]+4259657740&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^A)+T[1]+2763975236&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[4]+1272893353&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[7]+4139469664&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[10]+3200236656&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^A)+T[13]+681279174&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[0]+3936430074&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[3]+3572445317&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[6]+76029189&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^A)+T[9]+3654602809&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[12]+3873151461&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[15]+530742520&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[2]+3299628645&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(I^(w|~A))+T[0]+4096336452&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[7]+1126891415&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[14]+2878612391&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[5]+4237533241&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~A))+T[12]+1700485571&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[3]+2399980690&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[10]+4293915773&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[1]+2240044497&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~A))+T[8]+1873313359&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[15]+4264355552&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[6]+2734768916&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[13]+1309151649&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~A))+T[4]+4149444226&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[11]+3174756917&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[2]+718787259&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+I&4294967295,v.g[3]=v.g[3]+A&4294967295}n.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var w=p-this.blockSize,T=this.B,I=this.h,A=0;A<p;){if(I==0)for(;A<=w;)i(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<p;)if(T[I++]=v.charCodeAt(A++),I==this.blockSize){i(this,T),I=0;break}}else for(;A<p;)if(T[I++]=v[A++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=p},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var w=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=w&255,w/=256;for(this.u(v),v=Array(16),p=w=0;4>p;++p)for(var T=0;32>T;T+=8)v[w++]=this.g[p]>>>T&255;return v};function s(v,p){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=p(v)}function a(v,p){this.h=p;for(var w=[],T=!0,I=v.length-1;0<=I;I--){var A=v[I]|0;T&&A==p||(w[I]=A,T=!1)}this.g=w}var u={};function l(v){return-128<=v&&128>v?s(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return g;if(0>v)return N(d(-v));for(var p=[],w=1,T=0;v>=w;T++)p[T]=v/w|0,w*=4294967296;return new a(p,0)}function f(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return N(f(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(p,8)),T=g,I=0;I<v.length;I+=8){var A=Math.min(8,v.length-I),y=parseInt(v.substring(I,I+A),p);8>A?(A=d(Math.pow(p,A)),T=T.j(A).add(d(y))):(T=T.j(w),T=T.add(d(y)))}return T}var g=l(0),_=l(1),S=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-N(this).m();for(var v=0,p=1,w=0;w<this.g.length;w++){var T=this.i(w);v+=(0<=T?T:4294967296+T)*p,p*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(x(this))return"0";if(k(this))return"-"+N(this).toString(v);for(var p=d(Math.pow(v,6)),w=this,T="";;){var I=W(w,p).g;w=z(w,I.j(p));var A=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=I,x(w))return A+T;for(;6>A.length;)A="0"+A;T=A+T}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function x(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function k(v){return v.h==-1}r.l=function(v){return v=z(this,v),k(v)?-1:x(v)?0:1};function N(v){for(var p=v.g.length,w=[],T=0;T<p;T++)w[T]=~v.g[T];return new a(w,~v.h).add(_)}r.abs=function(){return k(this)?N(this):this},r.add=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0,I=0;I<=p;I++){var A=T+(this.i(I)&65535)+(v.i(I)&65535),y=(A>>>16)+(this.i(I)>>>16)+(v.i(I)>>>16);T=y>>>16,A&=65535,y&=65535,w[I]=y<<16|A}return new a(w,w[w.length-1]&-2147483648?-1:0)};function z(v,p){return v.add(N(p))}r.j=function(v){if(x(this)||x(v))return g;if(k(this))return k(v)?N(this).j(N(v)):N(N(this).j(v));if(k(v))return N(this.j(N(v)));if(0>this.l(S)&&0>v.l(S))return d(this.m()*v.m());for(var p=this.g.length+v.g.length,w=[],T=0;T<2*p;T++)w[T]=0;for(T=0;T<this.g.length;T++)for(var I=0;I<v.g.length;I++){var A=this.i(T)>>>16,y=this.i(T)&65535,oe=v.i(I)>>>16,vr=v.i(I)&65535;w[2*T+2*I]+=y*vr,j(w,2*T+2*I),w[2*T+2*I+1]+=A*vr,j(w,2*T+2*I+1),w[2*T+2*I+1]+=y*oe,j(w,2*T+2*I+1),w[2*T+2*I+2]+=A*oe,j(w,2*T+2*I+2)}for(T=0;T<p;T++)w[T]=w[2*T+1]<<16|w[2*T];for(T=p;T<2*p;T++)w[T]=0;return new a(w,0)};function j(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function B(v,p){this.g=v,this.h=p}function W(v,p){if(x(p))throw Error("division by zero");if(x(v))return new B(g,g);if(k(v))return p=W(N(v),p),new B(N(p.g),N(p.h));if(k(p))return p=W(v,N(p)),new B(N(p.g),p.h);if(30<v.g.length){if(k(v)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var w=_,T=p;0>=T.l(v);)w=Z(w),T=Z(T);var I=$(w,1),A=$(T,1);for(T=$(T,2),w=$(w,2);!x(T);){var y=A.add(T);0>=y.l(v)&&(I=I.add(w),A=y),T=$(T,1),w=$(w,1)}return p=z(v,I.j(p)),new B(I,p)}for(I=g;0<=v.l(p);){for(w=Math.max(1,Math.floor(v.m()/p.m())),T=Math.ceil(Math.log(w)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),A=d(w),y=A.j(p);k(y)||0<y.l(v);)w-=T,A=d(w),y=A.j(p);x(A)&&(A=_),I=I.add(A),v=z(v,y)}return new B(I,v)}r.A=function(v){return W(this,v).h},r.and=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)&v.i(T);return new a(w,this.h&v.h)},r.or=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)|v.i(T);return new a(w,this.h|v.h)},r.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)^v.i(T);return new a(w,this.h^v.h)};function Z(v){for(var p=v.g.length+1,w=[],T=0;T<p;T++)w[T]=v.i(T)<<1|v.i(T-1)>>>31;return new a(w,v.h)}function $(v,p){var w=p>>5;p%=32;for(var T=v.g.length-w,I=[],A=0;A<T;A++)I[A]=0<p?v.i(A+w)>>>p|v.i(A+w+1)<<32-p:v.i(A+w);return new a(I,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,oa=Rh.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,ce=Rh.Integer=a}).apply(typeof Sh<"u"?Sh:typeof self<"u"?self:typeof window<"u"?window:{});var Yi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},le={};var aa,Pg,Pn,ua,Ur,Zi,ca,la,ha;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Yi=="object"&&Yi];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function i(o,c){if(c)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var E=o[m];if(!(E in h))break t;h=h[E]}o=o[o.length-1],m=h[o],c=c(m),c!=m&&c!=null&&t(h,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var h=0,m=!1,E={next:function(){if(!m&&h<o.length){var P=h++;return{value:c(P,o[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function f(o,c,h){return o.call.apply(o.bind,arguments)}function g(o,c,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,m),o.apply(c,E)}}return function(){return o.apply(c,arguments)}}function _(o,c,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,_.apply(null,arguments)}function S(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function x(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,E,P){for(var F=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)F[nt-2]=arguments[nt];return c.prototype[E].apply(m,F)}}function k(o){let c=o.length;if(0<c){let h=Array(c);for(let m=0;m<c;m++)h[m]=o[m];return h}return[]}function N(o,c){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(l(m)){let E=o.length||0,P=m.length||0;o.length=E+P;for(let F=0;F<P;F++)o[E+F]=m[F]}else o.push(m)}}class z{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function j(o){return/^[\s\xa0]*$/.test(o)}function B(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function W(o){return W[" "](o),o}W[" "]=function(){};var Z=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function $(o,c,h){for(let m in o)c.call(h,o[m],m,o)}function v(o,c){for(let h in o)c.call(void 0,o[h],h,o)}function p(o){let c={};for(let h in o)c[h]=o[h];return c}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(o,c){let h,m;for(let E=1;E<arguments.length;E++){m=arguments[E];for(h in m)o[h]=m[h];for(let P=0;P<w.length;P++)h=w[P],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function I(o){var c=1;o=o.split(":");let h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=Co;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class oe{constructor(){this.h=this.g=null}add(c,h){let m=vr.get();m.set(c,h),this.h?this.h.next=m:this.g=m,this.h=m}}var vr=new z(()=>new Wm,o=>o.reset());class Wm{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Tr,Ir=!1,Co=new oe,hl=()=>{let o=u.Promise.resolve(void 0);Tr=()=>{o.then(Hm)}};var Hm=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var c=vr;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}Ir=!1};function Te(){this.s=this.s,this.C=this.C}Te.prototype.s=!1,Te.prototype.ma=function(){this.s||(this.s=!0,this.N())},Te.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function bt(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}bt.prototype.h=function(){this.defaultPrevented=!0};var Xm=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return o}();function Er(o,c){if(bt.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(Z){t:{try{W(c.nodeName);var E=!0;break t}catch{}E=!1}E||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Jm[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Er.aa.h.call(this)}}x(Er,bt);var Jm={2:"touch",3:"pen",4:"mouse"};Er.prototype.h=function(){Er.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Ar="closure_listenable_"+(1e6*Math.random()|0),Ym=0;function Zm(o,c,h,m,E){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!m,this.ha=E,this.key=++Ym,this.da=this.fa=!1}function ki(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Fi(o){this.src=o,this.g={},this.h=0}Fi.prototype.add=function(o,c,h,m,E){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var F=Do(o,c,m,E);return-1<F?(c=o[F],h||(c.fa=!1)):(c=new Zm(c,this.src,P,!!m,E),c.fa=h,o.push(c)),c};function xo(o,c){var h=c.type;if(h in o.g){var m=o.g[h],E=Array.prototype.indexOf.call(m,c,void 0),P;(P=0<=E)&&Array.prototype.splice.call(m,E,1),P&&(ki(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Do(o,c,h,m){for(var E=0;E<o.length;++E){var P=o[E];if(!P.da&&P.listener==c&&P.capture==!!h&&P.ha==m)return E}return-1}var No="closure_lm_"+(1e6*Math.random()|0),ko={};function dl(o,c,h,m,E){if(m&&m.once)return ml(o,c,h,m,E);if(Array.isArray(c)){for(var P=0;P<c.length;P++)dl(o,c[P],h,m,E);return null}return h=Lo(h),o&&o[Ar]?o.K(c,h,d(m)?!!m.capture:!!m,E):fl(o,c,h,!1,m,E)}function fl(o,c,h,m,E,P){if(!c)throw Error("Invalid event type");var F=d(E)?!!E.capture:!!E,nt=Oo(o);if(nt||(o[No]=nt=new Fi(o)),h=nt.add(c,h,m,F,P),h.proxy)return h;if(m=tg(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)Xm||(E=F),E===void 0&&(E=!1),o.addEventListener(c.toString(),m,E);else if(o.attachEvent)o.attachEvent(pl(c.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function tg(){function o(h){return c.call(o.src,o.listener,h)}let c=eg;return o}function ml(o,c,h,m,E){if(Array.isArray(c)){for(var P=0;P<c.length;P++)ml(o,c[P],h,m,E);return null}return h=Lo(h),o&&o[Ar]?o.L(c,h,d(m)?!!m.capture:!!m,E):fl(o,c,h,!0,m,E)}function gl(o,c,h,m,E){if(Array.isArray(c))for(var P=0;P<c.length;P++)gl(o,c[P],h,m,E);else m=d(m)?!!m.capture:!!m,h=Lo(h),o&&o[Ar]?(o=o.i,c=String(c).toString(),c in o.g&&(P=o.g[c],h=Do(P,h,m,E),-1<h&&(ki(P[h]),Array.prototype.splice.call(P,h,1),P.length==0&&(delete o.g[c],o.h--)))):o&&(o=Oo(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Do(c,h,m,E)),(h=-1<o?c[o]:null)&&Fo(h))}function Fo(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Ar])xo(c.i,o);else{var h=o.type,m=o.proxy;c.removeEventListener?c.removeEventListener(h,m,o.capture):c.detachEvent?c.detachEvent(pl(h),m):c.addListener&&c.removeListener&&c.removeListener(m),(h=Oo(c))?(xo(h,o),h.h==0&&(h.src=null,c[No]=null)):ki(o)}}}function pl(o){return o in ko?ko[o]:ko[o]="on"+o}function eg(o,c){if(o.da)o=!0;else{c=new Er(c,this);var h=o.listener,m=o.ha||o.src;o.fa&&Fo(o),o=h.call(m,c)}return o}function Oo(o){return o=o[No],o instanceof Fi?o:null}var Mo="__closure_events_fn_"+(1e9*Math.random()>>>0);function Lo(o){return typeof o=="function"?o:(o[Mo]||(o[Mo]=function(c){return o.handleEvent(c)}),o[Mo])}function St(){Te.call(this),this.i=new Fi(this),this.M=this,this.F=null}x(St,Te),St.prototype[Ar]=!0,St.prototype.removeEventListener=function(o,c,h,m){gl(this,o,c,h,m)};function Dt(o,c){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=c.type||c,typeof c=="string")c=new bt(c,o);else if(c instanceof bt)c.target=c.target||o;else{var E=c;c=new bt(m,o),T(c,E)}if(E=!0,h)for(var P=h.length-1;0<=P;P--){var F=c.g=h[P];E=Oi(F,m,!0,c)&&E}if(F=c.g=o,E=Oi(F,m,!0,c)&&E,E=Oi(F,m,!1,c)&&E,h)for(P=0;P<h.length;P++)F=c.g=h[P],E=Oi(F,m,!1,c)&&E}St.prototype.N=function(){if(St.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],m=0;m<h.length;m++)ki(h[m]);delete o.g[c],o.h--}}this.F=null},St.prototype.K=function(o,c,h,m){return this.i.add(String(o),c,!1,h,m)},St.prototype.L=function(o,c,h,m){return this.i.add(String(o),c,!0,h,m)};function Oi(o,c,h,m){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var E=!0,P=0;P<c.length;++P){var F=c[P];if(F&&!F.da&&F.capture==h){var nt=F.listener,Et=F.ha||F.src;F.fa&&xo(o.i,F),E=nt.call(Et,m)!==!1&&E}}return E&&!m.defaultPrevented}function yl(o,c,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function _l(o){o.g=yl(()=>{o.g=null,o.i&&(o.i=!1,_l(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class ng extends Te{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:_l(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function br(o){Te.call(this),this.h=o,this.g={}}x(br,Te);var wl=[];function vl(o){$(o.g,function(c,h){this.g.hasOwnProperty(h)&&Fo(c)},o),o.g={}}br.prototype.N=function(){br.aa.N.call(this),vl(this)},br.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var qo=u.JSON.stringify,rg=u.JSON.parse,ig=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Uo(){}Uo.prototype.h=null;function Tl(o){return o.h||(o.h=o.i())}function Il(){}var Sr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Bo(){bt.call(this,"d")}x(Bo,bt);function jo(){bt.call(this,"c")}x(jo,bt);var Xe={},El=null;function Mi(){return El=El||new St}Xe.La="serverreachability";function Al(o){bt.call(this,Xe.La,o)}x(Al,bt);function Rr(o){let c=Mi();Dt(c,new Al(c))}Xe.STAT_EVENT="statevent";function bl(o,c){bt.call(this,Xe.STAT_EVENT,o),this.stat=c}x(bl,bt);function Nt(o){let c=Mi();Dt(c,new bl(c,o))}Xe.Ma="timingevent";function Sl(o,c){bt.call(this,Xe.Ma,o),this.size=c}x(Sl,bt);function Pr(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function Vr(){this.g=!0}Vr.prototype.xa=function(){this.g=!1};function sg(o,c,h,m,E,P){o.info(function(){if(o.g)if(P)for(var F="",nt=P.split("&"),Et=0;Et<nt.length;Et++){var J=nt[Et].split("=");if(1<J.length){var Rt=J[0];J=J[1];var Pt=Rt.split("_");F=2<=Pt.length&&Pt[1]=="type"?F+(Rt+"="+J+"&"):F+(Rt+"=redacted&")}}else F=null;else F=P;return"XMLHTTP REQ ("+m+") [attempt "+E+"]: "+c+`
`+h+`
`+F})}function og(o,c,h,m,E,P,F){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+E+"]: "+c+`
`+h+`
`+P+" "+F})}function An(o,c,h,m){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+ug(o,h)+(m?" "+m:"")})}function ag(o,c){o.info(function(){return"TIMEOUT: "+c})}Vr.prototype.info=function(){};function ug(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var E=m[1];if(Array.isArray(E)&&!(1>E.length)){var P=E[0];if(P!="noop"&&P!="stop"&&P!="close")for(var F=1;F<E.length;F++)E[F]=""}}}}return qo(h)}catch{return c}}var Li={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Rl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},zo;function qi(){}x(qi,Uo),qi.prototype.g=function(){return new XMLHttpRequest},qi.prototype.i=function(){return{}},zo=new qi;function Ie(o,c,h,m){this.j=o,this.i=c,this.l=h,this.R=m||1,this.U=new br(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pl}function Pl(){this.i=null,this.g="",this.h=!1}var Vl={},Go={};function Ko(o,c,h){o.L=1,o.v=zi(ae(c)),o.m=h,o.P=!0,Cl(o,null)}function Cl(o,c){o.F=Date.now(),Ui(o),o.A=ae(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),Gl(h.i,"t",m),o.C=0,h=o.j.J,o.h=new Pl,o.g=uh(o.j,h?c:null,!o.m),0<o.O&&(o.M=new ng(_(o.Y,o,o.g),o.O)),c=o.U,h=o.g,m=o.ca;var E="readystatechange";Array.isArray(E)||(E&&(wl[0]=E.toString()),E=wl);for(var P=0;P<E.length;P++){var F=dl(h,E[P],m||c.handleEvent,!1,c.h||c);if(!F)break;c.g[F.key]=F}c=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),Rr(),sg(o.i,o.u,o.A,o.l,o.R,o.m)}Ie.prototype.ca=function(o){o=o.target;let c=this.M;c&&ue(o)==3?c.j():this.Y(o)},Ie.prototype.Y=function(o){try{if(o==this.g)t:{let Pt=ue(this.g);var c=this.g.Ba();let Rn=this.g.Z();if(!(3>Pt)&&(Pt!=3||this.g&&(this.h.h||this.g.oa()||Jl(this.g)))){this.J||Pt!=4||c==7||(c==8||0>=Rn?Rr(3):Rr(2)),$o(this);var h=this.g.Z();this.X=h;e:if(xl(this)){var m=Jl(this.g);o="";var E=m.length,P=ue(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Je(this),Cr(this);var F="";break e}this.h.i=new u.TextDecoder}for(c=0;c<E;c++)this.h.h=!0,o+=this.h.i.decode(m[c],{stream:!(P&&c==E-1)});m.length=0,this.h.g+=o,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=h==200,og(this.i,this.u,this.A,this.l,this.R,Pt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var nt,Et=this.g;if((nt=Et.g?Et.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(nt)){var J=nt;break e}}J=null}if(h=J)An(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qo(this,h);else{this.o=!1,this.s=3,Nt(12),Je(this),Cr(this);break t}}if(this.P){h=!0;let Gt;for(;!this.J&&this.C<F.length;)if(Gt=cg(this,F),Gt==Go){Pt==4&&(this.s=4,Nt(14),h=!1),An(this.i,this.l,null,"[Incomplete Response]");break}else if(Gt==Vl){this.s=4,Nt(15),An(this.i,this.l,F,"[Invalid Chunk]"),h=!1;break}else An(this.i,this.l,Gt,null),Qo(this,Gt);if(xl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Pt!=4||F.length!=0||this.h.h||(this.s=1,Nt(16),h=!1),this.o=this.o&&h,!h)An(this.i,this.l,F,"[Invalid Chunked Response]"),Je(this),Cr(this);else if(0<F.length&&!this.W){this.W=!0;var Rt=this.j;Rt.g==this&&Rt.ba&&!Rt.M&&(Rt.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Zo(Rt),Rt.M=!0,Nt(11))}}else An(this.i,this.l,F,null),Qo(this,F);Pt==4&&Je(this),this.o&&!this.J&&(Pt==4?ih(this.j,this):(this.o=!1,Ui(this)))}else Sg(this.g),h==400&&0<F.indexOf("Unknown SID")?(this.s=3,Nt(12)):(this.s=0,Nt(13)),Je(this),Cr(this)}}}catch{}finally{}};function xl(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function cg(o,c){var h=o.C,m=c.indexOf(`
`,h);return m==-1?Go:(h=Number(c.substring(h,m)),isNaN(h)?Vl:(m+=1,m+h>c.length?Go:(c=c.slice(m,m+h),o.C=m+h,c)))}Ie.prototype.cancel=function(){this.J=!0,Je(this)};function Ui(o){o.S=Date.now()+o.I,Dl(o,o.I)}function Dl(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=Pr(_(o.ba,o),c)}function $o(o){o.B&&(u.clearTimeout(o.B),o.B=null)}Ie.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(ag(this.i,this.A),this.L!=2&&(Rr(),Nt(17)),Je(this),this.s=2,Cr(this)):Dl(this,this.S-o)};function Cr(o){o.j.G==0||o.J||ih(o.j,o)}function Je(o){$o(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,vl(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function Qo(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||Wo(h.h,o))){if(!o.K&&Wo(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(c)}catch{m=null}if(Array.isArray(m)&&m.length==3){var E=m;if(E[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)Wi(h),$i(h);else break t;Yo(h),Nt(18)}}else h.za=E[1],0<h.za-h.T&&37500>E[2]&&h.F&&h.v==0&&!h.C&&(h.C=Pr(_(h.Za,h),6e3));if(1>=Fl(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else Ze(h,11)}else if((o.K||h.g==o)&&Wi(h),!j(c))for(E=h.Da.g.parse(c),c=0;c<E.length;c++){let J=E[c];if(h.T=J[0],J=J[1],h.G==2)if(J[0]=="c"){h.K=J[1],h.ia=J[2];let Rt=J[3];Rt!=null&&(h.la=Rt,h.j.info("VER="+h.la));let Pt=J[4];Pt!=null&&(h.Aa=Pt,h.j.info("SVER="+h.Aa));let Rn=J[5];Rn!=null&&typeof Rn=="number"&&0<Rn&&(m=1.5*Rn,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let Gt=o.g;if(Gt){let Xi=Gt.g?Gt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Xi){var P=m.h;P.g||Xi.indexOf("spdy")==-1&&Xi.indexOf("quic")==-1&&Xi.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Ho(P,P.h),P.h=null))}if(m.D){let ta=Gt.g?Gt.g.getResponseHeader("X-HTTP-Session-Id"):null;ta&&(m.ya=ta,rt(m.I,m.D,ta))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var F=o;if(m.qa=ah(m,m.J?m.ia:null,m.W),F.K){Ol(m.h,F);var nt=F,Et=m.L;Et&&(nt.I=Et),nt.B&&($o(nt),Ui(nt)),m.g=F}else nh(m);0<h.i.length&&Qi(h)}else J[0]!="stop"&&J[0]!="close"||Ze(h,7);else h.G==3&&(J[0]=="stop"||J[0]=="close"?J[0]=="stop"?Ze(h,7):Jo(h):J[0]!="noop"&&h.l&&h.l.ta(J),h.v=0)}}Rr(4)}catch{}}var lg=class{constructor(o,c){this.g=o,this.map=c}};function Nl(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function kl(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Fl(o){return o.h?1:o.g?o.g.size:0}function Wo(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Ho(o,c){o.g?o.g.add(c):o.h=c}function Ol(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}Nl.prototype.cancel=function(){if(this.i=Ml(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Ml(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let h of o.g.values())c=c.concat(h.D);return c}return k(o.i)}function hg(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var c=[],h=o.length,m=0;m<h;m++)c.push(o[m]);return c}c=[],h=0;for(m in o)c[h++]=o[m];return c}function dg(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(let m in o)c[h++]=m;return c}}}function Ll(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=dg(o),m=hg(o),E=m.length,P=0;P<E;P++)c.call(void 0,m[P],h&&h[P],o)}var ql=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function fg(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),E=null;if(0<=m){var P=o[h].substring(0,m);E=o[h].substring(m+1)}else P=o[h];c(P,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function Ye(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Ye){this.h=o.h,Bi(this,o.j),this.o=o.o,this.g=o.g,ji(this,o.s),this.l=o.l;var c=o.i,h=new Nr;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),Ul(this,h),this.m=o.m}else o&&(c=String(o).match(ql))?(this.h=!1,Bi(this,c[1]||"",!0),this.o=xr(c[2]||""),this.g=xr(c[3]||"",!0),ji(this,c[4]),this.l=xr(c[5]||"",!0),Ul(this,c[6]||"",!0),this.m=xr(c[7]||"")):(this.h=!1,this.i=new Nr(null,this.h))}Ye.prototype.toString=function(){var o=[],c=this.j;c&&o.push(Dr(c,Bl,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Dr(c,Bl,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Dr(h,h.charAt(0)=="/"?pg:gg,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Dr(h,_g)),o.join("")};function ae(o){return new Ye(o)}function Bi(o,c,h){o.j=h?xr(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function ji(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function Ul(o,c,h){c instanceof Nr?(o.i=c,wg(o.i,o.h)):(h||(c=Dr(c,yg)),o.i=new Nr(c,o.h))}function rt(o,c,h){o.i.set(c,h)}function zi(o){return rt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function xr(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Dr(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,mg),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function mg(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Bl=/[#\/\?@]/g,gg=/[#\?:]/g,pg=/[#\?]/g,yg=/[#\?@]/g,_g=/#/g;function Nr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Ee(o){o.g||(o.g=new Map,o.h=0,o.i&&fg(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}r=Nr.prototype,r.add=function(o,c){Ee(this),this.i=null,o=bn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function jl(o,c){Ee(o),c=bn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function zl(o,c){return Ee(o),c=bn(o,c),o.g.has(c)}r.forEach=function(o,c){Ee(this),this.g.forEach(function(h,m){h.forEach(function(E){o.call(c,E,m,this)},this)},this)},r.na=function(){Ee(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let m=0;m<c.length;m++){let E=o[m];for(let P=0;P<E.length;P++)h.push(c[m])}return h},r.V=function(o){Ee(this);let c=[];if(typeof o=="string")zl(this,o)&&(c=c.concat(this.g.get(bn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},r.set=function(o,c){return Ee(this),this.i=null,o=bn(this,o),zl(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function Gl(o,c,h){jl(o,c),0<h.length&&(o.i=null,o.g.set(bn(o,c),k(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var m=c[h];let P=encodeURIComponent(String(m)),F=this.V(m);for(m=0;m<F.length;m++){var E=P;F[m]!==""&&(E+="="+encodeURIComponent(String(F[m]))),o.push(E)}}return this.i=o.join("&")};function bn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function wg(o,c){c&&!o.j&&(Ee(o),o.i=null,o.g.forEach(function(h,m){var E=m.toLowerCase();m!=E&&(jl(this,m),Gl(this,E,h))},o)),o.j=c}function vg(o,c){let h=new Vr;if(u.Image){let m=new Image;m.onload=S(Ae,h,"TestLoadImage: loaded",!0,c,m),m.onerror=S(Ae,h,"TestLoadImage: error",!1,c,m),m.onabort=S(Ae,h,"TestLoadImage: abort",!1,c,m),m.ontimeout=S(Ae,h,"TestLoadImage: timeout",!1,c,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else c(!1)}function Tg(o,c){let h=new Vr,m=new AbortController,E=setTimeout(()=>{m.abort(),Ae(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:m.signal}).then(P=>{clearTimeout(E),P.ok?Ae(h,"TestPingServer: ok",!0,c):Ae(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(E),Ae(h,"TestPingServer: error",!1,c)})}function Ae(o,c,h,m,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),m(h)}catch{}}function Ig(){this.g=new ig}function Eg(o,c,h){let m=h||"";try{Ll(o,function(E,P){let F=E;d(E)&&(F=qo(E)),c.push(m+P+"="+encodeURIComponent(F))})}catch(E){throw c.push(m+"type="+encodeURIComponent("_badmap")),E}}function kr(o){this.l=o.Ub||null,this.j=o.eb||!1}x(kr,Uo),kr.prototype.g=function(){return new Gi(this.l,this.j)},kr.prototype.i=function(o){return function(){return o}}({});function Gi(o,c){St.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(Gi,St),r=Gi.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,Or(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Fr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Or(this)),this.g&&(this.readyState=3,Or(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Kl(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Kl(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Fr(this):Or(this),this.readyState==3&&Kl(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Fr(this))},r.Qa=function(o){this.g&&(this.response=o,Fr(this))},r.ga=function(){this.g&&Fr(this)};function Fr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Or(o)}r.setRequestHeader=function(o,c){this.u.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Or(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Gi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function $l(o){let c="";return $(o,function(h,m){c+=m,c+=":",c+=h,c+=`\r
`}),c}function Xo(o,c,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=$l(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):rt(o,c,h))}function ct(o){St.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(ct,St);var Ag=/^https?$/i,bg=["POST","PUT"];r=ct.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,c,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():zo.g(),this.v=this.o?Tl(this.o):Tl(zo),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(P){Ql(this,P);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var E in m)h.set(E,m[E]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())h.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(bg,c,void 0))||m||E||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,F]of h)this.g.setRequestHeader(P,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Xl(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){Ql(this,P)}};function Ql(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,Wl(o),Ki(o)}function Wl(o){o.A||(o.A=!0,Dt(o,"complete"),Dt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Dt(this,"complete"),Dt(this,"abort"),Ki(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ki(this,!0)),ct.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Hl(this):this.bb())},r.bb=function(){Hl(this)};function Hl(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ue(o)!=4||o.Z()!=2)){if(o.u&&ue(o)==4)yl(o.Ea,0,o);else if(Dt(o,"readystatechange"),ue(o)==4){o.h=!1;try{let F=o.Z();t:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var m;if(m=F===0){var E=String(o.D).match(ql)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),m=!Ag.test(E?E.toLowerCase():"")}h=m}if(h)Dt(o,"complete"),Dt(o,"success");else{o.m=6;try{var P=2<ue(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",Wl(o)}}finally{Ki(o)}}}}function Ki(o,c){if(o.g){Xl(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||Dt(o,"ready");try{h.onreadystatechange=m}catch{}}}function Xl(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function ue(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<ue(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),rg(c)}};function Jl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Sg(o){let c={};o=(o.g&&2<=ue(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(j(o[m]))continue;var h=I(o[m]);let E=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let P=c[E]||[];c[E]=P,P.push(h)}v(c,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Mr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function Yl(o){this.Aa=0,this.i=[],this.j=new Vr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Mr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Mr("baseRetryDelayMs",5e3,o),this.cb=Mr("retryDelaySeedMs",1e4,o),this.Wa=Mr("forwardChannelMaxRetries",2,o),this.wa=Mr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Nl(o&&o.concurrentRequestLimit),this.Da=new Ig,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Yl.prototype,r.la=8,r.G=1,r.connect=function(o,c,h,m){Nt(0),this.W=o,this.H=c||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=ah(this,null,this.W),Qi(this)};function Jo(o){if(Zl(o),o.G==3){var c=o.U++,h=ae(o.I);if(rt(h,"SID",o.K),rt(h,"RID",c),rt(h,"TYPE","terminate"),Lr(o,h),c=new Ie(o,o.j,c),c.L=2,c.v=zi(ae(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=uh(c.j,null),c.g.ea(c.v)),c.F=Date.now(),Ui(c)}oh(o)}function $i(o){o.g&&(Zo(o),o.g.cancel(),o.g=null)}function Zl(o){$i(o),o.u&&(u.clearTimeout(o.u),o.u=null),Wi(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function Qi(o){if(!kl(o.h)&&!o.s){o.s=!0;var c=o.Ga;Tr||hl(),Ir||(Tr(),Ir=!0),Co.add(c,o),o.B=0}}function Rg(o,c){return Fl(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=Pr(_(o.Ga,o,c),sh(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new Ie(this,this.j,o),P=this.o;if(this.S&&(P?(P=p(P),T(P,this.S)):P=this.S),this.m!==null||this.O||(E.H=P,P=null),this.P)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(c+=m,4096<c){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=eh(this,E,c),h=ae(this.I),rt(h,"RID",o),rt(h,"CVER",22),this.D&&rt(h,"X-HTTP-Session-Id",this.D),Lr(this,h),P&&(this.O?c="headers="+encodeURIComponent(String($l(P)))+"&"+c:this.m&&Xo(h,this.m,P)),Ho(this.h,E),this.Ua&&rt(h,"TYPE","init"),this.P?(rt(h,"$req",c),rt(h,"SID","null"),E.T=!0,Ko(E,h,null)):Ko(E,h,c),this.G=2}}else this.G==3&&(o?th(this,o):this.i.length==0||kl(this.h)||th(this))};function th(o,c){var h;c?h=c.l:h=o.U++;let m=ae(o.I);rt(m,"SID",o.K),rt(m,"RID",h),rt(m,"AID",o.T),Lr(o,m),o.m&&o.o&&Xo(m,o.m,o.o),h=new Ie(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=eh(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Ho(o.h,h),Ko(h,m,c)}function Lr(o,c){o.H&&$(o.H,function(h,m){rt(c,m,h)}),o.l&&Ll({},function(h,m){rt(c,m,h)})}function eh(o,c,h){h=Math.min(o.i.length,h);var m=o.l?_(o.l.Na,o.l,o):null;t:{var E=o.i;let P=-1;for(;;){let F=["count="+h];P==-1?0<h?(P=E[0].g,F.push("ofs="+P)):P=0:F.push("ofs="+P);let nt=!0;for(let Et=0;Et<h;Et++){let J=E[Et].g,Rt=E[Et].map;if(J-=P,0>J)P=Math.max(0,E[Et].g-100),nt=!1;else try{Eg(Rt,F,"req"+J+"_")}catch{m&&m(Rt)}}if(nt){m=F.join("&");break t}}}return o=o.i.splice(0,h),c.D=o,m}function nh(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;Tr||hl(),Ir||(Tr(),Ir=!0),Co.add(c,o),o.v=0}}function Yo(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=Pr(_(o.Fa,o),sh(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,rh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Pr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Nt(10),$i(this),rh(this))};function Zo(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function rh(o){o.g=new Ie(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=ae(o.qa);rt(c,"RID","rpc"),rt(c,"SID",o.K),rt(c,"AID",o.T),rt(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&rt(c,"TO",o.ja),rt(c,"TYPE","xmlhttp"),Lr(o,c),o.m&&o.o&&Xo(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=zi(ae(c)),h.m=null,h.P=!0,Cl(h,o)}r.Za=function(){this.C!=null&&(this.C=null,$i(this),Yo(this),Nt(19))};function Wi(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function ih(o,c){var h=null;if(o.g==c){Wi(o),Zo(o),o.g=null;var m=2}else if(Wo(o.h,c))h=c.D,Ol(o.h,c),m=1;else return;if(o.G!=0){if(c.o)if(m==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var E=o.B;m=Mi(),Dt(m,new Sl(m,h)),Qi(o)}else nh(o);else if(E=c.s,E==3||E==0&&0<c.X||!(m==1&&Rg(o,c)||m==2&&Yo(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),E){case 1:Ze(o,5);break;case 4:Ze(o,10);break;case 3:Ze(o,6);break;default:Ze(o,2)}}}function sh(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function Ze(o,c){if(o.j.info("Error code "+c),c==2){var h=_(o.fb,o),m=o.Xa;let E=!m;m=new Ye(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Bi(m,"https"),zi(m),E?vg(m.toString(),h):Tg(m.toString(),h)}else Nt(2);o.G=0,o.l&&o.l.sa(c),oh(o),Zl(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Nt(2)):(this.j.info("Failed to ping google.com"),Nt(1))};function oh(o){if(o.G=0,o.ka=[],o.l){let c=Ml(o.h);(c.length!=0||o.i.length!=0)&&(N(o.ka,c),N(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function ah(o,c,h){var m=h instanceof Ye?ae(h):new Ye(h);if(m.g!="")c&&(m.g=c+"."+m.g),ji(m,m.s);else{var E=u.location;m=E.protocol,c=c?c+"."+E.hostname:E.hostname,E=+E.port;var P=new Ye(null);m&&Bi(P,m),c&&(P.g=c),E&&ji(P,E),h&&(P.l=h),m=P}return h=o.D,c=o.ya,h&&c&&rt(m,h,c),rt(m,"VER",o.la),Lr(o,m),m}function uh(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new ct(new kr({eb:h})):new ct(o.pa),c.Ha(o.J),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function ch(){}r=ch.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Hi(){}Hi.prototype.g=function(o,c){return new Lt(o,c)};function Lt(o,c){St.call(this),this.g=new Yl(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!j(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!j(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new Sn(this)}x(Lt,St),Lt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Lt.prototype.close=function(){Jo(this.g)},Lt.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=qo(o),o=h);c.i.push(new lg(c.Ya++,o)),c.G==3&&Qi(c)},Lt.prototype.N=function(){this.g.l=null,delete this.j,Jo(this.g),delete this.g,Lt.aa.N.call(this)};function lh(o){Bo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(let h in c){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}x(lh,Bo);function hh(){jo.call(this),this.status=1}x(hh,jo);function Sn(o){this.g=o}x(Sn,ch),Sn.prototype.ua=function(){Dt(this.g,"a")},Sn.prototype.ta=function(o){Dt(this.g,new lh(o))},Sn.prototype.sa=function(o){Dt(this.g,new hh)},Sn.prototype.ra=function(){Dt(this.g,"b")},Hi.prototype.createWebChannel=Hi.prototype.g,Lt.prototype.send=Lt.prototype.o,Lt.prototype.open=Lt.prototype.m,Lt.prototype.close=Lt.prototype.close,ha=le.createWebChannelTransport=function(){return new Hi},la=le.getStatEventTarget=function(){return Mi()},ca=le.Event=Xe,Zi=le.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Li.NO_ERROR=0,Li.TIMEOUT=8,Li.HTTP_ERROR=6,Ur=le.ErrorCode=Li,Rl.COMPLETE="complete",ua=le.EventType=Rl,Il.EventType=Sr,Sr.OPEN="a",Sr.CLOSE="b",Sr.ERROR="c",Sr.MESSAGE="d",St.prototype.listen=St.prototype.K,Pn=le.WebChannel=Il,Pg=le.FetchXmlHttpFactory=kr,ct.prototype.listenOnce=ct.prototype.L,ct.prototype.getLastError=ct.prototype.Ka,ct.prototype.getLastErrorCode=ct.prototype.Ba,ct.prototype.getStatus=ct.prototype.Z,ct.prototype.getResponseJson=ct.prototype.Oa,ct.prototype.getResponseText=ct.prototype.oa,ct.prototype.send=ct.prototype.ea,ct.prototype.setWithCredentials=ct.prototype.Ha,aa=le.XhrIo=ct}).apply(typeof Yi<"u"?Yi:typeof self<"u"?self:typeof window<"u"?window:{});var Ph="@firebase/firestore",Vh="4.8.0";var pt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};pt.UNAUTHENTICATED=new pt(null),pt.GOOGLE_CREDENTIALS=new pt("google-credentials-uid"),pt.FIRST_PARTY=new pt("first-party-uid"),pt.MOCK_USER=new pt("mock-user");var mr="11.10.0";var ke=new vh("@firebase/firestore");function Fn(){return ke.logLevel}function Wy(r){ke.setLogLevel(r)}function D(r,...t){if(ke.logLevel<=Jt.DEBUG){let e=t.map(Ac);ke.debug(`Firestore (${mr}): ${r}`,...e)}}function ht(r,...t){if(ke.logLevel<=Jt.ERROR){let e=t.map(Ac);ke.error(`Firestore (${mr}): ${r}`,...e)}}function jt(r,...t){if(ke.logLevel<=Jt.WARN){let e=t.map(Ac);ke.warn(`Firestore (${mr}): ${r}`,...e)}}function Ac(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function L(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,Kd(r,n,e)}function Kd(r,t,e){let n=`FIRESTORE (${mr}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw ht(n),new Error(n)}function q(r,t,e,n){let i="Unexpected state";typeof e=="string"?i=e:n=e,r||Kd(t,i,n)}function Hy(r,t){r||L(57014,t)}function M(r,t){return r}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},C=class extends _h{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var vt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var fs=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},wa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(pt.UNAUTHENTICATED))}shutdown(){}},va=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Ta=class{constructor(t){this.t=t,this.currentUser=pt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){q(this.o===void 0,42304);let n=this.i,i=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve(),s=new vt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new vt,t.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;t.enqueueRetryable(()=>V(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},u=l=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new vt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q(typeof n.accessToken=="string",31837,{l:n}),new fs(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string",2055,{h:t}),new pt(t)}},Ia=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=pt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Ea=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new Ia(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(pt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},ms=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Aa=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Eh(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){q(this.o===void 0,3512);let n=s=>{s.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.m;return this.m=s.token,D("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>n(s))};let i=s=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new ms(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(q(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new ms(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Vg(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}function bc(){return new TextEncoder}var ei=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let i=Vg(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%62))}return n}};function G(r,t){return r<t?-1:r>t?1:0}function ba(r,t){let e=0;for(;e<r.length&&e<t.length;){let n=r.codePointAt(e),i=t.codePointAt(e);if(n!==i){if(n<128&&i<128)return G(n,i);{let s=bc(),a=Cg(s.encode(Ch(r,e)),s.encode(Ch(t,e)));return a!==0?a:G(n,i)}}e+=n>65535?2:1}return G(r.length,t.length)}function Ch(r,t){return r.codePointAt(t)>65535?r.substring(t,t+2):r.substring(t,t+1)}function Cg(r,t){for(let e=0;e<r.length&&e<t.length;++e)if(r[e]!==t[e])return G(r[e],t[e]);return G(r.length,t.length)}function Kn(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}function $d(r){return r+"\0"}var xh="__name__",gs=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&L(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&L(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let i=0;i<n;i++){let s=r.compareSegments(t.get(i),e.get(i));if(s!==0)return s}return G(t.length,e.length)}static compareSegments(t,e){let n=r.isNumericId(t),i=r.isNumericId(e);return n&&!i?-1:!n&&i?1:n&&i?r.extractNumericId(t).compare(r.extractNumericId(e)):ba(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ce.fromString(t.substring(4,t.length-2))}},H=class r extends gs{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new C(R.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new r(e)}static emptyPath(){return new r([])}},xg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Tt=class r extends gs{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return xg.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===xh}static keyField(){return new r([xh])}static fromServerFormat(t){let e=[],n="",i=0,s=()=>{if(n.length===0)throw new C(R.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new C(R.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let l=t[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new C(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new C(R.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var O=class r{constructor(t){this.path=t}static fromPath(t){return new r(H.fromString(t))}static fromName(t){return new r(H.fromString(t).popFirst(5))}static empty(){return new r(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&H.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return H.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new H(t.slice()))}};function Sc(r,t,e){if(!e)throw new C(R.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function Dg(r,t,e,n){if(t===!0&&n===!0)throw new C(R.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function Dh(r){if(!O.isDocumentKey(r))throw new C(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Nh(r){if(O.isDocumentKey(r))throw new C(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Qd(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function po(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":L(12329,{type:typeof r})}function Y(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new C(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=po(r);throw new C(R.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function Wd(r,t){if(t<=0)throw new C(R.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}function yt(r,t){let e={typeString:r};return t&&(e.value=t),e}function Si(r,t){if(!Qd(r))throw new C(R.INVALID_ARGUMENT,"JSON must be an object");let e;for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}let a=r[n];if(i&&typeof a!==i){e=`JSON field '${n}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){e=`Expected '${n}' field to equal '${s.value}'`;break}}if(e)throw new C(R.INVALID_ARGUMENT,e);return!0}var kh=-62135596800,Fh=1e6,ot=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*Fh);return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new C(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new C(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<kh)throw new C(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new C(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Fh}_compareTo(t){return this.seconds===t.seconds?G(this.nanoseconds,t.nanoseconds):G(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:r._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Si(t,r._jsonSchema))return new r(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-kh;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};ot._jsonSchemaVersion="firestore/timestamp/1.0",ot._jsonSchema={type:yt("string",ot._jsonSchemaVersion),seconds:yt("number"),nanoseconds:yt("number")};var U=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new ot(0,0))}static max(){return new r(new ot(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var $n=-1,Qn=class{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}};function Sa(r){return r.fields.find(t=>t.kind===2)}function en(r){return r.fields.filter(t=>t.kind!==2)}Qn.UNKNOWN_ID=-1;var Bn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var ni=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,zt.min())}};function Hd(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=U.fromTimestamp(n===1e9?new ot(e+1,0):new ot(e,n));return new zt(i,O.empty(),t)}function Xd(r){return new zt(r.readTime,r.key,$n)}var zt=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(U.min(),O.empty(),$n)}static max(){return new r(U.max(),O.empty(),$n)}};function Rc(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=O.comparator(r.documentKey,t.documentKey),e!==0?e:G(r.largestBatchId,t.largestBatchId))}var Jd="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ps=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Ke(r){return V(this,null,function*(){if(r.code!==R.FAILED_PRECONDITION||r.message!==Jd)throw r;D("LocalStore","Unexpectedly lost primary lease")})}var b=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let i=0,s=0,a=!1;t.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&e()},l=>n(l))}),a=!0,s===i&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(i=>i?r.resolve(i):n());return e}static forEach(t,e){let n=[];return t.forEach((i,s)=>{n.push(e.call(this,i,s))}),this.waitFor(n)}static mapArray(t,e){return new r((n,i)=>{let s=t.length,a=new Array(s),u=0;for(let l=0;l<s;l++){let d=l;e(t[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(t,e){return new r((n,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):n()};s()})}};var qt="SimpleDb",ys=class r{static open(t,e,n,i){try{return new r(e,t.transaction(i,n))}catch(s){throw new ln(e,s)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new vt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new ln(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{let i=Pc(n.target.error);this.S.reject(new ln(t,i))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(D(qt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Pa(e)}},Fe=class r{static delete(t){return D(qt,"Removing database:",t),rn(dh().indexedDB.deleteDatabase(t)).toPromise()}static C(){if(!yh())return!1;if(r.F())return!0;let t=qr(),e=r.M(t),n=0<e&&e<10,i=Yd(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static F(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.O)==="YES"}static N(t,e){return t.store(e)}static M(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.B=n,this.L=null,r.M(qr())===12.2&&ht("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(t){return V(this,null,function*(){return this.db||(D(qt,"Opening database:",this.name),this.db=yield new Promise((e,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;e(a)},i.onblocked=()=>{n(new ln(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new C(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new C(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new ln(t,a))},i.onupgradeneeded=s=>{D(qt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${a.version}`);this.B.q(a,i.transaction,s.oldVersion,this.version).next(()=>{D(qt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let n=e.target;this.L=n.version},{passive:!0})),this.db.addEventListener("versionchange",e=>{var n;e.newVersion===null&&(jt('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(n=this.databaseDeletedListener)===null||n===void 0||n.call(this))},{passive:!0}),this.db})}setDatabaseDeletedListener(t){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=t}runTransaction(t,e,n,i){return V(this,null,function*(){let s=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.k(t);let u=ys.open(this.db,t,s?"readonly":"readwrite",n),l=i(u).next(d=>(u.v(),d)).catch(d=>(u.abort(d),b.reject(d))).toPromise();return l.catch(()=>{}),yield u.D,l}catch(u){let l=u,d=l.name!=="FirebaseError"&&a<3;if(D(qt,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Yd(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var Ra=class{constructor(t){this.$=t,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(t){this.$=t}done(){this.U=!0}G(t){this.K=t}delete(){return rn(this.$.delete())}},ln=class extends C{constructor(t,e){super(R.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function $e(r){return r.name==="IndexedDbTransactionError"}var Pa=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(D(qt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(D(qt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),rn(n)}add(t){return D(qt,"ADD",this.store.name,t,t),rn(this.store.add(t))}get(t){return rn(this.store.get(t)).next(e=>(e===void 0&&(e=null),D(qt,"GET",this.store.name,t,e),e))}delete(t){return D(qt,"DELETE",this.store.name,t),rn(this.store.delete(t))}count(){return D(qt,"COUNT",this.store.name),rn(this.store.count())}j(t,e){let n=this.options(t,e),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new b((a,u)=>{s.onerror=l=>{u(l.target.error)},s.onsuccess=l=>{a(l.target.result)}})}{let s=this.cursor(n),a=[];return this.J(s,(u,l)=>{a.push(l)}).next(()=>a)}}H(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new b((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}Y(t,e){D(qt,"DELETE ALL",this.store.name);let n=this.options(t,e);n.Z=!1;let i=this.cursor(n);return this.J(i,(s,a,u)=>u.delete())}X(t,e){let n;e?n=t:(n={},e=t);let i=this.cursor(n);return this.J(i,e)}ee(t){let e=this.cursor({});return new b((n,i)=>{e.onerror=s=>{let a=Pc(s.target.error);i(a)},e.onsuccess=s=>{let a=s.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}J(t,e){let n=[];return new b((i,s)=>{t.onerror=a=>{s(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let l=new Ra(u),d=e(u.primaryKey,u.value,l);if(d instanceof b){let f=d.catch(g=>(l.done(),b.reject(g)));n.push(f)}l.isDone?i():l.W===null?u.continue():u.continue(l.W)}}).next(()=>b.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.Z?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function rn(r){return new b((t,e)=>{r.onsuccess=n=>{let i=n.target.result;t(i)},r.onerror=n=>{let i=Pc(n.target.error);e(i)}})}var Oh=!1;function Pc(r){let t=Fe.M(qr());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Oh||(Oh=!0,setTimeout(()=>{throw n},0)),n}}return r}var Qr="IndexBackfiller",Va=class{constructor(t,e){this.asyncQueue=t,this.te=e,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(t){D(Qr,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>V(this,null,function*(){this.task=null;try{let e=yield this.te.re();D(Qr,`Documents written: ${e}`)}catch(e){$e(e)?D(Qr,"Ignoring IndexedDB error during index backfill: ",e):yield Ke(e)}yield this.ne(6e4)}))}},Ca=class{constructor(t,e){this.localStore=t,this.persistence=e}re(t=50){return V(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.ie(e,t))})}ie(t,e){let n=new Set,i=e,s=!0;return b.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return D(Qr,`Processing collection: ${a}`),this.se(t,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>e-i)}se(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.oe(i,s)).next(u=>(D(Qr,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}oe(t,e){let n=t;return e.changes.forEach((i,s)=>{let a=Xd(s);Rc(a,n)>0&&(n=a)}),new zt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Ut=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this._e(i),this.ae=i=>n.writeSequenceNumber(i))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}}r.ue=-1;return r})(),xe=-1;function Ri(r){return r==null}function ri(r){return r===0&&1/r==-1/0}function Zd(r){return typeof r=="number"&&Number.isInteger(r)&&!ri(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}var _s="";function xt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Mh(t)),t=Ng(r.get(e),t);return Mh(t)}function Ng(r,t){let e=t,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":e+="";break;case _s:e+="";break;default:e+=s}}return e}function Mh(r){return r+_s+""}function Zt(r){let t=r.length;if(q(t>=2,64408,{path:r}),t===2)return q(r.charAt(0)===_s&&r.charAt(1)==="",56145,{path:r}),H.emptyPath();let e=t-2,n=[],i="";for(let s=0;s<t;){let a=r.indexOf(_s,s);switch((a<0||a>e)&&L(50515,{path:r}),r.charAt(a+1)){case"":let u=r.substring(s,a),l;i.length===0?l=u:(i+=u,l=i,i=""),n.push(l);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:L(61167,{path:r})}s=a+2}return new H(n)}var nn="remoteDocuments",Pi="owner",Vn="owner",ii="mutationQueues",kg="userId",Kt="mutations",Lh="batchId",un="userMutationsIndex",qh=["userId","batchId"];function ss(r,t){return[r,xt(t)]}function tf(r,t,e){return[r,xt(t),e]}var Fg={},Wn="documentMutations",ws="remoteDocumentsV14",Og=["prefixPath","collectionGroup","readTime","documentId"],os="documentKeyIndex",Mg=["prefixPath","collectionGroup","documentId"],ef="collectionGroupIndex",Lg=["collectionGroup","readTime","prefixPath","documentId"],si="remoteDocumentGlobal",xa="remoteDocumentGlobalKey",Hn="targets",nf="queryTargetsIndex",qg=["canonicalId","targetId"],Xn="targetDocuments",Ug=["targetId","path"],Vc="documentTargetsIndex",Bg=["path","targetId"],vs="targetGlobalKey",hn="targetGlobal",oi="collectionParents",jg=["collectionId","parent"],Jn="clientMetadata",zg="clientId",yo="bundles",Gg="bundleId",_o="namedQueries",Kg="name",Cc="indexConfiguration",$g="indexId",Da="collectionGroupIndex",Qg="collectionGroup",Wr="indexState",Wg=["indexId","uid"],rf="sequenceNumberIndex",Hg=["uid","sequenceNumber"],Hr="indexEntries",Xg=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],sf="documentKeyIndex",Jg=["indexId","uid","orderedDocumentKey"],wo="documentOverlays",Yg=["userId","collectionPath","documentId"],Na="collectionPathOverlayIndex",Zg=["userId","collectionPath","largestBatchId"],of="collectionGroupOverlayIndex",tp=["userId","collectionGroup","largestBatchId"],xc="globals",ep="name",af=[ii,Kt,Wn,nn,Hn,Pi,hn,Xn,Jn,si,oi,yo,_o],np=[...af,wo],uf=[ii,Kt,Wn,ws,Hn,Pi,hn,Xn,Jn,si,oi,yo,_o,wo],cf=uf,Dc=[...cf,Cc,Wr,Hr],rp=Dc,lf=[...Dc,xc],ip=lf;var ai=class extends ps{constructor(t,e){super(),this.ce=t,this.currentSequenceNumber=e}};function It(r,t){let e=M(r);return Fe.N(e.ce,t)}function Uh(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Qe(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function hf(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var it=class r{constructor(t,e){this.comparator=t,this.root=e||ee.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ee.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ee.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(t,n.key);if(i===0)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Un(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Un(this.root,t,this.comparator,!1)}getReverseIterator(){return new Un(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Un(this.root,t,this.comparator,!0)}},Un=class{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},ee=class r{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new r(t??this.key,e??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this,s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw L(27949);return t+(this.isRed()?0:1)}};ee.EMPTY=null,ee.RED=!0,ee.BLACK=!1;ee.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(t,e,n,i,s){return this}insert(t,e,n){return new ee(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var et=class r{constructor(t){this.comparator=t,this.data=new it(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ts(this.data.getIterator())}getIteratorFrom(t){return new Ts(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Ts=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Cn(r){return r.hasNext()?r.getNext():void 0}var Bt=class r{constructor(t){this.fields=t,t.sort(Tt.comparator)}static empty(){return new r([])}unionWith(t){let e=new et(Tt.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Kn(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var Is=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Jy(){return typeof atob<"u"}var ft=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Is("Invalid base64 string: "+s):s}}(t);return new r(e)}static fromUint8Array(t){let e=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return G(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};ft.EMPTY_BYTE_STRING=new ft("");var sp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function me(r){if(q(!!r,39018),typeof r=="string"){let t=0,e=sp.exec(r);if(q(!!e,46558,{timestamp:r}),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:st(r.seconds),nanos:st(r.nanos)}}function st(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function ge(r){return typeof r=="string"?ft.fromBase64String(r):ft.fromUint8Array(r)}var df="server_timestamp",ff="__type__",mf="__previous_value__",gf="__local_write_time__";function vo(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[ff])===null||e===void 0?void 0:e.stringValue)===df}function To(r){let t=r.mapValue.fields[mf];return vo(t)?To(t):t}function ui(r){let t=me(r.mapValue.fields[gf].timestampValue);return new ot(t.seconds,t.nanos)}var ka=class{constructor(t,e,n,i,s,a,u,l,d,f){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=f}},Es="(default)",Yn=class r{constructor(t,e){this.projectId=t,this.database=e||Es}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===Es}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Nc="__type__",pf="__max__",Ve={mapValue:{fields:{__type__:{stringValue:pf}}}},kc="__vector__",Zn="value",as={nullValue:"NULL_VALUE"};function Oe(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?vo(r)?4:yf(r)?9007199254740991:Io(r)?10:11:L(28295,{value:r})}function ie(r,t){if(r===t)return!0;let e=Oe(r);if(e!==Oe(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return ui(r).isEqual(ui(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=me(i.timestampValue),u=me(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(i,s){return ge(i.bytesValue).isEqual(ge(s.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(i,s){return st(i.geoPointValue.latitude)===st(s.geoPointValue.latitude)&&st(i.geoPointValue.longitude)===st(s.geoPointValue.longitude)}(r,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return st(i.integerValue)===st(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=st(i.doubleValue),u=st(s.doubleValue);return a===u?ri(a)===ri(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return Kn(r.arrayValue.values||[],t.arrayValue.values||[],ie);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Uh(a)!==Uh(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!ie(a[l],u[l])))return!1;return!0}(r,t);default:return L(52216,{left:r})}}function ci(r,t){return(r.values||[]).find(e=>ie(e,t))!==void 0}function Me(r,t){if(r===t)return 0;let e=Oe(r),n=Oe(t);if(e!==n)return G(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return G(r.booleanValue,t.booleanValue);case 2:return function(s,a){let u=st(s.integerValue||s.doubleValue),l=st(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(r,t);case 3:return Bh(r.timestampValue,t.timestampValue);case 4:return Bh(ui(r),ui(t));case 5:return ba(r.stringValue,t.stringValue);case 6:return function(s,a){let u=ge(s),l=ge(a);return u.compareTo(l)}(r.bytesValue,t.bytesValue);case 7:return function(s,a){let u=s.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let f=G(u[d],l[d]);if(f!==0)return f}return G(u.length,l.length)}(r.referenceValue,t.referenceValue);case 8:return function(s,a){let u=G(st(s.latitude),st(a.latitude));return u!==0?u:G(st(s.longitude),st(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return jh(r.arrayValue,t.arrayValue);case 10:return function(s,a){var u,l,d,f;let g=s.fields||{},_=a.fields||{},S=(u=g[Zn])===null||u===void 0?void 0:u.arrayValue,x=(l=_[Zn])===null||l===void 0?void 0:l.arrayValue,k=G(((d=S?.values)===null||d===void 0?void 0:d.length)||0,((f=x?.values)===null||f===void 0?void 0:f.length)||0);return k!==0?k:jh(S,x)}(r.mapValue,t.mapValue);case 11:return function(s,a){if(s===Ve.mapValue&&a===Ve.mapValue)return 0;if(s===Ve.mapValue)return 1;if(a===Ve.mapValue)return-1;let u=s.fields||{},l=Object.keys(u),d=a.fields||{},f=Object.keys(d);l.sort(),f.sort();for(let g=0;g<l.length&&g<f.length;++g){let _=ba(l[g],f[g]);if(_!==0)return _;let S=Me(u[l[g]],d[f[g]]);if(S!==0)return S}return G(l.length,f.length)}(r.mapValue,t.mapValue);default:throw L(23264,{le:e})}}function Bh(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return G(r,t);let e=me(r),n=me(t),i=G(e.seconds,n.seconds);return i!==0?i:G(e.nanos,n.nanos)}function jh(r,t){let e=r.values||[],n=t.values||[];for(let i=0;i<e.length&&i<n.length;++i){let s=Me(e[i],n[i]);if(s)return s}return G(e.length,n.length)}function tr(r){return Fa(r)}function Fa(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=me(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return ge(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return O.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",i=!0;for(let s of e.values||[])i?i=!1:n+=",",n+=Fa(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${Fa(e.fields[a])}`;return i+"}"}(r.mapValue):L(61005,{value:r})}function us(r){switch(Oe(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=To(r);return t?16+us(t):16;case 5:return 2*r.stringValue.length;case 6:return ge(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,s)=>i+us(s),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return Qe(n.fields,(s,a)=>{i+=s.length+us(a)}),i}(r.mapValue);default:throw L(13486,{value:r})}}function dn(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Oa(r){return!!r&&"integerValue"in r}function li(r){return!!r&&"arrayValue"in r}function zh(r){return!!r&&"nullValue"in r}function Gh(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function cs(r){return!!r&&"mapValue"in r}function Io(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Nc])===null||e===void 0?void 0:e.stringValue)===kc}function Xr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return Qe(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Xr(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Xr(r.arrayValue.values[e]);return t}return Object.assign({},r)}function yf(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===pf}var _f={mapValue:{fields:{[Nc]:{stringValue:kc},[Zn]:{arrayValue:{}}}}};function op(r){return"nullValue"in r?as:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?dn(Yn.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Io(r)?_f:{mapValue:{}}:L(35942,{value:r})}function ap(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?dn(Yn.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?_f:"mapValue"in r?Io(r)?{mapValue:{}}:Ve:L(61959,{value:r})}function Kh(r,t){let e=Me(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function $h(r,t){let e=Me(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Ct=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!cs(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Xr(e)}setAll(t){let e=Tt.emptyPath(),n={},i=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let l=this.getFieldsMap(e);this.applyChanges(l,n,i),n={},i=[],e=u.popLast()}a?n[u.lastSegment()]=Xr(a):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){let e=this.field(t.popLast());cs(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ie(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];cs(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Qe(e,(i,s)=>t[i]=s);for(let i of n)delete t[i]}clone(){return new r(Xr(this.value))}};function wf(r){let t=[];return Qe(r.fields,(e,n)=>{let i=new Tt([e]);if(cs(n)){let s=wf(n.mapValue).fields;if(s.length===0)t.push(i);else for(let a of s)t.push(i.child(a))}else t.push(i)}),new Bt(t)}var _t=class r{constructor(t,e,n,i,s,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,U.min(),U.min(),U.min(),Ct.empty(),0)}static newFoundDocument(t,e,n,i){return new r(t,1,e,U.min(),n,i,0)}static newNoDocument(t,e){return new r(t,2,e,U.min(),U.min(),Ct.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,U.min(),U.min(),Ct.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ct.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ct.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var se=class{constructor(t,e){this.position=t,this.inclusive=e}};function Qh(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){let s=t[i],a=r.position[i];if(s.field.isKeyField()?n=O.comparator(O.fromName(a.referenceValue),e.key):n=Me(a,e.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Wh(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!ie(r.position[e],t.position[e]))return!1;return!0}var fn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function up(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var As=class{},Q=class r extends As{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new qa(t,e,n):e==="array-contains"?new ja(t,n):e==="in"?new bs(t,n):e==="not-in"?new za(t,n):e==="array-contains-any"?new Ga(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new Ua(t,n):new Ba(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Me(e,this.value)):e!==null&&Oe(this.value)===Oe(e)&&this.matchesComparison(Me(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},tt=class r extends As{constructor(t,e){super(),this.filters=t,this.op=e,this.he=null}static create(t,e){return new r(t,e)}matches(t){return er(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function er(r){return r.op==="and"}function Ma(r){return r.op==="or"}function Fc(r){return vf(r)&&er(r)}function vf(r){for(let t of r.filters)if(t instanceof tt)return!1;return!0}function La(r){if(r instanceof Q)return r.field.canonicalString()+r.op.toString()+tr(r.value);if(Fc(r))return r.filters.map(t=>La(t)).join(",");{let t=r.filters.map(e=>La(e)).join(",");return`${r.op}(${t})`}}function Tf(r,t){return r instanceof Q?function(n,i){return i instanceof Q&&n.op===i.op&&n.field.isEqual(i.field)&&ie(n.value,i.value)}(r,t):r instanceof tt?function(n,i){return i instanceof tt&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&Tf(a,i.filters[u]),!0):!1}(r,t):void L(19439)}function If(r,t){let e=r.filters.concat(t);return tt.create(e,r.op)}function Ef(r){return r instanceof Q?function(e){return`${e.field.canonicalString()} ${e.op} ${tr(e.value)}`}(r):r instanceof tt?function(e){return e.op.toString()+" {"+e.getFilters().map(Ef).join(" ,")+"}"}(r):"Filter"}var qa=class extends Q{constructor(t,e,n){super(t,e,n),this.key=O.fromName(n.referenceValue)}matches(t){let e=O.comparator(t.key,this.key);return this.matchesComparison(e)}},Ua=class extends Q{constructor(t,e){super(t,"in",e),this.keys=Af("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Ba=class extends Q{constructor(t,e){super(t,"not-in",e),this.keys=Af("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Af(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>O.fromName(n.referenceValue))}var ja=class extends Q{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return li(e)&&ci(e.arrayValue,this.value)}},bs=class extends Q{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&ci(this.value.arrayValue,e)}},za=class extends Q{constructor(t,e){super(t,"not-in",e)}matches(t){if(ci(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!ci(this.value.arrayValue,e)}},Ga=class extends Q{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!li(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>ci(this.value.arrayValue,n))}};var Ka=class{constructor(t,e=null,n=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.Pe=null}};function $a(r,t=null,e=[],n=[],i=null,s=null,a=null){return new Ka(r,t,e,n,i,s,a)}function mn(r){let t=M(r);if(t.Pe===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>La(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),Ri(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>tr(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>tr(n)).join(",")),t.Pe=e}return t.Pe}function Vi(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!up(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Tf(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Wh(r.startAt,t.startAt)&&Wh(r.endAt,t.endAt)}function Ss(r){return O.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Rs(r,t){return r.filters.filter(e=>e instanceof Q&&e.field.isEqual(t))}function Hh(r,t,e){let n=as,i=!0;for(let s of Rs(r,t)){let a=as,u=!0;switch(s.op){case"<":case"<=":a=op(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=as}Kh({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];Kh({value:n,inclusive:i},{value:a,inclusive:e.inclusive})<0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}function Xh(r,t,e){let n=Ve,i=!0;for(let s of Rs(r,t)){let a=Ve,u=!0;switch(s.op){case">=":case">":a=ap(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Ve}$h({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];$h({value:n,inclusive:i},{value:a,inclusive:e.inclusive})>0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}var Wt=class{constructor(t,e=null,n=[],i=[],s=null,a="F",u=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=l,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function bf(r,t,e,n,i,s,a,u){return new Wt(r,t,e,n,i,s,a,u)}function gr(r){return new Wt(r)}function Jh(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Oc(r){return r.collectionGroup!==null}function jn(r){let t=M(r);if(t.Te===null){t.Te=[];let e=new Set;for(let s of t.explicitOrderBy)t.Te.push(s),e.add(s.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new et(Tt.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.Te.push(new fn(s,n))}),e.has(Tt.keyField().canonicalString())||t.Te.push(new fn(Tt.keyField(),n))}return t.Te}function kt(r){let t=M(r);return t.Ie||(t.Ie=cp(t,jn(r))),t.Ie}function cp(r,t){if(r.limitType==="F")return $a(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new fn(i.field,s)});let e=r.endAt?new se(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new se(r.startAt.position,r.startAt.inclusive):null;return $a(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function Qa(r,t){let e=r.filters.concat([t]);return new Wt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Ps(r,t,e){return new Wt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function Ci(r,t){return Vi(kt(r),kt(t))&&r.limitType===t.limitType}function Sf(r){return`${mn(kt(r))}|lt:${r.limitType}`}function On(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>Ef(i)).join(", ")}]`),Ri(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>tr(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>tr(i)).join(",")),`Target(${n})`}(kt(r))}; limitType=${r.limitType})`}function xi(r,t){return t.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):O.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,t)&&function(n,i){for(let s of jn(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,t)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,t)&&function(n,i){return!(n.startAt&&!function(a,u,l){let d=Qh(a,u,l);return a.inclusive?d<=0:d<0}(n.startAt,jn(n),i)||n.endAt&&!function(a,u,l){let d=Qh(a,u,l);return a.inclusive?d>=0:d>0}(n.endAt,jn(n),i))}(r,t)}function Rf(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Pf(r){return(t,e)=>{let n=!1;for(let i of jn(r)){let s=lp(i,t,e);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function lp(r,t,e){let n=r.field.isKeyField()?O.comparator(t.key,e.key):function(s,a,u){let l=a.data.field(s),d=u.data.field(s);return l!==null&&d!==null?Me(l,d):L(42886)}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L(19790,{direction:r.dir})}}var Ht=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),i=this.inner[n];if(i===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return n.length===1?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Qe(this.inner,(e,n)=>{for(let[i,s]of n)t(i,s)})}isEmpty(){return hf(this.inner)}size(){return this.innerSize}};var hp=new it(O.comparator);function Mt(){return hp}var Vf=new it(O.comparator);function Kr(...r){let t=Vf;for(let e of r)t=t.insert(e.key,e);return t}function Cf(r){let t=Vf;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function te(){return Jr()}function xf(){return Jr()}function Jr(){return new Ht(r=>r.toString(),(r,t)=>r.isEqual(t))}var dp=new it(O.comparator),fp=new et(O.comparator);function K(...r){let t=fp;for(let e of r)t=t.add(e);return t}var mp=new et(G);function Mc(){return mp}function Lc(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ri(t)?"-0":t}}function Df(r){return{integerValue:""+r}}function Nf(r,t){return Zd(t)?Df(t):Lc(r,t)}var nr=class{constructor(){this._=void 0}};function gp(r,t,e){return r instanceof Le?function(i,s){let a={fields:{[ff]:{stringValue:df},[gf]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&vo(s)&&(s=To(s)),s&&(a.fields[mf]=s),{mapValue:a}}(e,t):r instanceof pe?Ff(r,t):r instanceof ye?Of(r,t):function(i,s){let a=kf(i,s),u=Yh(a)+Yh(i.Ee);return Oa(a)&&Oa(i.Ee)?Df(u):Lc(i.serializer,u)}(r,t)}function pp(r,t,e){return r instanceof pe?Ff(r,t):r instanceof ye?Of(r,t):e}function kf(r,t){return r instanceof qe?function(n){return Oa(n)||function(s){return!!s&&"doubleValue"in s}(n)}(t)?t:{integerValue:0}:null}var Le=class extends nr{},pe=class extends nr{constructor(t){super(),this.elements=t}};function Ff(r,t){let e=Mf(t);for(let n of r.elements)e.some(i=>ie(i,n))||e.push(n);return{arrayValue:{values:e}}}var ye=class extends nr{constructor(t){super(),this.elements=t}};function Of(r,t){let e=Mf(t);for(let n of r.elements)e=e.filter(i=>!ie(i,n));return{arrayValue:{values:e}}}var qe=class extends nr{constructor(t,e){super(),this.serializer=t,this.Ee=e}};function Yh(r){return st(r.integerValue||r.doubleValue)}function Mf(r){return li(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var gn=class{constructor(t,e){this.field=t,this.transform=e}};function yp(r,t){return r.field.isEqual(t.field)&&function(n,i){return n instanceof pe&&i instanceof pe||n instanceof ye&&i instanceof ye?Kn(n.elements,i.elements,ie):n instanceof qe&&i instanceof qe?ie(n.Ee,i.Ee):n instanceof Le&&i instanceof Le}(r.transform,t.transform)}var Wa=class{constructor(t,e){this.version=t,this.transformResults=e}},lt=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function ls(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var rr=class{};function Lf(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new Be(r.key,lt.none()):new Ue(r.key,r.data,lt.none());{let e=r.data,n=Ct.empty(),i=new et(Tt.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);a===null&&s.length>1&&(s=s.popLast(),a=e.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new Xt(r.key,n,new Bt(i.toArray()),lt.none())}}function _p(r,t,e){r instanceof Ue?function(i,s,a){let u=i.value.clone(),l=td(i.fieldTransforms,s,a.transformResults);u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof Xt?function(i,s,a){if(!ls(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=td(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(qf(i)),l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,t,e):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Yr(r,t,e,n){return r instanceof Ue?function(s,a,u,l){if(!ls(s.precondition,a))return u;let d=s.value.clone(),f=ed(s.fieldTransforms,l,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof Xt?function(s,a,u,l){if(!ls(s.precondition,a))return u;let d=ed(s.fieldTransforms,l,a),f=a.data;return f.setAll(qf(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,t,e,n):function(s,a,u){return ls(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function wp(r,t){let e=null;for(let n of r.fieldTransforms){let i=t.data.field(n.field),s=kf(n.transform,i||null);s!=null&&(e===null&&(e=Ct.empty()),e.set(n.field,s))}return e||null}function Zh(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Kn(n,i,(s,a)=>yp(s,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Ue=class extends rr{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Xt=class extends rr{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function qf(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function td(r,t,e){let n=new Map;q(r.length===e.length,32656,{Ae:e.length,Re:r.length});for(let i=0;i<e.length;i++){let s=r[i],a=s.transform,u=t.data.field(s.field);n.set(s.field,pp(a,u,e[i]))}return n}function ed(r,t,e){let n=new Map;for(let i of r){let s=i.transform,a=e.data.field(i.field);n.set(i.field,gp(s,a,t))}return n}var Be=class extends rr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},hi=class extends rr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var di=class{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&_p(s,t,n[i])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=Yr(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=Yr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=xf();return this.mutations.forEach(i=>{let s=t.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;let l=Lf(a,u);l!==null&&n.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(U.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),K())}isEqual(t){return this.batchId===t.batchId&&Kn(this.mutations,t.mutations,(e,n)=>Zh(e,n))&&Kn(this.baseMutations,t.baseMutations,(e,n)=>Zh(e,n))}},Ha=class r{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){q(t.mutations.length===n.length,58842,{Ve:t.mutations.length,me:n.length});let i=function(){return dp}(),s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(t,e,n,i)}};var fi=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Xa=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var mt,X;function Uf(r){switch(r){case R.OK:return L(64938);case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return L(15467,{code:r})}}function Bf(r){if(r===void 0)return ht("GRPC error has no .code"),R.UNKNOWN;switch(r){case mt.OK:return R.OK;case mt.CANCELLED:return R.CANCELLED;case mt.UNKNOWN:return R.UNKNOWN;case mt.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case mt.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case mt.INTERNAL:return R.INTERNAL;case mt.UNAVAILABLE:return R.UNAVAILABLE;case mt.UNAUTHENTICATED:return R.UNAUTHENTICATED;case mt.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case mt.NOT_FOUND:return R.NOT_FOUND;case mt.ALREADY_EXISTS:return R.ALREADY_EXISTS;case mt.PERMISSION_DENIED:return R.PERMISSION_DENIED;case mt.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case mt.ABORTED:return R.ABORTED;case mt.OUT_OF_RANGE:return R.OUT_OF_RANGE;case mt.UNIMPLEMENTED:return R.UNIMPLEMENTED;case mt.DATA_LOSS:return R.DATA_LOSS;default:return L(39323,{code:r})}}(X=mt||(mt={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";var nd=null;var vp=new ce([4294967295,4294967295],0);function rd(r){let t=bc().encode(r),e=new oa;return e.update(t),new Uint8Array(e.digest())}function id(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new ce([e,n],0),new ce([i,s],0)]}var Ja=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new cn(`Invalid padding: ${e}`);if(n<0)throw new cn(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new cn(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new cn(`Invalid padding when bitmap length is 0: ${e}`);this.fe=8*t.length-e,this.ge=ce.fromNumber(this.fe)}pe(t,e,n){let i=t.add(e.multiply(ce.fromNumber(n)));return i.compare(vp)===1&&(i=new ce([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.fe===0)return!1;let e=rd(t),[n,i]=id(e);for(let s=0;s<this.hashCount;s++){let a=this.pe(n,i,s);if(!this.ye(a))return!1}return!0}static create(t,e,n){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new r(s,i,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.fe===0)return;let e=rd(t),[n,i]=id(e);for(let s=0;s<this.hashCount;s++){let a=this.pe(n,i,s);this.we(a)}}we(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},cn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var mi=class r{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let i=new Map;return i.set(t,gi.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(U.min(),i,new it(G),Mt(),K())}},gi=class r{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,K(),K(),K())}};var zn=class{constructor(t,e,n,i){this.Se=t,this.removedTargetIds=e,this.key=n,this.be=i}},Vs=class{constructor(t,e){this.targetId=t,this.De=e}},Cs=class{constructor(t,e,n=ft.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}},xs=class{constructor(){this.ve=0,this.Ce=sd(),this.Fe=ft.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(t){t.approximateByteSize()>0&&(this.xe=!0,this.Fe=t)}Le(){let t=K(),e=K(),n=K();return this.Ce.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:L(38017,{changeType:s})}}),new gi(this.Fe,this.Me,t,e,n)}ke(){this.xe=!1,this.Ce=sd()}qe(t,e){this.xe=!0,this.Ce=this.Ce.insert(t,e)}Qe(t){this.xe=!0,this.Ce=this.Ce.remove(t)}$e(){this.ve+=1}Ue(){this.ve-=1,q(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},Ya=class{constructor(t){this.We=t,this.Ge=new Map,this.ze=Mt(),this.je=ts(),this.Je=ts(),this.He=new it(G)}Ye(t){for(let e of t.Se)t.be&&t.be.isFoundDocument()?this.Ze(e,t.be):this.Xe(e,t.key,t.be);for(let e of t.removedTargetIds)this.Xe(e,t.key,t.be)}et(t){this.forEachTarget(t,e=>{let n=this.tt(e);switch(t.state){case 0:this.nt(e)&&n.Be(t.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(t.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(e);break;case 3:this.nt(e)&&(n.Ke(),n.Be(t.resumeToken));break;case 4:this.nt(e)&&(this.rt(e),n.Be(t.resumeToken));break;default:L(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ge.forEach((n,i)=>{this.nt(i)&&e(i)})}it(t){let e=t.targetId,n=t.De.count,i=this.st(e);if(i){let s=i.target;if(Ss(s))if(n===0){let a=new O(s.path);this.Xe(e,a,_t.newNoDocument(a,U.min()))}else q(n===1,20013,{expectedCount:n});else{let a=this.ot(e);if(a!==n){let u=this._t(t),l=u?this.ut(u,t,a):1;if(l!==0){this.rt(e);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(e,d)}nd?.ct(function(f,g,_,S,x){var k,N,z,j,B,W;let Z={localCacheCount:f,existenceFilterCount:g.count,databaseId:_.database,projectId:_.projectId},$=g.unchangedNames;return $&&(Z.bloomFilter={applied:x===0,hashCount:(k=$?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(j=(z=(N=$?.bits)===null||N===void 0?void 0:N.bitmap)===null||z===void 0?void 0:z.length)!==null&&j!==void 0?j:0,padding:(W=(B=$?.bits)===null||B===void 0?void 0:B.padding)!==null&&W!==void 0?W:0,mightContain:v=>{var p;return(p=S?.mightContain(v))!==null&&p!==void 0&&p}}),Z}(a,t.De,this.We.lt(),u,l))}}}}_t(t){let e=t.De.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=e,a,u;try{a=ge(n).toUint8Array()}catch(l){if(l instanceof Is)return jt("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new Ja(a,i,s)}catch(l){return jt(l instanceof cn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.fe===0?null:u}ut(t,e,n){return e.De.count===n-this.ht(t,e.targetId)?0:2}ht(t,e){let n=this.We.getRemoteKeysForTarget(e),i=0;return n.forEach(s=>{let a=this.We.lt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.Xe(e,s,null),i++)}),i}Pt(t){let e=new Map;this.Ge.forEach((s,a)=>{let u=this.st(a);if(u){if(s.current&&Ss(u.target)){let l=new O(u.target.path);this.Tt(l).has(a)||this.It(a,l)||this.Xe(a,l,_t.newNoDocument(l,t))}s.Ne&&(e.set(a,s.Le()),s.ke())}});let n=K();this.Je.forEach((s,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.st(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ze.forEach((s,a)=>a.setReadTime(t));let i=new mi(t,e,this.He,this.ze,n);return this.ze=Mt(),this.je=ts(),this.Je=ts(),this.He=new it(G),i}Ze(t,e){if(!this.nt(t))return;let n=this.It(t,e.key)?2:0;this.tt(t).qe(e.key,n),this.ze=this.ze.insert(e.key,e),this.je=this.je.insert(e.key,this.Tt(e.key).add(t)),this.Je=this.Je.insert(e.key,this.dt(e.key).add(t))}Xe(t,e,n){if(!this.nt(t))return;let i=this.tt(t);this.It(t,e)?i.qe(e,1):i.Qe(e),this.Je=this.Je.insert(e,this.dt(e).delete(t)),this.Je=this.Je.insert(e,this.dt(e).add(t)),n&&(this.ze=this.ze.insert(e,n))}removeTarget(t){this.Ge.delete(t)}ot(t){let e=this.tt(t).Le();return this.We.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}$e(t){this.tt(t).$e()}tt(t){let e=this.Ge.get(t);return e||(e=new xs,this.Ge.set(t,e)),e}dt(t){let e=this.Je.get(t);return e||(e=new et(G),this.Je=this.Je.insert(t,e)),e}Tt(t){let e=this.je.get(t);return e||(e=new et(G),this.je=this.je.insert(t,e)),e}nt(t){let e=this.st(t)!==null;return e||D("WatchChangeAggregator","Detected inactive target",t),e}st(t){let e=this.Ge.get(t);return e&&e.Oe?null:this.We.Et(t)}rt(t){this.Ge.set(t,new xs),this.We.getRemoteKeysForTarget(t).forEach(e=>{this.Xe(t,e,null)})}It(t,e){return this.We.getRemoteKeysForTarget(t).has(e)}};function ts(){return new it(O.comparator)}function sd(){return new it(O.comparator)}var Tp={asc:"ASCENDING",desc:"DESCENDING"},Ip={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ep={and:"AND",or:"OR"},Za=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function tu(r,t){return r.useProto3Json||Ri(t)?t:{value:t}}function ir(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function jf(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function Ap(r,t){return ir(r,t.toTimestamp())}function dt(r){return q(!!r,49232),U.fromTimestamp(function(e){let n=me(e);return new ot(n.seconds,n.nanos)}(r))}function qc(r,t){return eu(r,t).canonicalString()}function eu(r,t){let e=function(i){return new H(["projects",i.projectId,"databases",i.database])}(r).child("documents");return t===void 0?e:e.child(t)}function zf(r){let t=H.fromString(r);return q(Zf(t),10190,{key:t.toString()}),t}function pi(r,t){return qc(r.databaseId,t.path)}function ne(r,t){let e=zf(t);if(e.get(1)!==r.databaseId.projectId)throw new C(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new C(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new O($f(e))}function Gf(r,t){return qc(r.databaseId,t)}function Kf(r){let t=zf(r);return t.length===4?H.emptyPath():$f(t)}function nu(r){return new H(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function $f(r){return q(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function od(r,t,e){return{name:pi(r,t),fields:e.value.mapValue.fields}}function Qf(r,t,e){let n=ne(r,t.name),i=dt(t.updateTime),s=t.createTime?dt(t.createTime):U.min(),a=new Ct({mapValue:{fields:t.fields}}),u=_t.newFoundDocument(n,i,s,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function bp(r,t){return"found"in t?function(n,i){q(!!i.found,43571),i.found.name,i.found.updateTime;let s=ne(n,i.found.name),a=dt(i.found.updateTime),u=i.found.createTime?dt(i.found.createTime):U.min(),l=new Ct({mapValue:{fields:i.found.fields}});return _t.newFoundDocument(s,a,u,l)}(r,t):"missing"in t?function(n,i){q(!!i.missing,3894),q(!!i.readTime,22933);let s=ne(n,i.missing),a=dt(i.readTime);return _t.newNoDocument(s,a)}(r,t):L(7234,{result:t})}function Sp(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L(39313,{state:d})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(q(f===void 0||typeof f=="string",58123),ft.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),ft.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(d){let f=d.code===void 0?R.UNKNOWN:Bf(d.code);return new C(f,d.message||"")}(a);e=new Cs(n,i,s,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=ne(r,n.document.name),s=dt(n.document.updateTime),a=n.document.createTime?dt(n.document.createTime):U.min(),u=new Ct({mapValue:{fields:n.document.fields}}),l=_t.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new zn(d,f,l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=ne(r,n.document),s=n.readTime?dt(n.readTime):U.min(),a=_t.newNoDocument(i,s),u=n.removedTargetIds||[];e=new zn([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=ne(r,n.document),s=n.removedTargetIds||[];e=new zn([],s,i,null)}else{if(!("filter"in t))return L(11601,{At:t});{t.filter;let n=t.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new Xa(i,s),u=n.targetId;e=new Vs(u,a)}}return e}function yi(r,t){let e;if(t instanceof Ue)e={update:od(r,t.key,t.value)};else if(t instanceof Be)e={delete:pi(r,t.key)};else if(t instanceof Xt)e={update:od(r,t.key,t.data),updateMask:Dp(t.fieldMask)};else{if(!(t instanceof hi))return L(16599,{Rt:t.type});e={verify:pi(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof Le)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof pe)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof ye)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof qe)return{fieldPath:a.field.canonicalString(),increment:u.Ee};throw L(20930,{transform:a.transform})}(0,n))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Ap(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:L(27497)}(r,t.precondition)),e}function ru(r,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?lt.updateTime(dt(s.updateTime)):s.exists!==void 0?lt.exists(s.exists):lt.none()}(t.currentDocument):lt.none(),n=t.updateTransforms?t.updateTransforms.map(i=>function(a,u){let l=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),l=new Le;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];l=new pe(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];l=new ye(f)}else"increment"in u?l=new qe(a,u.increment):L(16584,{proto:u});let d=Tt.fromServerFormat(u.fieldPath);return new gn(d,l)}(r,i)):[];if(t.update){t.update.name;let i=ne(r,t.update.name),s=new Ct({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(l){let d=l.fieldPaths||[];return new Bt(d.map(f=>Tt.fromServerFormat(f)))}(t.updateMask);return new Xt(i,s,a,e,n)}return new Ue(i,s,e,n)}if(t.delete){let i=ne(r,t.delete);return new Be(i,e)}if(t.verify){let i=ne(r,t.verify);return new hi(i,e)}return L(1463,{proto:t})}function Rp(r,t){return r&&r.length>0?(q(t!==void 0,14353),r.map(e=>function(i,s){let a=i.updateTime?dt(i.updateTime):dt(s);return a.isEqual(U.min())&&(a=dt(s)),new Wa(a,i.transformResults||[])}(e,t))):[]}function Wf(r,t){return{documents:[Gf(r,t.path)]}}function Hf(r,t){let e={structuredQuery:{}},n=t.path,i;t.collectionGroup!==null?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Gf(r,i);let s=function(d){if(d.length!==0)return Yf(tt.create(d,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(_){return{field:Mn(_.field),direction:Vp(_.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=tu(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{Vt:e,parent:i}}function Xf(r){let t=Kf(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,i=null;if(n>0){q(n===1,65062);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=function(g){let _=Jf(g);return _ instanceof tt&&Fc(_)?_.getFilters():[_]}(e.where));let a=[];e.orderBy&&(a=function(g){return g.map(_=>function(x){return new fn(Ln(x.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(_))}(e.orderBy));let u=null;e.limit&&(u=function(g){let _;return _=typeof g=="object"?g.value:g,Ri(_)?null:_}(e.limit));let l=null;e.startAt&&(l=function(g){let _=!!g.before,S=g.values||[];return new se(S,_)}(e.startAt));let d=null;return e.endAt&&(d=function(g){let _=!g.before,S=g.values||[];return new se(S,_)}(e.endAt)),bf(t,i,a,s,u,"F",l,d)}function Pp(r,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:i})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Jf(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=Ln(e.unaryFilter.field);return Q.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Ln(e.unaryFilter.field);return Q.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Ln(e.unaryFilter.field);return Q.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Ln(e.unaryFilter.field);return Q.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}}(r):r.fieldFilter!==void 0?function(e){return Q.create(Ln(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return tt.create(e.compositeFilter.filters.map(n=>Jf(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L(1026)}}(e.compositeFilter.op))}(r):L(30097,{filter:r})}function Vp(r){return Tp[r]}function Cp(r){return Ip[r]}function xp(r){return Ep[r]}function Mn(r){return{fieldPath:r.canonicalString()}}function Ln(r){return Tt.fromServerFormat(r.fieldPath)}function Yf(r){return r instanceof Q?function(e){if(e.op==="=="){if(Gh(e.value))return{unaryFilter:{field:Mn(e.field),op:"IS_NAN"}};if(zh(e.value))return{unaryFilter:{field:Mn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Gh(e.value))return{unaryFilter:{field:Mn(e.field),op:"IS_NOT_NAN"}};if(zh(e.value))return{unaryFilter:{field:Mn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Mn(e.field),op:Cp(e.op),value:e.value}}}(r):r instanceof tt?function(e){let n=e.getFilters().map(i=>Yf(i));return n.length===1?n[0]:{compositeFilter:{op:xp(e.op),filters:n}}}(r):L(54877,{filter:r})}function Dp(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Zf(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var sr=class r{constructor(t,e,n,i,s=U.min(),a=U.min(),u=ft.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Ds=class{constructor(t){this.gt=t}};function Np(r,t){let e;if(t.document)e=Qf(r.gt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=O.fromSegments(t.noDocument.path),i=yn(t.noDocument.readTime);e=_t.newNoDocument(n,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L(56709);{let n=O.fromSegments(t.unknownDocument.path),i=yn(t.unknownDocument.version);e=_t.newUnknownDocument(n,i)}}return t.readTime&&e.setReadTime(function(i){let s=new ot(i[0],i[1]);return U.fromTimestamp(s)}(t.readTime)),e}function ad(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Ns(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(s,a){return{name:pi(s,a.key),fields:a.data.value.mapValue.fields,updateTime:ir(s,a.version.toTimestamp()),createTime:ir(s,a.createTime.toTimestamp())}}(r.gt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:pn(t.version)};else{if(!t.isUnknownDocument())return L(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:pn(t.version)}}return n}function Ns(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function pn(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function yn(r){let t=new ot(r.seconds,r.nanoseconds);return U.fromTimestamp(t)}function sn(r,t){let e=(t.baseMutations||[]).map(s=>ru(r.gt,s));for(let s=0;s<t.mutations.length-1;++s){let a=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let n=t.mutations.map(s=>ru(r.gt,s)),i=ot.fromMillis(t.localWriteTimeMs);return new di(t.batchId,i,e,n)}function $r(r){let t=yn(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?yn(r.lastLimboFreeSnapshotVersion):U.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){let a=s.documents.length;return q(a===1,1966,{count:a}),kt(gr(Kf(s.documents[0])))}(r.query):function(s){return kt(Xf(s))}(r.query),new sr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,ft.fromBase64String(r.resumeToken))}function tm(r,t){let e=pn(t.snapshotVersion),n=pn(t.lastLimboFreeSnapshotVersion),i;i=Ss(t.target)?Wf(r.gt,t.target):Hf(r.gt,t.target).Vt;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:mn(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function Uc(r){let t=Xf({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Ps(t,t.limit,"L"):t}function da(r,t){return new fi(t.largestBatchId,ru(r.gt,t.overlayMutation))}function ud(r,t){let e=t.path.lastSegment();return[r,xt(t.path.popLast()),e]}function cd(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:pn(n.readTime),documentKey:xt(n.documentKey.path),largestBatchId:n.largestBatchId}}var iu=class{getBundleMetadata(t,e){return ld(t).get(e).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:yn(s.createTime),version:s.version}}(n)})}saveBundleMetadata(t,e){return ld(t).put(function(i){return{bundleId:i.id,createTime:pn(dt(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return hd(t).get(e).next(n=>{if(n)return function(s){return{name:s.name,query:Uc(s.bundledQuery),readTime:yn(s.readTime)}}(n)})}saveNamedQuery(t,e){return hd(t).put(function(i){return{name:i.name,readTime:pn(dt(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function ld(r){return It(r,yo)}function hd(r){return It(r,_o)}var ks=class r{constructor(t,e){this.serializer=t,this.userId=e}static yt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return Br(t).get(ud(this.userId,e)).next(n=>n?da(this.serializer,n):null)}getOverlays(t,e){let n=te();return b.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){let i=[];return n.forEach((s,a)=>{let u=new fi(e,a);i.push(this.wt(t,u))}),b.waitFor(i)}removeOverlaysForBatchId(t,e,n){let i=new Set;e.forEach(a=>i.add(xt(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(Br(t).Y(Na,u))}),b.waitFor(s)}getOverlaysForCollection(t,e,n){let i=te(),s=xt(e),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Br(t).j(Na,a).next(u=>{for(let l of u){let d=da(this.serializer,l);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(t,e,n,i){let s=te(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Br(t).X({index:of,range:u},(l,d,f)=>{let g=da(this.serializer,d);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}wt(t,e){return Br(t).put(function(i,s,a){let[u,l,d]=ud(s,a.mutation.key);return{userId:s,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:yi(i.gt,a.mutation)}}(this.serializer,this.userId,e))}};function Br(r){return It(r,wo)}var su=class{St(t){return It(t,xc)}getSessionToken(t){return this.St(t).get("sessionToken").next(e=>{let n=e?.value;return n?ft.fromUint8Array(n):ft.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.St(t).put({name:"sessionToken",value:e.toUint8Array()})}};var he=class{constructor(){}bt(t,e){this.Dt(t,e),e.vt()}Dt(t,e){if("nullValue"in t)this.Ct(e,5);else if("booleanValue"in t)this.Ct(e,10),e.Ft(t.booleanValue?1:0);else if("integerValue"in t)this.Ct(e,15),e.Ft(st(t.integerValue));else if("doubleValue"in t){let n=st(t.doubleValue);isNaN(n)?this.Ct(e,13):(this.Ct(e,15),ri(n)?e.Ft(0):e.Ft(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ct(e,20),typeof n=="string"&&(n=me(n)),e.Mt(`${n.seconds||""}`),e.Ft(n.nanos||0)}else if("stringValue"in t)this.xt(t.stringValue,e),this.Ot(e);else if("bytesValue"in t)this.Ct(e,30),e.Nt(ge(t.bytesValue)),this.Ot(e);else if("referenceValue"in t)this.Bt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Ct(e,45),e.Ft(n.latitude||0),e.Ft(n.longitude||0)}else"mapValue"in t?yf(t)?this.Ct(e,Number.MAX_SAFE_INTEGER):Io(t)?this.Lt(t.mapValue,e):(this.kt(t.mapValue,e),this.Ot(e)):"arrayValue"in t?(this.qt(t.arrayValue,e),this.Ot(e)):L(19022,{Qt:t})}xt(t,e){this.Ct(e,25),this.$t(t,e)}$t(t,e){e.Mt(t)}kt(t,e){let n=t.fields||{};this.Ct(e,55);for(let i of Object.keys(n))this.xt(i,e),this.Dt(n[i],e)}Lt(t,e){var n,i;let s=t.fields||{};this.Ct(e,53);let a=Zn,u=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.Ct(e,15),e.Ft(st(u)),this.xt(a,e),this.Dt(s[a],e)}qt(t,e){let n=t.values||[];this.Ct(e,50);for(let i of n)this.Dt(i,e)}Bt(t,e){this.Ct(e,37),O.fromName(t).path.forEach(n=>{this.Ct(e,60),this.$t(n,e)})}Ct(t,e){t.Ft(e)}Ot(t){t.Ft(2)}};he.Ut=new he;var xn=255;function kp(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function dd(r){let t=64-function(n){let i=0;for(let s=0;s<8;++s){let a=kp(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(t/8)}var ou=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Wt(n.value),n=e.next();this.Gt()}zt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.jt(n.value),n=e.next();this.Jt()}Ht(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Wt(n);else if(n<2048)this.Wt(960|n>>>6),this.Wt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Wt(480|n>>>12),this.Wt(128|63&n>>>6),this.Wt(128|63&n);else{let i=e.codePointAt(0);this.Wt(240|i>>>18),this.Wt(128|63&i>>>12),this.Wt(128|63&i>>>6),this.Wt(128|63&i)}}this.Gt()}Yt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.jt(n);else if(n<2048)this.jt(960|n>>>6),this.jt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.jt(480|n>>>12),this.jt(128|63&n>>>6),this.jt(128|63&n);else{let i=e.codePointAt(0);this.jt(240|i>>>18),this.jt(128|63&i>>>12),this.jt(128|63&i>>>6),this.jt(128|63&i)}}this.Jt()}Zt(t){let e=this.Xt(t),n=dd(e);this.en(1+n),this.buffer[this.position++]=255&n;for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=255&e[i]}tn(t){let e=this.Xt(t),n=dd(e);this.en(1+n),this.buffer[this.position++]=~(255&n);for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}nn(){this.rn(xn),this.rn(255)}sn(){this._n(xn),this._n(255)}reset(){this.position=0}seed(t){this.en(t.length),this.buffer.set(t,this.position),this.position+=t.length}an(){return this.buffer.slice(0,this.position)}Xt(t){let e=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let i=1;i<e.length;++i)e[i]^=n?255:0;return e}Wt(t){let e=255&t;e===0?(this.rn(0),this.rn(255)):e===xn?(this.rn(xn),this.rn(0)):this.rn(e)}jt(t){let e=255&t;e===0?(this._n(0),this._n(255)):e===xn?(this._n(xn),this._n(0)):this._n(t)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(t){this.en(1),this.buffer[this.position++]=t}_n(t){this.en(1),this.buffer[this.position++]=~t}en(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},au=class{constructor(t){this.un=t}Nt(t){this.un.Kt(t)}Mt(t){this.un.Ht(t)}Ft(t){this.un.Zt(t)}vt(){this.un.nn()}},uu=class{constructor(t){this.un=t}Nt(t){this.un.zt(t)}Mt(t){this.un.Yt(t)}Ft(t){this.un.tn(t)}vt(){this.un.sn()}},on=class{constructor(){this.un=new ou,this.cn=new au(this.un),this.ln=new uu(this.un)}seed(t){this.un.seed(t)}hn(t){return t===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}};var an=class r{constructor(t,e,n,i){this.Pn=t,this.Tn=e,this.In=n,this.dn=i}En(){let t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.dn,0),e!==t?n.set([0],this.dn.length):++n[n.length-1],new r(this.Pn,this.Tn,this.In,n)}An(t,e,n){return{indexId:this.Pn,uid:t,arrayValue:hs(this.In),directionalValue:hs(this.dn),orderedDocumentKey:hs(e),documentKey:n.path.toArray()}}Rn(t,e,n){let i=this.An(t,e,n);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}};function be(r,t){let e=r.Pn-t.Pn;return e!==0?e:(e=fd(r.In,t.In),e!==0?e:(e=fd(r.dn,t.dn),e!==0?e:O.comparator(r.Tn,t.Tn)))}function fd(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function hs(r){return ia()?function(e){let n="";for(let i=0;i<e.length;i++)n+=String.fromCharCode(e[i]);return n}(r):r}function md(r){return typeof r!="string"?r:function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(r)}var Fs=class{constructor(t){this.Vn=new et((e,n)=>Tt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.mn=t.orderBy,this.fn=[];for(let e of t.filters){let n=e;n.isInequality()?this.Vn=this.Vn.add(n):this.fn.push(n)}}get gn(){return this.Vn.size>1}pn(t){if(q(t.collectionGroup===this.collectionId,49279),this.gn)return!1;let e=Sa(t);if(e!==void 0&&!this.yn(e))return!1;let n=en(t),i=new Set,s=0,a=0;for(;s<n.length&&this.yn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Vn.size>0){let u=this.Vn.getIterator().getNext();if(!i.has(u.field.canonicalString())){let l=n[s];if(!this.wn(u,l)||!this.Sn(this.mn[a++],l))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.mn.length||!this.Sn(this.mn[a++],u))return!1}return!0}bn(){if(this.gn)return null;let t=new et(Tt.comparator),e=[];for(let n of this.fn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new Bn(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new Bn(n.field,0))}for(let n of this.mn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new Bn(n.field,n.dir==="asc"?0:1)));return new Qn(Qn.UNKNOWN_ID,this.collectionId,e,ni.empty())}yn(t){for(let e of this.fn)if(this.wn(e,t))return!0;return!1}wn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}Sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function em(r){var t,e;if(q(r instanceof Q||r instanceof tt,20012),r instanceof Q){if(r instanceof bs){let i=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>Q.create(r.field,"==",s)))||[];return tt.create(i,"or")}return r}let n=r.filters.map(i=>em(i));return tt.create(n,r.op)}function Fp(r){if(r.getFilters().length===0)return[];let t=hu(em(r));return q(nm(t),7391),cu(t)||lu(t)?[t]:t.getFilters()}function cu(r){return r instanceof Q}function lu(r){return r instanceof tt&&Fc(r)}function nm(r){return cu(r)||lu(r)||function(e){if(e instanceof tt&&Ma(e)){for(let n of e.getFilters())if(!cu(n)&&!lu(n))return!1;return!0}return!1}(r)}function hu(r){if(q(r instanceof Q||r instanceof tt,34018),r instanceof Q)return r;if(r.filters.length===1)return hu(r.filters[0]);let t=r.filters.map(n=>hu(n)),e=tt.create(t,r.op);return e=Os(e),nm(e)?e:(q(e instanceof tt,64498),q(er(e),40251),q(e.filters.length>1,57927),e.filters.reduce((n,i)=>Bc(n,i)))}function Bc(r,t){let e;return q(r instanceof Q||r instanceof tt,38388),q(t instanceof Q||t instanceof tt,25473),e=r instanceof Q?t instanceof Q?function(i,s){return tt.create([i,s],"and")}(r,t):gd(r,t):t instanceof Q?gd(t,r):function(i,s){if(q(i.filters.length>0&&s.filters.length>0,48005),er(i)&&er(s))return If(i,s.getFilters());let a=Ma(i)?i:s,u=Ma(i)?s:i,l=a.filters.map(d=>Bc(d,u));return tt.create(l,"or")}(r,t),Os(e)}function gd(r,t){if(er(t))return If(t,r.getFilters());{let e=t.filters.map(n=>Bc(r,n));return tt.create(e,"or")}}function Os(r){if(q(r instanceof Q||r instanceof tt,11850),r instanceof Q)return r;let t=r.getFilters();if(t.length===1)return Os(t[0]);if(vf(r))return r;let e=t.map(i=>Os(i)),n=[];return e.forEach(i=>{i instanceof Q?n.push(i):i instanceof tt&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:tt.create(n,r.op)}var du=class{constructor(){this.Dn=new _i}addToCollectionParentIndex(t,e){return this.Dn.add(e),b.resolve()}getCollectionParents(t,e){return b.resolve(this.Dn.getEntries(e))}addFieldIndex(t,e){return b.resolve()}deleteFieldIndex(t,e){return b.resolve()}deleteAllFieldIndexes(t){return b.resolve()}createTargetIndexes(t,e){return b.resolve()}getDocumentsMatchingTarget(t,e){return b.resolve(null)}getIndexType(t,e){return b.resolve(0)}getFieldIndexes(t,e){return b.resolve([])}getNextCollectionGroupToUpdate(t){return b.resolve(null)}getMinOffset(t,e){return b.resolve(zt.min())}getMinOffsetFromCollectionGroup(t,e){return b.resolve(zt.min())}updateCollectionGroup(t,e,n){return b.resolve()}updateIndexEntries(t,e){return b.resolve()}},_i=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new et(H.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new et(H.comparator)).toArray()}};var pd="IndexedDbIndexManager",es=new Uint8Array(0),fu=class{constructor(t,e){this.databaseId=e,this.vn=new _i,this.Cn=new Ht(n=>mn(n),(n,i)=>Vi(n,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){let n=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.vn.add(e)});let s={collectionId:n,parent:xt(i)};return yd(t).put(s)}return b.resolve()}getCollectionParents(t,e){let n=[],i=IDBKeyRange.bound([e,""],[$d(e),""],!1,!0);return yd(t).j(i).next(s=>{for(let a of s){if(a.collectionId!==e)break;n.push(Zt(a.parent))}return n})}addFieldIndex(t,e){let n=jr(t),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(e);delete i.indexId;let s=n.add(i);if(e.indexState){let a=Nn(t);return s.next(u=>{a.put(cd(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let n=jr(t),i=Nn(t),s=Dn(t);return n.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=jr(t),n=Dn(t),i=Nn(t);return e.Y().next(()=>n.Y()).next(()=>i.Y())}createTargetIndexes(t,e){return b.forEach(this.Fn(e),n=>this.getIndexType(t,n).next(i=>{if(i===0||i===1){let s=new Fs(n).bn();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let n=Dn(t),i=!0,s=new Map;return b.forEach(this.Fn(e),a=>this.Mn(t,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=K(),u=[];return b.forEach(s,(l,d)=>{D(pd,`Using index ${function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(l)} to execute ${mn(e)}`);let f=function(B,W){let Z=Sa(W);if(Z===void 0)return null;for(let $ of Rs(B,Z.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(d,l),g=function(B,W){let Z=new Map;for(let $ of en(W))for(let v of Rs(B,$.fieldPath))switch(v.op){case"==":case"in":Z.set($.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return Z.set($.fieldPath.canonicalString(),v.value),Array.from(Z.values())}return null}(d,l),_=function(B,W){let Z=[],$=!0;for(let v of en(W)){let p=v.kind===0?Hh(B,v.fieldPath,B.startAt):Xh(B,v.fieldPath,B.startAt);Z.push(p.value),$&&($=p.inclusive)}return new se(Z,$)}(d,l),S=function(B,W){let Z=[],$=!0;for(let v of en(W)){let p=v.kind===0?Xh(B,v.fieldPath,B.endAt):Hh(B,v.fieldPath,B.endAt);Z.push(p.value),$&&($=p.inclusive)}return new se(Z,$)}(d,l),x=this.xn(l,d,_),k=this.xn(l,d,S),N=this.On(l,d,g),z=this.Nn(l.indexId,f,x,_.inclusive,k,S.inclusive,N);return b.forEach(z,j=>n.H(j,e.limit).next(B=>{B.forEach(W=>{let Z=O.fromSegments(W.documentKey);a.has(Z)||(a=a.add(Z),u.push(Z))})}))}).next(()=>u)}return b.resolve(null)})}Fn(t){let e=this.Cn.get(t);return e||(t.filters.length===0?e=[t]:e=Fp(tt.create(t.filters,"and")).map(n=>$a(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.Cn.set(t,e),e)}Nn(t,e,n,i,s,a,u){let l=(e!=null?e.length:1)*Math.max(n.length,s.length),d=l/(e!=null?e.length:1),f=[];for(let g=0;g<l;++g){let _=e?this.Bn(e[g/d]):es,S=this.Ln(t,_,n[g%d],i),x=this.kn(t,_,s[g%d],a),k=u.map(N=>this.Ln(t,_,N,!0));f.push(...this.createRange(S,x,k))}return f}Ln(t,e,n,i){let s=new an(t,O.empty(),e,n);return i?s:s.En()}kn(t,e,n,i){let s=new an(t,O.empty(),e,n);return i?s.En():s}Mn(t,e){let n=new Fs(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let a=null;for(let u of s)n.pn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,i=this.Fn(e);return b.forEach(i,s=>this.Mn(t,s).next(a=>{a?n!==0&&a.fields.length<function(l){let d=new et(Tt.comparator),f=!1;for(let g of l.filters)for(let _ of g.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let g of l.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&i.length>1&&n===2?1:n)}qn(t,e){let n=new on;for(let i of en(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let a=n.hn(i.kind);he.Ut.bt(s,a)}return n.an()}Bn(t){let e=new on;return he.Ut.bt(t,e.hn(0)),e.an()}Qn(t,e){let n=new on;return he.Ut.bt(dn(this.databaseId,e),n.hn(function(s){let a=en(s);return a.length===0?0:a[a.length-1].kind}(t))),n.an()}On(t,e,n){if(n===null)return[];let i=[];i.push(new on);let s=0;for(let a of en(t)){let u=n[s++];for(let l of i)if(this.$n(e,a.fieldPath)&&li(u))i=this.Un(i,a,u);else{let d=l.hn(a.kind);he.Ut.bt(u,d)}}return this.Kn(i)}xn(t,e,n){return this.On(t,e,n.position)}Kn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].an();return e}Un(t,e,n){let i=[...t],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let l=new on;l.seed(u.an()),he.Ut.bt(a,l.hn(e.kind)),s.push(l)}return s}$n(t,e){return!!t.filters.find(n=>n instanceof Q&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=jr(t),i=Nn(t);return(e?n.j(Da,IDBKeyRange.bound(e,e)):n.j()).next(s=>{let a=[];return b.forEach(s,u=>i.get([u.indexId,this.uid]).next(l=>{a.push(function(f,g){let _=g?new ni(g.sequenceNumber,new zt(yn(g.readTime),new O(Zt(g.documentKey)),g.largestBatchId)):ni.empty(),S=f.fields.map(([x,k])=>new Bn(Tt.fromServerFormat(x),k));return new Qn(f.indexId,f.collectionGroup,S,_)}(u,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:G(n.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let i=jr(t),s=Nn(t);return this.Wn(t).next(a=>i.j(Da,IDBKeyRange.bound(e,e)).next(u=>b.forEach(u,l=>s.put(cd(l.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return b.forEach(e,(i,s)=>{let a=n.get(i.collectionGroup);return(a?b.resolve(a):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),b.forEach(u,l=>this.Gn(t,i,l).next(d=>{let f=this.zn(s,l);return d.isEqual(f)?b.resolve():this.jn(t,s,l,d,f)}))))})}Jn(t,e,n,i){return Dn(t).put(i.An(this.uid,this.Qn(n,e.key),e.key))}Hn(t,e,n,i){return Dn(t).delete(i.Rn(this.uid,this.Qn(n,e.key),e.key))}Gn(t,e,n){let i=Dn(t),s=new et(be);return i.X({index:sf,range:IDBKeyRange.only([n.indexId,this.uid,hs(this.Qn(n,e))])},(a,u)=>{s=s.add(new an(n.indexId,e,md(u.arrayValue),md(u.directionalValue)))}).next(()=>s)}zn(t,e){let n=new et(be),i=this.qn(e,t);if(i==null)return n;let s=Sa(e);if(s!=null){let a=t.data.field(s.fieldPath);if(li(a))for(let u of a.arrayValue.values||[])n=n.add(new an(e.indexId,t.key,this.Bn(u),i))}else n=n.add(new an(e.indexId,t.key,es,i));return n}jn(t,e,n,i,s){D(pd,"Updating index entries for document '%s'",e.key);let a=[];return function(l,d,f,g,_){let S=l.getIterator(),x=d.getIterator(),k=Cn(S),N=Cn(x);for(;k||N;){let z=!1,j=!1;if(k&&N){let B=f(k,N);B<0?j=!0:B>0&&(z=!0)}else k!=null?j=!0:z=!0;z?(g(N),N=Cn(x)):j?(_(k),k=Cn(S)):(k=Cn(S),N=Cn(x))}}(i,s,be,u=>{a.push(this.Jn(t,e,n,u))},u=>{a.push(this.Hn(t,e,n,u))}),b.waitFor(a)}Wn(t){let e=1;return Nn(t).X({index:rf,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>be(a,u)).filter((a,u,l)=>!u||be(a,l[u-1])!==0);let i=[];i.push(t);for(let a of n){let u=be(a,t),l=be(a,e);if(u===0)i[0]=t.En();else if(u>0&&l<0)i.push(a),i.push(a.En());else if(l>0)break}i.push(e);let s=[];for(let a=0;a<i.length;a+=2){if(this.Yn(i[a],i[a+1]))return[];let u=i[a].Rn(this.uid,es,O.empty()),l=i[a+1].Rn(this.uid,es,O.empty());s.push(IDBKeyRange.bound(u,l))}return s}Yn(t,e){return be(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(_d)}getMinOffset(t,e){return b.mapArray(this.Fn(e),n=>this.Mn(t,n).next(i=>i||L(44426))).next(_d)}};function yd(r){return It(r,oi)}function Dn(r){return It(r,Hr)}function jr(r){return It(r,Cc)}function Nn(r){return It(r,Wr)}function _d(r){q(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;Rc(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new zt(t.readTime,t.documentKey,e)}var wd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},rm=41943040,Ot=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};function im(r,t,e){let n=r.store(Kt),i=r.store(Wn),s=[],a=IDBKeyRange.only(e.batchId),u=0,l=n.X({range:a},(f,g,_)=>(u++,_.delete()));s.push(l.next(()=>{q(u===1,47070,{batchId:e.batchId})}));let d=[];for(let f of e.mutations){let g=tf(t,f.key.path,e.batchId);s.push(i.delete(g)),d.push(f.key)}return b.waitFor(s).next(()=>d)}function Ms(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw L(14731);t=r.noDocument}return JSON.stringify(t).length}Ot.DEFAULT_COLLECTION_PERCENTILE=10,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ot.DEFAULT=new Ot(rm,Ot.DEFAULT_COLLECTION_PERCENTILE,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ot.DISABLED=new Ot(-1,0,0);var Ls=class r{constructor(t,e,n,i){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=i,this.Zn={}}static yt(t,e,n,i){q(t.uid!=="",64387);let s=t.isAuthenticated()?t.uid:"";return new r(s,e,n,i)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Se(t).X({index:un,range:n},(i,s,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,i){let s=qn(t),a=Se(t);return a.add({}).next(u=>{q(typeof u=="number",49019);let l=new di(u,e,n,i),d=function(S,x,k){let N=k.baseMutations.map(j=>yi(S.gt,j)),z=k.mutations.map(j=>yi(S.gt,j));return{userId:x,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:N,mutations:z}}(this.serializer,this.userId,l),f=[],g=new et((_,S)=>G(_.canonicalString(),S.canonicalString()));for(let _ of i){let S=tf(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(d)),f.push(s.put(S,Fg))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(t,_))}),t.addOnCommittedListener(()=>{this.Zn[u]=l.keys()}),b.waitFor(f).next(()=>l)})}lookupMutationBatch(t,e){return Se(t).get(e).next(n=>n?(q(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),sn(this.serializer,n)):null)}Xn(t,e){return this.Zn[e]?b.resolve(this.Zn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let i=n.keys();return this.Zn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Se(t).X({index:un,range:i},(a,u,l)=>{u.userId===this.userId&&(q(u.batchId>=n,47524,{er:n}),s=sn(this.serializer,u)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=xe;return Se(t).X({index:un,range:e,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,xe],[this.userId,Number.POSITIVE_INFINITY]);return Se(t).j(un,e).next(n=>n.map(i=>sn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=ss(this.userId,e.path),i=IDBKeyRange.lowerBound(n),s=[];return qn(t).X({range:i},(a,u,l)=>{let[d,f,g]=a,_=Zt(f);if(d===this.userId&&e.path.isEqual(_))return Se(t).get(g).next(S=>{if(!S)throw L(61480,{tr:a,batchId:g});q(S.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:S.userId,batchId:g}),s.push(sn(this.serializer,S))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(G),i=[];return e.forEach(s=>{let a=ss(this.userId,s.path),u=IDBKeyRange.lowerBound(a),l=qn(t).X({range:u},(d,f,g)=>{let[_,S,x]=d,k=Zt(S);_===this.userId&&s.path.isEqual(k)?n=n.add(x):g.done()});i.push(l)}),b.waitFor(i).next(()=>this.nr(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=ss(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new et(G);return qn(t).X({range:a},(l,d,f)=>{let[g,_,S]=l,x=Zt(_);g===this.userId&&n.isPrefixOf(x)?x.length===i&&(u=u.add(S)):f.done()}).next(()=>this.nr(t,u))}nr(t,e){let n=[],i=[];return e.forEach(s=>{i.push(Se(t).get(s).next(a=>{if(a===null)throw L(35274,{batchId:s});q(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:s}),n.push(sn(this.serializer,a))}))}),b.waitFor(i).next(()=>n)}removeMutationBatch(t,e){return im(t.ce,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.rr(e.batchId)}),b.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}rr(t){delete this.Zn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return b.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return qn(t).X({range:n},(s,a,u)=>{if(s[0]===this.userId){let l=Zt(s[1]);i.push(l)}else u.done()}).next(()=>{q(i.length===0,56720,{ir:i.map(s=>s.canonicalString())})})})}containsKey(t,e){return sm(t,this.userId,e)}sr(t){return om(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:xe,lastStreamToken:""})}};function sm(r,t,e){let n=ss(t,e.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return qn(r).X({range:s,Z:!0},(u,l,d)=>{let[f,g,_]=u;f===t&&g===i&&(a=!0),d.done()}).next(()=>a)}function Se(r){return It(r,Kt)}function qn(r){return It(r,Wn)}function om(r){return It(r,ii)}var or=class r{constructor(t){this._r=t}next(){return this._r+=2,this._r}static ar(){return new r(0)}static ur(){return new r(-1)}};var mu=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.cr(t).next(e=>{let n=new or(e.highestTargetId);return e.highestTargetId=n.next(),this.lr(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.cr(t).next(e=>U.fromTimestamp(new ot(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.cr(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.cr(t).next(i=>(i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.lr(t,i)))}addTargetData(t,e){return this.hr(t,e).next(()=>this.cr(t).next(n=>(n.targetCount+=1,this.Pr(e,n),this.lr(t,n))))}updateTargetData(t,e){return this.hr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>kn(t).delete(e.targetId)).next(()=>this.cr(t)).next(n=>(q(n.targetCount>0,8065),n.targetCount-=1,this.lr(t,n)))}removeTargets(t,e,n){let i=0,s=[];return kn(t).X((a,u)=>{let l=$r(u);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(t,l)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(t,e){return kn(t).X((n,i)=>{let s=$r(i);e(s)})}cr(t){return vd(t).get(vs).next(e=>(q(e!==null,2888),e))}lr(t,e){return vd(t).put(vs,e)}hr(t,e){return kn(t).put(tm(this.serializer,e))}Pr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.cr(t).next(e=>e.targetCount)}getTargetData(t,e){let n=mn(e),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return kn(t).X({range:i,index:nf},(a,u,l)=>{let d=$r(u);Vi(e,d.target)&&(s=d,l.done())}).next(()=>s)}addMatchingKeys(t,e,n){let i=[],s=Pe(t);return e.forEach(a=>{let u=xt(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(t,n,a))}),b.waitFor(i)}removeMatchingKeys(t,e,n){let i=Pe(t);return b.forEach(e,s=>{let a=xt(s.path);return b.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(t,n,s)])})}removeMatchingKeysForTargetId(t,e){let n=Pe(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),i=Pe(t),s=K();return i.X({range:n,Z:!0},(a,u,l)=>{let d=Zt(a[1]),f=new O(d);s=s.add(f)}).next(()=>s)}containsKey(t,e){let n=xt(e.path),i=IDBKeyRange.bound([n],[$d(n)],!1,!0),s=0;return Pe(t).X({index:Vc,Z:!0,range:i},([a,u],l,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}Et(t,e){return kn(t).get(e).next(n=>n?$r(n):null)}};function kn(r){return It(r,Hn)}function vd(r){return It(r,hn)}function Pe(r){return It(r,Xn)}var Td="LruGarbageCollector",Op=1048576;function Id([r,t],[e,n]){let i=G(r,e);return i===0?G(t,n):i}var gu=class{constructor(t){this.Tr=t,this.buffer=new et(Id),this.Ir=0}dr(){return++this.Ir}Er(t){let e=[t,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();Id(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},qs=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(t){D(Td,`Garbage collection scheduled in ${t}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>V(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){$e(e)?D(Td,"Ignoring IndexedDB error during garbage collection: ",e):yield Ke(e)}yield this.Rr(3e5)}))}},pu=class{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.mr(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return b.resolve(Ut.ue);let n=new gu(e);return this.Vr.forEachTarget(t,i=>n.Er(i.sequenceNumber)).next(()=>this.Vr.gr(t,i=>n.Er(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Vr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(wd)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),wd):this.pr(t,e))}getCacheSize(t){return this.Vr.getCacheSize(t)}pr(t,e){let n,i,s,a,u,l,d,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(t,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(s=g,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(d=Date.now(),Fn()<=Jt.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(l-u)+`ms
	Removed ${g} documents in `+(d-l)+`ms
Total Duration: ${d-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};function am(r,t){return new pu(r,t)}var yu=class{constructor(t,e){this.db=t,this.garbageCollector=am(this,e)}mr(t){let e=this.yr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}yr(t){let e=0;return this.gr(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}gr(t,e){return this.wr(t,(n,i)=>e(i))}addReference(t,e,n){return ns(t,n)}removeReference(t,e,n){return ns(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return ns(t,e)}Sr(t,e){return function(i,s){let a=!1;return om(i).ee(u=>sm(i,u,s).next(l=>(l&&(a=!0),b.resolve(!l)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.wr(t,(a,u)=>{if(u<=e){let l=this.Sr(t,a).next(d=>{if(!d)return s++,n.getEntry(t,a).next(()=>(n.removeEntry(a,U.min()),Pe(t).delete(function(g){return[0,xt(g.path)]}(a))))});i.push(l)}}).next(()=>b.waitFor(i)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return ns(t,e)}wr(t,e){let n=Pe(t),i,s=Ut.ue;return n.X({index:Vc},([a,u],{path:l,sequenceNumber:d})=>{a===0?(s!==Ut.ue&&e(new O(Zt(i)),s),s=d,i=l):s=Ut.ue}).next(()=>{s!==Ut.ue&&e(new O(Zt(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function ns(r,t){return Pe(r).put(function(n,i){return{targetId:0,path:xt(n.path),sequenceNumber:i}}(t,r.currentSequenceNumber))}var Us=class{constructor(){this.changes=new Ht(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,_t.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?b.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var _u=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return tn(t).put(n)}removeEntry(t,e,n){return tn(t).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ns(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.br(t,n)))}getEntry(t,e){let n=_t.newInvalidDocument(e);return tn(t).X({index:os,range:IDBKeyRange.only(zr(e))},(i,s)=>{n=this.Dr(e,s)}).next(()=>n)}vr(t,e){let n={size:0,document:_t.newInvalidDocument(e)};return tn(t).X({index:os,range:IDBKeyRange.only(zr(e))},(i,s)=>{n={document:this.Dr(e,s),size:Ms(s)}}).next(()=>n)}getEntries(t,e){let n=Mt();return this.Cr(t,e,(i,s)=>{let a=this.Dr(i,s);n=n.insert(i,a)}).next(()=>n)}Fr(t,e){let n=Mt(),i=new it(O.comparator);return this.Cr(t,e,(s,a)=>{let u=this.Dr(s,a);n=n.insert(s,u),i=i.insert(s,Ms(a))}).next(()=>({documents:n,Mr:i}))}Cr(t,e,n){if(e.isEmpty())return b.resolve();let i=new et(bd);e.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(zr(i.first()),zr(i.last())),a=i.getIterator(),u=a.getNext();return tn(t).X({index:os,range:s},(l,d,f)=>{let g=O.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&bd(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.G(zr(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,i,s){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),Ns(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return tn(t).j(IDBKeyRange.bound(u,l,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=Mt();for(let g of d){let _=this.Dr(O.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(xi(e,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(t,e,n,i){let s=Mt(),a=Ad(e,n),u=Ad(e,zt.max());return tn(t).X({index:ef,range:IDBKeyRange.bound(a,u,!0)},(l,d,f)=>{let g=this.Dr(O.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new wu(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Ed(t).get(xa).next(e=>(q(!!e,20021),e))}br(t,e){return Ed(t).put(xa,e)}Dr(t,e){if(e){let n=Np(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(U.min())))return n}return _t.newInvalidDocument(t)}};function um(r){return new _u(r)}var wu=class extends Us{constructor(t,e){super(),this.Or=t,this.trackRemovals=e,this.Nr=new Ht(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(t){let e=[],n=0,i=new et((s,a)=>G(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.Nr.get(s);if(e.push(this.Or.removeEntry(t,s,u.readTime)),a.isValidDocument()){let l=ad(this.Or.serializer,a);i=i.add(s.path.popLast());let d=Ms(l);n+=d-u.size,e.push(this.Or.addEntry(t,s,l))}else if(n-=u.size,this.trackRemovals){let l=ad(this.Or.serializer,a.convertToNoDocument(U.min()));e.push(this.Or.addEntry(t,s,l))}}),i.forEach(s=>{e.push(this.Or.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.Or.updateMetadata(t,n)),b.waitFor(e)}getFromCache(t,e){return this.Or.vr(t,e).next(n=>(this.Nr.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.Or.Fr(t,e).next(({documents:n,Mr:i})=>(i.forEach((s,a)=>{this.Nr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function Ed(r){return It(r,si)}function tn(r){return It(r,ws)}function zr(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Ad(r,t){let e=t.documentKey.path.toArray();return[r,Ns(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function bd(r,t){let e=r.path.toArray(),n=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<n.length-2;++s)if(i=G(e[s],n[s]),i)return i;return i=G(e.length,n.length),i||(i=G(e[e.length-2],n[n.length-2]),i||G(e[e.length-1],n[n.length-1]))}var vu=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Bs=class{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(n!==null&&Yr(n.mutation,i,Bt.empty(),ot.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,K()).next(()=>n))}getLocalViewOfDocuments(t,e,n=K()){let i=te();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(s=>{let a=Kr();return s.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=te();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,K()))}populateOverlays(t,e,n){let i=[];return n.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,i){let s=Mt(),a=Jr(),u=function(){return Jr()}();return e.forEach((l,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof Xt)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Yr(f.mutation,d,f.mutation.getFieldMask(),ot.now())):a.set(d.key,Bt.empty())}),this.recalculateAndSaveOverlays(t,s).next(l=>(l.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var g;return u.set(d,new vu(f,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(t,e){let n=Jr(),i=new it((a,u)=>a-u),s=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=e.get(l);if(d===null)return;let f=n.get(l)||Bt.empty();f=u.applyToLocalView(d,f),n.set(l,f);let g=(i.get(u.batchId)||K()).add(l);i=i.insert(u.batchId,g)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,f=l.value,g=xf();f.forEach(_=>{if(!s.has(_)){let S=Lf(e.get(_),n.get(_));S!==null&&g.set(_,S),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return b.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return function(a){return O.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Oc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):b.resolve(te()),u=$n,l=s;return a.next(d=>b.forEach(d,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?b.resolve():this.remoteDocumentCache.getEntry(t,f).next(_=>{l=l.insert(f,_)}))).next(()=>this.populateOverlays(t,d,s)).next(()=>this.computeViews(t,l,d,K())).next(f=>({batchId:u,changes:Cf(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new O(e)).next(n=>{let i=Kr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){let s=e.collectionGroup,a=Kr();return this.indexManager.getCollectionParents(t,s).next(u=>b.forEach(u,l=>{let d=function(g,_){return new Wt(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(e,l.child(s));return this.getDocumentsMatchingCollectionQuery(t,d,n,i).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(a=>{s.forEach((l,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,_t.newInvalidDocument(f)))});let u=Kr();return a.forEach((l,d)=>{let f=s.get(l);f!==void 0&&Yr(f.mutation,d,Bt.empty(),ot.now()),xi(e,d)&&(u=u.insert(l,d))}),u})}};var Tu=class{constructor(t){this.serializer=t,this.Br=new Map,this.Lr=new Map}getBundleMetadata(t,e){return b.resolve(this.Br.get(e))}saveBundleMetadata(t,e){return this.Br.set(e.id,function(i){return{id:i.id,version:i.version,createTime:dt(i.createTime)}}(e)),b.resolve()}getNamedQuery(t,e){return b.resolve(this.Lr.get(e))}saveNamedQuery(t,e){return this.Lr.set(e.name,function(i){return{name:i.name,query:Uc(i.bundledQuery),readTime:dt(i.readTime)}}(e)),b.resolve()}};var Iu=class{constructor(){this.overlays=new it(O.comparator),this.kr=new Map}getOverlay(t,e){return b.resolve(this.overlays.get(e))}getOverlays(t,e){let n=te();return b.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,s)=>{this.wt(t,e,s)}),b.resolve()}removeOverlaysForBatchId(t,e,n){let i=this.kr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(n)),b.resolve()}getOverlaysForCollection(t,e,n){let i=te(),s=e.length+1,a=new O(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>n&&i.set(l.getKey(),l)}return b.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new it((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=te(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=te(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return b.resolve(u)}wt(t,e,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.kr.get(i.largestBatchId).delete(n.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new fi(e,n));let s=this.kr.get(e);s===void 0&&(s=K(),this.kr.set(e,s)),this.kr.set(e,s.add(n.key))}};var Eu=class{constructor(){this.sessionToken=ft.EMPTY_BYTE_STRING}getSessionToken(t){return b.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,b.resolve()}};var wi=class{constructor(){this.qr=new et(gt.Qr),this.$r=new et(gt.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(t,e){let n=new gt(t,e);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Wr(new gt(t,e))}Gr(t,e){t.forEach(n=>this.removeReference(n,e))}zr(t){let e=new O(new H([])),n=new gt(e,t),i=new gt(e,t+1),s=[];return this.$r.forEachInRange([n,i],a=>{this.Wr(a),s.push(a.key)}),s}jr(){this.qr.forEach(t=>this.Wr(t))}Wr(t){this.qr=this.qr.delete(t),this.$r=this.$r.delete(t)}Jr(t){let e=new O(new H([])),n=new gt(e,t),i=new gt(e,t+1),s=K();return this.$r.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(t){let e=new gt(t,0),n=this.qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},gt=class{constructor(t,e){this.key=t,this.Hr=e}static Qr(t,e){return O.comparator(t.key,e.key)||G(t.Hr,e.Hr)}static Ur(t,e){return G(t.Hr,e.Hr)||O.comparator(t.key,e.key)}};var Au=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.er=1,this.Yr=new et(gt.Qr)}checkEmpty(t){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new di(s,e,n,i);this.mutationQueue.push(a);for(let u of i)this.Yr=this.Yr.add(new gt(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return b.resolve(a)}lookupMutationBatch(t,e){return b.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=this.Xr(n),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?xe:this.er-1)}getAllMutationBatches(t){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new gt(e,0),i=new gt(e,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([n,i],a=>{let u=this.Zr(a.Hr);s.push(u)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(G);return e.forEach(i=>{let s=new gt(i,0),a=new gt(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,a],u=>{n=n.add(u.Hr)})}),b.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=n;O.isDocumentKey(s)||(s=s.child(""));let a=new gt(new O(s),0),u=new et(G);return this.Yr.forEachWhile(l=>{let d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(l.Hr)),!0)},a),b.resolve(this.ei(u))}ei(t){let e=[];return t.forEach(n=>{let i=this.Zr(n);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){q(this.ti(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Yr;return b.forEach(e.mutations,i=>{let s=new gt(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.Yr=n})}rr(t){}containsKey(t,e){let n=new gt(e,0),i=this.Yr.firstAfterOrEqual(n);return b.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,b.resolve()}ti(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){let e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var bu=class{constructor(t){this.ni=t,this.docs=function(){return new it(O.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,i=this.docs.get(n),s=i?i.size:0,a=this.ni(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return b.resolve(n?n.document.mutableCopy():_t.newInvalidDocument(e))}getEntries(t,e){let n=Mt();return e.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():_t.newInvalidDocument(i))}),b.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=Mt(),a=e.path,u=new O(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:f}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Rc(Xd(f),n)<=0||(i.has(f.key)||xi(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(t,e,n,i){L(9500)}ri(t,e){return b.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new Su(this)}getSize(t){return b.resolve(this.size)}},Su=class extends Us{constructor(t){super(),this.Or=t}applyChanges(t){let e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.Or.addEntry(t,i)):this.Or.removeEntry(n)}),b.waitFor(e)}getFromCache(t,e){return this.Or.getEntry(t,e)}getAllFromCache(t,e){return this.Or.getEntries(t,e)}};var Ru=class{constructor(t){this.persistence=t,this.ii=new Ht(e=>mn(e),Vi),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.si=0,this.oi=new wi,this.targetCount=0,this._i=or.ar()}forEachTarget(t,e){return this.ii.forEach((n,i)=>e(i)),b.resolve()}getLastRemoteSnapshotVersion(t){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return b.resolve(this.si)}allocateTargetId(t){return this.highestTargetId=this._i.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.si&&(this.si=e),b.resolve()}hr(t){this.ii.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this._i=new or(e),this.highestTargetId=e),t.sequenceNumber>this.si&&(this.si=t.sequenceNumber)}addTargetData(t,e){return this.hr(e),this.targetCount+=1,b.resolve()}updateTargetData(t,e){return this.hr(e),b.resolve()}removeTargetData(t,e){return this.ii.delete(e.target),this.oi.zr(e.targetId),this.targetCount-=1,b.resolve()}removeTargets(t,e,n){let i=0,s=[];return this.ii.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.ii.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(t){return b.resolve(this.targetCount)}getTargetData(t,e){let n=this.ii.get(e)||null;return b.resolve(n)}addMatchingKeys(t,e,n){return this.oi.Kr(e,n),b.resolve()}removeMatchingKeys(t,e,n){this.oi.Gr(e,n);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(a=>{s.push(i.markPotentiallyOrphaned(t,a))}),b.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.oi.zr(e),b.resolve()}getMatchingKeysForTargetId(t,e){let n=this.oi.Jr(e);return b.resolve(n)}containsKey(t,e){return b.resolve(this.oi.containsKey(e))}};var vi=class{constructor(t,e){this.ai={},this.overlays={},this.ui=new Ut(0),this.ci=!1,this.ci=!0,this.li=new Eu,this.referenceDelegate=t(this),this.hi=new Ru(this),this.indexManager=new du,this.remoteDocumentCache=function(i){return new bu(i)}(n=>this.referenceDelegate.Pi(n)),this.serializer=new Ds(e),this.Ti=new Tu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Iu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ai[t.toKey()];return n||(n=new Au(e,this.referenceDelegate),this.ai[t.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(t,e,n){D("MemoryPersistence","Starting transaction:",t);let i=new Pu(this.ui.next());return this.referenceDelegate.Ii(),n(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(t,e){return b.or(Object.values(this.ai).map(n=>()=>n.containsKey(t,e)))}},Pu=class extends ps{constructor(t){super(),this.currentSequenceNumber=t}},js=class r{constructor(t){this.persistence=t,this.Ai=new wi,this.Ri=null}static Vi(t){return new r(t)}get mi(){if(this.Ri)return this.Ri;throw L(60996)}addReference(t,e,n){return this.Ai.addReference(n,e),this.mi.delete(n.toString()),b.resolve()}removeReference(t,e,n){return this.Ai.removeReference(n,e),this.mi.add(n.toString()),b.resolve()}markPotentiallyOrphaned(t,e){return this.mi.add(e.toString()),b.resolve()}removeTarget(t,e){this.Ai.zr(e.targetId).forEach(i=>this.mi.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>n.removeTargetData(t,e))}Ii(){this.Ri=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.mi,n=>{let i=O.fromPath(n);return this.fi(t,i).next(s=>{s||e.removeEntry(i,U.min())})}).next(()=>(this.Ri=null,e.apply(t)))}updateLimboDocument(t,e){return this.fi(t,e).next(n=>{n?this.mi.delete(e.toString()):this.mi.add(e.toString())})}Pi(t){return 0}fi(t,e){return b.or([()=>b.resolve(this.Ai.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}},zs=class r{constructor(t,e){this.persistence=t,this.gi=new Ht(n=>xt(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=am(this,e)}static Vi(t,e){return new r(t,e)}Ii(){}di(t){return b.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}mr(t){let e=this.yr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}yr(t){let e=0;return this.gr(t,n=>{e++}).next(()=>e)}gr(t,e){return b.forEach(this.gi,(n,i)=>this.Sr(t,n,i).next(s=>s?b.resolve():e(i)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(t,a=>this.Sr(t,a,e).next(u=>{u||(n++,s.removeEntry(a,U.min()))})).next(()=>s.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.gi.set(e,t.currentSequenceNumber),b.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.gi.set(n,t.currentSequenceNumber),b.resolve()}removeReference(t,e,n){return this.gi.set(n,t.currentSequenceNumber),b.resolve()}updateLimboDocument(t,e){return this.gi.set(e,t.currentSequenceNumber),b.resolve()}Pi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=us(t.data.value)),e}Sr(t,e,n){return b.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let i=this.gi.get(e);return b.resolve(i!==void 0&&i>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var Vu=class{constructor(t){this.serializer=t}q(t,e,n,i){let s=new ys("createOrUpgrade",e);n<1&&i>=1&&(function(l){l.createObjectStore(Pi)}(t),function(l){l.createObjectStore(ii,{keyPath:kg}),l.createObjectStore(Kt,{keyPath:Lh,autoIncrement:!0}).createIndex(un,qh,{unique:!0}),l.createObjectStore(Wn)}(t),Sd(t),function(l){l.createObjectStore(nn)}(t));let a=b.resolve();return n<3&&i>=3&&(n!==0&&(function(l){l.deleteObjectStore(Xn),l.deleteObjectStore(Hn),l.deleteObjectStore(hn)}(t),Sd(t)),a=a.next(()=>function(l){let d=l.store(hn),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:U.min().toTimestamp(),targetCount:0};return d.put(vs,f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(l,d){return d.store(Kt).j().next(g=>{l.deleteObjectStore(Kt),l.createObjectStore(Kt,{keyPath:Lh,autoIncrement:!0}).createIndex(un,qh,{unique:!0});let _=d.store(Kt),S=g.map(x=>_.put(x));return b.waitFor(S)})}(t,s))),a=a.next(()=>{(function(l){l.createObjectStore(Jn,{keyPath:zg})})(t)})),n<5&&i>=5&&(a=a.next(()=>this.pi(s))),n<6&&i>=6&&(a=a.next(()=>(function(l){l.createObjectStore(si)}(t),this.yi(s)))),n<7&&i>=7&&(a=a.next(()=>this.wi(s))),n<8&&i>=8&&(a=a.next(()=>this.Si(t,s))),n<9&&i>=9&&(a=a.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&i>=10&&(a=a.next(()=>this.bi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(l){l.createObjectStore(yo,{keyPath:Gg})})(t),function(l){l.createObjectStore(_o,{keyPath:Kg})}(t)})),n<12&&i>=12&&(a=a.next(()=>{(function(l){let d=l.createObjectStore(wo,{keyPath:Yg});d.createIndex(Na,Zg,{unique:!1}),d.createIndex(of,tp,{unique:!1})})(t)})),n<13&&i>=13&&(a=a.next(()=>function(l){let d=l.createObjectStore(ws,{keyPath:Og});d.createIndex(os,Mg),d.createIndex(ef,Lg)}(t)).next(()=>this.Di(t,s)).next(()=>t.deleteObjectStore(nn))),n<14&&i>=14&&(a=a.next(()=>this.Ci(t,s))),n<15&&i>=15&&(a=a.next(()=>function(l){l.createObjectStore(Cc,{keyPath:$g,autoIncrement:!0}).createIndex(Da,Qg,{unique:!1}),l.createObjectStore(Wr,{keyPath:Wg}).createIndex(rf,Hg,{unique:!1}),l.createObjectStore(Hr,{keyPath:Xg}).createIndex(sf,Jg,{unique:!1})}(t))),n<16&&i>=16&&(a=a.next(()=>{e.objectStore(Wr).clear()}).next(()=>{e.objectStore(Hr).clear()})),n<17&&i>=17&&(a=a.next(()=>{(function(l){l.createObjectStore(xc,{keyPath:ep})})(t)})),n<18&&i>=18&&ia()&&(a=a.next(()=>{e.objectStore(Wr).clear()}).next(()=>{e.objectStore(Hr).clear()})),a}yi(t){let e=0;return t.store(nn).X((n,i)=>{e+=Ms(i)}).next(()=>{let n={byteSize:e};return t.store(si).put(xa,n)})}pi(t){let e=t.store(ii),n=t.store(Kt);return e.j().next(i=>b.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,xe],[s.userId,s.lastAcknowledgedBatchId]);return n.j(un,a).next(u=>b.forEach(u,l=>{q(l.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});let d=sn(this.serializer,l);return im(t,s.userId,d).next(()=>{})}))}))}wi(t){let e=t.store(Xn),n=t.store(nn);return t.store(hn).get(vs).next(i=>{let s=[];return n.X((a,u)=>{let l=new H(a),d=function(g){return[0,xt(g)]}(l);s.push(e.get(d).next(f=>f?b.resolve():(g=>e.put({targetId:0,path:xt(g),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>b.waitFor(s))})}Si(t,e){t.createObjectStore(oi,{keyPath:jg});let n=e.store(oi),i=new _i,s=a=>{if(i.add(a)){let u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:xt(l)})}};return e.store(nn).X({Z:!0},(a,u)=>{let l=new H(a);return s(l.popLast())}).next(()=>e.store(Wn).X({Z:!0},([a,u,l],d)=>{let f=Zt(u);return s(f.popLast())}))}bi(t){let e=t.store(Hn);return e.X((n,i)=>{let s=$r(i),a=tm(this.serializer,s);return e.put(a)})}Di(t,e){let n=e.store(nn),i=[];return n.X((s,a)=>{let u=e.store(ws),l=function(g){return g.document?new O(H.fromString(g.document.name).popFirst(5)):g.noDocument?O.fromSegments(g.noDocument.path):g.unknownDocument?O.fromSegments(g.unknownDocument.path):L(36783)}(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>b.waitFor(i))}Ci(t,e){let n=e.store(Kt),i=um(this.serializer),s=new vi(js.Vi,this.serializer.gt);return n.j().next(a=>{let u=new Map;return a.forEach(l=>{var d;let f=(d=u.get(l.userId))!==null&&d!==void 0?d:K();sn(this.serializer,l).keys().forEach(g=>f=f.add(g)),u.set(l.userId,f)}),b.forEach(u,(l,d)=>{let f=new pt(d),g=ks.yt(this.serializer,f),_=s.getIndexManager(f),S=Ls.yt(f,this.serializer,_,s.referenceDelegate);return new Bs(i,S,g,_).recalculateAndSaveOverlaysForDocumentKeys(new ai(e,Ut.ue),l).next()})})}};function Sd(r){r.createObjectStore(Xn,{keyPath:Ug}).createIndex(Vc,Bg,{unique:!0}),r.createObjectStore(Hn,{keyPath:"targetId"}).createIndex(nf,qg,{unique:!0}),r.createObjectStore(hn)}var Re="IndexedDbPersistence",fa=18e5,ma=5e3,ga="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",cm="main",Cu=class r{constructor(t,e,n,i,s,a,u,l,d,f,g=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Fi=s,this.window=a,this.document=u,this.Mi=d,this.xi=f,this.Oi=g,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=_=>Promise.resolve(),!r.C())throw new C(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new yu(this,i),this.Qi=e+cm,this.serializer=new Ds(l),this.$i=new Fe(this.Qi,this.Oi,new Vu(this.serializer)),this.li=new su,this.hi=new mu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=um(this.serializer),this.Ti=new iu,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,f===!1&&ht(Re,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(R.FAILED_PRECONDITION,ga);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.hi.getHighestSequenceNumber(t))}).then(t=>{this.ui=new Ut(t,this.Mi)}).then(()=>{this.ci=!0}).catch(t=>(this.$i&&this.$i.close(),Promise.reject(t)))}ji(t){return this.qi=e=>V(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.$i.setDatabaseDeletedListener(t)}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Fi.enqueueAndForget(()=>V(this,null,function*(){this.started&&(yield this.Ki())})))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>rs(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(t).next(e=>{e||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(t)).next(e=>this.isPrimary&&!e?this.Yi(t).next(()=>!1):!!e&&this.Zi(t).next(()=>!0))).catch(t=>{if($e(t))return D(Re,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return D(Re,"Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Fi.enqueueRetryable(()=>this.qi(t)),this.isPrimary=t})}Ji(t){return Gr(t).get(Vn).next(e=>b.resolve(this.Xi(e)))}es(t){return rs(t).delete(this.clientId)}ts(){return V(this,null,function*(){if(this.isPrimary&&!this.ns(this.ki,fa)){this.ki=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=It(e,Jn);return n.j().next(i=>{let s=this.rs(i,fa),a=i.filter(u=>s.indexOf(u)===-1);return b.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ui)for(let e of t)this.Ui.removeItem(this.ss(e.clientId))}})}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(t){return!!t&&t.ownerId===this.clientId}Hi(t){return this.xi?b.resolve(!0):Gr(t).get(Vn).next(e=>{if(e!==null&&this.ns(e.leaseTimestampMs,ma)&&!this._s(e.ownerId)){if(this.Xi(e)&&this.networkEnabled)return!0;if(!this.Xi(e)){if(!e.allowTabSynchronization)throw new C(R.FAILED_PRECONDITION,ga);return!1}}return!(!this.networkEnabled||!this.inForeground)||rs(t).j().next(n=>this.rs(n,ma).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&D(Re,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return V(this,null,function*(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),yield this.$i.runTransaction("shutdown","readwrite",[Pi,Jn],t=>{let e=new ai(t,Ut.ue);return this.Yi(e).next(()=>this.es(e))}),this.$i.close(),this.hs()})}rs(t,e){return t.filter(n=>this.ns(n.updateTimeMs,e)&&!this._s(n.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",t=>rs(t).j().next(e=>this.rs(e,fa).map(n=>n.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(t,e){return Ls.yt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new fu(t,this.serializer.gt.databaseId)}getDocumentOverlayCache(t){return ks.yt(this.serializer,t)}getBundleCache(){return this.Ti}runTransaction(t,e,n){D(Re,"Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(l){return l===18?ip:l===17?lf:l===16?rp:l===15?Dc:l===14?cf:l===13?uf:l===12?np:l===11?af:void L(60245)}(this.Oi),a;return this.$i.runTransaction(t,i,s,u=>(a=new ai(u,this.ui?this.ui.next():Ut.ue),e==="readwrite-primary"?this.Ji(a).next(l=>!!l||this.Hi(a)).next(l=>{if(!l)throw ht(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new C(R.FAILED_PRECONDITION,Jd);return n(a)}).next(l=>this.Zi(a).next(()=>l)):this.Ts(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ts(t){return Gr(t).get(Vn).next(e=>{if(e!==null&&this.ns(e.leaseTimestampMs,ma)&&!this._s(e.ownerId)&&!this.Xi(e)&&!(this.xi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new C(R.FAILED_PRECONDITION,ga)})}Zi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Gr(t).put(Vn,e)}static C(){return Fe.C()}Yi(t){let e=Gr(t);return e.get(Vn).next(n=>this.Xi(n)?(D(Re,"Releasing primary lease."),e.delete(Vn)):b.resolve())}ns(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(ht(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Ni=()=>{this.us();let e=/(?:Version|Mobile)\/1[456]/;ra()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(t){var e;try{let n=((e=this.Ui)===null||e===void 0?void 0:e.getItem(this.ss(t)))!==null;return D(Re,`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ht(Re,"Failed to get zombied client id.",n),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(t){ht("Failed to set zombie client id.",t)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function Gr(r){return It(r,Pi)}function rs(r){return It(r,Jn)}function jc(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var xu=class r{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Is=n,this.ds=i}static Es(t,e){let n=K(),i=K();for(let s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(t,e.fromCache,n,i)}};var Du=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Gs=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return ra()?8:Yd(qr())>0?6:4}()}initialize(t,e){this.gs=t,this.indexManager=e,this.As=!0}getDocumentsMatchingQuery(t,e,n,i){let s={result:null};return this.ps(t,e).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ys(t,e,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Du;return this.ws(t,e,a).next(u=>{if(s.result=u,this.Rs)return this.Ss(t,e,a,u.size)})}).next(()=>s.result)}Ss(t,e,n,i){return n.documentReadCount<this.Vs?(Fn()<=Jt.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",On(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),b.resolve()):(Fn()<=Jt.DEBUG&&D("QueryEngine","Query:",On(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.fs*i?(Fn()<=Jt.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",On(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,kt(e))):b.resolve())}ps(t,e){if(Jh(e))return b.resolve(null);let n=kt(e);return this.indexManager.getIndexType(t,n).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=Ps(e,null,"F"),n=kt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{let a=K(...s);return this.gs.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(l=>{let d=this.bs(e,u);return this.Ds(e,d,a,l.readTime)?this.ps(t,Ps(e,null,"F")):this.vs(t,d,e,l)}))})))}ys(t,e,n,i){return Jh(e)||i.isEqual(U.min())?b.resolve(null):this.gs.getDocuments(t,n).next(s=>{let a=this.bs(e,s);return this.Ds(e,a,n,i)?b.resolve(null):(Fn()<=Jt.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),On(e)),this.vs(t,a,e,Hd(i,$n)).next(u=>u))})}bs(t,e){let n=new et(Pf(t));return e.forEach((i,s)=>{xi(t,s)&&(n=n.add(s))}),n}Ds(t,e,n,i){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(t,e,n){return Fn()<=Jt.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",On(e)),this.gs.getDocumentsMatchingQuery(t,e,zt.min(),n)}vs(t,e,n,i){return this.gs.getDocumentsMatchingQuery(t,n,i).next(s=>(e.forEach(a=>{s=s.insert(a.key,a)}),s))}};var zc="LocalStore",Mp=3e8,Nu=class{constructor(t,e,n,i){this.persistence=t,this.Cs=e,this.serializer=i,this.Fs=new it(G),this.Ms=new Ht(s=>mn(s),Vi),this.xs=new Map,this.Os=t.getRemoteDocumentCache(),this.hi=t.getTargetCache(),this.Ti=t.getBundleCache(),this.Ns(n)}Ns(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Bs(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Fs))}};function lm(r,t,e,n){return new Nu(r,t,e,n)}function hm(r,t){return V(this,null,function*(){let e=M(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,e.Ns(t),e.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],l=K();for(let d of i){a.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}return e.localDocuments.getDocuments(n,l).next(d=>({Bs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function Lp(r,t){let e=M(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=t.batch.keys(),s=e.Os.newChangeBuffer({trackRemovals:!0});return function(u,l,d,f){let g=d.batch,_=g.keys(),S=b.resolve();return _.forEach(x=>{S=S.next(()=>f.getEntry(l,x)).next(k=>{let N=d.docVersions.get(x);q(N!==null,48541),k.version.compareTo(N)<0&&(g.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))})}),S.next(()=>u.mutationQueue.removeMutationBatch(l,g))}(e,n,t,s).next(()=>s.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let l=K();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l}(t))).next(()=>e.localDocuments.getDocuments(n,i))})}function dm(r){let t=M(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}function qp(r,t){let e=M(r),n=t.snapshotVersion,i=e.Fs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=e.Os.newChangeBuffer({trackRemovals:!0});i=e.Fs;let u=[];t.targetChanges.forEach((f,g)=>{let _=i.get(g);if(!_)return;u.push(e.hi.removeMatchingKeys(s,f.removedDocuments,g).next(()=>e.hi.addMatchingKeys(s,f.addedDocuments,g)));let S=_.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(g)!==null?S=S.withResumeToken(ft.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):f.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(f.resumeToken,n)),i=i.insert(g,S),function(k,N,z){return k.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=Mp?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0}(_,S,f)&&u.push(e.hi.updateTargetData(s,S))});let l=Mt(),d=K();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(fm(s,a,t.documentUpdates).next(f=>{l=f.Ls,d=f.ks})),!n.isEqual(U.min())){let f=e.hi.getLastRemoteSnapshotVersion(s).next(g=>e.hi.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return b.waitFor(u).next(()=>a.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(e.Fs=i,s))}function fm(r,t,e){let n=K(),i=K();return e.forEach(s=>n=n.add(s)),t.getEntries(r,n).next(s=>{let a=Mt();return e.forEach((u,l)=>{let d=s.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(U.min())?(t.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(u,l)):D(zc,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{Ls:a,ks:i}})}function Up(r,t){let e=M(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=xe),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function ar(r,t){let e=M(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.hi.getTargetData(n,t).next(s=>s?(i=s,b.resolve(i)):e.hi.allocateTargetId(n).next(a=>(i=new sr(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.hi.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=e.Fs.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.Fs=e.Fs.insert(n.targetId,n),e.Ms.set(t,n.targetId)),n})}function ur(r,t,e){return V(this,null,function*(){let n=M(r),i=n.Fs.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!$e(a))throw a;D(zc,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Fs=n.Fs.remove(t),n.Ms.delete(i.target)})}function Ks(r,t,e){let n=M(r),i=U.min(),s=K();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,f){let g=M(l),_=g.Ms.get(f);return _!==void 0?b.resolve(g.Fs.get(_)):g.hi.getTargetData(d,f)}(n,a,kt(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.hi.getMatchingKeysForTargetId(a,u.targetId).next(l=>{s=l})}).next(()=>n.Cs.getDocumentsMatchingQuery(a,t,e?i:U.min(),e?s:K())).next(u=>(pm(n,Rf(t),u),{documents:u,qs:s})))}function mm(r,t){let e=M(r),n=M(e.hi),i=e.Fs.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>n.Et(s,t).next(a=>a?a.target:null))}function gm(r,t){let e=M(r),n=e.xs.get(t)||U.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.Os.getAllFromCollectionGroup(i,t,Hd(n,$n),Number.MAX_SAFE_INTEGER)).then(i=>(pm(e,t,i),i))}function pm(r,t,e){let n=r.xs.get(t)||U.min();e.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.xs.set(t,n)}function Bp(r,t,e,n){return V(this,null,function*(){let i=M(r),s=K(),a=Mt();for(let d of e){let f=t.Qs(d.metadata.name);d.document&&(s=s.add(f));let g=t.$s(d);g.setReadTime(t.Us(d.metadata.readTime)),a=a.insert(f,g)}let u=i.Os.newChangeBuffer({trackRemovals:!0}),l=yield ar(i,function(f){return kt(gr(H.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>fm(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.hi.removeMatchingKeysForTargetId(d,l.targetId).next(()=>i.hi.addMatchingKeys(d,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.Ls,f.ks)).next(()=>f.Ls)))})}function jp(n,i){return V(this,arguments,function*(r,t,e=K()){let s=yield ar(r,kt(Uc(t.bundledQuery))),a=M(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let l=dt(t.readTime);if(s.snapshotVersion.compareTo(l)>=0)return a.Ti.saveNamedQuery(u,t);let d=s.withResumeToken(ft.EMPTY_BYTE_STRING,l);return a.Fs=a.Fs.insert(d.targetId,d),a.hi.updateTargetData(u,d).next(()=>a.hi.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.hi.addMatchingKeys(u,e,s.targetId)).next(()=>a.Ti.saveNamedQuery(u,t))})})}var ym="firestore_clients";function Rd(r,t){return`${ym}_${r}_${t}`}var _m="firestore_mutations";function Pd(r,t,e){let n=`${_m}_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}var wm="firestore_targets";function pa(r,t){return`${wm}_${r}_${t}`}var Yt="SharedClientState",$s=class r{constructor(t,e,n,i){this.user=t,this.batchId=e,this.state=n,this.error=i}static Ks(t,e,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new C(i.error.code,i.error.message))),a?new r(t,e,i.state,s):(ht(Yt,`Failed to parse mutation state for ID '${e}': ${n}`),null)}Ws(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Zr=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ks(t,e){let n=JSON.parse(e),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new C(n.error.code,n.error.message))),s?new r(t,n.state,i):(ht(Yt,`Failed to parse target state for ID '${t}': ${e}`),null)}Ws(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Qs=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ks(t,e){let n=JSON.parse(e),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=Mc();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=Zd(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(t,s):(ht(Yt,`Failed to parse client data for instance '${t}': ${e}`),null)}},ku=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Ks(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(ht(Yt,`Failed to parse online state: ${t}`),null)}},Ti=class{constructor(){this.activeTargetIds=Mc()}Gs(t){this.activeTargetIds=this.activeTargetIds.add(t)}zs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},ti=class{constructor(t,e,n,i,s){this.window=t,this.Fi=e,this.persistenceKey=n,this.js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new it(G),this.started=!1,this.Zs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=Rd(this.persistenceKey,this.js),this.eo=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new Ti),this.no=new RegExp(`^${ym}_${a}_([^_]*)$`),this.ro=new RegExp(`^${_m}_${a}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${wm}_${a}_(\\d+)$`),this.so=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.oo=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(t){return!(!t||!t.localStorage)}start(){return V(this,null,function*(){let t=yield this.syncEngine.Ps();for(let n of t){if(n===this.js)continue;let i=this.getItem(Rd(this.persistenceKey,n));if(i){let s=Qs.Ks(n,i);s&&(this.Ys=this.Ys.insert(s.clientId,s))}}this._o();let e=this.storage.getItem(this.so);if(e){let n=this.ao(e);n&&this.uo(n)}for(let n of this.Zs)this.Hs(n);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.eo,JSON.stringify(t))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(t){let e=!1;return this.Ys.forEach((n,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.lo(t,"pending")}updateMutationState(t,e,n){this.lo(t,e,n),this.ho(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let i=this.storage.getItem(pa(this.persistenceKey,t));if(i){let s=Zr.Ks(t,i);s&&(n=s.state)}}return e&&this.Po.Gs(t),this._o(),n}removeLocalQueryTarget(t){this.Po.zs(t),this._o()}isLocalQueryTarget(t){return this.Po.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(pa(this.persistenceKey,t))}updateQueryState(t,e,n){this.To(t,e,n)}handleUserChange(t,e,n){e.forEach(i=>{this.ho(i)}),this.currentUser=t,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Io(t)}notifyBundleLoaded(t){this.Eo(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return D(Yt,"READ",t,e),e}setItem(t,e){D(Yt,"SET",t,e),this.storage.setItem(t,e)}removeItem(t){D(Yt,"REMOVE",t),this.storage.removeItem(t)}Hs(t){let e=t;if(e.storageArea===this.storage){if(D(Yt,"EVENT",e.key,e.newValue),e.key===this.Xs)return void ht("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(()=>V(this,null,function*(){if(this.started){if(e.key!==null){if(this.no.test(e.key)){if(e.newValue==null){let n=this.Ao(e.key);return this.Ro(n,null)}{let n=this.Vo(e.key,e.newValue);if(n)return this.Ro(n.clientId,n)}}else if(this.ro.test(e.key)){if(e.newValue!==null){let n=this.mo(e.key,e.newValue);if(n)return this.fo(n)}}else if(this.io.test(e.key)){if(e.newValue!==null){let n=this.po(e.key,e.newValue);if(n)return this.yo(n)}}else if(e.key===this.so){if(e.newValue!==null){let n=this.ao(e.newValue);if(n)return this.uo(n)}}else if(e.key===this.eo){let n=function(s){let a=Ut.ue;if(s!=null)try{let u=JSON.parse(s);q(typeof u=="number",30636,{wo:s}),a=u}catch(u){ht(Yt,"Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==Ut.ue&&this.sequenceNumberHandler(n)}else if(e.key===this.oo){let n=this.So(e.newValue);yield Promise.all(n.map(i=>this.syncEngine.bo(i)))}}}else this.Zs.push(e)}))}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(t,e,n){let i=new $s(this.currentUser,t,e,n),s=Pd(this.persistenceKey,this.currentUser,t);this.setItem(s,i.Ws())}ho(t){let e=Pd(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Io(t){let e={clientId:this.js,onlineState:t};this.storage.setItem(this.so,JSON.stringify(e))}To(t,e,n){let i=pa(this.persistenceKey,t),s=new Zr(t,e,n);this.setItem(i,s.Ws())}Eo(t){let e=JSON.stringify(Array.from(t));this.setItem(this.oo,e)}Ao(t){let e=this.no.exec(t);return e?e[1]:null}Vo(t,e){let n=this.Ao(t);return Qs.Ks(n,e)}mo(t,e){let n=this.ro.exec(t),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return $s.Ks(new pt(s),i,e)}po(t,e){let n=this.io.exec(t),i=Number(n[1]);return Zr.Ks(i,e)}ao(t){return ku.Ks(t)}So(t){return JSON.parse(t)}fo(t){return V(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Do(t.batchId,t.state,t.error);D(Yt,`Ignoring mutation for non-active user ${t.user.uid}`)})}yo(t){return this.syncEngine.vo(t.targetId,t.state,t.error)}Ro(t,e){let n=e?this.Ys.insert(t,e):this.Ys.remove(t),i=this.co(this.Ys),s=this.co(n),a=[],u=[];return s.forEach(l=>{i.has(l)||a.push(l)}),i.forEach(l=>{s.has(l)||u.push(l)}),this.syncEngine.Co(a,u).then(()=>{this.Ys=n})}uo(t){this.Ys.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}co(t){let e=Mc();return t.forEach((n,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},Ws=class{constructor(){this.Fo=new Ti,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Fo.Gs(t),this.Mo[t]||"not-current"}updateQueryState(t,e,n){this.Mo[t]=e}removeLocalQueryTarget(t){this.Fo.zs(t)}isLocalQueryTarget(t){return this.Fo.activeTargetIds.has(t)}clearQueryState(t){delete this.Mo[t]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(t){return this.Fo.activeTargetIds.has(t)}start(){return this.Fo=new Ti,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Fu=class{xo(t){}shutdown(){}};var Vd="ConnectivityMonitor",Hs=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(t){this.ko.push(t)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){D(Vd,"Network connectivity changed: AVAILABLE");for(let t of this.ko)t(0)}Lo(){D(Vd,"Network connectivity changed: UNAVAILABLE");for(let t of this.ko)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var is=null;function Ou(){return is===null?is=function(){return 268435456+Math.round(2147483648*Math.random())}():is++,"0x"+is.toString(16)}var ya="RestConnection",zp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Mu=class{get Qo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=e+"://"+t.host,this.Uo=`projects/${n}/databases/${i}`,this.Ko=this.databaseId.database===Es?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Wo(t,e,n,i,s){let a=Ou(),u=this.Go(t,e.toUriEncodedString());D(ya,`Sending RPC '${t}' ${a}:`,u,n);let l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(l,i,s);let{host:d}=new URL(u),f=na(d);return this.jo(t,u,l,n,f).then(g=>(D(ya,`Received RPC '${t}' ${a}: `,g),g),g=>{throw jt(ya,`RPC '${t}' ${a} failed with error: `,g,"url: ",u,"request:",n),g})}Jo(t,e,n,i,s,a){return this.Wo(t,e,n,i,s)}zo(t,e,n){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+mr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((i,s)=>t[s]=i),n&&n.headers.forEach((i,s)=>t[s]=i)}Go(t,e){let n=zp[t];return`${this.$o}/v1/${e}:${n}`}terminate(){}};var Lu=class{constructor(t){this.Ho=t.Ho,this.Yo=t.Yo}Zo(t){this.Xo=t}e_(t){this.t_=t}n_(t){this.r_=t}onMessage(t){this.i_=t}close(){this.Yo()}send(t){this.Ho(t)}s_(){this.Xo()}o_(){this.t_()}__(t){this.r_(t)}a_(t){this.i_(t)}};var Vt="WebChannelConnection",qu=class extends Mu{constructor(t){super(t),this.u_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}jo(t,e,n,i,s){let a=Ou();return new Promise((u,l)=>{let d=new aa;d.setWithCredentials(!0),d.listenOnce(ua.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Ur.NO_ERROR:let g=d.getResponseJson();D(Vt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(g)),u(g);break;case Ur.TIMEOUT:D(Vt,`RPC '${t}' ${a} timed out`),l(new C(R.DEADLINE_EXCEEDED,"Request time out"));break;case Ur.HTTP_ERROR:let _=d.getStatus();if(D(Vt,`RPC '${t}' ${a} failed with status:`,_,"response text:",d.getResponseText()),_>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);let x=S?.error;if(x&&x.status&&x.message){let k=function(z){let j=z.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(j)>=0?j:R.UNKNOWN}(x.status);l(new C(k,x.message))}else l(new C(R.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new C(R.UNAVAILABLE,"Connection failed."));break;default:L(9055,{c_:t,streamId:a,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{D(Vt,`RPC '${t}' ${a} completed.`)}});let f=JSON.stringify(i);D(Vt,`RPC '${t}' ${a} sending request:`,i),d.send(e,"POST",f,n,15)})}P_(t,e,n){let i=Ou(),s=[this.$o,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=ha(),u=la(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.zo(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;let f=s.join("");D(Vt,`Creating RPC '${t}' stream ${i}: ${f}`,l);let g=a.createWebChannel(f,l);this.T_(g);let _=!1,S=!1,x=new Lu({Ho:N=>{S?D(Vt,`Not sending because RPC '${t}' stream ${i} is closed:`,N):(_||(D(Vt,`Opening RPC '${t}' stream ${i} transport.`),g.open(),_=!0),D(Vt,`RPC '${t}' stream ${i} sending:`,N),g.send(N))},Yo:()=>g.close()}),k=(N,z,j)=>{N.listen(z,B=>{try{j(B)}catch(W){setTimeout(()=>{throw W},0)}})};return k(g,Pn.EventType.OPEN,()=>{S||(D(Vt,`RPC '${t}' stream ${i} transport opened.`),x.s_())}),k(g,Pn.EventType.CLOSE,()=>{S||(S=!0,D(Vt,`RPC '${t}' stream ${i} transport closed`),x.__(),this.I_(g))}),k(g,Pn.EventType.ERROR,N=>{S||(S=!0,jt(Vt,`RPC '${t}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),x.__(new C(R.UNAVAILABLE,"The operation could not be completed")))}),k(g,Pn.EventType.MESSAGE,N=>{var z;if(!S){let j=N.data[0];q(!!j,16349);let B=j,W=B?.error||((z=B[0])===null||z===void 0?void 0:z.error);if(W){D(Vt,`RPC '${t}' stream ${i} received error:`,W);let Z=W.status,$=function(w){let T=mt[w];if(T!==void 0)return Bf(T)}(Z),v=W.message;$===void 0&&($=R.INTERNAL,v="Unknown error status: "+Z+" with message "+W.message),S=!0,x.__(new C($,v)),g.close()}else D(Vt,`RPC '${t}' stream ${i} received:`,j),x.a_(j)}}),k(u,ca.STAT_EVENT,N=>{N.stat===Zi.PROXY?D(Vt,`RPC '${t}' stream ${i} detected buffering proxy`):N.stat===Zi.NOPROXY&&D(Vt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.o_()},0),x}terminate(){this.u_.forEach(t=>t.close()),this.u_=[]}T_(t){this.u_.push(t)}I_(t){this.u_=this.u_.filter(e=>e===t)}};function vm(){return typeof window<"u"?window:null}function ds(){return typeof document<"u"?document:null}function Di(r){return new Za(r,!0)}var Ii=class{constructor(t,e,n=1e3,i=1.5,s=6e4){this.Fi=t,this.timerId=e,this.d_=n,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(t){this.cancel();let e=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),i=Math.max(0,e-n);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),t())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var Cd="PersistentStream",Xs=class{constructor(t,e,n,i,s,a,u,l){this.Fi=t,this.w_=n,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Ii(t,e)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return V(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(t){this.q_(),this.stream.send(t)}L_(){return V(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(t,e){return V(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,t!==4?this.F_.reset():e&&e.code===R.RESOURCE_EXHAUSTED?(ht(e.toString()),ht("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):e&&e.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.n_(e)})}U_(){}auth(){this.state=1;let t=this.K_(this.b_),e=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.b_===e&&this.W_(n,i)},n=>{t(()=>{let i=new C(R.UNKNOWN,"Fetching auth token failed: "+n.message);return this.G_(i)})})}W_(t,e){let n=this.K_(this.b_);this.stream=this.z_(t,e),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.e_(()=>{n(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{n(()=>this.G_(i))}),this.stream.onMessage(i=>{n(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>V(this,null,function*(){this.state=0,this.start()}))}G_(t){return D(Cd,`close with error: ${t}`),this.stream=null,this.close(4,t)}K_(t){return e=>{this.Fi.enqueueAndForget(()=>this.b_===t?e():(D(Cd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Uu=class extends Xs{constructor(t,e,n,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}z_(t,e){return this.connection.P_("Listen",t,e)}j_(t){return this.onNext(t)}onNext(t){this.F_.reset();let e=Sp(this.serializer,t),n=function(s){if(!("targetChange"in s))return U.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?dt(a.readTime):U.min()}(t);return this.listener.J_(e,n)}H_(t){let e={};e.database=nu(this.serializer),e.addTarget=function(s,a){let u,l=a.target;if(u=Ss(l)?{documents:Wf(s,l)}:{query:Hf(s,l).Vt},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=jf(s,a.resumeToken);let d=tu(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){u.readTime=ir(s,a.snapshotVersion.toTimestamp());let d=tu(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,t);let n=Pp(this.serializer,t);n&&(e.labels=n),this.k_(e)}Y_(t){let e={};e.database=nu(this.serializer),e.removeTarget=t,this.k_(e)}},Bu=class extends Xs{constructor(t,e,n,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(t,e){return this.connection.P_("Write",t,e)}j_(t){return q(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,q(!t.writeResults||t.writeResults.length===0,55816),this.listener.ea()}onNext(t){q(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.F_.reset();let e=Rp(t.writeResults,t.commitTime),n=dt(t.commitTime);return this.listener.ta(n,e)}na(){let t={};t.database=nu(this.serializer),this.k_(t)}X_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>yi(this.serializer,n))};this.k_(e)}};var ju=class{},zu=class extends ju{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new C(R.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,n,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(t,eu(e,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(R.UNKNOWN,s.toString())})}Jo(t,e,n,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Jo(t,eu(e,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new C(R.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Gu=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(t){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ua("Offline")))}set(t){this.ha(),this.sa=0,t==="Online"&&(this._a=!1),this.ua(t)}ua(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ca(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(ht(e),this._a=!1):D("OnlineStateTracker",e)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var _n="RemoteStore",Ku=class{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(a=>{n.enqueueAndForget(()=>V(this,null,function*(){We(this)&&(D(_n,"Restarting streams for network reachability change."),yield function(l){return V(this,null,function*(){let d=M(l);d.Ia.add(4),yield pr(d),d.Aa.set("Unknown"),d.Ia.delete(4),yield Ni(d)})}(this))}))}),this.Aa=new Gu(n,i)}};function Ni(r){return V(this,null,function*(){if(We(r))for(let t of r.da)yield t(!0)})}function pr(r){return V(this,null,function*(){for(let t of r.da)yield t(!1)})}function Eo(r,t){let e=M(r);e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),$c(e)?Kc(e):_r(e).x_()&&Gc(e,t))}function cr(r,t){let e=M(r),n=_r(e);e.Ta.delete(t),n.x_()&&Tm(e,t),e.Ta.size===0&&(n.x_()?n.B_():We(e)&&e.Aa.set("Unknown"))}function Gc(r,t){if(r.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(U.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}_r(r).H_(t)}function Tm(r,t){r.Ra.$e(t),_r(r).Y_(t)}function Kc(r){r.Ra=new Ya({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>r.Ta.get(t)||null,lt:()=>r.datastore.serializer.databaseId}),_r(r).start(),r.Aa.aa()}function $c(r){return We(r)&&!_r(r).M_()&&r.Ta.size>0}function We(r){return M(r).Ia.size===0}function Im(r){r.Ra=void 0}function Gp(r){return V(this,null,function*(){r.Aa.set("Online")})}function Kp(r){return V(this,null,function*(){r.Ta.forEach((t,e)=>{Gc(r,t)})})}function $p(r,t){return V(this,null,function*(){Im(r),$c(r)?(r.Aa.la(t),Kc(r)):r.Aa.set("Unknown")})}function Qp(r,t,e){return V(this,null,function*(){if(r.Aa.set("Online"),t instanceof Cs&&t.state===2&&t.cause)try{yield function(i,s){return V(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.Ta.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.Ta.delete(u),i.Ra.removeTarget(u))})}(r,t)}catch(n){D(_n,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield Js(r,n)}else if(t instanceof zn?r.Ra.Ye(t):t instanceof Vs?r.Ra.it(t):r.Ra.et(t),!e.isEqual(U.min()))try{let n=yield dm(r.localStore);e.compareTo(n)>=0&&(yield function(s,a){let u=s.Ra.Pt(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let f=s.Ta.get(d);f&&s.Ta.set(d,f.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let f=s.Ta.get(l);if(!f)return;s.Ta.set(l,f.withResumeToken(ft.EMPTY_BYTE_STRING,f.snapshotVersion)),Tm(s,l);let g=new sr(f.target,l,d,f.sequenceNumber);Gc(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){D(_n,"Failed to raise snapshot:",n),yield Js(r,n)}})}function Js(r,t,e){return V(this,null,function*(){if(!$e(t))throw t;r.Ia.add(1),yield pr(r),r.Aa.set("Offline"),e||(e=()=>dm(r.localStore)),r.asyncQueue.enqueueRetryable(()=>V(null,null,function*(){D(_n,"Retrying IndexedDB access"),yield e(),r.Ia.delete(1),yield Ni(r)}))})}function Em(r,t){return t().catch(e=>Js(r,e,t))}function yr(r){return V(this,null,function*(){let t=M(r),e=je(t),n=t.Pa.length>0?t.Pa[t.Pa.length-1].batchId:xe;for(;Wp(t);)try{let i=yield Up(t.localStore,n);if(i===null){t.Pa.length===0&&e.B_();break}n=i.batchId,Hp(t,i)}catch(i){yield Js(t,i)}Am(t)&&bm(t)})}function Wp(r){return We(r)&&r.Pa.length<10}function Hp(r,t){r.Pa.push(t);let e=je(r);e.x_()&&e.Z_&&e.X_(t.mutations)}function Am(r){return We(r)&&!je(r).M_()&&r.Pa.length>0}function bm(r){je(r).start()}function Xp(r){return V(this,null,function*(){je(r).na()})}function Jp(r){return V(this,null,function*(){let t=je(r);for(let e of r.Pa)t.X_(e.mutations)})}function Yp(r,t,e){return V(this,null,function*(){let n=r.Pa.shift(),i=Ha.from(n,t,e);yield Em(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield yr(r)})}function Zp(r,t){return V(this,null,function*(){t&&je(r).Z_&&(yield function(n,i){return V(this,null,function*(){if(function(a){return Uf(a)&&a!==R.ABORTED}(i.code)){let s=n.Pa.shift();je(n).N_(),yield Em(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield yr(n)}})}(r,t)),Am(r)&&bm(r)})}function xd(r,t){return V(this,null,function*(){let e=M(r);e.asyncQueue.verifyOperationInProgress(),D(_n,"RemoteStore received new credentials");let n=We(e);e.Ia.add(3),yield pr(e),n&&e.Aa.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),yield Ni(e)})}function $u(r,t){return V(this,null,function*(){let e=M(r);t?(e.Ia.delete(2),yield Ni(e)):t||(e.Ia.add(2),yield pr(e),e.Aa.set("Unknown"))})}function _r(r){return r.Va||(r.Va=function(e,n,i){let s=M(e);return s.ia(),new Uu(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Zo:Gp.bind(null,r),e_:Kp.bind(null,r),n_:$p.bind(null,r),J_:Qp.bind(null,r)}),r.da.push(t=>V(null,null,function*(){t?(r.Va.N_(),$c(r)?Kc(r):r.Aa.set("Unknown")):(yield r.Va.stop(),Im(r))}))),r.Va}function je(r){return r.ma||(r.ma=function(e,n,i){let s=M(e);return s.ia(),new Bu(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Zo:()=>Promise.resolve(),e_:Xp.bind(null,r),n_:Zp.bind(null,r),ea:Jp.bind(null,r),ta:Yp.bind(null,r)}),r.da.push(t=>V(null,null,function*(){t?(r.ma.N_(),yield yr(r)):(yield r.ma.stop(),r.Pa.length>0&&(D(_n,`Stopping write stream with ${r.Pa.length} pending writes`),r.Pa=[]))}))),r.ma}var Qu=class r{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new vt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){let a=Date.now()+n,u=new r(t,e,a,i,s);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new C(R.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function wr(r,t){if(ht("AsyncQueue",`${t}: ${r}`),$e(r))return new C(R.UNAVAILABLE,`${t}: ${r}`);throw r}var Ys=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||O.comparator(e.key,n.key):(e,n)=>O.comparator(e.key,n.key),this.keyedMap=Kr(),this.sortedSet=new it(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var Zs=class{constructor(){this.fa=new it(O.comparator)}track(t){let e=t.doc.key,n=this.fa.get(e);n?t.type!==0&&n.type===3?this.fa=this.fa.insert(e,t):t.type===3&&n.type!==1?this.fa=this.fa.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.fa=this.fa.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.fa=this.fa.remove(e):t.type===1&&n.type===2?this.fa=this.fa.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):L(63341,{At:t,ga:n}):this.fa=this.fa.insert(e,t)}pa(){let t=[];return this.fa.inorderTraversal((e,n)=>{t.push(n)}),t}},lr=class r{constructor(t,e,n,i,s,a,u,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,i,s){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,Ys.emptySet(e),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ci(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}};var Wu=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(t=>t.ba())}},Hu=class{constructor(){this.queries=Dd(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(e,n){let i=M(e),s=i.queries;i.queries=Dd(),s.forEach((a,u)=>{for(let l of u.wa)l.onError(n)})})(this,new C(R.ABORTED,"Firestore shutting down"))}};function Dd(){return new Ht(r=>Sf(r),Ci)}function Qc(r,t){return V(this,null,function*(){let e=M(r),n=3,i=t.query,s=e.queries.get(i);s?!s.Sa()&&t.ba()&&(n=2):(s=new Wu,n=t.ba()?0:1);try{switch(n){case 0:s.ya=yield e.onListen(i,!0);break;case 1:s.ya=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(a){let u=wr(a,`Initialization of query '${On(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.wa.push(t),t.va(e.onlineState),s.ya&&t.Ca(s.ya)&&Hc(e)})}function Wc(r,t){return V(this,null,function*(){let e=M(r),n=t.query,i=3,s=e.queries.get(n);if(s){let a=s.wa.indexOf(t);a>=0&&(s.wa.splice(a,1),s.wa.length===0?i=t.ba()?0:1:!s.Sa()&&t.ba()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function ty(r,t){let e=M(r),n=!1;for(let i of t){let s=i.query,a=e.queries.get(s);if(a){for(let u of a.wa)u.Ca(i)&&(n=!0);a.ya=i}}n&&Hc(e)}function ey(r,t,e){let n=M(r),i=n.queries.get(t);if(i)for(let s of i.wa)s.onError(e);n.queries.delete(t)}function Hc(r){r.Da.forEach(t=>{t.next()})}var Xu,Nd;(Nd=Xu||(Xu={})).Fa="default",Nd.Cache="cache";var Ei=class{constructor(t,e,n){this.query=t,this.Ma=e,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(t){if(!this.options.includeMetadataChanges){let n=[];for(let i of t.docChanges)i.type!==3&&n.push(i);t=new lr(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.xa?this.Na(t)&&(this.Ma.next(t),e=!0):this.Ba(t,this.onlineState)&&(this.La(t),e=!0),this.Oa=t,e}onError(t){this.Ma.error(t)}va(t){this.onlineState=t;let e=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,t)&&(this.La(this.Oa),e=!0),e}Ba(t,e){if(!t.fromCache||!this.ba())return!0;let n=e!=="Offline";return(!this.options.ka||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Na(t){if(t.docChanges.length>0)return!0;let e=this.Oa&&this.Oa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}La(t){t=lr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.xa=!0,this.Ma.next(t)}ba(){return this.options.source!==Xu.Cache}};var Ju=class{constructor(t,e){this.qa=t,this.byteLength=e}Qa(){return"metadata"in this.qa}};var to=class{constructor(t){this.serializer=t}Qs(t){return ne(this.serializer,t)}$s(t){return t.metadata.exists?Qf(this.serializer,t.document,!1):_t.newNoDocument(this.Qs(t.metadata.name),this.Us(t.metadata.readTime))}Us(t){return dt(t)}},Yu=class{constructor(t,e){this.$a=t,this.serializer=e,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=Sm(t)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.qa.namedQuery)this.Ua.push(t.qa.namedQuery);else if(t.qa.documentMetadata){this.Ka.push({metadata:t.qa.documentMetadata}),t.qa.documentMetadata.exists||++e;let n=H.fromString(t.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.qa.document&&(this.Ka[this.Ka.length-1].document=t.qa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Ga(t){let e=new Map,n=new to(this.serializer);for(let i of t)if(i.metadata.queries){let s=n.Qs(i.metadata.name);for(let a of i.metadata.queries){let u=(e.get(a)||K()).add(s);e.set(a,u)}}return e}za(t){return V(this,null,function*(){let e=yield Bp(t,new to(this.serializer),this.Ka,this.$a.id),n=this.Ga(this.documents);for(let i of this.Ua)yield jp(t,i,n.get(i.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:e}})}};function Sm(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var eo=class{constructor(t){this.key=t}},no=class{constructor(t){this.key=t}},ro=class{constructor(t,e){this.query=t,this.Ha=e,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=K(),this.mutatedKeys=K(),this.Xa=Pf(t),this.eu=new Ys(this.Xa)}get tu(){return this.Ha}nu(t,e){let n=e?e.ru:new Zs,i=e?e.eu:this.eu,s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,g)=>{let _=i.get(f),S=xi(this.query,g)?g:null,x=!!_&&this.mutatedKeys.has(_.key),k=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations),N=!1;_&&S?_.data.isEqual(S.data)?x!==k&&(n.track({type:3,doc:S}),N=!0):this.iu(_,S)||(n.track({type:2,doc:S}),N=!0,(l&&this.Xa(S,l)>0||d&&this.Xa(S,d)<0)&&(u=!0)):!_&&S?(n.track({type:0,doc:S}),N=!0):_&&!S&&(n.track({type:1,doc:_}),N=!0,(l||d)&&(u=!0)),N&&(S?(a=a.add(S),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{eu:a,ru:n,Ds:u,mutatedKeys:s}}iu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){let s=this.eu;this.eu=t.eu,this.mutatedKeys=t.mutatedKeys;let a=t.ru.pa();a.sort((f,g)=>function(S,x){let k=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{At:N})}};return k(S)-k(x)}(f.type,g.type)||this.Xa(f.doc,g.doc)),this.su(n),i=i!=null&&i;let u=e&&!i?this.ou():[],l=this.Za.size===0&&this.current&&!i?1:0,d=l!==this.Ya;return this.Ya=l,a.length!==0||d?{snapshot:new lr(this.query,t.eu,s,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:u}:{_u:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Zs,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(t){return!this.Ha.has(t)&&!!this.eu.has(t)&&!this.eu.get(t).hasLocalMutations}su(t){t&&(t.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=t.current)}ou(){if(!this.current)return[];let t=this.Za;this.Za=K(),this.eu.forEach(n=>{this.au(n.key)&&(this.Za=this.Za.add(n.key))});let e=[];return t.forEach(n=>{this.Za.has(n)||e.push(new no(n))}),this.Za.forEach(n=>{t.has(n)||e.push(new eo(n))}),e}uu(t){this.Ha=t.qs,this.Za=K();let e=this.nu(t.documents);return this.applyChanges(e,!0)}cu(){return lr.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},He="SyncEngine",Zu=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},tc=class{constructor(t){this.key=t,this.lu=!1}},ec=class{constructor(t,e,n,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new Ht(u=>Sf(u),Ci),this.Tu=new Map,this.Iu=new Set,this.du=new it(O.comparator),this.Eu=new Map,this.Au=new wi,this.Ru={},this.Vu=new Map,this.mu=or.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function ny(r,t,e=!0){return V(this,null,function*(){let n=Ao(r),i,s=n.Pu.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield Rm(n,t,e,!0),i})}function ry(r,t){return V(this,null,function*(){let e=Ao(r);yield Rm(e,t,!0,!1)})}function Rm(r,t,e,n){return V(this,null,function*(){let i=yield ar(r.localStore,kt(t)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,e),u;return n&&(u=yield Xc(r,t,s,a==="current",i.resumeToken)),r.isPrimaryClient&&e&&Eo(r.remoteStore,i),u})}function Xc(r,t,e,n,i){return V(this,null,function*(){r.gu=(g,_,S)=>function(k,N,z,j){return V(this,null,function*(){let B=N.view.nu(z);B.Ds&&(B=yield Ks(k.localStore,N.query,!1).then(({documents:v})=>N.view.nu(v,B)));let W=j&&j.targetChanges.get(N.targetId),Z=j&&j.targetMismatches.get(N.targetId)!=null,$=N.view.applyChanges(B,k.isPrimaryClient,W,Z);return nc(k,N.targetId,$._u),$.snapshot})}(r,g,_,S);let s=yield Ks(r.localStore,t,!0),a=new ro(t,s.qs),u=a.nu(s.documents),l=gi.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,l);nc(r,e,d._u);let f=new Zu(t,e,a);return r.Pu.set(t,f),r.Tu.has(e)?r.Tu.get(e).push(t):r.Tu.set(e,[t]),d.snapshot})}function iy(r,t,e){return V(this,null,function*(){let n=M(r),i=n.Pu.get(t),s=n.Tu.get(i.targetId);if(s.length>1)return n.Tu.set(i.targetId,s.filter(a=>!Ci(a,t))),void n.Pu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield ur(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&cr(n.remoteStore,i.targetId),hr(n,i.targetId)}).catch(Ke))):(hr(n,i.targetId),yield ur(n.localStore,i.targetId,!0))})}function sy(r,t){return V(this,null,function*(){let e=M(r),n=e.Pu.get(t),i=e.Tu.get(n.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),cr(e.remoteStore,n.targetId))})}function oy(r,t,e){return V(this,null,function*(){let n=tl(r);try{let i=yield function(a,u){let l=M(a),d=ot.now(),f=u.reduce((S,x)=>S.add(x.key),K()),g,_;return l.persistence.runTransaction("Locally write mutations","readwrite",S=>{let x=Mt(),k=K();return l.Os.getEntries(S,f).next(N=>{x=N,x.forEach((z,j)=>{j.isValidDocument()||(k=k.add(z))})}).next(()=>l.localDocuments.getOverlayedDocuments(S,x)).next(N=>{g=N;let z=[];for(let j of u){let B=wp(j,g.get(j.key).overlayedDocument);B!=null&&z.push(new Xt(j.key,B,wf(B.value.mapValue),lt.exists(!0)))}return l.mutationQueue.addMutationBatch(S,d,z,u)}).next(N=>{_=N;let z=N.applyToLocalDocumentSet(g,k);return l.documentOverlayCache.saveOverlays(S,N.batchId,z)})}).then(()=>({batchId:_.batchId,changes:Cf(g)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,l){let d=a.Ru[a.currentUser.toKey()];d||(d=new it(G)),d=d.insert(u,l),a.Ru[a.currentUser.toKey()]=d}(n,i.batchId,e),yield ve(n,i.changes),yield yr(n.remoteStore)}catch(i){let s=wr(i,"Failed to persist write");e.reject(s)}})}function Pm(r,t){return V(this,null,function*(){let e=M(r);try{let n=yield qp(e.localStore,t);t.targetChanges.forEach((i,s)=>{let a=e.Eu.get(s);a&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?q(a.lu,14607):i.removedDocuments.size>0&&(q(a.lu,42227),a.lu=!1))}),yield ve(e,n,t)}catch(n){yield Ke(n)}})}function kd(r,t,e){let n=M(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let i=[];n.Pu.forEach((s,a)=>{let u=a.view.va(t);u.snapshot&&i.push(u.snapshot)}),function(a,u){let l=M(a);l.onlineState=u;let d=!1;l.queries.forEach((f,g)=>{for(let _ of g.wa)_.va(u)&&(d=!0)}),d&&Hc(l)}(n.eventManager,t),i.length&&n.hu.J_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function ay(r,t,e){return V(this,null,function*(){let n=M(r);n.sharedClientState.updateQueryState(t,"rejected",e);let i=n.Eu.get(t),s=i&&i.key;if(s){let a=new it(O.comparator);a=a.insert(s,_t.newNoDocument(s,U.min()));let u=K().add(s),l=new mi(U.min(),new Map,new it(G),a,u);yield Pm(n,l),n.du=n.du.remove(s),n.Eu.delete(t),Zc(n)}else yield ur(n.localStore,t,!1).then(()=>hr(n,t,e)).catch(Ke)})}function uy(r,t){return V(this,null,function*(){let e=M(r),n=t.batch.batchId;try{let i=yield Lp(e.localStore,t);Yc(e,n,null),Jc(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield ve(e,i)}catch(i){yield Ke(i)}})}function cy(r,t,e){return V(this,null,function*(){let n=M(r);try{let i=yield function(a,u){let l=M(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return l.mutationQueue.lookupMutationBatch(d,u).next(g=>(q(g!==null,37113),f=g.keys(),l.mutationQueue.removeMutationBatch(d,g))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>l.localDocuments.getDocuments(d,f))})}(n.localStore,t);Yc(n,t,e),Jc(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield ve(n,i)}catch(i){yield Ke(i)}})}function ly(r,t){return V(this,null,function*(){let e=M(r);We(e.remoteStore)||D(He,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=M(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>u.mutationQueue.getHighestUnacknowledgedBatchId(l))}(e.localStore);if(n===xe)return void t.resolve();let i=e.Vu.get(n)||[];i.push(t),e.Vu.set(n,i)}catch(n){let i=wr(n,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function Jc(r,t){(r.Vu.get(t)||[]).forEach(e=>{e.resolve()}),r.Vu.delete(t)}function Yc(r,t,e){let n=M(r),i=n.Ru[n.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),n.Ru[n.currentUser.toKey()]=i}}function hr(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Tu.get(t))r.Pu.delete(n),e&&r.hu.pu(n,e);r.Tu.delete(t),r.isPrimaryClient&&r.Au.zr(t).forEach(n=>{r.Au.containsKey(n)||Vm(r,n)})}function Vm(r,t){r.Iu.delete(t.path.canonicalString());let e=r.du.get(t);e!==null&&(cr(r.remoteStore,e),r.du=r.du.remove(t),r.Eu.delete(e),Zc(r))}function nc(r,t,e){for(let n of e)n instanceof eo?(r.Au.addReference(n.key,t),hy(r,n)):n instanceof no?(D(He,"Document no longer in limbo: "+n.key),r.Au.removeReference(n.key,t),r.Au.containsKey(n.key)||Vm(r,n.key)):L(19791,{yu:n})}function hy(r,t){let e=t.key,n=e.path.canonicalString();r.du.get(e)||r.Iu.has(n)||(D(He,"New document in limbo: "+e),r.Iu.add(n),Zc(r))}function Zc(r){for(;r.Iu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){let t=r.Iu.values().next().value;r.Iu.delete(t);let e=new O(H.fromString(t)),n=r.mu.next();r.Eu.set(n,new tc(e)),r.du=r.du.insert(e,n),Eo(r.remoteStore,new sr(kt(gr(e.path)),n,"TargetPurposeLimboResolution",Ut.ue))}}function ve(r,t,e){return V(this,null,function*(){let n=M(r),i=[],s=[],a=[];n.Pu.isEmpty()||(n.Pu.forEach((u,l)=>{a.push(n.gu(l,t,e).then(d=>{var f;if((d||e)&&n.isPrimaryClient){let g=d?!d.fromCache:(f=e?.targetChanges.get(l.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(l.targetId,g?"current":"not-current")}if(d){i.push(d);let g=xu.Es(l.targetId,d);s.push(g)}}))}),yield Promise.all(a),n.hu.J_(i),yield function(l,d){return V(this,null,function*(){let f=M(l);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>b.forEach(d,_=>b.forEach(_.Is,S=>f.persistence.referenceDelegate.addReference(g,_.targetId,S)).next(()=>b.forEach(_.ds,S=>f.persistence.referenceDelegate.removeReference(g,_.targetId,S)))))}catch(g){if(!$e(g))throw g;D(zc,"Failed to update sequence numbers: "+g)}for(let g of d){let _=g.targetId;if(!g.fromCache){let S=f.Fs.get(_),x=S.snapshotVersion,k=S.withLastLimboFreeSnapshotVersion(x);f.Fs=f.Fs.insert(_,k)}}})}(n.localStore,s))})}function dy(r,t){return V(this,null,function*(){let e=M(r);if(!e.currentUser.isEqual(t)){D(He,"User change. New user:",t.toKey());let n=yield hm(e.localStore,t);e.currentUser=t,function(s,a){s.Vu.forEach(u=>{u.forEach(l=>{l.reject(new C(R.CANCELLED,a))})}),s.Vu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield ve(e,n.Bs)}})}function fy(r,t){let e=M(r),n=e.Eu.get(t);if(n&&n.lu)return K().add(n.key);{let i=K(),s=e.Tu.get(t);if(!s)return i;for(let a of s){let u=e.Pu.get(a);i=i.unionWith(u.view.tu)}return i}}function my(r,t){return V(this,null,function*(){let e=M(r),n=yield Ks(e.localStore,t.query,!0),i=t.view.uu(n);return e.isPrimaryClient&&nc(e,t.targetId,i._u),i})}function gy(r,t){return V(this,null,function*(){let e=M(r);return gm(e.localStore,t).then(n=>ve(e,n))})}function py(r,t,e,n){return V(this,null,function*(){let i=M(r),s=yield function(u,l){let d=M(u),f=M(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Xn(g,l).next(_=>_?d.localDocuments.getDocuments(g,_):b.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield yr(i.remoteStore):e==="acknowledged"||e==="rejected"?(Yc(i,t,n||null),Jc(i,t),function(u,l){M(M(u).mutationQueue).rr(l)}(i.localStore,t)):L(6720,"Unknown batchState",{wu:e}),yield ve(i,s)):D(He,"Cannot apply mutation batch with id: "+t)})}function yy(r,t){return V(this,null,function*(){let e=M(r);if(Ao(e),tl(e),t===!0&&e.fu!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),i=yield Fd(e,n.toArray());e.fu=!0,yield $u(e.remoteStore,!0);for(let s of i)Eo(e.remoteStore,s)}else if(t===!1&&e.fu!==!1){let n=[],i=Promise.resolve();e.Tu.forEach((s,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(hr(e,a),ur(e.localStore,a,!0))),cr(e.remoteStore,a)}),yield i,yield Fd(e,n),function(a){let u=M(a);u.Eu.forEach((l,d)=>{cr(u.remoteStore,d)}),u.Au.jr(),u.Eu=new Map,u.du=new it(O.comparator)}(e),e.fu=!1,yield $u(e.remoteStore,!1)}})}function Fd(r,t,e){return V(this,null,function*(){let n=M(r),i=[],s=[];for(let a of t){let u,l=n.Tu.get(a);if(l&&l.length!==0){u=yield ar(n.localStore,kt(l[0]));for(let d of l){let f=n.Pu.get(d),g=yield my(n,f);g.snapshot&&s.push(g.snapshot)}}else{let d=yield mm(n.localStore,a);u=yield ar(n.localStore,d),yield Xc(n,Cm(d),a,!1,u.resumeToken)}i.push(u)}return n.hu.J_(s),i})}function Cm(r){return bf(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function _y(r){return function(e){return M(M(e).persistence).Ps()}(M(r).localStore)}function wy(r,t,e,n){return V(this,null,function*(){let i=M(r);if(i.fu)return void D(He,"Ignoring unexpected query state notification.");let s=i.Tu.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let a=yield gm(i.localStore,Rf(s[0])),u=mi.createSynthesizedRemoteEventForCurrentChange(t,e==="current",ft.EMPTY_BYTE_STRING);yield ve(i,a,u);break}case"rejected":yield ur(i.localStore,t,!0),hr(i,t,n);break;default:L(64155,e)}})}function vy(r,t,e){return V(this,null,function*(){let n=Ao(r);if(n.fu){for(let i of t){if(n.Tu.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){D(He,"Adding an already active target "+i);continue}let s=yield mm(n.localStore,i),a=yield ar(n.localStore,s);yield Xc(n,Cm(s),a.targetId,!1,a.resumeToken),Eo(n.remoteStore,a)}for(let i of e)n.Tu.has(i)&&(yield ur(n.localStore,i,!1).then(()=>{cr(n.remoteStore,i),hr(n,i)}).catch(Ke))}})}function Ao(r){let t=M(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Pm.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=fy.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=ay.bind(null,t),t.hu.J_=ty.bind(null,t.eventManager),t.hu.pu=ey.bind(null,t.eventManager),t}function tl(r){let t=M(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=uy.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=cy.bind(null,t),t}function Ty(r,t,e){let n=M(r);(function(s,a,u){return V(this,null,function*(){try{let l=yield a.getMetadata();if(yield function(S,x){let k=M(S),N=dt(x.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",z=>k.Ti.getBundleMetadata(z,x.id)).then(z=>!!z&&z.createTime.compareTo(N)>=0)}(s.localStore,l))return yield a.close(),u._completeWith(function(S){return{taskState:"Success",documentsLoaded:S.totalDocuments,bytesLoaded:S.totalBytes,totalDocuments:S.totalDocuments,totalBytes:S.totalBytes}}(l)),Promise.resolve(new Set);u._updateProgress(Sm(l));let d=new Yu(l,a.serializer),f=yield a.Su();for(;f;){let _=yield d.Wa(f);_&&u._updateProgress(_),f=yield a.Su()}let g=yield d.za(s.localStore);return yield ve(s,g.Ja,void 0),yield function(S,x){let k=M(S);return k.persistence.runTransaction("Save bundle","readwrite",N=>k.Ti.saveBundleMetadata(N,x))}(s.localStore,l),u._completeWith(g.progress),Promise.resolve(g.ja)}catch(l){return jt(He,`Loading bundle failed with ${l}`),u._failWith(l),Promise.resolve(new Set)}})})(n,t,e).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var el=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return V(this,null,function*(){this.serializer=Di(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)})}Cu(e,n){return null}Fu(e,n){return null}vu(e){return lm(this.persistence,new Gs,e.initialUser,this.serializer)}Du(e){return new vi(js.Vi,this.serializer)}bu(e){return new Ws}terminate(){return V(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),rc=class extends el{constructor(t){super(),this.cacheSizeBytes=t}Cu(t,e){q(this.persistence.referenceDelegate instanceof zs,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new qs(n,t.asyncQueue,e)}Du(t){let e=this.cacheSizeBytes!==void 0?Ot.withCacheSize(this.cacheSizeBytes):Ot.DEFAULT;return new vi(n=>zs.Vi(n,e),this.serializer)}},io=class r extends el{constructor(t,e,n){super(),this.Mu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return V(this,null,function*(){yield ea(r.prototype,this,"initialize").call(this,t),yield this.Mu.initialize(this,t),yield tl(this.Mu.syncEngine),yield yr(this.Mu.remoteStore),yield this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(t){return lm(this.persistence,new Gs,t.initialUser,this.serializer)}Cu(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new qs(n,t.asyncQueue,e)}Fu(t,e){let n=new Ca(e,this.persistence);return new Va(t.asyncQueue,n)}Du(t){let e=jc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Ot.withCacheSize(this.cacheSizeBytes):Ot.DEFAULT;return new Cu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,vm(),ds(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(t){return new Ws}},ic=class r extends io{constructor(t,e){super(t,e,!1),this.Mu=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return V(this,null,function*(){yield ea(r.prototype,this,"initialize").call(this,t);let e=this.Mu.syncEngine;this.sharedClientState instanceof ti&&(this.sharedClientState.syncEngine={Do:py.bind(null,e),vo:wy.bind(null,e),Co:vy.bind(null,e),Ps:_y.bind(null,e),bo:gy.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.ji(n=>V(this,null,function*(){yield yy(this.Mu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}bu(t){let e=vm();if(!ti.C(e))throw new C(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=jc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new ti(e,t.asyncQueue,n,t.clientId,t.initialUser)}},nl=(()=>{class r{initialize(e,n){return V(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>kd(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=dy.bind(null,this.syncEngine),yield $u(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Hu}()}createDatastore(e){let n=Di(e.databaseInfo.databaseId),i=function(a){return new qu(a)}(e.databaseInfo);return function(a,u,l,d){return new zu(a,u,l,d)}(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return function(i,s,a,u,l){return new Ku(i,s,a,u,l)}(this.localStore,this.datastore,e.asyncQueue,n=>kd(this.syncEngine,n,0),function(){return Hs.C()?new Hs:new Fu}())}createSyncEngine(e,n){return function(s,a,u,l,d,f,g){let _=new ec(s,a,u,l,d,f);return g&&(_.fu=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return V(this,null,function*(){var e,n;yield function(s){return V(this,null,function*(){let a=M(s);D(_n,"RemoteStore shutting down."),a.Ia.add(5),yield pr(a),a.Ea.shutdown(),a.Aa.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();function Od(r,t=10240){let e=0;return{read(){return V(this,null,function*(){if(e<r.byteLength){let i={value:r.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return V(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var dr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.xu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.xu(this.observer.error,t):ht("Uncaught Error in snapshot listener:",t.toString()))}Ou(){this.muted=!0}xu(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var sc=class{constructor(t,e){this.Nu=t,this.serializer=e,this.metadata=new vt,this.buffer=new Uint8Array,this.Bu=function(){return new TextDecoder("utf-8")}(),this.Lu().then(n=>{n&&n.Qa()?this.metadata.resolve(n.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.qa)}`))},n=>this.metadata.reject(n))}close(){return this.Nu.cancel()}getMetadata(){return V(this,null,function*(){return this.metadata.promise})}Su(){return V(this,null,function*(){return yield this.getMetadata(),this.Lu()})}Lu(){return V(this,null,function*(){let t=yield this.ku();if(t===null)return null;let e=this.Bu.decode(t),n=Number(e);isNaN(n)&&this.qu(`length string (${e}) is not valid number`);let i=yield this.Qu(n);return new Ju(JSON.parse(i),t.length+n)})}$u(){return this.buffer.findIndex(t=>t===123)}ku(){return V(this,null,function*(){for(;this.$u()<0&&!(yield this.Uu()););if(this.buffer.length===0)return null;let t=this.$u();t<0&&this.qu("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}Qu(t){return V(this,null,function*(){for(;this.buffer.length<t;)(yield this.Uu())&&this.qu("Reached the end of bundle when more is expected.");let e=this.Bu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}qu(t){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${t}`)}Uu(){return V(this,null,function*(){let t=yield this.Nu.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var oc=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new C(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return V(this,null,function*(){let a=M(i),u={documents:s.map(g=>pi(a.serializer,g))},l=yield a.Jo("BatchGetDocuments",a.serializer.databaseId,H.emptyPath(),u,s.length),d=new Map;l.forEach(g=>{let _=bp(a.serializer,g);d.set(_.key.toString(),_)});let f=[];return s.forEach(g=>{let _=d.get(g.toString());q(!!_,55234,{key:g}),f.push(_)}),f})}(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new Be(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let i=O.fromPath(n);this.mutations.push(new hi(i,this.precondition(i)))}),yield function(n,i){return V(this,null,function*(){let s=M(n),a={writes:i.map(u=>yi(s.serializer,u))};yield s.Wo("Commit",s.serializer.databaseId,H.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L(50498,{Wu:t.constructor.name});e=U.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new C(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(U.min())?lt.exists(!1):lt.updateTime(e):lt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(U.min()))throw new C(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return lt.updateTime(e)}return lt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var ac=class{constructor(t,e,n,i,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=i,this.deferred=s,this.Gu=n.maxAttempts,this.F_=new Ii(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(()=>V(this,null,function*(){let t=new oc(this.datastore),e=this.Ju(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.Hu(i)}))}).catch(n=>{this.Hu(n)})}))}Ju(t){try{let e=this.updateFunction(t);return!Ri(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Hu(t){this.Gu>0&&this.Yu(t)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(t)}Yu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Uf(e)}return!1}};var ze="FirestoreClient",uc=class{constructor(t,e,n,i,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=pt.UNAUTHENTICATED,this.clientId=ei.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,a=>V(this,null,function*(){D(ze,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(D(ze,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new vt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=wr(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function _a(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),D(ze,"Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(i=>V(null,null,function*(){n.isEqual(i)||(yield hm(t.localStore,i),n=i)})),t.persistence.setDatabaseDeletedListener(()=>{jt("Terminating Firestore due to IndexedDb database deletion"),r.terminate().then(()=>{D("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{jt("Terminating Firestore due to IndexedDb database deletion failed",i)})}),r._offlineComponents=t})}function Md(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield rl(r);D(ze,"Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>xd(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>xd(t.remoteStore,i)),r._onlineComponents=t})}function rl(r){return V(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){D(ze,"Using user provided OfflineComponentProvider");try{yield _a(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(i){return i.name==="FirebaseError"?i.code===R.FAILED_PRECONDITION||i.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(e))throw e;jt("Error using user provided cache. Falling back to memory cache: "+e),yield _a(r,new el)}}else D(ze,"Using default OfflineComponentProvider"),yield _a(r,new rc(void 0));return r._offlineComponents})}function bo(r){return V(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(D(ze,"Using user provided OnlineComponentProvider"),yield Md(r,r._uninitializedComponentsProvider._online)):(D(ze,"Using default OnlineComponentProvider"),yield Md(r,new nl))),r._onlineComponents})}function xm(r){return rl(r).then(t=>t.persistence)}function il(r){return rl(r).then(t=>t.localStore)}function Dm(r){return bo(r).then(t=>t.remoteStore)}function sl(r){return bo(r).then(t=>t.syncEngine)}function Iy(r){return bo(r).then(t=>t.datastore)}function fr(r){return V(this,null,function*(){let t=yield bo(r),e=t.eventManager;return e.onListen=ny.bind(null,t.syncEngine),e.onUnlisten=iy.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=ry.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=sy.bind(null,t.syncEngine),e})}function Ey(r){return r.asyncQueue.enqueue(()=>V(null,null,function*(){let t=yield xm(r),e=yield Dm(r);return t.setNetworkEnabled(!0),function(i){let s=M(i);return s.Ia.delete(0),Ni(s)}(e)}))}function Ay(r){return r.asyncQueue.enqueue(()=>V(null,null,function*(){let t=yield xm(r),e=yield Dm(r);return t.setNetworkEnabled(!1),function(i){return V(this,null,function*(){let s=M(i);s.Ia.add(0),yield pr(s),s.Aa.set("Offline")})}(e)}))}function by(r,t){let e=new vt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(i,s,a){return V(this,null,function*(){try{let u=yield function(d,f){let g=M(d);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new C(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let l=wr(u,`Failed to get document '${s} from cache`);a.reject(l)}})}(yield il(r),t,e)})),e.promise}function Nm(r,t,e={}){let n=new vt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(s,a,u,l,d){let f=new dr({next:_=>{f.Ou(),a.enqueueAndForget(()=>Wc(s,g));let S=_.docs.has(u);!S&&_.fromCache?d.reject(new C(R.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&_.fromCache&&l&&l.source==="server"?d.reject(new C(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Ei(gr(u.path),f,{includeMetadataChanges:!0,ka:!0});return Qc(s,g)}(yield fr(r),r.asyncQueue,t,e,n)})),n.promise}function Sy(r,t){let e=new vt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(i,s,a){return V(this,null,function*(){try{let u=yield Ks(i,s,!0),l=new ro(s,u.qs),d=l.nu(u.documents),f=l.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let l=wr(u,`Failed to execute query '${s} against cache`);a.reject(l)}})}(yield il(r),t,e)})),e.promise}function km(r,t,e={}){let n=new vt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(s,a,u,l,d){let f=new dr({next:_=>{f.Ou(),a.enqueueAndForget(()=>Wc(s,g)),_.fromCache&&l.source==="server"?d.reject(new C(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Ei(u,f,{includeMetadataChanges:!0,ka:!0});return Qc(s,g)}(yield fr(r),r.asyncQueue,t,e,n)})),n.promise}function Ry(r,t){let e=new dr(t);return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(i,s){M(i).Da.add(s),s.next()}(yield fr(r),e)})),()=>{e.Ou(),r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(i,s){M(i).Da.delete(s)}(yield fr(r),e)}))}}function Py(r,t,e,n){let i=function(a,u){let l;return l=typeof a=="string"?bc().encode(a):a,function(f,g){return new sc(f,g)}(function(f,g){if(f instanceof Uint8Array)return Od(f,g);if(f instanceof ArrayBuffer)return Od(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),u)}(e,Di(t));r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){Ty(yield sl(r),i,n)}))}function Vy(r,t){return r.asyncQueue.enqueue(()=>V(null,null,function*(){return function(n,i){let s=M(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Ti.getNamedQuery(a,i))}(yield il(r),t)}))}function Fm(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var Ld=new Map;var Om="firestore.googleapis.com",qd=!0,so=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new C(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Om,this.ssl=qd}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:qd;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=rm;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Op)throw new C(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Dg("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Fm((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new C(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new C(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new C(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},wn=class{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new so({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new C(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new C(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new so(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new wa;switch(n.type){case"firstParty":return new Ea(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return V(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=Ld.get(e);n&&(D("ComponentProvider","Removing Datastore"),Ld.delete(e),n.terminate())}(this),Promise.resolve()}};function Cy(r,t,e,n={}){var i;r=Y(r,wn);let s=na(t),a=r._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:r._getEmulatorOptions()}),l=`${t}:${e}`;s&&(mh(`https://${l}`),ph("Firestore",!0)),a.host!==Om&&a.host!==l&&jt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let d=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:n});if(!Ji(d,u)&&(r._setSettings(d),n.mockUserToken)){let f,g;if(typeof n.mockUserToken=="string")f=n.mockUserToken,g=pt.MOCK_USER;else{f=gh(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let _=n.mockUserToken.sub||n.mockUserToken.user_id;if(!_)throw new C(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new pt(_)}r._authCredentials=new va(new fs(f,g))}}var At=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},at=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new re(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}toJSON(){return{type:r._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Si(e,r._jsonSchema))return new r(t,n||null,new O(H.fromString(e.referencePath)))}};at._jsonSchemaVersion="firestore/documentReference/1.0",at._jsonSchema={type:yt("string",at._jsonSchemaVersion),referencePath:yt("string")};var re=class r extends At{constructor(t,e,n){super(t,e,gr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new at(this.firestore,null,new O(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function Yy(r,t,...e){if(r=wt(r),Sc("collection","path",t),r instanceof wn){let n=H.fromString(t,...e);return Nh(n),new re(r,null,n)}{if(!(r instanceof at||r instanceof re))throw new C(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(H.fromString(t,...e));return Nh(n),new re(r.firestore,null,n)}}function Zy(r,t){if(r=Y(r,wn),Sc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new C(R.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new At(r,null,function(n){return new Wt(H.emptyPath(),n)}(t))}function xy(r,t,...e){if(r=wt(r),arguments.length===1&&(t=ei.newId()),Sc("doc","path",t),r instanceof wn){let n=H.fromString(t,...e);return Dh(n),new at(r,null,new O(n))}{if(!(r instanceof at||r instanceof re))throw new C(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(H.fromString(t,...e));return Dh(n),new at(r.firestore,r instanceof re?r.converter:null,new O(n))}}function t_(r,t){return r=wt(r),t=wt(t),(r instanceof at||r instanceof re)&&(t instanceof at||t instanceof re)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function Dy(r,t){return r=wt(r),t=wt(t),r instanceof At&&t instanceof At&&r.firestore===t.firestore&&Ci(r._query,t._query)&&r.converter===t.converter}var Ud="AsyncQueue",oo=class{constructor(t=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Ii(this,"async_queue_retry"),this.oc=()=>{let n=ds();n&&D(Ud,"Visibility state changed to "+n.visibilityState),this.F_.y_()},this._c=t;let e=ds();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.ac(),this.uc(t)}enterRestrictedMode(t){if(!this.Xu){this.Xu=!0,this.rc=t||!1;let e=ds();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.oc)}}enqueue(t){if(this.ac(),this.Xu)return new Promise(()=>{});let e=new vt;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Zu.push(t),this.cc()))}cc(){return V(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(t){if(!$e(t))throw t;D(Ud,"Operation failed with retryable error: "+t)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(t){let e=this._c.then(()=>(this.nc=!0,t().catch(n=>{throw this.tc=n,this.nc=!1,ht("INTERNAL UNHANDLED ERROR: ",Bd(n)),n}).then(n=>(this.nc=!1,n))));return this._c=e,e}enqueueAfterDelay(t,e,n){this.ac(),this.sc.indexOf(t)>-1&&(e=0);let i=Qu.createAndSchedule(this,t,e,n,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&L(47125,{hc:Bd(this.tc)})}verifyOperationInProgress(){}Pc(){return V(this,null,function*(){let t;do t=this._c,yield t;while(t!==this._c)})}Tc(t){for(let e of this.ec)if(e.timerId===t)return!0;return!1}Ic(t){return this.Pc().then(()=>{this.ec.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.ec)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Pc()})}dc(t){this.sc.push(t)}lc(t){let e=this.ec.indexOf(t);this.ec.splice(e,1)}};function Bd(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}function cc(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var lc=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new vt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var e_=-1,ut=class extends wn{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new oo,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return V(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new oo(t),this._firestoreClient=void 0,yield t}})}};function n_(r,t){let e=typeof r=="object"?r:bh(),n=typeof r=="string"?r:t||Es,i=Ih(e,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=fh("firestore");s&&Cy(i,...s)}return i}function Ft(r){if(r._terminated)throw new C(R.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Mm(r),r._firestoreClient}function Mm(r){var t,e,n;let i=r._freezeSettings(),s=function(u,l,d,f){return new ka(u,l,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Fm(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new uc(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){let l=u?._online.build();return{_offline:u?._offline.build(l),_online:l}}(r._componentsProvider))}function r_(r,t){jt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return Lm(r,nl.provider,{build:n=>new io(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function i_(r){return V(this,null,function*(){jt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();Lm(r,nl.provider,{build:e=>new ic(e,t.cacheSizeBytes)})})}function Lm(r,t,e){if((r=Y(r,ut))._firestoreClient||r._terminated)throw new C(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new C(R.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},Mm(r)}function s_(r){if(r._initialized&&!r._terminated)throw new C(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new vt;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>V(null,null,function*(){try{yield function(n){return V(this,null,function*(){if(!Fe.C())return Promise.resolve();let i=n+cm;yield Fe.delete(i)})}(jc(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function o_(r){return function(e){let n=new vt;return e.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return ly(yield sl(e),n)})),n.promise}(Ft(r=Y(r,ut)))}function a_(r){return Ey(Ft(r=Y(r,ut)))}function u_(r){return Ay(Ft(r=Y(r,ut)))}function c_(r,t){let e=Ft(r=Y(r,ut)),n=new lc;return Py(e,r._databaseId,t,n),n}function l_(r,t){return Vy(Ft(r=Y(r,ut)),t).then(e=>e?new At(r,null,e.query):null)}var fe=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(ft.fromBase64String(t))}catch(e){throw new C(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(ft.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Si(t,r._jsonSchema))return r.fromBase64String(t.bytes)}};fe._jsonSchemaVersion="firestore/bytes/1.0",fe._jsonSchema={type:yt("string",fe._jsonSchemaVersion),bytes:yt("string")};var Ge=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new C(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Tt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var _e=class{constructor(t){this._methodName=t}};var De=class r{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new C(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new C(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return G(this._lat,t._lat)||G(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:r._jsonSchemaVersion}}static fromJSON(t){if(Si(t,r._jsonSchema))return new r(t.latitude,t.longitude)}};De._jsonSchemaVersion="firestore/geoPoint/1.0",De._jsonSchema={type:yt("string",De._jsonSchemaVersion),latitude:yt("number"),longitude:yt("number")};var Ne=class r{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,t._values)}toJSON(){return{type:r._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Si(t,r._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new r(t.vectorValues);throw new C(R.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Ne._jsonSchemaVersion="firestore/vectorValue/1.0",Ne._jsonSchema={type:yt("string",Ne._jsonSchemaVersion),vectorValues:yt("object")};var Ny=/^__.*__$/,hc=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Xt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ue(t,this.data,e,this.fieldTransforms)}},ao=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Xt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function qm(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ec:r})}}var uo=class r{constructor(t,e,n,i,s,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Rc({path:n,mc:!1});return i.fc(t),i}gc(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Rc({path:n,mc:!1});return i.Ac(),i}yc(t){return this.Rc({path:void 0,mc:!0})}wc(t){return co(t,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ac(){if(this.path)for(let t=0;t<this.path.length;t++)this.fc(this.path.get(t))}fc(t){if(t.length===0)throw this.wc("Document fields must not be empty");if(qm(this.Ec)&&Ny.test(t))throw this.wc('Document fields cannot begin and end with "__"')}},dc=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Di(t)}Dc(t,e,n,i=!1){return new uo({Ec:t,methodName:e,bc:n,path:Tt.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function In(r){let t=r._freezeSettings(),e=Di(r._databaseId);return new dc(r._databaseId,!!t.ignoreUndefinedProperties,e)}function So(r,t,e,n,i,s={}){let a=r.Dc(s.merge||s.mergeFields?2:0,t,e,i);ul("Data must be an object, but it was:",a,n);let u=jm(n,a),l,d;if(s.merge)l=new Bt(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let _=yc(t,g,e);if(!a.contains(_))throw new C(R.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);Gm(f,_)||f.push(_)}l=new Bt(f),d=a.fieldTransforms.filter(g=>l.covers(g.field))}else l=null,d=a.fieldTransforms;return new hc(new Ct(u),l,d)}var Ai=class r extends _e{_toFieldTransform(t){if(t.Ec!==2)throw t.Ec===1?t.wc(`${this._methodName}() can only appear at the top level of your update data`):t.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function Um(r,t,e){return new uo({Ec:3,bc:t.settings.bc,methodName:r._methodName,mc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var fc=class r extends _e{_toFieldTransform(t){return new gn(t.path,new Le)}isEqual(t){return t instanceof r}},mc=class r extends _e{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=Um(this,t,!0),n=this.vc.map(s=>En(s,e)),i=new pe(n);return new gn(t.path,i)}isEqual(t){return t instanceof r&&Ji(this.vc,t.vc)}},gc=class r extends _e{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=Um(this,t,!0),n=this.vc.map(s=>En(s,e)),i=new ye(n);return new gn(t.path,i)}isEqual(t){return t instanceof r&&Ji(this.vc,t.vc)}},pc=class r extends _e{constructor(t,e){super(t),this.Cc=e}_toFieldTransform(t){let e=new qe(t.serializer,Nf(t.serializer,this.Cc));return new gn(t.path,e)}isEqual(t){return t instanceof r&&this.Cc===t.Cc}};function ol(r,t,e,n){let i=r.Dc(1,t,e);ul("Data must be an object, but it was:",i,n);let s=[],a=Ct.empty();Qe(n,(l,d)=>{let f=cl(t,l,e);d=wt(d);let g=i.gc(f);if(d instanceof Ai)s.push(f);else{let _=En(d,g);_!=null&&(s.push(f),a.set(f,_))}});let u=new Bt(s);return new ao(a,u,i.fieldTransforms)}function al(r,t,e,n,i,s){let a=r.Dc(1,t,e),u=[yc(t,n,e)],l=[i];if(s.length%2!=0)throw new C(R.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(yc(t,s[_])),l.push(s[_+1]);let d=[],f=Ct.empty();for(let _=u.length-1;_>=0;--_)if(!Gm(d,u[_])){let S=u[_],x=l[_];x=wt(x);let k=a.gc(S);if(x instanceof Ai)d.push(S);else{let N=En(x,k);N!=null&&(d.push(S),f.set(S,N))}}let g=new Bt(d);return new ao(f,g,a.fieldTransforms)}function Bm(r,t,e,n=!1){return En(e,r.Dc(n?4:3,t))}function En(r,t){if(zm(r=wt(r)))return ul("Unsupported field value:",t,r),jm(r,t);if(r instanceof _e)return function(n,i){if(!qm(i.Ec))throw i.wc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.mc&&t.Ec!==4)throw t.wc("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let l=En(u,i.yc(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(r,t)}return function(n,i){if((n=wt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Nf(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=ot.fromDate(n);return{timestampValue:ir(i.serializer,s)}}if(n instanceof ot){let s=new ot(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:ir(i.serializer,s)}}if(n instanceof De)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof fe)return{bytesValue:jf(i.serializer,n._byteString)};if(n instanceof at){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:qc(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Ne)return function(a,u){return{mapValue:{fields:{[Nc]:{stringValue:kc},[Zn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.wc("VectorValues must only contain numeric values.");return Lc(u.serializer,d)})}}}}}}(n,i);throw i.wc(`Unsupported field value: ${po(n)}`)}(r,t)}function jm(r,t){let e={};return hf(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Qe(r,(n,i)=>{let s=En(i,t.Vc(n));s!=null&&(e[n]=s)}),{mapValue:{fields:e}}}function zm(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof ot||r instanceof De||r instanceof fe||r instanceof at||r instanceof _e||r instanceof Ne)}function ul(r,t,e){if(!zm(e)||!Qd(e)){let n=po(e);throw n==="an object"?t.wc(r+" a custom object"):t.wc(r+" "+n)}}function yc(r,t,e){if((t=wt(t))instanceof Ge)return t._internalPath;if(typeof t=="string")return cl(r,t);throw co("Field path arguments must be of type string or ",r,!1,void 0,e)}var ky=new RegExp("[~\\*/\\[\\]]");function cl(r,t,e){if(t.search(ky)>=0)throw co(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new Ge(...t.split("."))._internalPath}catch{throw co(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function co(r,t,e,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new C(R.INVALID_ARGUMENT,u+r+l)}function Gm(r,t){return r.some(e=>e.isEqual(t))}var vn=class{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new at(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new _c(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Ro("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},_c=class extends vn{data(){return super.data()}};function Ro(r,t){return typeof t=="string"?cl(r,t):t instanceof Ge?t._internalPath:t._delegate._internalPath}function Km(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new C(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var bi=class{},Tn=class extends bi{};function h_(r,t,...e){let n=[];t instanceof bi&&n.push(t),n=n.concat(e),function(s){let a=s.filter(l=>l instanceof wc).length,u=s.filter(l=>l instanceof lo).length;if(a>1||a>0&&u>0)throw new C(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var lo=class r extends Tn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return Qm(t._query,e),new At(t.firestore,t.converter,Qa(t._query,e))}_parse(t){let e=In(t.firestore);return function(s,a,u,l,d,f,g){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new C(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){zd(g,f);let x=[];for(let k of g)x.push(jd(l,s,k));_={arrayValue:{values:x}}}else _=jd(l,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||zd(g,f),_=Bm(u,a,g,f==="in"||f==="not-in");return Q.create(d,f,_)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function d_(r,t,e){let n=t,i=Ro("where",r);return lo._create(i,n,e)}var wc=class r extends bi{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:tt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let l of u)Qm(a,l),a=Qa(a,l)}(t._query,e),new At(t.firestore,t.converter,Qa(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var vc=class r extends Tn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(i,s,a){if(i.startAt!==null)throw new C(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new C(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new fn(s,a)}(t._query,this._field,this._direction);return new At(t.firestore,t.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new Wt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function f_(r,t="asc"){let e=t,n=Ro("orderBy",r);return vc._create(n,e)}var ho=class r extends Tn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new At(t.firestore,t.converter,Ps(t._query,this._limit,this._limitType))}};function m_(r){return Wd("limit",r),ho._create("limit",r,"F")}function g_(r){return Wd("limitToLast",r),ho._create("limitToLast",r,"L")}var fo=class r extends Tn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=$m(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,function(i,s){return new Wt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function p_(...r){return fo._create("startAt",r,!0)}function y_(...r){return fo._create("startAfter",r,!1)}var mo=class r extends Tn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=$m(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,function(i,s){return new Wt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function __(...r){return mo._create("endBefore",r,!1)}function w_(...r){return mo._create("endAt",r,!0)}function $m(r,t,e,n){if(e[0]=wt(e[0]),e[0]instanceof vn)return function(s,a,u,l,d){if(!l)throw new C(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of jn(s))if(g.field.isKeyField())f.push(dn(a,l.key));else{let _=l.data.field(g.field);if(vo(_))throw new C(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let S=g.field.canonicalString();throw new C(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${S}' (used as the orderBy) does not exist.`)}f.push(_)}return new se(f,d)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let i=In(r.firestore);return function(a,u,l,d,f,g){let _=a.explicitOrderBy;if(f.length>_.length)throw new C(R.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let S=[];for(let x=0;x<f.length;x++){let k=f[x];if(_[x].field.isKeyField()){if(typeof k!="string")throw new C(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof k}`);if(!Oc(a)&&k.indexOf("/")!==-1)throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${k}' contains a slash.`);let N=a.path.child(H.fromString(k));if(!O.isDocumentKey(N))throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);let z=new O(N);S.push(dn(u,z))}else{let N=Bm(l,d,k);S.push(N)}}return new se(S,g)}(r._query,r.firestore._databaseId,i,t,e,n)}}function jd(r,t,e){if(typeof(e=wt(e))=="string"){if(e==="")throw new C(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Oc(t)&&e.indexOf("/")!==-1)throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(H.fromString(e));if(!O.isDocumentKey(n))throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return dn(r,new O(n))}if(e instanceof at)return dn(r,e._key);throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${po(e)}.`)}function zd(r,t){if(!Array.isArray(r)||r.length===0)throw new C(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Qm(r,t){let e=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new C(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new C(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var go=class{convertValue(t,e="none"){switch(Oe(t)){case 0:return null;case 1:return t.booleanValue;case 2:return st(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ge(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return Qe(t,(i,s)=>{n[i]=this.convertValue(s,e)}),n}convertVectorValue(t){var e,n,i;let s=(i=(n=(e=t.fields)===null||e===void 0?void 0:e[Zn].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>st(a.doubleValue));return new Ne(s)}convertGeoPoint(t){return new De(st(t.latitude),st(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=To(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ui(t));default:return null}}convertTimestamp(t){let e=me(t);return new ot(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=H.fromString(t);q(Zf(n),9688,{name:t});let i=new Yn(n.get(1),n.get(3)),s=new O(n.popFirst(5));return i.isEqual(e)||ht(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function Po(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var Tc=class extends go{constructor(t){super(),this.firestore=t}convertBytes(t){return new fe(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new at(this.firestore,null,e)}};var de=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},$t=class r extends vn{constructor(t,e,n,i,s,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Gn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(Ro("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new C(R.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=r._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};$t._jsonSchemaVersion="firestore/documentSnapshot/1.0",$t._jsonSchema={type:yt("string",$t._jsonSchemaVersion),bundleSource:yt("string","DocumentSnapshot"),bundleName:yt("string"),bundle:yt("string")};var Gn=class extends $t{data(t={}){return super.data(t)}},Qt=class r{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new de(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Gn(this._firestore,this._userDataWriter,n.key,n,new de(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new C(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let l=new Gn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new de(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let l=new Gn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new de(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:Fy(u.type),doc:l,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new C(R.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=r._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=ei.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],n=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(e.push(s._document),n.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function Fy(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:r})}}function v_(r,t){return r instanceof $t&&t instanceof $t?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof Qt&&t instanceof Qt&&r._firestore===t._firestore&&Dy(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function T_(r){r=Y(r,at);let t=Y(r.firestore,ut);return Nm(Ft(t),r._key).then(e=>ll(t,r,e))}Qt._jsonSchemaVersion="firestore/querySnapshot/1.0",Qt._jsonSchema={type:yt("string",Qt._jsonSchemaVersion),bundleSource:yt("string","QuerySnapshot"),bundleName:yt("string"),bundle:yt("string")};var we=class extends go{constructor(t){super(),this.firestore=t}convertBytes(t){return new fe(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new at(this.firestore,null,e)}};function I_(r){r=Y(r,at);let t=Y(r.firestore,ut),e=Ft(t),n=new we(t);return by(e,r._key).then(i=>new $t(t,n,r._key,i,new de(i!==null&&i.hasLocalMutations,!0),r.converter))}function E_(r){r=Y(r,at);let t=Y(r.firestore,ut);return Nm(Ft(t),r._key,{source:"server"}).then(e=>ll(t,r,e))}function A_(r){r=Y(r,At);let t=Y(r.firestore,ut),e=Ft(t),n=new we(t);return Km(r._query),km(e,r._query).then(i=>new Qt(t,n,r,i))}function b_(r){r=Y(r,At);let t=Y(r.firestore,ut),e=Ft(t),n=new we(t);return Sy(e,r._query).then(i=>new Qt(t,n,r,i))}function S_(r){r=Y(r,At);let t=Y(r.firestore,ut),e=Ft(t),n=new we(t);return km(e,r._query,{source:"server"}).then(i=>new Qt(t,n,r,i))}function R_(r,t,e){r=Y(r,at);let n=Y(r.firestore,ut),i=Po(r.converter,t,e);return Vo(n,[So(In(n),"setDoc",r._key,i,r.converter!==null,e).toMutation(r._key,lt.none())])}function P_(r,t,e,...n){r=Y(r,at);let i=Y(r.firestore,ut),s=In(i),a;return a=typeof(t=wt(t))=="string"||t instanceof Ge?al(s,"updateDoc",r._key,t,e,n):ol(s,"updateDoc",r._key,t),Vo(i,[a.toMutation(r._key,lt.exists(!0))])}function V_(r){return Vo(Y(r.firestore,ut),[new Be(r._key,lt.none())])}function C_(r,t){let e=Y(r.firestore,ut),n=xy(r),i=Po(r.converter,t);return Vo(e,[So(In(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,lt.exists(!1))]).then(()=>n)}function x_(r,...t){var e,n,i;r=wt(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||cc(t[a])||(s=t[a++]);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(cc(t[a])){let g=t[a];t[a]=(e=g.next)===null||e===void 0?void 0:e.bind(g),t[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),t[a+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let l,d,f;if(r instanceof at)d=Y(r.firestore,ut),f=gr(r._key.path),l={next:g=>{t[a]&&t[a](ll(d,r,g))},error:t[a+1],complete:t[a+2]};else{let g=Y(r,At);d=Y(g.firestore,ut),f=g._query;let _=new we(d);l={next:S=>{t[a]&&t[a](new Qt(d,_,g,S))},error:t[a+1],complete:t[a+2]},Km(r._query)}return function(_,S,x,k){let N=new dr(k),z=new Ei(S,N,x);return _.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Qc(yield fr(_),z)})),()=>{N.Ou(),_.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Wc(yield fr(_),z)}))}}(Ft(d),f,u,l)}function D_(r,t){return Ry(Ft(r=Y(r,ut)),cc(t)?t:{next:t})}function Vo(r,t){return function(n,i){let s=new vt;return n.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return oy(yield sl(n),i,s)})),s.promise}(Ft(r),t)}function ll(r,t,e){let n=e.docs.get(t._key),i=new we(r);return new $t(r,i,t._key,n,new de(e.hasPendingWrites,e.fromCache),t.converter)}var Oy={maxAttempts:5};var Gd=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=In(t)}set(t,e,n){this._verifyNotCommitted();let i=Ce(t,this._firestore),s=Po(i.converter,e,n),a=So(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,lt.none())),this}update(t,e,n,...i){this._verifyNotCommitted();let s=Ce(t,this._firestore),a;return a=typeof(e=wt(e))=="string"||e instanceof Ge?al(this._dataReader,"WriteBatch.update",s._key,e,n,i):ol(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(a.toMutation(s._key,lt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Ce(t,this._firestore);return this._mutations=this._mutations.concat(new Be(e._key,lt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ce(r,t){if((r=wt(r)).firestore!==t)throw new C(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var Ic=class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=In(t)}get(t){let e=Ce(t,this._firestore),n=new Tc(this._firestore);return this._transaction.lookup([e._key]).then(i=>{if(!i||i.length!==1)return L(24041);let s=i[0];if(s.isFoundDocument())return new vn(this._firestore,n,s.key,s,e.converter);if(s.isNoDocument())return new vn(this._firestore,n,e._key,null,e.converter);throw L(18433,{doc:s})})}set(t,e,n){let i=Ce(t,this._firestore),s=Po(i.converter,e,n),a=So(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,n);return this._transaction.set(i._key,a),this}update(t,e,n,...i){let s=Ce(t,this._firestore),a;return a=typeof(e=wt(e))=="string"||e instanceof Ge?al(this._dataReader,"Transaction.update",s._key,e,n,i):ol(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,a),this}delete(t){let e=Ce(t,this._firestore);return this._transaction.delete(e._key),this}};var Ec=class extends Ic{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Ce(t,this._firestore),n=new we(this._firestore);return super.get(t).then(i=>new $t(this._firestore,n,e._key,i._document,new de(!1,!1),e.converter))}};function N_(r,t,e){r=Y(r,ut);let n=Object.assign(Object.assign({},Oy),e);return function(s){if(s.maxAttempts<1)throw new C(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let l=new vt;return s.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){let d=yield Iy(s);new ac(s.asyncQueue,d,u,a,l).zu()})),l.promise}(Ft(r),i=>t(new Ec(r,i)),n)}function k_(){return new Ai("deleteField")}function F_(){return new fc("serverTimestamp")}function O_(...r){return new mc("arrayUnion",r)}function M_(...r){return new gc("arrayRemove",r)}function L_(r){return new pc("increment",r)}(function(t,e=!0){(function(i){mr=i})(Ah),Th(new wh("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new ut(new Ta(n.getProvider("auth-internal")),new Aa(a,n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new C(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Yn(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),sa(Ph,Vh,t),sa(Ph,Vh,"esm2017")})();export{Wy as a,jt as b,Hy as c,C as d,Tt as e,O as f,Dg as g,Y as h,ot as i,Jy as j,Yn as k,Cy as l,at as m,Yy as n,Zy as o,xy as p,t_ as q,Dy as r,e_ as s,n_ as t,Ft as u,r_ as v,i_ as w,s_ as x,o_ as y,a_ as z,u_ as A,c_ as B,l_ as C,fe as D,Ge as E,De as F,h_ as G,d_ as H,f_ as I,m_ as J,g_ as K,p_ as L,y_ as M,__ as N,w_ as O,go as P,$t as Q,Gn as R,Qt as S,v_ as T,T_ as U,I_ as V,E_ as W,A_ as X,b_ as Y,S_ as Z,R_ as _,P_ as $,V_ as aa,C_ as ba,x_ as ca,D_ as da,Vo as ea,Gd as fa,N_ as ga,k_ as ha,F_ as ia,O_ as ja,M_ as ka,L_ as la};
