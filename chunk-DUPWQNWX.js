import{b}from"./chunk-LVG2LAOY.js";import{a as p}from"./chunk-J6AG6JAU.js";import{b as M}from"./chunk-CKYVJWE2.js";import{e as g}from"./chunk-JPGT6HBL.js";import{d as h}from"./chunk-LFVXFGPE.js";import{k as v}from"./chunk-RGYXGWNO.js";import{A as N,e as o,y as u,z as f}from"./chunk-7GKVL75V.js";import{h as c,k as m}from"./chunk-X5G25CLX.js";import{e as l}from"./chunk-2DZ25YRQ.js";import{Jd as d,Ph as n,gb as s,nb as a}from"./chunk-GM6XQ5SX.js";var i=class i{constructor(e,t,r,y){this.firebaseCrudService=e;this.modal=t;this.message=r;this.fb=y;this.treeData=[];this.expandedKeys=[];this.selectedKeys=[];this.isModalVisible=!1;this.modalTitle="\u65B0\u589E\u7BC0\u9EDE";this.isEditMode=!1;this.nodeForm=this.fb.group({title:["",o.required],parentKey:[""],author:["",o.required],isLeaf:[!1]})}ngOnInit(){this.loadTreeData()}loadTreeData(){this.firebaseCrudService.getNodes().subscribe(e=>{let t=this.firebaseCrudService.buildTree(e);this.treeData=this.convertToNzTreeData(t)})}convertToNzTreeData(e){return e.map(t=>({title:t.title,key:t.key,expanded:t.expanded||!1,isLeaf:t.isLeaf,children:t.children?this.convertToNzTreeData(t.children):void 0}))}showAddModal(e){this.isEditMode=!1,this.modalTitle="\u65B0\u589E\u7BC0\u9EDE",this.nodeForm.reset(),e&&this.nodeForm.patchValue({parentKey:e}),this.isModalVisible=!0}showEditModal(e){this.isEditMode=!0,this.modalTitle="\u7DE8\u8F2F\u7BC0\u9EDE",this.selectedNode=e,this.nodeForm.patchValue({title:e.title,parentKey:e.parentKey||"",author:e.author,isLeaf:e.isLeaf}),this.isModalVisible=!0}deleteNode(e){this.modal.confirm({nzTitle:"\u78BA\u8A8D\u522A\u9664",nzContent:`\u78BA\u5B9A\u8981\u522A\u9664\u7BC0\u9EDE "${e.title}" \u55CE\uFF1F`,nzOkText:"\u78BA\u5B9A",nzCancelText:"\u53D6\u6D88",nzOnOk:()=>{this.firebaseCrudService.deleteNode(e.id).then(()=>{this.message.success("\u7BC0\u9EDE\u522A\u9664\u6210\u529F")}).catch(t=>{this.message.error("\u522A\u9664\u5931\u6557: "+t.message)})}})}handleOk(){if(this.nodeForm.valid){let e=this.nodeForm.value;if(this.isEditMode&&this.selectedNode)this.firebaseCrudService.updateNode(this.selectedNode.id,{title:e.title,parentKey:e.parentKey||void 0,author:e.author,isLeaf:e.isLeaf}).then(()=>{this.message.success("\u7BC0\u9EDE\u66F4\u65B0\u6210\u529F"),this.handleCancel()}).catch(t=>{this.message.error("\u66F4\u65B0\u5931\u6557: "+t.message)});else{let t={title:e.title,key:this.generateKey(),parentKey:e.parentKey||void 0,author:e.author,isLeaf:e.isLeaf};this.firebaseCrudService.addNode(t).then(()=>{this.message.success("\u7BC0\u9EDE\u65B0\u589E\u6210\u529F"),this.handleCancel()}).catch(r=>{this.message.error("\u65B0\u589E\u5931\u6557: "+r.message)})}}}handleCancel(){this.isModalVisible=!1,this.selectedNode=void 0}onNodeClick(e){this.selectedKeys=[e.node.key]}onExpand(e){this.expandedKeys=e.keys}addRootNode(){let e=new Date().toISOString(),t={title:"\u6839\u7D50\u9EDE",key:this.generateKey(),name:"\u6839\u7D50\u9EDE",type:"root",status:"active",createdAt:e,updatedAt:e};this.firebaseCrudService.addNode(t).then(()=>{this.message.success("\u6839\u7D50\u9EDE\u5EFA\u7ACB\u6210\u529F"),this.loadTreeData()}).catch(r=>{this.message.error("\u5EFA\u7ACB\u5931\u6557: "+r.message)})}generateKey(){return"node-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}};i.\u0275fac=function(t){return new(t||i)(s(p),s(c),s(h),s(u))},i.\u0275cmp=a({type:i,selectors:[["app-firebase-crud"]],decls:0,vars:0,template:function(t,r){},dependencies:[d,f,N,b,m,g,v,l,n,M],styles:[".crud-container[_ngcontent-%COMP%]{padding:16px}.toolbar[_ngcontent-%COMP%]{margin-bottom:16px}nz-tree[_ngcontent-%COMP%]{border:1px solid #d9d9d9;border-radius:6px;padding:8px}"]});var z=i;export{z as a};
