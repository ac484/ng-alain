import{a as yt,h as te,l as Ot}from"./chunk-RRTVB2GH.js";import{a as P,b as ve,c as We}from"./chunk-D7AHKW2R.js";import{a as le}from"./chunk-I5YMKO3M.js";import{a as Gt,b as qt,c as Wt}from"./chunk-2LU6BSSL.js";import{A as kt,n as St,o as ee,t as bt,w as _t,x as Nt,y as wt,z as Tt}from"./chunk-THLQETHC.js";import"./chunk-VAGS5EVQ.js";import{b as He,c as Ye,d as Xe,e as re,f as Je,g as Qe,h as Bt,j as Rt,t as At,u as Ut}from"./chunk-M6SGCRO4.js";import"./chunk-LCVWFO3P.js";import{a as Vt,b as Lt}from"./chunk-E3JSWP3F.js";import{a as q,b as W,c as Ke,d as $,e as j,f as K,h as H}from"./chunk-ZN4SMX4K.js";import{d as w}from"./chunk-BPXOC4B3.js";import"./chunk-FYDCKUZW.js";import{C as ge,G as se,J as qe,p as zt,q as ht,r as Ct}from"./chunk-SB2HO6JZ.js";import"./chunk-JAVLZK5L.js";import{c as $e,e as je,k as L,m as O,p as G}from"./chunk-WHRI2AXL.js";import{b as xt,d as Mt}from"./chunk-EO7VZDHM.js";import"./chunk-IFPPFMNI.js";import"./chunk-4O5NHTAF.js";import"./chunk-E2CCMZAM.js";import{d as Pt,e as It,f as Ft}from"./chunk-F4IBXQAQ.js";import"./chunk-754CTGRH.js";import"./chunk-MPLSKRO5.js";import{m as b,n as fe}from"./chunk-HNEBRDLY.js";import"./chunk-45FQ6IMJ.js";import{B as U,F as ie,H as V,l as I,m as d,o as F,p as B,r as Et,t as Dt,v as R,y as A}from"./chunk-53SO5WPT.js";import{Ac as ft,Bb as E,Bc as gt,Db as D,Fc as m,Gc as u,Hc as vt,Ib as p,Id as Ge,Jb as o,Jc as Z,Kb as s,Lb as v,Sb as de,Sh as ne,Th as ae,Vb as f,W as Ve,Yb as pe,Za as r,ad as Oe,bi as y,gc as Q,ib as z,ic as lt,ii as _,kc as pt,ki as N,lc as c,li as S,mc as x,nc as h,ob as J,pc as mt,qb as ue,qc as ct,ra as n,rc as ut,wc as dt,xa as T,ya as k,zc as Le}from"./chunk-W6OF5JYC.js";import{a as at,i as M}from"./chunk-57BLH6QZ.js";var ze=class ze{constructor(){this.socialService=n(ve);this.settingsSrv=n(ge);this.type=""}ngOnInit(){this.mockModel()}mockModel(){let t={token:"123456789",name:"cipchk",email:`${this.type}@${this.type}.com`,id:1e4,time:+new Date};this.settingsSrv.setUser(at(at({},this.settingsSrv.user),t)),this.socialService.callback(t)}};ze.\u0275fac=function(e){return new(e||ze)},ze.\u0275cmp=z({type:ze,selectors:[["app-callback"]],inputs:{type:"type"},features:[Le([ve])],decls:0,vars:0,template:function(e,i){},encapsulation:2});var Ze=ze;var he=class he{constructor(){this.tokenService=n(P);this.settings=n(ge);this.router=n(b);this.f=new Et({password:new Dt("",{nonNullable:!0,validators:[d.required]})})}get user(){return this.settings.user}submit(){this.f.controls.password.markAsDirty(),this.f.controls.password.updateValueAndValidity(),this.f.valid&&(console.log("Valid!"),console.log(this.f.value),this.tokenService.set({token:"123"}),this.router.navigate(["dashboard"]))}};he.\u0275fac=function(e){return new(e||he)},he.\u0275cmp=z({type:he,selectors:[["passport-lock"]],decls:15,vars:11,consts:[[1,"ant-card","width-lg",2,"margin","0 auto"],[1,"ant-card-body"],[1,"avatar"],["nzIcon","user","nzSize","large",3,"nzSrc"],["nz-form","","role","form",1,"mt-md",3,"ngSubmit","formGroup"],[3,"nzErrorTip"],["nzSuffixIcon","lock"],["type","password","nz-input","","formControlName","password"],["nz-row","","nzType","flex","nzAlign","middle"],["nz-col","",2,"text-align","right",3,"nzOffset","nzSpan"],["nz-button","","nzType","primary",3,"disabled"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),v(3,"nz-avatar",3),s(),o(4,"form",4),f("ngSubmit",function(){return i.submit()}),o(5,"nz-form-item")(6,"nz-form-control",5),m(7,"i18n"),o(8,"nz-input-group",6),v(9,"input",7),s()()(),o(10,"div",8)(11,"div",9)(12,"button",10),c(13),m(14,"i18n"),s()()()()()()),e&2&&(r(3),p("nzSrc",i.user.avatar),r(),p("formGroup",i.f),r(2),p("nzErrorTip",u(7,7,"validation.password.required")),r(5),p("nzOffset",12)("nzSpan",12),r(),p("disabled",!i.f.valid),r(),x(u(14,9,"app.lock")))},dependencies:[V,R,I,F,B,A,U,Rt,Bt,H,W,q,j,$,K,Ke,S,N,y,_,G,L,O,se],styles:["[_nghost-%COMP%]     .ant-card-body{position:relative;margin-top:80px}[_nghost-%COMP%]     .avatar{position:absolute;top:-20px;left:50%;margin-left:-20px}"]});var et=he;var Se=class Se{constructor(){this.router=n(b);this.message=n(w);this.auth=n(ee);this.startupService=n(te);this.tokenService=n(P);this.reuseTabService=n(re,{optional:!0});this.firebaseUserService=n(le);this.loading=!1}loginAnonymously(){return M(this,null,function*(){this.loading=!0;try{let e=(yield wt(this.auth)).user;yield this.firebaseUserService.saveUser(e,"anonymous").toPromise();let i=yield this.firebaseUserService.getUserProfile(e.uid).toPromise(),a={token:e.uid,name:i?.displayName||e.displayName||e.email||"Anonymous",email:e.email||"",id:e.uid,time:+new Date,role:i?.role||"user",permissions:i?.permissions||["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("\u533F\u540D\u767B\u5165\u6210\u529F\uFF0C\u8A2D\u5B9A token:",a),this.tokenService.set(a),this.message.success("\u533F\u540D\u767B\u5165\u6210\u529F\uFF01"),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let g=this.tokenService.referrer?.url||"/";g.includes("/passport")&&(g="/"),this.router.navigateByUrl(g)})}catch(t){console.error("\u533F\u540D\u767B\u5165\u5931\u6557:",t),this.message.error("\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};Se.\u0275fac=function(e){return new(e||Se)},Se.\u0275cmp=z({type:Se,selectors:[["app-anonymous-login"]],decls:1,vars:0,consts:[["nzType","user","nzTheme","outline",1,"icon",3,"click"]],template:function(e,i){e&1&&(o(0,"nz-icon",0),f("click",function(){return i.loginAnonymously()}),s())},dependencies:[ae,ne],encapsulation:2});var tt=Se;var be=class be{constructor(){this.message=n(w);this.auth=n(ee);this.startupService=n(te);this.router=n(b);this.fb=n(ie);this.tokenService=n(P);this.reuseTabService=n(re,{optional:!0});this.firebaseUserService=n(le);this.loginSuccess=new ue;this.loading=!1;this.loginForm=this.fb.nonNullable.group({email:["",[d.required,d.email]],password:["",[d.required,d.minLength(6)]]})}login(){return M(this,null,function*(){if(this.loginForm.invalid){this.markFormGroupTouched(this.loginForm);return}this.loading=!0;let{email:t,password:e}=this.loginForm.value;try{let a=(yield Tt(this.auth,t,e)).user;yield this.firebaseUserService.saveUser(a,"email").toPromise();let g=yield this.firebaseUserService.getUserProfile(a.uid).toPromise(),C={token:a.uid,name:g?.displayName||a.displayName||a.email||"Anonymous",email:a.email||"",id:a.uid,time:+new Date,role:g?.role||"user",permissions:g?.permissions||["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("\u90F5\u7BB1\u767B\u5165\u6210\u529F\uFF0C\u8A2D\u5B9A token:",C),this.tokenService.set(C),this.message.success("\u90F5\u7BB1\u767B\u5165\u6210\u529F\uFF01"),this.loginSuccess.emit(),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let oe=this.tokenService.referrer?.url||"/";oe.includes("/passport")&&(oe="/"),this.router.navigateByUrl(oe)})}catch(i){console.error("\u767B\u5165\u5931\u6557:",i),this.message.error(this.getErrorMessage(i.code))}finally{this.loading=!1}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let i=t.controls[e];i.markAsTouched(),i.controls&&this.markFormGroupTouched(i)})}getErrorMessage(t){switch(t){case"auth/user-not-found":return"\u7528\u6236\u4E0D\u5B58\u5728";case"auth/wrong-password":return"\u5BC6\u78BC\u932F\u8AA4";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};be.\u0275fac=function(e){return new(e||be)},be.\u0275cmp=z({type:be,selectors:[["app-email-login-form"]],outputs:{loginSuccess:"loginSuccess"},decls:12,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nzErrorTip","\u8ACB\u8F38\u5165\u5BC6\u78BC"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","\u5BC6\u78BC"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,i){e&1&&(o(0,"form",0),f("ngSubmit",function(){return i.login()}),o(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),v(4,"input",3),s()()(),o(5,"nz-form-item")(6,"nz-form-control",4)(7,"nz-input-group",5),v(8,"input",6),s()()(),o(9,"nz-form-item")(10,"button",7),c(11," \u767B\u5165 "),s()()()),e&2&&(p("formGroup",i.loginForm),r(10),p("nzLoading",i.loading))},dependencies:[V,R,I,F,B,A,U,H,W,q,j,$,K,G,L,O,S,N,y,_],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Fe=be;var _e=class _e{constructor(){this.message=n(w);this.auth=n(ee);this.startupService=n(te);this.router=n(b);this.fb=n(ie);this.tokenService=n(P);this.reuseTabService=n(re,{optional:!0});this.firebaseUserService=n(le);this.registerSuccess=new ue;this.loading=!1;this.registerForm=this.fb.nonNullable.group({email:["",[d.required,d.email]],password:["",[d.required,d.minLength(6)]],confirmPassword:["",[d.required]]},{validators:this.passwordMatchValidator})}passwordMatchValidator(t){let e=t.get("password"),i=t.get("confirmPassword");return e&&i&&e.value!==i.value?{passwordMismatch:!0}:null}register(){return M(this,null,function*(){if(this.registerForm.invalid){this.markFormGroupTouched(this.registerForm);return}this.loading=!0;let{email:t,password:e}=this.registerForm.value;try{let a=(yield bt(this.auth,t,e)).user;yield _t(a),yield this.firebaseUserService.saveUser(a,"email").toPromise();let g=yield this.firebaseUserService.getUserProfile(a.uid).toPromise(),C={token:a.uid,name:g?.displayName||a.displayName||a.email||"Anonymous",email:a.email||"",id:a.uid,time:+new Date,role:g?.role||"user",permissions:g?.permissions||["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("\u90F5\u7BB1\u8A3B\u518A\u6210\u529F\uFF0C\u8A2D\u5B9A token:",C),this.tokenService.set(C),this.message.success("\u90F5\u7BB1\u8A3B\u518A\u6210\u529F\uFF01\u8ACB\u6AA2\u67E5\u90F5\u7BB1\u9032\u884C\u9A57\u8B49\u3002"),this.registerSuccess.emit(),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let oe=this.tokenService.referrer?.url||"/";oe.includes("/passport")&&(oe="/"),this.router.navigateByUrl(oe)})}catch(i){console.error("\u8A3B\u518A\u5931\u6557:",i),this.message.error(this.getErrorMessage(i.code))}finally{this.loading=!1}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let i=t.controls[e];i.markAsTouched(),i.controls&&this.markFormGroupTouched(i)})}getErrorMessage(t){switch(t){case"auth/email-already-in-use":return"\u90F5\u7BB1\u5DF2\u88AB\u4F7F\u7528";case"auth/weak-password":return"\u5BC6\u78BC\u5F37\u5EA6\u592A\u5F31";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u8A3B\u518A\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};_e.\u0275fac=function(e){return new(e||_e)},_e.\u0275cmp=z({type:_e,selectors:[["app-email-register-form"]],outputs:{registerSuccess:"registerSuccess"},decls:16,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nzErrorTip","\u5BC6\u78BC\u81F3\u5C116\u4F4D"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","\u5BC6\u78BC"],["nzErrorTip","\u8ACB\u78BA\u8A8D\u5BC6\u78BC"],["nz-input","","type","password","formControlName","confirmPassword","placeholder","\u78BA\u8A8D\u5BC6\u78BC"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,i){e&1&&(o(0,"form",0),f("ngSubmit",function(){return i.register()}),o(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),v(4,"input",3),s()()(),o(5,"nz-form-item")(6,"nz-form-control",4)(7,"nz-input-group",5),v(8,"input",6),s()()(),o(9,"nz-form-item")(10,"nz-form-control",7)(11,"nz-input-group",5),v(12,"input",8),s()()(),o(13,"nz-form-item")(14,"button",9),c(15," \u8A3B\u518A "),s()()()),e&2&&(p("formGroup",i.registerForm),r(14),p("nzLoading",i.loading))},dependencies:[V,R,I,F,B,A,U,H,W,q,j,$,K,G,L,O,S,N,y,_],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Be=_e;var Ne=class Ne{constructor(){this.message=n(w);this.auth=n(ee);this.fb=n(ie);this.resetSuccess=new ue;this.loading=!1;this.resetForm=this.fb.nonNullable.group({email:["",[d.required,d.email]]})}resetPassword(){return M(this,null,function*(){if(this.resetForm.invalid){this.markFormGroupTouched(this.resetForm);return}this.loading=!0;let{email:t}=this.resetForm.value;try{yield Nt(this.auth,t),this.message.success("\u5BC6\u78BC\u91CD\u7F6E\u90F5\u7BB1\u5DF2\u767C\u9001\uFF0C\u8ACB\u6AA2\u67E5\u90F5\u7BB1\u3002"),this.resetSuccess.emit()}catch(e){console.error("\u767C\u9001\u91CD\u7F6E\u90F5\u7BB1\u5931\u6557:",e),this.message.error(this.getErrorMessage(e.code))}finally{this.loading=!1}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let i=t.controls[e];i.markAsTouched(),i.controls&&this.markFormGroupTouched(i)})}getErrorMessage(t){switch(t){case"auth/user-not-found":return"\u7528\u6236\u4E0D\u5B58\u5728";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u767C\u9001\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};Ne.\u0275fac=function(e){return new(e||Ne)},Ne.\u0275cmp=z({type:Ne,selectors:[["app-email-reset-form"]],outputs:{resetSuccess:"resetSuccess"},decls:8,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,i){e&1&&(o(0,"form",0),f("ngSubmit",function(){return i.resetPassword()}),o(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),v(4,"input",3),s()()(),o(5,"nz-form-item")(6,"button",4),c(7," \u767C\u9001\u91CD\u7F6E\u90F5\u7BB1 "),s()()()),e&2&&(p("formGroup",i.resetForm),r(6),p("nzLoading",i.loading))},dependencies:[V,R,I,F,B,A,U,H,W,q,j,$,K,G,L,O,S,N,y,_],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Re=Ne;var we=class we{constructor(){this.modalRef=n(zt)}onLoginSuccess(){this.modalRef.close({type:"login",success:!0})}onRegisterSuccess(){this.modalRef.close({type:"register",success:!0})}onResetSuccess(){this.modalRef.close({type:"reset",success:!0})}};we.\u0275fac=function(e){return new(e||we)},we.\u0275cmp=z({type:we,selectors:[["app-email-login-modal"]],decls:8,vars:4,consts:[[1,"email-auth-modal"],[3,"nzAnimated"],[3,"nzTitle"],[3,"loginSuccess"],[3,"registerSuccess"],[3,"resetSuccess"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"nz-tabs",1)(2,"nz-tab",2)(3,"app-email-login-form",3),f("loginSuccess",function(){return i.onLoginSuccess()}),s()(),o(4,"nz-tab",2)(5,"app-email-register-form",4),f("registerSuccess",function(){return i.onRegisterSuccess()}),s()(),o(6,"nz-tab",2)(7,"app-email-reset-form",5),f("resetSuccess",function(){return i.onResetSuccess()}),s()()()()),e&2&&(r(),p("nzAnimated",!1),r(),p("nzTitle","\u767B\u5165"),r(2),p("nzTitle","\u8A3B\u518A"),r(2),p("nzTitle","\u91CD\u7F6E\u5BC6\u78BC"))},dependencies:[Ct,Xe,Ye,He,Fe,Be,Re],styles:[".email-auth-modal[_ngcontent-%COMP%]{padding:20px 0}.ant-tabs-content-holder[_ngcontent-%COMP%]{padding-top:16px}"]});var Ae=we;var Te=class Te{constructor(){this.message=n(w);this.modalService=n(ht);this.loading=!1}loginWithEmail(){return M(this,null,function*(){this.loading=!0;try{this.modalService.create({nzTitle:"\u90F5\u7BB1\u767B\u5165/\u8A3B\u518A",nzContent:Ae,nzWidth:400,nzFooter:null,nzClosable:!0,nzMaskClosable:!1}).afterClose.subscribe(e=>{e&&e.success&&this.message.success("\u64CD\u4F5C\u6210\u529F\uFF01")})}catch(t){console.error("\u90F5\u7BB1\u767B\u5165\u5931\u6557:",t),this.message.error("\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};Te.\u0275fac=function(e){return new(e||Te)},Te.\u0275cmp=z({type:Te,selectors:[["app-email-login"]],decls:1,vars:0,consts:[["nzType","mail","nzTheme","outline",1,"icon",3,"click"]],template:function(e,i){e&1&&(o(0,"nz-icon",0),f("click",function(){return i.loginWithEmail()}),s())},dependencies:[ae,ne],encapsulation:2});var Ue=Te;var ke=class ke{constructor(){this.router=n(b);this.message=n(w);this.auth=n(ee);this.startupService=n(te);this.tokenService=n(P);this.reuseTabService=n(re,{optional:!0});this.firebaseUserService=n(le);this.loading=!1}loginWithGoogle(){return M(this,null,function*(){this.loading=!0;try{let t=new St,i=(yield kt(this.auth,t)).user;yield this.firebaseUserService.saveUser(i,"google").toPromise();let a=yield this.firebaseUserService.getUserProfile(i.uid).toPromise(),g={token:i.uid,name:a?.displayName||i.displayName||i.email||"Anonymous",email:i.email||"",id:i.uid,time:+new Date,role:a?.role||"user",permissions:a?.permissions||["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("Google \u767B\u5165\u6210\u529F\uFF0C\u8A2D\u5B9A token:",g),this.tokenService.set(g),this.message.success("Google \u767B\u5165\u6210\u529F\uFF01"),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let C=this.tokenService.referrer?.url||"/";C.includes("/passport")&&(C="/"),this.router.navigateByUrl(C)})}catch(t){console.error("Google \u767B\u5165\u5931\u6557:",t),this.message.error("Google \u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};ke.\u0275fac=function(e){return new(e||ke)},ke.\u0275cmp=z({type:ke,selectors:[["app-google-auth"]],decls:1,vars:2,consts:[["nz-tooltip","","nzTooltipTitle","Google \u767B\u5165","nz-icon","","nzType","google",1,"icon",3,"click"]],template:function(e,i){e&1&&(o(0,"i",0),f("click",function(){return i.loginWithGoogle()}),s()),e&2&&lt("loading",i.loading)},dependencies:[S,y,ae,ne,je,$e],styles:[".icon[_ngcontent-%COMP%]{font-size:24px;color:#666;cursor:pointer;transition:color .3s}.icon[_ngcontent-%COMP%]:hover{color:#1890ff}.icon.loading[_ngcontent-%COMP%]{color:#d9d9d9;cursor:not-allowed}"]});var it=ke;function Xt(l,t){if(l&1&&v(0,"nz-alert",4),l&2){let e=pe();p("nzType","error")("nzMessage",e.error)("nzShowIcon",!0)}}function Jt(l,t){l&1&&(c(0),m(1,"i18n")),l&2&&h(" ",u(1,1,"validation.phone-number.required")," ")}function Qt(l,t){l&1&&(c(0),m(1,"i18n")),l&2&&h(" ",u(1,1,"validation.phone-number.wrong-format")," ")}function Zt(l,t){if(l&1&&(E(0,Jt,2,3),E(1,Qt,2,3)),l&2){let e=t.$implicit;D(e.errors.required?0:-1),r(),D(e.errors.pattern?1:-1)}}var Ee=class Ee{constructor(){this.router=n(b);this.settingsService=n(ge);this.socialService=n(ve);this.reuseTabService=n(re,{optional:!0});this.tokenService=n(P);this.startupSrv=n(te);this.http=n(qe);this.cdr=n(Oe);this.form=n(ie).nonNullable.group({userName:["",[d.required,d.pattern(/^(admin|user)$/)]],password:["",[d.required,d.pattern(/^(ng-alain\.com)$/)]],mobile:["",[d.required,d.pattern(/^1\d{10}$/)]],captcha:["",[d.required]],remember:[!0]});this.error="";this.type=0;this.loading=!1;this.count=0}switch({index:t}){this.type=t}getCaptcha(){let t=this.form.controls.mobile;if(t.invalid){t.markAsDirty({onlySelf:!0}),t.updateValueAndValidity({onlySelf:!0});return}this.count=59,this.interval$=setInterval(()=>{this.count-=1,this.count<=0&&clearInterval(this.interval$)},1e3)}submit(){if(this.error="",this.type===0){let{userName:t,password:e}=this.form.controls;if(t.markAsDirty(),t.updateValueAndValidity(),e.markAsDirty(),e.updateValueAndValidity(),t.invalid||e.invalid)return}else{let{mobile:t,captcha:e}=this.form.controls;if(t.markAsDirty(),t.updateValueAndValidity(),e.markAsDirty(),e.updateValueAndValidity(),t.invalid||e.invalid)return}this.loading=!0,this.cdr.detectChanges(),this.http.post("/login/account",{type:this.type,userName:this.form.value.userName,password:this.form.value.password},null,{context:new Ge().set(We,!0)}).pipe(Ve(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(t=>{if(t.msg!=="ok"){this.error=t.msg,this.cdr.detectChanges();return}this.reuseTabService?.clear(),t.user.expired=+new Date+1e3*60*5,this.tokenService.set(t.user),this.startupSrv.load().subscribe(()=>{let e=this.tokenService.referrer.url||"/";e.includes("/passport")&&(e="/"),this.router.navigateByUrl(e)})})}open(t,e="href"){let i="",a="";switch(yt.production?a=`https://ng-alain.github.io/ng-alain/#/passport/callback/${t}`:a=`http://localhost:4200/#/passport/callback/${t}`,t){case"auth0":i=`//cipchk.auth0.com/login?client=8gcNydIDzGBYxzqV0Vm1CX_RXH-wsWo5&redirect_uri=${decodeURIComponent(a)}`;break;case"github":i=`//github.com/login/oauth/authorize?client_id=9d6baae4b04a23fcafa2&response_type=code&redirect_uri=${decodeURIComponent(a)}`;break;case"weibo":i=`https://api.weibo.com/oauth2/authorize?client_id=1239507802&response_type=code&redirect_uri=${decodeURIComponent(a)}`;break}e==="window"?this.socialService.login(i,"/",{type:"window"}).subscribe(g=>{g&&(this.settingsService.setUser(g),this.router.navigateByUrl("/"))}):this.socialService.login(i,"/",{type:"href"})}ngOnDestroy(){this.interval$&&clearInterval(this.interval$)}};Ee.\u0275fac=function(e){return new(e||Ee)},Ee.\u0275cmp=z({type:Ee,selectors:[["passport-login"]],features:[Le([ve])],decls:57,vars:39,consts:[["mobileErrorTip",""],["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"tabs",3,"nzSelectChange","nzAnimated"],[3,"nzTitle"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],["nzErrorTip","Please enter mobile number, muse be: admin or user"],["nzSize","large","nzPrefixIcon","user"],["nz-input","","formControlName","userName","placeholder","username: admin or user"],["nzErrorTip","Please enter password, muse be: ng-alain.com"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","password: ng-alain.com"],[3,"nzErrorTip"],["nz-input","","formControlName","mobile","placeholder","mobile number"],[3,"nzGutter"],[3,"nzSpan"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","captcha","placeholder","captcha"],["type","button","nz-button","","nzSize","large","nzBlock","",3,"click","disabled","nzLoading"],["nz-checkbox","","formControlName","remember"],[1,"text-right",3,"nzSpan"],["routerLink","/passport/register",1,"forgot"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"],[1,"other"],["nz-tooltip","","nzTooltipTitle","in fact Auth0 via window","nz-icon","","nzType","alipay-circle",1,"icon",3,"click"],["nz-tooltip","","nzTooltipTitle","in fact Github via redirect","nz-icon","","nzType","taobao-circle",1,"icon",3,"click"],["nz-icon","","nzType","weibo-circle",1,"icon",3,"click"],["routerLink","/passport/register",1,"register"]],template:function(e,i){if(e&1){let a=de();o(0,"form",1),f("ngSubmit",function(){return T(a),k(i.submit())}),o(1,"nz-tabs",2),f("nzSelectChange",function(C){return T(a),k(i.switch(C))}),o(2,"nz-tab",3),m(3,"i18n"),E(4,Xt,1,3,"nz-alert",4),o(5,"nz-form-item")(6,"nz-form-control",5)(7,"nz-input-group",6),v(8,"input",7),s()()(),o(9,"nz-form-item")(10,"nz-form-control",8)(11,"nz-input-group",9),v(12,"input",10),s()()()(),o(13,"nz-tab",3),m(14,"i18n"),o(15,"nz-form-item")(16,"nz-form-control",11)(17,"nz-input-group",6),v(18,"input",12),s(),J(19,Zt,2,2,"ng-template",null,0,Z),s()(),o(21,"nz-form-item")(22,"nz-form-control",11),m(23,"i18n"),o(24,"nz-row",13)(25,"nz-col",14)(26,"nz-input-group",15),v(27,"input",16),s()(),o(28,"nz-col",14)(29,"button",17),f("click",function(){return T(a),k(i.getCaptcha())}),c(30),m(31,"i18n"),s()()()()()()(),o(32,"nz-form-item")(33,"nz-col",14)(34,"label",18),c(35),m(36,"i18n"),s()(),o(37,"nz-col",19)(38,"a",20),c(39),m(40,"i18n"),s()()(),o(41,"nz-form-item")(42,"button",21),c(43),m(44,"i18n"),s()()(),o(45,"div",22),c(46),m(47,"i18n"),o(48,"i",23),f("click",function(){return T(a),k(i.open("auth0","window"))}),s(),o(49,"i",24),f("click",function(){return T(a),k(i.open("github"))}),s(),o(50,"i",25),f("click",function(){return T(a),k(i.open("weibo","window"))}),s(),v(51,"app-google-auth")(52,"app-anonymous-login")(53,"app-email-login"),o(54,"a",26),c(55),m(56,"i18n"),s()()}if(e&2){let a=Q(20);p("formGroup",i.form),r(),p("nzAnimated",!1),r(),p("nzTitle",u(3,21,"app.login.tab-login-credentials")),r(2),D(i.error?4:-1),r(9),p("nzTitle",u(14,23,"app.login.tab-login-mobile")),r(3),p("nzErrorTip",a),r(6),p("nzErrorTip",u(23,25,"validation.verification-code.required")),r(2),p("nzGutter",8),r(),p("nzSpan",16),r(3),p("nzSpan",8),r(),p("disabled",i.count>=0)("nzLoading",i.loading),r(),h(" ",i.count?i.count+"s":u(31,27,"app.register.get-verification-code")," "),r(3),p("nzSpan",12),r(2),x(u(36,29,"app.login.remember-me")),r(2),p("nzSpan",12),r(2),x(u(40,31,"app.login.forgot-password")),r(3),p("nzLoading",i.loading),r(),h(" ",u(44,33,"app.login.login")," "),r(3),h(" ",u(47,35,"app.login.sign-in-with")," "),r(9),x(u(56,37,"app.login.signup"))}},dependencies:[fe,V,R,I,F,B,A,U,Mt,xt,Xe,Ye,He,Qe,Je,H,W,q,j,$,K,G,L,O,S,N,y,_,je,$e,ae,ne,tt,Ue,it,se],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     .ant-tabs .ant-tabs-bar{margin-bottom:24px;text-align:center;border-bottom:0}[_nghost-%COMP%]     .ant-tabs-tab{font-size:16px;line-height:24px}[_nghost-%COMP%]     .ant-input-affix-wrapper .ant-input:not(:first-child){padding-left:4px}[_nghost-%COMP%]     .icon{cursor:pointer;margin-left:16px;font-size:24px;color:#0003;vertical-align:middle;transition:color .3s}[_nghost-%COMP%]     .icon:hover{color:#1890ff}[_nghost-%COMP%]     app-anonymous-login, [_nghost-%COMP%]     app-email-login, [_nghost-%COMP%]     app-logout{margin-left:16px;display:inline-block;vertical-align:middle}[_nghost-%COMP%]     .other{margin-top:24px;line-height:22px;text-align:left}[_nghost-%COMP%]     .other nz-tooltip{vertical-align:middle}[_nghost-%COMP%]     .other .register{float:right}[data-theme=dark]   [_nghost-%COMP%]     .icon{color:#fff3}[data-theme=dark]   [_nghost-%COMP%]     .icon:hover{color:#fff}"],changeDetection:0});var rt=Ee;function $t(l,t){return e=>{let i=e.get(l),a=e.get(t);return a.errors&&!a.errors.matchControl||(i.value!==a.value?a.setErrors({matchControl:!0}):a.setErrors(null)),null}}var ei=()=>({"width.px":240});function ti(l,t){if(l&1&&v(0,"nz-alert",6),l&2){let e=pe();p("nzType","error")("nzMessage",e.error)("nzShowIcon",!0)}}function ii(l,t){l&1&&(c(0),m(1,"i18n")),l&2&&h(" ",u(1,1,"validation.email.required")," ")}function ri(l,t){l&1&&(c(0),m(1,"i18n")),l&2&&h(" ",u(1,1,"validation.email.wrong-format")," ")}function oi(l,t){if(l&1&&(E(0,ii,2,3),E(1,ri,2,3)),l&2){let e=t.$implicit;D(e.errors!=null&&e.errors.required?0:-1),r(),D(e.errors!=null&&e.errors.email?1:-1)}}function ni(l,t){l&1&&(o(0,"div",24),c(1),m(2,"i18n"),s()),l&2&&(r(),x(u(2,1,"validation.password.strength.strong")))}function ai(l,t){l&1&&(o(0,"div",25),c(1),m(2,"i18n"),s()),l&2&&(r(),x(u(2,1,"validation.password.strength.medium")))}function si(l,t){l&1&&(o(0,"div",26),c(1),m(2,"i18n"),s()),l&2&&(r(),x(u(2,1,"validation.password.strength.short")))}function li(l,t){if(l&1&&(o(0,"div",23),E(1,ni,3,3,"div",24)(2,ai,3,3,"div",25)(3,si,3,3,"div",26),o(4,"div"),v(5,"nz-progress",27),s(),o(6,"p",28),c(7),m(8,"i18n"),s()()),l&2){let e,i=pe();r(),D((e=i.status)==="ok"?1:e==="pass"?2:3),r(3),pt(dt("progress-",i.status)),r(),p("nzPercent",i.progress)("nzStatus",i.passwordProgressMap[i.status])("nzStrokeWidth",6)("nzShowInfo",!1),r(2),x(u(8,9,"validation.password.strength.msg"))}}function pi(l,t){l&1&&(c(0),m(1,"i18n")),l&2&&h(" ",u(1,1,"validation.confirm-password.required")," ")}function mi(l,t){l&1&&(c(0),m(1,"i18n")),l&2&&h(" ",u(1,1,"validation.password.twice")," ")}function ci(l,t){if(l&1&&(E(0,pi,2,3),E(1,mi,2,3)),l&2){let e=t.$implicit;D(e.errors!=null&&e.errors.required?0:-1),r(),D(e.errors!=null&&e.errors.matchControl?1:-1)}}function ui(l,t){l&1&&(o(0,"nz-select",29),v(1,"nz-option",30)(2,"nz-option",30),s()),l&2&&(r(),p("nzLabel","+86")("nzValue","+86"),r(),p("nzLabel","+87")("nzValue","+87"))}function di(l,t){l&1&&(c(0),m(1,"i18n")),l&2&&h(" ",u(1,1,"validation.phone-number.required")," ")}function fi(l,t){l&1&&(c(0),m(1,"i18n")),l&2&&h(" ",u(1,1,"validation.phone-number.wrong-format")," ")}function gi(l,t){if(l&1&&(E(0,di,2,3),E(1,fi,2,3)),l&2){let e=t.$implicit;D(e.errors!=null&&e.errors.required?0:-1),r(),D(e.errors!=null&&e.errors.pattern?1:-1)}}var ce=class ce{constructor(){this.router=n(b);this.http=n(qe);this.cdr=n(Oe);this.form=n(ie).nonNullable.group({mail:["",[d.required,d.email]],password:["",[d.required,d.minLength(6),ce.checkPassword.bind(this)]],confirm:["",[d.required,d.minLength(6)]],mobilePrefix:["+86"],mobile:["",[d.required,d.pattern(/^1\d{10}$/)]],captcha:["",[d.required]]},{validators:$t("password","confirm")});this.error="";this.type=0;this.loading=!1;this.visible=!1;this.status="pool";this.progress=0;this.passwordProgressMap={ok:"success",pass:"normal",pool:"exception"};this.count=0}static checkPassword(t){if(!t)return null;let e=this;e.visible=!!t.value,t.value&&t.value.length>9?e.status="ok":t.value&&t.value.length>5?e.status="pass":e.status="pool",e.visible&&(e.progress=t.value.length*10>100?100:t.value.length*10)}getCaptcha(){let{mobile:t}=this.form.controls;if(t.invalid){t.markAsDirty({onlySelf:!0}),t.updateValueAndValidity({onlySelf:!0});return}this.count=59,this.cdr.detectChanges(),this.interval$=setInterval(()=>{this.count-=1,this.cdr.detectChanges(),this.count<=0&&clearInterval(this.interval$)},1e3)}submit(){if(this.error="",Object.keys(this.form.controls).forEach(e=>{let i=this.form.controls[e];i.markAsDirty(),i.updateValueAndValidity()}),this.form.invalid)return;let t=this.form.value;this.loading=!0,this.cdr.detectChanges(),this.http.post("/register",t,null,{context:new Ge().set(We,!0)}).pipe(Ve(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(()=>{this.router.navigate(["passport","register-result"],{queryParams:{email:t.mail}})})}ngOnDestroy(){this.interval$&&clearInterval(this.interval$)}};ce.\u0275fac=function(e){return new(e||ce)},ce.\u0275cmp=z({type:ce,selectors:[["passport-register"]],decls:50,vars:34,consts:[["mailErrorTip",""],["pwdCdkTpl",""],["confirmErrorTip",""],["addOnBeforeTemplate",""],["mobileErrorTip",""],["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],[3,"nzErrorTip"],["nzSize","large","nzAddonBeforeIcon","user"],["nz-input","","formControlName","mail","placeholder","Email"],["nzSize","large","nzAddonBeforeIcon","lock","nz-popover","","nzPopoverPlacement","right","nzPopoverTrigger","focus","nzPopoverOverlayClassName","register-password-cdk",3,"nzPopoverVisibleChange","nzPopoverVisible","nzPopoverOverlayStyle","nzPopoverContent"],["nz-input","","type","password","formControlName","password","placeholder","Password"],["nzSize","large","nzAddonBeforeIcon","lock"],["nz-input","","type","password","formControlName","confirm","placeholder","Confirm Password"],["nzSize","large",3,"nzAddOnBefore"],["formControlName","mobile","nz-input","","placeholder","Phone number"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nzSize","large","nzAddonBeforeIcon","mail"],["nz-input","","formControlName","captcha","placeholder","Captcha"],["type","button","nz-button","","nzSize","large","nzBlock","",3,"click","disabled","nzLoading"],["nz-button","","nzType","primary","nzSize","large","type","submit",1,"submit",3,"nzLoading"],["routerLink","/passport/login",1,"login"],[2,"padding","4px 0"],[1,"success"],[1,"warning"],[1,"error"],[3,"nzPercent","nzStatus","nzStrokeWidth","nzShowInfo"],[1,"mt-sm"],["formControlName","mobilePrefix",2,"width","100px"],[3,"nzLabel","nzValue"]],template:function(e,i){if(e&1){let a=de();o(0,"h3"),c(1),m(2,"i18n"),s(),o(3,"form",5),f("ngSubmit",function(){return T(a),k(i.submit())}),E(4,ti,1,3,"nz-alert",6),o(5,"nz-form-item")(6,"nz-form-control",7)(7,"nz-input-group",8),v(8,"input",9),s(),J(9,oi,2,2,"ng-template",null,0,Z),s()(),o(11,"nz-form-item")(12,"nz-form-control",7),m(13,"i18n"),o(14,"nz-input-group",10),ut("nzPopoverVisibleChange",function(C){return T(a),ct(i.visible,C)||(i.visible=C),k(C)}),v(15,"input",11),s(),J(16,li,9,11,"ng-template",null,1,Z),s()(),o(18,"nz-form-item")(19,"nz-form-control",7)(20,"nz-input-group",12),v(21,"input",13),s(),J(22,ci,2,2,"ng-template",null,2,Z),s()(),o(24,"nz-form-item")(25,"nz-form-control",7)(26,"nz-input-group",14),J(27,ui,3,4,"ng-template",null,3,Z),v(29,"input",15),s(),J(30,gi,2,2,"ng-template",null,4,Z),s()(),o(32,"nz-form-item")(33,"nz-form-control",7),m(34,"i18n"),o(35,"div",16)(36,"div",17)(37,"nz-input-group",18),v(38,"input",19),s()(),o(39,"div",17)(40,"button",20),f("click",function(){return T(a),k(i.getCaptcha())}),c(41),m(42,"i18n"),s()()()()(),o(43,"nz-form-item")(44,"button",21),c(45),m(46,"i18n"),s(),o(47,"a",22),c(48),m(49,"i18n"),s()()()}if(e&2){let a=Q(10),g=Q(17),C=Q(23),oe=Q(28),jt=Q(31);r(),x(u(2,21,"app.register.register")),r(2),p("formGroup",i.form),r(),D(i.error?4:-1),r(2),p("nzErrorTip",a),r(6),p("nzErrorTip",u(13,23,"validation.password.required")),r(2),mt("nzPopoverVisible",i.visible),p("nzPopoverOverlayStyle",ft(33,ei))("nzPopoverContent",g),r(5),p("nzErrorTip",C),r(6),p("nzErrorTip",jt),r(),p("nzAddOnBefore",oe),r(7),p("nzErrorTip",u(34,25,"validation.verification-code.required")),r(2),p("nzGutter",8),r(),p("nzSpan",16),r(3),p("nzSpan",8),r(),p("disabled",i.count>0)("nzLoading",i.loading),r(),h(" ",i.count?i.count+"s":u(42,27,"app.register.get-verification-code")," "),r(3),p("nzLoading",i.loading),r(),h(" ",u(46,29,"app.register.register")," "),r(3),x(u(49,31,"app.register.sign-in"))}},dependencies:[V,R,I,F,B,A,U,fe,Qe,Je,H,W,q,j,$,K,G,L,O,Ut,At,Lt,Vt,Ft,Pt,It,Ke,S,N,y,_,se],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     h3{margin-bottom:20px;font-size:16px}[_nghost-%COMP%]     .submit{width:50%}[_nghost-%COMP%]     .login{float:right;line-height:40px}  .register-password-cdk .success,   .register-password-cdk .warning,   .register-password-cdk .error{transition:color .3s}  .register-password-cdk .success{color:#52c41a}  .register-password-cdk .warning{color:#faad14}  .register-password-cdk .error{color:#ff4d4f}  .register-password-cdk .progress-pass>.progress .ant-progress-bg{background-color:#faad14}"],changeDetection:0});var ot=ce;var vi=l=>({email:l});function zi(l,t){if(l&1&&(o(0,"div",5),c(1),m(2,"i18n"),s()),l&2){let e=pe();r(),h(" ",vt(2,1,"app.register-result.msg",gt(4,vi,e.email))," ")}}var De=class De{constructor(){this.msg=n(w);this.email=""}};De.\u0275fac=function(e){return new(e||De)},De.\u0275cmp=z({type:De,selectors:[["passport-register-result"]],inputs:{email:"email"},decls:11,vars:11,consts:[["title",""],["nzStatus","success",3,"nzTitle","nzSubTitle"],["nz-result-extra",""],["nz-button","","nzSize","large",3,"click","nzType"],["routerLink","/","nz-button","","nzSize","large"],[1,"title",2,"font-size","20px"]],template:function(e,i){if(e&1){let a=de();o(0,"nz-result",1),m(1,"i18n"),J(2,zi,3,6,"ng-template",null,0,Z),o(4,"div",2)(5,"button",3),f("click",function(){return T(a),k(i.msg.success("email"))}),c(6),m(7,"i18n"),s(),o(8,"button",4),c(9),m(10,"i18n"),s()()()}if(e&2){let a=Q(3);p("nzTitle",a)("nzSubTitle",u(1,5,"app.register-result.activation-email")),r(5),p("nzType","primary"),r(),h(" ",u(7,7,"app.register-result.view-mailbox")," "),r(3),h(" ",u(10,9,"app.register-result.back-home")," ")}},dependencies:[fe,S,N,y,_,Wt,qt,Gt,se],encapsulation:2});var nt=De;var jn=[{path:"passport",component:Ot,children:[{path:"login",component:rt,data:{title:"\u767B\u5F55",titleI18n:"app.login.login"}},{path:"register",component:ot,data:{title:"\u6CE8\u518C",titleI18n:"app.register.register"}},{path:"register-result",component:nt,data:{title:"\u6CE8\u518C\u7ED3\u679C",titleI18n:"app.register.register"}},{path:"lock",component:et,data:{title:"\u9501\u5C4F",titleI18n:"app.lock"}}]},{path:"passport/callback/:type",component:Ze}];export{jn as routes};
