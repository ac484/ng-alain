import{a as zt,h as X,l as Vt}from"./chunk-6AGGTS5M.js";import{a as E,b as ge,c as We}from"./chunk-FWCJCGS4.js";import{a as ae}from"./chunk-KW3MZJ7J.js";import{a as Gt,b as qt,c as Wt}from"./chunk-FJGPJDJU.js";import"./chunk-44R3SSZZ.js";import{A as _t,n as ht,o as Y,t as Ct,w as yt,x as St,y as bt,z as Nt}from"./chunk-CAC53LLX.js";import"./chunk-VAGS5EVQ.js";import{b as Pt,c as Ft,d as It,e as Q}from"./chunk-GHELFDSU.js";import{a as At,b as Ut}from"./chunk-IFZ7MDFP.js";import{a as He,b as Ye}from"./chunk-54SOX2ZU.js";import"./chunk-XL3LSW66.js";import{a as Ot,b as Lt}from"./chunk-7HKXGGQW.js";import{a as V,b as G,c as q,e as W}from"./chunk-RJ372NDN.js";import{a as Bt,c as Rt}from"./chunk-LJN6UZUT.js";import{a as O,b as L,c as Ke}from"./chunk-3XJPIDKW.js";import{d as w}from"./chunk-FNQFXT4L.js";import"./chunk-PERLWIG6.js";import{B as qe,u as fe,y as ne}from"./chunk-2EP5JZV5.js";import"./chunk-R3GMTCLS.js";import"./chunk-BP5QTQZC.js";import"./chunk-4XJX3Z43.js";import{c as je,e as $e}from"./chunk-2AKQOGSQ.js";import{f as R,h as A,k as U}from"./chunk-IKXE7RY5.js";import"./chunk-BDB47AP6.js";import{b as kt,d as Et}from"./chunk-UEJJLST4.js";import"./chunk-X4BKJH5O.js";import"./chunk-7OVKJLC6.js";import{b as Dt,c as Mt,d as xt}from"./chunk-FNIJTO6G.js";import"./chunk-YLT4J452.js";import"./chunk-PUYN37MU.js";import{d as D,e as u,g as M,h as x,j as wt,l as Tt,n as P,q as F,t as I,x as J,z as B}from"./chunk-Q4M6B46D.js";import{g as ft,h as gt,k as vt}from"./chunk-ZUQ3JNJU.js";import"./chunk-JAU2U3S7.js";import"./chunk-LGE3RKIU.js";import{m as b,n as de}from"./chunk-XKNLJG3X.js";import"./chunk-WAQYDUON.js";import"./chunk-67AL53VY.js";import"./chunk-CGTTSKG2.js";import"./chunk-QHSDKNHJ.js";import"./chunk-HG76SPUR.js";import"./chunk-VECD6G7R.js";import"./chunk-JKCE4WUB.js";import{k as C,t as N,v as _,w as y}from"./chunk-HFO44OZB.js";import{$b as f,Aa as ce,Cc as pt,Fc as Le,Gc as ct,Hb as j,Hc as ut,Jb as $,Lc as c,Mc as d,Nc as dt,Ob as m,Oh as oe,Pb as o,Pc as ie,Ph as re,Qb as s,Rb as g,Sd as Ge,W as Ue,Yb as Oe,cb as n,cc as se,gd as Ve,mc as te,ob as v,oc as nt,qc as at,rc as p,sc as T,ta as r,tc as h,ub as ee,vc as st,wb as ue,wc as lt,xc as mt,za as pe}from"./chunk-C2TUN3UK.js";import{a as ot,i as k}from"./chunk-57BLH6QZ.js";var ve=class ve{constructor(){this.socialService=r(ge);this.settingsSrv=r(fe);this.type=""}ngOnInit(){this.mockModel()}mockModel(){let i={token:"123456789",name:"cipchk",email:`${this.type}@${this.type}.com`,id:1e4,time:+new Date};this.settingsSrv.setUser(ot(ot({},this.settingsSrv.user),i)),this.socialService.callback(i)}};ve.\u0275fac=function(e){return new(e||ve)},ve.\u0275cmp=v({type:ve,selectors:[["app-callback"]],inputs:{type:"type"},features:[Le([ge])],decls:0,vars:0,template:function(e,t){},encapsulation:2});var Xe=ve;var ze=class ze{constructor(){this.tokenService=r(E);this.settings=r(fe);this.router=r(b);this.f=new wt({password:new Tt("",{nonNullable:!0,validators:[u.required]})})}get user(){return this.settings.user}submit(){this.f.controls.password.markAsDirty(),this.f.controls.password.updateValueAndValidity(),this.f.valid&&(console.log("Valid!"),console.log(this.f.value),this.tokenService.set({token:"123"}),this.router.navigate(["dashboard"]))}};ze.\u0275fac=function(e){return new(e||ze)},ze.\u0275cmp=v({type:ze,selectors:[["passport-lock"]],decls:15,vars:11,consts:[[1,"ant-card","width-lg",2,"margin","0 auto"],[1,"ant-card-body"],[1,"avatar"],["nzIcon","user","nzSize","large",3,"nzSrc"],["nz-form","","role","form",1,"mt-md",3,"ngSubmit","formGroup"],[3,"nzErrorTip"],["nzSuffixIcon","lock"],["type","password","nz-input","","formControlName","password"],["nz-row","","nzType","flex","nzAlign","middle"],["nz-col","",2,"text-align","right",3,"nzOffset","nzSpan"],["nz-button","","nzType","primary",3,"disabled"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),g(3,"nz-avatar",3),s(),o(4,"form",4),f("ngSubmit",function(){return t.submit()}),o(5,"nz-form-item")(6,"nz-form-control",5),c(7,"i18n"),o(8,"nz-input-group",6),g(9,"input",7),s()()(),o(10,"div",8)(11,"div",9)(12,"button",10),p(13),c(14,"i18n"),s()()()()()()),e&2&&(n(3),m("nzSrc",t.user.avatar),n(),m("formGroup",t.f),n(2),m("nzErrorTip",d(7,7,"validation.password.required")),n(5),m("nzOffset",12)("nzSpan",12),n(),m("disabled",!t.f.valid),n(),T(d(14,9,"app.lock")))},dependencies:[B,P,D,M,x,F,I,Rt,Bt,W,L,O,G,V,q,Ke,y,_,C,N,U,R,A,ne],styles:["[_nghost-%COMP%]     .ant-card-body{position:relative;margin-top:80px}[_nghost-%COMP%]     .avatar{position:absolute;top:-20px;left:50%;margin-left:-20px}"]});var Je=ze;var ye=class ye{constructor(){this.router=r(b);this.message=r(w);this.auth=r(Y);this.startupService=r(X);this.tokenService=r(E);this.reuseTabService=r(Q,{optional:!0});this.firebaseUserService=r(ae);this.loading=!1}loginAnonymously(){return k(this,null,function*(){this.loading=!0;try{let e=(yield bt(this.auth)).user;yield this.firebaseUserService.saveUser(e,"anonymous").toPromise();let t=yield this.firebaseUserService.getUserProfile(e.uid).toPromise(),a={token:e.uid,name:t?.displayName||e.displayName||e.email||"Anonymous",email:e.email||"",id:e.uid,time:+new Date,role:t?.role||"user",permissions:t?.permissions||["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("\u533F\u540D\u767B\u5165\u6210\u529F\uFF0C\u8A2D\u5B9A token:",a),this.tokenService.set(a),this.message.success("\u533F\u540D\u767B\u5165\u6210\u529F\uFF01"),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let z=this.tokenService.referrer?.url||"/";z.includes("/passport")&&(z="/"),this.router.navigateByUrl(z)})}catch(i){console.error("\u533F\u540D\u767B\u5165\u5931\u6557:",i),this.message.error("\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};ye.\u0275fac=function(e){return new(e||ye)},ye.\u0275cmp=v({type:ye,selectors:[["app-anonymous-login"]],decls:1,vars:0,consts:[["nzType","user","nzTheme","outline",1,"icon",3,"click"]],template:function(e,t){e&1&&(o(0,"nz-icon",0),f("click",function(){return t.loginAnonymously()}),s())},dependencies:[re,oe],encapsulation:2});var Qe=ye;var Se=class Se{constructor(){this.message=r(w);this.auth=r(Y);this.startupService=r(X);this.router=r(b);this.fb=r(J);this.tokenService=r(E);this.reuseTabService=r(Q,{optional:!0});this.firebaseUserService=r(ae);this.loginSuccess=new ue;this.loading=!1;this.loginForm=this.fb.nonNullable.group({email:["",[u.required,u.email]],password:["",[u.required,u.minLength(6)]]})}login(){return k(this,null,function*(){if(this.loginForm.invalid){this.markFormGroupTouched(this.loginForm);return}this.loading=!0;let{email:i,password:e}=this.loginForm.value;try{let a=(yield Nt(this.auth,i,e)).user;yield this.firebaseUserService.saveUser(a,"email").toPromise();let z=yield this.firebaseUserService.getUserProfile(a.uid).toPromise(),S={token:a.uid,name:z?.displayName||a.displayName||a.email||"Anonymous",email:a.email||"",id:a.uid,time:+new Date,role:z?.role||"user",permissions:z?.permissions||["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("\u90F5\u7BB1\u767B\u5165\u6210\u529F\uFF0C\u8A2D\u5B9A token:",S),this.tokenService.set(S),this.message.success("\u90F5\u7BB1\u767B\u5165\u6210\u529F\uFF01"),this.loginSuccess.emit(),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let Z=this.tokenService.referrer?.url||"/";Z.includes("/passport")&&(Z="/"),this.router.navigateByUrl(Z)})}catch(t){console.error("\u767B\u5165\u5931\u6557:",t),this.message.error(this.getErrorMessage(t.code))}finally{this.loading=!1}})}markFormGroupTouched(i){Object.keys(i.controls).forEach(e=>{let t=i.controls[e];t.markAsTouched(),t.controls&&this.markFormGroupTouched(t)})}getErrorMessage(i){switch(i){case"auth/user-not-found":return"\u7528\u6236\u4E0D\u5B58\u5728";case"auth/wrong-password":return"\u5BC6\u78BC\u932F\u8AA4";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};Se.\u0275fac=function(e){return new(e||Se)},Se.\u0275cmp=v({type:Se,selectors:[["app-email-login-form"]],outputs:{loginSuccess:"loginSuccess"},decls:12,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nzErrorTip","\u8ACB\u8F38\u5165\u5BC6\u78BC"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","\u5BC6\u78BC"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,t){e&1&&(o(0,"form",0),f("ngSubmit",function(){return t.login()}),o(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),g(4,"input",3),s()()(),o(5,"nz-form-item")(6,"nz-form-control",4)(7,"nz-input-group",5),g(8,"input",6),s()()(),o(9,"nz-form-item")(10,"button",7),p(11," \u767B\u5165 "),s()()()),e&2&&(m("formGroup",t.loginForm),n(10),m("nzLoading",t.loading))},dependencies:[B,P,D,M,x,F,I,W,L,O,G,V,q,U,R,A,y,_,C,N],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Fe=Se;var be=class be{constructor(){this.message=r(w);this.auth=r(Y);this.startupService=r(X);this.router=r(b);this.fb=r(J);this.tokenService=r(E);this.reuseTabService=r(Q,{optional:!0});this.firebaseUserService=r(ae);this.registerSuccess=new ue;this.loading=!1;this.registerForm=this.fb.nonNullable.group({email:["",[u.required,u.email]],password:["",[u.required,u.minLength(6)]],confirmPassword:["",[u.required]]},{validators:this.passwordMatchValidator})}passwordMatchValidator(i){let e=i.get("password"),t=i.get("confirmPassword");return e&&t&&e.value!==t.value?{passwordMismatch:!0}:null}register(){return k(this,null,function*(){if(this.registerForm.invalid){this.markFormGroupTouched(this.registerForm);return}this.loading=!0;let{email:i,password:e}=this.registerForm.value;try{let a=(yield Ct(this.auth,i,e)).user;yield yt(a),yield this.firebaseUserService.saveUser(a,"email").toPromise();let z=yield this.firebaseUserService.getUserProfile(a.uid).toPromise(),S={token:a.uid,name:z?.displayName||a.displayName||a.email||"Anonymous",email:a.email||"",id:a.uid,time:+new Date,role:z?.role||"user",permissions:z?.permissions||["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("\u90F5\u7BB1\u8A3B\u518A\u6210\u529F\uFF0C\u8A2D\u5B9A token:",S),this.tokenService.set(S),this.message.success("\u90F5\u7BB1\u8A3B\u518A\u6210\u529F\uFF01\u8ACB\u6AA2\u67E5\u90F5\u7BB1\u9032\u884C\u9A57\u8B49\u3002"),this.registerSuccess.emit(),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let Z=this.tokenService.referrer?.url||"/";Z.includes("/passport")&&(Z="/"),this.router.navigateByUrl(Z)})}catch(t){console.error("\u8A3B\u518A\u5931\u6557:",t),this.message.error(this.getErrorMessage(t.code))}finally{this.loading=!1}})}markFormGroupTouched(i){Object.keys(i.controls).forEach(e=>{let t=i.controls[e];t.markAsTouched(),t.controls&&this.markFormGroupTouched(t)})}getErrorMessage(i){switch(i){case"auth/email-already-in-use":return"\u90F5\u7BB1\u5DF2\u88AB\u4F7F\u7528";case"auth/weak-password":return"\u5BC6\u78BC\u5F37\u5EA6\u592A\u5F31";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u8A3B\u518A\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};be.\u0275fac=function(e){return new(e||be)},be.\u0275cmp=v({type:be,selectors:[["app-email-register-form"]],outputs:{registerSuccess:"registerSuccess"},decls:16,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nzErrorTip","\u5BC6\u78BC\u81F3\u5C116\u4F4D"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","\u5BC6\u78BC"],["nzErrorTip","\u8ACB\u78BA\u8A8D\u5BC6\u78BC"],["nz-input","","type","password","formControlName","confirmPassword","placeholder","\u78BA\u8A8D\u5BC6\u78BC"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,t){e&1&&(o(0,"form",0),f("ngSubmit",function(){return t.register()}),o(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),g(4,"input",3),s()()(),o(5,"nz-form-item")(6,"nz-form-control",4)(7,"nz-input-group",5),g(8,"input",6),s()()(),o(9,"nz-form-item")(10,"nz-form-control",7)(11,"nz-input-group",5),g(12,"input",8),s()()(),o(13,"nz-form-item")(14,"button",9),p(15," \u8A3B\u518A "),s()()()),e&2&&(m("formGroup",t.registerForm),n(14),m("nzLoading",t.loading))},dependencies:[B,P,D,M,x,F,I,W,L,O,G,V,q,U,R,A,y,_,C,N],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Ie=be;var Ne=class Ne{constructor(){this.message=r(w);this.auth=r(Y);this.fb=r(J);this.resetSuccess=new ue;this.loading=!1;this.resetForm=this.fb.nonNullable.group({email:["",[u.required,u.email]]})}resetPassword(){return k(this,null,function*(){if(this.resetForm.invalid){this.markFormGroupTouched(this.resetForm);return}this.loading=!0;let{email:i}=this.resetForm.value;try{yield St(this.auth,i),this.message.success("\u5BC6\u78BC\u91CD\u7F6E\u90F5\u7BB1\u5DF2\u767C\u9001\uFF0C\u8ACB\u6AA2\u67E5\u90F5\u7BB1\u3002"),this.resetSuccess.emit()}catch(e){console.error("\u767C\u9001\u91CD\u7F6E\u90F5\u7BB1\u5931\u6557:",e),this.message.error(this.getErrorMessage(e.code))}finally{this.loading=!1}})}markFormGroupTouched(i){Object.keys(i.controls).forEach(e=>{let t=i.controls[e];t.markAsTouched(),t.controls&&this.markFormGroupTouched(t)})}getErrorMessage(i){switch(i){case"auth/user-not-found":return"\u7528\u6236\u4E0D\u5B58\u5728";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u767C\u9001\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};Ne.\u0275fac=function(e){return new(e||Ne)},Ne.\u0275cmp=v({type:Ne,selectors:[["app-email-reset-form"]],outputs:{resetSuccess:"resetSuccess"},decls:8,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,t){e&1&&(o(0,"form",0),f("ngSubmit",function(){return t.resetPassword()}),o(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),g(4,"input",3),s()()(),o(5,"nz-form-item")(6,"button",4),p(7," \u767C\u9001\u91CD\u7F6E\u90F5\u7BB1 "),s()()()),e&2&&(m("formGroup",t.resetForm),n(6),m("nzLoading",t.loading))},dependencies:[B,P,D,M,x,F,I,W,L,O,G,V,q,U,R,A,y,_,C,N],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Be=Ne;var _e=class _e{constructor(){this.modalRef=r(ft)}onLoginSuccess(){this.modalRef.close({type:"login",success:!0})}onRegisterSuccess(){this.modalRef.close({type:"register",success:!0})}onResetSuccess(){this.modalRef.close({type:"reset",success:!0})}};_e.\u0275fac=function(e){return new(e||_e)},_e.\u0275cmp=v({type:_e,selectors:[["app-email-login-modal"]],decls:8,vars:4,consts:[[1,"email-auth-modal"],[3,"nzAnimated"],[3,"nzTitle"],[3,"loginSuccess"],[3,"registerSuccess"],[3,"resetSuccess"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"nz-tabs",1)(2,"nz-tab",2)(3,"app-email-login-form",3),f("loginSuccess",function(){return t.onLoginSuccess()}),s()(),o(4,"nz-tab",2)(5,"app-email-register-form",4),f("registerSuccess",function(){return t.onRegisterSuccess()}),s()(),o(6,"nz-tab",2)(7,"app-email-reset-form",5),f("resetSuccess",function(){return t.onResetSuccess()}),s()()()()),e&2&&(n(),m("nzAnimated",!1),n(),m("nzTitle","\u767B\u5165"),n(2),m("nzTitle","\u8A3B\u518A"),n(2),m("nzTitle","\u91CD\u7F6E\u5BC6\u78BC"))},dependencies:[vt,It,Ft,Pt,Fe,Ie,Be],styles:[".email-auth-modal[_ngcontent-%COMP%]{padding:20px 0}.ant-tabs-content-holder[_ngcontent-%COMP%]{padding-top:16px}"]});var Re=_e;var we=class we{constructor(){this.message=r(w);this.modalService=r(gt);this.loading=!1}loginWithEmail(){return k(this,null,function*(){this.loading=!0;try{this.modalService.create({nzTitle:"\u90F5\u7BB1\u767B\u5165/\u8A3B\u518A",nzContent:Re,nzWidth:400,nzFooter:null,nzClosable:!0,nzMaskClosable:!1}).afterClose.subscribe(e=>{e&&e.success&&this.message.success("\u64CD\u4F5C\u6210\u529F\uFF01")})}catch(i){console.error("\u90F5\u7BB1\u767B\u5165\u5931\u6557:",i),this.message.error("\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};we.\u0275fac=function(e){return new(e||we)},we.\u0275cmp=v({type:we,selectors:[["app-email-login"]],decls:1,vars:0,consts:[["nzType","mail","nzTheme","outline",1,"icon",3,"click"]],template:function(e,t){e&1&&(o(0,"nz-icon",0),f("click",function(){return t.loginWithEmail()}),s())},dependencies:[re,oe],encapsulation:2});var Ae=we;var Te=class Te{constructor(){this.router=r(b);this.message=r(w);this.auth=r(Y);this.startupService=r(X);this.tokenService=r(E);this.reuseTabService=r(Q,{optional:!0});this.firebaseUserService=r(ae);this.loading=!1}loginWithGoogle(){return k(this,null,function*(){this.loading=!0;try{let i=new ht,t=(yield _t(this.auth,i)).user;yield this.firebaseUserService.saveUser(t,"google").toPromise();let a=yield this.firebaseUserService.getUserProfile(t.uid).toPromise(),z={token:t.uid,name:a?.displayName||t.displayName||t.email||"Anonymous",email:t.email||"",id:t.uid,time:+new Date,role:a?.role||"user",permissions:a?.permissions||["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("Google \u767B\u5165\u6210\u529F\uFF0C\u8A2D\u5B9A token:",z),this.tokenService.set(z),this.message.success("Google \u767B\u5165\u6210\u529F\uFF01"),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let S=this.tokenService.referrer?.url||"/";S.includes("/passport")&&(S="/"),this.router.navigateByUrl(S)})}catch(i){console.error("Google \u767B\u5165\u5931\u6557:",i),this.message.error("Google \u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};Te.\u0275fac=function(e){return new(e||Te)},Te.\u0275cmp=v({type:Te,selectors:[["app-google-auth"]],decls:1,vars:2,consts:[["nz-tooltip","","nzTooltipTitle","Google \u767B\u5165","nz-icon","","nzType","google",1,"icon",3,"click"]],template:function(e,t){e&1&&(o(0,"i",0),f("click",function(){return t.loginWithGoogle()}),s()),e&2&&nt("loading",t.loading)},dependencies:[y,C,re,oe,$e,je],styles:[".icon[_ngcontent-%COMP%]{font-size:24px;color:#666;cursor:pointer;transition:color .3s}.icon[_ngcontent-%COMP%]:hover{color:#1890ff}.icon.loading[_ngcontent-%COMP%]{color:#d9d9d9;cursor:not-allowed}"]});var Ze=Te;function Yt(l,i){if(l&1&&g(0,"nz-alert",1),l&2){let e=se();m("nzType","error")("nzMessage",e.error)("nzShowIcon",!0)}}var ke=class ke{constructor(){this.router=r(b);this.settingsService=r(fe);this.socialService=r(ge);this.reuseTabService=r(Q,{optional:!0});this.tokenService=r(E);this.startupSrv=r(X);this.http=r(qe);this.cdr=r(Ve);this.form=r(J).nonNullable.group({userName:["",[u.required,u.pattern(/^(admin|user)$/)]],password:["",[u.required,u.pattern(/^(ng-alain\.com)$/)]],remember:[!0]});this.error="";this.loading=!1}submit(){this.error="";let{userName:i,password:e}=this.form.controls;i.markAsDirty(),i.updateValueAndValidity(),e.markAsDirty(),e.updateValueAndValidity(),!(i.invalid||e.invalid)&&(this.loading=!0,this.cdr.detectChanges(),this.http.post("/login/account",{userName:this.form.value.userName,password:this.form.value.password},null,{context:new Ge().set(We,!0)}).pipe(Ue(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(t=>{if(t.msg!=="ok"){this.error=t.msg,this.cdr.detectChanges();return}this.reuseTabService?.clear(),t.user.expired=+new Date+1e3*60*5,this.tokenService.set(t.user),this.startupSrv.load().subscribe(()=>{let a=this.tokenService.referrer.url||"/";a.includes("/passport")&&(a="/"),this.router.navigateByUrl(a)})}))}open(i,e="href"){let t="",a="";switch(zt.production?a=`https://ng-alain.github.io/ng-alain/#/passport/callback/${i}`:a=`http://localhost:4200/#/passport/callback/${i}`,i){case"auth0":t=`//cipchk.auth0.com/login?client=8gcNydIDzGBYxzqV0Vm1CX_RXH-wsWo5&redirect_uri=${decodeURIComponent(a)}`;break;case"github":t=`//github.com/login/oauth/authorize?client_id=9d6baae4b04a23fcafa2&response_type=code&redirect_uri=${decodeURIComponent(a)}`;break;case"weibo":t=`https://api.weibo.com/oauth2/authorize?client_id=1239507802&response_type=code&redirect_uri=${decodeURIComponent(a)}`;break}e==="window"?this.socialService.login(t,"/",{type:"window"}).subscribe(z=>{z&&(this.settingsService.setUser(z),this.router.navigateByUrl("/"))}):this.socialService.login(t,"/",{type:"href"})}ngOnDestroy(){}};ke.\u0275fac=function(e){return new(e||ke)},ke.\u0275cmp=v({type:ke,selectors:[["passport-login"]],features:[Le([ge])],decls:35,vars:20,consts:[["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],["nzErrorTip","Please enter mobile number, muse be: admin or user"],["nzSize","large","nzPrefixIcon","user"],["nz-input","","formControlName","userName","placeholder","username: admin or user"],["nzErrorTip","Please enter password, muse be: ng-alain.com"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","password: ng-alain.com"],[3,"nzSpan"],["nz-checkbox","","formControlName","remember"],[1,"text-right",3,"nzSpan"],["routerLink","/passport/register",1,"forgot"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"],[1,"other"],["nz-tooltip","","nzTooltipTitle","in fact Auth0 via window","nz-icon","","nzType","alipay-circle",1,"icon",3,"click"],["nz-tooltip","","nzTooltipTitle","in fact Github via redirect","nz-icon","","nzType","taobao-circle",1,"icon",3,"click"],["nz-icon","","nzType","weibo-circle",1,"icon",3,"click"],["routerLink","/passport/register",1,"register"]],template:function(e,t){e&1&&(o(0,"form",0),f("ngSubmit",function(){return t.submit()}),j(1,Yt,1,3,"nz-alert",1),o(2,"nz-form-item")(3,"nz-form-control",2)(4,"nz-input-group",3),g(5,"input",4),s()()(),o(6,"nz-form-item")(7,"nz-form-control",5)(8,"nz-input-group",6),g(9,"input",7),s()()(),o(10,"nz-form-item")(11,"nz-col",8)(12,"label",9),p(13),c(14,"i18n"),s()(),o(15,"nz-col",10)(16,"a",11),p(17),c(18,"i18n"),s()()(),o(19,"nz-form-item")(20,"button",12),p(21),c(22,"i18n"),s()()(),o(23,"div",13),p(24),c(25,"i18n"),o(26,"i",14),f("click",function(){return t.open("auth0","window")}),s(),o(27,"i",15),f("click",function(){return t.open("github")}),s(),o(28,"i",16),f("click",function(){return t.open("weibo","window")}),s(),g(29,"app-google-auth")(30,"app-anonymous-login")(31,"app-email-login"),o(32,"a",17),p(33),c(34,"i18n"),s()()),e&2&&(m("formGroup",t.form),n(),$(t.error?1:-1),n(10),m("nzSpan",12),n(2),T(d(14,10,"app.login.remember-me")),n(2),m("nzSpan",12),n(2),T(d(18,12,"app.login.forgot-password")),n(3),m("nzLoading",t.loading),n(),h(" ",d(22,14,"app.login.login")," "),n(3),h(" ",d(25,16,"app.login.sign-in-with")," "),n(9),T(d(34,18,"app.login.signup")))},dependencies:[de,B,P,D,M,x,F,I,Et,kt,Ye,He,W,L,O,G,V,q,U,R,A,y,_,C,N,$e,je,re,oe,Qe,Ae,Ze,ne],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     .ant-input-affix-wrapper .ant-input:not(:first-child){padding-left:4px}[_nghost-%COMP%]     .icon{cursor:pointer;margin-left:16px;font-size:24px;color:#0003;vertical-align:middle;transition:color .3s}[_nghost-%COMP%]     .icon:hover{color:#1890ff}[_nghost-%COMP%]     app-anonymous-login, [_nghost-%COMP%]     app-email-login, [_nghost-%COMP%]     app-logout{margin-left:16px;display:inline-block;vertical-align:middle}[_nghost-%COMP%]     .other{margin-top:24px;line-height:22px;text-align:left}[_nghost-%COMP%]     .other nz-tooltip{vertical-align:middle}[_nghost-%COMP%]     .other .register{float:right}[data-theme=dark]   [_nghost-%COMP%]     .icon{color:#fff3}[data-theme=dark]   [_nghost-%COMP%]     .icon:hover{color:#fff}"],changeDetection:0});var et=ke;function jt(l,i){return e=>{let t=e.get(l),a=e.get(i);return a.errors&&!a.errors.matchControl||(t.value!==a.value?a.setErrors({matchControl:!0}):a.setErrors(null)),null}}var Xt=()=>({"width.px":240});function Jt(l,i){if(l&1&&g(0,"nz-alert",6),l&2){let e=se();m("nzType","error")("nzMessage",e.error)("nzShowIcon",!0)}}function Qt(l,i){l&1&&(p(0),c(1,"i18n")),l&2&&h(" ",d(1,1,"validation.email.required")," ")}function Zt(l,i){l&1&&(p(0),c(1,"i18n")),l&2&&h(" ",d(1,1,"validation.email.wrong-format")," ")}function ei(l,i){if(l&1&&(j(0,Qt,2,3),j(1,Zt,2,3)),l&2){let e=i.$implicit;$(e.errors!=null&&e.errors.required?0:-1),n(),$(e.errors!=null&&e.errors.email?1:-1)}}function ti(l,i){l&1&&(o(0,"div",24),p(1),c(2,"i18n"),s()),l&2&&(n(),T(d(2,1,"validation.password.strength.strong")))}function ii(l,i){l&1&&(o(0,"div",25),p(1),c(2,"i18n"),s()),l&2&&(n(),T(d(2,1,"validation.password.strength.medium")))}function oi(l,i){l&1&&(o(0,"div",26),p(1),c(2,"i18n"),s()),l&2&&(n(),T(d(2,1,"validation.password.strength.short")))}function ri(l,i){if(l&1&&(o(0,"div",23),j(1,ti,3,3,"div",24)(2,ii,3,3,"div",25)(3,oi,3,3,"div",26),o(4,"div"),g(5,"nz-progress",27),s(),o(6,"p",28),p(7),c(8,"i18n"),s()()),l&2){let e,t=se();n(),$((e=t.status)==="ok"?1:e==="pass"?2:3),n(3),at(pt("progress-",t.status)),n(),m("nzPercent",t.progress)("nzStatus",t.passwordProgressMap[t.status])("nzStrokeWidth",6)("nzShowInfo",!1),n(2),T(d(8,9,"validation.password.strength.msg"))}}function ni(l,i){l&1&&(p(0),c(1,"i18n")),l&2&&h(" ",d(1,1,"validation.confirm-password.required")," ")}function ai(l,i){l&1&&(p(0),c(1,"i18n")),l&2&&h(" ",d(1,1,"validation.password.twice")," ")}function si(l,i){if(l&1&&(j(0,ni,2,3),j(1,ai,2,3)),l&2){let e=i.$implicit;$(e.errors!=null&&e.errors.required?0:-1),n(),$(e.errors!=null&&e.errors.matchControl?1:-1)}}function li(l,i){l&1&&(o(0,"nz-select",29),g(1,"nz-option",30)(2,"nz-option",30),s()),l&2&&(n(),m("nzLabel","+86")("nzValue","+86"),n(),m("nzLabel","+87")("nzValue","+87"))}function mi(l,i){l&1&&(p(0),c(1,"i18n")),l&2&&h(" ",d(1,1,"validation.phone-number.required")," ")}function pi(l,i){l&1&&(p(0),c(1,"i18n")),l&2&&h(" ",d(1,1,"validation.phone-number.wrong-format")," ")}function ci(l,i){if(l&1&&(j(0,mi,2,3),j(1,pi,2,3)),l&2){let e=i.$implicit;$(e.errors!=null&&e.errors.required?0:-1),n(),$(e.errors!=null&&e.errors.pattern?1:-1)}}var me=class me{constructor(){this.router=r(b);this.http=r(qe);this.cdr=r(Ve);this.form=r(J).nonNullable.group({mail:["",[u.required,u.email]],password:["",[u.required,u.minLength(6),me.checkPassword.bind(this)]],confirm:["",[u.required,u.minLength(6)]],mobilePrefix:["+86"],mobile:["",[u.required,u.pattern(/^1\d{10}$/)]],captcha:["",[u.required]]},{validators:jt("password","confirm")});this.error="";this.type=0;this.loading=!1;this.visible=!1;this.status="pool";this.progress=0;this.passwordProgressMap={ok:"success",pass:"normal",pool:"exception"};this.count=0}static checkPassword(i){if(!i)return null;let e=this;e.visible=!!i.value,i.value&&i.value.length>9?e.status="ok":i.value&&i.value.length>5?e.status="pass":e.status="pool",e.visible&&(e.progress=i.value.length*10>100?100:i.value.length*10)}getCaptcha(){let{mobile:i}=this.form.controls;if(i.invalid){i.markAsDirty({onlySelf:!0}),i.updateValueAndValidity({onlySelf:!0});return}this.count=59,this.cdr.detectChanges(),this.interval$=setInterval(()=>{this.count-=1,this.cdr.detectChanges(),this.count<=0&&clearInterval(this.interval$)},1e3)}submit(){if(this.error="",Object.keys(this.form.controls).forEach(e=>{let t=this.form.controls[e];t.markAsDirty(),t.updateValueAndValidity()}),this.form.invalid)return;let i=this.form.value;this.loading=!0,this.cdr.detectChanges(),this.http.post("/register",i,null,{context:new Ge().set(We,!0)}).pipe(Ue(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(()=>{this.router.navigate(["passport","register-result"],{queryParams:{email:i.mail}})})}ngOnDestroy(){this.interval$&&clearInterval(this.interval$)}};me.\u0275fac=function(e){return new(e||me)},me.\u0275cmp=v({type:me,selectors:[["passport-register"]],decls:50,vars:34,consts:[["mailErrorTip",""],["pwdCdkTpl",""],["confirmErrorTip",""],["addOnBeforeTemplate",""],["mobileErrorTip",""],["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],[3,"nzErrorTip"],["nzSize","large","nzAddonBeforeIcon","user"],["nz-input","","formControlName","mail","placeholder","Email"],["nzSize","large","nzAddonBeforeIcon","lock","nz-popover","","nzPopoverPlacement","right","nzPopoverTrigger","focus","nzPopoverOverlayClassName","register-password-cdk",3,"nzPopoverVisibleChange","nzPopoverVisible","nzPopoverOverlayStyle","nzPopoverContent"],["nz-input","","type","password","formControlName","password","placeholder","Password"],["nzSize","large","nzAddonBeforeIcon","lock"],["nz-input","","type","password","formControlName","confirm","placeholder","Confirm Password"],["nzSize","large",3,"nzAddOnBefore"],["formControlName","mobile","nz-input","","placeholder","Phone number"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nzSize","large","nzAddonBeforeIcon","mail"],["nz-input","","formControlName","captcha","placeholder","Captcha"],["type","button","nz-button","","nzSize","large","nzBlock","",3,"click","disabled","nzLoading"],["nz-button","","nzType","primary","nzSize","large","type","submit",1,"submit",3,"nzLoading"],["routerLink","/passport/login",1,"login"],[2,"padding","4px 0"],[1,"success"],[1,"warning"],[1,"error"],[3,"nzPercent","nzStatus","nzStrokeWidth","nzShowInfo"],[1,"mt-sm"],["formControlName","mobilePrefix",2,"width","100px"],[3,"nzLabel","nzValue"]],template:function(e,t){if(e&1){let a=Oe();o(0,"h3"),p(1),c(2,"i18n"),s(),o(3,"form",5),f("ngSubmit",function(){return pe(a),ce(t.submit())}),j(4,Jt,1,3,"nz-alert",6),o(5,"nz-form-item")(6,"nz-form-control",7)(7,"nz-input-group",8),g(8,"input",9),s(),ee(9,ei,2,2,"ng-template",null,0,ie),s()(),o(11,"nz-form-item")(12,"nz-form-control",7),c(13,"i18n"),o(14,"nz-input-group",10),mt("nzPopoverVisibleChange",function(S){return pe(a),lt(t.visible,S)||(t.visible=S),ce(S)}),g(15,"input",11),s(),ee(16,ri,9,11,"ng-template",null,1,ie),s()(),o(18,"nz-form-item")(19,"nz-form-control",7)(20,"nz-input-group",12),g(21,"input",13),s(),ee(22,si,2,2,"ng-template",null,2,ie),s()(),o(24,"nz-form-item")(25,"nz-form-control",7)(26,"nz-input-group",14),ee(27,li,3,4,"ng-template",null,3,ie),g(29,"input",15),s(),ee(30,ci,2,2,"ng-template",null,4,ie),s()(),o(32,"nz-form-item")(33,"nz-form-control",7),c(34,"i18n"),o(35,"div",16)(36,"div",17)(37,"nz-input-group",18),g(38,"input",19),s()(),o(39,"div",17)(40,"button",20),f("click",function(){return pe(a),ce(t.getCaptcha())}),p(41),c(42,"i18n"),s()()()()(),o(43,"nz-form-item")(44,"button",21),p(45),c(46,"i18n"),s(),o(47,"a",22),p(48),c(49,"i18n"),s()()()}if(e&2){let a=te(10),z=te(17),S=te(23),Z=te(28),$t=te(31);n(),T(d(2,21,"app.register.register")),n(2),m("formGroup",t.form),n(),$(t.error?4:-1),n(2),m("nzErrorTip",a),n(6),m("nzErrorTip",d(13,23,"validation.password.required")),n(2),st("nzPopoverVisible",t.visible),m("nzPopoverOverlayStyle",ct(33,Xt))("nzPopoverContent",z),n(5),m("nzErrorTip",S),n(6),m("nzErrorTip",$t),n(),m("nzAddOnBefore",Z),n(7),m("nzErrorTip",d(34,25,"validation.verification-code.required")),n(2),m("nzGutter",8),n(),m("nzSpan",16),n(3),m("nzSpan",8),n(),m("disabled",t.count>0)("nzLoading",t.loading),n(),h(" ",t.count?t.count+"s":d(42,27,"app.register.get-verification-code")," "),n(3),m("nzLoading",t.loading),n(),h(" ",d(46,29,"app.register.register")," "),n(3),T(d(49,31,"app.register.sign-in"))}},dependencies:[B,P,D,M,x,F,I,de,Ye,He,W,L,O,G,V,q,U,R,A,Ut,At,Lt,Ot,xt,Dt,Mt,Ke,y,_,C,N,ne],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     h3{margin-bottom:20px;font-size:16px}[_nghost-%COMP%]     .submit{width:50%}[_nghost-%COMP%]     .login{float:right;line-height:40px}  .register-password-cdk .success,   .register-password-cdk .warning,   .register-password-cdk .error{transition:color .3s}  .register-password-cdk .success{color:#52c41a}  .register-password-cdk .warning{color:#faad14}  .register-password-cdk .error{color:#ff4d4f}  .register-password-cdk .progress-pass>.progress .ant-progress-bg{background-color:#faad14}"],changeDetection:0});var tt=me;var ui=l=>({email:l});function di(l,i){if(l&1&&(o(0,"div",5),p(1),c(2,"i18n"),s()),l&2){let e=se();n(),h(" ",dt(2,1,"app.register-result.msg",ut(4,ui,e.email))," ")}}var Ee=class Ee{constructor(){this.msg=r(w);this.email=""}};Ee.\u0275fac=function(e){return new(e||Ee)},Ee.\u0275cmp=v({type:Ee,selectors:[["passport-register-result"]],inputs:{email:"email"},decls:11,vars:11,consts:[["title",""],["nzStatus","success",3,"nzTitle","nzSubTitle"],["nz-result-extra",""],["nz-button","","nzSize","large",3,"click","nzType"],["routerLink","/","nz-button","","nzSize","large"],[1,"title",2,"font-size","20px"]],template:function(e,t){if(e&1){let a=Oe();o(0,"nz-result",1),c(1,"i18n"),ee(2,di,3,6,"ng-template",null,0,ie),o(4,"div",2)(5,"button",3),f("click",function(){return pe(a),ce(t.msg.success("email"))}),p(6),c(7,"i18n"),s(),o(8,"button",4),p(9),c(10,"i18n"),s()()()}if(e&2){let a=te(3);m("nzTitle",a)("nzSubTitle",d(1,5,"app.register-result.activation-email")),n(5),m("nzType","primary"),n(),h(" ",d(7,7,"app.register-result.view-mailbox")," "),n(3),h(" ",d(10,9,"app.register-result.back-home")," ")}},dependencies:[de,y,_,C,N,Wt,qt,Gt,ne],encapsulation:2});var it=Ee;var Vn=[{path:"passport",component:Vt,children:[{path:"login",component:et,data:{title:"\u767B\u5F55",titleI18n:"app.login.login"}},{path:"register",component:tt,data:{title:"\u6CE8\u518C",titleI18n:"app.register.register"}},{path:"register-result",component:it,data:{title:"\u6CE8\u518C\u7ED3\u679C",titleI18n:"app.register.register"}},{path:"lock",component:Je,data:{title:"\u9501\u5C4F",titleI18n:"app.lock"}}]},{path:"passport/callback/:type",component:Xe}];export{Vn as routes};
