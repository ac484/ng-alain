import{b as C,d as y,e as T,f as D,g,h as I,i as n,j as P,n as h,o as w,p as S}from"./chunk-CVWZRLFH.js";import{oa as d,sa as p,ta as v}from"./chunk-MUKALFIJ.js";import{i as s}from"./chunk-57BLH6QZ.js";var l=class l{constructor(){this.firestore=v(C)}get firestoreInstance(){return this.firestore}useCollection(e){let t=g(this.firestore,e);return y(t,{idField:"key"})}useDoc(e,t){let r=n(this.firestore,e,t);return T(r,{idField:"key"})}add(e,t){return s(this,null,function*(){let r=g(this.firestore,e);return(yield D(r,t)).id})}update(e,t,r){return s(this,null,function*(){let a=n(this.firestore,e,t);yield S(a,r)})}delete(e,t){return s(this,null,function*(){let r=n(this.firestore,e,t);yield I(r)})}};l.\u0275fac=function(t){return new(t||l)},l.\u0275prov=d({token:l,factory:l.\u0275fac,providedIn:"root"});var f=l;var u=class u{constructor(e){this.hubCrud=e}list(){return this.hubCrud.useCollection("hub_contract")}add(e){return this.hubCrud.add("hub_contract",e)}update(e,t){return this.hubCrud.update("hub_contract",e,t)}delete(e){return this.hubCrud.delete("hub_contract",e)}getNextContractSerial(){return s(this,null,function*(){let e=n(this.hubCrud.firestoreInstance,"hub/meta/counters/contractSerial"),t=1;return yield h(this.hubCrud.firestoreInstance,r=>s(this,null,function*(){let a=yield r.get(e),o=0,i=[];if(!a.exists())o=1,i=[],r.set(e,{value:o,available:i}),t=o;else{let c=a.data();o=c.value||0,i=Array.isArray(c.available)?[...c.available]:[],i.length>0?(i.sort((b,m)=>b-m),t=i.shift(),r.update(e,{available:i})):(t=o+1,r.update(e,{value:t}))}})),"C"+String(t).padStart(5,"0")})}recycleContractSerial(e){return s(this,null,function*(){let t=Number(e.replace(/^C/,""));if(!t||isNaN(t))return;let r=n(this.hubCrud.firestoreInstance,"hub/meta/counters/contractSerial");yield h(this.hubCrud.firestoreInstance,a=>s(this,null,function*(){let o=yield a.get(r);if(!o.exists())a.set(r,{value:t,available:[t]});else{let i=o.data(),c=Array.isArray(i.available)?[...i.available]:[];c.includes(t)||(c.push(t),c.sort((b,m)=>b-m),a.update(r,{available:c}))}}))})}getClientsSettings(){return s(this,null,function*(){let e=n(this.hubCrud.firestoreInstance,"hub/meta/settings/clients"),t=yield P(e);return t.exists()?t.data():null})}setClientsSettings(e){return s(this,null,function*(){let t=n(this.hubCrud.firestoreInstance,"hub/meta/settings/clients");yield w(t,e)})}getDefaultClient(){return s(this,null,function*(){return(yield this.getClientsSettings())?.default||""})}};u.\u0275fac=function(t){return new(t||u)(p(f))},u.\u0275prov=d({token:u,factory:u.\u0275fac,providedIn:"root"});var x=u;export{f as a,x as b};
