import{a as Ce,b as _e}from"./chunk-TTLT4QMP.js";import{b as Fe}from"./chunk-2ZTQVF6T.js";import{a as fe,b as ge}from"./chunk-5YO4PIE7.js";import"./chunk-W5AQKPAW.js";import{b as ze}from"./chunk-DO3T5MXG.js";import{a as se,c as ue,d as de,e as pe}from"./chunk-JSW4L7WF.js";import{a as ae,b as le}from"./chunk-3AJA4UAR.js";import{d as q}from"./chunk-RHSNDLDC.js";import{a as Y,b as $}from"./chunk-R2FFNX7I.js";import{i as J,j as G,k as Z}from"./chunk-VPG4RKW7.js";import{k as oe}from"./chunk-A6I6NVJK.js";import"./chunk-H7YPP55E.js";import{a as ne,b as re}from"./chunk-SNCQL3XC.js";import{b as ee,c as te,d as ie}from"./chunk-VDEGG43N.js";import"./chunk-PU46QXHH.js";import"./chunk-FSJ6KERW.js";import"./chunk-UATVLLJJ.js";import"./chunk-BRKXCE7P.js";import"./chunk-WHJAXXAS.js";import{g as H,m as Q,y as X}from"./chunk-NB4EIDVA.js";import"./chunk-43QWISWI.js";import"./chunk-4OGGW47F.js";import"./chunk-JHZVO6A4.js";import"./chunk-Z2B7QBBP.js";import"./chunk-QNTYQDQV.js";import{Aa as c,Hd as A,Ih as V,Jh as L,Nb as z,Ob as o,Pb as r,Qb as _,Rh as j,Sh as U,Th as O,Xb as T,_b as h,ai as R,bb as d,bc as f,ci as K,di as W,gb as M,nb as b,ni as me,oi as ce,qc as s,rc as v,sc as k,tb as C,tc as B,uc as w,vc as E,wc as S,za as m,zd as I}from"./chunk-VMD4HRQF.js";import{i as P}from"./chunk-57BLH6QZ.js";var N={workerSrc:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",cMapUrl:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/cmaps/",cMapPacked:!0,standardFontDataUrl:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/standard_fonts/"};function he(){return new Promise((u,t)=>{if(typeof window>"u"){t(new Error("PDF.js \u53EA\u80FD\u5728\u700F\u89BD\u5668\u74B0\u5883\u4E2D\u4F7F\u7528"));return}if(window.pdfjsLib){u();return}let e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",e.onload=()=>{let i=window.pdfjsLib;i.GlobalWorkerOptions.workerSrc=N.workerSrc,i.cMapUrl=N.cMapUrl,i.cMapPacked=N.cMapPacked,i.standardFontDataUrl=N.standardFontDataUrl,u()},e.onerror=()=>{t(new Error("PDF.js \u8F09\u5165\u5931\u6557"))},document.head.appendChild(e)})}function Te(){return typeof window<"u"&&!!window.pdfjsLib}function xe(){if(!Te())throw new Error("PDF.js \u672A\u521D\u59CB\u5316\uFF0C\u8ACB\u5148\u8ABF\u7528 initializePDFJS()");return window.pdfjsLib}function ve(u,t){if(u&1&&(o(0,"nz-form-item")(1,"nz-form-label"),s(2,"\u6A94\u6848\u4FE1\u606F"),r(),o(3,"nz-form-control")(4,"div",19)(5,"p")(6,"strong"),s(7,"\u6A94\u540D\uFF1A"),r(),s(8),r(),o(9,"p")(10,"strong"),s(11,"\u5927\u5C0F\uFF1A"),r(),s(12),r(),o(13,"p")(14,"strong"),s(15,"\u985E\u578B\uFF1A"),r(),s(16),r()()()()),u&2){let e=f(2);d(8),v(e.selectedFile.name),d(4),v(e.formatFileSize(e.selectedFile.size)),d(4),v(e.selectedFile.type)}}function we(u,t){if(u&1){let e=T();o(0,"nz-form-item")(1,"nz-form-label"),s(2,"\u6A19\u984C\u8B58\u5225\u898F\u5247"),r(),o(3,"nz-form-control")(4,"nz-input",20),S("ngModelChange",function(n){m(e);let l=f(2);return E(l.titlePattern,n)||(l.titlePattern=n),c(n)}),r()()()}if(u&2){let e=f(2);d(4),w("ngModel",e.titlePattern)}}function Ee(u,t){if(u&1&&(o(0,"div",24),s(1),r()),u&2){let e=f(3);d(),B(" \u2705 \u6210\u529F\u89E3\u6790 ",e.parseResult.pageCount," \u9801\uFF0C\u751F\u6210 ",e.parseResult.data==null?null:e.parseResult.data.length," \u500B\u6839\u7BC0\u9EDE ")}}function Se(u,t){if(u&1&&(o(0,"div",25),s(1),r()),u&2){let e=f(3);d(),k(" \u274C \u89E3\u6790\u5931\u6557\uFF1A",e.parseResult.error," ")}}function Ne(u,t){if(u&1&&(o(0,"div",26)(1,"details")(2,"summary"),s(3,"\u67E5\u770B\u539F\u59CB\u6587\u5B57\u5167\u5BB9\uFF08\u524D 500 \u5B57\uFF09"),r(),o(4,"pre",27),s(5),r()()()),u&2){let e=f(3);d(5),k("",e.parseResult.textContent.substring(0,500),"...")}}function ke(u,t){if(u&1&&(o(0,"div")(1,"h4"),s(2,"\u89E3\u6790\u7D50\u679C\uFF1A"),r(),C(3,Ee,2,2,"div",21)(4,Se,2,1,"div",22)(5,Ne,6,1,"div",23),r()),u&2){let e=f(2);d(3),z("ngIf",e.parseResult.success),d(),z("ngIf",!e.parseResult.success),d(),z("ngIf",e.parseResult.textContent)}}function Me(u,t){if(u&1){let e=T();o(0,"div"),_(1,"nz-alert",12),o(2,"nz-form-item")(3,"nz-form-label"),s(4,"\u9078\u64C7\u6A94\u6848"),r(),o(5,"nz-form-control")(6,"input",13),h("change",function(n){m(e);let l=f();return c(l.onFileSelected(n))}),r()()(),C(7,ve,17,3,"nz-form-item",14),o(8,"nz-form-item")(9,"nz-form-label"),s(10,"\u89E3\u6790\u9078\u9805"),r(),o(11,"nz-form-control")(12,"nz-select",15),S("ngModelChange",function(n){m(e);let l=f();return E(l.parseOptions,n)||(l.parseOptions=n),c(n)}),_(13,"nz-option",16)(14,"nz-option",17)(15,"nz-option",18),r()()(),C(16,we,5,1,"nz-form-item",14),_(17,"nz-divider"),C(18,ke,6,3,"div",14),r()}if(u&2){let e=f();d(7),z("ngIf",e.selectedFile),d(5),w("ngModel",e.parseOptions),d(4),z("ngIf",e.parseOptions==="manual"),d(2),z("ngIf",e.parseResult)}}var x=class x{constructor(t){this.message=t;this.treeData=[{title:"PDF \u532F\u5165\u793A\u4F8B",key:"0-0",icon:"anticon-file-pdf",children:[{title:"\u7B2C\u4E00\u7AE0 \u4ECB\u7D39",key:"0-0-0",icon:"anticon-file-text",children:[{title:"1.1 \u80CC\u666F",key:"0-0-0-0",isLeaf:!0,icon:"anticon-file-text"},{title:"1.2 \u76EE\u6A19",key:"0-0-0-1",isLeaf:!0,icon:"anticon-file-text"}]},{title:"\u7B2C\u4E8C\u7AE0 \u65B9\u6CD5",key:"0-0-1",icon:"anticon-file-text",children:[{title:"2.1 \u7814\u7A76\u65B9\u6CD5",key:"0-0-1-0",isLeaf:!0,icon:"anticon-file-text"},{title:"2.2 \u5BE6\u9A57\u8A2D\u8A08",key:"0-0-1-1",isLeaf:!0,icon:"anticon-file-text"}]}]}];this.expandedKeys=["0-0","0-0-0","0-0-1"];this.selectedKeys=[];this.isUploadModalVisible=!1;this.isProcessing=!1;this.selectedFile=null;this.parseOptions="auto";this.titlePattern="";this.parseResult=null;this.initPDFJS()}initPDFJS(){return P(this,null,function*(){try{yield he(),console.log("PDF.js \u521D\u59CB\u5316\u6210\u529F")}catch(t){console.error("PDF.js \u521D\u59CB\u5316\u5931\u6557:",t),this.message.error("PDF \u89E3\u6790\u5EAB\u521D\u59CB\u5316\u5931\u6557")}})}showUploadModal(){this.isUploadModalVisible=!0,this.selectedFile=null,this.parseResult=null}cancelUpload(){this.isUploadModalVisible=!1,this.selectedFile=null,this.parseResult=null}onFileSelected(t){let e=t.target.files[0];e&&e.type==="application/pdf"?(this.selectedFile=e,this.parseResult=null):this.message.error("\u8ACB\u9078\u64C7\u6709\u6548\u7684 PDF \u6A94\u6848")}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,i=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,n)).toFixed(2))+" "+i[n]}confirmUpload(){return P(this,null,function*(){if(!this.selectedFile){this.message.warning("\u8ACB\u9078\u64C7 PDF \u6A94\u6848");return}this.isProcessing=!0,this.message.info("\u958B\u59CB\u89E3\u6790 PDF \u6A94\u6848...");try{let t=yield this.parsePDF(this.selectedFile);this.parseResult=t,t.success&&t.data?(this.treeData=t.data,this.expandedKeys=this.getAllKeys(t.data),this.message.success("PDF \u89E3\u6790\u6210\u529F\uFF0C\u6A39\u72C0\u7D50\u69CB\u5DF2\u66F4\u65B0"),this.isUploadModalVisible=!1):this.message.error("PDF \u89E3\u6790\u5931\u6557\uFF1A"+(t.error||"\u672A\u77E5\u932F\u8AA4"))}catch(t){this.message.error("\u8655\u7406\u904E\u7A0B\u4E2D\u767C\u751F\u932F\u8AA4\uFF1A"+t)}finally{this.isProcessing=!1}})}parsePDF(t){return P(this,null,function*(){try{if(typeof window<"u"&&!window.pdfjsLib)return{success:!1,error:"PDF \u89E3\u6790\u5EAB\u672A\u521D\u59CB\u5316\uFF0C\u8ACB\u91CD\u65B0\u8F09\u5165\u9801\u9762"};let e=yield t.arrayBuffer(),l=yield xe().getDocument({data:e}).promise,a="",F=l.numPages;for(let g=1;g<=F;g++){let De=(yield(yield l.getPage(g)).getTextContent()).items.map(Pe=>Pe.str).join(" ");a+=De+`
`}let p=[];return this.parseOptions==="auto"?p=this.autoParseToTree(a):this.parseOptions==="manual"?p=this.manualParseToTree(a,this.titlePattern):p=this.flatParseToTree(a),{success:!0,data:p,pageCount:F,textContent:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:"PDF \u89E3\u6790\u5931\u6557"}}})}autoParseToTree(t){let e=t.split(`
`).filter(a=>a.trim()),i=[],n=[],l=0;return e.forEach((a,F)=>{let p=a.trim();if(!p)return;let g=this.detectTitleLevel(p),y={title:p,key:`node-${l++}`,isLeaf:g===0};if(g===0)i.push(y),n.length=0;else{for(;n.length>0&&n[n.length-1].level>=g;)n.pop();if(n.length===0)i.push(y);else{let D=n[n.length-1].node;D.children||(D.children=[]),D.children.push(y)}n.push({node:y,level:g})}}),i}manualParseToTree(t,e){let i=t.split(`
`).filter(a=>a.trim()),n=[],l=0;try{let a=new RegExp(e,"i");i.forEach(F=>{let p=F.trim();if(p&&a.test(p)){let g={title:p,key:`node-${l++}`,isLeaf:!1};n.push(g)}})}catch(a){console.error("\u6B63\u5247\u8868\u9054\u5F0F\u932F\u8AA4:",a)}return n}flatParseToTree(t){let e=t.split(`
`).filter(l=>l.trim()),i=[],n=0;return e.forEach(l=>{let a=l.trim();if(!a)return;let F={title:a,key:`node-${n++}`,isLeaf:!0};i.push(F)}),i}detectTitleLevel(t){let e=[/^第[一二三四五六七八九十]+章/,/^第[一二三四五六七八九十]+節/,/^[0-9]+\.[0-9]+/,/^[A-Z]\.[0-9]+/,/^[一二三四五六七八九十]+\./];for(let i=0;i<e.length;i++)if(e[i].test(t))return i+1;return 0}onExpandChange(t){this.expandedKeys=t.keys}onNodeClick(t){console.log("\u7BC0\u9EDE\u9EDE\u64CA:",t),this.selectedKeys=[t.node.key]}resetTree(){this.treeData=[{title:"PDF \u532F\u5165\u793A\u4F8B",key:"0-0",icon:"anticon-file-pdf",children:[{title:"\u7B2C\u4E00\u7AE0 \u4ECB\u7D39",key:"0-0-0",icon:"anticon-file-text",children:[{title:"1.1 \u80CC\u666F",key:"0-0-0-0",isLeaf:!0,icon:"anticon-file-text"},{title:"1.2 \u76EE\u6A19",key:"0-0-0-1",isLeaf:!0,icon:"anticon-file-text"}]},{title:"\u7B2C\u4E8C\u7AE0 \u65B9\u6CD5",key:"0-0-1",icon:"anticon-file-text",children:[{title:"2.1 \u7814\u7A76\u65B9\u6CD5",key:"0-0-1-0",isLeaf:!0,icon:"anticon-file-text"},{title:"2.2 \u5BE6\u9A57\u8A2D\u8A08",key:"0-0-1-1",isLeaf:!0,icon:"anticon-file-text"}]}]}],this.expandedKeys=["0-0","0-0-0","0-0-1"],this.message.success("\u6A39\u72C0\u7D50\u69CB\u5DF2\u91CD\u7F6E")}getAllKeys(t){let e=[];return t.forEach(i=>{e.push(i.key),i.children&&e.push(...this.getAllKeys(i.children))}),e}};x.\u0275fac=function(e){return new(e||x)(M(q))},x.\u0275cmp=b({type:x,selectors:[["app-tree-pdf-import"]],decls:30,vars:9,consts:[["tree",""],["title","PDF \u532F\u5165\u529F\u80FD"],[2,"margin-bottom","16px"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","upload"],["nz-button","","nzType","default",3,"click"],["nz-icon","","nzType","reload"],[3,"nzSpinning"],[3,"nzExpandChange","nzClick","nzData","nzBlockNode","nzShowLine","nzShowIcon","nzExpandedKeys","nzSelectedKeys"],["nzTitle","PDF \u6A94\u6848\u532F\u5165",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzOkDisabled"],[4,"nzModalContent"],[2,"margin-top","16px","padding","16px","background-color","#f5f5f5","border-radius","4px"],["nzType","info","nzMessage","\u652F\u63F4\u4E2D\u82F1\u6587 PDF \u6A94\u6848\uFF0C\u7CFB\u7D71\u6703\u81EA\u52D5\u8B58\u5225\u6A19\u984C\u5C64\u7D1A\u4E26\u8F49\u63DB\u70BA\u6A39\u72C0\u7D50\u69CB",2,"margin-bottom","16px"],["type","file","accept",".pdf",2,"width","100%",3,"change"],[4,"ngIf"],["placeholder","\u9078\u64C7\u89E3\u6790\u6A21\u5F0F",3,"ngModelChange","ngModel"],["nzValue","auto","nzLabel","\u81EA\u52D5\u8B58\u5225\u5C64\u7D1A"],["nzValue","manual","nzLabel","\u624B\u52D5\u8A2D\u5B9A\u5C64\u7D1A"],["nzValue","flat","nzLabel","\u6241\u5E73\u5316\u7D50\u69CB"],[2,"padding","8px","background-color","#f5f5f5","border-radius","4px"],["placeholder","\u4F8B\u5982\uFF1A^\u7B2C[\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D\u5341]+\u7AE0|^[0-9]+\\.",3,"ngModelChange","ngModel"],["style","color: green;",4,"ngIf"],["style","color: red;",4,"ngIf"],["style","margin-top: 8px;",4,"ngIf"],[2,"color","green"],[2,"color","red"],[2,"margin-top","8px"],[2,"background-color","#f5f5f5","padding","8px","border-radius","4px","font-size","12px","max-height","200px","overflow-y","auto"]],template:function(e,i){if(e&1){let n=T();o(0,"nz-card",1)(1,"div",2)(2,"nz-space")(3,"button",3),h("click",function(){return m(n),c(i.showUploadModal())}),_(4,"span",4),s(5," \u9078\u64C7 PDF \u6A94\u6848 "),r(),o(6,"button",5),h("click",function(){return m(n),c(i.resetTree())}),_(7,"span",6),s(8," \u91CD\u7F6E "),r()()(),o(9,"nz-spin",7)(10,"nz-tree",8,0),h("nzExpandChange",function(a){return m(n),c(i.onExpandChange(a))})("nzClick",function(a){return m(n),c(i.onNodeClick(a))}),r()(),o(12,"nz-modal",9),S("nzVisibleChange",function(a){return m(n),E(i.isUploadModalVisible,a)||(i.isUploadModalVisible=a),c(a)}),h("nzOnCancel",function(){return m(n),c(i.cancelUpload())})("nzOnOk",function(){return m(n),c(i.confirmUpload())}),C(13,Me,19,4,"div",10),r(),o(14,"div",11)(15,"h4"),s(16,"PDF \u532F\u5165\u529F\u80FD\u8AAA\u660E\uFF1A"),r(),o(17,"ul")(18,"li"),s(19,"\u652F\u63F4\u4E2D\u82F1\u6587 PDF \u6A94\u6848\u683C\u5F0F"),r(),o(20,"li"),s(21,"\u81EA\u52D5\u8B58\u5225\u6A19\u984C\u5C64\u7D1A\u548C\u7D50\u69CB"),r(),o(22,"li"),s(23,"\u652F\u63F4\u624B\u52D5\u8A2D\u5B9A\u89E3\u6790\u898F\u5247"),r(),o(24,"li"),s(25,"\u63D0\u4F9B\u89E3\u6790\u7D50\u679C\u9810\u89BD"),r(),o(26,"li"),s(27,"\u652F\u63F4\u5927\u6A94\u6848\u8655\u7406\uFF08\u9032\u5EA6\u986F\u793A\uFF09"),r(),o(28,"li"),s(29,"\u4FDD\u7559\u539F\u59CB\u6587\u5B57\u5167\u5BB9\u4F9B\u53C3\u8003"),r()()()()}e&2&&(d(9),z("nzSpinning",i.isProcessing),d(),z("nzData",i.treeData)("nzBlockNode",!0)("nzShowLine",!0)("nzShowIcon",!0)("nzExpandedKeys",i.expandedKeys)("nzSelectedKeys",i.selectedKeys),d(2),w("nzVisible",i.isUploadModalVisible),z("nzOkDisabled",!i.selectedFile))},dependencies:[A,I,ce,me,_e,Ce,W,K,O,R,U,j,L,V,Fe,Z,G,J,oe,pe,le,ae,se,de,ue,ie,ee,te,$,Y,ge,fe,ze,re,ne,X,H,Q],encapsulation:2});var ye=x;export{ye as TreePdfImportComponent};
