import{b as ge}from"./chunk-5GTUJC4P.js";import{a as _e,b as de,c as fe}from"./chunk-QQCJRPBH.js";import{la as X,na as H,qa as J,sa as Q,ta as Y}from"./chunk-SPUREXUF.js";import"./chunk-5OUSU5JV.js";import"./chunk-SIZM2XL7.js";import"./chunk-2DVOMO4J.js";import"./chunk-ROMVKXOU.js";import"./chunk-2HNAEQKX.js";import"./chunk-JIIUKLQC.js";import"./chunk-TLJKVWY5.js";import"./chunk-HYZ2ONVX.js";import{d as le,e as ce,f as se,j as me,k as pe,l as ue}from"./chunk-3BDY3ZMH.js";import{a as Z,b as ee}from"./chunk-TSRT2MUF.js";import{a as ie,b as oe}from"./chunk-VN6URN4G.js";import"./chunk-6C3IFAMG.js";import{d as W}from"./chunk-MVYXAVEP.js";import{m as A}from"./chunk-KGQSAPXK.js";import{a as te,c as ne}from"./chunk-76CGS5BM.js";import"./chunk-ROIV75M6.js";import{f as re,g as ae}from"./chunk-ZIYN6SHE.js";import{a as U,b as q,d as G,e as K}from"./chunk-26VBXPYH.js";import"./chunk-L5X73TV6.js";import"./chunk-WK3ZBU37.js";import"./chunk-D4TRZLVJ.js";import"./chunk-IBZY6WAF.js";import"./chunk-KQBZYKU2.js";import{j}from"./chunk-D47PEHHQ.js";import"./chunk-6OQWS5QP.js";import{Fc as O,Fd as P,Hc as V,Ic as D,Jb as x,Jh as B,Kb as r,Kh as $,Lb as a,Lc as g,Mb as m,Qb as h,Rb as T,Tb as f,Wb as _,Za as C,Zb as c,d as E,hc as d,jb as I,mc as s,nc as y,oa as w,oc as v,pb as z,r as k,ua as p,va as u,w as N,wd as F,yd as L}from"./chunk-6TK32UBT.js";import"./chunk-PMZOYKO3.js";import{a as M,b}from"./chunk-57BLH6QZ.js";var Ce=(o,n,e)=>[o,n,e];function ze(o,n){o&1&&(h(0),r(1,"div",10),m(2,"nz-spin",11),a(),T())}function Se(o,n){if(o&1){let e=f();r(0,"div",19)(1,"nz-empty",20)(2,"button",14),_("click",function(){p(e);let t=c(3);return u(t.goToScan())}),m(3,"span",15),s(4," \u958B\u59CB\u6383\u63CF "),a()()()}}function we(o,n){if(o&1){let e=f();r(0,"nz-list-item",22)(1,"nz-list-item-meta")(2,"nz-list-item-meta-title")(3,"a",23),_("click",function(){let t=p(e).$implicit,l=c(4);return u(l.viewResult(t))}),s(4),a()(),r(5,"nz-list-item-meta-description")(6,"div",24)(7,"span",25),m(8,"span",26),s(9),a(),r(10,"span",25),m(11,"span",27),s(12," \u9801\u6578\u7BC4\u570D\uFF1A"),r(13,"nz-tag",28),s(14),a()(),r(15,"span",25),m(16,"span",29),s(17),a()()()()()}if(o&2){let e=n.$implicit,i=c(4),t=d(9),l=d(11),R=d(13);x("nzActions",O(5,Ce,t,l,R)),C(4),y(e.fileName),C(5),v(" \u6A94\u6848\u5927\u5C0F\uFF1A",i.formatFileSize(e.fileSize)," "),C(5),y(e.pageRange),C(3),v(" \u63D0\u53D6\u6642\u9593\uFF1A",i.formatDate(e.createdAt)," ")}}function Re(o,n){if(o&1&&(r(0,"nz-list",21),z(1,we,18,9,"ng-template",null,7,g),a()),o&2){let e=d(2),i=c().ngIf;x("nzDataSource",i)("nzRenderItem",e)("nzItemLayout","horizontal")}}function he(o,n){if(o&1){let e=f();h(0),r(1,"div",12)(2,"div",13)(3,"button",14),_("click",function(){p(e);let t=c(2);return u(t.goToScan())}),m(4,"span",15),s(5," \u65B0\u589E\u6383\u63CF "),a(),r(6,"button",16),_("click",function(){p(e);let t=c(2);return u(t.refresh())}),m(7,"span",17),s(8," \u91CD\u65B0\u6574\u7406 "),a()(),z(9,Se,5,0,"div",18)(10,Re,3,3,"ng-template",null,6,g),a(),T()}if(o&2){let e=n.ngIf,i=d(11);C(9),x("ngIf",e.length===0)("ngIfElse",i)}}function Te(o,n){if(o&1&&(z(0,he,12,2,"ng-container",9),V(1,"async")),o&2){let e=c(),i=d(5);x("ngIf",D(1,2,e.scanResults$))("ngIfElse",i)}}function ye(o,n){if(o&1){let e=f();r(0,"nz-result",30)(1,"div",31)(2,"button",14),_("click",function(){p(e);let t=c();return u(t.refresh())}),s(3,"\u91CD\u8A66"),a()()()}if(o&2){c();let e=d(5);x("nzSubTitle",e)}}function ve(o,n){if(o&1){let e=f();r(0,"button",32),_("click",function(){p(e);let t=c();return u(t.goToScan())}),m(1,"span",15),s(2," \u6383\u63CF "),a()}}function Me(o,n){if(o&1){let e=f();r(0,"button",32),_("click",function(){let t=p(e).$implicit,l=c();return u(l.viewResult(t))}),m(1,"span",33),s(2," \u67E5\u770B "),a()}}function be(o,n){if(o&1){let e=f();r(0,"button",32),_("click",function(){let t=p(e).$implicit,l=c();return u(l.downloadMarkdown(t))}),m(1,"span",34),s(2," MD "),a()}}function Ee(o,n){if(o&1){let e=f();r(0,"button",32),_("click",function(){let t=p(e).$implicit,l=c();return u(l.downloadText(t))}),m(1,"span",27),s(2," TXT "),a()}}var S=class S{constructor(){this.firestore=w(X);this.router=w(A);this.message=w(W);this.scanResults$=k([]);this.isLoading=!0;this.error=""}ngOnInit(){this.loadScanResults()}loadScanResults(){this.isLoading=!0,this.scanResults$=new E(n=>{let e=Y(H(this.firestore,"scan-results"),Q("createdAt","desc"));J(e).then(i=>{let t=[];i.forEach(l=>{let R=l.data();t.push(b(M({},R),{id:l.id}))}),n.next(t),n.complete()}).catch(i=>{console.error("Error loading scan results:",i),this.error="\u8F09\u5165\u6383\u63CF\u7D50\u679C\u5931\u6557",n.next([]),n.complete()})}).pipe(N(n=>(this.isLoading=!1,n)))}formatFileSize(n){if(n===0)return"0 Bytes";let e=1024,i=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(n)/Math.log(e));return parseFloat((n/Math.pow(e,t)).toFixed(2))+" "+i[t]}formatDate(n){return new Date(n).toLocaleString()}viewResult(n){n.id&&this.router.navigate(["/tree/scan-result",n.id])}downloadMarkdown(n){let e=new Blob([n.markdownContent],{type:"text/markdown;charset=utf-8"}),i=window.URL.createObjectURL(e),t=document.createElement("a");t.href=i,t.download=`${n.fileName.replace(".pdf","")}_extracted.md`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(i),this.message.success("Markdown \u6587\u4EF6\u5DF2\u4E0B\u8F09")}downloadText(n){let e=new Blob([n.extractedText],{type:"text/plain;charset=utf-8"}),i=window.URL.createObjectURL(e),t=document.createElement("a");t.href=i,t.download=`${n.fileName.replace(".pdf","")}_extracted.txt`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(i),this.message.success("\u6587\u5B57\u6587\u4EF6\u5DF2\u4E0B\u8F09")}goToScan(){this.router.navigate(["/tree/pdf-scan"])}refresh(){this.loadScanResults()}};S.\u0275fac=function(e){return new(e||S)},S.\u0275cmp=I({type:S,selectors:[["app-scan-result"]],decls:14,vars:3,consts:[["content",""],["error",""],["extraTemplate",""],["viewAction",""],["downloadMdAction",""],["downloadTxtAction",""],["resultsList",""],["item",""],["nzTitle","\u6383\u63CF\u7D50\u679C\u5217\u8868",3,"nzExtra"],[4,"ngIf","ngIfElse"],[1,"loading-container"],["nzSize","large","nzTip","\u8F09\u5165\u4E2D..."],[1,"results-container"],[1,"header-actions"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","scan"],["nz-button","",3,"click"],["nz-icon","","nzType","reload"],["class","empty-container",4,"ngIf","ngIfElse"],[1,"empty-container"],["nzNotFoundImage","simple","nzNotFoundContent","\u66AB\u7121\u6383\u63CF\u7D50\u679C"],[3,"nzDataSource","nzRenderItem","nzItemLayout"],[3,"nzActions"],[1,"file-name",3,"click"],[1,"file-info"],[1,"info-item"],["nz-icon","","nzType","file-pdf"],["nz-icon","","nzType","file-text"],["nzColor","blue"],["nz-icon","","nzType","clock-circle"],["nzStatus","error","nzTitle","\u8F09\u5165\u5931\u6557",3,"nzSubTitle"],["nz-result-extra",""],["nz-button","","nzType","link",3,"click"],["nz-icon","","nzType","eye"],["nz-icon","","nzType","file-markdown"]],template:function(e,i){if(e&1&&(r(0,"nz-card",8),z(1,ze,3,0,"ng-container",9)(2,Te,2,4,"ng-template",null,0,g)(4,ye,4,1,"ng-template",null,1,g),a(),z(6,ve,3,0,"ng-template",null,2,g)(8,Me,3,0,"ng-template",null,3,g)(10,be,3,0,"ng-template",null,4,g)(12,Ee,3,0,"ng-template",null,5,g)),e&2){let t=d(3),l=d(7);x("nzExtra",l),C(),x("ngIf",i.isLoading)("ngIfElse",t)}},dependencies:[P,F,ae,re,K,G,U,q,$,B,oe,ie,fe,de,_e,ge,ee,Z,j,ue,me,pe,se,le,ce,ne,te,L],styles:[".results-container[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px;justify-content:flex-end}.empty-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:300px}.file-name[_ngcontent-%COMP%]{color:#1890ff;cursor:pointer;font-weight:500}.file-name[_ngcontent-%COMP%]:hover{color:#40a9ff;text-decoration:underline}.file-info[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;margin-top:8px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:#666;font-size:14px}.info-item[_ngcontent-%COMP%]   span[nz-icon][_ngcontent-%COMP%]{color:#999}[_nghost-%COMP%]     .ant-list-item{padding:16px;border-radius:6px;margin-bottom:8px;border:1px solid #f0f0f0;transition:all .3s}[_nghost-%COMP%]     .ant-list-item:hover{border-color:#d9d9d9;box-shadow:0 2px 8px #0000001a}[_nghost-%COMP%]     .ant-list-item-meta-title{margin-bottom:8px}[_nghost-%COMP%]     .ant-list-item-action{margin-left:16px}@media (max-width: 768px){.results-container[_ngcontent-%COMP%]{max-width:100%;padding:0 16px}.header-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.file-info[_ngcontent-%COMP%]{flex-direction:column;gap:8px}[_nghost-%COMP%]     .ant-list-item{flex-direction:column;align-items:stretch}[_nghost-%COMP%]     .ant-list-item .ant-list-item-action{margin-left:0;margin-top:12px;justify-content:flex-start}}"]});var xe=S;export{xe as ScanResultComponent};
