import{b as fe}from"./chunk-IAEWG6OQ.js";import{a as ue,b as de,c as _e}from"./chunk-UQIVPWBO.js";import{la as H,na as J,qa as Q,sa as Y,ta as Z}from"./chunk-7X4HMWLL.js";import"./chunk-JTAI6OXW.js";import"./chunk-SIZM2XL7.js";import"./chunk-2DVOMO4J.js";import"./chunk-ESGG6GET.js";import"./chunk-RM2UPRTJ.js";import"./chunk-ZDMID4WZ.js";import"./chunk-C6GNJILK.js";import"./chunk-DZZMBLHF.js";import{d as ae,e as le,f as ce,j as se,k as me,l as pe}from"./chunk-I4RJ42MF.js";import{a as ee,b as te}from"./chunk-6NLRI3PN.js";import"./chunk-RISVK4MK.js";import"./chunk-WLKMTFDT.js";import{d as X}from"./chunk-5QQCSJBI.js";import{m as B}from"./chunk-5SGTTSLW.js";import{a as ne,c as ie}from"./chunk-YLBOLG3L.js";import"./chunk-YKY5U3TM.js";import{f as oe,g as re}from"./chunk-Z54QGPJS.js";import{a as q,b as G,d as K,e as W}from"./chunk-PSWZMC2L.js";import"./chunk-PPZTABUB.js";import"./chunk-TNRS4DF5.js";import"./chunk-EFQNV6DM.js";import"./chunk-26LS3NVR.js";import"./chunk-4TSED7CF.js";import{j}from"./chunk-AU3REAK5.js";import"./chunk-IL3PXM6Z.js";import{Cc as V,Fc as D,Fd as A,Hc as I,Ic as F,Jb as C,Jh as $,Kb as a,Kh as U,Lb as l,Lc as x,Mb as s,Qb as N,R as k,Rb as O,Tb as _,Wb as d,Za as g,Zb as m,d as M,hc as f,jb as E,mc as c,nc as h,oa as w,oc as T,pb as R,r as v,ua as p,va as u,wd as L,yd as P}from"./chunk-JUN3KD4U.js";import"./chunk-PMZOYKO3.js";import{a as b,b as y}from"./chunk-57BLH6QZ.js";var ge=()=>[],Ce=(o,n,t)=>[o,n,t];function ze(o,n){if(o&1){let t=_();N(0),a(1,"nz-result",15)(2,"div",16)(3,"button",10),d("click",function(){p(t);let e=m();return u(e.refresh())}),c(4,"\u91CD\u8A66"),l()()(),O()}if(o&2){let t=m();g(),C("nzSubTitle",t.error)}}function we(o,n){if(o&1){let t=_();a(0,"nz-list-item",18)(1,"nz-list-item-meta")(2,"nz-list-item-meta-title")(3,"a",19),d("click",function(){let e=p(t).$implicit,r=m(2);return u(r.viewResult(e))}),c(4),l()(),a(5,"nz-list-item-meta-description")(6,"div",20)(7,"span",21),s(8,"span",22),c(9),l(),a(10,"span",21),s(11,"span",23),c(12," \u9801\u6578\u7BC4\u570D\uFF1A"),a(13,"nz-tag",24),c(14),l()(),a(15,"span",21),s(16,"span",25),c(17),l()()()()()}if(o&2){let t=n.$implicit,i=m(2),e=f(17),r=f(19),S=f(21);C("nzActions",D(5,Ce,e,r,S)),g(4),h(t.fileName),g(5),T(" \u6A94\u6848\u5927\u5C0F\uFF1A",i.formatFileSize(t.fileSize)," "),g(5),h(t.pageRange),g(3),T(" \u63D0\u53D6\u6642\u9593\uFF1A",i.formatDate(t.createdAt)," ")}}function Re(o,n){if(o&1&&(a(0,"nz-list",17),I(1,"async"),R(2,we,18,9,"ng-template",null,6,x),l()),o&2){let t=f(3),i=m(),e=f(15);C("nzDataSource",F(1,5,i.scanResults$)||V(7,ge))("nzRenderItem",t)("nzItemLayout","horizontal")("nzLoading",i.isLoading)("nzNoResult",e)}}function Se(o,n){if(o&1){let t=_();a(0,"button",26),d("click",function(){p(t);let e=m();return u(e.goToScan())}),s(1,"span",11),c(2," \u6383\u63CF "),l()}}function he(o,n){if(o&1){let t=_();a(0,"nz-empty",27)(1,"button",10),d("click",function(){p(t);let e=m();return u(e.goToScan())}),s(2,"span",11),c(3," \u958B\u59CB\u6383\u63CF "),l()()}}function Te(o,n){if(o&1){let t=_();a(0,"button",26),d("click",function(){let e=p(t).$implicit,r=m();return u(r.viewResult(e))}),s(1,"span",28),c(2," \u67E5\u770B "),l()}}function be(o,n){if(o&1){let t=_();a(0,"button",26),d("click",function(){let e=p(t).$implicit,r=m();return u(r.downloadMarkdown(e))}),s(1,"span",29),c(2," MD "),l()}}function ye(o,n){if(o&1){let t=_();a(0,"button",26),d("click",function(){let e=p(t).$implicit,r=m();return u(r.downloadText(e))}),s(1,"span",23),c(2," TXT "),l()}}var z=class z{constructor(){this.firestore=w(H);this.router=w(B);this.message=w(X);this.scanResults$=v([]);this.isLoading=!0;this.error=""}ngOnInit(){this.loadScanResults()}loadScanResults(){this.isLoading=!0,this.error="",this.scanResults$=new M(n=>{let t=Z(J(this.firestore,"scan-results"),Y("createdAt","desc"));Q(t).then(i=>{let e=[];i.forEach(r=>{let S=r.data();e.push(y(b({},S),{id:r.id}))}),n.next(e),n.complete()}).catch(i=>{console.error("Error loading scan results:",i),this.error="\u8F09\u5165\u6383\u63CF\u7D50\u679C\u5931\u6557",n.next([]),n.complete()})}).pipe(k(()=>{this.isLoading=!1}))}formatFileSize(n){if(n===0)return"0 Bytes";let t=1024,i=["Bytes","KB","MB","GB"],e=Math.floor(Math.log(n)/Math.log(t));return parseFloat((n/Math.pow(t,e)).toFixed(2))+" "+i[e]}formatDate(n){return new Date(n).toLocaleString()}viewResult(n){n.id&&this.router.navigate(["/tree/scan-result",n.id])}downloadMarkdown(n){let t=new Blob([n.markdownContent],{type:"text/markdown;charset=utf-8"}),i=window.URL.createObjectURL(t),e=document.createElement("a");e.href=i,e.download=`${n.fileName.replace(".pdf","")}_extracted.md`,document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(i),this.message.success("Markdown \u6587\u4EF6\u5DF2\u4E0B\u8F09")}downloadText(n){let t=new Blob([n.extractedText],{type:"text/plain;charset=utf-8"}),i=window.URL.createObjectURL(t),e=document.createElement("a");e.href=i,e.download=`${n.fileName.replace(".pdf","")}_extracted.txt`,document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(i),this.message.success("\u6587\u5B57\u6587\u4EF6\u5DF2\u4E0B\u8F09")}goToScan(){this.router.navigate(["/tree/pdf-scan"])}refresh(){this.loadScanResults()}};z.\u0275fac=function(t){return new(t||z)},z.\u0275cmp=E({type:z,selectors:[["app-scan-result"]],decls:22,vars:3,consts:[["listContent",""],["extraTemplate",""],["emptyTemplate",""],["viewAction",""],["downloadMdAction",""],["downloadTxtAction",""],["item",""],["nzTitle","\u6383\u63CF\u7D50\u679C\u5217\u8868",3,"nzExtra"],[1,"results-container"],[1,"header-actions"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","scan"],["nz-button","",3,"click"],["nz-icon","","nzType","reload"],[4,"ngIf","ngIfElse"],["nzStatus","error","nzTitle","\u8F09\u5165\u5931\u6557",3,"nzSubTitle"],["nz-result-extra",""],[3,"nzDataSource","nzRenderItem","nzItemLayout","nzLoading","nzNoResult"],[3,"nzActions"],[1,"file-name",3,"click"],[1,"file-info"],[1,"info-item"],["nz-icon","","nzType","file-pdf"],["nz-icon","","nzType","file-text"],["nzColor","blue"],["nz-icon","","nzType","clock-circle"],["nz-button","","nzType","link",3,"click"],["nzNotFoundImage","simple","nzNotFoundContent","\u76EE\u524D\u6C92\u6709\u6383\u63CF\u7D50\u679C"],["nz-icon","","nzType","eye"],["nz-icon","","nzType","file-markdown"]],template:function(t,i){if(t&1){let e=_();a(0,"nz-card",7)(1,"div",8)(2,"div",9)(3,"button",10),d("click",function(){return p(e),u(i.goToScan())}),s(4,"span",11),c(5," \u65B0\u589E\u6383\u63CF "),l(),a(6,"button",12),d("click",function(){return p(e),u(i.refresh())}),s(7,"span",13),c(8," \u91CD\u65B0\u6574\u7406 "),l()(),R(9,ze,5,1,"ng-container",14)(10,Re,4,8,"ng-template",null,0,x),l()(),R(12,Se,3,0,"ng-template",null,1,x)(14,he,4,0,"ng-template",null,2,x)(16,Te,3,0,"ng-template",null,3,x)(18,be,3,0,"ng-template",null,4,x)(20,ye,3,0,"ng-template",null,5,x)}if(t&2){let e=f(11),r=f(13);C("nzExtra",r),g(9),C("ngIf",i.error)("ngIfElse",e)}},dependencies:[A,L,re,oe,W,K,q,G,U,$,_e,de,ue,fe,te,ee,j,pe,se,me,ce,ae,le,ie,ne,P],styles:[".results-container[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto}.header-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px;justify-content:flex-end}.file-name[_ngcontent-%COMP%]{color:#1890ff;cursor:pointer;font-weight:500}.file-name[_ngcontent-%COMP%]:hover{color:#40a9ff;text-decoration:underline}.file-info[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;margin-top:8px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:#666;font-size:14px}.info-item[_ngcontent-%COMP%]   span[nz-icon][_ngcontent-%COMP%]{color:#999}[_nghost-%COMP%]     .ant-list-item{padding:16px;border-radius:6px;margin-bottom:8px;border:1px solid #f0f0f0;transition:all .3s}[_nghost-%COMP%]     .ant-list-item:hover{border-color:#d9d9d9;box-shadow:0 2px 8px #0000001a}[_nghost-%COMP%]     .ant-list-item-meta-title{margin-bottom:8px}[_nghost-%COMP%]     .ant-list-item-action{margin-left:16px}@media (max-width: 768px){.results-container[_ngcontent-%COMP%]{max-width:100%;padding:0 16px}.header-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.file-info[_ngcontent-%COMP%]{flex-direction:column;gap:8px}[_nghost-%COMP%]     .ant-list-item{flex-direction:column;align-items:stretch}[_nghost-%COMP%]     .ant-list-item .ant-list-item-action{margin-left:0;margin-top:12px;justify-content:flex-start}}"]});var xe=z;export{xe as ScanResultComponent};
