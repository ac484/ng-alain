import{a as gt,h as te,l as Vt}from"./chunk-PP2WIZUM.js";import{a as I,b as ze,c as Ge}from"./chunk-I37CWRWG.js";import{n as zt,o as ee,s as vt,v as ht,w as Ct,x as yt,y as St,z as bt}from"./chunk-N3DTICCK.js";import"./chunk-VAGS5EVQ.js";import{a as Lt,b as Ot,c as Ut}from"./chunk-Y7P3YCRI.js";import{d as w}from"./chunk-HGFRKFU7.js";import{Aa as q,B as L,Ba as W,Ca as qe,Da as $,Ea as j,Fa as K,Ha as H,J as wt,L as Tt,La as We,Ma as $e,Na as je,Oa as oe,P as kt,Pa as Ke,Qa as He,R as Et,Ra as It,Ta as Ft,bb as Bt,cb as Pt,db as Rt,eb as At,i as F,j as d,k as B,l as P,m as _t,ma as Dt,na as xt,o as Nt,oa as Mt,q as R,s as A,sa as O,ua as U,v as V,xa as G,z as ie}from"./chunk-RIIMSFG6.js";import{$b as pt,Ea as o,Eh as C,Hb as Q,Kh as y,La as v,Lb as rt,Mb as c,Mh as S,N as Ae,Nb as x,Nh as b,Ob as h,Qb as nt,Ra as J,Rb as at,Sb as st,Ta as ue,Tc as Oe,Vi as ge,Xb as lt,Zi as ae,_b as Ve,ab as E,ac as mt,aj as Ue,cb as D,da as s,ec as m,fc as u,gc as ct,hb as p,hc as Z,ia as T,ib as r,ja as k,jb as n,kb as f,od as N,pd as fe,rb as de,ub as g,vh as re,wh as ne,wi as ut,xb as se,xi as dt,yc as Le,yi as ft}from"./chunk-GSKYGLQZ.js";import{a as it,i as M}from"./chunk-57BLH6QZ.js";var ve=class ve{constructor(){this.socialService=s(ze);this.settingsSrv=s(ge);this.type=""}ngOnInit(){this.mockModel()}mockModel(){let t={token:"123456789",name:"cipchk",email:`${this.type}@${this.type}.com`,id:1e4,time:+new Date};this.settingsSrv.setUser(it(it({},this.settingsSrv.user),t)),this.socialService.callback(t)}};ve.\u0275fac=function(e){return new(e||ve)},ve.\u0275cmp=v({type:ve,selectors:[["app-callback"]],inputs:{type:"type"},features:[Ve([ze])],decls:0,vars:0,template:function(e,i){},encapsulation:2});var Ye=ve;var he=class he{constructor(){this.tokenService=s(I);this.settings=s(ge);this.router=s(N);this.f=new _t({password:new Nt("",{nonNullable:!0,validators:[d.required]})})}get user(){return this.settings.user}submit(){this.f.controls.password.markAsDirty(),this.f.controls.password.updateValueAndValidity(),this.f.valid&&(console.log("Valid!"),console.log(this.f.value),this.tokenService.set({token:"123"}),this.router.navigate(["dashboard"]))}};he.\u0275fac=function(e){return new(e||he)},he.\u0275cmp=v({type:he,selectors:[["passport-lock"]],decls:15,vars:11,consts:[[1,"ant-card","width-lg",2,"margin","0 auto"],[1,"ant-card-body"],[1,"avatar"],["nzIcon","user","nzSize","large",3,"nzSrc"],["nz-form","","role","form",1,"mt-md",3,"ngSubmit","formGroup"],[3,"nzErrorTip"],["nzSuffixIcon","lock"],["type","password","nz-input","","formControlName","password"],["nz-row","","nzType","flex","nzAlign","middle"],["nz-col","",2,"text-align","right",3,"nzOffset","nzSpan"],["nz-button","","nzType","primary",3,"disabled"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),f(3,"nz-avatar",3),n(),r(4,"form",4),g("ngSubmit",function(){return i.submit()}),r(5,"nz-form-item")(6,"nz-form-control",5),m(7,"i18n"),r(8,"nz-input-group",6),f(9,"input",7),n()()(),r(10,"div",8)(11,"div",9)(12,"button",10),c(13),m(14,"i18n"),n()()()()()()),e&2&&(o(3),p("nzSrc",i.user.avatar),o(),p("formGroup",i.f),o(2),p("nzErrorTip",u(7,7,"validation.password.required")),o(5),p("nzOffset",12)("nzSpan",12),o(),p("disabled",!i.f.valid),o(),x(u(14,9,"app.lock")))},dependencies:[L,R,F,B,P,A,V,Ft,It,H,W,q,j,$,K,qe,b,S,C,y,G,O,U,ae],styles:["[_nghost-%COMP%]     .ant-card-body{position:relative;margin-top:80px}[_nghost-%COMP%]     .avatar{position:absolute;top:-20px;left:50%;margin-left:-20px}"]});var Xe=he;var Ce=class Ce{constructor(){this.router=s(N);this.message=s(w);this.auth=s(ee);this.startupService=s(te);this.tokenService=s(I);this.reuseTabService=s(oe,{optional:!0});this.loading=!1}loginAnonymously(){return M(this,null,function*(){this.loading=!0;try{let e=(yield yt(this.auth)).user,i={token:e.uid,name:e.displayName||e.email||"Anonymous",email:e.email||"",id:e.uid,time:+new Date,role:"user",permissions:["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("\u533F\u540D\u767B\u5165\u6210\u529F\uFF0C\u8A2D\u5B9A token:",i),this.tokenService.set(i),this.message.success("\u533F\u540D\u767B\u5165\u6210\u529F\uFF01"),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let l=this.tokenService.referrer?.url||"/";l.includes("/passport")&&(l="/"),this.router.navigateByUrl(l)})}catch(t){console.error("\u533F\u540D\u767B\u5165\u5931\u6557:",t),this.message.error("\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};Ce.\u0275fac=function(e){return new(e||Ce)},Ce.\u0275cmp=v({type:Ce,selectors:[["app-anonymous-login"]],decls:1,vars:0,consts:[["nzType","user","nzTheme","outline",1,"icon",3,"click"]],template:function(e,i){e&1&&(r(0,"nz-icon",0),g("click",function(){return i.loginAnonymously()}),n())},dependencies:[ne,re],encapsulation:2});var Je=Ce;var ye=class ye{constructor(){this.message=s(w);this.auth=s(ee);this.startupService=s(te);this.router=s(N);this.fb=s(ie);this.tokenService=s(I);this.reuseTabService=s(oe,{optional:!0});this.loginSuccess=new ue;this.loading=!1;this.loginForm=this.fb.nonNullable.group({email:["",[d.required,d.email]],password:["",[d.required,d.minLength(6)]]})}login(){return M(this,null,function*(){if(this.loginForm.invalid){this.markFormGroupTouched(this.loginForm);return}this.loading=!0;let{email:t,password:e}=this.loginForm.value;try{let l=(yield St(this.auth,t,e)).user,z={token:l.uid,name:l.displayName||l.email||"Anonymous",email:l.email||"",id:l.uid,time:+new Date,role:"user",permissions:["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("\u90F5\u7BB1\u767B\u5165\u6210\u529F\uFF0C\u8A2D\u5B9A token:",z),this.tokenService.set(z),this.message.success("\u90F5\u7BB1\u767B\u5165\u6210\u529F\uFF01"),this.loginSuccess.emit(),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let _=this.tokenService.referrer?.url||"/";_.includes("/passport")&&(_="/"),this.router.navigateByUrl(_)})}catch(i){console.error("\u767B\u5165\u5931\u6557:",i),this.message.error(this.getErrorMessage(i.code))}finally{this.loading=!1}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let i=t.controls[e];i.markAsTouched(),i.controls&&this.markFormGroupTouched(i)})}getErrorMessage(t){switch(t){case"auth/user-not-found":return"\u7528\u6236\u4E0D\u5B58\u5728";case"auth/wrong-password":return"\u5BC6\u78BC\u932F\u8AA4";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};ye.\u0275fac=function(e){return new(e||ye)},ye.\u0275cmp=v({type:ye,selectors:[["app-email-login-form"]],outputs:{loginSuccess:"loginSuccess"},decls:12,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nzErrorTip","\u8ACB\u8F38\u5165\u5BC6\u78BC"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","\u5BC6\u78BC"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,i){e&1&&(r(0,"form",0),g("ngSubmit",function(){return i.login()}),r(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),f(4,"input",3),n()()(),r(5,"nz-form-item")(6,"nz-form-control",4)(7,"nz-input-group",5),f(8,"input",6),n()()(),r(9,"nz-form-item")(10,"button",7),c(11," \u767B\u5165 "),n()()()),e&2&&(p("formGroup",i.loginForm),o(10),p("nzLoading",i.loading))},dependencies:[L,R,F,B,P,A,V,H,W,q,j,$,K,G,O,U,b,S,C,y],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Ie=ye;var Se=class Se{constructor(){this.message=s(w);this.auth=s(ee);this.startupService=s(te);this.router=s(N);this.fb=s(ie);this.tokenService=s(I);this.reuseTabService=s(oe,{optional:!0});this.registerSuccess=new ue;this.loading=!1;this.registerForm=this.fb.nonNullable.group({email:["",[d.required,d.email]],password:["",[d.required,d.minLength(6)]],confirmPassword:["",[d.required]]},{validators:this.passwordMatchValidator})}passwordMatchValidator(t){let e=t.get("password"),i=t.get("confirmPassword");return e&&i&&e.value!==i.value?{passwordMismatch:!0}:null}register(){return M(this,null,function*(){if(this.registerForm.invalid){this.markFormGroupTouched(this.registerForm);return}this.loading=!0;let{email:t,password:e}=this.registerForm.value;try{let l=(yield vt(this.auth,t,e)).user;yield ht(l);let z={token:l.uid,name:l.displayName||l.email||"Anonymous",email:l.email||"",id:l.uid,time:+new Date,role:"user",permissions:["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("\u90F5\u7BB1\u8A3B\u518A\u6210\u529F\uFF0C\u8A2D\u5B9A token:",z),this.tokenService.set(z),this.message.success("\u90F5\u7BB1\u8A3B\u518A\u6210\u529F\uFF01\u8ACB\u6AA2\u67E5\u90F5\u7BB1\u9032\u884C\u9A57\u8B49\u3002"),this.registerSuccess.emit(),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let _=this.tokenService.referrer?.url||"/";_.includes("/passport")&&(_="/"),this.router.navigateByUrl(_)})}catch(i){console.error("\u8A3B\u518A\u5931\u6557:",i),this.message.error(this.getErrorMessage(i.code))}finally{this.loading=!1}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let i=t.controls[e];i.markAsTouched(),i.controls&&this.markFormGroupTouched(i)})}getErrorMessage(t){switch(t){case"auth/email-already-in-use":return"\u90F5\u7BB1\u5DF2\u88AB\u4F7F\u7528";case"auth/weak-password":return"\u5BC6\u78BC\u5F37\u5EA6\u592A\u5F31";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u8A3B\u518A\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};Se.\u0275fac=function(e){return new(e||Se)},Se.\u0275cmp=v({type:Se,selectors:[["app-email-register-form"]],outputs:{registerSuccess:"registerSuccess"},decls:16,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nzErrorTip","\u5BC6\u78BC\u81F3\u5C116\u4F4D"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","\u5BC6\u78BC"],["nzErrorTip","\u8ACB\u78BA\u8A8D\u5BC6\u78BC"],["nz-input","","type","password","formControlName","confirmPassword","placeholder","\u78BA\u8A8D\u5BC6\u78BC"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,i){e&1&&(r(0,"form",0),g("ngSubmit",function(){return i.register()}),r(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),f(4,"input",3),n()()(),r(5,"nz-form-item")(6,"nz-form-control",4)(7,"nz-input-group",5),f(8,"input",6),n()()(),r(9,"nz-form-item")(10,"nz-form-control",7)(11,"nz-input-group",5),f(12,"input",8),n()()(),r(13,"nz-form-item")(14,"button",9),c(15," \u8A3B\u518A "),n()()()),e&2&&(p("formGroup",i.registerForm),o(14),p("nzLoading",i.loading))},dependencies:[L,R,F,B,P,A,V,H,W,q,j,$,K,G,O,U,b,S,C,y],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Fe=Se;var be=class be{constructor(){this.message=s(w);this.auth=s(ee);this.fb=s(ie);this.resetSuccess=new ue;this.loading=!1;this.resetForm=this.fb.nonNullable.group({email:["",[d.required,d.email]]})}resetPassword(){return M(this,null,function*(){if(this.resetForm.invalid){this.markFormGroupTouched(this.resetForm);return}this.loading=!0;let{email:t}=this.resetForm.value;try{yield Ct(this.auth,t),this.message.success("\u5BC6\u78BC\u91CD\u7F6E\u90F5\u7BB1\u5DF2\u767C\u9001\uFF0C\u8ACB\u6AA2\u67E5\u90F5\u7BB1\u3002"),this.resetSuccess.emit()}catch(e){console.error("\u767C\u9001\u91CD\u7F6E\u90F5\u7BB1\u5931\u6557:",e),this.message.error(this.getErrorMessage(e.code))}finally{this.loading=!1}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let i=t.controls[e];i.markAsTouched(),i.controls&&this.markFormGroupTouched(i)})}getErrorMessage(t){switch(t){case"auth/user-not-found":return"\u7528\u6236\u4E0D\u5B58\u5728";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u767C\u9001\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};be.\u0275fac=function(e){return new(e||be)},be.\u0275cmp=v({type:be,selectors:[["app-email-reset-form"]],outputs:{resetSuccess:"resetSuccess"},decls:8,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,i){e&1&&(r(0,"form",0),g("ngSubmit",function(){return i.resetPassword()}),r(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),f(4,"input",3),n()()(),r(5,"nz-form-item")(6,"button",4),c(7," \u767C\u9001\u91CD\u7F6E\u90F5\u7BB1 "),n()()()),e&2&&(p("formGroup",i.resetForm),o(6),p("nzLoading",i.loading))},dependencies:[L,R,F,B,P,A,V,H,W,q,j,$,K,G,O,U,b,S,C,y],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Be=be;var _e=class _e{constructor(){this.modalRef=s(ut)}onLoginSuccess(){this.modalRef.close({type:"login",success:!0})}onRegisterSuccess(){this.modalRef.close({type:"register",success:!0})}onResetSuccess(){this.modalRef.close({type:"reset",success:!0})}};_e.\u0275fac=function(e){return new(e||_e)},_e.\u0275cmp=v({type:_e,selectors:[["app-email-login-modal"]],decls:8,vars:4,consts:[[1,"email-auth-modal"],[3,"nzAnimated"],[3,"nzTitle"],[3,"loginSuccess"],[3,"registerSuccess"],[3,"resetSuccess"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"nz-tabs",1)(2,"nz-tab",2)(3,"app-email-login-form",3),g("loginSuccess",function(){return i.onLoginSuccess()}),n()(),r(4,"nz-tab",2)(5,"app-email-register-form",4),g("registerSuccess",function(){return i.onRegisterSuccess()}),n()(),r(6,"nz-tab",2)(7,"app-email-reset-form",5),g("resetSuccess",function(){return i.onResetSuccess()}),n()()()()),e&2&&(o(),p("nzAnimated",!1),o(),p("nzTitle","\u767B\u5165"),o(2),p("nzTitle","\u8A3B\u518A"),o(2),p("nzTitle","\u91CD\u7F6E\u5BC6\u78BC"))},dependencies:[ft,je,$e,We,Ie,Fe,Be],styles:[".email-auth-modal[_ngcontent-%COMP%]{padding:20px 0}.ant-tabs-content-holder[_ngcontent-%COMP%]{padding-top:16px}"]});var Pe=_e;var Ne=class Ne{constructor(){this.message=s(w);this.modalService=s(dt);this.loading=!1}loginWithEmail(){return M(this,null,function*(){this.loading=!0;try{this.modalService.create({nzTitle:"\u90F5\u7BB1\u767B\u5165/\u8A3B\u518A",nzContent:Pe,nzWidth:400,nzFooter:null,nzClosable:!0,nzMaskClosable:!1}).afterClose.subscribe(e=>{e&&e.success&&this.message.success("\u64CD\u4F5C\u6210\u529F\uFF01")})}catch(t){console.error("\u90F5\u7BB1\u767B\u5165\u5931\u6557:",t),this.message.error("\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};Ne.\u0275fac=function(e){return new(e||Ne)},Ne.\u0275cmp=v({type:Ne,selectors:[["app-email-login"]],decls:1,vars:0,consts:[["nzType","mail","nzTheme","outline",1,"icon",3,"click"]],template:function(e,i){e&1&&(r(0,"nz-icon",0),g("click",function(){return i.loginWithEmail()}),n())},dependencies:[ne,re],encapsulation:2});var Re=Ne;var we=class we{constructor(){this.router=s(N);this.message=s(w);this.auth=s(ee);this.startupService=s(te);this.tokenService=s(I);this.reuseTabService=s(oe,{optional:!0});this.loading=!1}loginWithGoogle(){return M(this,null,function*(){this.loading=!0;try{let t=new zt,i=(yield bt(this.auth,t)).user,l={token:i.uid,name:i.displayName||i.email||"Anonymous",email:i.email||"",id:i.uid,time:+new Date,role:"user",permissions:["dashboard"],expired:+new Date+1e3*60*60*24*7};console.log("Google \u767B\u5165\u6210\u529F\uFF0C\u8A2D\u5B9A token:",l),this.tokenService.set(l),this.message.success("Google \u767B\u5165\u6210\u529F\uFF01"),this.reuseTabService?.clear(),this.startupService.load().subscribe(()=>{let z=this.tokenService.referrer?.url||"/";z.includes("/passport")&&(z="/"),this.router.navigateByUrl(z)})}catch(t){console.error("Google \u767B\u5165\u5931\u6557:",t),this.message.error("Google \u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};we.\u0275fac=function(e){return new(e||we)},we.\u0275cmp=v({type:we,selectors:[["app-google-auth"]],decls:2,vars:1,consts:[["nz-button","","nzType","primary","nzSize","large",1,"google-login-btn",3,"click","nzLoading"],["nzType","google","nzTheme","outline"]],template:function(e,i){e&1&&(r(0,"button",0),g("click",function(){return i.loginWithGoogle()}),f(1,"nz-icon",1),n()),e&2&&p("nzLoading",i.loading)},dependencies:[b,S,C,y,ne,re],styles:[".google-login-btn[_ngcontent-%COMP%]{width:100%;height:40px;border-radius:6px;display:flex;align-items:center;justify-content:center;gap:8px}"]});var Qe=we;function Kt(a,t){if(a&1&&f(0,"nz-alert",4),a&2){let e=se();p("nzType","error")("nzMessage",e.error)("nzShowIcon",!0)}}function Ht(a,t){a&1&&(c(0),m(1,"i18n")),a&2&&h(" ",u(1,1,"validation.phone-number.required")," ")}function Yt(a,t){a&1&&(c(0),m(1,"i18n")),a&2&&h(" ",u(1,1,"validation.phone-number.wrong-format")," ")}function Xt(a,t){if(a&1&&(E(0,Ht,2,3),E(1,Yt,2,3)),a&2){let e=t.$implicit;D(e.errors.required?0:-1),o(),D(e.errors.pattern?1:-1)}}var Te=class Te{constructor(){this.router=s(N);this.settingsService=s(ge);this.socialService=s(ze);this.reuseTabService=s(oe,{optional:!0});this.tokenService=s(I);this.startupSrv=s(te);this.http=s(Ue);this.cdr=s(Le);this.form=s(ie).nonNullable.group({userName:["",[d.required,d.pattern(/^(admin|user)$/)]],password:["",[d.required,d.pattern(/^(ng-alain\.com)$/)]],mobile:["",[d.required,d.pattern(/^1\d{10}$/)]],captcha:["",[d.required]],remember:[!0]});this.error="";this.type=0;this.loading=!1;this.count=0}switch({index:t}){this.type=t}getCaptcha(){let t=this.form.controls.mobile;if(t.invalid){t.markAsDirty({onlySelf:!0}),t.updateValueAndValidity({onlySelf:!0});return}this.count=59,this.interval$=setInterval(()=>{this.count-=1,this.count<=0&&clearInterval(this.interval$)},1e3)}submit(){if(this.error="",this.type===0){let{userName:t,password:e}=this.form.controls;if(t.markAsDirty(),t.updateValueAndValidity(),e.markAsDirty(),e.updateValueAndValidity(),t.invalid||e.invalid)return}else{let{mobile:t,captcha:e}=this.form.controls;if(t.markAsDirty(),t.updateValueAndValidity(),e.markAsDirty(),e.updateValueAndValidity(),t.invalid||e.invalid)return}this.loading=!0,this.cdr.detectChanges(),this.http.post("/login/account",{type:this.type,userName:this.form.value.userName,password:this.form.value.password},null,{context:new Oe().set(Ge,!0)}).pipe(Ae(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(t=>{if(t.msg!=="ok"){this.error=t.msg,this.cdr.detectChanges();return}this.reuseTabService?.clear(),t.user.expired=+new Date+1e3*60*5,this.tokenService.set(t.user),this.startupSrv.load().subscribe(()=>{let e=this.tokenService.referrer.url||"/";e.includes("/passport")&&(e="/"),this.router.navigateByUrl(e)})})}open(t,e="href"){let i="",l="";switch(gt.production?l=`https://ng-alain.github.io/ng-alain/#/passport/callback/${t}`:l=`http://localhost:4200/#/passport/callback/${t}`,t){case"auth0":i=`//cipchk.auth0.com/login?client=8gcNydIDzGBYxzqV0Vm1CX_RXH-wsWo5&redirect_uri=${decodeURIComponent(l)}`;break;case"github":i=`//github.com/login/oauth/authorize?client_id=9d6baae4b04a23fcafa2&response_type=code&redirect_uri=${decodeURIComponent(l)}`;break;case"weibo":i=`https://api.weibo.com/oauth2/authorize?client_id=1239507802&response_type=code&redirect_uri=${decodeURIComponent(l)}`;break}e==="window"?this.socialService.login(i,"/",{type:"window"}).subscribe(z=>{z&&(this.settingsService.setUser(z),this.router.navigateByUrl("/"))}):this.socialService.login(i,"/",{type:"href"})}ngOnDestroy(){this.interval$&&clearInterval(this.interval$)}};Te.\u0275fac=function(e){return new(e||Te)},Te.\u0275cmp=v({type:Te,selectors:[["passport-login"]],features:[Ve([ze])],decls:57,vars:39,consts:[["mobileErrorTip",""],["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"tabs",3,"nzSelectChange","nzAnimated"],[3,"nzTitle"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],["nzErrorTip","Please enter mobile number, muse be: admin or user"],["nzSize","large","nzPrefixIcon","user"],["nz-input","","formControlName","userName","placeholder","username: admin or user"],["nzErrorTip","Please enter password, muse be: ng-alain.com"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","password: ng-alain.com"],[3,"nzErrorTip"],["nz-input","","formControlName","mobile","placeholder","mobile number"],[3,"nzGutter"],[3,"nzSpan"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","captcha","placeholder","captcha"],["type","button","nz-button","","nzSize","large","nzBlock","",3,"click","disabled","nzLoading"],["nz-checkbox","","formControlName","remember"],[1,"text-right",3,"nzSpan"],["routerLink","/passport/register",1,"forgot"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"],[1,"other"],["nz-tooltip","","nzTooltipTitle","in fact Auth0 via window","nz-icon","","nzType","alipay-circle",1,"icon",3,"click"],["nz-tooltip","","nzTooltipTitle","in fact Github via redirect","nz-icon","","nzType","taobao-circle",1,"icon",3,"click"],["nz-icon","","nzType","weibo-circle",1,"icon",3,"click"],["routerLink","/passport/register",1,"register"]],template:function(e,i){if(e&1){let l=de();r(0,"form",1),g("ngSubmit",function(){return T(l),k(i.submit())}),r(1,"nz-tabs",2),g("nzSelectChange",function(_){return T(l),k(i.switch(_))}),r(2,"nz-tab",3),m(3,"i18n"),E(4,Kt,1,3,"nz-alert",4),r(5,"nz-form-item")(6,"nz-form-control",5)(7,"nz-input-group",6),f(8,"input",7),n()()(),r(9,"nz-form-item")(10,"nz-form-control",8)(11,"nz-input-group",9),f(12,"input",10),n()()()(),r(13,"nz-tab",3),m(14,"i18n"),r(15,"nz-form-item")(16,"nz-form-control",11)(17,"nz-input-group",6),f(18,"input",12),n(),J(19,Xt,2,2,"ng-template",null,0,Z),n()(),r(21,"nz-form-item")(22,"nz-form-control",11),m(23,"i18n"),r(24,"nz-row",13)(25,"nz-col",14)(26,"nz-input-group",15),f(27,"input",16),n()(),r(28,"nz-col",14)(29,"button",17),g("click",function(){return T(l),k(i.getCaptcha())}),c(30),m(31,"i18n"),n()()()()()()(),r(32,"nz-form-item")(33,"nz-col",14)(34,"label",18),c(35),m(36,"i18n"),n()(),r(37,"nz-col",19)(38,"a",20),c(39),m(40,"i18n"),n()()(),r(41,"nz-form-item")(42,"button",21),c(43),m(44,"i18n"),n()()(),r(45,"div",22),c(46),m(47,"i18n"),r(48,"i",23),g("click",function(){return T(l),k(i.open("auth0","window"))}),n(),r(49,"i",24),g("click",function(){return T(l),k(i.open("github"))}),n(),r(50,"i",25),g("click",function(){return T(l),k(i.open("weibo","window"))}),n(),f(51,"app-google-auth")(52,"app-anonymous-login")(53,"app-email-login"),r(54,"a",26),c(55),m(56,"i18n"),n()()}if(e&2){let l=Q(20);p("formGroup",i.form),o(),p("nzAnimated",!1),o(),p("nzTitle",u(3,21,"app.login.tab-login-credentials")),o(2),D(i.error?4:-1),o(9),p("nzTitle",u(14,23,"app.login.tab-login-mobile")),o(3),p("nzErrorTip",l),o(6),p("nzErrorTip",u(23,25,"validation.verification-code.required")),o(2),p("nzGutter",8),o(),p("nzSpan",16),o(3),p("nzSpan",8),o(),p("disabled",i.count>=0)("nzLoading",i.loading),o(),h(" ",i.count?i.count+"s":u(31,27,"app.register.get-verification-code")," "),o(3),p("nzSpan",12),o(2),x(u(36,29,"app.login.remember-me")),o(2),p("nzSpan",12),o(2),x(u(40,31,"app.login.forgot-password")),o(3),p("nzLoading",i.loading),o(),h(" ",u(44,33,"app.login.login")," "),o(3),h(" ",u(47,35,"app.login.sign-in-with")," "),o(9),x(u(56,37,"app.login.signup"))}},dependencies:[fe,L,R,F,B,P,A,V,Tt,wt,je,$e,We,He,Ke,H,W,q,j,$,K,G,O,U,b,S,C,y,Et,kt,ne,re,Je,Re,Qe,ae],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     .ant-tabs .ant-tabs-bar{margin-bottom:24px;text-align:center;border-bottom:0}[_nghost-%COMP%]     .ant-tabs-tab{font-size:16px;line-height:24px}[_nghost-%COMP%]     .ant-input-affix-wrapper .ant-input:not(:first-child){padding-left:4px}[_nghost-%COMP%]     .icon{cursor:pointer;margin-left:16px;font-size:24px;color:#0003;vertical-align:middle;transition:color .3s}[_nghost-%COMP%]     .icon:hover{color:#1890ff}[_nghost-%COMP%]     app-anonymous-login, [_nghost-%COMP%]     app-email-login, [_nghost-%COMP%]     app-logout{margin-left:16px;display:inline-block;vertical-align:middle}[_nghost-%COMP%]     .other{margin-top:24px;line-height:22px;text-align:left}[_nghost-%COMP%]     .other nz-tooltip{vertical-align:middle}[_nghost-%COMP%]     .other .register{float:right}[data-theme=dark]   [_nghost-%COMP%]     .icon{color:#fff3}[data-theme=dark]   [_nghost-%COMP%]     .icon:hover{color:#fff}"],changeDetection:0});var Ze=Te;function Gt(a,t){return e=>{let i=e.get(a),l=e.get(t);return l.errors&&!l.errors.matchControl||(i.value!==l.value?l.setErrors({matchControl:!0}):l.setErrors(null)),null}}var Jt=()=>({"width.px":240});function Qt(a,t){if(a&1&&f(0,"nz-alert",6),a&2){let e=se();p("nzType","error")("nzMessage",e.error)("nzShowIcon",!0)}}function Zt(a,t){a&1&&(c(0),m(1,"i18n")),a&2&&h(" ",u(1,1,"validation.email.required")," ")}function ei(a,t){a&1&&(c(0),m(1,"i18n")),a&2&&h(" ",u(1,1,"validation.email.wrong-format")," ")}function ti(a,t){if(a&1&&(E(0,Zt,2,3),E(1,ei,2,3)),a&2){let e=t.$implicit;D(e.errors!=null&&e.errors.required?0:-1),o(),D(e.errors!=null&&e.errors.email?1:-1)}}function ii(a,t){a&1&&(r(0,"div",24),c(1),m(2,"i18n"),n()),a&2&&(o(),x(u(2,1,"validation.password.strength.strong")))}function oi(a,t){a&1&&(r(0,"div",25),c(1),m(2,"i18n"),n()),a&2&&(o(),x(u(2,1,"validation.password.strength.medium")))}function ri(a,t){a&1&&(r(0,"div",26),c(1),m(2,"i18n"),n()),a&2&&(o(),x(u(2,1,"validation.password.strength.short")))}function ni(a,t){if(a&1&&(r(0,"div",23),E(1,ii,3,3,"div",24)(2,oi,3,3,"div",25)(3,ri,3,3,"div",26),r(4,"div"),f(5,"nz-progress",27),n(),r(6,"p",28),c(7),m(8,"i18n"),n()()),a&2){let e,i=se();o(),D((e=i.status)==="ok"?1:e==="pass"?2:3),o(3),rt(lt("progress-",i.status)),o(),p("nzPercent",i.progress)("nzStatus",i.passwordProgressMap[i.status])("nzStrokeWidth",6)("nzShowInfo",!1),o(2),x(u(8,9,"validation.password.strength.msg"))}}function ai(a,t){a&1&&(c(0),m(1,"i18n")),a&2&&h(" ",u(1,1,"validation.confirm-password.required")," ")}function si(a,t){a&1&&(c(0),m(1,"i18n")),a&2&&h(" ",u(1,1,"validation.password.twice")," ")}function li(a,t){if(a&1&&(E(0,ai,2,3),E(1,si,2,3)),a&2){let e=t.$implicit;D(e.errors!=null&&e.errors.required?0:-1),o(),D(e.errors!=null&&e.errors.matchControl?1:-1)}}function pi(a,t){a&1&&(r(0,"nz-select",29),f(1,"nz-option",30)(2,"nz-option",30),n()),a&2&&(o(),p("nzLabel","+86")("nzValue","+86"),o(),p("nzLabel","+87")("nzValue","+87"))}function mi(a,t){a&1&&(c(0),m(1,"i18n")),a&2&&h(" ",u(1,1,"validation.phone-number.required")," ")}function ci(a,t){a&1&&(c(0),m(1,"i18n")),a&2&&h(" ",u(1,1,"validation.phone-number.wrong-format")," ")}function ui(a,t){if(a&1&&(E(0,mi,2,3),E(1,ci,2,3)),a&2){let e=t.$implicit;D(e.errors!=null&&e.errors.required?0:-1),o(),D(e.errors!=null&&e.errors.pattern?1:-1)}}var ce=class ce{constructor(){this.router=s(N);this.http=s(Ue);this.cdr=s(Le);this.form=s(ie).nonNullable.group({mail:["",[d.required,d.email]],password:["",[d.required,d.minLength(6),ce.checkPassword.bind(this)]],confirm:["",[d.required,d.minLength(6)]],mobilePrefix:["+86"],mobile:["",[d.required,d.pattern(/^1\d{10}$/)]],captcha:["",[d.required]]},{validators:Gt("password","confirm")});this.error="";this.type=0;this.loading=!1;this.visible=!1;this.status="pool";this.progress=0;this.passwordProgressMap={ok:"success",pass:"normal",pool:"exception"};this.count=0}static checkPassword(t){if(!t)return null;let e=this;e.visible=!!t.value,t.value&&t.value.length>9?e.status="ok":t.value&&t.value.length>5?e.status="pass":e.status="pool",e.visible&&(e.progress=t.value.length*10>100?100:t.value.length*10)}getCaptcha(){let{mobile:t}=this.form.controls;if(t.invalid){t.markAsDirty({onlySelf:!0}),t.updateValueAndValidity({onlySelf:!0});return}this.count=59,this.cdr.detectChanges(),this.interval$=setInterval(()=>{this.count-=1,this.cdr.detectChanges(),this.count<=0&&clearInterval(this.interval$)},1e3)}submit(){if(this.error="",Object.keys(this.form.controls).forEach(e=>{let i=this.form.controls[e];i.markAsDirty(),i.updateValueAndValidity()}),this.form.invalid)return;let t=this.form.value;this.loading=!0,this.cdr.detectChanges(),this.http.post("/register",t,null,{context:new Oe().set(Ge,!0)}).pipe(Ae(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(()=>{this.router.navigate(["passport","register-result"],{queryParams:{email:t.mail}})})}ngOnDestroy(){this.interval$&&clearInterval(this.interval$)}};ce.\u0275fac=function(e){return new(e||ce)},ce.\u0275cmp=v({type:ce,selectors:[["passport-register"]],decls:50,vars:34,consts:[["mailErrorTip",""],["pwdCdkTpl",""],["confirmErrorTip",""],["addOnBeforeTemplate",""],["mobileErrorTip",""],["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],[3,"nzErrorTip"],["nzSize","large","nzAddonBeforeIcon","user"],["nz-input","","formControlName","mail","placeholder","Email"],["nzSize","large","nzAddonBeforeIcon","lock","nz-popover","","nzPopoverPlacement","right","nzPopoverTrigger","focus","nzPopoverOverlayClassName","register-password-cdk",3,"nzPopoverVisibleChange","nzPopoverVisible","nzPopoverOverlayStyle","nzPopoverContent"],["nz-input","","type","password","formControlName","password","placeholder","Password"],["nzSize","large","nzAddonBeforeIcon","lock"],["nz-input","","type","password","formControlName","confirm","placeholder","Confirm Password"],["nzSize","large",3,"nzAddOnBefore"],["formControlName","mobile","nz-input","","placeholder","Phone number"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nzSize","large","nzAddonBeforeIcon","mail"],["nz-input","","formControlName","captcha","placeholder","Captcha"],["type","button","nz-button","","nzSize","large","nzBlock","",3,"click","disabled","nzLoading"],["nz-button","","nzType","primary","nzSize","large","type","submit",1,"submit",3,"nzLoading"],["routerLink","/passport/login",1,"login"],[2,"padding","4px 0"],[1,"success"],[1,"warning"],[1,"error"],[3,"nzPercent","nzStatus","nzStrokeWidth","nzShowInfo"],[1,"mt-sm"],["formControlName","mobilePrefix",2,"width","100px"],[3,"nzLabel","nzValue"]],template:function(e,i){if(e&1){let l=de();r(0,"h3"),c(1),m(2,"i18n"),n(),r(3,"form",5),g("ngSubmit",function(){return T(l),k(i.submit())}),E(4,Qt,1,3,"nz-alert",6),r(5,"nz-form-item")(6,"nz-form-control",7)(7,"nz-input-group",8),f(8,"input",9),n(),J(9,ti,2,2,"ng-template",null,0,Z),n()(),r(11,"nz-form-item")(12,"nz-form-control",7),m(13,"i18n"),r(14,"nz-input-group",10),st("nzPopoverVisibleChange",function(_){return T(l),at(i.visible,_)||(i.visible=_),k(_)}),f(15,"input",11),n(),J(16,ni,9,11,"ng-template",null,1,Z),n()(),r(18,"nz-form-item")(19,"nz-form-control",7)(20,"nz-input-group",12),f(21,"input",13),n(),J(22,li,2,2,"ng-template",null,2,Z),n()(),r(24,"nz-form-item")(25,"nz-form-control",7)(26,"nz-input-group",14),J(27,pi,3,4,"ng-template",null,3,Z),f(29,"input",15),n(),J(30,ui,2,2,"ng-template",null,4,Z),n()(),r(32,"nz-form-item")(33,"nz-form-control",7),m(34,"i18n"),r(35,"div",16)(36,"div",17)(37,"nz-input-group",18),f(38,"input",19),n()(),r(39,"div",17)(40,"button",20),g("click",function(){return T(l),k(i.getCaptcha())}),c(41),m(42,"i18n"),n()()()()(),r(43,"nz-form-item")(44,"button",21),c(45),m(46,"i18n"),n(),r(47,"a",22),c(48),m(49,"i18n"),n()()()}if(e&2){let l=Q(10),z=Q(17),_=Q(23),qt=Q(28),Wt=Q(31);o(),x(u(2,21,"app.register.register")),o(2),p("formGroup",i.form),o(),D(i.error?4:-1),o(2),p("nzErrorTip",l),o(6),p("nzErrorTip",u(13,23,"validation.password.required")),o(2),nt("nzPopoverVisible",i.visible),p("nzPopoverOverlayStyle",pt(33,Jt))("nzPopoverContent",z),o(5),p("nzErrorTip",_),o(6),p("nzErrorTip",Wt),o(),p("nzAddOnBefore",qt),o(7),p("nzErrorTip",u(34,25,"validation.verification-code.required")),o(2),p("nzGutter",8),o(),p("nzSpan",16),o(3),p("nzSpan",8),o(),p("disabled",i.count>0)("nzLoading",i.loading),o(),h(" ",i.count?i.count+"s":u(42,27,"app.register.get-verification-code")," "),o(3),p("nzLoading",i.loading),o(),h(" ",u(46,29,"app.register.register")," "),o(3),x(u(49,31,"app.register.sign-in"))}},dependencies:[L,R,F,B,P,A,V,fe,He,Ke,H,W,q,j,$,K,G,O,U,Pt,Bt,At,Rt,Mt,Dt,xt,qe,b,S,C,y,ae],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     h3{margin-bottom:20px;font-size:16px}[_nghost-%COMP%]     .submit{width:50%}[_nghost-%COMP%]     .login{float:right;line-height:40px}  .register-password-cdk .success,   .register-password-cdk .warning,   .register-password-cdk .error{transition:color .3s}  .register-password-cdk .success{color:#52c41a}  .register-password-cdk .warning{color:#faad14}  .register-password-cdk .error{color:#ff4d4f}  .register-password-cdk .progress-pass>.progress .ant-progress-bg{background-color:#faad14}"],changeDetection:0});var et=ce;var di=a=>({email:a});function fi(a,t){if(a&1&&(r(0,"div",5),c(1),m(2,"i18n"),n()),a&2){let e=se();o(),h(" ",ct(2,1,"app.register-result.msg",mt(4,di,e.email))," ")}}var ke=class ke{constructor(){this.msg=s(w);this.email=""}};ke.\u0275fac=function(e){return new(e||ke)},ke.\u0275cmp=v({type:ke,selectors:[["passport-register-result"]],inputs:{email:"email"},decls:11,vars:11,consts:[["title",""],["nzStatus","success",3,"nzTitle","nzSubTitle"],["nz-result-extra",""],["nz-button","","nzSize","large",3,"click","nzType"],["routerLink","/","nz-button","","nzSize","large"],[1,"title",2,"font-size","20px"]],template:function(e,i){if(e&1){let l=de();r(0,"nz-result",1),m(1,"i18n"),J(2,fi,3,6,"ng-template",null,0,Z),r(4,"div",2)(5,"button",3),g("click",function(){return T(l),k(i.msg.success("email"))}),c(6),m(7,"i18n"),n(),r(8,"button",4),c(9),m(10,"i18n"),n()()()}if(e&2){let l=Q(3);p("nzTitle",l)("nzSubTitle",u(1,5,"app.register-result.activation-email")),o(5),p("nzType","primary"),o(),h(" ",u(7,7,"app.register-result.view-mailbox")," "),o(3),h(" ",u(10,9,"app.register-result.back-home")," ")}},dependencies:[fe,b,S,C,y,Ut,Ot,Lt,ae],encapsulation:2});var tt=ke;var Ln=[{path:"passport",component:Vt,children:[{path:"login",component:Ze,data:{title:"\u767B\u5F55",titleI18n:"app.login.login"}},{path:"register",component:et,data:{title:"\u6CE8\u518C",titleI18n:"app.register.register"}},{path:"register-result",component:tt,data:{title:"\u6CE8\u518C\u7ED3\u679C",titleI18n:"app.register.register"}},{path:"lock",component:Xe,data:{title:"\u9501\u5C4F",titleI18n:"app.lock"}}]},{path:"passport/callback/:type",component:Ye}];export{Ln as routes};
