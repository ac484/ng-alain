import{g as $e,k as Vt}from"./chunk-KNAXZRSG.js";import{a as we,b as xe,c as je}from"./chunk-7QAPXVOG.js";import{a as k,o as xt,p as Et,u as Ft,x as I}from"./chunk-BKEQE6WY.js";import"./chunk-VAGS5EVQ.js";import"./chunk-HBT2OKRY.js";import{a as Ze,b as et,c as tt}from"./chunk-R4F6LWKF.js";import{d as se}from"./chunk-QQBJCJUO.js";import{B as $,Ba as Y,Ca as X,Da as He,Ea as J,Fa as Q,Ga as Z,Ha as de,Ia as ee,J as Mt,Ka as Bt,L as At,Ma as Ot,Na as kt,Oa as Lt,P as Dt,Pa as Ke,Qa as te,R as Nt,Ra as ne,Sa as Ut,Ua as It,X as Ee,Y as pe,cb as Ye,db as Xe,eb as Je,fb as Qe,i as V,j as _,k as R,l as G,m as Pt,o as St,pa as Tt,q,s as W,ta as H,v as j,va as ce,ya as K,z as oe}from"./chunk-X3NOSVDL.js";import{$b as zt,Ag as O,Ea as o,Hb as M,Jb as ye,Kh as me,La as F,Lb as Ve,Mb as u,N as Ie,Nb as P,Ob as S,Oh as U,Qb as ft,Ra as D,Rb as Ct,Rh as We,Sb as _t,Tc as qe,Xb as Re,_b as Ge,ab as d,ac as ht,cb as g,da as p,ec as v,fc as b,gc as vt,hb as l,hc as A,hg as le,ia as z,ib as r,ig as ue,ja as h,jb as s,kb as m,ki as ge,lc as ie,ld as bt,li as fe,pa as y,pd as L,pg as yt,qd as ae,qg as wt,rb as x,rg as N,ub as C,xb as c,xg as T,yc as re,zg as B}from"./chunk-FM676GLM.js";import{a as dt,i as E}from"./chunk-57BLH6QZ.js";var Fe=class Fe{constructor(){this.socialService=p(xe);this.settingsSrv=p(me);this.type=""}ngOnInit(){this.mockModel()}mockModel(){let t={token:"123456789",name:"cipchk",email:`${this.type}@${this.type}.com`,id:1e4,time:+new Date};this.settingsSrv.setUser(dt(dt({},this.settingsSrv.user),t)),this.socialService.callback(t)}};Fe.\u0275fac=function(e){return new(e||Fe)},Fe.\u0275cmp=F({type:Fe,selectors:[["app-callback"]],inputs:{type:"type"},features:[Ge([xe])],decls:0,vars:0,template:function(e,i){},encapsulation:2});var nt=Fe;var Pe=class Pe{constructor(){this.tokenService=p(we);this.settings=p(me);this.router=p(L);this.f=new Pt({password:new St("",{nonNullable:!0,validators:[_.required]})})}get user(){return this.settings.user}submit(){this.f.controls.password.markAsDirty(),this.f.controls.password.updateValueAndValidity(),this.f.valid&&(console.log("Valid!"),console.log(this.f.value),this.tokenService.set({token:"123"}),this.router.navigate(["dashboard"]))}};Pe.\u0275fac=function(e){return new(e||Pe)},Pe.\u0275cmp=F({type:Pe,selectors:[["passport-lock"]],decls:15,vars:11,consts:[[1,"ant-card","width-lg",2,"margin","0 auto"],[1,"ant-card-body"],[1,"avatar"],["nzIcon","user","nzSize","large",3,"nzSrc"],["nz-form","","role","form",1,"mt-md",3,"ngSubmit","formGroup"],[3,"nzErrorTip"],["nzSuffixIcon","lock"],["type","password","nz-input","","formControlName","password"],["nz-row","","nzType","flex","nzAlign","middle"],["nz-col","",2,"text-align","right",3,"nzOffset","nzSpan"],["nz-button","","nzType","primary",3,"disabled"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),m(3,"nz-avatar",3),s(),r(4,"form",4),C("ngSubmit",function(){return i.submit()}),r(5,"nz-form-item")(6,"nz-form-control",5),v(7,"i18n"),r(8,"nz-input-group",6),m(9,"input",7),s()()(),r(10,"div",8)(11,"div",9)(12,"button",10),u(13),v(14,"i18n"),s()()()()()()),e&2&&(o(3),l("nzSrc",i.user.avatar),o(),l("formGroup",i.f),o(2),l("nzErrorTip",b(7,7,"validation.password.required")),o(5),l("nzOffset",12)("nzSpan",12),o(),l("disabled",!i.f.valid),o(),P(b(14,9,"app.lock")))},dependencies:[$,q,V,R,G,W,j,It,Ut,ee,X,Y,Q,J,Z,He,O,B,N,T,K,H,ce,U],styles:["[_nghost-%COMP%]     .ant-card-body{position:relative;margin-top:80px}[_nghost-%COMP%]     .avatar{position:absolute;top:-20px;left:50%;margin-left:-20px}"]});var it=Pe;function Gt(n,t){if(n&1&&m(0,"nz-alert",3),n&2){let e=c();l("nzType","error")("nzMessage",e.error)("nzShowIcon",!0)}}function qt(n,t){if(n&1&&m(0,"nz-alert",3),n&2){let e=c(2);l("nzType","error")("nzMessage",e.firebaseError())("nzShowIcon",!0)}}function Wt(n,t){if(n&1){let e=x();r(0,"nz-tab",10)(1,"form",24),C("ngSubmit",function(){z(e);let a=c();return h(a.onFirebaseEmailLogin())}),d(2,qt,1,3,"nz-alert",3),r(3,"nz-form-item")(4,"nz-form-control",25)(5,"nz-input-group",26),m(6,"input",27),s()()(),r(7,"nz-form-item")(8,"nz-form-control",28)(9,"nz-input-group",8),m(10,"input",29),s()()(),r(11,"nz-form-item")(12,"nz-col",11)(13,"label",12),u(14,"\u8A18\u4F4F\u6211"),s()(),r(15,"nz-col",13)(16,"a",30),u(17,"\u5FD8\u8A18\u5BC6\u78BC\uFF1F"),s()()(),r(18,"nz-form-item")(19,"button",15),u(20," Firebase Email \u767B\u5165 "),s()()()()}if(n&2){let e=c();o(),l("formGroup",e.firebaseForm),o(),g(e.firebaseError()?2:-1),o(10),l("nzSpan",12),o(3),l("nzSpan",12),o(4),l("nzLoading",e.firebaseLoading())}}function jt(n,t){if(n&1){let e=x();r(0,"i",31),C("click",function(){z(e);let a=c();return h(a.onAnonymousLogin())}),s()}if(n&2){let e=c();ye("loading",e.firebaseLoading())}}function $t(n,t){if(n&1){let e=x();r(0,"div",23)(1,"button",32),C("click",function(){z(e);let a=c();return h(a.onAnonymousLogin())}),m(2,"i",33),u(3," \u533F\u540D\u767B\u5165 - \u5FEB\u901F\u9AD4\u9A57 "),s()()}if(n&2){let e=c();o(),l("nzLoading",e.firebaseLoading())}}var Ne=class Ne{constructor(){this.router=p(L);this.settingsService=p(me);this.socialService=p(xe);this.reuseTabService=p(Ke,{optional:!0});this.tokenService=p(we);this.startupSrv=p($e);this.http=p(We);this.cdr=p(re);this.auth=p(Et);this.firebaseAuth=p(I);this.form=p(oe).nonNullable.group({userName:["",[_.required,_.pattern(/^(admin|user)$/)]],password:["",[_.required,_.pattern(/^(ng-alain\.com)$/)]],remember:[!0]});this.firebaseForm=p(oe).nonNullable.group({email:["",[_.required,_.email]],password:["",[_.required,_.minLength(6)]],remember:[!0]});this.error="";this.type=0;this.loading=!1;this.useFirebaseAuth=y(k.firebase?.enableFirebaseAuth||!1);this.firebaseLoading=y(!1);this.firebaseError=y("");this.canUseAnonymousLogin=ie(()=>this.useFirebaseAuth()&&k.firebase?.enableAnonymousLogin);this.canUseGoogleAuth=ie(()=>this.useFirebaseAuth()&&k.firebase?.enableGoogleAuth)}switch({index:t}){this.type=t}submit(){this.error="";let{userName:t,password:e}=this.form.controls;t.markAsDirty(),t.updateValueAndValidity(),e.markAsDirty(),e.updateValueAndValidity(),!(t.invalid||e.invalid)&&(this.loading=!0,this.cdr.detectChanges(),this.http.post("/login/account",{type:this.type,userName:this.form.value.userName,password:this.form.value.password},null,{context:new qe().set(je,!0)}).pipe(Ie(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(i=>{if(i.msg!=="ok"){this.error=i.msg,this.cdr.detectChanges();return}this.reuseTabService?.clear(),i.user.expired=+new Date+1e3*60*5,this.tokenService.set(i.user),this.startupSrv.load().subscribe(()=>{let a=this.tokenService.referrer.url||"/";a.includes("/passport")&&(a="/"),this.router.navigateByUrl(a)})}))}open(t,e="href"){if(t==="google"){this.signInWithGoogle();return}let i="",a="";switch(k.production?a=`https://ng-alain.github.io/ng-alain/#/passport/callback/${t}`:a=`http://localhost:4200/#/passport/callback/${t}`,t){case"auth0":i=`//cipchk.auth0.com/login?client=8gcNydIDzGBYxzqV0Vm1CX_RXH-wsWo5&redirect_uri=${decodeURIComponent(a)}`;break;case"github":i=`//github.com/login/oauth/authorize?client_id=9d6baae4b04a23fcafa2&response_type=code&redirect_uri=${decodeURIComponent(a)}`;break;case"weibo":i=`https://api.weibo.com/oauth2/authorize?client_id=1239507802&response_type=code&redirect_uri=${decodeURIComponent(a)}`;break}e==="window"?this.socialService.login(i,"/",{type:"window"}).subscribe(f=>{f&&(this.settingsService.setUser(f),this.router.navigateByUrl("/"))}):this.socialService.login(i,"/",{type:"href"})}onFirebaseEmailLogin(){return E(this,null,function*(){if(!this.useFirebaseAuth())return;this.firebaseError.set("");let{email:t,password:e,remember:i}=this.firebaseForm.controls;if(t.markAsDirty(),t.updateValueAndValidity(),e.markAsDirty(),e.updateValueAndValidity(),!(t.invalid||e.invalid)){this.firebaseLoading.set(!0),this.cdr.detectChanges();try{let a={email:t.value,password:e.value,rememberMe:i.value,redirectUrl:this.tokenService.referrer?.url||"/"},f=yield this.firebaseAuth.signInWithEmailAndPassword(a);f&&(yield this.handleFirebaseLoginSuccess(f))}catch(a){console.error("Firebase Email login error:",a),this.firebaseError.set("Email \u767B\u5165\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u5E33\u865F\u5BC6\u78BC"),this.cdr.detectChanges()}finally{this.firebaseLoading.set(!1),this.cdr.detectChanges()}}})}onAnonymousLogin(){return E(this,null,function*(){if(this.canUseAnonymousLogin()){this.firebaseLoading.set(!0),this.firebaseError.set(""),this.cdr.detectChanges();try{let t=yield this.firebaseAuth.signInAnonymously();t&&(yield this.handleFirebaseLoginSuccess(t))}catch(t){console.error("Anonymous login error:",t),this.firebaseError.set("\u533F\u540D\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),this.cdr.detectChanges()}finally{this.firebaseLoading.set(!1),this.cdr.detectChanges()}}})}signInWithGoogle(){return E(this,null,function*(){if(!this.canUseGoogleAuth()){yield this.legacyGoogleSignIn();return}this.firebaseLoading.set(!0),this.firebaseError.set(""),this.cdr.detectChanges();try{let t=yield this.firebaseAuth.signInWithGooglePopup();t&&(yield this.handleFirebaseLoginSuccess(t))}catch(t){console.error("Firebase Google login error:",t),this.firebaseError.set("Google \u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),this.cdr.detectChanges()}finally{this.firebaseLoading.set(!1),this.cdr.detectChanges()}})}handleFirebaseLoginSuccess(t){return E(this,null,function*(){this.reuseTabService?.clear();let e={token:yield this.firebaseAuth.getIdToken(),name:t.displayName||t.email||"Firebase User",email:t.email,avatar:t.photoURL||"./assets/tmp/img/avatar.jpg",id:t.uid,expired:+new Date+1e3*60*60,isFirebaseUser:!0,authProvider:t.authProvider,isAnonymous:t.isAnonymous};this.tokenService.set(e),this.settingsService.setUser({name:e.name,avatar:e.avatar,email:e.email,uid:e.id,isFirebaseUser:!0,authProvider:e.authProvider,isAnonymous:e.isAnonymous}),this.startupSrv.load().subscribe(()=>{let i=this.tokenService.referrer?.url||"/";i.includes("/passport")&&(i="/"),this.router.navigateByUrl(i)})})}legacyGoogleSignIn(){return E(this,null,function*(){try{this.loading=!0,this.cdr.detectChanges();let t=new xt,i=(yield Ft(this.auth,t)).user,a={token:yield i.getIdToken(),name:i.displayName||i.email,email:i.email,avatar:i.photoURL,id:i.uid,expired:+new Date+1e3*60*60};this.reuseTabService?.clear(),this.tokenService.set(a),this.settingsService.setUser({name:a.name,avatar:a.avatar,email:a.email}),this.startupSrv.load().subscribe(()=>{let f=this.tokenService.referrer.url||"/";f.includes("/passport")&&(f="/"),this.router.navigateByUrl(f)})}catch(t){console.error("Google sign-in error:",t),this.error="Google \u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66",this.cdr.detectChanges()}finally{this.loading=!1,this.cdr.detectChanges()}})}ngOnDestroy(){}};Ne.\u0275fac=function(e){return new(e||Ne)},Ne.\u0275cmp=F({type:Ne,selectors:[["passport-login"]],features:[Ge([xe])],decls:39,vars:27,consts:[["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"tabs",3,"nzSelectChange","nzAnimated"],[3,"nzTitle"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],["nzErrorTip","Please enter mobile number, muse be: admin or user"],["nzSize","large","nzPrefixIcon","user"],["nz-input","","formControlName","userName","placeholder","username: admin or user"],["nzErrorTip","Please enter password, muse be: ng-alain.com"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","password: ng-alain.com"],["nzTitle","Firebase \u767B\u5165"],[3,"nzSpan"],["nz-checkbox","","formControlName","remember"],[1,"text-right",3,"nzSpan"],["routerLink","/passport/register",1,"forgot"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"],[1,"other"],["nz-tooltip","","nzTooltipTitle","in fact Auth0 via window","nz-icon","","nzType","alipay-circle",1,"icon",3,"click"],["nz-tooltip","","nzTooltipTitle","in fact Github via redirect","nz-icon","","nzType","taobao-circle",1,"icon",3,"click"],["nz-tooltip","","nzTooltipTitle","Sign in with Google","nz-icon","","nzType","google",1,"icon",3,"click"],["nz-icon","","nzType","weibo-circle",1,"icon",3,"click"],["nz-tooltip","","nzTooltipTitle","\u533F\u540D\u767B\u5165 - \u5FEB\u901F\u9AD4\u9A57","nz-icon","","nzType","user",1,"icon",3,"loading"],["routerLink","/passport/register",1,"register"],[1,"firebase-options",2,"margin-top","16px","text-align","center"],[3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684 Email \u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","type","email","formControlName","email","placeholder","\u8ACB\u8F38\u5165 Email"],["nzErrorTip","\u5BC6\u78BC\u81F3\u5C11\u9700\u8981 6 \u500B\u5B57\u5143"],["nz-input","","type","password","formControlName","password","placeholder","\u8ACB\u8F38\u5165\u5BC6\u78BC"],["routerLink","/passport/reset-password",1,"forgot"],["nz-tooltip","","nzTooltipTitle","\u533F\u540D\u767B\u5165 - \u5FEB\u901F\u9AD4\u9A57","nz-icon","","nzType","user",1,"icon",3,"click"],["nz-button","","nzType","dashed","nzSize","large","nzBlock","",3,"click","nzLoading"],["nz-icon","","nzType","user"]],template:function(e,i){e&1&&(r(0,"form",0),C("ngSubmit",function(){return i.submit()}),r(1,"nz-tabs",1),C("nzSelectChange",function(f){return i.switch(f)}),r(2,"nz-tab",2),v(3,"i18n"),d(4,Gt,1,3,"nz-alert",3),r(5,"nz-form-item")(6,"nz-form-control",4)(7,"nz-input-group",5),m(8,"input",6),s()()(),r(9,"nz-form-item")(10,"nz-form-control",7)(11,"nz-input-group",8),m(12,"input",9),s()()()(),d(13,Wt,21,5,"nz-tab",10),s(),r(14,"nz-form-item")(15,"nz-col",11)(16,"label",12),u(17),v(18,"i18n"),s()(),r(19,"nz-col",13)(20,"a",14),u(21),v(22,"i18n"),s()()(),r(23,"nz-form-item")(24,"button",15),u(25),v(26,"i18n"),s()()(),r(27,"div",16),u(28),v(29,"i18n"),r(30,"i",17),C("click",function(){return i.open("auth0","window")}),s(),r(31,"i",18),C("click",function(){return i.open("github")}),s(),r(32,"i",19),C("click",function(){return i.open("google","window")}),s(),r(33,"i",20),C("click",function(){return i.open("weibo","window")}),s(),d(34,jt,1,2,"i",21),r(35,"a",22),u(36),v(37,"i18n"),s()(),d(38,$t,4,1,"div",23)),e&2&&(l("formGroup",i.form),o(),l("nzAnimated",!1),o(),l("nzTitle",b(3,15,"app.login.tab-login-credentials")),o(2),g(i.error?4:-1),o(9),g(i.useFirebaseAuth()?13:-1),o(2),l("nzSpan",12),o(2),P(b(18,17,"app.login.remember-me")),o(2),l("nzSpan",12),o(2),P(b(22,19,"app.login.forgot-password")),o(3),l("nzLoading",i.loading),o(),S(" ",b(26,21,"app.login.login")," "),o(3),S(" ",b(29,23,"app.login.sign-in-with")," "),o(6),g(i.canUseAnonymousLogin()?34:-1),o(2),P(b(37,25,"app.login.signup")),o(2),g(i.useFirebaseAuth()&&i.canUseAnonymousLogin()?38:-1))},dependencies:[ae,$,q,V,R,G,W,j,At,Mt,Lt,kt,Ot,ne,te,ee,X,Y,Q,J,Z,K,H,ce,O,B,N,T,Nt,Dt,ue,le,U],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     .ant-tabs .ant-tabs-bar{margin-bottom:24px;text-align:center;border-bottom:0}[_nghost-%COMP%]     .ant-tabs-tab{font-size:16px;line-height:24px}[_nghost-%COMP%]     .ant-input-affix-wrapper .ant-input:not(:first-child){padding-left:4px}[_nghost-%COMP%]     .icon{cursor:pointer;margin-left:16px;font-size:24px;color:#0003;vertical-align:middle;transition:color .3s}[_nghost-%COMP%]     .icon:hover{color:#1890ff}[_nghost-%COMP%]     .other{margin-top:24px;line-height:22px;text-align:left}[_nghost-%COMP%]     .other nz-tooltip{vertical-align:middle}[_nghost-%COMP%]     .other .register{float:right}[data-theme=dark]   [_nghost-%COMP%]     .icon{color:#fff3}[data-theme=dark]   [_nghost-%COMP%]     .icon:hover{color:#fff}"],changeDetection:0});var ot=Ne;function at(n,t){return e=>{let i=e.get(n),a=e.get(t);return a.errors&&!a.errors.matchControl||(i.value!==a.value?a.setErrors({matchControl:!0}):a.setErrors(null)),null}}var Yt=()=>({"width.px":240});function Xt(n,t){if(n&1&&m(0,"nz-alert",4),n&2){let e=c();l("nzType","error")("nzMessage",e.error)("nzShowIcon",!0)}}function Jt(n,t){if(n&1&&m(0,"nz-alert",4),n&2){let e=c();l("nzType","error")("nzMessage",e.firebaseError())("nzShowIcon",!0)}}function Qt(n,t){n&1&&m(0,"nz-alert",4),n&2&&l("nzType","info")("nzMessage","\u4F7F\u7528 Firebase \u8A3B\u518A\uFF0C\u8A3B\u518A\u5F8C\u5C07\u81EA\u52D5\u767C\u9001\u9A57\u8B49\u4FE1\u5230\u60A8\u7684\u4FE1\u7BB1")("nzShowIcon",!0)}function Zt(n,t){n&1&&(u(0),v(1,"i18n")),n&2&&S(" ",b(1,1,"validation.email.required")," ")}function en(n,t){n&1&&(u(0),v(1,"i18n")),n&2&&S(" ",b(1,1,"validation.email.wrong-format")," ")}function tn(n,t){if(n&1&&(d(0,Zt,2,3),d(1,en,2,3)),n&2){let e=t.$implicit;g(e.errors!=null&&e.errors.required?0:-1),o(),g(e.errors!=null&&e.errors.email?1:-1)}}function nn(n,t){n&1&&(r(0,"div",16),u(1),v(2,"i18n"),s()),n&2&&(o(),P(b(2,1,"validation.password.strength.strong")))}function on(n,t){n&1&&(r(0,"div",17),u(1),v(2,"i18n"),s()),n&2&&(o(),P(b(2,1,"validation.password.strength.medium")))}function rn(n,t){n&1&&(r(0,"div",18),u(1),v(2,"i18n"),s()),n&2&&(o(),P(b(2,1,"validation.password.strength.short")))}function an(n,t){if(n&1&&(r(0,"div",15),d(1,nn,3,3,"div",16)(2,on,3,3,"div",17)(3,rn,3,3,"div",18),r(4,"div"),m(5,"nz-progress",19),s(),r(6,"p",14),u(7),v(8,"i18n"),s()()),n&2){let e,i=c();o(),g((e=i.status)==="ok"?1:e==="pass"?2:3),o(3),Ve(Re("progress-",i.status)),o(),l("nzPercent",i.progress)("nzStatus",i.passwordProgressMap[i.status])("nzStrokeWidth",6)("nzShowInfo",!1),o(2),P(b(8,9,"validation.password.strength.msg"))}}function sn(n,t){n&1&&(u(0),v(1,"i18n")),n&2&&S(" ",b(1,1,"validation.confirm-password.required")," ")}function ln(n,t){n&1&&(u(0),v(1,"i18n")),n&2&&S(" ",b(1,1,"validation.password.twice")," ")}function un(n,t){if(n&1&&(d(0,sn,2,3),d(1,ln,2,3)),n&2){let e=t.$implicit;g(e.errors!=null&&e.errors.required?0:-1),o(),g(e.errors!=null&&e.errors.matchControl?1:-1)}}function mn(n,t){if(n&1){let e=x();r(0,"div",14)(1,"button",20),C("click",function(){z(e);let a=c();return h(a.resendVerificationEmail())}),u(2," \u91CD\u65B0\u767C\u9001\u9A57\u8B49\u4FE1 "),s()()}if(n&2){let e=c();o(),l("disabled",e.firebaseLoading())}}var be=class be{constructor(){this.router=p(L);this.http=p(We);this.cdr=p(re);this.firebaseAuth=p(I);this.message=p(se);this.form=p(oe).nonNullable.group({mail:["",[_.required,_.email]],password:["",[_.required,_.minLength(6),be.checkPassword.bind(this)]],confirm:["",[_.required,_.minLength(6)]]},{validators:at("password","confirm")});this.error="";this.type=0;this.loading=!1;this.visible=!1;this.status="pool";this.progress=0;this.passwordProgressMap={ok:"success",pass:"normal",pool:"exception"};this.useFirebaseAuth=y(k.firebase?.enableFirebaseAuth||!1);this.firebaseLoading=y(!1);this.firebaseError=y("")}static checkPassword(t){if(!t)return null;let e=this;e.visible=!!t.value,t.value&&t.value.length>9?e.status="ok":t.value&&t.value.length>5?e.status="pass":e.status="pool",e.visible&&(e.progress=t.value.length*10>100?100:t.value.length*10)}submit(){if(this.error="",this.firebaseError.set(""),Object.keys(this.form.controls).forEach(e=>{let i=this.form.controls[e];i.markAsDirty(),i.updateValueAndValidity()}),this.form.invalid)return;let t=this.form.value;this.useFirebaseAuth()?this.submitWithFirebase(t):this.submitWithTraditional(t)}submitWithFirebase(t){return E(this,null,function*(){this.firebaseLoading.set(!0),this.cdr.detectChanges();try{(yield this.firebaseAuth.createUserWithEmailAndPassword({email:t.mail,password:t.password,acceptTerms:!0}))?(this.message.success("\u8A3B\u518A\u6210\u529F\uFF01\u9A57\u8B49\u4FE1\u5DF2\u767C\u9001\u5230\u60A8\u7684\u4FE1\u7BB1\uFF0C\u8ACB\u6AA2\u67E5\u4E26\u9EDE\u64CA\u9A57\u8B49\u9023\u7D50"),this.router.navigate(["passport","register-result"],{queryParams:{email:t.mail,isFirebase:!0,needVerification:!0}})):this.firebaseError.set("\u8A3B\u518A\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}catch(e){console.error("Firebase registration error:",e),this.firebaseError.set("\u8A3B\u518A\u5931\u6557\uFF0C\u8A72\u4FE1\u7BB1\u53EF\u80FD\u5DF2\u88AB\u4F7F\u7528")}finally{this.firebaseLoading.set(!1),this.cdr.detectChanges()}})}submitWithTraditional(t){this.loading=!0,this.cdr.detectChanges(),this.http.post("/register",t,null,{context:new qe().set(je,!0)}).pipe(Ie(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(()=>{this.router.navigate(["passport","register-result"],{queryParams:{email:t.mail}})})}resendVerificationEmail(){return E(this,null,function*(){if(!this.useFirebaseAuth())return;(yield this.firebaseAuth.sendEmailVerification())&&this.message.success("\u9A57\u8B49\u4FE1\u5DF2\u91CD\u65B0\u767C\u9001")})}ngOnDestroy(){}};be.\u0275fac=function(e){return new(e||be)},be.\u0275cmp=F({type:be,selectors:[["passport-register"]],decls:34,vars:24,consts:[["mailErrorTip",""],["pwdCdkTpl",""],["confirmErrorTip",""],["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],[3,"nzErrorTip"],["nzSize","large","nzAddonBeforeIcon","user"],["nz-input","","formControlName","mail","placeholder","Email"],["nzSize","large","nzAddonBeforeIcon","lock","nz-popover","","nzPopoverPlacement","right","nzPopoverTrigger","focus","nzPopoverOverlayClassName","register-password-cdk",3,"nzPopoverVisibleChange","nzPopoverVisible","nzPopoverOverlayStyle","nzPopoverContent"],["nz-input","","type","password","formControlName","password","placeholder","Password"],["nzSize","large","nzAddonBeforeIcon","lock"],["nz-input","","type","password","formControlName","confirm","placeholder","Confirm Password"],["nz-button","","nzType","primary","nzSize","large","type","submit",1,"submit",3,"nzLoading"],["routerLink","/passport/login",1,"login"],[1,"mt-sm"],[2,"padding","4px 0"],[1,"success"],[1,"warning"],[1,"error"],[3,"nzPercent","nzStatus","nzStrokeWidth","nzShowInfo"],["nz-button","","nzType","link","nzSize","small",3,"click","disabled"]],template:function(e,i){if(e&1){let a=x();r(0,"h3"),u(1),v(2,"i18n"),s(),r(3,"form",3),C("ngSubmit",function(){return z(a),h(i.submit())}),d(4,Xt,1,3,"nz-alert",4),d(5,Jt,1,3,"nz-alert",4),d(6,Qt,1,3,"nz-alert",4),r(7,"nz-form-item")(8,"nz-form-control",5)(9,"nz-input-group",6),m(10,"input",7),s(),D(11,tn,2,2,"ng-template",null,0,A),s()(),r(13,"nz-form-item")(14,"nz-form-control",5),v(15,"i18n"),r(16,"nz-input-group",8),_t("nzPopoverVisibleChange",function(w){return z(a),Ct(i.visible,w)||(i.visible=w),h(w)}),m(17,"input",9),s(),D(18,an,9,11,"ng-template",null,1,A),s()(),r(20,"nz-form-item")(21,"nz-form-control",5)(22,"nz-input-group",10),m(23,"input",11),s(),D(24,un,2,2,"ng-template",null,2,A),s()(),r(26,"nz-form-item")(27,"button",12),u(28),v(29,"i18n"),s(),r(30,"a",13),u(31),v(32,"i18n"),s(),d(33,mn,3,1,"div",14),s()()}if(e&2){let a=M(12),f=M(19),w=M(25);o(),P(b(2,15,"app.register.register")),o(2),l("formGroup",i.form),o(),g(i.error?4:-1),o(),g(i.firebaseError()?5:-1),o(),g(i.useFirebaseAuth()?6:-1),o(2),l("nzErrorTip",a),o(6),l("nzErrorTip",b(15,17,"validation.password.required")),o(2),ft("nzPopoverVisible",i.visible),l("nzPopoverOverlayStyle",zt(23,Yt))("nzPopoverContent",f),o(5),l("nzErrorTip",w),o(6),l("nzLoading",i.loading||i.firebaseLoading()),o(),S(" ",b(29,19,"app.register.register")," "),o(3),P(b(32,21,"app.register.sign-in")),o(2),g(i.useFirebaseAuth()?33:-1)}},dependencies:[$,q,V,R,G,W,j,ae,ne,te,ee,X,Y,Q,J,Z,K,H,ce,Xe,Ye,Qe,Je,Tt,He,O,B,N,T,Bt,U],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     h3{margin-bottom:20px;font-size:16px}[_nghost-%COMP%]     .submit{width:50%}[_nghost-%COMP%]     .login{float:right;line-height:40px}  .register-password-cdk .success,   .register-password-cdk .warning,   .register-password-cdk .error{transition:color .3s}  .register-password-cdk .success{color:#52c41a}  .register-password-cdk .warning{color:#faad14}  .register-password-cdk .error{color:#ff4d4f}  .register-password-cdk .progress-pass>.progress .ant-progress-bg{background-color:#faad14}"],changeDetection:0});var st=be;var cn=n=>({email:n});function dn(n,t){if(n&1&&(r(0,"div",6),u(1),v(2,"i18n"),s()),n&2){let e=c();o(),S(" ",vt(2,1,"app.register-result.msg",ht(4,cn,e.email))," ")}}function gn(n,t){n&1&&(r(0,"div")(1,"p"),u(2),v(3,"i18n"),s(),m(4,"nz-alert",7),s()),n&2&&(o(2),P(b(3,1,"app.register-result.activation-email")))}function fn(n,t){n&1&&(r(0,"p"),u(1),v(2,"i18n"),s()),n&2&&(o(),P(b(2,1,"app.register-result.activation-email")))}function Cn(n,t){if(n&1&&d(0,gn,5,3,"div")(1,fn,3,3,"p"),n&2){let e=c();g(e.isFirebase()&&e.needVerification()?0:1)}}function _n(n,t){if(n&1){let e=x();r(0,"button",8),C("click",function(){z(e);let a=c();return h(a.resendVerificationEmail())}),u(1," \u91CD\u65B0\u767C\u9001\u9A57\u8B49\u4FE1 "),s(),r(2,"button",9),C("click",function(){z(e);let a=c();return h(a.checkVerificationStatus())}),u(3," \u6AA2\u67E5\u9A57\u8B49\u72C0\u614B "),s()}if(n&2){let e=c();l("nzLoading",e.isResending())("disabled",e.isResending())}}var Be=class Be{constructor(){this.route=p(bt);this.firebaseAuth=p(I);this.msg=p(se);this.email="";this.isFirebase=y(!1);this.needVerification=y(!1);this.isResending=y(!1)}ngOnInit(){this.route.queryParams.subscribe(t=>{this.email=t.email||"",this.isFirebase.set(t.isFirebase==="true"),this.needVerification.set(t.needVerification==="true")})}resendVerificationEmail(){return E(this,null,function*(){if(this.isFirebase()){this.isResending.set(!0);try{(yield this.firebaseAuth.sendEmailVerification())&&this.msg.success("\u9A57\u8B49\u4FE1\u5DF2\u91CD\u65B0\u767C\u9001\u5230\u60A8\u7684\u4FE1\u7BB1")}catch{this.msg.error("\u767C\u9001\u9A57\u8B49\u4FE1\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.isResending.set(!1)}}})}checkVerificationStatus(){return E(this,null,function*(){if(!this.isFirebase())return;if(yield this.firebaseAuth.reloadUser()){let e=this.firebaseAuth.currentUser();e&&!e.isAnonymous&&e.email&&this.msg.success("\u9A57\u8B49\u72C0\u614B\u5DF2\u66F4\u65B0")}})}};Be.\u0275fac=function(e){return new(e||Be)},Be.\u0275cmp=F({type:Be,selectors:[["passport-register-result"]],inputs:{email:"email"},decls:13,vars:10,consts:[["title",""],["subtitle",""],["nzStatus","success",3,"nzTitle","nzSubTitle"],["nz-result-extra",""],["nz-button","","nzSize","large",3,"click","nzType"],["routerLink","/","nz-button","","nzSize","large"],[1,"title",2,"font-size","20px"],["nzType","info","nzMessage","\u60A8\u4F7F\u7528 Firebase \u8A3B\u518A\u6210\u529F\uFF01\u9A57\u8B49\u4FE1\u5DF2\u767C\u9001\u5230\u60A8\u7684\u4FE1\u7BB1\uFF0C\u8ACB\u6AA2\u67E5\u4E26\u9EDE\u64CA\u9A57\u8B49\u9023\u7D50\u4EE5\u5B8C\u6210\u5E33\u865F\u555F\u7528\u3002","nzShowIcon","true",1,"mt-md"],["nz-button","","nzSize","large",3,"click","nzLoading","disabled"],["nz-button","","nzSize","large","nzType","dashed",3,"click"]],template:function(e,i){if(e&1){let a=x();r(0,"nz-result",2),D(1,dn,3,6,"ng-template",null,0,A)(3,Cn,2,1,"ng-template",null,1,A),r(5,"div",3)(6,"button",4),C("click",function(){return z(a),h(i.msg.success("email"))}),u(7),v(8,"i18n"),s(),d(9,_n,4,2),r(10,"button",5),u(11),v(12,"i18n"),s()()()}if(e&2){let a=M(2),f=M(4);l("nzTitle",a)("nzSubTitle",f),o(6),l("nzType","primary"),o(),S(" ",b(8,6,"app.register-result.view-mailbox")," "),o(2),g(i.isFirebase()&&i.needVerification()?9:-1),o(2),S(" ",b(12,8,"app.register-result.back-home")," ")}},dependencies:[ae,O,B,N,T,tt,et,Ze,ne,te,U],encapsulation:2});var lt=Be;function zn(n,t){if(n&1){let e=x();r(0,"nz-alert",7),C("nzOnClose",function(){z(e);let a=c();return h(a.error.set(""))}),s()}if(n&2){let e=c();l("nzType","error")("nzMessage",e.error())("nzShowIcon",!0)}}function hn(n,t){if(n&1){let e=x();r(0,"div",3)(1,"div",8)(2,"nz-space",9)(3,"div",10),m(4,"i",11),r(5,"span"),u(6,"\u7121\u9700\u8A3B\u518A\uFF0C\u7ACB\u5373\u9AD4\u9A57\u61C9\u7528\u529F\u80FD"),s()(),r(7,"div",10),m(8,"i",12),r(9,"span"),u(10,"\u5B89\u5168\u53EF\u9760\uFF0C\u96A8\u6642\u53EF\u5347\u7D1A\u70BA\u6B63\u5F0F\u5E33\u865F"),s()(),r(11,"div",10),m(12,"i",13),r(13,"span"),u(14,"\u5FEB\u901F\u958B\u59CB\uFF0C\u63A2\u7D22\u6240\u6709\u529F\u80FD"),s()()()(),m(15,"nz-divider"),r(16,"div",14)(17,"nz-space",15)(18,"button",16),C("click",function(){z(e);let a=c();return h(a.onAnonymousLogin())}),m(19,"i",17),u(20," \u958B\u59CB\u533F\u540D\u9AD4\u9A57 "),s(),m(21,"nz-divider",18),r(22,"nz-space")(23,"button",19),C("click",function(){z(e);let a=c();return h(a.goToLogin())}),m(24,"i",20),u(25," \u8FD4\u56DE\u767B\u5165 "),s(),r(26,"button",19),C("click",function(){z(e);let a=c();return h(a.goToRegister())}),m(27,"i",21),u(28," \u8A3B\u518A\u5E33\u865F "),s()()()()()}if(n&2){let e=c();o(18),l("nzLoading",e.isLoading())}}function vn(n,t){if(n&1){let e=x();r(0,"div",4),m(1,"nz-alert",22),r(2,"nz-space",15)(3,"button",23),C("click",function(){z(e);let a=c();return h(a.showUpgradeAccountForm())}),m(4,"i",24),u(5," \u5347\u7D1A\u70BA\u6B63\u5F0F\u5E33\u865F "),s(),r(6,"button",19),C("click",function(){z(e);let a=c();return h(a.goToLogin())}),m(7,"i",25),u(8," \u7E7C\u7E8C\u4F7F\u7528\u533F\u540D\u5E33\u865F "),s()()()}}function bn(n,t){if(n&1){let e=x();r(0,"div",5)(1,"div",26)(2,"h3"),u(3,"\u5347\u7D1A\u70BA\u6B63\u5F0F\u5E33\u865F"),s(),r(4,"p"),u(5,"\u8ACB\u8A2D\u5B9A\u60A8\u7684 Email \u548C\u5BC6\u78BC\uFF0C\u5347\u7D1A\u5F8C\u5C07\u4FDD\u7559\u60A8\u76EE\u524D\u7684\u6240\u6709\u8CC7\u6599\u3002"),s()(),r(6,"form",27),C("ngSubmit",function(){z(e);let a=c();return h(a.onUpgradeAccount())}),r(7,"nz-form-item")(8,"nz-form-label",28),u(9,"Email"),s(),r(10,"nz-form-control",29)(11,"nz-input-group",30),m(12,"input",31),s()()(),r(13,"nz-form-item")(14,"nz-form-label",28),u(15,"\u5BC6\u78BC"),s(),r(16,"nz-form-control",32)(17,"nz-input-group",33),m(18,"input",34),s()()(),r(19,"nz-form-item")(20,"nz-form-label",28),u(21,"\u78BA\u8A8D\u5BC6\u78BC"),s(),r(22,"nz-form-control",35)(23,"nz-input-group",33),m(24,"input",36),s()()(),r(25,"nz-form-item")(26,"nz-space",37)(27,"button",38),m(28,"i",24),u(29," \u5347\u7D1A\u5E33\u865F "),s(),r(30,"button",39),C("click",function(){z(e);let a=c();return h(a.hideUpgradeAccountForm())}),m(31,"i",40),u(32," \u53D6\u6D88 "),s()()()()()}if(n&2){let e=c();o(6),l("formGroup",e.upgradeForm),o(21),l("nzLoading",e.isLoading()),o(3),l("disabled",e.isLoading())}}function yn(n,t){if(n&1){let e=x();r(0,"div",6),m(1,"nz-alert",41),r(2,"button",23),C("click",function(){z(e);let a=c();return h(a.goToLogin())}),m(3,"i",25),u(4," \u524D\u5F80\u4E3B\u9801 "),s()()}if(n&2){let e,i=c();o(),l("nzDescription","\u6B61\u8FCE\u56DE\u4F86\uFF0C"+(((e=i.currentUser())==null?null:e.displayName)||((e=i.currentUser())==null?null:e.email)||"\u7528\u6236"))}}var Oe=class Oe{constructor(){this.router=p(L);this.settingsService=p(me);this.reuseTabService=p(Ke,{optional:!0});this.tokenService=p(we);this.startupSrv=p($e);this.cdr=p(re);this.firebaseAuth=p(I);this.message=p(se);this.upgradeForm=p(oe).nonNullable.group({email:["",[_.required,_.email]],password:["",[_.required,_.minLength(6)]],confirmPassword:["",[_.required]]},{validators:[this.passwordMatchValidator]});this.isLoading=y(!1);this.error=y("");this.showUpgradeForm=y(!1);this.isAnonymousUser=this.firebaseAuth.isAnonymous;this.currentUser=this.firebaseAuth.currentUser;this.canUseAnonymousLogin=y(k.firebase?.enableAnonymousLogin&&k.firebase?.enableFirebaseAuth)}passwordMatchValidator(t){let e=t.get("password"),i=t.get("confirmPassword");return e&&i&&e.value!==i.value?{passwordMismatch:!0}:null}onAnonymousLogin(){return E(this,null,function*(){if(!this.canUseAnonymousLogin()){this.error.set("\u533F\u540D\u767B\u5165\u529F\u80FD\u672A\u555F\u7528");return}this.isLoading.set(!0),this.error.set(""),this.cdr.detectChanges();try{let t=yield this.firebaseAuth.signInAnonymously();t?(yield this.handleLoginSuccess(t),this.message.success("\u533F\u540D\u767B\u5165\u6210\u529F\uFF01\u60A8\u53EF\u4EE5\u958B\u59CB\u9AD4\u9A57\u61C9\u7528\u529F\u80FD")):this.error.set("\u533F\u540D\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}catch(t){console.error("Anonymous login error:",t),this.error.set("\u533F\u540D\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u7DB2\u8DEF\u9023\u7DDA")}finally{this.isLoading.set(!1),this.cdr.detectChanges()}})}showUpgradeAccountForm(){if(!this.isAnonymousUser()){this.message.warning("\u60A8\u5DF2\u7D93\u662F\u6B63\u5F0F\u7528\u6236\uFF0C\u7121\u9700\u5347\u7D1A\u5E33\u865F");return}this.showUpgradeForm.set(!0)}hideUpgradeAccountForm(){this.showUpgradeForm.set(!1),this.upgradeForm.reset(),this.error.set("")}onUpgradeAccount(){return E(this,null,function*(){if(!this.isAnonymousUser()){this.error.set("\u53EA\u6709\u533F\u540D\u7528\u6236\u53EF\u4EE5\u5347\u7D1A\u5E33\u865F");return}this.error.set("");let{email:t,password:e,confirmPassword:i}=this.upgradeForm.controls;if(Object.values(this.upgradeForm.controls).forEach(a=>{a.markAsDirty(),a.updateValueAndValidity()}),this.upgradeForm.invalid){this.upgradeForm.hasError("passwordMismatch")&&this.error.set("\u5BC6\u78BC\u78BA\u8A8D\u4E0D\u4E00\u81F4");return}this.isLoading.set(!0),this.cdr.detectChanges();try{let a={email:t.value,password:e.value},f=yield this.firebaseAuth.linkWithEmailPassword(a);f?(yield this.handleLoginSuccess(f),this.message.success("\u5E33\u865F\u5347\u7D1A\u6210\u529F\uFF01\u60A8\u73FE\u5728\u662F\u6B63\u5F0F\u7528\u6236"),this.showUpgradeForm.set(!1)):this.error.set("\u5E33\u865F\u5347\u7D1A\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}catch(a){console.error("Account upgrade error:",a),this.error.set("\u5E33\u865F\u5347\u7D1A\u5931\u6557\uFF0C\u8A72 Email \u53EF\u80FD\u5DF2\u88AB\u4F7F\u7528")}finally{this.isLoading.set(!1),this.cdr.detectChanges()}})}handleLoginSuccess(t){return E(this,null,function*(){this.reuseTabService?.clear();let e={token:yield this.firebaseAuth.getIdToken(),name:t.displayName||t.email||(t.isAnonymous?"\u533F\u540D\u7528\u6236":"Firebase User"),email:t.email,avatar:t.photoURL||"./assets/tmp/img/avatar.jpg",id:t.uid,expired:+new Date+1e3*60*60,isFirebaseUser:!0,authProvider:t.authProvider,isAnonymous:t.isAnonymous};this.tokenService.set(e),this.settingsService.setUser({name:e.name,avatar:e.avatar,email:e.email,uid:e.id,isFirebaseUser:!0,authProvider:e.authProvider,isAnonymous:e.isAnonymous}),this.startupSrv.load().subscribe(()=>{let i=this.tokenService.referrer?.url||"/";i.includes("/passport")&&(i="/"),this.router.navigateByUrl(i)})})}goToLogin(){this.router.navigate(["/passport/login"])}goToRegister(){this.router.navigate(["/passport/register"])}};Oe.\u0275fac=function(e){return new(e||Oe)},Oe.\u0275cmp=F({type:Oe,selectors:[["passport-anonymous-login"]],decls:7,vars:6,consts:[[1,"anonymous-login-container"],[1,"login-card",3,"nzTitle"],["nzCloseable","",1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],[1,"anonymous-login-section"],[1,"upgrade-prompt-section"],[1,"upgrade-form-section"],[1,"authenticated-user-section"],["nzCloseable","",1,"mb-lg",3,"nzOnClose","nzType","nzMessage","nzShowIcon"],[1,"login-description"],["nzDirection","vertical","nzSize","middle"],[1,"description-item"],["nz-icon","","nzType","user","nzTheme","outline"],["nz-icon","","nzType","safety-certificate","nzTheme","outline"],["nz-icon","","nzType","rocket","nzTheme","outline"],[1,"login-actions"],["nzDirection","vertical","nzSize","large",2,"width","100%"],["nz-button","","nzType","primary","nzSize","large","nzBlock","",3,"click","nzLoading"],["nz-icon","","nzType","user"],["nzText","\u6216\u8005"],["nz-button","","nzType","default",3,"click"],["nz-icon","","nzType","login"],["nz-icon","","nzType","user-add"],["nzType","info","nzMessage","\u60A8\u76EE\u524D\u662F\u533F\u540D\u7528\u6236","nzDescription","\u5347\u7D1A\u70BA\u6B63\u5F0F\u5E33\u865F\u53EF\u4EE5\u4FDD\u5B58\u60A8\u7684\u8CC7\u6599\u548C\u8A2D\u5B9A\uFF0C\u4E26\u4EAB\u53D7\u5B8C\u6574\u529F\u80FD\u3002","nzShowIcon","",1,"mb-lg"],["nz-button","","nzType","primary","nzSize","large","nzBlock","",3,"click"],["nz-icon","","nzType","arrow-up"],["nz-icon","","nzType","home"],[1,"form-header"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired",""],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684 Email \u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","type","email","formControlName","email","placeholder","\u8ACB\u8F38\u5165\u60A8\u7684 Email"],["nzErrorTip","\u5BC6\u78BC\u81F3\u5C11\u9700\u8981 6 \u500B\u5B57\u5143"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","\u8ACB\u8A2D\u5B9A\u5BC6\u78BC\uFF08\u81F3\u5C11 6 \u500B\u5B57\u5143\uFF09"],["nzErrorTip","\u8ACB\u518D\u6B21\u8F38\u5165\u5BC6\u78BC"],["nz-input","","type","password","formControlName","confirmPassword","placeholder","\u8ACB\u518D\u6B21\u8F38\u5165\u5BC6\u78BC"],["nzSize","middle",2,"width","100%"],["nz-button","","nzType","primary","nzSize","large","type","submit",3,"nzLoading"],["nz-button","","nzType","default","nzSize","large",3,"click","disabled"],["nz-icon","","nzType","close"],["nzType","success","nzMessage","\u60A8\u5DF2\u7D93\u662F\u6B63\u5F0F\u7528\u6236","nzShowIcon","",1,"mb-lg",3,"nzDescription"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"nz-card",1),d(2,zn,1,3,"nz-alert",2),d(3,hn,29,1,"div",3),d(4,vn,9,0,"div",4),d(5,bn,33,3,"div",5),d(6,yn,5,1,"div",6),s()()),e&2&&(o(),l("nzTitle","\u533F\u540D\u767B\u5165"),o(),g(i.error()?2:-1),o(),g(!i.isAnonymousUser()&&!i.showUpgradeForm()?3:-1),o(),g(i.isAnonymousUser()&&!i.showUpgradeForm()?4:-1),o(),g(i.showUpgradeForm()?5:-1),o(),g(!i.isAnonymousUser()&&i.currentUser()?6:-1))},dependencies:[$,q,V,R,G,W,j,ne,te,O,B,N,T,fe,ge,ee,X,Y,Q,J,de,Z,ue,le,K,H,ce,pe,Ee,wt,yt],styles:[".anonymous-login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;background:linear-gradient(135deg,#667eea,#764ba2)}.anonymous-login-container[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]{width:100%;max-width:480px;box-shadow:0 8px 32px #0000001a;border-radius:12px;overflow:hidden}.anonymous-login-container[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:deep(.ant-card-head){background:linear-gradient(135deg,#667eea,#764ba2);border-bottom:none}.anonymous-login-container[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:deep(.ant-card-head)   .ant-card-head-title[_ngcontent-%COMP%]{color:#fff;font-size:24px;font-weight:600;text-align:center}.anonymous-login-container[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:deep(.ant-card-body){padding:32px}.anonymous-login-section[_ngcontent-%COMP%]   .login-description[_ngcontent-%COMP%]{margin-bottom:24px}.anonymous-login-section[_ngcontent-%COMP%]   .login-description[_ngcontent-%COMP%]   .description-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;color:#666;font-size:14px}.anonymous-login-section[_ngcontent-%COMP%]   .login-description[_ngcontent-%COMP%]   .description-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#1890ff;font-size:16px}.anonymous-login-section[_ngcontent-%COMP%]   .login-actions[_ngcontent-%COMP%], .upgrade-prompt-section[_ngcontent-%COMP%]{text-align:center}.upgrade-prompt-section[_ngcontent-%COMP%]   .ant-alert[_ngcontent-%COMP%]{text-align:left}.upgrade-form-section[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:24px}.upgrade-form-section[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#262626;font-size:20px;font-weight:600}.upgrade-form-section[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px;line-height:1.5}.upgrade-form-section[_ngcontent-%COMP%]   .ant-form-item[_ngcontent-%COMP%]{margin-bottom:20px}.upgrade-form-section[_ngcontent-%COMP%]   .ant-form-item[_ngcontent-%COMP%]:last-child{margin-bottom:0;text-align:center}.authenticated-user-section[_ngcontent-%COMP%]{text-align:center}.authenticated-user-section[_ngcontent-%COMP%]   .ant-alert[_ngcontent-%COMP%]{text-align:left}@media (max-width: 576px){.anonymous-login-container[_ngcontent-%COMP%]{padding:12px}.anonymous-login-container[_ngcontent-%COMP%]   .login-card[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:deep(.ant-card-body){padding:20px}.upgrade-form-section[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px}}.ant-btn[nz-loading][_ngcontent-%COMP%]{pointer-events:none}.description-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:all .3s ease}.description-item[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{transform:scale(1.1);color:#40a9ff}[_ngcontent-%COMP%]:deep(.ant-form-item-has-error)   .ant-input-group[_ngcontent-%COMP%]{border-color:#ff4d4f}[_ngcontent-%COMP%]:deep(.ant-alert-success){border-color:#b7eb8f;background-color:#f6ffed}[_ngcontent-%COMP%]:deep(.ant-alert-info){border-color:#91d5ff;background-color:#e6f7ff}.ant-space-item[_ngcontent-%COMP%]{display:flex}.ant-space-item[_ngcontent-%COMP%]   .ant-btn[_ngcontent-%COMP%]{flex:1}[_ngcontent-%COMP%]:deep(.ant-divider){margin:20px 0}[_ngcontent-%COMP%]:deep(.ant-divider).ant-divider-with-text{color:#999;font-size:12px}"],changeDetection:0});var ut=Oe;function wn(n,t){n&1&&m(0,"nz-alert",7)}function xn(n,t){if(n&1){let e=x();r(0,"nz-alert",24),C("nzOnClose",function(){z(e);let a=c(2);return h(a.error.set(""))}),s()}if(n&2){let e=c(2);l("nzMessage",e.error())}}function En(n,t){n&1&&m(0,"nz-alert",11)}function Fn(n,t){n&1&&u(0," \u8ACB\u8F38\u5165\u76EE\u524D\u5BC6\u78BC ")}function Pn(n,t){n&1&&u(0," \u5BC6\u78BC\u9577\u5EA6\u81F3\u5C116\u500B\u5B57\u5143 ")}function Sn(n,t){if(n&1&&(d(0,Fn,1,0),d(1,Pn,1,0)),n&2){let e=t.$implicit;g(e.hasError("required")?0:-1),o(),g(e.hasError("minlength")?1:-1)}}function Mn(n,t){n&1&&u(0," \u8ACB\u8F38\u5165\u65B0\u7684 Email ")}function An(n,t){n&1&&u(0," \u8ACB\u8F38\u5165\u6709\u6548\u7684 Email \u683C\u5F0F ")}function Dn(n,t){if(n&1&&(d(0,Mn,1,0),d(1,An,1,0)),n&2){let e=t.$implicit;g(e.hasError("required")?0:-1),o(),g(e.hasError("email")?1:-1)}}function Nn(n,t){n&1&&u(0," \u66F4\u65B0\u4E2D... ")}function Tn(n,t){n&1&&u(0," \u66F4\u65B0 Email ")}function Bn(n,t){if(n&1){let e=x();r(0,"form",9),C("ngSubmit",function(){z(e);let a=c();return h(a.submit())}),d(1,xn,1,1,"nz-alert",10),d(2,En,1,0,"nz-alert",11),r(3,"div",12),m(4,"nz-alert",13),s(),r(5,"nz-form-item")(6,"nz-form-label",14),u(7,"\u76EE\u524D\u5BC6\u78BC"),s(),r(8,"nz-form-control",15),m(9,"input",16),D(10,Sn,2,2,"ng-template",null,0,A),s()(),r(12,"nz-form-item")(13,"nz-form-label",14),u(14,"\u65B0 Email"),s(),r(15,"nz-form-control",15),m(16,"input",17),D(17,Dn,2,2,"ng-template",null,1,A),s()(),r(19,"nz-form-item")(20,"nz-form-control",18)(21,"button",19),d(22,Nn,1,0)(23,Tn,1,0),s()()(),m(24,"nz-divider",20),r(25,"div",21)(26,"button",22),C("click",function(){z(e);let a=c();return h(a.resendVerification())}),m(27,"i",23),u(28," \u91CD\u65B0\u767C\u9001\u9A57\u8B49\u4FE1 "),s()()()}if(n&2){let e,i=M(11),a=M(18),f=c();l("formGroup",f.form),o(),g(f.error()?1:-1),o(),g(f.success()?2:-1),o(2),l("nzDescription",((e=f.currentUser())==null?null:e.email)||"\u672A\u77E5"),o(2),l("nzSpan",6),o(2),l("nzSpan",18)("nzErrorTip",i),o(),l("disabled",f.isLoading()),o(4),l("nzSpan",6),o(2),l("nzSpan",18)("nzErrorTip",a),o(),l("disabled",f.isLoading()),o(4),l("nzOffset",6)("nzSpan",18),o(),l("nzLoading",f.isLoading())("disabled",f.form.invalid||f.isLoading()||f.success()),o(),g(f.isLoading()?22:23),o(4),l("disabled",f.isLoading())}}var ke=class ke{constructor(){this.router=p(L);this.cdr=p(re);this.firebaseAuth=p(I);this.message=p(se);this.form=p(oe).nonNullable.group({currentPassword:["",[_.required,_.minLength(6)]],newEmail:["",[_.required,_.email]]});this.useFirebaseAuth=y(k.firebase?.enableFirebaseAuth||!1);this.isLoading=y(!1);this.error=y("");this.success=y(!1);this.currentUser=ie(()=>this.firebaseAuth.currentUser());this.isAuthenticated=ie(()=>this.firebaseAuth.isAuthenticated());this.canUpdateEmail=ie(()=>this.isAuthenticated()&&this.currentUser()&&!this.currentUser()?.isAnonymous&&this.useFirebaseAuth())}submit(){return E(this,null,function*(){if(!this.canUpdateEmail()){this.error.set("\u7121\u6CD5\u66F4\u65B0 Email\uFF1A\u8ACB\u78BA\u8A8D\u60A8\u5DF2\u767B\u5165\u4E14\u4E0D\u662F\u533F\u540D\u4F7F\u7528\u8005");return}if(this.error.set(""),this.success.set(!1),Object.keys(this.form.controls).forEach(f=>{let w=this.form.controls[f];w.markAsDirty(),w.updateValueAndValidity()}),this.form.invalid)return;let t=this.form.value,e=t.currentPassword,i=t.newEmail,a=this.currentUser();if(!a?.email||!e||!i){this.error.set("\u8ACB\u586B\u5BEB\u6240\u6709\u5FC5\u8981\u6B04\u4F4D");return}this.isLoading.set(!0),this.cdr.detectChanges();try{if(!(yield this.firebaseAuth.reauthenticateWithEmailPassword(a.email,e))){this.error.set("\u76EE\u524D\u5BC6\u78BC\u9A57\u8B49\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u5BC6\u78BC\u662F\u5426\u6B63\u78BA");return}(yield this.firebaseAuth.updateEmail(i))?(this.success.set(!0),this.form.reset(),this.message.success("Email \u5DF2\u6210\u529F\u66F4\u65B0\uFF01\u8ACB\u6AA2\u67E5\u65B0\u4FE1\u7BB1\u7684\u9A57\u8B49\u4FE1"),setTimeout(()=>{this.router.navigate(["/passport/login"])},3e3)):this.error.set("Email \u66F4\u65B0\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}catch(f){console.error("Update email error:",f),this.error.set("Email \u66F4\u65B0\u5931\u6557\uFF0C\u8A72\u4FE1\u7BB1\u53EF\u80FD\u5DF2\u88AB\u4F7F\u7528\u6216\u683C\u5F0F\u4E0D\u6B63\u78BA")}finally{this.isLoading.set(!1),this.cdr.detectChanges()}})}goBack(){this.router.navigate(["/"])}resendVerification(){return E(this,null,function*(){if(!this.useFirebaseAuth())return;(yield this.firebaseAuth.sendEmailVerification())&&this.message.success("\u9A57\u8B49\u4FE1\u5DF2\u91CD\u65B0\u767C\u9001")})}};ke.\u0275fac=function(e){return new(e||ke)},ke.\u0275cmp=F({type:ke,selectors:[["app-update-email"]],decls:9,vars:4,consts:[["currentPasswordErrorTpl",""],["newEmailErrorTpl",""],[1,"main"],["nzTitle","\u66F4\u65B0 Email",1,"update-email-card"],["nz-card-extra",""],["nz-button","","nzType","link","routerLink","/"],["nz-icon","","nzType","arrow-left"],["nzType","warning","nzMessage","\u7121\u6CD5\u66F4\u65B0 Email","nzDescription","\u8ACB\u78BA\u8A8D\u60A8\u5DF2\u4F7F\u7528 Firebase \u767B\u5165\u4E14\u4E0D\u662F\u533F\u540D\u4F7F\u7528\u8005","nzShowIcon","",1,"mb-lg"],["nz-form","",1,"update-email-form",3,"formGroup"],["nz-form","",1,"update-email-form",3,"ngSubmit","formGroup"],["nzType","error","nzShowIcon","","nzCloseable","",1,"mb-lg",3,"nzMessage"],["nzType","success","nzMessage","Email \u66F4\u65B0\u6210\u529F","nzDescription","\u8ACB\u6AA2\u67E5\u65B0\u4FE1\u7BB1\u7684\u9A57\u8B49\u4FE1\uFF0C3\u79D2\u5F8C\u5C07\u81EA\u52D5\u5C0E\u5411\u767B\u5165\u9801\u9762","nzShowIcon","",1,"mb-lg"],[1,"user-info","mb-lg"],["nzType","info","nzMessage","\u76EE\u524D Email","nzShowIcon","",3,"nzDescription"],["nzRequired","",3,"nzSpan"],["nzHasFeedback","",3,"nzSpan","nzErrorTip"],["nz-input","","type","password","formControlName","currentPassword","placeholder","\u8ACB\u8F38\u5165\u76EE\u524D\u5BC6\u78BC\u4EE5\u9A57\u8B49\u8EAB\u4EFD",3,"disabled"],["nz-input","","type","email","formControlName","newEmail","placeholder","\u8ACB\u8F38\u5165\u65B0\u7684 Email \u5730\u5740",3,"disabled"],[3,"nzOffset","nzSpan"],["nz-button","","nzType","primary","nzSize","large",1,"update-btn",3,"nzLoading","disabled"],["nzText","\u5176\u4ED6\u64CD\u4F5C"],[1,"additional-actions"],["nz-button","","nzType","link",3,"click","disabled"],["nz-icon","","nzType","mail"],["nzType","error","nzShowIcon","","nzCloseable","",1,"mb-lg",3,"nzOnClose","nzMessage"]],template:function(e,i){e&1&&(r(0,"div",2)(1,"nz-card",3)(2,"div",4)(3,"a",5),m(4,"i",6),u(5),v(6,"i18n"),s()(),d(7,wn,1,0,"nz-alert",7)(8,Bn,29,18,"form",8),s()()),e&2&&(o(5),S(" ",b(6,2,"app.back")," "),o(2),g(i.canUpdateEmail()?8:7))},dependencies:[$,q,V,R,G,W,j,ae,ne,te,O,B,N,T,ee,X,Y,Q,J,de,Z,K,H,fe,ge,ue,le,pe,Ee,U],styles:["[_nghost-%COMP%]{display:block;width:100%;max-width:500px;margin:0 auto;padding:24px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-email-card[_ngcontent-%COMP%]{box-shadow:0 2px 8px #0000001a;border-radius:8px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-email-card[_ngcontent-%COMP%]   .update-email-form[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{background:#f6f8fa;padding:16px;border-radius:6px;margin-bottom:24px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-email-card[_ngcontent-%COMP%]   .update-email-form[_ngcontent-%COMP%]   .update-btn[_ngcontent-%COMP%]{width:100%;height:40px;font-size:16px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-email-card[_ngcontent-%COMP%]   .update-email-form[_ngcontent-%COMP%]   .additional-actions[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-email-card[_ngcontent-%COMP%]   .update-email-form[_ngcontent-%COMP%]   .additional-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 8px}[data-theme=dark]   [_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-email-card[_ngcontent-%COMP%]   .update-email-form[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{background:#ffffff0a}"],changeDetection:0});var mt=ke;function On(n,t){n&1&&m(0,"nz-alert",9)}function kn(n,t){if(n&1){let e=x();r(0,"nz-alert",28),C("nzOnClose",function(){z(e);let a=c(2);return h(a.error.set(""))}),s()}if(n&2){let e=c(2);l("nzMessage",e.error())}}function Ln(n,t){n&1&&m(0,"nz-alert",13)}function Un(n,t){n&1&&u(0," \u8ACB\u8F38\u5165\u76EE\u524D\u5BC6\u78BC ")}function In(n,t){n&1&&u(0," \u5BC6\u78BC\u9577\u5EA6\u81F3\u5C116\u500B\u5B57\u5143 ")}function Vn(n,t){if(n&1&&(d(0,Un,1,0),d(1,In,1,0)),n&2){let e=t.$implicit;g(e.hasError("required")?0:-1),o(),g(e.hasError("minlength")?1:-1)}}function Rn(n,t){if(n&1&&(r(0,"div",29)(1,"div"),u(2," \u5F37\u5EA6\uFF1A "),m(3,"nz-progress",30),s()()),n&2){let e=c(3);o(),Ve(Re("progress-",e.status)),o(2),l("nzPercent",e.progress)("nzStatus",e.passwordProgressMap[e.status])("nzStrokeWidth",6)}}function Gn(n,t){if(n&1&&(r(0,"div",20),D(1,Rn,4,6,"ng-template",null,3,A),s()),n&2){let e=M(2);l("nzPopoverContent",e)}}function qn(n,t){n&1&&u(0," \u8ACB\u8F38\u5165\u65B0\u5BC6\u78BC ")}function Wn(n,t){n&1&&u(0," \u5BC6\u78BC\u9577\u5EA6\u81F3\u5C116\u500B\u5B57\u5143 ")}function jn(n,t){if(n&1&&(d(0,qn,1,0),d(1,Wn,1,0)),n&2){let e=t.$implicit;g(e.hasError("required")?0:-1),o(),g(e.hasError("minlength")?1:-1)}}function $n(n,t){n&1&&u(0," \u8ACB\u78BA\u8A8D\u65B0\u5BC6\u78BC ")}function Hn(n,t){n&1&&u(0," \u5BC6\u78BC\u9577\u5EA6\u81F3\u5C116\u500B\u5B57\u5143 ")}function Kn(n,t){n&1&&u(0," \u5169\u6B21\u8F38\u5165\u7684\u5BC6\u78BC\u4E0D\u4E00\u81F4 ")}function Yn(n,t){if(n&1&&(d(0,$n,1,0),d(1,Hn,1,0),d(2,Kn,1,0)),n&2){let e=t.$implicit;g(e.hasError("required")?0:-1),o(),g(e.hasError("minlength")?1:-1),o(),g(e.hasError("matchControl")?2:-1)}}function Xn(n,t){n&1&&u(0," \u66F4\u65B0\u4E2D... ")}function Jn(n,t){n&1&&u(0," \u66F4\u65B0\u5BC6\u78BC ")}function Qn(n,t){if(n&1){let e=x();r(0,"form",11),C("ngSubmit",function(){z(e);let a=c();return h(a.submit())}),d(1,kn,1,1,"nz-alert",12),d(2,Ln,1,0,"nz-alert",13),r(3,"div",14),m(4,"nz-alert",15),s(),r(5,"nz-form-item")(6,"nz-form-label",16),u(7,"\u76EE\u524D\u5BC6\u78BC"),s(),r(8,"nz-form-control",17),m(9,"input",18),D(10,Vn,2,2,"ng-template",null,0,A),s()(),r(12,"nz-form-item")(13,"nz-form-label",16),u(14,"\u65B0\u5BC6\u78BC"),s(),r(15,"nz-form-control",17),m(16,"input",19),d(17,Gn,3,1,"div",20),D(18,jn,2,2,"ng-template",null,1,A),s()(),r(20,"nz-form-item")(21,"nz-form-label",16),u(22,"\u78BA\u8A8D\u65B0\u5BC6\u78BC"),s(),r(23,"nz-form-control",17),m(24,"input",21),D(25,Yn,3,3,"ng-template",null,2,A),s()(),r(27,"nz-form-item")(28,"nz-form-control",22)(29,"button",23),d(30,Xn,1,0)(31,Jn,1,0),s()()(),m(32,"nz-divider",24),r(33,"div",25)(34,"a",26),m(35,"i",27),u(36),v(37,"i18n"),s()()()}if(n&2){let e,i=M(11),a=M(19),f=M(26),w=c();l("formGroup",w.form),o(),g(w.error()?1:-1),o(),g(w.success()?2:-1),o(2),l("nzDescription",((e=w.currentUser())==null?null:e.email)||"\u672A\u77E5"),o(2),l("nzSpan",6),o(2),l("nzSpan",18)("nzErrorTip",i),o(),l("disabled",w.isLoading()),o(4),l("nzSpan",6),o(2),l("nzSpan",18)("nzErrorTip",a),o(),l("disabled",w.isLoading()),o(),g(w.visible?17:-1),o(4),l("nzSpan",6),o(2),l("nzSpan",18)("nzErrorTip",f),o(),l("disabled",w.isLoading()),o(4),l("nzOffset",6)("nzSpan",18),o(),l("nzLoading",w.isLoading())("disabled",w.form.invalid||w.isLoading()||w.success()),o(),g(w.isLoading()?30:31),o(4),ye("disabled",w.isLoading()),o(2),S(" ",b(37,25,"passport.forgot-password")," ")}}var Le=class Le{constructor(){this.router=p(L);this.cdr=p(re);this.firebaseAuth=p(I);this.message=p(se);this.form=p(oe).nonNullable.group({currentPassword:["",[_.required,_.minLength(6)]],newPassword:["",[_.required,_.minLength(6)]],confirmPassword:["",[_.required,_.minLength(6)]]},{validators:at("newPassword","confirmPassword")});this.useFirebaseAuth=y(k.firebase?.enableFirebaseAuth||!1);this.isLoading=y(!1);this.error=y("");this.success=y(!1);this.visible=!1;this.status="pool";this.progress=0;this.passwordProgressMap={ok:"success",pass:"normal",pool:"exception"};this.currentUser=ie(()=>this.firebaseAuth.currentUser());this.isAuthenticated=ie(()=>this.firebaseAuth.isAuthenticated());this.canUpdatePassword=ie(()=>this.isAuthenticated()&&this.currentUser()&&!this.currentUser()?.isAnonymous&&this.useFirebaseAuth())}static checkPassword(t){if(!t)return null;let e=this;e.visible=!!t.value,t.value&&t.value.length>9?e.status="ok":t.value&&t.value.length>5?e.status="pass":e.status="pool",e.visible&&(e.progress=t.value.length*10>100?100:t.value.length*10)}submit(){return E(this,null,function*(){if(!this.canUpdatePassword()){this.error.set("\u7121\u6CD5\u66F4\u65B0\u5BC6\u78BC\uFF1A\u8ACB\u78BA\u8A8D\u60A8\u5DF2\u767B\u5165\u4E14\u4E0D\u662F\u533F\u540D\u4F7F\u7528\u8005");return}if(this.error.set(""),this.success.set(!1),Object.keys(this.form.controls).forEach(f=>{let w=this.form.controls[f];w.markAsDirty(),w.updateValueAndValidity()}),this.form.invalid)return;let t=this.form.value,e=t.currentPassword,i=t.newPassword,a=this.currentUser();if(!a?.email||!e||!i){this.error.set("\u8ACB\u586B\u5BEB\u6240\u6709\u5FC5\u8981\u6B04\u4F4D");return}this.isLoading.set(!0),this.cdr.detectChanges();try{if(!(yield this.firebaseAuth.reauthenticateWithEmailPassword(a.email,e))){this.error.set("\u76EE\u524D\u5BC6\u78BC\u9A57\u8B49\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u5BC6\u78BC\u662F\u5426\u6B63\u78BA");return}(yield this.firebaseAuth.updatePassword(i))?(this.success.set(!0),this.form.reset(),this.visible=!1,this.status="pool",this.progress=0,this.message.success("\u5BC6\u78BC\u5DF2\u6210\u529F\u66F4\u65B0\uFF01"),setTimeout(()=>{this.router.navigate(["/passport/login"])},3e3)):this.error.set("\u5BC6\u78BC\u66F4\u65B0\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}catch(f){console.error("Update password error:",f),this.error.set("\u5BC6\u78BC\u66F4\u65B0\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5\u5BC6\u78BC\u683C\u5F0F\u662F\u5426\u6B63\u78BA")}finally{this.isLoading.set(!1),this.cdr.detectChanges()}})}goBack(){this.router.navigate(["/"])}goToResetPassword(){this.router.navigate(["/passport/reset-password"])}};Le.\u0275fac=function(e){return new(e||Le)},Le.\u0275cmp=F({type:Le,selectors:[["app-update-password"]],decls:9,vars:4,consts:[["currentPasswordErrorTpl",""],["newPasswordErrorTpl",""],["confirmPasswordErrorTpl",""],["pwdProgress",""],[1,"main"],["nzTitle","\u66F4\u65B0\u5BC6\u78BC",1,"update-password-card"],["nz-card-extra",""],["nz-button","","nzType","link","routerLink","/"],["nz-icon","","nzType","arrow-left"],["nzType","warning","nzMessage","\u7121\u6CD5\u66F4\u65B0\u5BC6\u78BC","nzDescription","\u8ACB\u78BA\u8A8D\u60A8\u5DF2\u4F7F\u7528 Firebase \u767B\u5165\u4E14\u4E0D\u662F\u533F\u540D\u4F7F\u7528\u8005","nzShowIcon","",1,"mb-lg"],["nz-form","",1,"update-password-form",3,"formGroup"],["nz-form","",1,"update-password-form",3,"ngSubmit","formGroup"],["nzType","error","nzShowIcon","","nzCloseable","",1,"mb-lg",3,"nzMessage"],["nzType","success","nzMessage","\u5BC6\u78BC\u66F4\u65B0\u6210\u529F","nzDescription","\u5BC6\u78BC\u5DF2\u6210\u529F\u66F4\u65B0\uFF0C3\u79D2\u5F8C\u5C07\u81EA\u52D5\u5C0E\u5411\u767B\u5165\u9801\u9762","nzShowIcon","",1,"mb-lg"],[1,"user-info","mb-lg"],["nzType","info","nzMessage","\u76EE\u524D\u4F7F\u7528\u8005","nzShowIcon","",3,"nzDescription"],["nzRequired","",3,"nzSpan"],["nzHasFeedback","",3,"nzSpan","nzErrorTip"],["nz-input","","type","password","formControlName","currentPassword","placeholder","\u8ACB\u8F38\u5165\u76EE\u524D\u5BC6\u78BC\u4EE5\u9A57\u8B49\u8EAB\u4EFD",3,"disabled"],["nz-input","","type","password","formControlName","newPassword","placeholder","\u8ACB\u8F38\u5165\u65B0\u5BC6\u78BC\uFF08\u81F3\u5C116\u500B\u5B57\u5143\uFF09",3,"disabled"],["nz-popover","","nzPopoverTrigger","focus","nzPopoverPlacement","right",3,"nzPopoverContent"],["nz-input","","type","password","formControlName","confirmPassword","placeholder","\u8ACB\u518D\u6B21\u8F38\u5165\u65B0\u5BC6\u78BC",3,"disabled"],[3,"nzOffset","nzSpan"],["nz-button","","nzType","primary","nzSize","large",1,"update-btn",3,"nzLoading","disabled"],["nzText","\u5176\u4ED6\u64CD\u4F5C"],[1,"additional-actions"],["nz-button","","nzType","link","routerLink","/passport/reset-password"],["nz-icon","","nzType","question-circle"],["nzType","error","nzShowIcon","","nzCloseable","",1,"mb-lg",3,"nzOnClose","nzMessage"],[2,"width","240px"],["nzSize","small",3,"nzPercent","nzStatus","nzStrokeWidth"]],template:function(e,i){e&1&&(r(0,"div",4)(1,"nz-card",5)(2,"div",6)(3,"a",7),m(4,"i",8),u(5),v(6,"i18n"),s()(),d(7,On,1,0,"nz-alert",9)(8,Qn,38,27,"form",10),s()()),e&2&&(o(5),S(" ",b(6,2,"app.back")," "),o(2),g(i.canUpdatePassword()?8:7))},dependencies:[$,q,V,R,G,W,j,ae,ne,te,O,B,N,T,ee,X,Y,Q,J,de,Z,K,H,fe,ge,ue,le,pe,Ee,Qe,Je,Xe,Ye,U],styles:["[_nghost-%COMP%]{display:block;width:100%;max-width:500px;margin:0 auto;padding:24px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-password-card[_ngcontent-%COMP%]{box-shadow:0 2px 8px #0000001a;border-radius:8px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-password-card[_ngcontent-%COMP%]   .update-password-form[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{background:#f6f8fa;padding:16px;border-radius:6px;margin-bottom:24px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-password-card[_ngcontent-%COMP%]   .update-password-form[_ngcontent-%COMP%]   .update-btn[_ngcontent-%COMP%]{width:100%;height:40px;font-size:16px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-password-card[_ngcontent-%COMP%]   .update-password-form[_ngcontent-%COMP%]   .additional-actions[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-password-card[_ngcontent-%COMP%]   .update-password-form[_ngcontent-%COMP%]   .additional-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 8px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-password-card[_ngcontent-%COMP%]   .update-password-form[_ngcontent-%COMP%]   .progress-ok[_ngcontent-%COMP%]{color:#52c41a}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-password-card[_ngcontent-%COMP%]   .update-password-form[_ngcontent-%COMP%]   .progress-pass[_ngcontent-%COMP%]{color:#faad14}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-password-card[_ngcontent-%COMP%]   .update-password-form[_ngcontent-%COMP%]   .progress-pool[_ngcontent-%COMP%]{color:#ff4d4f}[data-theme=dark]   [_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .update-password-card[_ngcontent-%COMP%]   .update-password-form[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{background:#ffffff0a}"],changeDetection:0});var pt=Le;function Zn(n,t){n&1&&m(0,"nz-alert",4)}function ei(n,t){if(n&1){let e=x();r(0,"nz-alert",17),C("nzOnClose",function(){z(e);let a=c(3);return h(a.error.set(""))}),s()}if(n&2){let e=c(3);l("nzMessage",e.error())}}function ti(n,t){n&1&&u(0," \u8ACB\u8F38\u5165 Email \u5730\u5740 ")}function ni(n,t){n&1&&u(0," \u8ACB\u8F38\u5165\u6709\u6548\u7684 Email \u683C\u5F0F ")}function ii(n,t){if(n&1&&(d(0,ti,1,0),d(1,ni,1,0)),n&2){let e=t.$implicit;g(e.hasError("required")?0:-1),o(),g(e.hasError("email")?1:-1)}}function oi(n,t){n&1&&u(0," \u767C\u9001\u4E2D... ")}function ri(n,t){n&1&&u(0," \u767C\u9001\u91CD\u8A2D\u4FE1 ")}function ai(n,t){if(n&1){let e=x();r(0,"form",6),C("ngSubmit",function(){z(e);let a=c(2);return h(a.submit())}),d(1,ei,1,1,"nz-alert",7),r(2,"div",8),m(3,"nz-alert",9),s(),r(4,"nz-form-item")(5,"nz-form-label",10),u(6),v(7,"i18n"),s(),r(8,"nz-form-control",11),m(9,"input",12),D(10,ii,2,2,"ng-template",null,0,A),s()(),r(12,"nz-form-item")(13,"nz-form-control",13)(14,"button",14),d(15,oi,1,0)(16,ri,1,0),s()()(),r(17,"nz-form-item")(18,"nz-form-control",13)(19,"a",15),m(20,"i",16),u(21," \u8FD4\u56DE\u767B\u5165 "),s()()()()}if(n&2){let e=M(11),i=c(2);l("formGroup",i.form),o(),g(i.error()?1:-1),o(4),l("nzSpan",6),o(),P(b(7,16,"form.email.label")),o(2),l("nzSpan",18)("nzErrorTip",e),o(),l("disabled",i.isLoading()),o(4),l("nzOffset",6)("nzSpan",18),o(),l("nzLoading",i.isLoading())("disabled",i.form.invalid||i.isLoading()),o(),g(i.isLoading()?15:16),o(3),l("nzOffset",6)("nzSpan",18),o(),ye("disabled",i.isLoading())}}function si(n,t){if(n&1&&(r(0,"nz-card",2),d(1,Zn,1,0,"nz-alert",4)(2,ai,22,18,"form",5),s()),n&2){let e=c();o(),g(e.canResetPassword()?2:1)}}function li(n,t){if(n&1){let e=x();r(0,"nz-alert",28),C("nzOnClose",function(){z(e);let a=c(2);return h(a.error.set(""))}),s()}if(n&2){let e=c(2);l("nzMessage",e.error())}}function ui(n,t){if(n&1){let e=x();r(0,"nz-card",3)(1,"nz-result",18)(2,"div",19)(3,"button",20),C("click",function(){z(e);let a=c();return h(a.goToLogin())}),m(4,"i",21),u(5," \u8FD4\u56DE\u767B\u5165 "),s(),r(6,"button",22),C("click",function(){z(e);let a=c();return h(a.resendResetEmail())}),m(7,"i",23),u(8," \u91CD\u65B0\u767C\u9001 "),s(),r(9,"button",24),C("click",function(){z(e);let a=c();return h(a.resetForm())}),u(10," \u4F7F\u7528\u5176\u4ED6 Email "),s()()(),d(11,li,1,1,"nz-alert",25),r(12,"div",26),m(13,"nz-alert",27),s()()}if(n&2){let e=c();o(),l("nzSubTitle","\u6211\u5011\u5DF2\u5C07\u5BC6\u78BC\u91CD\u8A2D\u9023\u7D50\u767C\u9001\u5230 "+e.sentEmail()+"\uFF0C\u8ACB\u6AA2\u67E5\u60A8\u7684\u4FE1\u7BB1\u4E26\u9EDE\u64CA\u9023\u7D50\u91CD\u8A2D\u5BC6\u78BC\u3002"),o(5),l("nzLoading",e.isLoading())("disabled",e.isLoading()),o(3),l("disabled",e.isLoading()),o(2),g(e.error()?11:-1)}}var Ue=class Ue{constructor(){this.router=p(L);this.cdr=p(re);this.firebaseAuth=p(I);this.message=p(se);this.form=p(oe).nonNullable.group({email:["",[_.required,_.email]]});this.useFirebaseAuth=y(k.firebase?.enableFirebaseAuth||!1);this.isLoading=y(!1);this.error=y("");this.success=y(!1);this.sentEmail=y("");this.canResetPassword=ie(()=>this.useFirebaseAuth())}submit(){return E(this,null,function*(){if(!this.canResetPassword()){this.error.set("Firebase \u8A8D\u8B49\u529F\u80FD\u672A\u555F\u7528");return}if(this.error.set(""),this.success.set(!1),Object.keys(this.form.controls).forEach(i=>{let a=this.form.controls[i];a.markAsDirty(),a.updateValueAndValidity()}),this.form.invalid)return;let e=this.form.value.email;if(!e){this.error.set("\u8ACB\u8F38\u5165 Email \u5730\u5740");return}this.isLoading.set(!0),this.cdr.detectChanges();try{(yield this.firebaseAuth.sendPasswordResetEmail(e))?(this.success.set(!0),this.sentEmail.set(e),this.form.reset(),this.message.success("\u5BC6\u78BC\u91CD\u8A2D\u4FE1\u5DF2\u767C\u9001\uFF01")):this.error.set("\u5BC6\u78BC\u91CD\u8A2D\u4FE1\u767C\u9001\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}catch(i){console.error("Reset password error:",i),this.error.set("\u5BC6\u78BC\u91CD\u8A2D\u4FE1\u767C\u9001\u5931\u6557\uFF0C\u8ACB\u6AA2\u67E5 Email \u662F\u5426\u6B63\u78BA")}finally{this.isLoading.set(!1),this.cdr.detectChanges()}})}resendResetEmail(){return E(this,null,function*(){let t=this.sentEmail();if(t){this.isLoading.set(!0),this.error.set(""),this.cdr.detectChanges();try{(yield this.firebaseAuth.sendPasswordResetEmail(t))?this.message.success("\u5BC6\u78BC\u91CD\u8A2D\u4FE1\u5DF2\u91CD\u65B0\u767C\u9001\uFF01"):this.error.set("\u91CD\u65B0\u767C\u9001\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}catch(e){console.error("Resend reset email error:",e),this.error.set("\u91CD\u65B0\u767C\u9001\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.isLoading.set(!1),this.cdr.detectChanges()}}})}goToLogin(){this.router.navigate(["/passport/login"])}resetForm(){this.success.set(!1),this.sentEmail.set(""),this.error.set(""),this.form.reset()}};Ue.\u0275fac=function(e){return new(e||Ue)},Ue.\u0275cmp=F({type:Ue,selectors:[["app-reset-password"]],decls:3,vars:1,consts:[["emailErrorTpl",""],[1,"main"],["nzTitle","\u91CD\u8A2D\u5BC6\u78BC",1,"reset-password-card"],[1,"reset-success-card"],["nzType","warning","nzMessage","Firebase \u8A8D\u8B49\u529F\u80FD\u672A\u555F\u7528","nzDescription","\u8ACB\u806F\u7E6B\u7BA1\u7406\u54E1\u555F\u7528 Firebase \u8A8D\u8B49\u529F\u80FD","nzShowIcon","",1,"mb-lg"],["nz-form","",1,"reset-password-form",3,"formGroup"],["nz-form","",1,"reset-password-form",3,"ngSubmit","formGroup"],["nzType","error","nzShowIcon","","nzCloseable","",1,"mb-lg",3,"nzMessage"],[1,"form-description","mb-lg"],["nzType","info","nzMessage","\u5FD8\u8A18\u5BC6\u78BC\uFF1F","nzDescription","\u8ACB\u8F38\u5165\u60A8\u7684 Email \u5730\u5740\uFF0C\u6211\u5011\u5C07\u767C\u9001\u5BC6\u78BC\u91CD\u8A2D\u9023\u7D50\u5230\u60A8\u7684\u4FE1\u7BB1","nzShowIcon",""],["nzRequired","",3,"nzSpan"],["nzHasFeedback","",3,"nzSpan","nzErrorTip"],["nz-input","","type","email","formControlName","email","placeholder","\u8ACB\u8F38\u5165\u60A8\u7684 Email \u5730\u5740",3,"disabled"],[3,"nzOffset","nzSpan"],["nz-button","","nzType","primary","nzSize","large","nzBlock","",1,"reset-btn",3,"nzLoading","disabled"],["nz-button","","nzType","link","nzBlock","","routerLink","/passport/login"],["nz-icon","","nzType","arrow-left"],["nzType","error","nzShowIcon","","nzCloseable","",1,"mb-lg",3,"nzOnClose","nzMessage"],["nzStatus","success","nzTitle","\u5BC6\u78BC\u91CD\u8A2D\u4FE1\u5DF2\u767C\u9001",1,"reset-success-result",3,"nzSubTitle"],["nz-result-extra",""],["nz-button","","nzType","primary",1,"mr-sm",3,"click"],["nz-icon","","nzType","login"],["nz-button","","nzType","default",3,"click","nzLoading","disabled"],["nz-icon","","nzType","reload"],["nz-button","","nzType","link",3,"click","disabled"],["nzType","error","nzShowIcon","","nzCloseable","",1,"mt-lg",3,"nzMessage"],[1,"additional-info","mt-lg"],["nzType","info","nzMessage","\u6CE8\u610F\u4E8B\u9805","nzDescription","\u5982\u679C\u60A8\u6C92\u6709\u6536\u5230\u91CD\u8A2D\u4FE1\uFF0C\u8ACB\u6AA2\u67E5\u5783\u573E\u4FE1\u4EF6\u5323\uFF0C\u6216\u78BA\u8A8D Email \u5730\u5740\u662F\u5426\u6B63\u78BA\u3002\u91CD\u8A2D\u9023\u7D50\u5C07\u5728 1 \u5C0F\u6642\u5F8C\u5931\u6548\u3002","nzShowIcon",""],["nzType","error","nzShowIcon","","nzCloseable","",1,"mt-lg",3,"nzOnClose","nzMessage"]],template:function(e,i){e&1&&(r(0,"div",1),d(1,si,3,1,"nz-card",2)(2,ui,14,5,"nz-card",3),s()),e&2&&(o(),g(i.success()?2:1))},dependencies:[$,q,V,R,G,W,j,ae,ne,te,O,B,N,T,ee,X,Y,Q,J,de,Z,K,H,fe,ge,ue,le,pe,tt,et,Ze,U],styles:["[_nghost-%COMP%]{display:block;width:100%;max-width:500px;margin:0 auto;padding:24px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .reset-password-card[_ngcontent-%COMP%], [_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .reset-success-card[_ngcontent-%COMP%]{box-shadow:0 2px 8px #0000001a;border-radius:8px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .reset-password-card[_ngcontent-%COMP%]   .reset-password-form[_ngcontent-%COMP%]   .form-description[_ngcontent-%COMP%], [_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .reset-success-card[_ngcontent-%COMP%]   .reset-password-form[_ngcontent-%COMP%]   .form-description[_ngcontent-%COMP%]{margin-bottom:24px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .reset-password-card[_ngcontent-%COMP%]   .reset-password-form[_ngcontent-%COMP%]   .reset-btn[_ngcontent-%COMP%], [_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .reset-success-card[_ngcontent-%COMP%]   .reset-password-form[_ngcontent-%COMP%]   .reset-btn[_ngcontent-%COMP%]{height:40px;font-size:16px}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .reset-password-card[_ngcontent-%COMP%]   .reset-success-result[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%], [_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .reset-success-card[_ngcontent-%COMP%]   .reset-success-result[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%]{text-align:left}[data-theme=dark]   [_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .reset-password-card[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .main[_ngcontent-%COMP%]   .reset-success-card[_ngcontent-%COMP%]{background:#ffffff05}"],changeDetection:0});var ct=Ue;var Oa=[{path:"passport",component:Vt,children:[{path:"login",component:ot,data:{title:"\u767B\u5F55",titleI18n:"app.login.login"}},{path:"register",component:st,data:{title:"\u6CE8\u518C",titleI18n:"app.register.register"}},{path:"register-result",component:lt,data:{title:"\u6CE8\u518C\u7ED3\u679C",titleI18n:"app.register.register"}},{path:"lock",component:it,data:{title:"\u9501\u5C4F",titleI18n:"app.lock"}},{path:"anonymous-login",component:ut,data:{title:"\u533F\u540D\u767B\u5165",titleI18n:"app.anonymous.login"}},{path:"update-email",component:mt,data:{title:"\u66F4\u65B0 Email",titleI18n:"app.update.email"}},{path:"update-password",component:pt,data:{title:"\u66F4\u65B0\u5BC6\u78BC",titleI18n:"app.update.password"}},{path:"reset-password",component:ct,data:{title:"\u91CD\u8A2D\u5BC6\u78BC",titleI18n:"app.reset.password"}}]},{path:"passport/callback/:type",component:nt}];export{Oa as routes};
