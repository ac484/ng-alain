import{a as Ft,b as xt}from"./chunk-7PKKI65M.js";import{a as vt,b as St,c as Et,d as bt,e as gt}from"./chunk-32Q7LHU2.js";import{a as Ct,b as yt}from"./chunk-WI4YJNHT.js";import{d as G}from"./chunk-I6MSQJS7.js";import{f as lt,k as pt}from"./chunk-FPG4ASQT.js";import{a as zt,b as ft}from"./chunk-UISNCUF7.js";import"./chunk-RWUY3PX4.js";import{a as ct,f as st,k as dt}from"./chunk-TVYOEXTX.js";import{c as nt,f as it,h as rt,j as ot,k as at,l as ut,n as mt}from"./chunk-DFOW3BP5.js";import"./chunk-XQMNUNJZ.js";import"./chunk-7GCD3IKE.js";import"./chunk-QZKV2X75.js";import"./chunk-N3P2RAHG.js";import{b as Z,c as tt,d as et}from"./chunk-RFEAFLG6.js";import"./chunk-3QV2XEN4.js";import"./chunk-V7W2YB3C.js";import{A as U,d as L,e as v,g as q,h as H,n as W,q as J,t as K,y as Q}from"./chunk-KCPTBVPO.js";import{a as X,b as Y}from"./chunk-4TZKWAFB.js";import"./chunk-OMBBB7TF.js";import{i as w,m as M}from"./chunk-4L25UY2X.js";import"./chunk-7WVDW26S.js";import{f as Bt,g as At}from"./chunk-37ZXM2UF.js";import"./chunk-QXG4725B.js";import"./chunk-DT2Q7IUM.js";import"./chunk-FJOG3CU4.js";import{a as R,b as $,d as O,e as j}from"./chunk-BNAQB2MZ.js";import"./chunk-HWF6FYHK.js";import"./chunk-PUUSVCLO.js";import"./chunk-EEPRF6NY.js";import"./chunk-QM34FJQM.js";import{i as V,j as k}from"./chunk-DJZKKPQ6.js";import{Ed as D,Fc as g,Hd as P,Id as I,Kc as E,Mb as o,Mc as _,Nb as e,Nc as B,Ob as t,Pb as y,Wb as b,Yd as T,Zb as d,ab as n,ac as f,fb as z,kc as h,mb as F,pc as i,qc as S,rc as p,sb as x,xa as c,ya as s,yd as N}from"./chunk-ZCVGAUU7.js";import"./chunk-57BLH6QZ.js";var _t=()=>[],Nt=()=>({minRows:3,maxRows:5});function Dt(A,u){if(A&1){let r=b();e(0,"tr")(1,"td"),i(2),t(),e(3,"td"),i(4),E(5,"currency"),t(),e(6,"td"),y(7,"nz-progress",26),e(8,"span",27),i(9),t()(),e(10,"td")(11,"nz-tag",28),i(12),t()(),e(13,"td")(14,"nz-tag",28),i(15),t()(),e(16,"td"),i(17),E(18,"date"),t(),e(19,"td")(20,"nz-space")(21,"button",29),d("click",function(){let m=c(r).$implicit,l=f();return s(l.updatePaymentStatus(m,"submitted"))}),i(22," \u9001\u51FA "),t(),e(23,"button",30),d("click",function(){let m=c(r).$implicit,l=f();return s(l.updatePaymentStatus(m,"reviewing"))}),i(24," \u5BE9\u67E5 "),t(),e(25,"button",30),d("click",function(){let m=c(r).$implicit,l=f();return s(l.updatePaymentStatus(m,"invoiced"))}),i(26," \u958B\u7968 "),t(),e(27,"button",30),d("click",function(){let m=c(r).$implicit,l=f();return s(l.updatePaymentStatus(m,"completed"))}),i(28," \u5B8C\u6210 "),t()()()()}if(A&2){let r=u.$implicit,a=f();n(2),S(r.round),n(2),S(B(5,15,r.amount,"TWD","symbol","1.0-0")),n(3),o("nzPercent",r.progress)("nzSize","small")("nzShowInfo",!1),n(2),p("",r.progress,"%"),n(2),o("nzColor",a.getPaymentStatusColor(r.paymentStatus)),n(),p(" ",a.getPaymentStatusText(r.paymentStatus)," "),n(2),o("nzColor",r.status==="paid"?"success":"processing"),n(),p(" ",r.status==="paid"?"\u5DF2\u4ED8\u6B3E":"\u5F85\u4ED8\u6B3E"," "),n(2),S(_(18,20,r.date,"yyyy-MM-dd")),n(4),o("disabled",r.paymentStatus!=="draft"),n(2),o("disabled",r.paymentStatus!=="submitted"),n(2),o("disabled",r.paymentStatus!=="reviewing"),n(2),o("disabled",r.paymentStatus!=="invoiced")}}var C=class C{constructor(u,r,a,m,l){this.fb=u;this.route=r;this.router=a;this.message=m;this.http=l;this.paymentForm=this.fb.group({round:[null,[v.required]],amount:[null,[v.required,v.min(0)]],date:[null,[v.required]],description:[""]})}ngOnInit(){this.contractId=this.route.snapshot.paramMap.get("id")||void 0,this.contractId&&this.loadContractData()}loadContractData(){this.http.get(`/contract/${this.contractId}`).subscribe(u=>{this.contract=u})}requestPayment(u){this.message.info(`\u8ACB\u6B3E\u7B2C${u.round}\u8F2A\uFF0C\u91D1\u984D\uFF1A${u.amount}`)}onSubmit(){if(this.paymentForm.valid){let u=this.paymentForm.value;this.http.post(`/contract/${this.contractId}/payment`,u).subscribe(()=>{this.message.success("\u8ACB\u6B3E\u63D0\u4EA4\u6210\u529F"),this.loadContractData(),this.paymentForm.reset()})}else Object.values(this.paymentForm.controls).forEach(u=>{u.invalid&&u.markAsTouched()})}onCancel(){this.router.navigate(["/contract/detail",this.contractId])}getPaymentStatusColor(u){switch(u){case"draft":return"default";case"submitted":return"processing";case"reviewing":return"warning";case"invoiced":return"blue";case"completed":return"success";default:return"default"}}getPaymentStatusText(u){switch(u){case"draft":return"\u8349\u7A3F";case"submitted":return"\u9001\u51FA";case"reviewing":return"\u5BE9\u67E5";case"invoiced":return"\u958B\u7968";case"completed":return"\u5B8C\u6210";default:return"\u672A\u77E5"}}updatePaymentStatus(u,r){this.http.post(`/contract/${this.contractId}/payment-status`,{round:u.round,status:r}).subscribe(()=>{this.message.success(`\u8ACB\u6B3E\u72C0\u614B\u5DF2\u66F4\u65B0\u70BA\uFF1A${this.getPaymentStatusText(r)}`),this.loadContractData()})}};C.\u0275fac=function(r){return new(r||C)(z(Q),z(w),z(M),z(G),z(T))},C.\u0275cmp=F({type:C,selectors:[["app-contract-payment"]],decls:75,vars:30,consts:[["paymentTable",""],["title","\u5408\u7D04\u8ACB\u6B3E"],["title","\u5408\u7D04\u8CC7\u8A0A",2,"margin-bottom","16px",3,"nzSize"],[2,"display","grid","grid-template-columns","1fr 1fr","gap","16px"],["title","\u8ACB\u6B3E\u8F2A\u6B21",2,"margin-bottom","16px"],[3,"nzData","nzPageSize"],[4,"ngFor","ngForOf"],["title","\u65B0\u589E\u8ACB\u6B3E"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","",3,"nzSpan"],["nzErrorTip","\u8ACB\u9078\u64C7\u8ACB\u6B3E\u8F2A\u6B21",3,"nzSpan"],["formControlName","round","placeholder","\u8ACB\u9078\u64C7\u8ACB\u6B3E\u8F2A\u6B21"],["nzValue","1","nzLabel","\u7B2C1\u8F2A"],["nzValue","2","nzLabel","\u7B2C2\u8F2A"],["nzValue","3","nzLabel","\u7B2C3\u8F2A"],["nzValue","4","nzLabel","\u7B2C4\u8F2A"],["nzValue","5","nzLabel","\u7B2C5\u8F2A"],["nzErrorTip","\u8ACB\u8F38\u5165\u8ACB\u6B3E\u91D1\u984D",3,"nzSpan"],["formControlName","amount","placeholder","\u8ACB\u8F38\u5165\u8ACB\u6B3E\u91D1\u984D",2,"width","100%",3,"nzMin","nzStep"],["nzErrorTip","\u8ACB\u9078\u64C7\u8ACB\u6B3E\u65E5\u671F",3,"nzSpan"],["formControlName","date","placeholder","\u8ACB\u9078\u64C7\u8ACB\u6B3E\u65E5\u671F",2,"width","100%"],[3,"nzSpan"],["nz-input","","formControlName","description","placeholder","\u8ACB\u8F38\u5165\u8ACB\u6B3E\u8AAA\u660E",3,"nzAutosize"],[3,"nzOffset","nzSpan"],["nz-button","","nzType","primary","type","submit",3,"disabled"],["nz-button","",2,"margin-left","8px",3,"click"],[3,"nzPercent","nzSize","nzShowInfo"],[2,"font-size","12px","color","#666"],[3,"nzColor"],["nz-button","","nzType","primary","nzSize","small",3,"click","disabled"],["nz-button","","nzType","default","nzSize","small",3,"click","disabled"]],template:function(r,a){if(r&1){let m=b();e(0,"nz-card",1)(1,"nz-card",2)(2,"div",3)(3,"div")(4,"strong"),i(5,"\u5408\u7D04\u6A19\u984C\uFF1A"),t(),i(6),t(),e(7,"div")(8,"strong"),i(9,"\u5BA2\u6236\uFF1A"),t(),i(10),t(),e(11,"div")(12,"strong"),i(13,"\u73FE\u884C\u91D1\u984D\uFF1A"),t(),i(14),E(15,"currency"),t(),e(16,"div")(17,"strong"),i(18,"\u9032\u5EA6\uFF1A"),t(),i(19),t()()(),e(20,"nz-card",4)(21,"nz-table",5,0)(23,"thead")(24,"tr")(25,"th"),i(26,"\u8F2A\u6B21"),t(),e(27,"th"),i(28,"\u91D1\u984D"),t(),e(29,"th"),i(30,"\u9032\u5EA6"),t(),e(31,"th"),i(32,"\u8ACB\u6B3E\u72C0\u614B"),t(),e(33,"th"),i(34,"\u4ED8\u6B3E\u72C0\u614B"),t(),e(35,"th"),i(36,"\u65E5\u671F"),t(),e(37,"th"),i(38,"\u64CD\u4F5C"),t()()(),e(39,"tbody"),x(40,Dt,29,23,"tr",6),t()()(),e(41,"nz-card",7)(42,"form",8),d("ngSubmit",function(){return c(m),s(a.onSubmit())}),e(43,"nz-form-item")(44,"nz-form-label",9),i(45,"\u8ACB\u6B3E\u8F2A\u6B21"),t(),e(46,"nz-form-control",10)(47,"nz-select",11),y(48,"nz-option",12)(49,"nz-option",13)(50,"nz-option",14)(51,"nz-option",15)(52,"nz-option",16),t()()(),e(53,"nz-form-item")(54,"nz-form-label",9),i(55,"\u8ACB\u6B3E\u91D1\u984D"),t(),e(56,"nz-form-control",17),y(57,"nz-input-number",18),t()(),e(58,"nz-form-item")(59,"nz-form-label",9),i(60,"\u8ACB\u6B3E\u65E5\u671F"),t(),e(61,"nz-form-control",19),y(62,"nz-date-picker",20),t()(),e(63,"nz-form-item")(64,"nz-form-label",21),i(65,"\u8ACB\u6B3E\u8AAA\u660E"),t(),e(66,"nz-form-control",21)(67,"textarea",22),i(68,"              "),t()()(),e(69,"nz-form-item")(70,"nz-form-control",23)(71,"button",24),i(72," \u63D0\u4EA4\u8ACB\u6B3E "),t(),e(73,"button",25),d("click",function(){return c(m),s(a.onCancel())}),i(74," \u53D6\u6D88 "),t()()()()()()}if(r&2){let m=h(22);n(),o("nzSize","small"),n(5),p("",a.contract==null?null:a.contract.title," "),n(4),p("",a.contract==null?null:a.contract.client," "),n(4),p("",B(15,23,a.contract==null?null:a.contract.currentAmount,"TWD","symbol","1.0-0")," "),n(5),p("",a.contract==null?null:a.contract.progress,"% "),n(2),o("nzData",(a.contract==null?null:a.contract.paymentRounds)||g(28,_t))("nzPageSize",5),n(19),o("ngForOf",m.data),n(2),o("formGroup",a.paymentForm),n(2),o("nzSpan",4),n(2),o("nzSpan",20),n(8),o("nzSpan",4),n(2),o("nzSpan",20),n(),o("nzMin",0)("nzStep",1e3),n(2),o("nzSpan",4),n(2),o("nzSpan",20),n(3),o("nzSpan",4),n(2),o("nzSpan",20),n(),o("nzAutosize",g(29,Nt)),n(3),o("nzOffset",4)("nzSpan",20),n(),o("disabled",!a.paymentForm.valid)}},dependencies:[I,N,U,W,L,q,H,J,K,gt,yt,Ct,St,vt,bt,Et,dt,st,ct,ft,zt,pt,lt,et,Z,tt,j,O,R,$,At,Bt,mt,ot,nt,it,ut,rt,at,Y,X,xt,Ft,k,V,P,D],encapsulation:2});var ht=C;export{ht as ContractPaymentComponent};
