import{a as za,b as Od,c as Ga,d as Md,e as q,f as Ld,g as qd,k as Ud,p as Bd}from"./chunk-AF73PXIT.js";import{F as pt,G as Vd,H as Yt,I as Cd,L as Dd,M as $a,N as xd,O as Nd,P as kd,R as Fd,T as qn,c as Ed,e as Ad,h as Ti,i as Ua,j as Sd,k as bd,l as ts,r as Ba,s as ja,t as Rd,w as Pd,z as Ln}from"./chunk-LRIKAP6Q.js";import{B as on,Fa as vd,Hb as Id,J as hd,M as La,Pa as Zr,Q as dd,Qb as Td,V as fd,W as md,aa as gd,ba as qa,c as Ma,d as ld,fa as pd,qa as yd,sa as _d,u as Ii,va as wd}from"./chunk-ARNVYSUA.js";import{h as Oa,i as V}from"./chunk-57BLH6QZ.js";var jd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$d={};var de,Ka;(function(){var r;function t(v,y){function w(){}w.prototype=y.prototype,v.D=y.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(I,T,b){for(var _=Array(arguments.length-2),ce=2;ce<arguments.length;ce++)_[ce-2]=arguments[ce];return y.prototype[T].apply(I,_)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,y,w){w||(w=0);var I=Array(16);if(typeof y=="string")for(var T=0;16>T;++T)I[T]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(T=0;16>T;++T)I[T]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=v.g[0],w=v.g[1],T=v.g[2];var b=v.g[3],_=y+(b^w&(T^b))+I[0]+3614090360&4294967295;y=w+(_<<7&4294967295|_>>>25),_=b+(T^y&(w^T))+I[1]+3905402710&4294967295,b=y+(_<<12&4294967295|_>>>20),_=T+(w^b&(y^w))+I[2]+606105819&4294967295,T=b+(_<<17&4294967295|_>>>15),_=w+(y^T&(b^y))+I[3]+3250441966&4294967295,w=T+(_<<22&4294967295|_>>>10),_=y+(b^w&(T^b))+I[4]+4118548399&4294967295,y=w+(_<<7&4294967295|_>>>25),_=b+(T^y&(w^T))+I[5]+1200080426&4294967295,b=y+(_<<12&4294967295|_>>>20),_=T+(w^b&(y^w))+I[6]+2821735955&4294967295,T=b+(_<<17&4294967295|_>>>15),_=w+(y^T&(b^y))+I[7]+4249261313&4294967295,w=T+(_<<22&4294967295|_>>>10),_=y+(b^w&(T^b))+I[8]+1770035416&4294967295,y=w+(_<<7&4294967295|_>>>25),_=b+(T^y&(w^T))+I[9]+2336552879&4294967295,b=y+(_<<12&4294967295|_>>>20),_=T+(w^b&(y^w))+I[10]+4294925233&4294967295,T=b+(_<<17&4294967295|_>>>15),_=w+(y^T&(b^y))+I[11]+2304563134&4294967295,w=T+(_<<22&4294967295|_>>>10),_=y+(b^w&(T^b))+I[12]+1804603682&4294967295,y=w+(_<<7&4294967295|_>>>25),_=b+(T^y&(w^T))+I[13]+4254626195&4294967295,b=y+(_<<12&4294967295|_>>>20),_=T+(w^b&(y^w))+I[14]+2792965006&4294967295,T=b+(_<<17&4294967295|_>>>15),_=w+(y^T&(b^y))+I[15]+1236535329&4294967295,w=T+(_<<22&4294967295|_>>>10),_=y+(T^b&(w^T))+I[1]+4129170786&4294967295,y=w+(_<<5&4294967295|_>>>27),_=b+(w^T&(y^w))+I[6]+3225465664&4294967295,b=y+(_<<9&4294967295|_>>>23),_=T+(y^w&(b^y))+I[11]+643717713&4294967295,T=b+(_<<14&4294967295|_>>>18),_=w+(b^y&(T^b))+I[0]+3921069994&4294967295,w=T+(_<<20&4294967295|_>>>12),_=y+(T^b&(w^T))+I[5]+3593408605&4294967295,y=w+(_<<5&4294967295|_>>>27),_=b+(w^T&(y^w))+I[10]+38016083&4294967295,b=y+(_<<9&4294967295|_>>>23),_=T+(y^w&(b^y))+I[15]+3634488961&4294967295,T=b+(_<<14&4294967295|_>>>18),_=w+(b^y&(T^b))+I[4]+3889429448&4294967295,w=T+(_<<20&4294967295|_>>>12),_=y+(T^b&(w^T))+I[9]+568446438&4294967295,y=w+(_<<5&4294967295|_>>>27),_=b+(w^T&(y^w))+I[14]+3275163606&4294967295,b=y+(_<<9&4294967295|_>>>23),_=T+(y^w&(b^y))+I[3]+4107603335&4294967295,T=b+(_<<14&4294967295|_>>>18),_=w+(b^y&(T^b))+I[8]+1163531501&4294967295,w=T+(_<<20&4294967295|_>>>12),_=y+(T^b&(w^T))+I[13]+2850285829&4294967295,y=w+(_<<5&4294967295|_>>>27),_=b+(w^T&(y^w))+I[2]+4243563512&4294967295,b=y+(_<<9&4294967295|_>>>23),_=T+(y^w&(b^y))+I[7]+1735328473&4294967295,T=b+(_<<14&4294967295|_>>>18),_=w+(b^y&(T^b))+I[12]+2368359562&4294967295,w=T+(_<<20&4294967295|_>>>12),_=y+(w^T^b)+I[5]+4294588738&4294967295,y=w+(_<<4&4294967295|_>>>28),_=b+(y^w^T)+I[8]+2272392833&4294967295,b=y+(_<<11&4294967295|_>>>21),_=T+(b^y^w)+I[11]+1839030562&4294967295,T=b+(_<<16&4294967295|_>>>16),_=w+(T^b^y)+I[14]+4259657740&4294967295,w=T+(_<<23&4294967295|_>>>9),_=y+(w^T^b)+I[1]+2763975236&4294967295,y=w+(_<<4&4294967295|_>>>28),_=b+(y^w^T)+I[4]+1272893353&4294967295,b=y+(_<<11&4294967295|_>>>21),_=T+(b^y^w)+I[7]+4139469664&4294967295,T=b+(_<<16&4294967295|_>>>16),_=w+(T^b^y)+I[10]+3200236656&4294967295,w=T+(_<<23&4294967295|_>>>9),_=y+(w^T^b)+I[13]+681279174&4294967295,y=w+(_<<4&4294967295|_>>>28),_=b+(y^w^T)+I[0]+3936430074&4294967295,b=y+(_<<11&4294967295|_>>>21),_=T+(b^y^w)+I[3]+3572445317&4294967295,T=b+(_<<16&4294967295|_>>>16),_=w+(T^b^y)+I[6]+76029189&4294967295,w=T+(_<<23&4294967295|_>>>9),_=y+(w^T^b)+I[9]+3654602809&4294967295,y=w+(_<<4&4294967295|_>>>28),_=b+(y^w^T)+I[12]+3873151461&4294967295,b=y+(_<<11&4294967295|_>>>21),_=T+(b^y^w)+I[15]+530742520&4294967295,T=b+(_<<16&4294967295|_>>>16),_=w+(T^b^y)+I[2]+3299628645&4294967295,w=T+(_<<23&4294967295|_>>>9),_=y+(T^(w|~b))+I[0]+4096336452&4294967295,y=w+(_<<6&4294967295|_>>>26),_=b+(w^(y|~T))+I[7]+1126891415&4294967295,b=y+(_<<10&4294967295|_>>>22),_=T+(y^(b|~w))+I[14]+2878612391&4294967295,T=b+(_<<15&4294967295|_>>>17),_=w+(b^(T|~y))+I[5]+4237533241&4294967295,w=T+(_<<21&4294967295|_>>>11),_=y+(T^(w|~b))+I[12]+1700485571&4294967295,y=w+(_<<6&4294967295|_>>>26),_=b+(w^(y|~T))+I[3]+2399980690&4294967295,b=y+(_<<10&4294967295|_>>>22),_=T+(y^(b|~w))+I[10]+4293915773&4294967295,T=b+(_<<15&4294967295|_>>>17),_=w+(b^(T|~y))+I[1]+2240044497&4294967295,w=T+(_<<21&4294967295|_>>>11),_=y+(T^(w|~b))+I[8]+1873313359&4294967295,y=w+(_<<6&4294967295|_>>>26),_=b+(w^(y|~T))+I[15]+4264355552&4294967295,b=y+(_<<10&4294967295|_>>>22),_=T+(y^(b|~w))+I[6]+2734768916&4294967295,T=b+(_<<15&4294967295|_>>>17),_=w+(b^(T|~y))+I[13]+1309151649&4294967295,w=T+(_<<21&4294967295|_>>>11),_=y+(T^(w|~b))+I[4]+4149444226&4294967295,y=w+(_<<6&4294967295|_>>>26),_=b+(w^(y|~T))+I[11]+3174756917&4294967295,b=y+(_<<10&4294967295|_>>>22),_=T+(y^(b|~w))+I[2]+718787259&4294967295,T=b+(_<<15&4294967295|_>>>17),_=w+(b^(T|~y))+I[9]+3951481745&4294967295,v.g[0]=v.g[0]+y&4294967295,v.g[1]=v.g[1]+(T+(_<<21&4294967295|_>>>11))&4294967295,v.g[2]=v.g[2]+T&4294967295,v.g[3]=v.g[3]+b&4294967295}n.prototype.u=function(v,y){y===void 0&&(y=v.length);for(var w=y-this.blockSize,I=this.B,T=this.h,b=0;b<y;){if(T==0)for(;b<=w;)s(this,v,b),b+=this.blockSize;if(typeof v=="string"){for(;b<y;)if(I[T++]=v.charCodeAt(b++),T==this.blockSize){s(this,I),T=0;break}}else for(;b<y;)if(I[T++]=v[b++],T==this.blockSize){s(this,I),T=0;break}}this.h=T,this.o+=y},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var y=1;y<v.length-8;++y)v[y]=0;var w=8*this.o;for(y=v.length-8;y<v.length;++y)v[y]=w&255,w/=256;for(this.u(v),v=Array(16),y=w=0;4>y;++y)for(var I=0;32>I;I+=8)v[w++]=this.g[y]>>>I&255;return v};function i(v,y){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=y(v)}function a(v,y){this.h=y;for(var w=[],I=!0,T=v.length-1;0<=T;T--){var b=v[T]|0;I&&b==y||(w[T]=b,I=!1)}this.g=w}var u={};function c(v){return-128<=v&&128>v?i(v,function(y){return new a([y|0],0>y?-1:0)}):new a([v|0],0>v?-1:0)}function h(v){if(isNaN(v)||!isFinite(v))return m;if(0>v)return N(h(-v));for(var y=[],w=1,I=0;v>=w;I++)y[I]=v/w|0,w*=4294967296;return new a(y,0)}function f(v,y){if(v.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(v.charAt(0)=="-")return N(f(v.substring(1),y));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=h(Math.pow(y,8)),I=m,T=0;T<v.length;T+=8){var b=Math.min(8,v.length-T),_=parseInt(v.substring(T,T+b),y);8>b?(b=h(Math.pow(y,b)),I=I.j(b).add(h(_))):(I=I.j(w),I=I.add(h(_)))}return I}var m=c(0),p=c(1),A=c(16777216);r=a.prototype,r.m=function(){if(x(this))return-N(this).m();for(var v=0,y=1,w=0;w<this.g.length;w++){var I=this.i(w);v+=(0<=I?I:4294967296+I)*y,y*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(C(this))return"0";if(x(this))return"-"+N(this).toString(v);for(var y=h(Math.pow(v,6)),w=this,I="";;){var T=W(w,y).g;w=U(w,T.j(y));var b=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=T,C(w))return b+I;for(;6>b.length;)b="0"+b;I=b+I}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function C(v){if(v.h!=0)return!1;for(var y=0;y<v.g.length;y++)if(v.g[y]!=0)return!1;return!0}function x(v){return v.h==-1}r.l=function(v){return v=U(this,v),x(v)?-1:C(v)?0:1};function N(v){for(var y=v.g.length,w=[],I=0;I<y;I++)w[I]=~v.g[I];return new a(w,~v.h).add(p)}r.abs=function(){return x(this)?N(this):this},r.add=function(v){for(var y=Math.max(this.g.length,v.g.length),w=[],I=0,T=0;T<=y;T++){var b=I+(this.i(T)&65535)+(v.i(T)&65535),_=(b>>>16)+(this.i(T)>>>16)+(v.i(T)>>>16);I=_>>>16,b&=65535,_&=65535,w[T]=_<<16|b}return new a(w,w[w.length-1]&-2147483648?-1:0)};function U(v,y){return v.add(N(y))}r.j=function(v){if(C(this)||C(v))return m;if(x(this))return x(v)?N(this).j(N(v)):N(N(this).j(v));if(x(v))return N(this.j(N(v)));if(0>this.l(A)&&0>v.l(A))return h(this.m()*v.m());for(var y=this.g.length+v.g.length,w=[],I=0;I<2*y;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<v.g.length;T++){var b=this.i(I)>>>16,_=this.i(I)&65535,ce=v.i(T)>>>16,kr=v.i(T)&65535;w[2*I+2*T]+=_*kr,$(w,2*I+2*T),w[2*I+2*T+1]+=b*kr,$(w,2*I+2*T+1),w[2*I+2*T+1]+=_*ce,$(w,2*I+2*T+1),w[2*I+2*T+2]+=b*ce,$(w,2*I+2*T+2)}for(I=0;I<y;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=y;I<2*y;I++)w[I]=0;return new a(w,0)};function $(v,y){for(;(v[y]&65535)!=v[y];)v[y+1]+=v[y]>>>16,v[y]&=65535,y++}function j(v,y){this.g=v,this.h=y}function W(v,y){if(C(y))throw Error("division by zero");if(C(v))return new j(m,m);if(x(v))return y=W(N(v),y),new j(N(y.g),N(y.h));if(x(y))return y=W(v,N(y)),new j(N(y.g),y.h);if(30<v.g.length){if(x(v)||x(y))throw Error("slowDivide_ only works with positive integers.");for(var w=p,I=y;0>=I.l(v);)w=tt(w),I=tt(I);var T=Q(w,1),b=Q(I,1);for(I=Q(I,2),w=Q(w,2);!C(I);){var _=b.add(I);0>=_.l(v)&&(T=T.add(w),b=_),I=Q(I,1),w=Q(w,1)}return y=U(v,T.j(y)),new j(T,y)}for(T=m;0<=v.l(y);){for(w=Math.max(1,Math.floor(v.m()/y.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),b=h(w),_=b.j(y);x(_)||0<_.l(v);)w-=I,b=h(w),_=b.j(y);C(b)&&(b=p),T=T.add(b),v=U(v,_)}return new j(T,v)}r.A=function(v){return W(this,v).h},r.and=function(v){for(var y=Math.max(this.g.length,v.g.length),w=[],I=0;I<y;I++)w[I]=this.i(I)&v.i(I);return new a(w,this.h&v.h)},r.or=function(v){for(var y=Math.max(this.g.length,v.g.length),w=[],I=0;I<y;I++)w[I]=this.i(I)|v.i(I);return new a(w,this.h|v.h)},r.xor=function(v){for(var y=Math.max(this.g.length,v.g.length),w=[],I=0;I<y;I++)w[I]=this.i(I)^v.i(I);return new a(w,this.h^v.h)};function tt(v){for(var y=v.g.length+1,w=[],I=0;I<y;I++)w[I]=v.i(I)<<1|v.i(I-1)>>>31;return new a(w,v.h)}function Q(v,y){var w=y>>5;y%=32;for(var I=v.g.length-w,T=[],b=0;b<I;b++)T[b]=0<y?v.i(b+w)>>>y|v.i(b+w+1)<<32-y:v.i(b+w);return new a(T,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Ka=$d.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,de=$d.Integer=a}).apply(typeof jd<"u"?jd:typeof self<"u"?self:typeof window<"u"?window:{});var Ei=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fe={};var Qa,r_,Un,Wa,es,Ai,Ha,Xa,Ja;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,l,d){return o==Array.prototype||o==Object.prototype||(o[l]=d.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ei=="object"&&Ei];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=e(this);function s(o,l){if(l)t:{var d=n;o=o.split(".");for(var g=0;g<o.length-1;g++){var E=o[g];if(!(E in d))break t;d=d[E]}o=o[o.length-1],g=d[o],l=l(g),l!=g&&l!=null&&t(d,o,{configurable:!0,writable:!0,value:l})}}function i(o,l){o instanceof String&&(o+="");var d=0,g=!1,E={next:function(){if(!g&&d<o.length){var P=d++;return{value:l(P,o[P]),done:!1}}return g=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}s("Array.prototype.values",function(o){return o||function(){return i(this,function(l,d){return d})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return l=l!="object"?l:o?Array.isArray(o)?"array":l:"null",l=="array"||l=="object"&&typeof o.length=="number"}function h(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function f(o,l,d){return o.call.apply(o.bind,arguments)}function m(o,l,d){if(!o)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,g),o.apply(l,E)}}return function(){return o.apply(l,arguments)}}function p(o,l,d){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,p.apply(null,arguments)}function A(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),o.apply(this,g)}}function C(o,l){function d(){}d.prototype=l.prototype,o.aa=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(g,E,P){for(var O=Array(arguments.length-2),st=2;st<arguments.length;st++)O[st-2]=arguments[st];return l.prototype[E].apply(g,O)}}function x(o){let l=o.length;if(0<l){let d=Array(l);for(let g=0;g<l;g++)d[g]=o[g];return d}return[]}function N(o,l){for(let d=1;d<arguments.length;d++){let g=arguments[d];if(c(g)){let E=o.length||0,P=g.length||0;o.length=E+P;for(let O=0;O<P;O++)o[E+O]=g[O]}else o.push(g)}}class U{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function $(o){return/^[\s\xa0]*$/.test(o)}function j(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function W(o){return W[" "](o),o}W[" "]=function(){};var tt=j().indexOf("Gecko")!=-1&&!(j().toLowerCase().indexOf("webkit")!=-1&&j().indexOf("Edge")==-1)&&!(j().indexOf("Trident")!=-1||j().indexOf("MSIE")!=-1)&&j().indexOf("Edge")==-1;function Q(o,l,d){for(let g in o)l.call(d,o[g],g,o)}function v(o,l){for(let d in o)l.call(void 0,o[d],d,o)}function y(o){let l={};for(let d in o)l[d]=o[d];return l}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(o,l){let d,g;for(let E=1;E<arguments.length;E++){g=arguments[E];for(d in g)o[d]=g[d];for(let P=0;P<w.length;P++)d=w[P],Object.prototype.hasOwnProperty.call(g,d)&&(o[d]=g[d])}}function T(o){var l=1;o=o.split(":");let d=[];for(;0<l&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function b(o){u.setTimeout(()=>{throw o},0)}function _(){var o=ha;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class ce{constructor(){this.h=this.g=null}add(l,d){let g=kr.get();g.set(l,d),this.h?this.h.next=g:this.g=g,this.h=g}}var kr=new U(()=>new Ey,o=>o.reset());class Ey{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Fr,Or=!1,ha=new ce,ch=()=>{let o=u.Promise.resolve(void 0);Fr=()=>{o.then(Ay)}};var Ay=()=>{for(var o;o=_();){try{o.h.call(o.g)}catch(d){b(d)}var l=kr;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}Or=!1};function Se(){this.s=this.s,this.C=this.C}Se.prototype.s=!1,Se.prototype.ma=function(){this.s||(this.s=!0,this.N())},Se.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Rt(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Rt.prototype.h=function(){this.defaultPrevented=!0};var Sy=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return o}();function Mr(o,l){if(Rt.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,g=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(tt){t:{try{W(l.nodeName);var E=!0;break t}catch{}E=!1}E||(l=null)}}else d=="mouseover"?l=o.fromElement:d=="mouseout"&&(l=o.toElement);this.relatedTarget=l,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:by[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Mr.aa.h.call(this)}}C(Mr,Rt);var by={2:"touch",3:"pen",4:"mouse"};Mr.prototype.h=function(){Mr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Lr="closure_listenable_"+(1e6*Math.random()|0),Ry=0;function Py(o,l,d,g,E){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!g,this.ha=E,this.key=++Ry,this.da=this.fa=!1}function si(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function ii(o){this.src=o,this.g={},this.h=0}ii.prototype.add=function(o,l,d,g,E){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var O=fa(o,l,g,E);return-1<O?(l=o[O],d||(l.fa=!1)):(l=new Py(l,this.src,P,!!g,E),l.fa=d,o.push(l)),l};function da(o,l){var d=l.type;if(d in o.g){var g=o.g[d],E=Array.prototype.indexOf.call(g,l,void 0),P;(P=0<=E)&&Array.prototype.splice.call(g,E,1),P&&(si(l),o.g[d].length==0&&(delete o.g[d],o.h--))}}function fa(o,l,d,g){for(var E=0;E<o.length;++E){var P=o[E];if(!P.da&&P.listener==l&&P.capture==!!d&&P.ha==g)return E}return-1}var ma="closure_lm_"+(1e6*Math.random()|0),ga={};function lh(o,l,d,g,E){if(g&&g.once)return dh(o,l,d,g,E);if(Array.isArray(l)){for(var P=0;P<l.length;P++)lh(o,l[P],d,g,E);return null}return d=wa(d),o&&o[Lr]?o.K(l,d,h(g)?!!g.capture:!!g,E):hh(o,l,d,!1,g,E)}function hh(o,l,d,g,E,P){if(!l)throw Error("Invalid event type");var O=h(E)?!!E.capture:!!E,st=ya(o);if(st||(o[ma]=st=new ii(o)),d=st.add(l,d,g,O,P),d.proxy)return d;if(g=Vy(),d.proxy=g,g.src=o,g.listener=d,o.addEventListener)Sy||(E=O),E===void 0&&(E=!1),o.addEventListener(l.toString(),g,E);else if(o.attachEvent)o.attachEvent(mh(l.toString()),g);else if(o.addListener&&o.removeListener)o.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Vy(){function o(d){return l.call(o.src,o.listener,d)}let l=Cy;return o}function dh(o,l,d,g,E){if(Array.isArray(l)){for(var P=0;P<l.length;P++)dh(o,l[P],d,g,E);return null}return d=wa(d),o&&o[Lr]?o.L(l,d,h(g)?!!g.capture:!!g,E):hh(o,l,d,!0,g,E)}function fh(o,l,d,g,E){if(Array.isArray(l))for(var P=0;P<l.length;P++)fh(o,l[P],d,g,E);else g=h(g)?!!g.capture:!!g,d=wa(d),o&&o[Lr]?(o=o.i,l=String(l).toString(),l in o.g&&(P=o.g[l],d=fa(P,d,g,E),-1<d&&(si(P[d]),Array.prototype.splice.call(P,d,1),P.length==0&&(delete o.g[l],o.h--)))):o&&(o=ya(o))&&(l=o.g[l.toString()],o=-1,l&&(o=fa(l,d,g,E)),(d=-1<o?l[o]:null)&&pa(d))}function pa(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[Lr])da(l.i,o);else{var d=o.type,g=o.proxy;l.removeEventListener?l.removeEventListener(d,g,o.capture):l.detachEvent?l.detachEvent(mh(d),g):l.addListener&&l.removeListener&&l.removeListener(g),(d=ya(l))?(da(d,o),d.h==0&&(d.src=null,l[ma]=null)):si(o)}}}function mh(o){return o in ga?ga[o]:ga[o]="on"+o}function Cy(o,l){if(o.da)o=!0;else{l=new Mr(l,this);var d=o.listener,g=o.ha||o.src;o.fa&&pa(o),o=d.call(g,l)}return o}function ya(o){return o=o[ma],o instanceof ii?o:null}var _a="__closure_events_fn_"+(1e9*Math.random()>>>0);function wa(o){return typeof o=="function"?o:(o[_a]||(o[_a]=function(l){return o.handleEvent(l)}),o[_a])}function Pt(){Se.call(this),this.i=new ii(this),this.M=this,this.F=null}C(Pt,Se),Pt.prototype[Lr]=!0,Pt.prototype.removeEventListener=function(o,l,d,g){fh(this,o,l,d,g)};function Ft(o,l){var d,g=o.F;if(g)for(d=[];g;g=g.F)d.push(g);if(o=o.M,g=l.type||l,typeof l=="string")l=new Rt(l,o);else if(l instanceof Rt)l.target=l.target||o;else{var E=l;l=new Rt(g,o),I(l,E)}if(E=!0,d)for(var P=d.length-1;0<=P;P--){var O=l.g=d[P];E=oi(O,g,!0,l)&&E}if(O=l.g=o,E=oi(O,g,!0,l)&&E,E=oi(O,g,!1,l)&&E,d)for(P=0;P<d.length;P++)O=l.g=d[P],E=oi(O,g,!1,l)&&E}Pt.prototype.N=function(){if(Pt.aa.N.call(this),this.i){var o=this.i,l;for(l in o.g){for(var d=o.g[l],g=0;g<d.length;g++)si(d[g]);delete o.g[l],o.h--}}this.F=null},Pt.prototype.K=function(o,l,d,g){return this.i.add(String(o),l,!1,d,g)},Pt.prototype.L=function(o,l,d,g){return this.i.add(String(o),l,!0,d,g)};function oi(o,l,d,g){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();for(var E=!0,P=0;P<l.length;++P){var O=l[P];if(O&&!O.da&&O.capture==d){var st=O.listener,bt=O.ha||O.src;O.fa&&da(o.i,O),E=st.call(bt,g)!==!1&&E}}return E&&!g.defaultPrevented}function gh(o,l,d){if(typeof o=="function")d&&(o=p(o,d));else if(o&&typeof o.handleEvent=="function")o=p(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function ph(o){o.g=gh(()=>{o.g=null,o.i&&(o.i=!1,ph(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class Dy extends Se{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:ph(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qr(o){Se.call(this),this.h=o,this.g={}}C(qr,Se);var yh=[];function _h(o){Q(o.g,function(l,d){this.g.hasOwnProperty(d)&&pa(l)},o),o.g={}}qr.prototype.N=function(){qr.aa.N.call(this),_h(this)},qr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var va=u.JSON.stringify,xy=u.JSON.parse,Ny=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Ia(){}Ia.prototype.h=null;function wh(o){return o.h||(o.h=o.i())}function vh(){}var Ur={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ta(){Rt.call(this,"d")}C(Ta,Rt);function Ea(){Rt.call(this,"c")}C(Ea,Rt);var en={},Ih=null;function ai(){return Ih=Ih||new Pt}en.La="serverreachability";function Th(o){Rt.call(this,en.La,o)}C(Th,Rt);function Br(o){let l=ai();Ft(l,new Th(l))}en.STAT_EVENT="statevent";function Eh(o,l){Rt.call(this,en.STAT_EVENT,o),this.stat=l}C(Eh,Rt);function Ot(o){let l=ai();Ft(l,new Eh(l,o))}en.Ma="timingevent";function Ah(o,l){Rt.call(this,en.Ma,o),this.size=l}C(Ah,Rt);function jr(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function $r(){this.g=!0}$r.prototype.xa=function(){this.g=!1};function ky(o,l,d,g,E,P){o.info(function(){if(o.g)if(P)for(var O="",st=P.split("&"),bt=0;bt<st.length;bt++){var Z=st[bt].split("=");if(1<Z.length){var Vt=Z[0];Z=Z[1];var Ct=Vt.split("_");O=2<=Ct.length&&Ct[1]=="type"?O+(Vt+"="+Z+"&"):O+(Vt+"=redacted&")}}else O=null;else O=P;return"XMLHTTP REQ ("+g+") [attempt "+E+"]: "+l+`
`+d+`
`+O})}function Fy(o,l,d,g,E,P,O){o.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+E+"]: "+l+`
`+d+`
`+P+" "+O})}function kn(o,l,d,g){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+My(o,d)+(g?" "+g:"")})}function Oy(o,l){o.info(function(){return"TIMEOUT: "+l})}$r.prototype.info=function(){};function My(o,l){if(!o.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var g=d[o];if(!(2>g.length)){var E=g[1];if(Array.isArray(E)&&!(1>E.length)){var P=E[0];if(P!="noop"&&P!="stop"&&P!="close")for(var O=1;O<E.length;O++)E[O]=""}}}}return va(d)}catch{return l}}var ui={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Sh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Aa;function ci(){}C(ci,Ia),ci.prototype.g=function(){return new XMLHttpRequest},ci.prototype.i=function(){return{}},Aa=new ci;function be(o,l,d,g){this.j=o,this.i=l,this.l=d,this.R=g||1,this.U=new qr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new bh}function bh(){this.i=null,this.g="",this.h=!1}var Rh={},Sa={};function ba(o,l,d){o.L=1,o.v=fi(le(l)),o.m=d,o.P=!0,Ph(o,null)}function Ph(o,l){o.F=Date.now(),li(o),o.A=le(o.v);var d=o.A,g=o.R;Array.isArray(g)||(g=[String(g)]),jh(d.i,"t",g),o.C=0,d=o.j.J,o.h=new bh,o.g=od(o.j,d?l:null,!o.m),0<o.O&&(o.M=new Dy(p(o.Y,o,o.g),o.O)),l=o.U,d=o.g,g=o.ca;var E="readystatechange";Array.isArray(E)||(E&&(yh[0]=E.toString()),E=yh);for(var P=0;P<E.length;P++){var O=lh(d,E[P],g||l.handleEvent,!1,l.h||l);if(!O)break;l.g[O.key]=O}l=o.H?y(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),Br(),ky(o.i,o.u,o.A,o.l,o.R,o.m)}be.prototype.ca=function(o){o=o.target;let l=this.M;l&&he(o)==3?l.j():this.Y(o)},be.prototype.Y=function(o){try{if(o==this.g)t:{let Ct=he(this.g);var l=this.g.Ba();let Mn=this.g.Z();if(!(3>Ct)&&(Ct!=3||this.g&&(this.h.h||this.g.oa()||Hh(this.g)))){this.J||Ct!=4||l==7||(l==8||0>=Mn?Br(3):Br(2)),Ra(this);var d=this.g.Z();this.X=d;e:if(Vh(this)){var g=Hh(this.g);o="";var E=g.length,P=he(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){nn(this),zr(this);var O="";break e}this.h.i=new u.TextDecoder}for(l=0;l<E;l++)this.h.h=!0,o+=this.h.i.decode(g[l],{stream:!(P&&l==E-1)});g.length=0,this.h.g+=o,this.C=0,O=this.h.g}else O=this.g.oa();if(this.o=d==200,Fy(this.i,this.u,this.A,this.l,this.R,Ct,d),this.o){if(this.T&&!this.K){e:{if(this.g){var st,bt=this.g;if((st=bt.g?bt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(st)){var Z=st;break e}}Z=null}if(d=Z)kn(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Pa(this,d);else{this.o=!1,this.s=3,Ot(12),nn(this),zr(this);break t}}if(this.P){d=!0;let Qt;for(;!this.J&&this.C<O.length;)if(Qt=Ly(this,O),Qt==Sa){Ct==4&&(this.s=4,Ot(14),d=!1),kn(this.i,this.l,null,"[Incomplete Response]");break}else if(Qt==Rh){this.s=4,Ot(15),kn(this.i,this.l,O,"[Invalid Chunk]"),d=!1;break}else kn(this.i,this.l,Qt,null),Pa(this,Qt);if(Vh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ct!=4||O.length!=0||this.h.h||(this.s=1,Ot(16),d=!1),this.o=this.o&&d,!d)kn(this.i,this.l,O,"[Invalid Chunked Response]"),nn(this),zr(this);else if(0<O.length&&!this.W){this.W=!0;var Vt=this.j;Vt.g==this&&Vt.ba&&!Vt.M&&(Vt.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),ka(Vt),Vt.M=!0,Ot(11))}}else kn(this.i,this.l,O,null),Pa(this,O);Ct==4&&nn(this),this.o&&!this.J&&(Ct==4?nd(this.j,this):(this.o=!1,li(this)))}else e_(this.g),d==400&&0<O.indexOf("Unknown SID")?(this.s=3,Ot(12)):(this.s=0,Ot(13)),nn(this),zr(this)}}}catch{}finally{}};function Vh(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Ly(o,l){var d=o.C,g=l.indexOf(`
`,d);return g==-1?Sa:(d=Number(l.substring(d,g)),isNaN(d)?Rh:(g+=1,g+d>l.length?Sa:(l=l.slice(g,g+d),o.C=g+d,l)))}be.prototype.cancel=function(){this.J=!0,nn(this)};function li(o){o.S=Date.now()+o.I,Ch(o,o.I)}function Ch(o,l){if(o.B!=null)throw Error("WatchDog timer not null");o.B=jr(p(o.ba,o),l)}function Ra(o){o.B&&(u.clearTimeout(o.B),o.B=null)}be.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Oy(this.i,this.A),this.L!=2&&(Br(),Ot(17)),nn(this),this.s=2,zr(this)):Ch(this,this.S-o)};function zr(o){o.j.G==0||o.J||nd(o.j,o)}function nn(o){Ra(o);var l=o.M;l&&typeof l.ma=="function"&&l.ma(),o.M=null,_h(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function Pa(o,l){try{var d=o.j;if(d.G!=0&&(d.g==o||Va(d.h,o))){if(!o.K&&Va(d.h,o)&&d.G==3){try{var g=d.Da.g.parse(l)}catch{g=null}if(Array.isArray(g)&&g.length==3){var E=g;if(E[0]==0){t:if(!d.u){if(d.g)if(d.g.F+3e3<o.F)_i(d),pi(d);else break t;Na(d),Ot(18)}}else d.za=E[1],0<d.za-d.T&&37500>E[2]&&d.F&&d.v==0&&!d.C&&(d.C=jr(p(d.Za,d),6e3));if(1>=Nh(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else sn(d,11)}else if((o.K||d.g==o)&&_i(d),!$(l))for(E=d.Da.g.parse(l),l=0;l<E.length;l++){let Z=E[l];if(d.T=Z[0],Z=Z[1],d.G==2)if(Z[0]=="c"){d.K=Z[1],d.ia=Z[2];let Vt=Z[3];Vt!=null&&(d.la=Vt,d.j.info("VER="+d.la));let Ct=Z[4];Ct!=null&&(d.Aa=Ct,d.j.info("SVER="+d.Aa));let Mn=Z[5];Mn!=null&&typeof Mn=="number"&&0<Mn&&(g=1.5*Mn,d.L=g,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;let Qt=o.g;if(Qt){let vi=Qt.g?Qt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vi){var P=g.h;P.g||vi.indexOf("spdy")==-1&&vi.indexOf("quic")==-1&&vi.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Ca(P,P.h),P.h=null))}if(g.D){let Fa=Qt.g?Qt.g.getResponseHeader("X-HTTP-Session-Id"):null;Fa&&(g.ya=Fa,it(g.I,g.D,Fa))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms")),g=d;var O=o;if(g.qa=id(g,g.J?g.ia:null,g.W),O.K){kh(g.h,O);var st=O,bt=g.L;bt&&(st.I=bt),st.B&&(Ra(st),li(st)),g.g=O}else td(g);0<d.i.length&&yi(d)}else Z[0]!="stop"&&Z[0]!="close"||sn(d,7);else d.G==3&&(Z[0]=="stop"||Z[0]=="close"?Z[0]=="stop"?sn(d,7):xa(d):Z[0]!="noop"&&d.l&&d.l.ta(Z),d.v=0)}}Br(4)}catch{}}var qy=class{constructor(o,l){this.g=o,this.map=l}};function Dh(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function xh(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Nh(o){return o.h?1:o.g?o.g.size:0}function Va(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function Ca(o,l){o.g?o.g.add(l):o.h=l}function kh(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}Dh.prototype.cancel=function(){if(this.i=Fh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Fh(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let d of o.g.values())l=l.concat(d.D);return l}return x(o.i)}function Uy(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(c(o)){for(var l=[],d=o.length,g=0;g<d;g++)l.push(o[g]);return l}l=[],d=0;for(g in o)l[d++]=o[g];return l}function By(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||typeof o=="string"){var l=[];o=o.length;for(var d=0;d<o;d++)l.push(d);return l}l=[],d=0;for(let g in o)l[d++]=g;return l}}}function Oh(o,l){if(o.forEach&&typeof o.forEach=="function")o.forEach(l,void 0);else if(c(o)||typeof o=="string")Array.prototype.forEach.call(o,l,void 0);else for(var d=By(o),g=Uy(o),E=g.length,P=0;P<E;P++)l.call(void 0,g[P],d&&d[P],o)}var Mh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function jy(o,l){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var g=o[d].indexOf("="),E=null;if(0<=g){var P=o[d].substring(0,g);E=o[d].substring(g+1)}else P=o[d];l(P,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function rn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof rn){this.h=o.h,hi(this,o.j),this.o=o.o,this.g=o.g,di(this,o.s),this.l=o.l;var l=o.i,d=new Qr;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),Lh(this,d),this.m=o.m}else o&&(l=String(o).match(Mh))?(this.h=!1,hi(this,l[1]||"",!0),this.o=Gr(l[2]||""),this.g=Gr(l[3]||"",!0),di(this,l[4]),this.l=Gr(l[5]||"",!0),Lh(this,l[6]||"",!0),this.m=Gr(l[7]||"")):(this.h=!1,this.i=new Qr(null,this.h))}rn.prototype.toString=function(){var o=[],l=this.j;l&&o.push(Kr(l,qh,!0),":");var d=this.g;return(d||l=="file")&&(o.push("//"),(l=this.o)&&o.push(Kr(l,qh,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&o.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(Kr(d,d.charAt(0)=="/"?Gy:zy,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Kr(d,Qy)),o.join("")};function le(o){return new rn(o)}function hi(o,l,d){o.j=d?Gr(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function di(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function Lh(o,l,d){l instanceof Qr?(o.i=l,Wy(o.i,o.h)):(d||(l=Kr(l,Ky)),o.i=new Qr(l,o.h))}function it(o,l,d){o.i.set(l,d)}function fi(o){return it(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Gr(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Kr(o,l,d){return typeof o=="string"?(o=encodeURI(o).replace(l,$y),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function $y(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var qh=/[#\/\?@]/g,zy=/[#\?:]/g,Gy=/[#\?]/g,Ky=/[#\?@]/g,Qy=/#/g;function Qr(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function Re(o){o.g||(o.g=new Map,o.h=0,o.i&&jy(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}r=Qr.prototype,r.add=function(o,l){Re(this),this.i=null,o=Fn(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this};function Uh(o,l){Re(o),l=Fn(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function Bh(o,l){return Re(o),l=Fn(o,l),o.g.has(l)}r.forEach=function(o,l){Re(this),this.g.forEach(function(d,g){d.forEach(function(E){o.call(l,E,g,this)},this)},this)},r.na=function(){Re(this);let o=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let g=0;g<l.length;g++){let E=o[g];for(let P=0;P<E.length;P++)d.push(l[g])}return d},r.V=function(o){Re(this);let l=[];if(typeof o=="string")Bh(this,o)&&(l=l.concat(this.g.get(Fn(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)l=l.concat(o[d])}return l},r.set=function(o,l){return Re(this),this.i=null,o=Fn(this,o),Bh(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o?(o=this.V(o),0<o.length?String(o[0]):l):l};function jh(o,l,d){Uh(o,l),0<d.length&&(o.i=null,o.g.set(Fn(o,l),x(d)),o.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var g=l[d];let P=encodeURIComponent(String(g)),O=this.V(g);for(g=0;g<O.length;g++){var E=P;O[g]!==""&&(E+="="+encodeURIComponent(String(O[g]))),o.push(E)}}return this.i=o.join("&")};function Fn(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Wy(o,l){l&&!o.j&&(Re(o),o.i=null,o.g.forEach(function(d,g){var E=g.toLowerCase();g!=E&&(Uh(this,g),jh(this,E,d))},o)),o.j=l}function Hy(o,l){let d=new $r;if(u.Image){let g=new Image;g.onload=A(Pe,d,"TestLoadImage: loaded",!0,l,g),g.onerror=A(Pe,d,"TestLoadImage: error",!1,l,g),g.onabort=A(Pe,d,"TestLoadImage: abort",!1,l,g),g.ontimeout=A(Pe,d,"TestLoadImage: timeout",!1,l,g),u.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=o}else l(!1)}function Xy(o,l){let d=new $r,g=new AbortController,E=setTimeout(()=>{g.abort(),Pe(d,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:g.signal}).then(P=>{clearTimeout(E),P.ok?Pe(d,"TestPingServer: ok",!0,l):Pe(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(E),Pe(d,"TestPingServer: error",!1,l)})}function Pe(o,l,d,g,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),g(d)}catch{}}function Jy(){this.g=new Ny}function Yy(o,l,d){let g=d||"";try{Oh(o,function(E,P){let O=E;h(E)&&(O=va(E)),l.push(g+P+"="+encodeURIComponent(O))})}catch(E){throw l.push(g+"type="+encodeURIComponent("_badmap")),E}}function Wr(o){this.l=o.Ub||null,this.j=o.eb||!1}C(Wr,Ia),Wr.prototype.g=function(){return new mi(this.l,this.j)},Wr.prototype.i=function(o){return function(){return o}}({});function mi(o,l){Pt.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(mi,Pt),r=mi.prototype,r.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,Xr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Hr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Xr(this)),this.g&&(this.readyState=3,Xr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;$h(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function $h(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Hr(this):Xr(this),this.readyState==3&&$h(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Hr(this))},r.Qa=function(o){this.g&&(this.response=o,Hr(this))},r.ga=function(){this.g&&Hr(this)};function Hr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Xr(o)}r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=l.next();return o.join(`\r
`)};function Xr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(mi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function zh(o){let l="";return Q(o,function(d,g){l+=g,l+=":",l+=d,l+=`\r
`}),l}function Da(o,l,d){t:{for(g in d){var g=!1;break t}g=!0}g||(d=zh(d),typeof o=="string"?d!=null&&encodeURIComponent(String(d)):it(o,l,d))}function ht(o){Pt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(ht,Pt);var Zy=/^https?$/i,t_=["POST","PUT"];r=ht.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,l,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Aa.g(),this.v=this.o?wh(this.o):wh(Aa),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(P){Gh(this,P);return}if(o=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var E in g)d.set(E,g[E]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let P of g.keys())d.set(P,g.get(P));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(d.keys()).find(P=>P.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(t_,l,void 0))||g||E||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,O]of d)this.g.setRequestHeader(P,O);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Wh(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){Gh(this,P)}};function Gh(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,Kh(o),gi(o)}function Kh(o){o.A||(o.A=!0,Ft(o,"complete"),Ft(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ft(this,"complete"),Ft(this,"abort"),gi(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),gi(this,!0)),ht.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Qh(this):this.bb())},r.bb=function(){Qh(this)};function Qh(o){if(o.h&&typeof a<"u"&&(!o.v[1]||he(o)!=4||o.Z()!=2)){if(o.u&&he(o)==4)gh(o.Ea,0,o);else if(Ft(o,"readystatechange"),he(o)==4){o.h=!1;try{let O=o.Z();t:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break t;default:l=!1}var d;if(!(d=l)){var g;if(g=O===0){var E=String(o.D).match(Mh)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),g=!Zy.test(E?E.toLowerCase():"")}d=g}if(d)Ft(o,"complete"),Ft(o,"success");else{o.m=6;try{var P=2<he(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",Kh(o)}}finally{gi(o)}}}}function gi(o,l){if(o.g){Wh(o);let d=o.g,g=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Ft(o,"ready");try{d.onreadystatechange=g}catch{}}}function Wh(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function he(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<he(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),xy(l)}};function Hh(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function e_(o){let l={};o=(o.g&&2<=he(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<o.length;g++){if($(o[g]))continue;var d=T(o[g]);let E=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let P=l[E]||[];l[E]=P,P.push(d)}v(l,function(g){return g.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Jr(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function Xh(o){this.Aa=0,this.i=[],this.j=new $r,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Jr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Jr("baseRetryDelayMs",5e3,o),this.cb=Jr("retryDelaySeedMs",1e4,o),this.Wa=Jr("forwardChannelMaxRetries",2,o),this.wa=Jr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Dh(o&&o.concurrentRequestLimit),this.Da=new Jy,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Xh.prototype,r.la=8,r.G=1,r.connect=function(o,l,d,g){Ot(0),this.W=o,this.H=l||{},d&&g!==void 0&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.I=id(this,null,this.W),yi(this)};function xa(o){if(Jh(o),o.G==3){var l=o.U++,d=le(o.I);if(it(d,"SID",o.K),it(d,"RID",l),it(d,"TYPE","terminate"),Yr(o,d),l=new be(o,o.j,l),l.L=2,l.v=fi(le(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&(new Image().src=l.v,d=!0),d||(l.g=od(l.j,null),l.g.ea(l.v)),l.F=Date.now(),li(l)}sd(o)}function pi(o){o.g&&(ka(o),o.g.cancel(),o.g=null)}function Jh(o){pi(o),o.u&&(u.clearTimeout(o.u),o.u=null),_i(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function yi(o){if(!xh(o.h)&&!o.s){o.s=!0;var l=o.Ga;Fr||ch(),Or||(Fr(),Or=!0),ha.add(l,o),o.B=0}}function n_(o,l){return Nh(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=l.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=jr(p(o.Ga,o,l),rd(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new be(this,this.j,o),P=this.o;if(this.S&&(P?(P=y(P),I(P,this.S)):P=this.S),this.m!==null||this.O||(E.H=P,P=null),this.P)t:{for(var l=0,d=0;d<this.i.length;d++){e:{var g=this.i[d];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break e}g=void 0}if(g===void 0)break;if(l+=g,4096<l){l=d;break t}if(l===4096||d===this.i.length-1){l=d+1;break t}}l=1e3}else l=1e3;l=Zh(this,E,l),d=le(this.I),it(d,"RID",o),it(d,"CVER",22),this.D&&it(d,"X-HTTP-Session-Id",this.D),Yr(this,d),P&&(this.O?l="headers="+encodeURIComponent(String(zh(P)))+"&"+l:this.m&&Da(d,this.m,P)),Ca(this.h,E),this.Ua&&it(d,"TYPE","init"),this.P?(it(d,"$req",l),it(d,"SID","null"),E.T=!0,ba(E,d,null)):ba(E,d,l),this.G=2}}else this.G==3&&(o?Yh(this,o):this.i.length==0||xh(this.h)||Yh(this))};function Yh(o,l){var d;l?d=l.l:d=o.U++;let g=le(o.I);it(g,"SID",o.K),it(g,"RID",d),it(g,"AID",o.T),Yr(o,g),o.m&&o.o&&Da(g,o.m,o.o),d=new be(o,o.j,d,o.B+1),o.m===null&&(d.H=o.o),l&&(o.i=l.D.concat(o.i)),l=Zh(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Ca(o.h,d),ba(d,g,l)}function Yr(o,l){o.H&&Q(o.H,function(d,g){it(l,g,d)}),o.l&&Oh({},function(d,g){it(l,g,d)})}function Zh(o,l,d){d=Math.min(o.i.length,d);var g=o.l?p(o.l.Na,o.l,o):null;t:{var E=o.i;let P=-1;for(;;){let O=["count="+d];P==-1?0<d?(P=E[0].g,O.push("ofs="+P)):P=0:O.push("ofs="+P);let st=!0;for(let bt=0;bt<d;bt++){let Z=E[bt].g,Vt=E[bt].map;if(Z-=P,0>Z)P=Math.max(0,E[bt].g-100),st=!1;else try{Yy(Vt,O,"req"+Z+"_")}catch{g&&g(Vt)}}if(st){g=O.join("&");break t}}}return o=o.i.splice(0,d),l.D=o,g}function td(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;Fr||ch(),Or||(Fr(),Or=!0),ha.add(l,o),o.v=0}}function Na(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=jr(p(o.Fa,o),rd(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,ed(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=jr(p(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ot(10),pi(this),ed(this))};function ka(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function ed(o){o.g=new be(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var l=le(o.qa);it(l,"RID","rpc"),it(l,"SID",o.K),it(l,"AID",o.T),it(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&it(l,"TO",o.ja),it(l,"TYPE","xmlhttp"),Yr(o,l),o.m&&o.o&&Da(l,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=fi(le(l)),d.m=null,d.P=!0,Ph(d,o)}r.Za=function(){this.C!=null&&(this.C=null,pi(this),Na(this),Ot(19))};function _i(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function nd(o,l){var d=null;if(o.g==l){_i(o),ka(o),o.g=null;var g=2}else if(Va(o.h,l))d=l.D,kh(o.h,l),g=1;else return;if(o.G!=0){if(l.o)if(g==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var E=o.B;g=ai(),Ft(g,new Ah(g,d)),yi(o)}else td(o);else if(E=l.s,E==3||E==0&&0<l.X||!(g==1&&n_(o,l)||g==2&&Na(o)))switch(d&&0<d.length&&(l=o.h,l.i=l.i.concat(d)),E){case 1:sn(o,5);break;case 4:sn(o,10);break;case 3:sn(o,6);break;default:sn(o,2)}}}function rd(o,l){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*l}function sn(o,l){if(o.j.info("Error code "+l),l==2){var d=p(o.fb,o),g=o.Xa;let E=!g;g=new rn(g||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||hi(g,"https"),fi(g),E?Hy(g.toString(),d):Xy(g.toString(),d)}else Ot(2);o.G=0,o.l&&o.l.sa(l),sd(o),Jh(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ot(2)):(this.j.info("Failed to ping google.com"),Ot(1))};function sd(o){if(o.G=0,o.ka=[],o.l){let l=Fh(o.h);(l.length!=0||o.i.length!=0)&&(N(o.ka,l),N(o.ka,o.i),o.h.i.length=0,x(o.i),o.i.length=0),o.l.ra()}}function id(o,l,d){var g=d instanceof rn?le(d):new rn(d);if(g.g!="")l&&(g.g=l+"."+g.g),di(g,g.s);else{var E=u.location;g=E.protocol,l=l?l+"."+E.hostname:E.hostname,E=+E.port;var P=new rn(null);g&&hi(P,g),l&&(P.g=l),E&&di(P,E),d&&(P.l=d),g=P}return d=o.D,l=o.ya,d&&l&&it(g,d,l),it(g,"VER",o.la),Yr(o,g),g}function od(o,l,d){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Ca&&!o.pa?new ht(new Wr({eb:d})):new ht(o.pa),l.Ha(o.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function ad(){}r=ad.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function wi(){}wi.prototype.g=function(o,l){return new Ut(o,l)};function Ut(o,l){Pt.call(this),this.g=new Xh(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!$(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!$(l)&&(this.g.D=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new On(this)}C(Ut,Pt),Ut.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ut.prototype.close=function(){xa(this.g)},Ut.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.u&&(d={},d.__data__=va(o),o=d);l.i.push(new qy(l.Ya++,o)),l.G==3&&yi(l)},Ut.prototype.N=function(){this.g.l=null,delete this.j,xa(this.g),delete this.g,Ut.aa.N.call(this)};function ud(o){Ta.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){t:{for(let d in l){o=d;break t}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}C(ud,Ta);function cd(){Ea.call(this),this.status=1}C(cd,Ea);function On(o){this.g=o}C(On,ad),On.prototype.ua=function(){Ft(this.g,"a")},On.prototype.ta=function(o){Ft(this.g,new ud(o))},On.prototype.sa=function(o){Ft(this.g,new cd)},On.prototype.ra=function(){Ft(this.g,"b")},wi.prototype.createWebChannel=wi.prototype.g,Ut.prototype.send=Ut.prototype.o,Ut.prototype.open=Ut.prototype.m,Ut.prototype.close=Ut.prototype.close,Ja=fe.createWebChannelTransport=function(){return new wi},Xa=fe.getStatEventTarget=function(){return ai()},Ha=fe.Event=en,Ai=fe.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ui.NO_ERROR=0,ui.TIMEOUT=8,ui.HTTP_ERROR=6,es=fe.ErrorCode=ui,Sh.COMPLETE="complete",Wa=fe.EventType=Sh,vh.EventType=Ur,Ur.OPEN="a",Ur.CLOSE="b",Ur.ERROR="c",Ur.MESSAGE="d",Pt.prototype.listen=Pt.prototype.K,Un=fe.WebChannel=vh,r_=fe.FetchXmlHttpFactory=Wr,ht.prototype.listenOnce=ht.prototype.L,ht.prototype.getLastError=ht.prototype.Ka,ht.prototype.getLastErrorCode=ht.prototype.Ba,ht.prototype.getStatus=ht.prototype.Z,ht.prototype.getResponseJson=ht.prototype.Oa,ht.prototype.getResponseText=ht.prototype.oa,ht.prototype.send=ht.prototype.ea,ht.prototype.setWithCredentials=ht.prototype.Ha,Qa=fe.XhrIo=ht}).apply(typeof Ei<"u"?Ei:typeof self<"u"?self:typeof window<"u"?window:{});var zd="@firebase/firestore",Gd="4.8.0";var wt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};wt.UNAUTHENTICATED=new wt(null),wt.GOOGLE_CREDENTIALS=new wt("google-credentials-uid"),wt.FIRST_PARTY=new wt("first-party-uid"),wt.MOCK_USER=new wt("mock-user");var br="11.10.0";var Le=new Cd("@firebase/firestore");function Qn(){return Le.logLevel}function cm(r){Le.setLogLevel(r)}function k(r,...t){if(Le.logLevel<=Yt.DEBUG){let e=t.map(ml);Le.debug(`Firestore (${br}): ${r}`,...e)}}function ft(r,...t){if(Le.logLevel<=Yt.ERROR){let e=t.map(ml);Le.error(`Firestore (${br}): ${r}`,...e)}}function Mt(r,...t){if(Le.logLevel<=Yt.WARN){let e=t.map(ml);Le.warn(`Firestore (${br}): ${r}`,...e)}}function ml(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function L(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,lm(r,n,e)}function lm(r,t,e){let n=`FIRESTORE (${br}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw ft(n),new Error(n)}function B(r,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,r||lm(t,s,n)}function Dv(r,t){r||L(57014,t)}function F(r,t){return r}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends Pd{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var It=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var qi=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},iu=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(wt.UNAUTHENTICATED))}shutdown(){}},ou=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},au=class{constructor(t){this.t=t,this.currentUser=wt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){B(this.o===void 0,42304);let n=this.i,s=c=>this.i!==n?(n=this.i,e(c)):Promise.resolve(),i=new It;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new It,t.enqueueRetryable(()=>s(this.currentUser))};let a=()=>{let c=i;t.enqueueRetryable(()=>V(this,null,function*(){yield c.promise,yield s(this.currentUser)}))},u=c=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new It)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(B(typeof n.accessToken=="string",31837,{l:n}),new qi(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return B(t===null||typeof t=="string",2055,{h:t}),new wt(t)}},uu=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=wt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},cu=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new uu(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(wt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},ps=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},lu=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Nd(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){B(this.o===void 0,3512);let n=i=>{i.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let a=i.token!==this.m;return this.m=i.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>n(i))};let s=i=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.V.getImmediate({optional:!0});i?s(i):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new ps(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(B(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new ps(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}},Kd=class{getToken(){return Promise.resolve(new ps(""))}invalidateToken(){}start(t,e){}shutdown(){}};function s_(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}function gl(){return new TextEncoder}var ys=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let s=s_(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}};function G(r,t){return r<t?-1:r>t?1:0}function hu(r,t){let e=0;for(;e<r.length&&e<t.length;){let n=r.codePointAt(e),s=t.codePointAt(e);if(n!==s){if(n<128&&s<128)return G(n,s);{let i=gl(),a=i_(i.encode(Qd(r,e)),i.encode(Qd(t,e)));return a!==0?a:G(n,s)}}e+=n>65535?2:1}return G(r.length,t.length)}function Qd(r,t){return r.codePointAt(t)>65535?r.substring(t,t+2):r.substring(t,t+1)}function i_(r,t){for(let e=0;e<r.length&&e<t.length;++e)if(r[e]!==t[e])return G(r[e],t[e]);return G(r.length,t.length)}function nr(r,t,e){return r.length===t.length&&r.every((n,s)=>e(n,t[s]))}function hm(r){return r+"\0"}var du="__name__",Ui=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&L(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&L(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let s=0;s<n;s++){let i=r.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return G(t.length,e.length)}static compareSegments(t,e){let n=r.isNumericId(t),s=r.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?r.extractNumericId(t).compare(r.extractNumericId(e)):hu(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return de.fromString(t.substring(4,t.length-2))}},X=class r extends Ui{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new D(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(s=>s.length>0))}return new r(e)}static emptyPath(){return new r([])}},o_=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Tt=class r extends Ui{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return o_.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===du}static keyField(){return new r([du])}static fromServerFormat(t){let e=[],n="",s=0,i=()=>{if(n.length===0)throw new D(S.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;s<t.length;){let u=t[s];if(u==="\\"){if(s+1===t.length)throw new D(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new D(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=c,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(n+=u,s++):(i(),s++)}if(i(),a)throw new D(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var M=class r{constructor(t){this.path=t}static fromPath(t){return new r(X.fromString(t))}static fromName(t){return new r(X.fromString(t).popFirst(5))}static empty(){return new r(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&X.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return X.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new X(t.slice()))}};function pl(r,t,e){if(!e)throw new D(S.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function a_(r,t,e,n){if(t===!0&&n===!0)throw new D(S.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function Wd(r){if(!M.isDocumentKey(r))throw new D(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Hd(r){if(M.isDocumentKey(r))throw new D(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function dm(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function jo(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":L(12329,{type:typeof r})}function H(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new D(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=jo(r);throw new D(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function fm(r,t){if(t<=0)throw new D(S.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}function vt(r,t){let e={typeString:r};return t&&(e.value=t),e}function Cn(r,t){if(!dm(r))throw new D(S.INVALID_ARGUMENT,"JSON must be an object");let e;for(let n in t)if(t[n]){let s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}let a=r[n];if(s&&typeof a!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){e=`Expected '${n}' field to equal '${i.value}'`;break}}if(e)throw new D(S.INVALID_ARGUMENT,e);return!0}var Xd=-62135596800,Jd=1e6,ct=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*Jd);return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new D(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new D(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Xd)throw new D(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new D(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Jd}_compareTo(t){return this.seconds===t.seconds?G(this.nanoseconds,t.nanoseconds):G(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:r._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Cn(t,r._jsonSchema))return new r(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-Xd;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};ct._jsonSchemaVersion="firestore/timestamp/1.0",ct._jsonSchema={type:vt("string",ct._jsonSchemaVersion),seconds:vt("number"),nanoseconds:vt("number")};var z=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new ct(0,0))}static max(){return new r(new ct(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var rr=-1,qe=class{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}};function fu(r){return r.fields.find(t=>t.kind===2)}function un(r){return r.fields.filter(t=>t.kind!==2)}function u_(r,t){let e=G(r.collectionGroup,t.collectionGroup);if(e!==0)return e;for(let n=0;n<Math.min(r.fields.length,t.fields.length);++n)if(e=c_(r.fields[n],t.fields[n]),e!==0)return e;return G(r.fields.length,t.fields.length)}qe.UNKNOWN_ID=-1;var ge=class{constructor(t,e){this.fieldPath=t,this.kind=e}};function c_(r,t){let e=Tt.comparator(r.fieldPath,t.fieldPath);return e!==0?e:G(r.kind,t.kind)}var sr=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,Kt.min())}};function mm(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=z.fromTimestamp(n===1e9?new ct(e+1,0):new ct(e,n));return new Kt(s,M.empty(),t)}function gm(r){return new Kt(r.readTime,r.key,rr)}var Kt=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(z.min(),M.empty(),rr)}static max(){return new r(z.max(),M.empty(),rr)}};function yl(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(r.documentKey,t.documentKey),e!==0?e:G(r.largestBatchId,t.largestBatchId))}var pm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Bi=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function He(r){return V(this,null,function*(){if(r.code!==S.FAILED_PRECONDITION||r.message!==pm)throw r;k("LocalStore","Unexpectedly lost primary lease")})}var R=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let s=0,i=0,a=!1;t.forEach(u=>{++s,u.next(()=>{++i,a&&i===s&&e()},c=>n(c))}),a=!0,i===s&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(s=>s?r.resolve(s):n());return e}static forEach(t,e){let n=[];return t.forEach((s,i)=>{n.push(e.call(this,s,i))}),this.waitFor(n)}static mapArray(t,e){return new r((n,s)=>{let i=t.length,a=new Array(i),u=0;for(let c=0;c<i;c++){let h=c;e(t[h]).next(f=>{a[h]=f,++u,u===i&&n(a)},f=>s(f))}})}static doWhile(t,e){return new r((n,s)=>{let i=()=>{t()===!0?e().next(()=>{i()},s):n()};i()})}};var Bt="SimpleDb",ji=class r{static open(t,e,n,s){try{return new r(e,t.transaction(s,n))}catch(i){throw new pn(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new It,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new pn(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{let s=_l(n.target.error);this.S.reject(new pn(t,s))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(k(Bt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new gu(e)}},Ue=class r{static delete(t){return k(Bt,"Removing database:",t),ln(Ed().indexedDB.deleteDatabase(t)).toPromise()}static C(){if(!Rd())return!1;if(r.F())return!0;let t=ts(),e=r.M(t),n=0<e&&e<10,s=ym(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static F(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.O)==="YES"}static N(t,e){return t.store(e)}static M(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.B=n,this.L=null,r.M(ts())===12.2&&ft("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(t){return V(this,null,function*(){return this.db||(k(Bt,"Opening database:",this.name),this.db=yield new Promise((e,n)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{let a=i.target.result;e(a)},s.onblocked=()=>{n(new pn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{let a=i.target.error;a.name==="VersionError"?n(new D(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new D(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new pn(t,a))},s.onupgradeneeded=i=>{k(Bt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);let a=i.target.result;if(this.L!==null&&this.L!==i.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${i.oldVersion}, event.newVersion=${i.newVersion}, db.version=${a.version}`);this.B.q(a,s.transaction,i.oldVersion,this.version).next(()=>{k(Bt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let n=e.target;this.L=n.version},{passive:!0})),this.db.addEventListener("versionchange",e=>{var n;e.newVersion===null&&(Mt('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(n=this.databaseDeletedListener)===null||n===void 0||n.call(this))},{passive:!0}),this.db})}setDatabaseDeletedListener(t){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=t}runTransaction(t,e,n,s){return V(this,null,function*(){let i=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.k(t);let u=ji.open(this.db,t,i?"readonly":"readwrite",n),c=s(u).next(h=>(u.v(),h)).catch(h=>(u.abort(h),R.reject(h))).toPromise();return c.catch(()=>{}),yield u.D,c}catch(u){let c=u,h=c.name!=="FirebaseError"&&a<3;if(k(Bt,"Transaction failed with error:",c.message,"Retrying:",h),this.close(),!h)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function ym(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var mu=class{constructor(t){this.$=t,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(t){this.$=t}done(){this.U=!0}G(t){this.K=t}delete(){return ln(this.$.delete())}},pn=class extends D{constructor(t,e){super(S.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Xe(r){return r.name==="IndexedDbTransactionError"}var gu=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(k(Bt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(k(Bt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ln(n)}add(t){return k(Bt,"ADD",this.store.name,t,t),ln(this.store.add(t))}get(t){return ln(this.store.get(t)).next(e=>(e===void 0&&(e=null),k(Bt,"GET",this.store.name,t,e),e))}delete(t){return k(Bt,"DELETE",this.store.name,t),ln(this.store.delete(t))}count(){return k(Bt,"COUNT",this.store.name),ln(this.store.count())}j(t,e){let n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){let i=s.getAll(n.range);return new R((a,u)=>{i.onerror=c=>{u(c.target.error)},i.onsuccess=c=>{a(c.target.result)}})}{let i=this.cursor(n),a=[];return this.J(i,(u,c)=>{a.push(c)}).next(()=>a)}}H(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new R((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}})}Y(t,e){k(Bt,"DELETE ALL",this.store.name);let n=this.options(t,e);n.Z=!1;let s=this.cursor(n);return this.J(s,(i,a,u)=>u.delete())}X(t,e){let n;e?n=t:(n={},e=t);let s=this.cursor(n);return this.J(s,e)}ee(t){let e=this.cursor({});return new R((n,s)=>{e.onerror=i=>{let a=_l(i.target.error);s(a)},e.onsuccess=i=>{let a=i.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}J(t,e){let n=[];return new R((s,i)=>{t.onerror=a=>{i(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void s();let c=new mu(u),h=e(u.primaryKey,u.value,c);if(h instanceof R){let f=h.catch(m=>(c.done(),R.reject(m)));n.push(f)}c.isDone?s():c.W===null?u.continue():u.continue(c.W)}}).next(()=>R.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.Z?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function ln(r){return new R((t,e)=>{r.onsuccess=n=>{let s=n.target.result;t(s)},r.onerror=n=>{let s=_l(n.target.error);e(s)}})}var Yd=!1;function _l(r){let t=Ue.M(ts());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Yd||(Yd=!0,setTimeout(()=>{throw n},0)),n}}return r}var us="IndexBackfiller",pu=class{constructor(t,e){this.asyncQueue=t,this.te=e,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(t){k(us,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>V(this,null,function*(){this.task=null;try{let e=yield this.te.re();k(us,`Documents written: ${e}`)}catch(e){Xe(e)?k(us,"Ignoring IndexedDB error during index backfill: ",e):yield He(e)}yield this.ne(6e4)}))}},yu=class{constructor(t,e){this.localStore=t,this.persistence=e}re(t=50){return V(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.ie(e,t))})}ie(t,e){let n=new Set,s=e,i=!0;return R.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return k(us,`Processing collection: ${a}`),this.se(t,a,s).next(u=>{s-=u,n.add(a)});i=!1})).next(()=>e-s)}se(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next(i=>{let a=i.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.oe(s,i)).next(u=>(k(us,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}oe(t,e){let n=t;return e.changes.forEach((s,i)=>{let a=gm(i);yl(a,n)>0&&(n=a)}),new Kt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var jt=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this._e(s),this.ae=s=>n.writeSequenceNumber(s))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}}r.ue=-1;return r})(),Oe=-1;function Hs(r){return r==null}function _s(r){return r===0&&1/r==-1/0}function _m(r){return typeof r=="number"&&Number.isInteger(r)&&!_s(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}var $i="";function Nt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Zd(t)),t=l_(r.get(e),t);return Zd(t)}function l_(r,t){let e=t,n=r.length;for(let s=0;s<n;s++){let i=r.charAt(s);switch(i){case"\0":e+="";break;case $i:e+="";break;default:e+=i}}return e}function Zd(r){return r+$i+""}function te(r){let t=r.length;if(B(t>=2,64408,{path:r}),t===2)return B(r.charAt(0)===$i&&r.charAt(1)==="",56145,{path:r}),X.emptyPath();let e=t-2,n=[],s="";for(let i=0;i<t;){let a=r.indexOf($i,i);switch((a<0||a>e)&&L(50515,{path:r}),r.charAt(a+1)){case"":let u=r.substring(i,a),c;s.length===0?c=u:(s+=u,c=s,s=""),n.push(c);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:L(61167,{path:r})}i=a+2}return new X(n)}var cn="remoteDocuments",Xs="owner",Bn="owner",ws="mutationQueues",h_="userId",Wt="mutations",tf="batchId",mn="userMutationsIndex",ef=["userId","batchId"];function Di(r,t){return[r,Nt(t)]}function wm(r,t,e){return[r,Nt(t),e]}var d_={},ir="documentMutations",zi="remoteDocumentsV14",f_=["prefixPath","collectionGroup","readTime","documentId"],xi="documentKeyIndex",m_=["prefixPath","collectionGroup","documentId"],vm="collectionGroupIndex",g_=["collectionGroup","readTime","prefixPath","documentId"],vs="remoteDocumentGlobal",_u="remoteDocumentGlobalKey",or="targets",Im="queryTargetsIndex",p_=["canonicalId","targetId"],ar="targetDocuments",y_=["targetId","path"],wl="documentTargetsIndex",__=["path","targetId"],Gi="targetGlobalKey",yn="targetGlobal",Is="collectionParents",w_=["collectionId","parent"],ur="clientMetadata",v_="clientId",$o="bundles",I_="bundleId",zo="namedQueries",T_="name",vl="indexConfiguration",E_="indexId",wu="collectionGroupIndex",A_="collectionGroup",cs="indexState",S_=["indexId","uid"],Tm="sequenceNumberIndex",b_=["uid","sequenceNumber"],ls="indexEntries",R_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Em="documentKeyIndex",P_=["indexId","uid","orderedDocumentKey"],Go="documentOverlays",V_=["userId","collectionPath","documentId"],vu="collectionPathOverlayIndex",C_=["userId","collectionPath","largestBatchId"],Am="collectionGroupOverlayIndex",D_=["userId","collectionGroup","largestBatchId"],Il="globals",x_="name",Sm=[ws,Wt,ir,cn,or,Xs,yn,ar,ur,vs,Is,$o,zo],N_=[...Sm,Go],bm=[ws,Wt,ir,zi,or,Xs,yn,ar,ur,vs,Is,$o,zo,Go],Rm=bm,Tl=[...Rm,vl,cs,ls],k_=Tl,Pm=[...Tl,Il],F_=Pm;var Ts=class extends Bi{constructor(t,e){super(),this.ce=t,this.currentSequenceNumber=e}};function At(r,t){let e=F(r);return Ue.N(e.ce,t)}function nf(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Je(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Vm(r,t){let e=[];for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.push(t(r[n],n,r));return e}function Cm(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var at=class r{constructor(t,e){this.comparator=t,this.root=e||re.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,re.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,re.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Jn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Jn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Jn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Jn(this.root,t,this.comparator,!0)}},Jn=class{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},re=class r{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??r.RED,this.left=s??r.EMPTY,this.right=i??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new r(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this,i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return r.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw L(27949);return t+(this.isRed()?0:1)}};re.EMPTY=null,re.RED=!0,re.BLACK=!1;re.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(t,e,n,s,i){return this}insert(t,e,n){return new re(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var rt=class r{constructor(t){this.comparator=t,this.data=new at(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ki(this.data.getIterator())}getIteratorFrom(t){return new Ki(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Ki=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function jn(r){return r.hasNext()?r.getNext():void 0}var $t=class r{constructor(t){this.fields=t,t.sort(Tt.comparator)}static empty(){return new r([])}unionWith(t){let e=new rt(Tt.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return nr(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var Qi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Nv(){return typeof atob<"u"}var gt=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Qi("Invalid base64 string: "+i):i}}(t);return new r(e)}static fromUint8Array(t){let e=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return G(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};gt.EMPTY_BYTE_STRING=new gt("");var O_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _e(r){if(B(!!r,39018),typeof r=="string"){let t=0,e=O_.exec(r);if(B(!!e,46558,{timestamp:r}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:ut(r.seconds),nanos:ut(r.nanos)}}function ut(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function we(r){return typeof r=="string"?gt.fromBase64String(r):gt.fromUint8Array(r)}var Dm="server_timestamp",xm="__type__",Nm="__previous_value__",km="__local_write_time__";function Ko(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[xm])===null||e===void 0?void 0:e.stringValue)===Dm}function Qo(r){let t=r.mapValue.fields[Nm];return Ko(t)?Qo(t):t}function Es(r){let t=_e(r.mapValue.fields[km].timestampValue);return new ct(t.seconds,t.nanos)}var Iu=class{constructor(t,e,n,s,i,a,u,c,h,f){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f}},As="(default)",cr=class r{constructor(t,e){this.projectId=t,this.database=e||As}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===As}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var El="__type__",Fm="__max__",ke={mapValue:{fields:{__type__:{stringValue:Fm}}}},Al="__vector__",lr="value",Ni={nullValue:"NULL_VALUE"};function Be(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ko(r)?4:Om(r)?9007199254740991:Wo(r)?10:11:L(28295,{value:r})}function oe(r,t){if(r===t)return!0;let e=Be(r);if(e!==Be(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Es(r).isEqual(Es(t));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;let a=_e(s.timestampValue),u=_e(i.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(s,i){return we(s.bytesValue).isEqual(we(i.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(s,i){return ut(s.geoPointValue.latitude)===ut(i.geoPointValue.latitude)&&ut(s.geoPointValue.longitude)===ut(i.geoPointValue.longitude)}(r,t);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return ut(s.integerValue)===ut(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){let a=ut(s.doubleValue),u=ut(i.doubleValue);return a===u?_s(a)===_s(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return nr(r.arrayValue.values||[],t.arrayValue.values||[],oe);case 10:case 11:return function(s,i){let a=s.mapValue.fields||{},u=i.mapValue.fields||{};if(nf(a)!==nf(u))return!1;for(let c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!oe(a[c],u[c])))return!1;return!0}(r,t);default:return L(52216,{left:r})}}function Ss(r,t){return(r.values||[]).find(e=>oe(e,t))!==void 0}function je(r,t){if(r===t)return 0;let e=Be(r),n=Be(t);if(e!==n)return G(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return G(r.booleanValue,t.booleanValue);case 2:return function(i,a){let u=ut(i.integerValue||i.doubleValue),c=ut(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,t);case 3:return rf(r.timestampValue,t.timestampValue);case 4:return rf(Es(r),Es(t));case 5:return hu(r.stringValue,t.stringValue);case 6:return function(i,a){let u=we(i),c=we(a);return u.compareTo(c)}(r.bytesValue,t.bytesValue);case 7:return function(i,a){let u=i.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){let f=G(u[h],c[h]);if(f!==0)return f}return G(u.length,c.length)}(r.referenceValue,t.referenceValue);case 8:return function(i,a){let u=G(ut(i.latitude),ut(a.latitude));return u!==0?u:G(ut(i.longitude),ut(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return sf(r.arrayValue,t.arrayValue);case 10:return function(i,a){var u,c,h,f;let m=i.fields||{},p=a.fields||{},A=(u=m[lr])===null||u===void 0?void 0:u.arrayValue,C=(c=p[lr])===null||c===void 0?void 0:c.arrayValue,x=G(((h=A?.values)===null||h===void 0?void 0:h.length)||0,((f=C?.values)===null||f===void 0?void 0:f.length)||0);return x!==0?x:sf(A,C)}(r.mapValue,t.mapValue);case 11:return function(i,a){if(i===ke.mapValue&&a===ke.mapValue)return 0;if(i===ke.mapValue)return 1;if(a===ke.mapValue)return-1;let u=i.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let m=0;m<c.length&&m<f.length;++m){let p=hu(c[m],f[m]);if(p!==0)return p;let A=je(u[c[m]],h[f[m]]);if(A!==0)return A}return G(c.length,f.length)}(r.mapValue,t.mapValue);default:throw L(23264,{le:e})}}function rf(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return G(r,t);let e=_e(r),n=_e(t),s=G(e.seconds,n.seconds);return s!==0?s:G(e.nanos,n.nanos)}function sf(r,t){let e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){let i=je(e[s],n[s]);if(i)return i}return G(e.length,n.length)}function hr(r){return Tu(r)}function Tu(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=_e(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return we(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return M.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",s=!0;for(let i of e.values||[])s?s=!1:n+=",",n+=Tu(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),s="{",i=!0;for(let a of n)i?i=!1:s+=",",s+=`${a}:${Tu(e.fields[a])}`;return s+"}"}(r.mapValue):L(61005,{value:r})}function ki(r){switch(Be(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=Qo(r);return t?16+ki(t):16;case 5:return 2*r.stringValue.length;case 6:return we(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((s,i)=>s+ki(i),0)}(r.arrayValue);case 10:case 11:return function(n){let s=0;return Je(n.fields,(i,a)=>{s+=i.length+ki(a)}),s}(r.mapValue);default:throw L(13486,{value:r})}}function _n(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Eu(r){return!!r&&"integerValue"in r}function bs(r){return!!r&&"arrayValue"in r}function of(r){return!!r&&"nullValue"in r}function af(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Fi(r){return!!r&&"mapValue"in r}function Wo(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[El])===null||e===void 0?void 0:e.stringValue)===Al}function hs(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return Je(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=hs(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=hs(r.arrayValue.values[e]);return t}return Object.assign({},r)}function Om(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Fm}var Mm={mapValue:{fields:{[El]:{stringValue:Al},[lr]:{arrayValue:{}}}}};function M_(r){return"nullValue"in r?Ni:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?_n(cr.empty(),M.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Wo(r)?Mm:{mapValue:{}}:L(35942,{value:r})}function L_(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?_n(cr.empty(),M.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Mm:"mapValue"in r?Wo(r)?{mapValue:{}}:ke:L(61959,{value:r})}function uf(r,t){let e=je(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function cf(r,t){let e=je(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var xt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Fi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=hs(e)}setAll(t){let e=Tt.emptyPath(),n={},s=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let c=this.getFieldsMap(e);this.applyChanges(c,n,s),n={},s=[],e=u.popLast()}a?n[u.lastSegment()]=hs(a):s.push(u.lastSegment())});let i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){let e=this.field(t.popLast());Fi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return oe(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Fi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Je(e,(s,i)=>t[s]=i);for(let s of n)delete t[s]}clone(){return new r(hs(this.value))}};function Lm(r){let t=[];return Je(r.fields,(e,n)=>{let s=new Tt([e]);if(Fi(n)){let i=Lm(n.mapValue).fields;if(i.length===0)t.push(s);else for(let a of i)t.push(s.child(a))}else t.push(s)}),new $t(t)}var Et=class r{constructor(t,e,n,s,i,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,z.min(),z.min(),z.min(),xt.empty(),0)}static newFoundDocument(t,e,n,s){return new r(t,1,e,z.min(),n,s,0)}static newNoDocument(t,e){return new r(t,2,e,z.min(),z.min(),xt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,z.min(),z.min(),xt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=xt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=xt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ae=class{constructor(t,e){this.position=t,this.inclusive=e}};function lf(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){let i=t[s],a=r.position[s];if(i.field.isKeyField()?n=M.comparator(M.fromName(a.referenceValue),e.key):n=je(a,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function hf(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!oe(r.position[e],t.position[e]))return!1;return!0}var wn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function q_(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var Wi=class{},J=class r extends Wi{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new bu(t,e,n):e==="array-contains"?new Vu(t,n):e==="in"?new Hi(t,n):e==="not-in"?new Cu(t,n):e==="array-contains-any"?new Du(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new Ru(t,n):new Pu(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(je(e,this.value)):e!==null&&Be(this.value)===Be(e)&&this.matchesComparison(je(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},et=class r extends Wi{constructor(t,e){super(),this.filters=t,this.op=e,this.he=null}static create(t,e){return new r(t,e)}matches(t){return dr(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function dr(r){return r.op==="and"}function Au(r){return r.op==="or"}function Sl(r){return qm(r)&&dr(r)}function qm(r){for(let t of r.filters)if(t instanceof et)return!1;return!0}function Su(r){if(r instanceof J)return r.field.canonicalString()+r.op.toString()+hr(r.value);if(Sl(r))return r.filters.map(t=>Su(t)).join(",");{let t=r.filters.map(e=>Su(e)).join(",");return`${r.op}(${t})`}}function Um(r,t){return r instanceof J?function(n,s){return s instanceof J&&n.op===s.op&&n.field.isEqual(s.field)&&oe(n.value,s.value)}(r,t):r instanceof et?function(n,s){return s instanceof et&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((i,a,u)=>i&&Um(a,s.filters[u]),!0):!1}(r,t):void L(19439)}function Bm(r,t){let e=r.filters.concat(t);return et.create(e,r.op)}function jm(r){return r instanceof J?function(e){return`${e.field.canonicalString()} ${e.op} ${hr(e.value)}`}(r):r instanceof et?function(e){return e.op.toString()+" {"+e.getFilters().map(jm).join(" ,")+"}"}(r):"Filter"}var bu=class extends J{constructor(t,e,n){super(t,e,n),this.key=M.fromName(n.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},Ru=class extends J{constructor(t,e){super(t,"in",e),this.keys=$m("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Pu=class extends J{constructor(t,e){super(t,"not-in",e),this.keys=$m("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function $m(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>M.fromName(n.referenceValue))}var Vu=class extends J{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return bs(e)&&Ss(e.arrayValue,this.value)}},Hi=class extends J{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Ss(this.value.arrayValue,e)}},Cu=class extends J{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ss(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Ss(this.value.arrayValue,e)}},Du=class extends J{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!bs(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>Ss(this.value.arrayValue,n))}};var xu=class{constructor(t,e=null,n=[],s=[],i=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=u,this.Pe=null}};function Nu(r,t=null,e=[],n=[],s=null,i=null,a=null){return new xu(r,t,e,n,s,i,a)}function vn(r){let t=F(r);if(t.Pe===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>Su(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),Hs(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>hr(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>hr(n)).join(",")),t.Pe=e}return t.Pe}function Js(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!q_(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Um(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!hf(r.startAt,t.startAt)&&hf(r.endAt,t.endAt)}function Xi(r){return M.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Ji(r,t){return r.filters.filter(e=>e instanceof J&&e.field.isEqual(t))}function df(r,t,e){let n=Ni,s=!0;for(let i of Ji(r,t)){let a=Ni,u=!0;switch(i.op){case"<":case"<=":a=M_(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,u=!1;break;case"!=":case"not-in":a=Ni}uf({value:n,inclusive:s},{value:a,inclusive:u})<0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];uf({value:n,inclusive:s},{value:a,inclusive:e.inclusive})<0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function ff(r,t,e){let n=ke,s=!0;for(let i of Ji(r,t)){let a=ke,u=!0;switch(i.op){case">=":case">":a=L_(i.value),u=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,u=!1;break;case"!=":case"not-in":a=ke}cf({value:n,inclusive:s},{value:a,inclusive:u})>0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];cf({value:n,inclusive:s},{value:a,inclusive:e.inclusive})>0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}var Ht=class{constructor(t,e=null,n=[],s=[],i=null,a="F",u=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=u,this.endAt=c,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function zm(r,t,e,n,s,i,a,u){return new Ht(r,t,e,n,s,i,a,u)}function Rr(r){return new Ht(r)}function mf(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function bl(r){return r.collectionGroup!==null}function Yn(r){let t=F(r);if(t.Te===null){t.Te=[];let e=new Set;for(let i of t.explicitOrderBy)t.Te.push(i),e.add(i.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new rt(Tt.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Te.push(new wn(i,n))}),e.has(Tt.keyField().canonicalString())||t.Te.push(new wn(Tt.keyField(),n))}return t.Te}function kt(r){let t=F(r);return t.Ie||(t.Ie=Km(t,Yn(r))),t.Ie}function Gm(r){let t=F(r);return t.de||(t.de=Km(t,r.explicitOrderBy)),t.de}function Km(r,t){if(r.limitType==="F")return Nu(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(s=>{let i=s.dir==="desc"?"asc":"desc";return new wn(s.field,i)});let e=r.endAt?new ae(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new ae(r.startAt.position,r.startAt.inclusive):null;return Nu(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function ku(r,t){let e=r.filters.concat([t]);return new Ht(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Yi(r,t,e){return new Ht(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function Ys(r,t){return Js(kt(r),kt(t))&&r.limitType===t.limitType}function Qm(r){return`${vn(kt(r))}|lt:${r.limitType}`}function Wn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(s=>jm(s)).join(", ")}]`),Hs(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>hr(s)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>hr(s)).join(",")),`Target(${n})`}(kt(r))}; limitType=${r.limitType})`}function Zs(r,t){return t.isFoundDocument()&&function(n,s){let i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):M.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,t)&&function(n,s){for(let i of Yn(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(r,t)&&function(n,s){for(let i of n.filters)if(!i.matches(s))return!1;return!0}(r,t)&&function(n,s){return!(n.startAt&&!function(a,u,c){let h=lf(a,u,c);return a.inclusive?h<=0:h<0}(n.startAt,Yn(n),s)||n.endAt&&!function(a,u,c){let h=lf(a,u,c);return a.inclusive?h>=0:h>0}(n.endAt,Yn(n),s))}(r,t)}function Wm(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Hm(r){return(t,e)=>{let n=!1;for(let s of Yn(r)){let i=U_(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function U_(r,t,e){let n=r.field.isKeyField()?M.comparator(t.key,e.key):function(i,a,u){let c=a.data.field(i),h=u.data.field(i);return c!==null&&h!==null?je(c,h):L(42886)}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L(19790,{direction:r.dir})}}var Xt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Je(this.inner,(e,n)=>{for(let[s,i]of n)t(s,i)})}isEmpty(){return Cm(this.inner)}size(){return this.innerSize}};var B_=new at(M.comparator);function qt(){return B_}var Xm=new at(M.comparator);function os(...r){let t=Xm;for(let e of r)t=t.insert(e.key,e);return t}function Jm(r){let t=Xm;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function ee(){return ds()}function Ym(){return ds()}function ds(){return new Xt(r=>r.toString(),(r,t)=>r.isEqual(t))}var j_=new at(M.comparator),$_=new rt(M.comparator);function K(...r){let t=$_;for(let e of r)t=t.add(e);return t}var z_=new rt(G);function Rl(){return z_}function Pl(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_s(t)?"-0":t}}function Zm(r){return{integerValue:""+r}}function tg(r,t){return _m(t)?Zm(t):Pl(r,t)}var fr=class{constructor(){this._=void 0}};function G_(r,t,e){return r instanceof $e?function(s,i){let a={fields:{[xm]:{stringValue:Dm},[km]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Ko(i)&&(i=Qo(i)),i&&(a.fields[Nm]=i),{mapValue:a}}(e,t):r instanceof ve?ng(r,t):r instanceof Ie?rg(r,t):function(s,i){let a=eg(s,i),u=gf(a)+gf(s.Ee);return Eu(a)&&Eu(s.Ee)?Zm(u):Pl(s.serializer,u)}(r,t)}function K_(r,t,e){return r instanceof ve?ng(r,t):r instanceof Ie?rg(r,t):e}function eg(r,t){return r instanceof ze?function(n){return Eu(n)||function(i){return!!i&&"doubleValue"in i}(n)}(t)?t:{integerValue:0}:null}var $e=class extends fr{},ve=class extends fr{constructor(t){super(),this.elements=t}};function ng(r,t){let e=sg(t);for(let n of r.elements)e.some(s=>oe(s,n))||e.push(n);return{arrayValue:{values:e}}}var Ie=class extends fr{constructor(t){super(),this.elements=t}};function rg(r,t){let e=sg(t);for(let n of r.elements)e=e.filter(s=>!oe(s,n));return{arrayValue:{values:e}}}var ze=class extends fr{constructor(t,e){super(),this.serializer=t,this.Ee=e}};function gf(r){return ut(r.integerValue||r.doubleValue)}function sg(r){return bs(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var In=class{constructor(t,e){this.field=t,this.transform=e}};function Q_(r,t){return r.field.isEqual(t.field)&&function(n,s){return n instanceof ve&&s instanceof ve||n instanceof Ie&&s instanceof Ie?nr(n.elements,s.elements,oe):n instanceof ze&&s instanceof ze?oe(n.Ee,s.Ee):n instanceof $e&&s instanceof $e}(r.transform,t.transform)}var Fu=class{constructor(t,e){this.version=t,this.transformResults=e}},dt=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Oi(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var mr=class{};function ig(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new Ke(r.key,dt.none()):new Ge(r.key,r.data,dt.none());{let e=r.data,n=xt.empty(),s=new rt(Tt.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new Jt(r.key,n,new $t(s.toArray()),dt.none())}}function W_(r,t,e){r instanceof Ge?function(s,i,a){let u=s.value.clone(),c=yf(s.fieldTransforms,i,a.transformResults);u.setAll(c),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof Jt?function(s,i,a){if(!Oi(s.precondition,i))return void i.convertToUnknownDocument(a.version);let u=yf(s.fieldTransforms,i,a.transformResults),c=i.data;c.setAll(og(s)),c.setAll(u),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,t,e):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function fs(r,t,e,n){return r instanceof Ge?function(i,a,u,c){if(!Oi(i.precondition,a))return u;let h=i.value.clone(),f=_f(i.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,t,e,n):r instanceof Jt?function(i,a,u,c){if(!Oi(i.precondition,a))return u;let h=_f(i.fieldTransforms,c,a),f=a.data;return f.setAll(og(i)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(r,t,e,n):function(i,a,u){return Oi(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function H_(r,t){let e=null;for(let n of r.fieldTransforms){let s=t.data.field(n.field),i=eg(n.transform,s||null);i!=null&&(e===null&&(e=xt.empty()),e.set(n.field,i))}return e||null}function pf(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&nr(n,s,(i,a)=>Q_(i,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Ge=class extends mr{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Jt=class extends mr{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function og(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function yf(r,t,e){let n=new Map;B(r.length===e.length,32656,{Ae:e.length,Re:r.length});for(let s=0;s<e.length;s++){let i=r[s],a=i.transform,u=t.data.field(i.field);n.set(i.field,K_(a,u,e[s]))}return n}function _f(r,t,e){let n=new Map;for(let s of r){let i=s.transform,a=e.data.field(s.field);n.set(s.field,G_(i,a,t))}return n}var Ke=class extends mr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Rs=class extends mr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ps=class{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(t.key)&&W_(i,t,n[s])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=fs(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=fs(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=Ym();return this.mutations.forEach(s=>{let i=t.get(s.key),a=i.overlayedDocument,u=this.applyToLocalView(a,i.mutatedFields);u=e.has(s.key)?null:u;let c=ig(a,u);c!==null&&n.set(s.key,c),a.isValidDocument()||a.convertToNoDocument(z.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),K())}isEqual(t){return this.batchId===t.batchId&&nr(this.mutations,t.mutations,(e,n)=>pf(e,n))&&nr(this.baseMutations,t.baseMutations,(e,n)=>pf(e,n))}},Ou=class r{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){B(t.mutations.length===n.length,58842,{Ve:t.mutations.length,me:n.length});let s=function(){return j_}(),i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new r(t,e,n,s)}};var Vs=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Zi=class{constructor(t,e,n){this.alias=t,this.aggregateType=e,this.fieldPath=n}};var Mu=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var yt,Y;function ag(r){switch(r){case S.OK:return L(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return L(15467,{code:r})}}function ug(r){if(r===void 0)return ft("GRPC error has no .code"),S.UNKNOWN;switch(r){case yt.OK:return S.OK;case yt.CANCELLED:return S.CANCELLED;case yt.UNKNOWN:return S.UNKNOWN;case yt.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case yt.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case yt.INTERNAL:return S.INTERNAL;case yt.UNAVAILABLE:return S.UNAVAILABLE;case yt.UNAUTHENTICATED:return S.UNAUTHENTICATED;case yt.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case yt.NOT_FOUND:return S.NOT_FOUND;case yt.ALREADY_EXISTS:return S.ALREADY_EXISTS;case yt.PERMISSION_DENIED:return S.PERMISSION_DENIED;case yt.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case yt.ABORTED:return S.ABORTED;case yt.OUT_OF_RANGE:return S.OUT_OF_RANGE;case yt.UNIMPLEMENTED:return S.UNIMPLEMENTED;case yt.DATA_LOSS:return S.DATA_LOSS;default:return L(39323,{code:r})}}(Y=yt||(yt={}))[Y.OK=0]="OK",Y[Y.CANCELLED=1]="CANCELLED",Y[Y.UNKNOWN=2]="UNKNOWN",Y[Y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Y[Y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Y[Y.NOT_FOUND=5]="NOT_FOUND",Y[Y.ALREADY_EXISTS=6]="ALREADY_EXISTS",Y[Y.PERMISSION_DENIED=7]="PERMISSION_DENIED",Y[Y.UNAUTHENTICATED=16]="UNAUTHENTICATED",Y[Y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Y[Y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Y[Y.ABORTED=10]="ABORTED",Y[Y.OUT_OF_RANGE=11]="OUT_OF_RANGE",Y[Y.UNIMPLEMENTED=12]="UNIMPLEMENTED",Y[Y.INTERNAL=13]="INTERNAL",Y[Y.UNAVAILABLE=14]="UNAVAILABLE",Y[Y.DATA_LOSS=15]="DATA_LOSS";var to=null;var X_=new de([4294967295,4294967295],0);function wf(r){let t=gl().encode(r),e=new Ka;return e.update(t),new Uint8Array(e.digest())}function vf(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new de([e,n],0),new de([s,i],0)]}var Lu=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new gn(`Invalid padding: ${e}`);if(n<0)throw new gn(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new gn(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new gn(`Invalid padding when bitmap length is 0: ${e}`);this.fe=8*t.length-e,this.ge=de.fromNumber(this.fe)}pe(t,e,n){let s=t.add(e.multiply(de.fromNumber(n)));return s.compare(X_)===1&&(s=new de([s.getBits(0),s.getBits(1)],0)),s.modulo(this.ge).toNumber()}ye(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.fe===0)return!1;let e=wf(t),[n,s]=vf(e);for(let i=0;i<this.hashCount;i++){let a=this.pe(n,s,i);if(!this.ye(a))return!1}return!0}static create(t,e,n){let s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new r(i,s,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.fe===0)return;let e=wf(t),[n,s]=vf(e);for(let i=0;i<this.hashCount;i++){let a=this.pe(n,s,i);this.we(a)}}we(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},gn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Cs=class r{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let s=new Map;return s.set(t,Ds.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(z.min(),s,new at(G),qt(),K())}},Ds=class r{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,K(),K(),K())}};var Zn=class{constructor(t,e,n,s){this.Se=t,this.removedTargetIds=e,this.key=n,this.be=s}},eo=class{constructor(t,e){this.targetId=t,this.De=e}},no=class{constructor(t,e,n=gt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}},ro=class{constructor(){this.ve=0,this.Ce=If(),this.Fe=gt.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(t){t.approximateByteSize()>0&&(this.xe=!0,this.Fe=t)}Le(){let t=K(),e=K(),n=K();return this.Ce.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:L(38017,{changeType:i})}}),new Ds(this.Fe,this.Me,t,e,n)}ke(){this.xe=!1,this.Ce=If()}qe(t,e){this.xe=!0,this.Ce=this.Ce.insert(t,e)}Qe(t){this.xe=!0,this.Ce=this.Ce.remove(t)}$e(){this.ve+=1}Ue(){this.ve-=1,B(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},qu=class{constructor(t){this.We=t,this.Ge=new Map,this.ze=qt(),this.je=Si(),this.Je=Si(),this.He=new at(G)}Ye(t){for(let e of t.Se)t.be&&t.be.isFoundDocument()?this.Ze(e,t.be):this.Xe(e,t.key,t.be);for(let e of t.removedTargetIds)this.Xe(e,t.key,t.be)}et(t){this.forEachTarget(t,e=>{let n=this.tt(e);switch(t.state){case 0:this.nt(e)&&n.Be(t.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(t.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(e);break;case 3:this.nt(e)&&(n.Ke(),n.Be(t.resumeToken));break;case 4:this.nt(e)&&(this.rt(e),n.Be(t.resumeToken));break;default:L(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ge.forEach((n,s)=>{this.nt(s)&&e(s)})}it(t){let e=t.targetId,n=t.De.count,s=this.st(e);if(s){let i=s.target;if(Xi(i))if(n===0){let a=new M(i.path);this.Xe(e,a,Et.newNoDocument(a,z.min()))}else B(n===1,20013,{expectedCount:n});else{let a=this.ot(e);if(a!==n){let u=this._t(t),c=u?this.ut(u,t,a):1;if(c!==0){this.rt(e);let h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(e,h)}to?.ct(function(f,m,p,A,C){var x,N,U,$,j,W;let tt={localCacheCount:f,existenceFilterCount:m.count,databaseId:p.database,projectId:p.projectId},Q=m.unchangedNames;return Q&&(tt.bloomFilter={applied:C===0,hashCount:(x=Q?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:($=(U=(N=Q?.bits)===null||N===void 0?void 0:N.bitmap)===null||U===void 0?void 0:U.length)!==null&&$!==void 0?$:0,padding:(W=(j=Q?.bits)===null||j===void 0?void 0:j.padding)!==null&&W!==void 0?W:0,mightContain:v=>{var y;return(y=A?.mightContain(v))!==null&&y!==void 0&&y}}),tt}(a,t.De,this.We.lt(),u,c))}}}}_t(t){let e=t.De.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e,a,u;try{a=we(n).toUint8Array()}catch(c){if(c instanceof Qi)return Mt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Lu(a,s,i)}catch(c){return Mt(c instanceof gn?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.fe===0?null:u}ut(t,e,n){return e.De.count===n-this.ht(t,e.targetId)?0:2}ht(t,e){let n=this.We.getRemoteKeysForTarget(e),s=0;return n.forEach(i=>{let a=this.We.lt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(u)||(this.Xe(e,i,null),s++)}),s}Pt(t){let e=new Map;this.Ge.forEach((i,a)=>{let u=this.st(a);if(u){if(i.current&&Xi(u.target)){let c=new M(u.target.path);this.Tt(c).has(a)||this.It(a,c)||this.Xe(a,c,Et.newNoDocument(c,t))}i.Ne&&(e.set(a,i.Le()),i.ke())}});let n=K();this.Je.forEach((i,a)=>{let u=!0;a.forEachWhile(c=>{let h=this.st(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(i))}),this.ze.forEach((i,a)=>a.setReadTime(t));let s=new Cs(t,e,this.He,this.ze,n);return this.ze=qt(),this.je=Si(),this.Je=Si(),this.He=new at(G),s}Ze(t,e){if(!this.nt(t))return;let n=this.It(t,e.key)?2:0;this.tt(t).qe(e.key,n),this.ze=this.ze.insert(e.key,e),this.je=this.je.insert(e.key,this.Tt(e.key).add(t)),this.Je=this.Je.insert(e.key,this.dt(e.key).add(t))}Xe(t,e,n){if(!this.nt(t))return;let s=this.tt(t);this.It(t,e)?s.qe(e,1):s.Qe(e),this.Je=this.Je.insert(e,this.dt(e).delete(t)),this.Je=this.Je.insert(e,this.dt(e).add(t)),n&&(this.ze=this.ze.insert(e,n))}removeTarget(t){this.Ge.delete(t)}ot(t){let e=this.tt(t).Le();return this.We.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}$e(t){this.tt(t).$e()}tt(t){let e=this.Ge.get(t);return e||(e=new ro,this.Ge.set(t,e)),e}dt(t){let e=this.Je.get(t);return e||(e=new rt(G),this.Je=this.Je.insert(t,e)),e}Tt(t){let e=this.je.get(t);return e||(e=new rt(G),this.je=this.je.insert(t,e)),e}nt(t){let e=this.st(t)!==null;return e||k("WatchChangeAggregator","Detected inactive target",t),e}st(t){let e=this.Ge.get(t);return e&&e.Oe?null:this.We.Et(t)}rt(t){this.Ge.set(t,new ro),this.We.getRemoteKeysForTarget(t).forEach(e=>{this.Xe(t,e,null)})}It(t,e){return this.We.getRemoteKeysForTarget(t).has(e)}};function Si(){return new at(M.comparator)}function If(){return new at(M.comparator)}var J_={asc:"ASCENDING",desc:"DESCENDING"},Y_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Z_={and:"AND",or:"OR"},Uu=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Bu(r,t){return r.useProto3Json||Hs(t)?t:{value:t}}function gr(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function cg(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function tw(r,t){return gr(r,t.toTimestamp())}function mt(r){return B(!!r,49232),z.fromTimestamp(function(e){let n=_e(e);return new ct(n.seconds,n.nanos)}(r))}function Vl(r,t){return ju(r,t).canonicalString()}function ju(r,t){let e=function(s){return new X(["projects",s.projectId,"databases",s.database])}(r).child("documents");return t===void 0?e:e.child(t)}function lg(r){let t=X.fromString(r);return B(wg(t),10190,{key:t.toString()}),t}function xs(r,t){return Vl(r.databaseId,t.path)}function se(r,t){let e=lg(t);if(e.get(1)!==r.databaseId.projectId)throw new D(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new D(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new M(fg(e))}function hg(r,t){return Vl(r.databaseId,t)}function dg(r){let t=lg(r);return t.length===4?X.emptyPath():fg(t)}function $u(r){return new X(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function fg(r){return B(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function Tf(r,t,e){return{name:xs(r,t),fields:e.value.mapValue.fields}}function Ho(r,t,e){let n=se(r,t.name),s=mt(t.updateTime),i=t.createTime?mt(t.createTime):z.min(),a=new xt({mapValue:{fields:t.fields}}),u=Et.newFoundDocument(n,s,i,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function ew(r,t){return"found"in t?function(n,s){B(!!s.found,43571),s.found.name,s.found.updateTime;let i=se(n,s.found.name),a=mt(s.found.updateTime),u=s.found.createTime?mt(s.found.createTime):z.min(),c=new xt({mapValue:{fields:s.found.fields}});return Et.newFoundDocument(i,a,u,c)}(r,t):"missing"in t?function(n,s){B(!!s.missing,3894),B(!!s.readTime,22933);let i=se(n,s.missing),a=mt(s.readTime);return Et.newNoDocument(i,a)}(r,t):L(7234,{result:t})}function nw(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:L(39313,{state:h})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(h,f){return h.useProto3Json?(B(f===void 0||typeof f=="string",58123),gt.fromBase64String(f||"")):(B(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),gt.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(h){let f=h.code===void 0?S.UNKNOWN:ug(h.code);return new D(f,h.message||"")}(a);e=new no(n,s,i,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let s=se(r,n.document.name),i=mt(n.document.updateTime),a=n.document.createTime?mt(n.document.createTime):z.min(),u=new xt({mapValue:{fields:n.document.fields}}),c=Et.newFoundDocument(s,i,a,u),h=n.targetIds||[],f=n.removedTargetIds||[];e=new Zn(h,f,c.key,c)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let s=se(r,n.document),i=n.readTime?mt(n.readTime):z.min(),a=Et.newNoDocument(s,i),u=n.removedTargetIds||[];e=new Zn([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let s=se(r,n.document),i=n.removedTargetIds||[];e=new Zn([],i,s,null)}else{if(!("filter"in t))return L(11601,{At:t});{t.filter;let n=t.filter;n.targetId;let{count:s=0,unchangedNames:i}=n,a=new Mu(s,i),u=n.targetId;e=new eo(u,a)}}return e}function Ns(r,t){let e;if(t instanceof Ge)e={update:Tf(r,t.key,t.value)};else if(t instanceof Ke)e={delete:xs(r,t.key)};else if(t instanceof Jt)e={update:Tf(r,t.key,t.data),updateMask:uw(t.fieldMask)};else{if(!(t instanceof Rs))return L(16599,{Rt:t.type});e={verify:xs(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(i,a){let u=a.transform;if(u instanceof $e)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ve)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ie)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof ze)return{fieldPath:a.field.canonicalString(),increment:u.Ee};throw L(20930,{transform:a.transform})}(0,n))),t.precondition.isNone||(e.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:tw(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:L(27497)}(r,t.precondition)),e}function zu(r,t){let e=t.currentDocument?function(i){return i.updateTime!==void 0?dt.updateTime(mt(i.updateTime)):i.exists!==void 0?dt.exists(i.exists):dt.none()}(t.currentDocument):dt.none(),n=t.updateTransforms?t.updateTransforms.map(s=>function(a,u){let c=null;if("setToServerValue"in u)B(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),c=new $e;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new ve(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new Ie(f)}else"increment"in u?c=new ze(a,u.increment):L(16584,{proto:u});let h=Tt.fromServerFormat(u.fieldPath);return new In(h,c)}(r,s)):[];if(t.update){t.update.name;let s=se(r,t.update.name),i=new xt({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(c){let h=c.fieldPaths||[];return new $t(h.map(f=>Tt.fromServerFormat(f)))}(t.updateMask);return new Jt(s,i,a,e,n)}return new Ge(s,i,e,n)}if(t.delete){let s=se(r,t.delete);return new Ke(s,e)}if(t.verify){let s=se(r,t.verify);return new Rs(s,e)}return L(1463,{proto:t})}function rw(r,t){return r&&r.length>0?(B(t!==void 0,14353),r.map(e=>function(s,i){let a=s.updateTime?mt(s.updateTime):mt(i);return a.isEqual(z.min())&&(a=mt(i)),new Fu(a,s.transformResults||[])}(e,t))):[]}function mg(r,t){return{documents:[hg(r,t.path)]}}function Xo(r,t){let e={structuredQuery:{}},n=t.path,s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=hg(r,s);let i=function(h){if(h.length!==0)return _g(et.create(h,"and"))}(t.filters);i&&(e.structuredQuery.where=i);let a=function(h){if(h.length!==0)return h.map(f=>function(p){return{field:xe(p.field),direction:iw(p.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=Bu(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(t.endAt)),{Vt:e,parent:s}}function gg(r,t,e,n){let{Vt:s,parent:i}=Xo(r,t),a={},u=[],c=0;return e.forEach(h=>{let f=n?h.alias:"aggregate_"+c++;a[f]=h.alias,h.aggregateType==="count"?u.push({alias:f,count:{}}):h.aggregateType==="avg"?u.push({alias:f,avg:{field:xe(h.fieldPath)}}):h.aggregateType==="sum"&&u.push({alias:f,sum:{field:xe(h.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:u,structuredQuery:s.structuredQuery},parent:s.parent},ft:a,parent:i}}function pg(r){let t=dg(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,s=null;if(n>0){B(n===1,65062);let f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let i=[];e.where&&(i=function(m){let p=yg(m);return p instanceof et&&Sl(p)?p.getFilters():[p]}(e.where));let a=[];e.orderBy&&(a=function(m){return m.map(p=>function(C){return new wn(Hn(C.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(p))}(e.orderBy));let u=null;e.limit&&(u=function(m){let p;return p=typeof m=="object"?m.value:m,Hs(p)?null:p}(e.limit));let c=null;e.startAt&&(c=function(m){let p=!!m.before,A=m.values||[];return new ae(A,p)}(e.startAt));let h=null;return e.endAt&&(h=function(m){let p=!m.before,A=m.values||[];return new ae(A,p)}(e.endAt)),zm(t,s,a,i,u,"F",c,h)}function sw(r,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:s})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function yg(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=Hn(e.unaryFilter.field);return J.create(n,"==",{doubleValue:NaN});case"IS_NULL":let s=Hn(e.unaryFilter.field);return J.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=Hn(e.unaryFilter.field);return J.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Hn(e.unaryFilter.field);return J.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}}(r):r.fieldFilter!==void 0?function(e){return J.create(Hn(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return et.create(e.compositeFilter.filters.map(n=>yg(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return L(1026)}}(e.compositeFilter.op))}(r):L(30097,{filter:r})}function iw(r){return J_[r]}function ow(r){return Y_[r]}function aw(r){return Z_[r]}function xe(r){return{fieldPath:r.canonicalString()}}function Hn(r){return Tt.fromServerFormat(r.fieldPath)}function _g(r){return r instanceof J?function(e){if(e.op==="=="){if(af(e.value))return{unaryFilter:{field:xe(e.field),op:"IS_NAN"}};if(of(e.value))return{unaryFilter:{field:xe(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(af(e.value))return{unaryFilter:{field:xe(e.field),op:"IS_NOT_NAN"}};if(of(e.value))return{unaryFilter:{field:xe(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xe(e.field),op:ow(e.op),value:e.value}}}(r):r instanceof et?function(e){let n=e.getFilters().map(s=>_g(s));return n.length===1?n[0]:{compositeFilter:{op:aw(e.op),filters:n}}}(r):L(54877,{filter:r})}function uw(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function wg(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var pr=class r{constructor(t,e,n,s,i=z.min(),a=z.min(),u=gt.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var so=class{constructor(t){this.gt=t}};function cw(r,t){let e;if(t.document)e=Ho(r.gt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=M.fromSegments(t.noDocument.path),s=En(t.noDocument.readTime);e=Et.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L(56709);{let n=M.fromSegments(t.unknownDocument.path),s=En(t.unknownDocument.version);e=Et.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime(function(s){let i=new ct(s[0],s[1]);return z.fromTimestamp(i)}(t.readTime)),e}function Ef(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:io(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(i,a){return{name:xs(i,a.key),fields:a.data.value.mapValue.fields,updateTime:gr(i,a.version.toTimestamp()),createTime:gr(i,a.createTime.toTimestamp())}}(r.gt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:Tn(t.version)};else{if(!t.isUnknownDocument())return L(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:Tn(t.version)}}return n}function io(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function Tn(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function En(r){let t=new ct(r.seconds,r.nanoseconds);return z.fromTimestamp(t)}function hn(r,t){let e=(t.baseMutations||[]).map(i=>zu(r.gt,i));for(let i=0;i<t.mutations.length-1;++i){let a=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){let u=t.mutations[i+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}let n=t.mutations.map(i=>zu(r.gt,i)),s=ct.fromMillis(t.localWriteTimeMs);return new Ps(t.batchId,s,e,n)}function as(r){let t=En(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?En(r.lastLimboFreeSnapshotVersion):z.min(),n;return n=function(i){return i.documents!==void 0}(r.query)?function(i){let a=i.documents.length;return B(a===1,1966,{count:a}),kt(Rr(dg(i.documents[0])))}(r.query):function(i){return kt(pg(i))}(r.query),new pr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,gt.fromBase64String(r.resumeToken))}function vg(r,t){let e=Tn(t.snapshotVersion),n=Tn(t.lastLimboFreeSnapshotVersion),s;s=Xi(t.target)?mg(r.gt,t.target):Xo(r.gt,t.target).Vt;let i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:vn(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function Jo(r){let t=pg({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Yi(t,t.limit,"L"):t}function Ya(r,t){return new Vs(t.largestBatchId,zu(r.gt,t.overlayMutation))}function Af(r,t){let e=t.path.lastSegment();return[r,Nt(t.path.popLast()),e]}function Sf(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:Tn(n.readTime),documentKey:Nt(n.documentKey.path),largestBatchId:n.largestBatchId}}var Gu=class{getBundleMetadata(t,e){return bf(t).get(e).next(n=>{if(n)return function(i){return{id:i.bundleId,createTime:En(i.createTime),version:i.version}}(n)})}saveBundleMetadata(t,e){return bf(t).put(function(s){return{bundleId:s.id,createTime:Tn(mt(s.createTime)),version:s.version}}(e))}getNamedQuery(t,e){return Rf(t).get(e).next(n=>{if(n)return function(i){return{name:i.name,query:Jo(i.bundledQuery),readTime:En(i.readTime)}}(n)})}saveNamedQuery(t,e){return Rf(t).put(function(s){return{name:s.name,readTime:Tn(mt(s.readTime)),bundledQuery:s.bundledQuery}}(e))}};function bf(r){return At(r,$o)}function Rf(r){return At(r,zo)}var oo=class r{constructor(t,e){this.serializer=t,this.userId=e}static yt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return ns(t).get(Af(this.userId,e)).next(n=>n?Ya(this.serializer,n):null)}getOverlays(t,e){let n=ee();return R.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){let s=[];return n.forEach((i,a)=>{let u=new Vs(e,a);s.push(this.wt(t,u))}),R.waitFor(s)}removeOverlaysForBatchId(t,e,n){let s=new Set;e.forEach(a=>s.add(Nt(a.getCollectionPath())));let i=[];return s.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(ns(t).Y(vu,u))}),R.waitFor(i)}getOverlaysForCollection(t,e,n){let s=ee(),i=Nt(e),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ns(t).j(vu,a).next(u=>{for(let c of u){let h=Ya(this.serializer,c);s.set(h.getKey(),h)}return s})}getOverlaysForCollectionGroup(t,e,n,s){let i=ee(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return ns(t).X({index:Am,range:u},(c,h,f)=>{let m=Ya(this.serializer,h);i.size()<s||m.largestBatchId===a?(i.set(m.getKey(),m),a=m.largestBatchId):f.done()}).next(()=>i)}wt(t,e){return ns(t).put(function(s,i,a){let[u,c,h]=Af(i,a.mutation.key);return{userId:i,collectionPath:c,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Ns(s.gt,a.mutation)}}(this.serializer,this.userId,e))}};function ns(r){return At(r,Go)}var Ku=class{St(t){return At(t,Il)}getSessionToken(t){return this.St(t).get("sessionToken").next(e=>{let n=e?.value;return n?gt.fromUint8Array(n):gt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.St(t).put({name:"sessionToken",value:e.toUint8Array()})}};var me=class{constructor(){}bt(t,e){this.Dt(t,e),e.vt()}Dt(t,e){if("nullValue"in t)this.Ct(e,5);else if("booleanValue"in t)this.Ct(e,10),e.Ft(t.booleanValue?1:0);else if("integerValue"in t)this.Ct(e,15),e.Ft(ut(t.integerValue));else if("doubleValue"in t){let n=ut(t.doubleValue);isNaN(n)?this.Ct(e,13):(this.Ct(e,15),_s(n)?e.Ft(0):e.Ft(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ct(e,20),typeof n=="string"&&(n=_e(n)),e.Mt(`${n.seconds||""}`),e.Ft(n.nanos||0)}else if("stringValue"in t)this.xt(t.stringValue,e),this.Ot(e);else if("bytesValue"in t)this.Ct(e,30),e.Nt(we(t.bytesValue)),this.Ot(e);else if("referenceValue"in t)this.Bt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Ct(e,45),e.Ft(n.latitude||0),e.Ft(n.longitude||0)}else"mapValue"in t?Om(t)?this.Ct(e,Number.MAX_SAFE_INTEGER):Wo(t)?this.Lt(t.mapValue,e):(this.kt(t.mapValue,e),this.Ot(e)):"arrayValue"in t?(this.qt(t.arrayValue,e),this.Ot(e)):L(19022,{Qt:t})}xt(t,e){this.Ct(e,25),this.$t(t,e)}$t(t,e){e.Mt(t)}kt(t,e){let n=t.fields||{};this.Ct(e,55);for(let s of Object.keys(n))this.xt(s,e),this.Dt(n[s],e)}Lt(t,e){var n,s;let i=t.fields||{};this.Ct(e,53);let a=lr,u=((s=(n=i[a].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.length)||0;this.Ct(e,15),e.Ft(ut(u)),this.xt(a,e),this.Dt(i[a],e)}qt(t,e){let n=t.values||[];this.Ct(e,50);for(let s of n)this.Dt(s,e)}Bt(t,e){this.Ct(e,37),M.fromName(t).path.forEach(n=>{this.Ct(e,60),this.$t(n,e)})}Ct(t,e){t.Ft(e)}Ot(t){t.Ft(2)}};me.Ut=new me;var $n=255;function lw(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function Pf(r){let t=64-function(n){let s=0;for(let i=0;i<8;++i){let a=lw(255&n[i]);if(s+=a,a!==8)break}return s}(r);return Math.ceil(t/8)}var Qu=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Wt(n.value),n=e.next();this.Gt()}zt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.jt(n.value),n=e.next();this.Jt()}Ht(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Wt(n);else if(n<2048)this.Wt(960|n>>>6),this.Wt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Wt(480|n>>>12),this.Wt(128|63&n>>>6),this.Wt(128|63&n);else{let s=e.codePointAt(0);this.Wt(240|s>>>18),this.Wt(128|63&s>>>12),this.Wt(128|63&s>>>6),this.Wt(128|63&s)}}this.Gt()}Yt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.jt(n);else if(n<2048)this.jt(960|n>>>6),this.jt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.jt(480|n>>>12),this.jt(128|63&n>>>6),this.jt(128|63&n);else{let s=e.codePointAt(0);this.jt(240|s>>>18),this.jt(128|63&s>>>12),this.jt(128|63&s>>>6),this.jt(128|63&s)}}this.Jt()}Zt(t){let e=this.Xt(t),n=Pf(e);this.en(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}tn(t){let e=this.Xt(t),n=Pf(e);this.en(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}nn(){this.rn($n),this.rn(255)}sn(){this._n($n),this._n(255)}reset(){this.position=0}seed(t){this.en(t.length),this.buffer.set(t,this.position),this.position+=t.length}an(){return this.buffer.slice(0,this.position)}Xt(t){let e=function(i){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Wt(t){let e=255&t;e===0?(this.rn(0),this.rn(255)):e===$n?(this.rn($n),this.rn(0)):this.rn(e)}jt(t){let e=255&t;e===0?(this._n(0),this._n(255)):e===$n?(this._n($n),this._n(0)):this._n(t)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(t){this.en(1),this.buffer[this.position++]=t}_n(t){this.en(1),this.buffer[this.position++]=~t}en(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}},Wu=class{constructor(t){this.un=t}Nt(t){this.un.Kt(t)}Mt(t){this.un.Ht(t)}Ft(t){this.un.Zt(t)}vt(){this.un.nn()}},Hu=class{constructor(t){this.un=t}Nt(t){this.un.zt(t)}Mt(t){this.un.Yt(t)}Ft(t){this.un.tn(t)}vt(){this.un.sn()}},dn=class{constructor(){this.un=new Qu,this.cn=new Wu(this.un),this.ln=new Hu(this.un)}seed(t){this.un.seed(t)}hn(t){return t===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}};var fn=class r{constructor(t,e,n,s){this.Pn=t,this.Tn=e,this.In=n,this.dn=s}En(){let t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.dn,0),e!==t?n.set([0],this.dn.length):++n[n.length-1],new r(this.Pn,this.Tn,this.In,n)}An(t,e,n){return{indexId:this.Pn,uid:t,arrayValue:Mi(this.In),directionalValue:Mi(this.dn),orderedDocumentKey:Mi(e),documentKey:n.path.toArray()}}Rn(t,e,n){let s=this.An(t,e,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}};function Ve(r,t){let e=r.Pn-t.Pn;return e!==0?e:(e=Vf(r.In,t.In),e!==0?e:(e=Vf(r.dn,t.dn),e!==0?e:M.comparator(r.Tn,t.Tn)))}function Vf(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function Mi(r){return ja()?function(e){let n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n}(r):r}function Cf(r){return typeof r!="string"?r:function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(r)}var ao=class{constructor(t){this.Vn=new rt((e,n)=>Tt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.mn=t.orderBy,this.fn=[];for(let e of t.filters){let n=e;n.isInequality()?this.Vn=this.Vn.add(n):this.fn.push(n)}}get gn(){return this.Vn.size>1}pn(t){if(B(t.collectionGroup===this.collectionId,49279),this.gn)return!1;let e=fu(t);if(e!==void 0&&!this.yn(e))return!1;let n=un(t),s=new Set,i=0,a=0;for(;i<n.length&&this.yn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size>0){let u=this.Vn.getIterator().getNext();if(!s.has(u.field.canonicalString())){let c=n[i];if(!this.wn(u,c)||!this.Sn(this.mn[a++],c))return!1}++i}for(;i<n.length;++i){let u=n[i];if(a>=this.mn.length||!this.Sn(this.mn[a++],u))return!1}return!0}bn(){if(this.gn)return null;let t=new rt(Tt.comparator),e=[];for(let n of this.fn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new ge(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new ge(n.field,0))}for(let n of this.mn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new ge(n.field,n.dir==="asc"?0:1)));return new qe(qe.UNKNOWN_ID,this.collectionId,e,sr.empty())}yn(t){for(let e of this.fn)if(this.wn(e,t))return!0;return!1}wn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}Sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Ig(r){var t,e;if(B(r instanceof J||r instanceof et,20012),r instanceof J){if(r instanceof Hi){let s=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(i=>J.create(r.field,"==",i)))||[];return et.create(s,"or")}return r}let n=r.filters.map(s=>Ig(s));return et.create(n,r.op)}function hw(r){if(r.getFilters().length===0)return[];let t=Yu(Ig(r));return B(Tg(t),7391),Xu(t)||Ju(t)?[t]:t.getFilters()}function Xu(r){return r instanceof J}function Ju(r){return r instanceof et&&Sl(r)}function Tg(r){return Xu(r)||Ju(r)||function(e){if(e instanceof et&&Au(e)){for(let n of e.getFilters())if(!Xu(n)&&!Ju(n))return!1;return!0}return!1}(r)}function Yu(r){if(B(r instanceof J||r instanceof et,34018),r instanceof J)return r;if(r.filters.length===1)return Yu(r.filters[0]);let t=r.filters.map(n=>Yu(n)),e=et.create(t,r.op);return e=uo(e),Tg(e)?e:(B(e instanceof et,64498),B(dr(e),40251),B(e.filters.length>1,57927),e.filters.reduce((n,s)=>Cl(n,s)))}function Cl(r,t){let e;return B(r instanceof J||r instanceof et,38388),B(t instanceof J||t instanceof et,25473),e=r instanceof J?t instanceof J?function(s,i){return et.create([s,i],"and")}(r,t):Df(r,t):t instanceof J?Df(t,r):function(s,i){if(B(s.filters.length>0&&i.filters.length>0,48005),dr(s)&&dr(i))return Bm(s,i.getFilters());let a=Au(s)?s:i,u=Au(s)?i:s,c=a.filters.map(h=>Cl(h,u));return et.create(c,"or")}(r,t),uo(e)}function Df(r,t){if(dr(t))return Bm(t,r.getFilters());{let e=t.filters.map(n=>Cl(r,n));return et.create(e,"or")}}function uo(r){if(B(r instanceof J||r instanceof et,11850),r instanceof J)return r;let t=r.getFilters();if(t.length===1)return uo(t[0]);if(qm(r))return r;let e=t.map(s=>uo(s)),n=[];return e.forEach(s=>{s instanceof J?n.push(s):s instanceof et&&(s.op===r.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:et.create(n,r.op)}var Zu=class{constructor(){this.Dn=new ks}addToCollectionParentIndex(t,e){return this.Dn.add(e),R.resolve()}getCollectionParents(t,e){return R.resolve(this.Dn.getEntries(e))}addFieldIndex(t,e){return R.resolve()}deleteFieldIndex(t,e){return R.resolve()}deleteAllFieldIndexes(t){return R.resolve()}createTargetIndexes(t,e){return R.resolve()}getDocumentsMatchingTarget(t,e){return R.resolve(null)}getIndexType(t,e){return R.resolve(0)}getFieldIndexes(t,e){return R.resolve([])}getNextCollectionGroupToUpdate(t){return R.resolve(null)}getMinOffset(t,e){return R.resolve(Kt.min())}getMinOffsetFromCollectionGroup(t,e){return R.resolve(Kt.min())}updateCollectionGroup(t,e,n){return R.resolve()}updateIndexEntries(t,e){return R.resolve()}},ks=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new rt(X.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new rt(X.comparator)).toArray()}};var xf="IndexedDbIndexManager",bi=new Uint8Array(0),tc=class{constructor(t,e){this.databaseId=e,this.vn=new ks,this.Cn=new Xt(n=>vn(n),(n,s)=>Js(n,s)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){let n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener(()=>{this.vn.add(e)});let i={collectionId:n,parent:Nt(s)};return Nf(t).put(i)}return R.resolve()}getCollectionParents(t,e){let n=[],s=IDBKeyRange.bound([e,""],[hm(e),""],!1,!0);return Nf(t).j(s).next(i=>{for(let a of i){if(a.collectionId!==e)break;n.push(te(a.parent))}return n})}addFieldIndex(t,e){let n=rs(t),s=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(e);delete s.indexId;let i=n.add(s);if(e.indexState){let a=Gn(t);return i.next(u=>{a.put(Sf(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return i.next()}deleteFieldIndex(t,e){let n=rs(t),s=Gn(t),i=zn(t);return n.delete(e.indexId).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=rs(t),n=zn(t),s=Gn(t);return e.Y().next(()=>n.Y()).next(()=>s.Y())}createTargetIndexes(t,e){return R.forEach(this.Fn(e),n=>this.getIndexType(t,n).next(s=>{if(s===0||s===1){let i=new ao(n).bn();if(i!=null)return this.addFieldIndex(t,i)}}))}getDocumentsMatchingTarget(t,e){let n=zn(t),s=!0,i=new Map;return R.forEach(this.Fn(e),a=>this.Mn(t,a).next(u=>{s&&(s=!!u),i.set(a,u)})).next(()=>{if(s){let a=K(),u=[];return R.forEach(i,(c,h)=>{k(xf,`Using index ${function(j){return`id=${j.indexId}|cg=${j.collectionGroup}|f=${j.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(c)} to execute ${vn(e)}`);let f=function(j,W){let tt=fu(W);if(tt===void 0)return null;for(let Q of Ji(j,tt.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(h,c),m=function(j,W){let tt=new Map;for(let Q of un(W))for(let v of Ji(j,Q.fieldPath))switch(v.op){case"==":case"in":tt.set(Q.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return tt.set(Q.fieldPath.canonicalString(),v.value),Array.from(tt.values())}return null}(h,c),p=function(j,W){let tt=[],Q=!0;for(let v of un(W)){let y=v.kind===0?df(j,v.fieldPath,j.startAt):ff(j,v.fieldPath,j.startAt);tt.push(y.value),Q&&(Q=y.inclusive)}return new ae(tt,Q)}(h,c),A=function(j,W){let tt=[],Q=!0;for(let v of un(W)){let y=v.kind===0?ff(j,v.fieldPath,j.endAt):df(j,v.fieldPath,j.endAt);tt.push(y.value),Q&&(Q=y.inclusive)}return new ae(tt,Q)}(h,c),C=this.xn(c,h,p),x=this.xn(c,h,A),N=this.On(c,h,m),U=this.Nn(c.indexId,f,C,p.inclusive,x,A.inclusive,N);return R.forEach(U,$=>n.H($,e.limit).next(j=>{j.forEach(W=>{let tt=M.fromSegments(W.documentKey);a.has(tt)||(a=a.add(tt),u.push(tt))})}))}).next(()=>u)}return R.resolve(null)})}Fn(t){let e=this.Cn.get(t);return e||(t.filters.length===0?e=[t]:e=hw(et.create(t.filters,"and")).map(n=>Nu(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.Cn.set(t,e),e)}Nn(t,e,n,s,i,a,u){let c=(e!=null?e.length:1)*Math.max(n.length,i.length),h=c/(e!=null?e.length:1),f=[];for(let m=0;m<c;++m){let p=e?this.Bn(e[m/h]):bi,A=this.Ln(t,p,n[m%h],s),C=this.kn(t,p,i[m%h],a),x=u.map(N=>this.Ln(t,p,N,!0));f.push(...this.createRange(A,C,x))}return f}Ln(t,e,n,s){let i=new fn(t,M.empty(),e,n);return s?i:i.En()}kn(t,e,n,s){let i=new fn(t,M.empty(),e,n);return s?i.En():i}Mn(t,e){let n=new ao(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next(i=>{let a=null;for(let u of i)n.pn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,s=this.Fn(e);return R.forEach(s,i=>this.Mn(t,i).next(a=>{a?n!==0&&a.fields.length<function(c){let h=new rt(Tt.comparator),f=!1;for(let m of c.filters)for(let p of m.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?f=!0:h=h.add(p.field));for(let m of c.orderBy)m.field.isKeyField()||(h=h.add(m.field));return h.size+(f?1:0)}(i)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&s.length>1&&n===2?1:n)}qn(t,e){let n=new dn;for(let s of un(t)){let i=e.data.field(s.fieldPath);if(i==null)return null;let a=n.hn(s.kind);me.Ut.bt(i,a)}return n.an()}Bn(t){let e=new dn;return me.Ut.bt(t,e.hn(0)),e.an()}Qn(t,e){let n=new dn;return me.Ut.bt(_n(this.databaseId,e),n.hn(function(i){let a=un(i);return a.length===0?0:a[a.length-1].kind}(t))),n.an()}On(t,e,n){if(n===null)return[];let s=[];s.push(new dn);let i=0;for(let a of un(t)){let u=n[i++];for(let c of s)if(this.$n(e,a.fieldPath)&&bs(u))s=this.Un(s,a,u);else{let h=c.hn(a.kind);me.Ut.bt(u,h)}}return this.Kn(s)}xn(t,e,n){return this.On(t,e,n.position)}Kn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].an();return e}Un(t,e,n){let s=[...t],i=[];for(let a of n.arrayValue.values||[])for(let u of s){let c=new dn;c.seed(u.an()),me.Ut.bt(a,c.hn(e.kind)),i.push(c)}return i}$n(t,e){return!!t.filters.find(n=>n instanceof J&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=rs(t),s=Gn(t);return(e?n.j(wu,IDBKeyRange.bound(e,e)):n.j()).next(i=>{let a=[];return R.forEach(i,u=>s.get([u.indexId,this.uid]).next(c=>{a.push(function(f,m){let p=m?new sr(m.sequenceNumber,new Kt(En(m.readTime),new M(te(m.documentKey)),m.largestBatchId)):sr.empty(),A=f.fields.map(([C,x])=>new ge(Tt.fromServerFormat(C),x));return new qe(f.indexId,f.collectionGroup,A,p)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,s)=>{let i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:G(n.collectionGroup,s.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let s=rs(t),i=Gn(t);return this.Wn(t).next(a=>s.j(wu,IDBKeyRange.bound(e,e)).next(u=>R.forEach(u,c=>i.put(Sf(c.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return R.forEach(e,(s,i)=>{let a=n.get(s.collectionGroup);return(a?R.resolve(a):this.getFieldIndexes(t,s.collectionGroup)).next(u=>(n.set(s.collectionGroup,u),R.forEach(u,c=>this.Gn(t,s,c).next(h=>{let f=this.zn(i,c);return h.isEqual(f)?R.resolve():this.jn(t,i,c,h,f)}))))})}Jn(t,e,n,s){return zn(t).put(s.An(this.uid,this.Qn(n,e.key),e.key))}Hn(t,e,n,s){return zn(t).delete(s.Rn(this.uid,this.Qn(n,e.key),e.key))}Gn(t,e,n){let s=zn(t),i=new rt(Ve);return s.X({index:Em,range:IDBKeyRange.only([n.indexId,this.uid,Mi(this.Qn(n,e))])},(a,u)=>{i=i.add(new fn(n.indexId,e,Cf(u.arrayValue),Cf(u.directionalValue)))}).next(()=>i)}zn(t,e){let n=new rt(Ve),s=this.qn(e,t);if(s==null)return n;let i=fu(e);if(i!=null){let a=t.data.field(i.fieldPath);if(bs(a))for(let u of a.arrayValue.values||[])n=n.add(new fn(e.indexId,t.key,this.Bn(u),s))}else n=n.add(new fn(e.indexId,t.key,bi,s));return n}jn(t,e,n,s,i){k(xf,"Updating index entries for document '%s'",e.key);let a=[];return function(c,h,f,m,p){let A=c.getIterator(),C=h.getIterator(),x=jn(A),N=jn(C);for(;x||N;){let U=!1,$=!1;if(x&&N){let j=f(x,N);j<0?$=!0:j>0&&(U=!0)}else x!=null?$=!0:U=!0;U?(m(N),N=jn(C)):$?(p(x),x=jn(A)):(x=jn(A),N=jn(C))}}(s,i,Ve,u=>{a.push(this.Jn(t,e,n,u))},u=>{a.push(this.Hn(t,e,n,u))}),R.waitFor(a)}Wn(t){let e=1;return Gn(t).X({index:Tm,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,i)=>{i.done(),e=s.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>Ve(a,u)).filter((a,u,c)=>!u||Ve(a,c[u-1])!==0);let s=[];s.push(t);for(let a of n){let u=Ve(a,t),c=Ve(a,e);if(u===0)s[0]=t.En();else if(u>0&&c<0)s.push(a),s.push(a.En());else if(c>0)break}s.push(e);let i=[];for(let a=0;a<s.length;a+=2){if(this.Yn(s[a],s[a+1]))return[];let u=s[a].Rn(this.uid,bi,M.empty()),c=s[a+1].Rn(this.uid,bi,M.empty());i.push(IDBKeyRange.bound(u,c))}return i}Yn(t,e){return Ve(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(kf)}getMinOffset(t,e){return R.mapArray(this.Fn(e),n=>this.Mn(t,n).next(s=>s||L(44426))).next(kf)}};function Nf(r){return At(r,Is)}function zn(r){return At(r,ls)}function rs(r){return At(r,vl)}function Gn(r){return At(r,cs)}function kf(r){B(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let s=r[n].indexState.offset;yl(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new Kt(t.readTime,t.documentKey,e)}var Ff={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Eg=41943040,Lt=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};function Ag(r,t,e){let n=r.store(Wt),s=r.store(ir),i=[],a=IDBKeyRange.only(e.batchId),u=0,c=n.X({range:a},(f,m,p)=>(u++,p.delete()));i.push(c.next(()=>{B(u===1,47070,{batchId:e.batchId})}));let h=[];for(let f of e.mutations){let m=wm(t,f.key.path,e.batchId);i.push(s.delete(m)),h.push(f.key)}return R.waitFor(i).next(()=>h)}function co(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw L(14731);t=r.noDocument}return JSON.stringify(t).length}Lt.DEFAULT_COLLECTION_PERCENTILE=10,Lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lt.DEFAULT=new Lt(Eg,Lt.DEFAULT_COLLECTION_PERCENTILE,Lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lt.DISABLED=new Lt(-1,0,0);var lo=class r{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Zn={}}static yt(t,e,n,s){B(t.uid!=="",64387);let i=t.isAuthenticated()?t.uid:"";return new r(i,e,n,s)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ce(t).X({index:mn,range:n},(s,i,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,s){let i=Xn(t),a=Ce(t);return a.add({}).next(u=>{B(typeof u=="number",49019);let c=new Ps(u,e,n,s),h=function(A,C,x){let N=x.baseMutations.map($=>Ns(A.gt,$)),U=x.mutations.map($=>Ns(A.gt,$));return{userId:C,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:N,mutations:U}}(this.serializer,this.userId,c),f=[],m=new rt((p,A)=>G(p.canonicalString(),A.canonicalString()));for(let p of s){let A=wm(this.userId,p.key.path,u);m=m.add(p.key.path.popLast()),f.push(a.put(h)),f.push(i.put(A,d_))}return m.forEach(p=>{f.push(this.indexManager.addToCollectionParentIndex(t,p))}),t.addOnCommittedListener(()=>{this.Zn[u]=c.keys()}),R.waitFor(f).next(()=>c)})}lookupMutationBatch(t,e){return Ce(t).get(e).next(n=>n?(B(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),hn(this.serializer,n)):null)}Xn(t,e){return this.Zn[e]?R.resolve(this.Zn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let s=n.keys();return this.Zn[e]=s,s}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]),i=null;return Ce(t).X({index:mn,range:s},(a,u,c)=>{u.userId===this.userId&&(B(u.batchId>=n,47524,{er:n}),i=hn(this.serializer,u)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=Oe;return Ce(t).X({index:mn,range:e,reverse:!0},(s,i,a)=>{n=i.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,Oe],[this.userId,Number.POSITIVE_INFINITY]);return Ce(t).j(mn,e).next(n=>n.map(s=>hn(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=Di(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Xn(t).X({range:s},(a,u,c)=>{let[h,f,m]=a,p=te(f);if(h===this.userId&&e.path.isEqual(p))return Ce(t).get(m).next(A=>{if(!A)throw L(61480,{tr:a,batchId:m});B(A.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:A.userId,batchId:m}),i.push(hn(this.serializer,A))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new rt(G),s=[];return e.forEach(i=>{let a=Di(this.userId,i.path),u=IDBKeyRange.lowerBound(a),c=Xn(t).X({range:u},(h,f,m)=>{let[p,A,C]=h,x=te(A);p===this.userId&&i.path.isEqual(x)?n=n.add(C):m.done()});s.push(c)}),R.waitFor(s).next(()=>this.nr(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=Di(this.userId,n),a=IDBKeyRange.lowerBound(i),u=new rt(G);return Xn(t).X({range:a},(c,h,f)=>{let[m,p,A]=c,C=te(p);m===this.userId&&n.isPrefixOf(C)?C.length===s&&(u=u.add(A)):f.done()}).next(()=>this.nr(t,u))}nr(t,e){let n=[],s=[];return e.forEach(i=>{s.push(Ce(t).get(i).next(a=>{if(a===null)throw L(35274,{batchId:i});B(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),n.push(hn(this.serializer,a))}))}),R.waitFor(s).next(()=>n)}removeMutationBatch(t,e){return Ag(t.ce,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.rr(e.batchId)}),R.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))}rr(t){delete this.Zn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return R.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return Xn(t).X({range:n},(i,a,u)=>{if(i[0]===this.userId){let c=te(i[1]);s.push(c)}else u.done()}).next(()=>{B(s.length===0,56720,{ir:s.map(i=>i.canonicalString())})})})}containsKey(t,e){return Sg(t,this.userId,e)}sr(t){return bg(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:Oe,lastStreamToken:""})}};function Sg(r,t,e){let n=Di(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n),a=!1;return Xn(r).X({range:i,Z:!0},(u,c,h)=>{let[f,m,p]=u;f===t&&m===s&&(a=!0),h.done()}).next(()=>a)}function Ce(r){return At(r,Wt)}function Xn(r){return At(r,ir)}function bg(r){return At(r,ws)}var yr=class r{constructor(t){this._r=t}next(){return this._r+=2,this._r}static ar(){return new r(0)}static ur(){return new r(-1)}};var ec=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.cr(t).next(e=>{let n=new yr(e.highestTargetId);return e.highestTargetId=n.next(),this.lr(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.cr(t).next(e=>z.fromTimestamp(new ct(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.cr(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.cr(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.lr(t,s)))}addTargetData(t,e){return this.hr(t,e).next(()=>this.cr(t).next(n=>(n.targetCount+=1,this.Pr(e,n),this.lr(t,n))))}updateTargetData(t,e){return this.hr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Kn(t).delete(e.targetId)).next(()=>this.cr(t)).next(n=>(B(n.targetCount>0,8065),n.targetCount-=1,this.lr(t,n)))}removeTargets(t,e,n){let s=0,i=[];return Kn(t).X((a,u)=>{let c=as(u);c.sequenceNumber<=e&&n.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(t,c)))}).next(()=>R.waitFor(i)).next(()=>s)}forEachTarget(t,e){return Kn(t).X((n,s)=>{let i=as(s);e(i)})}cr(t){return Of(t).get(Gi).next(e=>(B(e!==null,2888),e))}lr(t,e){return Of(t).put(Gi,e)}hr(t,e){return Kn(t).put(vg(this.serializer,e))}Pr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.cr(t).next(e=>e.targetCount)}getTargetData(t,e){let n=vn(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Kn(t).X({range:s,index:Im},(a,u,c)=>{let h=as(u);Js(e,h.target)&&(i=h,c.done())}).next(()=>i)}addMatchingKeys(t,e,n){let s=[],i=Ne(t);return e.forEach(a=>{let u=Nt(a.path);s.push(i.put({targetId:n,path:u})),s.push(this.referenceDelegate.addReference(t,n,a))}),R.waitFor(s)}removeMatchingKeys(t,e,n){let s=Ne(t);return R.forEach(e,i=>{let a=Nt(i.path);return R.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(t,n,i)])})}removeMatchingKeysForTargetId(t,e){let n=Ne(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),s=Ne(t),i=K();return s.X({range:n,Z:!0},(a,u,c)=>{let h=te(a[1]),f=new M(h);i=i.add(f)}).next(()=>i)}containsKey(t,e){let n=Nt(e.path),s=IDBKeyRange.bound([n],[hm(n)],!1,!0),i=0;return Ne(t).X({index:wl,Z:!0,range:s},([a,u],c,h)=>{a!==0&&(i++,h.done())}).next(()=>i>0)}Et(t,e){return Kn(t).get(e).next(n=>n?as(n):null)}};function Kn(r){return At(r,or)}function Of(r){return At(r,yn)}function Ne(r){return At(r,ar)}var Mf="LruGarbageCollector",Rg=1048576;function Lf([r,t],[e,n]){let s=G(r,e);return s===0?G(t,n):s}var nc=class{constructor(t){this.Tr=t,this.buffer=new rt(Lf),this.Ir=0}dr(){return++this.Ir}Er(t){let e=[t,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();Lf(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},ho=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(t){k(Mf,`Garbage collection scheduled in ${t}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>V(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Xe(e)?k(Mf,"Ignoring IndexedDB error during garbage collection: ",e):yield He(e)}yield this.Rr(3e5)}))}},rc=class{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.mr(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return R.resolve(jt.ue);let n=new nc(e);return this.Vr.forEachTarget(t,s=>n.Er(s.sequenceNumber)).next(()=>this.Vr.gr(t,s=>n.Er(s))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Vr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(Ff)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ff):this.pr(t,e))}getCacheSize(t){return this.Vr.getCacheSize(t)}pr(t,e){let n,s,i,a,u,c,h,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),s=this.params.maximumSequenceNumbersToCollect):s=m,a=Date.now(),this.nthSequenceNumber(t,s))).next(m=>(n=m,u=Date.now(),this.removeTargets(t,n,e))).next(m=>(i=m,c=Date.now(),this.removeOrphanedDocuments(t,n))).next(m=>(h=Date.now(),Qn()<=Yt.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${i} targets in `+(c-u)+`ms
	Removed ${m} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:m})))}};function Pg(r,t){return new rc(r,t)}var sc=class{constructor(t,e){this.db=t,this.garbageCollector=Pg(this,e)}mr(t){let e=this.yr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}yr(t){let e=0;return this.gr(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}gr(t,e){return this.wr(t,(n,s)=>e(s))}addReference(t,e,n){return Ri(t,n)}removeReference(t,e,n){return Ri(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Ri(t,e)}Sr(t,e){return function(s,i){let a=!1;return bg(s).ee(u=>Sg(s,u,i).next(c=>(c&&(a=!0),R.resolve(!c)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],i=0;return this.wr(t,(a,u)=>{if(u<=e){let c=this.Sr(t,a).next(h=>{if(!h)return i++,n.getEntry(t,a).next(()=>(n.removeEntry(a,z.min()),Ne(t).delete(function(m){return[0,Nt(m.path)]}(a))))});s.push(c)}}).next(()=>R.waitFor(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Ri(t,e)}wr(t,e){let n=Ne(t),s,i=jt.ue;return n.X({index:wl},([a,u],{path:c,sequenceNumber:h})=>{a===0?(i!==jt.ue&&e(new M(te(s)),i),i=h,s=c):i=jt.ue}).next(()=>{i!==jt.ue&&e(new M(te(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Ri(r,t){return Ne(r).put(function(n,s){return{targetId:0,path:Nt(n.path),sequenceNumber:s}}(t,r.currentSequenceNumber))}var fo=class{constructor(){this.changes=new Xt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Et.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?R.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var ic=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return an(t).put(n)}removeEntry(t,e,n){return an(t).delete(function(i,a){let u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],io(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.br(t,n)))}getEntry(t,e){let n=Et.newInvalidDocument(e);return an(t).X({index:xi,range:IDBKeyRange.only(ss(e))},(s,i)=>{n=this.Dr(e,i)}).next(()=>n)}vr(t,e){let n={size:0,document:Et.newInvalidDocument(e)};return an(t).X({index:xi,range:IDBKeyRange.only(ss(e))},(s,i)=>{n={document:this.Dr(e,i),size:co(i)}}).next(()=>n)}getEntries(t,e){let n=qt();return this.Cr(t,e,(s,i)=>{let a=this.Dr(s,i);n=n.insert(s,a)}).next(()=>n)}Fr(t,e){let n=qt(),s=new at(M.comparator);return this.Cr(t,e,(i,a)=>{let u=this.Dr(i,a);n=n.insert(i,u),s=s.insert(i,co(a))}).next(()=>({documents:n,Mr:s}))}Cr(t,e,n){if(e.isEmpty())return R.resolve();let s=new rt(Bf);e.forEach(c=>s=s.add(c));let i=IDBKeyRange.bound(ss(s.first()),ss(s.last())),a=s.getIterator(),u=a.getNext();return an(t).X({index:xi,range:i},(c,h,f)=>{let m=M.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&Bf(u,m)<0;)n(u,null),u=a.getNext();u&&u.isEqual(m)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.G(ss(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,s,i){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),io(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return an(t).j(IDBKeyRange.bound(u,c,!0)).next(h=>{i?.incrementDocumentReadCount(h.length);let f=qt();for(let m of h){let p=this.Dr(M.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(Zs(e,p)||s.has(p.key))&&(f=f.insert(p.key,p))}return f})}getAllFromCollectionGroup(t,e,n,s){let i=qt(),a=Uf(e,n),u=Uf(e,Kt.max());return an(t).X({index:vm,range:IDBKeyRange.bound(a,u,!0)},(c,h,f)=>{let m=this.Dr(M.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);i=i.insert(m.key,m),i.size===s&&f.done()}).next(()=>i)}newChangeBuffer(t){return new oc(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return qf(t).get(_u).next(e=>(B(!!e,20021),e))}br(t,e){return qf(t).put(_u,e)}Dr(t,e){if(e){let n=cw(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(z.min())))return n}return Et.newInvalidDocument(t)}};function Vg(r){return new ic(r)}var oc=class extends fo{constructor(t,e){super(),this.Or=t,this.trackRemovals=e,this.Nr=new Xt(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(t){let e=[],n=0,s=new rt((i,a)=>G(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{let u=this.Nr.get(i);if(e.push(this.Or.removeEntry(t,i,u.readTime)),a.isValidDocument()){let c=Ef(this.Or.serializer,a);s=s.add(i.path.popLast());let h=co(c);n+=h-u.size,e.push(this.Or.addEntry(t,i,c))}else if(n-=u.size,this.trackRemovals){let c=Ef(this.Or.serializer,a.convertToNoDocument(z.min()));e.push(this.Or.addEntry(t,i,c))}}),s.forEach(i=>{e.push(this.Or.indexManager.addToCollectionParentIndex(t,i))}),e.push(this.Or.updateMetadata(t,n)),R.waitFor(e)}getFromCache(t,e){return this.Or.vr(t,e).next(n=>(this.Nr.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.Or.Fr(t,e).next(({documents:n,Mr:s})=>(s.forEach((i,a)=>{this.Nr.set(i,{size:a,readTime:n.get(i).readTime})}),n))}};function qf(r){return At(r,vs)}function an(r){return At(r,zi)}function ss(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Uf(r,t){let e=t.documentKey.path.toArray();return[r,io(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Bf(r,t){let e=r.path.toArray(),n=t.path.toArray(),s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=G(e[i],n[i]),s)return s;return s=G(e.length,n.length),s||(s=G(e[e.length-2],n[n.length-2]),s||G(e[e.length-1],n[n.length-1]))}var ac=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var mo=class{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(n=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(n!==null&&fs(n.mutation,s,$t.empty(),ct.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,K()).next(()=>n))}getLocalViewOfDocuments(t,e,n=K()){let s=ee();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,n).next(i=>{let a=os();return i.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=ee();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,K()))}populateOverlays(t,e,n){let s=[];return n.forEach(i=>{e.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(t,s).next(i=>{i.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,s){let i=qt(),a=ds(),u=function(){return ds()}();return e.forEach((c,h)=>{let f=n.get(h.key);s.has(h.key)&&(f===void 0||f.mutation instanceof Jt)?i=i.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),fs(f.mutation,h,f.mutation.getFieldMask(),ct.now())):a.set(h.key,$t.empty())}),this.recalculateAndSaveOverlays(t,i).next(c=>(c.forEach((h,f)=>a.set(h,f)),e.forEach((h,f)=>{var m;return u.set(h,new ac(f,(m=a.get(h))!==null&&m!==void 0?m:null))}),u))}recalculateAndSaveOverlays(t,e){let n=ds(),s=new at((a,u)=>a-u),i=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(c=>{let h=e.get(c);if(h===null)return;let f=n.get(c)||$t.empty();f=u.applyToLocalView(h,f),n.set(c,f);let m=(s.get(u.batchId)||K()).add(c);s=s.insert(u.batchId,m)})}).next(()=>{let a=[],u=s.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),h=c.key,f=c.value,m=Ym();f.forEach(p=>{if(!i.has(p)){let A=ig(e.get(p),n.get(p));A!==null&&m.set(p,A),i=i.add(p)}}),a.push(this.documentOverlayCache.saveOverlays(t,h,m))}return R.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,s){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):bl(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next(i=>{let a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):R.resolve(ee()),u=rr,c=i;return a.next(h=>R.forEach(h,(f,m)=>(u<m.largestBatchId&&(u=m.largestBatchId),i.get(f)?R.resolve():this.remoteDocumentCache.getEntry(t,f).next(p=>{c=c.insert(f,p)}))).next(()=>this.populateOverlays(t,h,i)).next(()=>this.computeViews(t,c,h,K())).next(f=>({batchId:u,changes:Jm(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(n=>{let s=os();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){let i=e.collectionGroup,a=os();return this.indexManager.getCollectionParents(t,i).next(u=>R.forEach(u,c=>{let h=function(m,p){return new Ht(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(e,c.child(i));return this.getDocumentsMatchingCollectionQuery(t,h,n,s).next(f=>{f.forEach((m,p)=>{a=a.insert(m,p)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s))).next(a=>{i.forEach((c,h)=>{let f=h.getKey();a.get(f)===null&&(a=a.insert(f,Et.newInvalidDocument(f)))});let u=os();return a.forEach((c,h)=>{let f=i.get(c);f!==void 0&&fs(f.mutation,h,$t.empty(),ct.now()),Zs(e,h)&&(u=u.insert(c,h))}),u})}};var uc=class{constructor(t){this.serializer=t,this.Br=new Map,this.Lr=new Map}getBundleMetadata(t,e){return R.resolve(this.Br.get(e))}saveBundleMetadata(t,e){return this.Br.set(e.id,function(s){return{id:s.id,version:s.version,createTime:mt(s.createTime)}}(e)),R.resolve()}getNamedQuery(t,e){return R.resolve(this.Lr.get(e))}saveNamedQuery(t,e){return this.Lr.set(e.name,function(s){return{name:s.name,query:Jo(s.bundledQuery),readTime:mt(s.readTime)}}(e)),R.resolve()}};var cc=class{constructor(){this.overlays=new at(M.comparator),this.kr=new Map}getOverlay(t,e){return R.resolve(this.overlays.get(e))}getOverlays(t,e){let n=ee();return R.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((s,i)=>{this.wt(t,e,i)}),R.resolve()}removeOverlaysForBatchId(t,e,n){let s=this.kr.get(n);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.kr.delete(n)),R.resolve()}getOverlaysForCollection(t,e,n){let s=ee(),i=e.length+1,a=new M(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let c=u.getNext().value,h=c.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===i&&c.largestBatchId>n&&s.set(c.getKey(),c)}return R.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new at((h,f)=>h-f),a=this.overlays.getIterator();for(;a.hasNext();){let h=a.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>n){let f=i.get(h.largestBatchId);f===null&&(f=ee(),i=i.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let u=ee(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=s)););return R.resolve(u)}wt(t,e,n){let s=this.overlays.get(n.key);if(s!==null){let a=this.kr.get(s.largestBatchId).delete(n.key);this.kr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Vs(e,n));let i=this.kr.get(e);i===void 0&&(i=K(),this.kr.set(e,i)),this.kr.set(e,i.add(n.key))}};var lc=class{constructor(){this.sessionToken=gt.EMPTY_BYTE_STRING}getSessionToken(t){return R.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,R.resolve()}};var Fs=class{constructor(){this.qr=new rt(_t.Qr),this.$r=new rt(_t.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(t,e){let n=new _t(t,e);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Wr(new _t(t,e))}Gr(t,e){t.forEach(n=>this.removeReference(n,e))}zr(t){let e=new M(new X([])),n=new _t(e,t),s=new _t(e,t+1),i=[];return this.$r.forEachInRange([n,s],a=>{this.Wr(a),i.push(a.key)}),i}jr(){this.qr.forEach(t=>this.Wr(t))}Wr(t){this.qr=this.qr.delete(t),this.$r=this.$r.delete(t)}Jr(t){let e=new M(new X([])),n=new _t(e,t),s=new _t(e,t+1),i=K();return this.$r.forEachInRange([n,s],a=>{i=i.add(a.key)}),i}containsKey(t){let e=new _t(t,0),n=this.qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},_t=class{constructor(t,e){this.key=t,this.Hr=e}static Qr(t,e){return M.comparator(t.key,e.key)||G(t.Hr,e.Hr)}static Ur(t,e){return G(t.Hr,e.Hr)||M.comparator(t.key,e.key)}};var hc=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.er=1,this.Yr=new rt(_t.Qr)}checkEmpty(t){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){let i=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Ps(i,e,n,s);this.mutationQueue.push(a);for(let u of s)this.Yr=this.Yr.add(new _t(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return R.resolve(a)}lookupMutationBatch(t,e){return R.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=this.Xr(n),i=s<0?0:s;return R.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?Oe:this.er-1)}getAllMutationBatches(t){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new _t(e,0),s=new _t(e,Number.POSITIVE_INFINITY),i=[];return this.Yr.forEachInRange([n,s],a=>{let u=this.Zr(a.Hr);i.push(u)}),R.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new rt(G);return e.forEach(s=>{let i=new _t(s,0),a=new _t(s,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([i,a],u=>{n=n.add(u.Hr)})}),R.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=n;M.isDocumentKey(i)||(i=i.child(""));let a=new _t(new M(i),0),u=new rt(G);return this.Yr.forEachWhile(c=>{let h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===s&&(u=u.add(c.Hr)),!0)},a),R.resolve(this.ei(u))}ei(t){let e=[];return t.forEach(n=>{let s=this.Zr(n);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){B(this.ti(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Yr;return R.forEach(e.mutations,s=>{let i=new _t(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Yr=n})}rr(t){}containsKey(t,e){let n=new _t(e,0),s=this.Yr.firstAfterOrEqual(n);return R.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,R.resolve()}ti(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){let e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var dc=class{constructor(t){this.ni=t,this.docs=function(){return new at(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,s=this.docs.get(n),i=s?s.size:0,a=this.ni(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return R.resolve(n?n.document.mutableCopy():Et.newInvalidDocument(e))}getEntries(t,e){let n=qt();return e.forEach(s=>{let i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():Et.newInvalidDocument(s))}),R.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=qt(),a=e.path,u=new M(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||yl(gm(f),n)<=0||(s.has(f.key)||Zs(e,f))&&(i=i.insert(f.key,f.mutableCopy()))}return R.resolve(i)}getAllFromCollectionGroup(t,e,n,s){L(9500)}ri(t,e){return R.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new fc(this)}getSize(t){return R.resolve(this.size)}},fc=class extends fo{constructor(t){super(),this.Or=t}applyChanges(t){let e=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?e.push(this.Or.addEntry(t,s)):this.Or.removeEntry(n)}),R.waitFor(e)}getFromCache(t,e){return this.Or.getEntry(t,e)}getAllFromCache(t,e){return this.Or.getEntries(t,e)}};var mc=class{constructor(t){this.persistence=t,this.ii=new Xt(e=>vn(e),Js),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.si=0,this.oi=new Fs,this.targetCount=0,this._i=yr.ar()}forEachTarget(t,e){return this.ii.forEach((n,s)=>e(s)),R.resolve()}getLastRemoteSnapshotVersion(t){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return R.resolve(this.si)}allocateTargetId(t){return this.highestTargetId=this._i.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.si&&(this.si=e),R.resolve()}hr(t){this.ii.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this._i=new yr(e),this.highestTargetId=e),t.sequenceNumber>this.si&&(this.si=t.sequenceNumber)}addTargetData(t,e){return this.hr(e),this.targetCount+=1,R.resolve()}updateTargetData(t,e){return this.hr(e),R.resolve()}removeTargetData(t,e){return this.ii.delete(e.target),this.oi.zr(e.targetId),this.targetCount-=1,R.resolve()}removeTargets(t,e,n){let s=0,i=[];return this.ii.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.ii.delete(a),i.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)}),R.waitFor(i).next(()=>s)}getTargetCount(t){return R.resolve(this.targetCount)}getTargetData(t,e){let n=this.ii.get(e)||null;return R.resolve(n)}addMatchingKeys(t,e,n){return this.oi.Kr(e,n),R.resolve()}removeMatchingKeys(t,e,n){this.oi.Gr(e,n);let s=this.persistence.referenceDelegate,i=[];return s&&e.forEach(a=>{i.push(s.markPotentiallyOrphaned(t,a))}),R.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.oi.zr(e),R.resolve()}getMatchingKeysForTargetId(t,e){let n=this.oi.Jr(e);return R.resolve(n)}containsKey(t,e){return R.resolve(this.oi.containsKey(e))}};var Os=class{constructor(t,e){this.ai={},this.overlays={},this.ui=new jt(0),this.ci=!1,this.ci=!0,this.li=new lc,this.referenceDelegate=t(this),this.hi=new mc(this),this.indexManager=new Zu,this.remoteDocumentCache=function(s){return new dc(s)}(n=>this.referenceDelegate.Pi(n)),this.serializer=new so(e),this.Ti=new uc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new cc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ai[t.toKey()];return n||(n=new hc(e,this.referenceDelegate),this.ai[t.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(t,e,n){k("MemoryPersistence","Starting transaction:",t);let s=new gc(this.ui.next());return this.referenceDelegate.Ii(),n(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ei(t,e){return R.or(Object.values(this.ai).map(n=>()=>n.containsKey(t,e)))}},gc=class extends Bi{constructor(t){super(),this.currentSequenceNumber=t}},go=class r{constructor(t){this.persistence=t,this.Ai=new Fs,this.Ri=null}static Vi(t){return new r(t)}get mi(){if(this.Ri)return this.Ri;throw L(60996)}addReference(t,e,n){return this.Ai.addReference(n,e),this.mi.delete(n.toString()),R.resolve()}removeReference(t,e,n){return this.Ai.removeReference(n,e),this.mi.add(n.toString()),R.resolve()}markPotentiallyOrphaned(t,e){return this.mi.add(e.toString()),R.resolve()}removeTarget(t,e){this.Ai.zr(e.targetId).forEach(s=>this.mi.add(s.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(i=>this.mi.add(i.toString()))}).next(()=>n.removeTargetData(t,e))}Ii(){this.Ri=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.mi,n=>{let s=M.fromPath(n);return this.fi(t,s).next(i=>{i||e.removeEntry(s,z.min())})}).next(()=>(this.Ri=null,e.apply(t)))}updateLimboDocument(t,e){return this.fi(t,e).next(n=>{n?this.mi.delete(e.toString()):this.mi.add(e.toString())})}Pi(t){return 0}fi(t,e){return R.or([()=>R.resolve(this.Ai.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}},po=class r{constructor(t,e){this.persistence=t,this.gi=new Xt(n=>Nt(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=Pg(this,e)}static Vi(t,e){return new r(t,e)}Ii(){}di(t){return R.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}mr(t){let e=this.yr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}yr(t){let e=0;return this.gr(t,n=>{e++}).next(()=>e)}gr(t,e){return R.forEach(this.gi,(n,s)=>this.Sr(t,n,s).next(i=>i?R.resolve():e(s)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ri(t,a=>this.Sr(t,a,e).next(u=>{u||(n++,i.removeEntry(a,z.min()))})).next(()=>i.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.gi.set(e,t.currentSequenceNumber),R.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.gi.set(n,t.currentSequenceNumber),R.resolve()}removeReference(t,e,n){return this.gi.set(n,t.currentSequenceNumber),R.resolve()}updateLimboDocument(t,e){return this.gi.set(e,t.currentSequenceNumber),R.resolve()}Pi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=ki(t.data.value)),e}Sr(t,e,n){return R.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.gi.get(e);return R.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var pc=class{constructor(t){this.serializer=t}q(t,e,n,s){let i=new ji("createOrUpgrade",e);n<1&&s>=1&&(function(c){c.createObjectStore(Xs)}(t),function(c){c.createObjectStore(ws,{keyPath:h_}),c.createObjectStore(Wt,{keyPath:tf,autoIncrement:!0}).createIndex(mn,ef,{unique:!0}),c.createObjectStore(ir)}(t),jf(t),function(c){c.createObjectStore(cn)}(t));let a=R.resolve();return n<3&&s>=3&&(n!==0&&(function(c){c.deleteObjectStore(ar),c.deleteObjectStore(or),c.deleteObjectStore(yn)}(t),jf(t)),a=a.next(()=>function(c){let h=c.store(yn),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return h.put(Gi,f)}(i))),n<4&&s>=4&&(n!==0&&(a=a.next(()=>function(c,h){return h.store(Wt).j().next(m=>{c.deleteObjectStore(Wt),c.createObjectStore(Wt,{keyPath:tf,autoIncrement:!0}).createIndex(mn,ef,{unique:!0});let p=h.store(Wt),A=m.map(C=>p.put(C));return R.waitFor(A)})}(t,i))),a=a.next(()=>{(function(c){c.createObjectStore(ur,{keyPath:v_})})(t)})),n<5&&s>=5&&(a=a.next(()=>this.pi(i))),n<6&&s>=6&&(a=a.next(()=>(function(c){c.createObjectStore(vs)}(t),this.yi(i)))),n<7&&s>=7&&(a=a.next(()=>this.wi(i))),n<8&&s>=8&&(a=a.next(()=>this.Si(t,i))),n<9&&s>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&s>=10&&(a=a.next(()=>this.bi(i))),n<11&&s>=11&&(a=a.next(()=>{(function(c){c.createObjectStore($o,{keyPath:I_})})(t),function(c){c.createObjectStore(zo,{keyPath:T_})}(t)})),n<12&&s>=12&&(a=a.next(()=>{(function(c){let h=c.createObjectStore(Go,{keyPath:V_});h.createIndex(vu,C_,{unique:!1}),h.createIndex(Am,D_,{unique:!1})})(t)})),n<13&&s>=13&&(a=a.next(()=>function(c){let h=c.createObjectStore(zi,{keyPath:f_});h.createIndex(xi,m_),h.createIndex(vm,g_)}(t)).next(()=>this.Di(t,i)).next(()=>t.deleteObjectStore(cn))),n<14&&s>=14&&(a=a.next(()=>this.Ci(t,i))),n<15&&s>=15&&(a=a.next(()=>function(c){c.createObjectStore(vl,{keyPath:E_,autoIncrement:!0}).createIndex(wu,A_,{unique:!1}),c.createObjectStore(cs,{keyPath:S_}).createIndex(Tm,b_,{unique:!1}),c.createObjectStore(ls,{keyPath:R_}).createIndex(Em,P_,{unique:!1})}(t))),n<16&&s>=16&&(a=a.next(()=>{e.objectStore(cs).clear()}).next(()=>{e.objectStore(ls).clear()})),n<17&&s>=17&&(a=a.next(()=>{(function(c){c.createObjectStore(Il,{keyPath:x_})})(t)})),n<18&&s>=18&&ja()&&(a=a.next(()=>{e.objectStore(cs).clear()}).next(()=>{e.objectStore(ls).clear()})),a}yi(t){let e=0;return t.store(cn).X((n,s)=>{e+=co(s)}).next(()=>{let n={byteSize:e};return t.store(vs).put(_u,n)})}pi(t){let e=t.store(ws),n=t.store(Wt);return e.j().next(s=>R.forEach(s,i=>{let a=IDBKeyRange.bound([i.userId,Oe],[i.userId,i.lastAcknowledgedBatchId]);return n.j(mn,a).next(u=>R.forEach(u,c=>{B(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});let h=hn(this.serializer,c);return Ag(t,i.userId,h).next(()=>{})}))}))}wi(t){let e=t.store(ar),n=t.store(cn);return t.store(yn).get(Gi).next(s=>{let i=[];return n.X((a,u)=>{let c=new X(a),h=function(m){return[0,Nt(m)]}(c);i.push(e.get(h).next(f=>f?R.resolve():(m=>e.put({targetId:0,path:Nt(m),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>R.waitFor(i))})}Si(t,e){t.createObjectStore(Is,{keyPath:w_});let n=e.store(Is),s=new ks,i=a=>{if(s.add(a)){let u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:Nt(c)})}};return e.store(cn).X({Z:!0},(a,u)=>{let c=new X(a);return i(c.popLast())}).next(()=>e.store(ir).X({Z:!0},([a,u,c],h)=>{let f=te(u);return i(f.popLast())}))}bi(t){let e=t.store(or);return e.X((n,s)=>{let i=as(s),a=vg(this.serializer,i);return e.put(a)})}Di(t,e){let n=e.store(cn),s=[];return n.X((i,a)=>{let u=e.store(zi),c=function(m){return m.document?new M(X.fromString(m.document.name).popFirst(5)):m.noDocument?M.fromSegments(m.noDocument.path):m.unknownDocument?M.fromSegments(m.unknownDocument.path):L(36783)}(a).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(u.put(h))}).next(()=>R.waitFor(s))}Ci(t,e){let n=e.store(Wt),s=Vg(this.serializer),i=new Os(go.Vi,this.serializer.gt);return n.j().next(a=>{let u=new Map;return a.forEach(c=>{var h;let f=(h=u.get(c.userId))!==null&&h!==void 0?h:K();hn(this.serializer,c).keys().forEach(m=>f=f.add(m)),u.set(c.userId,f)}),R.forEach(u,(c,h)=>{let f=new wt(h),m=oo.yt(this.serializer,f),p=i.getIndexManager(f),A=lo.yt(f,this.serializer,p,i.referenceDelegate);return new mo(s,A,m,p).recalculateAndSaveOverlaysForDocumentKeys(new Ts(e,jt.ue),c).next()})})}};function jf(r){r.createObjectStore(ar,{keyPath:y_}).createIndex(wl,__,{unique:!0}),r.createObjectStore(or,{keyPath:"targetId"}).createIndex(Im,p_,{unique:!0}),r.createObjectStore(yn)}var De="IndexedDbPersistence",Za=18e5,tu=5e3,eu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Cg="main",yc=class r{constructor(t,e,n,s,i,a,u,c,h,f,m=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Fi=i,this.window=a,this.document=u,this.Mi=h,this.xi=f,this.Oi=m,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=p=>Promise.resolve(),!r.C())throw new D(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sc(this,s),this.Qi=e+Cg,this.serializer=new so(c),this.$i=new Ue(this.Qi,this.Oi,new pc(this.serializer)),this.li=new Ku,this.hi=new ec(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Vg(this.serializer),this.Ti=new Gu,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,f===!1&&ft(De,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(S.FAILED_PRECONDITION,eu);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.hi.getHighestSequenceNumber(t))}).then(t=>{this.ui=new jt(t,this.Mi)}).then(()=>{this.ci=!0}).catch(t=>(this.$i&&this.$i.close(),Promise.reject(t)))}ji(t){return this.qi=e=>V(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.$i.setDatabaseDeletedListener(t)}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Fi.enqueueAndForget(()=>V(this,null,function*(){this.started&&(yield this.Ki())})))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Pi(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(t).next(e=>{e||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(t)).next(e=>this.isPrimary&&!e?this.Yi(t).next(()=>!1):!!e&&this.Zi(t).next(()=>!0))).catch(t=>{if(Xe(t))return k(De,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return k(De,"Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Fi.enqueueRetryable(()=>this.qi(t)),this.isPrimary=t})}Ji(t){return is(t).get(Bn).next(e=>R.resolve(this.Xi(e)))}es(t){return Pi(t).delete(this.clientId)}ts(){return V(this,null,function*(){if(this.isPrimary&&!this.ns(this.ki,Za)){this.ki=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=At(e,ur);return n.j().next(s=>{let i=this.rs(s,Za),a=s.filter(u=>i.indexOf(u)===-1);return R.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ui)for(let e of t)this.Ui.removeItem(this.ss(e.clientId))}})}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(t){return!!t&&t.ownerId===this.clientId}Hi(t){return this.xi?R.resolve(!0):is(t).get(Bn).next(e=>{if(e!==null&&this.ns(e.leaseTimestampMs,tu)&&!this._s(e.ownerId)){if(this.Xi(e)&&this.networkEnabled)return!0;if(!this.Xi(e)){if(!e.allowTabSynchronization)throw new D(S.FAILED_PRECONDITION,eu);return!1}}return!(!this.networkEnabled||!this.inForeground)||Pi(t).j().next(n=>this.rs(n,tu).find(s=>{if(this.clientId!==s.clientId){let i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,u=this.networkEnabled===s.networkEnabled;if(i||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&k(De,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return V(this,null,function*(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),yield this.$i.runTransaction("shutdown","readwrite",[Xs,ur],t=>{let e=new Ts(t,jt.ue);return this.Yi(e).next(()=>this.es(e))}),this.$i.close(),this.hs()})}rs(t,e){return t.filter(n=>this.ns(n.updateTimeMs,e)&&!this._s(n.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",t=>Pi(t).j().next(e=>this.rs(e,Za).map(n=>n.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(t,e){return lo.yt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new tc(t,this.serializer.gt.databaseId)}getDocumentOverlayCache(t){return oo.yt(this.serializer,t)}getBundleCache(){return this.Ti}runTransaction(t,e,n){k(De,"Starting transaction:",t);let s=e==="readonly"?"readonly":"readwrite",i=function(c){return c===18?F_:c===17?Pm:c===16?k_:c===15?Tl:c===14?Rm:c===13?bm:c===12?N_:c===11?Sm:void L(60245)}(this.Oi),a;return this.$i.runTransaction(t,s,i,u=>(a=new Ts(u,this.ui?this.ui.next():jt.ue),e==="readwrite-primary"?this.Ji(a).next(c=>!!c||this.Hi(a)).next(c=>{if(!c)throw ft(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new D(S.FAILED_PRECONDITION,pm);return n(a)}).next(c=>this.Zi(a).next(()=>c)):this.Ts(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ts(t){return is(t).get(Bn).next(e=>{if(e!==null&&this.ns(e.leaseTimestampMs,tu)&&!this._s(e.ownerId)&&!this.Xi(e)&&!(this.xi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new D(S.FAILED_PRECONDITION,eu)})}Zi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return is(t).put(Bn,e)}static C(){return Ue.C()}Yi(t){let e=is(t);return e.get(Bn).next(n=>this.Xi(n)?(k(De,"Releasing primary lease."),e.delete(Bn)):R.resolve())}ns(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(ft(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Ni=()=>{this.us();let e=/(?:Version|Mobile)\/1[456]/;Ba()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(t){var e;try{let n=((e=this.Ui)===null||e===void 0?void 0:e.getItem(this.ss(t)))!==null;return k(De,`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ft(De,"Failed to get zombied client id.",n),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(t){ft("Failed to set zombie client id.",t)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function is(r){return At(r,Xs)}function Pi(r){return At(r,ur)}function Dl(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var _c=class r{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Is=n,this.ds=s}static Es(t,e){let n=K(),s=K();for(let i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new r(t,e.fromCache,n,s)}};var wc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var yo=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return Ba()?8:ym(ts())>0?6:4}()}initialize(t,e){this.gs=t,this.indexManager=e,this.As=!0}getDocumentsMatchingQuery(t,e,n,s){let i={result:null};return this.ps(t,e).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ys(t,e,s,n).next(a=>{i.result=a})}).next(()=>{if(i.result)return;let a=new wc;return this.ws(t,e,a).next(u=>{if(i.result=u,this.Rs)return this.Ss(t,e,a,u.size)})}).next(()=>i.result)}Ss(t,e,n,s){return n.documentReadCount<this.Vs?(Qn()<=Yt.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Wn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),R.resolve()):(Qn()<=Yt.DEBUG&&k("QueryEngine","Query:",Wn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.fs*s?(Qn()<=Yt.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Wn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,kt(e))):R.resolve())}ps(t,e){if(mf(e))return R.resolve(null);let n=kt(e);return this.indexManager.getIndexType(t,n).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Yi(e,null,"F"),n=kt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(i=>{let a=K(...i);return this.gs.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(c=>{let h=this.bs(e,u);return this.Ds(e,h,a,c.readTime)?this.ps(t,Yi(e,null,"F")):this.vs(t,h,e,c)}))})))}ys(t,e,n,s){return mf(e)||s.isEqual(z.min())?R.resolve(null):this.gs.getDocuments(t,n).next(i=>{let a=this.bs(e,i);return this.Ds(e,a,n,s)?R.resolve(null):(Qn()<=Yt.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Wn(e)),this.vs(t,a,e,mm(s,rr)).next(u=>u))})}bs(t,e){let n=new rt(Hm(t));return e.forEach((s,i)=>{Zs(t,i)&&(n=n.add(i))}),n}Ds(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ws(t,e,n){return Qn()<=Yt.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Wn(e)),this.gs.getDocumentsMatchingQuery(t,e,Kt.min(),n)}vs(t,e,n,s){return this.gs.getDocumentsMatchingQuery(t,n,s).next(i=>(e.forEach(a=>{i=i.insert(a.key,a)}),i))}};var xl="LocalStore",dw=3e8,vc=class{constructor(t,e,n,s){this.persistence=t,this.Cs=e,this.serializer=s,this.Fs=new at(G),this.Ms=new Xt(i=>vn(i),Js),this.xs=new Map,this.Os=t.getRemoteDocumentCache(),this.hi=t.getTargetCache(),this.Ti=t.getBundleCache(),this.Ns(n)}Ns(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new mo(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Fs))}};function Dg(r,t,e,n){return new vc(r,t,e,n)}function xg(r,t){return V(this,null,function*(){let e=F(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,e.Ns(t),e.mutationQueue.getAllMutationBatches(n))).next(i=>{let a=[],u=[],c=K();for(let h of s){a.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}for(let h of i){u.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}return e.localDocuments.getDocuments(n,c).next(h=>({Bs:h,removedBatchIds:a,addedBatchIds:u}))})})})}function fw(r,t){let e=F(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let s=t.batch.keys(),i=e.Os.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){let m=h.batch,p=m.keys(),A=R.resolve();return p.forEach(C=>{A=A.next(()=>f.getEntry(c,C)).next(x=>{let N=h.docVersions.get(C);B(N!==null,48541),x.version.compareTo(N)<0&&(m.applyToRemoteDocument(x,h),x.isValidDocument()&&(x.setReadTime(h.commitVersion),f.addEntry(x)))})}),A.next(()=>u.mutationQueue.removeMutationBatch(c,m))}(e,n,t,i).next(()=>i.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=K();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(t))).next(()=>e.localDocuments.getDocuments(n,s))})}function Ng(r){let t=F(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}function mw(r,t){let e=F(r),n=t.snapshotVersion,s=e.Fs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let a=e.Os.newChangeBuffer({trackRemovals:!0});s=e.Fs;let u=[];t.targetChanges.forEach((f,m)=>{let p=s.get(m);if(!p)return;u.push(e.hi.removeMatchingKeys(i,f.removedDocuments,m).next(()=>e.hi.addMatchingKeys(i,f.addedDocuments,m)));let A=p.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(m)!==null?A=A.withResumeToken(gt.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,n)),s=s.insert(m,A),function(x,N,U){return x.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=dw?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(p,A,f)&&u.push(e.hi.updateTargetData(i,A))});let c=qt(),h=K();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(i,f))}),u.push(kg(i,a,t.documentUpdates).next(f=>{c=f.Ls,h=f.ks})),!n.isEqual(z.min())){let f=e.hi.getLastRemoteSnapshotVersion(i).next(m=>e.hi.setTargetsMetadata(i,i.currentSequenceNumber,n));u.push(f)}return R.waitFor(u).next(()=>a.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,c,h)).next(()=>c)}).then(i=>(e.Fs=s,i))}function kg(r,t,e){let n=K(),s=K();return e.forEach(i=>n=n.add(i)),t.getEntries(r,n).next(i=>{let a=qt();return e.forEach((u,c)=>{let h=i.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(u)),c.isNoDocument()&&c.version.isEqual(z.min())?(t.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(c),a=a.insert(u,c)):k(xl,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Ls:a,ks:s}})}function gw(r,t){let e=F(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=Oe),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function _r(r,t){let e=F(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return e.hi.getTargetData(n,t).next(i=>i?(s=i,R.resolve(s)):e.hi.allocateTargetId(n).next(a=>(s=new pr(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.hi.addTargetData(n,s).next(()=>s))))}).then(n=>{let s=e.Fs.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Fs=e.Fs.insert(n.targetId,n),e.Ms.set(t,n.targetId)),n})}function wr(r,t,e){return V(this,null,function*(){let n=F(r),s=n.Fs.get(t),i=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",i,a=>n.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Xe(a))throw a;k(xl,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Fs=n.Fs.remove(t),n.Ms.delete(s.target)})}function _o(r,t,e){let n=F(r),s=z.min(),i=K();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,f){let m=F(c),p=m.Ms.get(f);return p!==void 0?R.resolve(m.Fs.get(p)):m.hi.getTargetData(h,f)}(n,a,kt(t)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.hi.getMatchingKeysForTargetId(a,u.targetId).next(c=>{i=c})}).next(()=>n.Cs.getDocumentsMatchingQuery(a,t,e?s:z.min(),e?i:K())).next(u=>(Mg(n,Wm(t),u),{documents:u,qs:i})))}function Fg(r,t){let e=F(r),n=F(e.hi),s=e.Fs.get(t);return s?Promise.resolve(s.target):e.persistence.runTransaction("Get target data","readonly",i=>n.Et(i,t).next(a=>a?a.target:null))}function Og(r,t){let e=F(r),n=e.xs.get(t)||z.min();return e.persistence.runTransaction("Get new document changes","readonly",s=>e.Os.getAllFromCollectionGroup(s,t,mm(n,rr),Number.MAX_SAFE_INTEGER)).then(s=>(Mg(e,t,s),s))}function Mg(r,t,e){let n=r.xs.get(t)||z.min();e.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.xs.set(t,n)}function pw(r,t,e,n){return V(this,null,function*(){let s=F(r),i=K(),a=qt();for(let h of e){let f=t.Qs(h.metadata.name);h.document&&(i=i.add(f));let m=t.$s(h);m.setReadTime(t.Us(h.metadata.readTime)),a=a.insert(f,m)}let u=s.Os.newChangeBuffer({trackRemovals:!0}),c=yield _r(s,function(f){return kt(Rr(X.fromString(`__bundle__/docs/${f}`)))}(n));return s.persistence.runTransaction("Apply bundle documents","readwrite",h=>kg(h,u,a).next(f=>(u.apply(h),f)).next(f=>s.hi.removeMatchingKeysForTargetId(h,c.targetId).next(()=>s.hi.addMatchingKeys(h,i,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(h,f.Ls,f.ks)).next(()=>f.Ls)))})}function yw(n,s){return V(this,arguments,function*(r,t,e=K()){let i=yield _r(r,kt(Jo(t.bundledQuery))),a=F(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let c=mt(t.readTime);if(i.snapshotVersion.compareTo(c)>=0)return a.Ti.saveNamedQuery(u,t);let h=i.withResumeToken(gt.EMPTY_BYTE_STRING,c);return a.Fs=a.Fs.insert(h.targetId,h),a.hi.updateTargetData(u,h).next(()=>a.hi.removeMatchingKeysForTargetId(u,i.targetId)).next(()=>a.hi.addMatchingKeys(u,e,i.targetId)).next(()=>a.Ti.saveNamedQuery(u,t))})})}var Lg="firestore_clients";function $f(r,t){return`${Lg}_${r}_${t}`}var qg="firestore_mutations";function zf(r,t,e){let n=`${qg}_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}var Ug="firestore_targets";function nu(r,t){return`${Ug}_${r}_${t}`}var Zt="SharedClientState",wo=class r{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Ks(t,e,n){let s=JSON.parse(n),i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new D(s.error.code,s.error.message))),a?new r(t,e,s.state,i):(ft(Zt,`Failed to parse mutation state for ID '${e}': ${n}`),null)}Ws(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},ms=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ks(t,e){let n=JSON.parse(e),s,i=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return i&&n.error&&(i=typeof n.error.message=="string"&&typeof n.error.code=="string",i&&(s=new D(n.error.code,n.error.message))),i?new r(t,n.state,s):(ft(Zt,`Failed to parse target state for ID '${t}': ${e}`),null)}Ws(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},vo=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ks(t,e){let n=JSON.parse(e),s=typeof n=="object"&&n.activeTargetIds instanceof Array,i=Rl();for(let a=0;s&&a<n.activeTargetIds.length;++a)s=_m(n.activeTargetIds[a]),i=i.add(n.activeTargetIds[a]);return s?new r(t,i):(ft(Zt,`Failed to parse client data for instance '${t}': ${e}`),null)}},Ic=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Ks(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(ft(Zt,`Failed to parse online state: ${t}`),null)}},Ms=class{constructor(){this.activeTargetIds=Rl()}Gs(t){this.activeTargetIds=this.activeTargetIds.add(t)}zs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},gs=class{constructor(t,e,n,s,i){this.window=t,this.Fi=e,this.persistenceKey=n,this.js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new at(G),this.started=!1,this.Zs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=$f(this.persistenceKey,this.js),this.eo=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new Ms),this.no=new RegExp(`^${Lg}_${a}_([^_]*)$`),this.ro=new RegExp(`^${qg}_${a}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${Ug}_${a}_(\\d+)$`),this.so=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.oo=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(t){return!(!t||!t.localStorage)}start(){return V(this,null,function*(){let t=yield this.syncEngine.Ps();for(let n of t){if(n===this.js)continue;let s=this.getItem($f(this.persistenceKey,n));if(s){let i=vo.Ks(n,s);i&&(this.Ys=this.Ys.insert(i.clientId,i))}}this._o();let e=this.storage.getItem(this.so);if(e){let n=this.ao(e);n&&this.uo(n)}for(let n of this.Zs)this.Hs(n);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.eo,JSON.stringify(t))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(t){let e=!1;return this.Ys.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.lo(t,"pending")}updateMutationState(t,e,n){this.lo(t,e,n),this.ho(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let s=this.storage.getItem(nu(this.persistenceKey,t));if(s){let i=ms.Ks(t,s);i&&(n=i.state)}}return e&&this.Po.Gs(t),this._o(),n}removeLocalQueryTarget(t){this.Po.zs(t),this._o()}isLocalQueryTarget(t){return this.Po.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(nu(this.persistenceKey,t))}updateQueryState(t,e,n){this.To(t,e,n)}handleUserChange(t,e,n){e.forEach(s=>{this.ho(s)}),this.currentUser=t,n.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(t){this.Io(t)}notifyBundleLoaded(t){this.Eo(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return k(Zt,"READ",t,e),e}setItem(t,e){k(Zt,"SET",t,e),this.storage.setItem(t,e)}removeItem(t){k(Zt,"REMOVE",t),this.storage.removeItem(t)}Hs(t){let e=t;if(e.storageArea===this.storage){if(k(Zt,"EVENT",e.key,e.newValue),e.key===this.Xs)return void ft("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(()=>V(this,null,function*(){if(this.started){if(e.key!==null){if(this.no.test(e.key)){if(e.newValue==null){let n=this.Ao(e.key);return this.Ro(n,null)}{let n=this.Vo(e.key,e.newValue);if(n)return this.Ro(n.clientId,n)}}else if(this.ro.test(e.key)){if(e.newValue!==null){let n=this.mo(e.key,e.newValue);if(n)return this.fo(n)}}else if(this.io.test(e.key)){if(e.newValue!==null){let n=this.po(e.key,e.newValue);if(n)return this.yo(n)}}else if(e.key===this.so){if(e.newValue!==null){let n=this.ao(e.newValue);if(n)return this.uo(n)}}else if(e.key===this.eo){let n=function(i){let a=jt.ue;if(i!=null)try{let u=JSON.parse(i);B(typeof u=="number",30636,{wo:i}),a=u}catch(u){ft(Zt,"Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==jt.ue&&this.sequenceNumberHandler(n)}else if(e.key===this.oo){let n=this.So(e.newValue);yield Promise.all(n.map(s=>this.syncEngine.bo(s)))}}}else this.Zs.push(e)}))}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(t,e,n){let s=new wo(this.currentUser,t,e,n),i=zf(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Ws())}ho(t){let e=zf(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Io(t){let e={clientId:this.js,onlineState:t};this.storage.setItem(this.so,JSON.stringify(e))}To(t,e,n){let s=nu(this.persistenceKey,t),i=new ms(t,e,n);this.setItem(s,i.Ws())}Eo(t){let e=JSON.stringify(Array.from(t));this.setItem(this.oo,e)}Ao(t){let e=this.no.exec(t);return e?e[1]:null}Vo(t,e){let n=this.Ao(t);return vo.Ks(n,e)}mo(t,e){let n=this.ro.exec(t),s=Number(n[1]),i=n[2]!==void 0?n[2]:null;return wo.Ks(new wt(i),s,e)}po(t,e){let n=this.io.exec(t),s=Number(n[1]);return ms.Ks(s,e)}ao(t){return Ic.Ks(t)}So(t){return JSON.parse(t)}fo(t){return V(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Do(t.batchId,t.state,t.error);k(Zt,`Ignoring mutation for non-active user ${t.user.uid}`)})}yo(t){return this.syncEngine.vo(t.targetId,t.state,t.error)}Ro(t,e){let n=e?this.Ys.insert(t,e):this.Ys.remove(t),s=this.co(this.Ys),i=this.co(n),a=[],u=[];return i.forEach(c=>{s.has(c)||a.push(c)}),s.forEach(c=>{i.has(c)||u.push(c)}),this.syncEngine.Co(a,u).then(()=>{this.Ys=n})}uo(t){this.Ys.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}co(t){let e=Rl();return t.forEach((n,s)=>{e=e.unionWith(s.activeTargetIds)}),e}},Io=class{constructor(){this.Fo=new Ms,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Fo.Gs(t),this.Mo[t]||"not-current"}updateQueryState(t,e,n){this.Mo[t]=e}removeLocalQueryTarget(t){this.Fo.zs(t)}isLocalQueryTarget(t){return this.Fo.activeTargetIds.has(t)}clearQueryState(t){delete this.Mo[t]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(t){return this.Fo.activeTargetIds.has(t)}start(){return this.Fo=new Ms,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Tc=class{xo(t){}shutdown(){}};var Gf="ConnectivityMonitor",To=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(t){this.ko.push(t)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){k(Gf,"Network connectivity changed: AVAILABLE");for(let t of this.ko)t(0)}Lo(){k(Gf,"Network connectivity changed: UNAVAILABLE");for(let t of this.ko)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Vi=null;function Ec(){return Vi===null?Vi=function(){return 268435456+Math.round(2147483648*Math.random())}():Vi++,"0x"+Vi.toString(16)}var ru="RestConnection",_w={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Ac=class{get Qo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.$o=e+"://"+t.host,this.Uo=`projects/${n}/databases/${s}`,this.Ko=this.databaseId.database===As?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Wo(t,e,n,s,i){let a=Ec(),u=this.Go(t,e.toUriEncodedString());k(ru,`Sending RPC '${t}' ${a}:`,u,n);let c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(c,s,i);let{host:h}=new URL(u),f=Ti(h);return this.jo(t,u,c,n,f).then(m=>(k(ru,`Received RPC '${t}' ${a}: `,m),m),m=>{throw Mt(ru,`RPC '${t}' ${a} failed with error: `,m,"url: ",u,"request:",n),m})}Jo(t,e,n,s,i,a){return this.Wo(t,e,n,s,i)}zo(t,e,n){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+br}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,i)=>t[i]=s),n&&n.headers.forEach((s,i)=>t[i]=s)}Go(t,e){let n=_w[t];return`${this.$o}/v1/${e}:${n}`}terminate(){}};var Sc=class{constructor(t){this.Ho=t.Ho,this.Yo=t.Yo}Zo(t){this.Xo=t}e_(t){this.t_=t}n_(t){this.r_=t}onMessage(t){this.i_=t}close(){this.Yo()}send(t){this.Ho(t)}s_(){this.Xo()}o_(){this.t_()}__(t){this.r_(t)}a_(t){this.i_(t)}};var Dt="WebChannelConnection",bc=class extends Ac{constructor(t){super(t),this.u_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}jo(t,e,n,s,i){let a=Ec();return new Promise((u,c)=>{let h=new Qa;h.setWithCredentials(!0),h.listenOnce(Wa.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case es.NO_ERROR:let m=h.getResponseJson();k(Dt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(m)),u(m);break;case es.TIMEOUT:k(Dt,`RPC '${t}' ${a} timed out`),c(new D(S.DEADLINE_EXCEEDED,"Request time out"));break;case es.HTTP_ERROR:let p=h.getStatus();if(k(Dt,`RPC '${t}' ${a} failed with status:`,p,"response text:",h.getResponseText()),p>0){let A=h.getResponseJson();Array.isArray(A)&&(A=A[0]);let C=A?.error;if(C&&C.status&&C.message){let x=function(U){let $=U.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf($)>=0?$:S.UNKNOWN}(C.status);c(new D(x,C.message))}else c(new D(S.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new D(S.UNAVAILABLE,"Connection failed."));break;default:L(9055,{c_:t,streamId:a,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{k(Dt,`RPC '${t}' ${a} completed.`)}});let f=JSON.stringify(s);k(Dt,`RPC '${t}' ${a} sending request:`,s),h.send(e,"POST",f,n,15)})}P_(t,e,n){let s=Ec(),i=[this.$o,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Ja(),u=Xa(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.zo(c.initMessageHeaders,e,n),c.encodeInitMessageHeaders=!0;let f=i.join("");k(Dt,`Creating RPC '${t}' stream ${s}: ${f}`,c);let m=a.createWebChannel(f,c);this.T_(m);let p=!1,A=!1,C=new Sc({Ho:N=>{A?k(Dt,`Not sending because RPC '${t}' stream ${s} is closed:`,N):(p||(k(Dt,`Opening RPC '${t}' stream ${s} transport.`),m.open(),p=!0),k(Dt,`RPC '${t}' stream ${s} sending:`,N),m.send(N))},Yo:()=>m.close()}),x=(N,U,$)=>{N.listen(U,j=>{try{$(j)}catch(W){setTimeout(()=>{throw W},0)}})};return x(m,Un.EventType.OPEN,()=>{A||(k(Dt,`RPC '${t}' stream ${s} transport opened.`),C.s_())}),x(m,Un.EventType.CLOSE,()=>{A||(A=!0,k(Dt,`RPC '${t}' stream ${s} transport closed`),C.__(),this.I_(m))}),x(m,Un.EventType.ERROR,N=>{A||(A=!0,Mt(Dt,`RPC '${t}' stream ${s} transport errored. Name:`,N.name,"Message:",N.message),C.__(new D(S.UNAVAILABLE,"The operation could not be completed")))}),x(m,Un.EventType.MESSAGE,N=>{var U;if(!A){let $=N.data[0];B(!!$,16349);let j=$,W=j?.error||((U=j[0])===null||U===void 0?void 0:U.error);if(W){k(Dt,`RPC '${t}' stream ${s} received error:`,W);let tt=W.status,Q=function(w){let I=yt[w];if(I!==void 0)return ug(I)}(tt),v=W.message;Q===void 0&&(Q=S.INTERNAL,v="Unknown error status: "+tt+" with message "+W.message),A=!0,C.__(new D(Q,v)),m.close()}else k(Dt,`RPC '${t}' stream ${s} received:`,$),C.a_($)}}),x(u,Ha.STAT_EVENT,N=>{N.stat===Ai.PROXY?k(Dt,`RPC '${t}' stream ${s} detected buffering proxy`):N.stat===Ai.NOPROXY&&k(Dt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.o_()},0),C}terminate(){this.u_.forEach(t=>t.close()),this.u_=[]}T_(t){this.u_.push(t)}I_(t){this.u_=this.u_.filter(e=>e===t)}};function Bg(){return typeof window<"u"?window:null}function Li(){return typeof document<"u"?document:null}function Dn(r){return new Uu(r,!0)}var Ls=class{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Fi=t,this.timerId=e,this.d_=n,this.E_=s,this.A_=i,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(t){this.cancel();let e=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),s=Math.max(0,e-n);s>0&&k("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.R_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,s,()=>(this.m_=Date.now(),t())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var Kf="PersistentStream",Eo=class{constructor(t,e,n,s,i,a,u,c){this.Fi=t,this.w_=n,this.S_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Ls(t,e)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return V(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(t){this.q_(),this.stream.send(t)}L_(){return V(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(t,e){return V(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,t!==4?this.F_.reset():e&&e.code===S.RESOURCE_EXHAUSTED?(ft(e.toString()),ft("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):e&&e.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.n_(e)})}U_(){}auth(){this.state=1;let t=this.K_(this.b_),e=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.b_===e&&this.W_(n,s)},n=>{t(()=>{let s=new D(S.UNKNOWN,"Fetching auth token failed: "+n.message);return this.G_(s)})})}W_(t,e){let n=this.K_(this.b_);this.stream=this.z_(t,e),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.e_(()=>{n(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(s=>{n(()=>this.G_(s))}),this.stream.onMessage(s=>{n(()=>++this.C_==1?this.j_(s):this.onNext(s))})}O_(){this.state=5,this.F_.g_(()=>V(this,null,function*(){this.state=0,this.start()}))}G_(t){return k(Kf,`close with error: ${t}`),this.stream=null,this.close(4,t)}K_(t){return e=>{this.Fi.enqueueAndForget(()=>this.b_===t?e():(k(Kf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Rc=class extends Eo{constructor(t,e,n,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}z_(t,e){return this.connection.P_("Listen",t,e)}j_(t){return this.onNext(t)}onNext(t){this.F_.reset();let e=nw(this.serializer,t),n=function(i){if(!("targetChange"in i))return z.min();let a=i.targetChange;return a.targetIds&&a.targetIds.length?z.min():a.readTime?mt(a.readTime):z.min()}(t);return this.listener.J_(e,n)}H_(t){let e={};e.database=$u(this.serializer),e.addTarget=function(i,a){let u,c=a.target;if(u=Xi(c)?{documents:mg(i,c)}:{query:Xo(i,c).Vt},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=cg(i,a.resumeToken);let h=Bu(i,a.expectedCount);h!==null&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(z.min())>0){u.readTime=gr(i,a.snapshotVersion.toTimestamp());let h=Bu(i,a.expectedCount);h!==null&&(u.expectedCount=h)}return u}(this.serializer,t);let n=sw(this.serializer,t);n&&(e.labels=n),this.k_(e)}Y_(t){let e={};e.database=$u(this.serializer),e.removeTarget=t,this.k_(e)}},Pc=class extends Eo{constructor(t,e,n,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(t,e){return this.connection.P_("Write",t,e)}j_(t){return B(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,B(!t.writeResults||t.writeResults.length===0,55816),this.listener.ea()}onNext(t){B(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.F_.reset();let e=rw(t.writeResults,t.commitTime),n=mt(t.commitTime);return this.listener.ta(n,e)}na(){let t={};t.database=$u(this.serializer),this.k_(t)}X_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>Ns(this.serializer,n))};this.k_(e)}};var Vc=class{},Cc=class extends Vc{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ra=!1}ia(){if(this.ra)throw new D(S.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,n,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Wo(t,ju(e,n),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new D(S.UNKNOWN,i.toString())})}Jo(t,e,n,s,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Jo(t,ju(e,n),s,a,u,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new D(S.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Dc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(t){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ua("Offline")))}set(t){this.ha(),this.sa=0,t==="Online"&&(this._a=!1),this.ua(t)}ua(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ca(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(ft(e),this._a=!1):k("OnlineStateTracker",e)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var An="RemoteStore",xc=class{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=i,this.Ea.xo(a=>{n.enqueueAndForget(()=>V(this,null,function*(){Ye(this)&&(k(An,"Restarting streams for network reachability change."),yield function(c){return V(this,null,function*(){let h=F(c);h.Ia.add(4),yield Pr(h),h.Aa.set("Unknown"),h.Ia.delete(4),yield ti(h)})}(this))}))}),this.Aa=new Dc(n,s)}};function ti(r){return V(this,null,function*(){if(Ye(r))for(let t of r.da)yield t(!0)})}function Pr(r){return V(this,null,function*(){for(let t of r.da)yield t(!1)})}function Yo(r,t){let e=F(r);e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),Fl(e)?kl(e):Cr(e).x_()&&Nl(e,t))}function vr(r,t){let e=F(r),n=Cr(e);e.Ta.delete(t),n.x_()&&jg(e,t),e.Ta.size===0&&(n.x_()?n.B_():Ye(e)&&e.Aa.set("Unknown"))}function Nl(r,t){if(r.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(z.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Cr(r).H_(t)}function jg(r,t){r.Ra.$e(t),Cr(r).Y_(t)}function kl(r){r.Ra=new qu({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>r.Ta.get(t)||null,lt:()=>r.datastore.serializer.databaseId}),Cr(r).start(),r.Aa.aa()}function Fl(r){return Ye(r)&&!Cr(r).M_()&&r.Ta.size>0}function Ye(r){return F(r).Ia.size===0}function $g(r){r.Ra=void 0}function ww(r){return V(this,null,function*(){r.Aa.set("Online")})}function vw(r){return V(this,null,function*(){r.Ta.forEach((t,e)=>{Nl(r,t)})})}function Iw(r,t){return V(this,null,function*(){$g(r),Fl(r)?(r.Aa.la(t),kl(r)):r.Aa.set("Unknown")})}function Tw(r,t,e){return V(this,null,function*(){if(r.Aa.set("Online"),t instanceof no&&t.state===2&&t.cause)try{yield function(s,i){return V(this,null,function*(){let a=i.cause;for(let u of i.targetIds)s.Ta.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.Ta.delete(u),s.Ra.removeTarget(u))})}(r,t)}catch(n){k(An,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield Ao(r,n)}else if(t instanceof Zn?r.Ra.Ye(t):t instanceof eo?r.Ra.it(t):r.Ra.et(t),!e.isEqual(z.min()))try{let n=yield Ng(r.localStore);e.compareTo(n)>=0&&(yield function(i,a){let u=i.Ra.Pt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){let f=i.Ta.get(h);f&&i.Ta.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{let f=i.Ta.get(c);if(!f)return;i.Ta.set(c,f.withResumeToken(gt.EMPTY_BYTE_STRING,f.snapshotVersion)),jg(i,c);let m=new pr(f.target,c,h,f.sequenceNumber);Nl(i,m)}),i.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){k(An,"Failed to raise snapshot:",n),yield Ao(r,n)}})}function Ao(r,t,e){return V(this,null,function*(){if(!Xe(t))throw t;r.Ia.add(1),yield Pr(r),r.Aa.set("Offline"),e||(e=()=>Ng(r.localStore)),r.asyncQueue.enqueueRetryable(()=>V(null,null,function*(){k(An,"Retrying IndexedDB access"),yield e(),r.Ia.delete(1),yield ti(r)}))})}function zg(r,t){return t().catch(e=>Ao(r,e,t))}function Vr(r){return V(this,null,function*(){let t=F(r),e=Qe(t),n=t.Pa.length>0?t.Pa[t.Pa.length-1].batchId:Oe;for(;Ew(t);)try{let s=yield gw(t.localStore,n);if(s===null){t.Pa.length===0&&e.B_();break}n=s.batchId,Aw(t,s)}catch(s){yield Ao(t,s)}Gg(t)&&Kg(t)})}function Ew(r){return Ye(r)&&r.Pa.length<10}function Aw(r,t){r.Pa.push(t);let e=Qe(r);e.x_()&&e.Z_&&e.X_(t.mutations)}function Gg(r){return Ye(r)&&!Qe(r).M_()&&r.Pa.length>0}function Kg(r){Qe(r).start()}function Sw(r){return V(this,null,function*(){Qe(r).na()})}function bw(r){return V(this,null,function*(){let t=Qe(r);for(let e of r.Pa)t.X_(e.mutations)})}function Rw(r,t,e){return V(this,null,function*(){let n=r.Pa.shift(),s=Ou.from(n,t,e);yield zg(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield Vr(r)})}function Pw(r,t){return V(this,null,function*(){t&&Qe(r).Z_&&(yield function(n,s){return V(this,null,function*(){if(function(a){return ag(a)&&a!==S.ABORTED}(s.code)){let i=n.Pa.shift();Qe(n).N_(),yield zg(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s)),yield Vr(n)}})}(r,t)),Gg(r)&&Kg(r)})}function Qf(r,t){return V(this,null,function*(){let e=F(r);e.asyncQueue.verifyOperationInProgress(),k(An,"RemoteStore received new credentials");let n=Ye(e);e.Ia.add(3),yield Pr(e),n&&e.Aa.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),yield ti(e)})}function Nc(r,t){return V(this,null,function*(){let e=F(r);t?(e.Ia.delete(2),yield ti(e)):t||(e.Ia.add(2),yield Pr(e),e.Aa.set("Unknown"))})}function Cr(r){return r.Va||(r.Va=function(e,n,s){let i=F(e);return i.ia(),new Rc(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Zo:ww.bind(null,r),e_:vw.bind(null,r),n_:Iw.bind(null,r),J_:Tw.bind(null,r)}),r.da.push(t=>V(null,null,function*(){t?(r.Va.N_(),Fl(r)?kl(r):r.Aa.set("Unknown")):(yield r.Va.stop(),$g(r))}))),r.Va}function Qe(r){return r.ma||(r.ma=function(e,n,s){let i=F(e);return i.ia(),new Pc(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Zo:()=>Promise.resolve(),e_:Sw.bind(null,r),n_:Pw.bind(null,r),ea:bw.bind(null,r),ta:Rw.bind(null,r)}),r.da.push(t=>V(null,null,function*(){t?(r.ma.N_(),yield Vr(r)):(yield r.ma.stop(),r.Pa.length>0&&(k(An,`Stopping write stream with ${r.Pa.length} pending writes`),r.Pa=[]))}))),r.ma}var kc=class r{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new It,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){let a=Date.now()+n,u=new r(t,e,a,s,i);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Dr(r,t){if(ft("AsyncQueue",`${t}: ${r}`),Xe(r))return new D(S.UNAVAILABLE,`${t}: ${r}`);throw r}var qs=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||M.comparator(e.key,n.key):(e,n)=>M.comparator(e.key,n.key),this.keyedMap=os(),this.sortedSet=new at(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var So=class{constructor(){this.fa=new at(M.comparator)}track(t){let e=t.doc.key,n=this.fa.get(e);n?t.type!==0&&n.type===3?this.fa=this.fa.insert(e,t):t.type===3&&n.type!==1?this.fa=this.fa.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.fa=this.fa.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.fa=this.fa.remove(e):t.type===1&&n.type===2?this.fa=this.fa.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):L(63341,{At:t,ga:n}):this.fa=this.fa.insert(e,t)}pa(){let t=[];return this.fa.inorderTraversal((e,n)=>{t.push(n)}),t}},Sn=class r{constructor(t,e,n,s,i,a,u,c,h){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(t,e,n,s,i){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,qs.emptySet(e),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ys(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}};var Fc=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(t=>t.ba())}},Oc=class{constructor(){this.queries=Wf(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(e,n){let s=F(e),i=s.queries;s.queries=Wf(),i.forEach((a,u)=>{for(let c of u.wa)c.onError(n)})})(this,new D(S.ABORTED,"Firestore shutting down"))}};function Wf(){return new Xt(r=>Qm(r),Ys)}function Ol(r,t){return V(this,null,function*(){let e=F(r),n=3,s=t.query,i=e.queries.get(s);i?!i.Sa()&&t.ba()&&(n=2):(i=new Fc,n=t.ba()?0:1);try{switch(n){case 0:i.ya=yield e.onListen(s,!0);break;case 1:i.ya=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(a){let u=Dr(a,`Initialization of query '${Wn(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,i),i.wa.push(t),t.va(e.onlineState),i.ya&&t.Ca(i.ya)&&Ll(e)})}function Ml(r,t){return V(this,null,function*(){let e=F(r),n=t.query,s=3,i=e.queries.get(n);if(i){let a=i.wa.indexOf(t);a>=0&&(i.wa.splice(a,1),i.wa.length===0?s=t.ba()?0:1:!i.Sa()&&t.ba()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function Vw(r,t){let e=F(r),n=!1;for(let s of t){let i=s.query,a=e.queries.get(i);if(a){for(let u of a.wa)u.Ca(s)&&(n=!0);a.ya=s}}n&&Ll(e)}function Cw(r,t,e){let n=F(r),s=n.queries.get(t);if(s)for(let i of s.wa)i.onError(e);n.queries.delete(t)}function Ll(r){r.Da.forEach(t=>{t.next()})}var Mc,Hf;(Hf=Mc||(Mc={})).Fa="default",Hf.Cache="cache";var Us=class{constructor(t,e,n){this.query=t,this.Ma=e,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(t){if(!this.options.includeMetadataChanges){let n=[];for(let s of t.docChanges)s.type!==3&&n.push(s);t=new Sn(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.xa?this.Na(t)&&(this.Ma.next(t),e=!0):this.Ba(t,this.onlineState)&&(this.La(t),e=!0),this.Oa=t,e}onError(t){this.Ma.error(t)}va(t){this.onlineState=t;let e=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,t)&&(this.La(this.Oa),e=!0),e}Ba(t,e){if(!t.fromCache||!this.ba())return!0;let n=e!=="Offline";return(!this.options.ka||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Na(t){if(t.docChanges.length>0)return!0;let e=this.Oa&&this.Oa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}La(t){t=Sn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.xa=!0,this.Ma.next(t)}ba(){return this.options.source!==Mc.Cache}};var bo=class{constructor(t,e){this.qa=t,this.byteLength=e}Qa(){return"metadata"in this.qa}};var Ro=class{constructor(t){this.serializer=t}Qs(t){return se(this.serializer,t)}$s(t){return t.metadata.exists?Ho(this.serializer,t.document,!1):Et.newNoDocument(this.Qs(t.metadata.name),this.Us(t.metadata.readTime))}Us(t){return mt(t)}},Bs=class{constructor(t,e){this.$a=t,this.serializer=e,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=Qg(t)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.qa.namedQuery)this.Ua.push(t.qa.namedQuery);else if(t.qa.documentMetadata){this.Ka.push({metadata:t.qa.documentMetadata}),t.qa.documentMetadata.exists||++e;let n=X.fromString(t.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.qa.document&&(this.Ka[this.Ka.length-1].document=t.qa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Ga(t){let e=new Map,n=new Ro(this.serializer);for(let s of t)if(s.metadata.queries){let i=n.Qs(s.metadata.name);for(let a of s.metadata.queries){let u=(e.get(a)||K()).add(i);e.set(a,u)}}return e}za(t){return V(this,null,function*(){let e=yield pw(t,new Ro(this.serializer),this.Ka,this.$a.id),n=this.Ga(this.documents);for(let s of this.Ua)yield yw(t,s,n.get(s.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:e}})}};function Qg(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var Po=class{constructor(t){this.key=t}},Vo=class{constructor(t){this.key=t}},Co=class{constructor(t,e){this.query=t,this.Ha=e,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=K(),this.mutatedKeys=K(),this.Xa=Hm(t),this.eu=new qs(this.Xa)}get tu(){return this.Ha}nu(t,e){let n=e?e.ru:new So,s=e?e.eu:this.eu,i=e?e.mutatedKeys:this.mutatedKeys,a=s,u=!1,c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((f,m)=>{let p=s.get(f),A=Zs(this.query,m)?m:null,C=!!p&&this.mutatedKeys.has(p.key),x=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations),N=!1;p&&A?p.data.isEqual(A.data)?C!==x&&(n.track({type:3,doc:A}),N=!0):this.iu(p,A)||(n.track({type:2,doc:A}),N=!0,(c&&this.Xa(A,c)>0||h&&this.Xa(A,h)<0)&&(u=!0)):!p&&A?(n.track({type:0,doc:A}),N=!0):p&&!A&&(n.track({type:1,doc:p}),N=!0,(c||h)&&(u=!0)),N&&(A?(a=a.add(A),i=x?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),n.track({type:1,doc:f})}return{eu:a,ru:n,Ds:u,mutatedKeys:i}}iu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){let i=this.eu;this.eu=t.eu,this.mutatedKeys=t.mutatedKeys;let a=t.ru.pa();a.sort((f,m)=>function(A,C){let x=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{At:N})}};return x(A)-x(C)}(f.type,m.type)||this.Xa(f.doc,m.doc)),this.su(n),s=s!=null&&s;let u=e&&!s?this.ou():[],c=this.Za.size===0&&this.current&&!s?1:0,h=c!==this.Ya;return this.Ya=c,a.length!==0||h?{snapshot:new Sn(this.query,t.eu,i,a,t.mutatedKeys,c===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:u}:{_u:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new So,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(t){return!this.Ha.has(t)&&!!this.eu.has(t)&&!this.eu.get(t).hasLocalMutations}su(t){t&&(t.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=t.current)}ou(){if(!this.current)return[];let t=this.Za;this.Za=K(),this.eu.forEach(n=>{this.au(n.key)&&(this.Za=this.Za.add(n.key))});let e=[];return t.forEach(n=>{this.Za.has(n)||e.push(new Vo(n))}),this.Za.forEach(n=>{t.has(n)||e.push(new Po(n))}),e}uu(t){this.Ha=t.qs,this.Za=K();let e=this.nu(t.documents);return this.applyChanges(e,!0)}cu(){return Sn.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},Ze="SyncEngine",Lc=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},qc=class{constructor(t){this.key=t,this.lu=!1}},Uc=class{constructor(t,e,n,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new Xt(u=>Qm(u),Ys),this.Tu=new Map,this.Iu=new Set,this.du=new at(M.comparator),this.Eu=new Map,this.Au=new Fs,this.Ru={},this.Vu=new Map,this.mu=yr.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function Dw(r,t,e=!0){return V(this,null,function*(){let n=Zo(r),s,i=n.Pu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.cu()):s=yield Wg(n,t,e,!0),s})}function xw(r,t){return V(this,null,function*(){let e=Zo(r);yield Wg(e,t,!0,!1)})}function Wg(r,t,e,n){return V(this,null,function*(){let s=yield _r(r.localStore,kt(t)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,e),u;return n&&(u=yield ql(r,t,i,a==="current",s.resumeToken)),r.isPrimaryClient&&e&&Yo(r.remoteStore,s),u})}function ql(r,t,e,n,s){return V(this,null,function*(){r.gu=(m,p,A)=>function(x,N,U,$){return V(this,null,function*(){let j=N.view.nu(U);j.Ds&&(j=yield _o(x.localStore,N.query,!1).then(({documents:v})=>N.view.nu(v,j)));let W=$&&$.targetChanges.get(N.targetId),tt=$&&$.targetMismatches.get(N.targetId)!=null,Q=N.view.applyChanges(j,x.isPrimaryClient,W,tt);return Bc(x,N.targetId,Q._u),Q.snapshot})}(r,m,p,A);let i=yield _o(r.localStore,t,!0),a=new Co(t,i.qs),u=a.nu(i.documents),c=Ds.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),h=a.applyChanges(u,r.isPrimaryClient,c);Bc(r,e,h._u);let f=new Lc(t,e,a);return r.Pu.set(t,f),r.Tu.has(e)?r.Tu.get(e).push(t):r.Tu.set(e,[t]),h.snapshot})}function Nw(r,t,e){return V(this,null,function*(){let n=F(r),s=n.Pu.get(t),i=n.Tu.get(s.targetId);if(i.length>1)return n.Tu.set(s.targetId,i.filter(a=>!Ys(a,t))),void n.Pu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield wr(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),e&&vr(n.remoteStore,s.targetId),Ir(n,s.targetId)}).catch(He))):(Ir(n,s.targetId),yield wr(n.localStore,s.targetId,!0))})}function kw(r,t){return V(this,null,function*(){let e=F(r),n=e.Pu.get(t),s=e.Tu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),vr(e.remoteStore,n.targetId))})}function Fw(r,t,e){return V(this,null,function*(){let n=$l(r);try{let s=yield function(a,u){let c=F(a),h=ct.now(),f=u.reduce((A,C)=>A.add(C.key),K()),m,p;return c.persistence.runTransaction("Locally write mutations","readwrite",A=>{let C=qt(),x=K();return c.Os.getEntries(A,f).next(N=>{C=N,C.forEach((U,$)=>{$.isValidDocument()||(x=x.add(U))})}).next(()=>c.localDocuments.getOverlayedDocuments(A,C)).next(N=>{m=N;let U=[];for(let $ of u){let j=H_($,m.get($.key).overlayedDocument);j!=null&&U.push(new Jt($.key,j,Lm(j.value.mapValue),dt.exists(!0)))}return c.mutationQueue.addMutationBatch(A,h,U,u)}).next(N=>{p=N;let U=N.applyToLocalDocumentSet(m,x);return c.documentOverlayCache.saveOverlays(A,N.batchId,U)})}).then(()=>({batchId:p.batchId,changes:Jm(m)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),function(a,u,c){let h=a.Ru[a.currentUser.toKey()];h||(h=new at(G)),h=h.insert(u,c),a.Ru[a.currentUser.toKey()]=h}(n,s.batchId,e),yield Ae(n,s.changes),yield Vr(n.remoteStore)}catch(s){let i=Dr(s,"Failed to persist write");e.reject(i)}})}function Hg(r,t){return V(this,null,function*(){let e=F(r);try{let n=yield mw(e.localStore,t);t.targetChanges.forEach((s,i)=>{let a=e.Eu.get(i);a&&(B(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.lu=!0:s.modifiedDocuments.size>0?B(a.lu,14607):s.removedDocuments.size>0&&(B(a.lu,42227),a.lu=!1))}),yield Ae(e,n,t)}catch(n){yield He(n)}})}function Xf(r,t,e){let n=F(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let s=[];n.Pu.forEach((i,a)=>{let u=a.view.va(t);u.snapshot&&s.push(u.snapshot)}),function(a,u){let c=F(a);c.onlineState=u;let h=!1;c.queries.forEach((f,m)=>{for(let p of m.wa)p.va(u)&&(h=!0)}),h&&Ll(c)}(n.eventManager,t),s.length&&n.hu.J_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function Ow(r,t,e){return V(this,null,function*(){let n=F(r);n.sharedClientState.updateQueryState(t,"rejected",e);let s=n.Eu.get(t),i=s&&s.key;if(i){let a=new at(M.comparator);a=a.insert(i,Et.newNoDocument(i,z.min()));let u=K().add(i),c=new Cs(z.min(),new Map,new at(G),a,u);yield Hg(n,c),n.du=n.du.remove(i),n.Eu.delete(t),jl(n)}else yield wr(n.localStore,t,!1).then(()=>Ir(n,t,e)).catch(He)})}function Mw(r,t){return V(this,null,function*(){let e=F(r),n=t.batch.batchId;try{let s=yield fw(e.localStore,t);Bl(e,n,null),Ul(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield Ae(e,s)}catch(s){yield He(s)}})}function Lw(r,t,e){return V(this,null,function*(){let n=F(r);try{let s=yield function(a,u){let c=F(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(m=>(B(m!==null,37113),f=m.keys(),c.mutationQueue.removeMutationBatch(h,m))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,t);Bl(n,t,e),Ul(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield Ae(n,s)}catch(s){yield He(s)}})}function qw(r,t){return V(this,null,function*(){let e=F(r);Ye(e.remoteStore)||k(Ze,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=F(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(e.localStore);if(n===Oe)return void t.resolve();let s=e.Vu.get(n)||[];s.push(t),e.Vu.set(n,s)}catch(n){let s=Dr(n,"Initialization of waitForPendingWrites() operation failed");t.reject(s)}})}function Ul(r,t){(r.Vu.get(t)||[]).forEach(e=>{e.resolve()}),r.Vu.delete(t)}function Bl(r,t,e){let n=F(r),s=n.Ru[n.currentUser.toKey()];if(s){let i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.Ru[n.currentUser.toKey()]=s}}function Ir(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Tu.get(t))r.Pu.delete(n),e&&r.hu.pu(n,e);r.Tu.delete(t),r.isPrimaryClient&&r.Au.zr(t).forEach(n=>{r.Au.containsKey(n)||Xg(r,n)})}function Xg(r,t){r.Iu.delete(t.path.canonicalString());let e=r.du.get(t);e!==null&&(vr(r.remoteStore,e),r.du=r.du.remove(t),r.Eu.delete(e),jl(r))}function Bc(r,t,e){for(let n of e)n instanceof Po?(r.Au.addReference(n.key,t),Uw(r,n)):n instanceof Vo?(k(Ze,"Document no longer in limbo: "+n.key),r.Au.removeReference(n.key,t),r.Au.containsKey(n.key)||Xg(r,n.key)):L(19791,{yu:n})}function Uw(r,t){let e=t.key,n=e.path.canonicalString();r.du.get(e)||r.Iu.has(n)||(k(Ze,"New document in limbo: "+e),r.Iu.add(n),jl(r))}function jl(r){for(;r.Iu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){let t=r.Iu.values().next().value;r.Iu.delete(t);let e=new M(X.fromString(t)),n=r.mu.next();r.Eu.set(n,new qc(e)),r.du=r.du.insert(e,n),Yo(r.remoteStore,new pr(kt(Rr(e.path)),n,"TargetPurposeLimboResolution",jt.ue))}}function Ae(r,t,e){return V(this,null,function*(){let n=F(r),s=[],i=[],a=[];n.Pu.isEmpty()||(n.Pu.forEach((u,c)=>{a.push(n.gu(c,t,e).then(h=>{var f;if((h||e)&&n.isPrimaryClient){let m=h?!h.fromCache:(f=e?.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(h){s.push(h);let m=_c.Es(c.targetId,h);i.push(m)}}))}),yield Promise.all(a),n.hu.J_(s),yield function(c,h){return V(this,null,function*(){let f=F(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>R.forEach(h,p=>R.forEach(p.Is,A=>f.persistence.referenceDelegate.addReference(m,p.targetId,A)).next(()=>R.forEach(p.ds,A=>f.persistence.referenceDelegate.removeReference(m,p.targetId,A)))))}catch(m){if(!Xe(m))throw m;k(xl,"Failed to update sequence numbers: "+m)}for(let m of h){let p=m.targetId;if(!m.fromCache){let A=f.Fs.get(p),C=A.snapshotVersion,x=A.withLastLimboFreeSnapshotVersion(C);f.Fs=f.Fs.insert(p,x)}}})}(n.localStore,i))})}function Bw(r,t){return V(this,null,function*(){let e=F(r);if(!e.currentUser.isEqual(t)){k(Ze,"User change. New user:",t.toKey());let n=yield xg(e.localStore,t);e.currentUser=t,function(i,a){i.Vu.forEach(u=>{u.forEach(c=>{c.reject(new D(S.CANCELLED,a))})}),i.Vu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield Ae(e,n.Bs)}})}function jw(r,t){let e=F(r),n=e.Eu.get(t);if(n&&n.lu)return K().add(n.key);{let s=K(),i=e.Tu.get(t);if(!i)return s;for(let a of i){let u=e.Pu.get(a);s=s.unionWith(u.view.tu)}return s}}function $w(r,t){return V(this,null,function*(){let e=F(r),n=yield _o(e.localStore,t.query,!0),s=t.view.uu(n);return e.isPrimaryClient&&Bc(e,t.targetId,s._u),s})}function zw(r,t){return V(this,null,function*(){let e=F(r);return Og(e.localStore,t).then(n=>Ae(e,n))})}function Gw(r,t,e,n){return V(this,null,function*(){let s=F(r),i=yield function(u,c){let h=F(u),f=F(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",m=>f.Xn(m,c).next(p=>p?h.localDocuments.getDocuments(m,p):R.resolve(null)))}(s.localStore,t);i!==null?(e==="pending"?yield Vr(s.remoteStore):e==="acknowledged"||e==="rejected"?(Bl(s,t,n||null),Ul(s,t),function(u,c){F(F(u).mutationQueue).rr(c)}(s.localStore,t)):L(6720,"Unknown batchState",{wu:e}),yield Ae(s,i)):k(Ze,"Cannot apply mutation batch with id: "+t)})}function Kw(r,t){return V(this,null,function*(){let e=F(r);if(Zo(e),$l(e),t===!0&&e.fu!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),s=yield Jf(e,n.toArray());e.fu=!0,yield Nc(e.remoteStore,!0);for(let i of s)Yo(e.remoteStore,i)}else if(t===!1&&e.fu!==!1){let n=[],s=Promise.resolve();e.Tu.forEach((i,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):s=s.then(()=>(Ir(e,a),wr(e.localStore,a,!0))),vr(e.remoteStore,a)}),yield s,yield Jf(e,n),function(a){let u=F(a);u.Eu.forEach((c,h)=>{vr(u.remoteStore,h)}),u.Au.jr(),u.Eu=new Map,u.du=new at(M.comparator)}(e),e.fu=!1,yield Nc(e.remoteStore,!1)}})}function Jf(r,t,e){return V(this,null,function*(){let n=F(r),s=[],i=[];for(let a of t){let u,c=n.Tu.get(a);if(c&&c.length!==0){u=yield _r(n.localStore,kt(c[0]));for(let h of c){let f=n.Pu.get(h),m=yield $w(n,f);m.snapshot&&i.push(m.snapshot)}}else{let h=yield Fg(n.localStore,a);u=yield _r(n.localStore,h),yield ql(n,Jg(h),a,!1,u.resumeToken)}s.push(u)}return n.hu.J_(i),s})}function Jg(r){return zm(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Qw(r){return function(e){return F(F(e).persistence).Ps()}(F(r).localStore)}function Ww(r,t,e,n){return V(this,null,function*(){let s=F(r);if(s.fu)return void k(Ze,"Ignoring unexpected query state notification.");let i=s.Tu.get(t);if(i&&i.length>0)switch(e){case"current":case"not-current":{let a=yield Og(s.localStore,Wm(i[0])),u=Cs.createSynthesizedRemoteEventForCurrentChange(t,e==="current",gt.EMPTY_BYTE_STRING);yield Ae(s,a,u);break}case"rejected":yield wr(s.localStore,t,!0),Ir(s,t,n);break;default:L(64155,e)}})}function Hw(r,t,e){return V(this,null,function*(){let n=Zo(r);if(n.fu){for(let s of t){if(n.Tu.has(s)&&n.sharedClientState.isActiveQueryTarget(s)){k(Ze,"Adding an already active target "+s);continue}let i=yield Fg(n.localStore,s),a=yield _r(n.localStore,i);yield ql(n,Jg(i),a.targetId,!1,a.resumeToken),Yo(n.remoteStore,a)}for(let s of e)n.Tu.has(s)&&(yield wr(n.localStore,s,!1).then(()=>{vr(n.remoteStore,s),Ir(n,s)}).catch(He))}})}function Zo(r){let t=F(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Hg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=jw.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ow.bind(null,t),t.hu.J_=Vw.bind(null,t.eventManager),t.hu.pu=Cw.bind(null,t.eventManager),t}function $l(r){let t=F(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Mw.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Lw.bind(null,t),t}function Xw(r,t,e){let n=F(r);(function(i,a,u){return V(this,null,function*(){try{let c=yield a.getMetadata();if(yield function(A,C){let x=F(A),N=mt(C.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",U=>x.Ti.getBundleMetadata(U,C.id)).then(U=>!!U&&U.createTime.compareTo(N)>=0)}(i.localStore,c))return yield a.close(),u._completeWith(function(A){return{taskState:"Success",documentsLoaded:A.totalDocuments,bytesLoaded:A.totalBytes,totalDocuments:A.totalDocuments,totalBytes:A.totalBytes}}(c)),Promise.resolve(new Set);u._updateProgress(Qg(c));let h=new Bs(c,a.serializer),f=yield a.Su();for(;f;){let p=yield h.Wa(f);p&&u._updateProgress(p),f=yield a.Su()}let m=yield h.za(i.localStore);return yield Ae(i,m.Ja,void 0),yield function(A,C){let x=F(A);return x.persistence.runTransaction("Save bundle","readwrite",N=>x.Ti.saveBundleMetadata(N,C))}(i.localStore,c),u._completeWith(m.progress),Promise.resolve(m.ja)}catch(c){return Mt(Ze,`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(n,t,e).then(s=>{n.sharedClientState.notifyBundleLoaded(s)})}var ta=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return V(this,null,function*(){this.serializer=Dn(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)})}Cu(e,n){return null}Fu(e,n){return null}vu(e){return Dg(this.persistence,new yo,e.initialUser,this.serializer)}Du(e){return new Os(go.Vi,this.serializer)}bu(e){return new Io}terminate(){return V(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),js=class extends ta{constructor(t){super(),this.cacheSizeBytes=t}Cu(t,e){B(this.persistence.referenceDelegate instanceof po,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new ho(n,t.asyncQueue,e)}Du(t){let e=this.cacheSizeBytes!==void 0?Lt.withCacheSize(this.cacheSizeBytes):Lt.DEFAULT;return new Os(n=>po.Vi(n,e),this.serializer)}},$s=class r extends ta{constructor(t,e,n){super(),this.Mu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return V(this,null,function*(){yield Oa(r.prototype,this,"initialize").call(this,t),yield this.Mu.initialize(this,t),yield $l(this.Mu.syncEngine),yield Vr(this.Mu.remoteStore),yield this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(t){return Dg(this.persistence,new yo,t.initialUser,this.serializer)}Cu(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new ho(n,t.asyncQueue,e)}Fu(t,e){let n=new yu(e,this.persistence);return new pu(t.asyncQueue,n)}Du(t){let e=Dl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Lt.withCacheSize(this.cacheSizeBytes):Lt.DEFAULT;return new yc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Bg(),Li(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(t){return new Io}},Do=class r extends $s{constructor(t,e){super(t,e,!1),this.Mu=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return V(this,null,function*(){yield Oa(r.prototype,this,"initialize").call(this,t);let e=this.Mu.syncEngine;this.sharedClientState instanceof gs&&(this.sharedClientState.syncEngine={Do:Gw.bind(null,e),vo:Ww.bind(null,e),Co:Hw.bind(null,e),Ps:Qw.bind(null,e),bo:zw.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.ji(n=>V(this,null,function*(){yield Kw(this.Mu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}bu(t){let e=Bg();if(!gs.C(e))throw new D(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=Dl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new gs(e,t.asyncQueue,n,t.clientId,t.initialUser)}},xr=(()=>{class r{initialize(e,n){return V(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Xf(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Bw.bind(null,this.syncEngine),yield Nc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Oc}()}createDatastore(e){let n=Dn(e.databaseInfo.databaseId),s=function(a){return new bc(a)}(e.databaseInfo);return function(a,u,c,h){return new Cc(a,u,c,h)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return function(s,i,a,u,c){return new xc(s,i,a,u,c)}(this.localStore,this.datastore,e.asyncQueue,n=>Xf(this.syncEngine,n,0),function(){return To.C()?new To:new Tc}())}createSyncEngine(e,n){return function(i,a,u,c,h,f,m){let p=new Uc(i,a,u,c,h,f);return m&&(p.fu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return V(this,null,function*(){var e,n;yield function(i){return V(this,null,function*(){let a=F(i);k(An,"RemoteStore shutting down."),a.Ia.add(5),yield Pr(a),a.Ea.shutdown(),a.Aa.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();function Yf(r,t=10240){let e=0;return{read(){return V(this,null,function*(){if(e<r.byteLength){let s={value:r.slice(e,e+t),done:!1};return e+=t,s}return{done:!0}})},cancel(){return V(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Tr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.xu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.xu(this.observer.error,t):ft("Uncaught Error in snapshot listener:",t.toString()))}Ou(){this.muted=!0}xu(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var jc=class{constructor(t,e){this.Nu=t,this.serializer=e,this.metadata=new It,this.buffer=new Uint8Array,this.Bu=function(){return new TextDecoder("utf-8")}(),this.Lu().then(n=>{n&&n.Qa()?this.metadata.resolve(n.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.qa)}`))},n=>this.metadata.reject(n))}close(){return this.Nu.cancel()}getMetadata(){return V(this,null,function*(){return this.metadata.promise})}Su(){return V(this,null,function*(){return yield this.getMetadata(),this.Lu()})}Lu(){return V(this,null,function*(){let t=yield this.ku();if(t===null)return null;let e=this.Bu.decode(t),n=Number(e);isNaN(n)&&this.qu(`length string (${e}) is not valid number`);let s=yield this.Qu(n);return new bo(JSON.parse(s),t.length+n)})}$u(){return this.buffer.findIndex(t=>t===123)}ku(){return V(this,null,function*(){for(;this.$u()<0&&!(yield this.Uu()););if(this.buffer.length===0)return null;let t=this.$u();t<0&&this.qu("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}Qu(t){return V(this,null,function*(){for(;this.buffer.length<t;)(yield this.Uu())&&this.qu("Reached the end of bundle when more is expected.");let e=this.Bu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}qu(t){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${t}`)}Uu(){return V(this,null,function*(){let t=yield this.Nu.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var $c=class{constructor(t,e){this.bundleData=t,this.serializer=e,this.cursor=0,this.elements=[];let n=this.Su();if(!n||!n.Qa())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(n?.qa)}`);this.metadata=n;do n=this.Su(),n!==null&&this.elements.push(n);while(n!==null)}getMetadata(){return this.metadata}Ku(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let t=this.ku(),e=this.Qu(t);return new bo(JSON.parse(e),t)}Qu(t){if(this.cursor+t>this.bundleData.length)throw new D(S.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=t)}ku(){let t=this.cursor,e=this.cursor;for(;e<this.bundleData.length;){if(this.bundleData[e]==="{"){if(e===t)throw new Error("First character is a bracket and not a number");return this.cursor=e,Number(this.bundleData.slice(t,e))}e++}throw new Error("Reached the end of bundle when more is expected.")}};var zc=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(s,i){return V(this,null,function*(){let a=F(s),u={documents:i.map(m=>xs(a.serializer,m))},c=yield a.Jo("BatchGetDocuments",a.serializer.databaseId,X.emptyPath(),u,i.length),h=new Map;c.forEach(m=>{let p=ew(a.serializer,m);h.set(p.key.toString(),p)});let f=[];return i.forEach(m=>{let p=h.get(m.toString());B(!!p,55234,{key:m}),f.push(p)}),f})}(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ke(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let s=M.fromPath(n);this.mutations.push(new Rs(s,this.precondition(s)))}),yield function(n,s){return V(this,null,function*(){let i=F(n),a={writes:s.map(u=>Ns(i.serializer,u))};yield i.Wo("Commit",i.serializer.databaseId,X.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L(50498,{Wu:t.constructor.name});e=z.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new D(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(z.min())?dt.exists(!1):dt.updateTime(e):dt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(z.min()))throw new D(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return dt.updateTime(e)}return dt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var Gc=class{constructor(t,e,n,s,i){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=s,this.deferred=i,this.Gu=n.maxAttempts,this.F_=new Ls(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(()=>V(this,null,function*(){let t=new zc(this.datastore),e=this.Ju(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(s=>{this.Hu(s)}))}).catch(n=>{this.Hu(n)})}))}Ju(t){try{let e=this.updateFunction(t);return!Hs(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Hu(t){this.Gu>0&&this.Yu(t)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(t)}Yu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!ag(e)}return!1}};var We="FirestoreClient",Kc=class{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=wt.UNAUTHENTICATED,this.clientId=ys.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,a=>V(this,null,function*(){k(We,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(k(We,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new It;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=Dr(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function su(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),k(We,"Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(s=>V(null,null,function*(){n.isEqual(s)||(yield xg(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener(()=>{Mt("Terminating Firestore due to IndexedDb database deletion"),r.terminate().then(()=>{k("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(s=>{Mt("Terminating Firestore due to IndexedDb database deletion failed",s)})}),r._offlineComponents=t})}function Zf(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield zl(r);k(We,"Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Qf(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Qf(t.remoteStore,s)),r._onlineComponents=t})}function zl(r){return V(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){k(We,"Using user provided OfflineComponentProvider");try{yield su(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;Mt("Error using user provided cache. Falling back to memory cache: "+e),yield su(r,new ta)}}else k(We,"Using default OfflineComponentProvider"),yield su(r,new js(void 0));return r._offlineComponents})}function ea(r){return V(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(k(We,"Using user provided OnlineComponentProvider"),yield Zf(r,r._uninitializedComponentsProvider._online)):(k(We,"Using default OnlineComponentProvider"),yield Zf(r,new xr))),r._onlineComponents})}function Yg(r){return zl(r).then(t=>t.persistence)}function Nr(r){return zl(r).then(t=>t.localStore)}function Zg(r){return ea(r).then(t=>t.remoteStore)}function Gl(r){return ea(r).then(t=>t.syncEngine)}function tp(r){return ea(r).then(t=>t.datastore)}function Er(r){return V(this,null,function*(){let t=yield ea(r),e=t.eventManager;return e.onListen=Dw.bind(null,t.syncEngine),e.onUnlisten=Nw.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=xw.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=kw.bind(null,t.syncEngine),e})}function Jw(r){return r.asyncQueue.enqueue(()=>V(null,null,function*(){let t=yield Yg(r),e=yield Zg(r);return t.setNetworkEnabled(!0),function(s){let i=F(s);return i.Ia.delete(0),ti(i)}(e)}))}function Yw(r){return r.asyncQueue.enqueue(()=>V(null,null,function*(){let t=yield Yg(r),e=yield Zg(r);return t.setNetworkEnabled(!1),function(s){return V(this,null,function*(){let i=F(s);i.Ia.add(0),yield Pr(i),i.Aa.set("Offline")})}(e)}))}function Zw(r,t){let e=new It;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(s,i,a){return V(this,null,function*(){try{let u=yield function(h,f){let m=F(h);return m.persistence.runTransaction("read document","readonly",p=>m.localDocuments.getDocument(p,f))}(s,i);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new D(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=Dr(u,`Failed to get document '${i} from cache`);a.reject(c)}})}(yield Nr(r),t,e)})),e.promise}function ep(r,t,e={}){let n=new It;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(i,a,u,c,h){let f=new Tr({next:p=>{f.Ou(),a.enqueueAndForget(()=>Ml(i,m));let A=p.docs.has(u);!A&&p.fromCache?h.reject(new D(S.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&p.fromCache&&c&&c.source==="server"?h.reject(new D(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(p)},error:p=>h.reject(p)}),m=new Us(Rr(u.path),f,{includeMetadataChanges:!0,ka:!0});return Ol(i,m)}(yield Er(r),r.asyncQueue,t,e,n)})),n.promise}function tv(r,t){let e=new It;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(s,i,a){return V(this,null,function*(){try{let u=yield _o(s,i,!0),c=new Co(i,u.qs),h=c.nu(u.documents),f=c.applyChanges(h,!1);a.resolve(f.snapshot)}catch(u){let c=Dr(u,`Failed to execute query '${i} against cache`);a.reject(c)}})}(yield Nr(r),t,e)})),e.promise}function np(r,t,e={}){let n=new It;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(i,a,u,c,h){let f=new Tr({next:p=>{f.Ou(),a.enqueueAndForget(()=>Ml(i,m)),p.fromCache&&c.source==="server"?h.reject(new D(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(p)},error:p=>h.reject(p)}),m=new Us(u,f,{includeMetadataChanges:!0,ka:!0});return Ol(i,m)}(yield Er(r),r.asyncQueue,t,e,n)})),n.promise}function ev(r,t,e){let n=new It;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){try{let s=yield tp(r);n.resolve(function(a,u,c){return V(this,null,function*(){var h;let f=F(a),{request:m,ft:p,parent:A}=gg(f.serializer,Gm(u),c);f.connection.Qo||delete m.parent;let C=(yield f.Jo("RunAggregationQuery",f.serializer.databaseId,A,m,1)).filter(N=>!!N.result);B(C.length===1,64727);let x=(h=C[0].result)===null||h===void 0?void 0:h.aggregateFields;return Object.keys(x).reduce((N,U)=>(N[p[U]]=x[U],N),{})})}(s,t,e))}catch(s){n.reject(s)}})),n.promise}function nv(r,t){let e=new Tr(t);return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(s,i){F(s).Da.add(i),i.next()}(yield Er(r),e)})),()=>{e.Ou(),r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(s,i){F(s).Da.delete(i)}(yield Er(r),e)}))}}function rv(r,t,e,n){let s=function(a,u){let c;return c=typeof a=="string"?gl().encode(a):a,function(f,m){return new jc(f,m)}(function(f,m){if(f instanceof Uint8Array)return Yf(f,m);if(f instanceof ArrayBuffer)return Yf(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),u)}(e,Dn(t));r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){Xw(yield Gl(r),s,n)}))}function sv(r,t){return r.asyncQueue.enqueue(()=>V(null,null,function*(){return function(n,s){let i=F(n);return i.persistence.runTransaction("Get named query","readonly",a=>i.Ti.getNamedQuery(a,s))}(yield Nr(r),t)}))}function rp(r,t){return function(n,s){return new $c(n,s)}(r,t)}function iv(r,t){return r.asyncQueue.enqueue(()=>V(null,null,function*(){return function(n,s){return V(this,null,function*(){let i=F(n),a=i.indexManager,u=[];return i.persistence.runTransaction("Configure indexes","readwrite",c=>a.getFieldIndexes(c).next(h=>function(m,p,A,C,x){m=[...m],p=[...p],m.sort(A),p.sort(A);let N=m.length,U=p.length,$=0,j=0;for(;$<U&&j<N;){let W=A(m[j],p[$]);W<0?x(m[j++]):W>0?C(p[$++]):($++,j++)}for(;$<U;)C(p[$++]);for(;j<N;)x(m[j++])}(h,s,u_,f=>{u.push(a.addFieldIndex(c,f))},f=>{u.push(a.deleteFieldIndex(c,f))})).next(()=>R.waitFor(u)))})}(yield Nr(r),t)}))}function ov(r,t){return r.asyncQueue.enqueue(()=>V(null,null,function*(){return function(n,s){F(n).Cs.Rs=s}(yield Nr(r),t)}))}function av(r){return r.asyncQueue.enqueue(()=>V(null,null,function*(){return function(e){let n=F(e),s=n.indexManager;return n.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(yield Nr(r))}))}function sp(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var tm=new Map;var ip="firestore.googleapis.com",em=!0,xo=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new D(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ip,this.ssl=em}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:em;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Eg;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Rg)throw new D(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}a_("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=sp((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},bn=class{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xo({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new D(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xo(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new iu;switch(n.type){case"firstParty":return new cu(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new D(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return V(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=tm.get(e);n&&(k("ComponentProvider","Removing Datastore"),tm.delete(e),n.terminate())}(this),Promise.resolve()}};function Kl(r,t,e,n={}){var s;r=H(r,bn);let i=Ti(t),a=r._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:r._getEmulatorOptions()}),c=`${t}:${e}`;i&&(Ua(`https://${c}`),bd("Firestore",!0)),a.host!==ip&&a.host!==c&&Mt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},a),{host:c,ssl:i,emulatorOptions:n});if(!Ln(h,u)&&(r._setSettings(h),n.mockUserToken)){let f,m;if(typeof n.mockUserToken=="string")f=n.mockUserToken,m=wt.MOCK_USER;else{f=Sd(n.mockUserToken,(s=r._app)===null||s===void 0?void 0:s.options.projectId);let p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new D(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new wt(p)}r._authCredentials=new ou(new qi(f,m))}}var St=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},ot=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ie(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}toJSON(){return{type:r._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Cn(e,r._jsonSchema))return new r(t,n||null,new M(X.fromString(e.referencePath)))}};ot._jsonSchemaVersion="firestore/documentReference/1.0",ot._jsonSchema={type:vt("string",ot._jsonSchemaVersion),referencePath:vt("string")};var ie=class r extends St{constructor(t,e,n){super(t,e,Rr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new ot(this.firestore,null,new M(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function op(r,t,...e){if(r=pt(r),pl("collection","path",t),r instanceof bn){let n=X.fromString(t,...e);return Hd(n),new ie(r,null,n)}{if(!(r instanceof ot||r instanceof ie))throw new D(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(X.fromString(t,...e));return Hd(n),new ie(r.firestore,null,n)}}function ap(r,t){if(r=H(r,bn),pl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new D(S.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new St(r,null,function(n){return new Ht(X.emptyPath(),n)}(t))}function Ql(r,t,...e){if(r=pt(r),arguments.length===1&&(t=ys.newId()),pl("doc","path",t),r instanceof bn){let n=X.fromString(t,...e);return Wd(n),new ot(r,null,new M(n))}{if(!(r instanceof ot||r instanceof ie))throw new D(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(X.fromString(t,...e));return Wd(n),new ot(r.firestore,r instanceof ie?r.converter:null,new M(n))}}function tn(r,t){return r=pt(r),t=pt(t),(r instanceof ot||r instanceof ie)&&(t instanceof ot||t instanceof ie)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function na(r,t){return r=pt(r),t=pt(t),r instanceof St&&t instanceof St&&r.firestore===t.firestore&&Ys(r._query,t._query)&&r.converter===t.converter}var nm="AsyncQueue",No=class{constructor(t=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Ls(this,"async_queue_retry"),this.oc=()=>{let n=Li();n&&k(nm,"Visibility state changed to "+n.visibilityState),this.F_.y_()},this._c=t;let e=Li();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.ac(),this.uc(t)}enterRestrictedMode(t){if(!this.Xu){this.Xu=!0,this.rc=t||!1;let e=Li();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.oc)}}enqueue(t){if(this.ac(),this.Xu)return new Promise(()=>{});let e=new It;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Zu.push(t),this.cc()))}cc(){return V(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(t){if(!Xe(t))throw t;k(nm,"Operation failed with retryable error: "+t)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(t){let e=this._c.then(()=>(this.nc=!0,t().catch(n=>{throw this.tc=n,this.nc=!1,ft("INTERNAL UNHANDLED ERROR: ",rm(n)),n}).then(n=>(this.nc=!1,n))));return this._c=e,e}enqueueAfterDelay(t,e,n){this.ac(),this.sc.indexOf(t)>-1&&(e=0);let s=kc.createAndSchedule(this,t,e,n,i=>this.lc(i));return this.ec.push(s),s}ac(){this.tc&&L(47125,{hc:rm(this.tc)})}verifyOperationInProgress(){}Pc(){return V(this,null,function*(){let t;do t=this._c,yield t;while(t!==this._c)})}Tc(t){for(let e of this.ec)if(e.timerId===t)return!0;return!1}Ic(t){return this.Pc().then(()=>{this.ec.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.ec)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Pc()})}dc(t){this.sc.push(t)}lc(t){let e=this.ec.indexOf(t);this.ec.splice(e,1)}};function rm(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}function tr(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let s=e;for(let i of n)if(i in s&&typeof s[i]=="function")return!0;return!1}(r,["next","error","complete"])}var Qc=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new It,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var kv=-1,nt=class extends bn{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new No,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return V(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new No(t),this._firestoreClient=void 0,yield t}})}};function up(r,t,e){e||(e=As);let n=$a(r,"firestore");if(n.isInitialized(e)){let s=n.getImmediate({identifier:e}),i=n.getOptions(e);if(Ln(i,t))return s;throw new D(S.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(t.cacheSizeBytes!==void 0&&t.localCache!==void 0)throw new D(S.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(t.cacheSizeBytes!==void 0&&t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Rg)throw new D(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&Ti(t.host)&&Ua(t.host),n.initialize({options:t,instanceIdentifier:e})}function cp(r,t){let e=typeof r=="object"?r:Fd(),n=typeof r=="string"?r:t||As,s=$a(e,"firestore").getImmediate({identifier:n});if(!s._initialized){let i=Ad("firestore");i&&Kl(s,...i)}return s}function lt(r){if(r._terminated)throw new D(S.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||lp(r),r._firestoreClient}function lp(r){var t,e,n;let s=r._freezeSettings(),i=function(u,c,h,f){return new Iu(u,c,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,sp(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,s);r._componentsProvider||!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=s.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),r._firestoreClient=new Kc(r._authCredentials,r._appCheckCredentials,r._queue,i,r._componentsProvider&&function(u){let c=u?._online.build();return{_offline:u?._offline.build(c),_online:c}}(r._componentsProvider))}function hp(r,t){Mt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return fp(r,xr.provider,{build:n=>new $s(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function dp(r){return V(this,null,function*(){Mt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();fp(r,xr.provider,{build:e=>new Do(e,t.cacheSizeBytes)})})}function fp(r,t,e){if((r=H(r,nt))._firestoreClient||r._terminated)throw new D(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new D(S.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},lp(r)}function mp(r){if(r._initialized&&!r._terminated)throw new D(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new It;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>V(null,null,function*(){try{yield function(n){return V(this,null,function*(){if(!Ue.C())return Promise.resolve();let s=n+Cg;yield Ue.delete(s)})}(Dl(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function gp(r){return function(e){let n=new It;return e.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return qw(yield Gl(e),n)})),n.promise}(lt(r=H(r,nt)))}function pp(r){return Jw(lt(r=H(r,nt)))}function yp(r){return Yw(lt(r=H(r,nt)))}function _p(r){return xd(r.app,"firestore",r._databaseId.database),r._delete()}function ko(r,t){let e=lt(r=H(r,nt)),n=new Qc;return rv(e,r._databaseId,t,n),n}function Wl(r,t){return sv(lt(r=H(r,nt)),t).then(e=>e?new St(r,null,e.query):null)}var Rn=class{constructor(t="count",e){this._internalFieldPath=e,this.type="AggregateField",this.aggregateType=t}},Wc=class{constructor(t,e,n){this._userDataWriter=e,this._data=n,this.type="AggregateQuerySnapshot",this.query=t}data(){return this._userDataWriter.convertObjectMap(this._data)}};var pe=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(gt.fromBase64String(t))}catch(e){throw new D(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(gt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Cn(t,r._jsonSchema))return r.fromBase64String(t.bytes)}};pe._jsonSchemaVersion="firestore/bytes/1.0",pe._jsonSchema={type:vt("string",pe._jsonSchemaVersion),bytes:vt("string")};var Te=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new D(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Tt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};function wp(){return new Te(du)}var Ee=class{constructor(t){this._methodName=t}};var Me=class r{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new D(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new D(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return G(this._lat,t._lat)||G(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:r._jsonSchemaVersion}}static fromJSON(t){if(Cn(t,r._jsonSchema))return new r(t.latitude,t.longitude)}};Me._jsonSchemaVersion="firestore/geoPoint/1.0",Me._jsonSchema={type:vt("string",Me._jsonSchemaVersion),latitude:vt("number"),longitude:vt("number")};var ye=class r{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,t._values)}toJSON(){return{type:r._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Cn(t,r._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new r(t.vectorValues);throw new D(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};ye._jsonSchemaVersion="firestore/vectorValue/1.0",ye._jsonSchema={type:vt("string",ye._jsonSchemaVersion),vectorValues:vt("object")};var uv=/^__.*__$/,Hc=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Jt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ge(t,this.data,e,this.fieldTransforms)}},Fo=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Jt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function vp(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ec:r})}}var Oo=class r{constructor(t,e,n,s,i,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.Ac(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.Rc({path:n,mc:!1});return s.fc(t),s}gc(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.Rc({path:n,mc:!1});return s.Ac(),s}yc(t){return this.Rc({path:void 0,mc:!0})}wc(t){return Mo(t,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ac(){if(this.path)for(let t=0;t<this.path.length;t++)this.fc(this.path.get(t))}fc(t){if(t.length===0)throw this.wc("Document fields must not be empty");if(vp(this.Ec)&&uv.test(t))throw this.wc('Document fields cannot begin and end with "__"')}},Xc=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Dn(t)}Dc(t,e,n,s=!1){return new Oo({Ec:t,methodName:e,bc:n,path:Tt.emptyPath(),mc:!1,Sc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function xn(r){let t=r._freezeSettings(),e=Dn(r._databaseId);return new Xc(r._databaseId,!!t.ignoreUndefinedProperties,e)}function ra(r,t,e,n,s,i={}){let a=r.Dc(i.merge||i.mergeFields?2:0,t,e,s);Jl("Data must be an object, but it was:",a,n);let u=Ep(n,a),c,h;if(i.merge)c=new $t(a.fieldMask),h=a.fieldTransforms;else if(i.mergeFields){let f=[];for(let m of i.mergeFields){let p=Gs(t,m,e);if(!a.contains(p))throw new D(S.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);Sp(f,p)||f.push(p)}c=new $t(f),h=a.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,h=a.fieldTransforms;return new Hc(new xt(u),c,h)}var zs=class r extends Ee{_toFieldTransform(t){if(t.Ec!==2)throw t.Ec===1?t.wc(`${this._methodName}() can only appear at the top level of your update data`):t.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function Ip(r,t,e){return new Oo({Ec:3,bc:t.settings.bc,methodName:r._methodName,mc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Jc=class r extends Ee{_toFieldTransform(t){return new In(t.path,new $e)}isEqual(t){return t instanceof r}},Yc=class r extends Ee{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=Ip(this,t,!0),n=this.vc.map(i=>Nn(i,e)),s=new ve(n);return new In(t.path,s)}isEqual(t){return t instanceof r&&Ln(this.vc,t.vc)}},Zc=class r extends Ee{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=Ip(this,t,!0),n=this.vc.map(i=>Nn(i,e)),s=new Ie(n);return new In(t.path,s)}isEqual(t){return t instanceof r&&Ln(this.vc,t.vc)}},tl=class r extends Ee{constructor(t,e){super(t),this.Cc=e}_toFieldTransform(t){let e=new ze(t.serializer,tg(t.serializer,this.Cc));return new In(t.path,e)}isEqual(t){return t instanceof r&&this.Cc===t.Cc}};function Hl(r,t,e,n){let s=r.Dc(1,t,e);Jl("Data must be an object, but it was:",s,n);let i=[],a=xt.empty();Je(n,(c,h)=>{let f=sa(t,c,e);h=pt(h);let m=s.gc(f);if(h instanceof zs)i.push(f);else{let p=Nn(h,m);p!=null&&(i.push(f),a.set(f,p))}});let u=new $t(i);return new Fo(a,u,s.fieldTransforms)}function Xl(r,t,e,n,s,i){let a=r.Dc(1,t,e),u=[Gs(t,n,e)],c=[s];if(i.length%2!=0)throw new D(S.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)u.push(Gs(t,i[p])),c.push(i[p+1]);let h=[],f=xt.empty();for(let p=u.length-1;p>=0;--p)if(!Sp(h,u[p])){let A=u[p],C=c[p];C=pt(C);let x=a.gc(A);if(C instanceof zs)h.push(A);else{let N=Nn(C,x);N!=null&&(h.push(A),f.set(A,N))}}let m=new $t(h);return new Fo(f,m,a.fieldTransforms)}function Tp(r,t,e,n=!1){return Nn(e,r.Dc(n?4:3,t))}function Nn(r,t){if(Ap(r=pt(r)))return Jl("Unsupported field value:",t,r),Ep(r,t);if(r instanceof Ee)return function(n,s){if(!vp(s.Ec))throw s.wc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.wc(`${n._methodName}() is not currently supported inside arrays`);let i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.mc&&t.Ec!==4)throw t.wc("Nested arrays are not supported");return function(n,s){let i=[],a=0;for(let u of n){let c=Nn(u,s.yc(a));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),a++}return{arrayValue:{values:i}}}(r,t)}return function(n,s){if((n=pt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return tg(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let i=ct.fromDate(n);return{timestampValue:gr(s.serializer,i)}}if(n instanceof ct){let i=new ct(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:gr(s.serializer,i)}}if(n instanceof Me)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof pe)return{bytesValue:cg(s.serializer,n._byteString)};if(n instanceof ot){let i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Vl(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof ye)return function(a,u){return{mapValue:{fields:{[El]:{stringValue:Al},[lr]:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw u.wc("VectorValues must only contain numeric values.");return Pl(u.serializer,h)})}}}}}}(n,s);throw s.wc(`Unsupported field value: ${jo(n)}`)}(r,t)}function Ep(r,t){let e={};return Cm(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Je(r,(n,s)=>{let i=Nn(s,t.Vc(n));i!=null&&(e[n]=i)}),{mapValue:{fields:e}}}function Ap(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof ct||r instanceof Me||r instanceof pe||r instanceof ot||r instanceof Ee||r instanceof ye)}function Jl(r,t,e){if(!Ap(e)||!dm(e)){let n=jo(e);throw n==="an object"?t.wc(r+" a custom object"):t.wc(r+" "+n)}}function Gs(r,t,e){if((t=pt(t))instanceof Te)return t._internalPath;if(typeof t=="string")return sa(r,t);throw Mo("Field path arguments must be of type string or ",r,!1,void 0,e)}var cv=new RegExp("[~\\*/\\[\\]]");function sa(r,t,e){if(t.search(cv)>=0)throw Mo(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new Te(...t.split("."))._internalPath}catch{throw Mo(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function Mo(r,t,e,n,s){let i=n&&!n.isEmpty(),a=s!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${n}`),a&&(c+=` in document ${s}`),c+=")"),new D(S.INVALID_ARGUMENT,u+r+c)}function Sp(r,t){return r.some(e=>e.isEqual(t))}var Pn=class{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ot(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new el(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(ia("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},el=class extends Pn{data(){return super.data()}};function ia(r,t){return typeof t=="string"?sa(r,t):t instanceof Te?t._internalPath:t._delegate._internalPath}function bp(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new D(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ks=class{},Vn=class extends Ks{};function Rp(r,t,...e){let n=[];t instanceof Ks&&n.push(t),n=n.concat(e),function(i){let a=i.filter(c=>c instanceof Ar).length,u=i.filter(c=>c instanceof Qs).length;if(a>1||a>0&&u>0)throw new D(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let s of n)r=s._apply(r);return r}var Qs=class r extends Vn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return qp(t._query,e),new St(t.firestore,t.converter,ku(t._query,e))}_parse(t){let e=xn(t.firestore);return function(i,a,u,c,h,f,m){let p;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new D(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){im(m,f);let C=[];for(let x of m)C.push(sm(c,i,x));p={arrayValue:{values:C}}}else p=sm(c,i,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||im(m,f),p=Tp(u,a,m,f==="in"||f==="not-in");return J.create(h,f,p)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function Pp(r,t,e){let n=t,s=ia("where",r);return Qs._create(s,n,e)}var Ar=class r extends Ks{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:et.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(s,i){let a=s,u=i.getFlattenedFilters();for(let c of u)qp(a,c),a=ku(a,c)}(t._query,e),new St(t.firestore,t.converter,ku(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function Vp(...r){return r.forEach(t=>Up("or",t)),Ar._create("or",r)}function Cp(...r){return r.forEach(t=>Up("and",t)),Ar._create("and",r)}var nl=class r extends Vn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(s,i,a){if(s.startAt!==null)throw new D(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new D(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new wn(i,a)}(t._query,this._field,this._direction);return new St(t.firestore,t.converter,function(s,i){let a=s.explicitOrderBy.concat([i]);return new Ht(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(t._query,e))}};function Dp(r,t="asc"){let e=t,n=ia("orderBy",r);return nl._create(n,e)}var Lo=class r extends Vn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new St(t.firestore,t.converter,Yi(t._query,this._limit,this._limitType))}};function xp(r){return fm("limit",r),Lo._create("limit",r,"F")}function Np(r){return fm("limitToLast",r),Lo._create("limitToLast",r,"L")}var qo=class r extends Vn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Lp(t,this.type,this._docOrFields,this._inclusive);return new St(t.firestore,t.converter,function(s,i){return new Ht(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(t._query,e))}};function kp(...r){return qo._create("startAt",r,!0)}function Fp(...r){return qo._create("startAfter",r,!1)}var Uo=class r extends Vn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Lp(t,this.type,this._docOrFields,this._inclusive);return new St(t.firestore,t.converter,function(s,i){return new Ht(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(t._query,e))}};function Op(...r){return Uo._create("endBefore",r,!1)}function Mp(...r){return Uo._create("endAt",r,!0)}function Lp(r,t,e,n){if(e[0]=pt(e[0]),e[0]instanceof Pn)return function(i,a,u,c,h){if(!c)throw new D(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let m of Yn(i))if(m.field.isKeyField())f.push(_n(a,c.key));else{let p=c.data.field(m.field);if(Ko(p))throw new D(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){let A=m.field.canonicalString();throw new D(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}f.push(p)}return new ae(f,h)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let s=xn(r.firestore);return function(a,u,c,h,f,m){let p=a.explicitOrderBy;if(f.length>p.length)throw new D(S.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let A=[];for(let C=0;C<f.length;C++){let x=f[C];if(p[C].field.isKeyField()){if(typeof x!="string")throw new D(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof x}`);if(!bl(a)&&x.indexOf("/")!==-1)throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${x}' contains a slash.`);let N=a.path.child(X.fromString(x));if(!M.isDocumentKey(N))throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);let U=new M(N);A.push(_n(u,U))}else{let N=Tp(c,h,x);A.push(N)}}return new ae(A,m)}(r._query,r.firestore._databaseId,s,t,e,n)}}function sm(r,t,e){if(typeof(e=pt(e))=="string"){if(e==="")throw new D(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bl(t)&&e.indexOf("/")!==-1)throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(X.fromString(e));if(!M.isDocumentKey(n))throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return _n(r,new M(n))}if(e instanceof ot)return _n(r,e._key);throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jo(e)}.`)}function im(r,t){if(!Array.isArray(r)||r.length===0)throw new D(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function qp(r,t){let e=function(s,i){for(let a of s)for(let u of a.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new D(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new D(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}function Up(r,t){if(!(t instanceof Qs||t instanceof Ar))throw new D(S.INVALID_ARGUMENT,`Function ${r}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}var Bo=class{convertValue(t,e="none"){switch(Be(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ut(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(we(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return Je(t,(s,i)=>{n[s]=this.convertValue(i,e)}),n}convertVectorValue(t){var e,n,s;let i=(s=(n=(e=t.fields)===null||e===void 0?void 0:e[lr].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.map(a=>ut(a.doubleValue));return new ye(i)}convertGeoPoint(t){return new Me(ut(t.latitude),ut(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=Qo(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Es(t));default:return null}}convertTimestamp(t){let e=_e(t);return new ct(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=X.fromString(t);B(wg(n),9688,{name:t});let s=new cr(n.get(1),n.get(3)),i=new M(n.popFirst(5));return s.isEqual(e)||ft(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}};function oa(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var Ws=class extends Bo{constructor(t){super(),this.firestore=t}convertBytes(t){return new pe(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ot(this.firestore,null,e)}};function Bp(r){return new Rn("sum",Gs("sum",r))}function Fv(r){return new Rn("avg",Gs("average",r))}function lv(){return new Rn("count")}function jp(r,t){var e,n;return r instanceof Rn&&t instanceof Rn&&r.aggregateType===t.aggregateType&&((e=r._internalFieldPath)===null||e===void 0?void 0:e.canonicalString())===((n=t._internalFieldPath)===null||n===void 0?void 0:n.canonicalString())}function $p(r,t){return na(r.query,t.query)&&Ln(r.data(),t.data())}var zp="NOT SUPPORTED",ne=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},zt=class r extends Pn{constructor(t,e,n,s,i,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new er(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(ia("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new D(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=r._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};function Ov(r,t,e){if(Cn(t,zt._jsonSchema)){if(t.bundle===zp)throw new D(S.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let n=Dn(r._databaseId),s=rp(t.bundle,n),i=s.Ku(),a=new Bs(s.getMetadata(),n);for(let f of i)a.Wa(f);let u=a.documents;if(u.length!==1)throw new D(S.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${u.length} documents.`);let c=Ho(n,u[0].document),h=new M(X.fromString(t.bundleName));return new zt(r,new Ws(r),h,c,new ne(!1,!1),e||null)}}zt._jsonSchemaVersion="firestore/documentSnapshot/1.0",zt._jsonSchema={type:vt("string",zt._jsonSchemaVersion),bundleSource:vt("string","DocumentSnapshot"),bundleName:vt("string"),bundle:vt("string")};var er=class extends zt{data(t={}){return super.data(t)}},Gt=class r{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new ne(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new er(this._firestore,this._userDataWriter,n.key,n,new ne(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new D(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(u=>{let c=new er(s._firestore,s._userDataWriter,u.doc.key,u.doc,new ne(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||u.type!==3).map(u=>{let c=new er(s._firestore,s._userDataWriter,u.doc.key,u.doc,new ne(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter),h=-1,f=-1;return u.type!==0&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:hv(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new D(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=r._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=ys.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],n=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(e.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function Mv(r,t,e){if(Cn(t,Gt._jsonSchema)){if(t.bundle===zp)throw new D(S.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let n=Dn(r._databaseId),s=rp(t.bundle,n),i=s.Ku(),a=new Bs(s.getMetadata(),n);for(let p of i)a.Wa(p);if(a.queries.length!==1)throw new D(S.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${a.queries.length} queries.`);let u=Jo(a.queries[0].bundledQuery),c=a.documents,h=new qs;c.map(p=>{let A=Ho(n,p.document);h=h.add(A)});let f=Sn.fromInitialDocuments(u,h,K(),!1,!1),m=new St(r,e||null,u);return new Gt(r,new Ws(r),m,f)}}function hv(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:r})}}function Gp(r,t){return r instanceof zt&&t instanceof zt?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof Gt&&t instanceof Gt&&r._firestore===t._firestore&&na(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function Kp(r){r=H(r,ot);let t=H(r.firestore,nt);return ep(lt(t),r._key).then(e=>Yl(t,r,e))}Gt._jsonSchemaVersion="firestore/querySnapshot/1.0",Gt._jsonSchema={type:vt("string",Gt._jsonSchemaVersion),bundleSource:vt("string","QuerySnapshot"),bundleName:vt("string"),bundle:vt("string")};var ue=class extends Bo{constructor(t){super(),this.firestore=t}convertBytes(t){return new pe(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ot(this.firestore,null,e)}};function Qp(r){r=H(r,ot);let t=H(r.firestore,nt),e=lt(t),n=new ue(t);return Zw(e,r._key).then(s=>new zt(t,n,r._key,s,new ne(s!==null&&s.hasLocalMutations,!0),r.converter))}function Wp(r){r=H(r,ot);let t=H(r.firestore,nt);return ep(lt(t),r._key,{source:"server"}).then(e=>Yl(t,r,e))}function Hp(r){r=H(r,St);let t=H(r.firestore,nt),e=lt(t),n=new ue(t);return bp(r._query),np(e,r._query).then(s=>new Gt(t,n,r,s))}function Xp(r){r=H(r,St);let t=H(r.firestore,nt),e=lt(t),n=new ue(t);return tv(e,r._query).then(s=>new Gt(t,n,r,s))}function Jp(r){r=H(r,St);let t=H(r.firestore,nt),e=lt(t),n=new ue(t);return np(e,r._query,{source:"server"}).then(s=>new Gt(t,n,r,s))}function Yp(r,t,e){r=H(r,ot);let n=H(r.firestore,nt),s=oa(r.converter,t,e);return ei(n,[ra(xn(n),"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,dt.none())])}function Zp(r,t,e,...n){r=H(r,ot);let s=H(r.firestore,nt),i=xn(s),a;return a=typeof(t=pt(t))=="string"||t instanceof Te?Xl(i,"updateDoc",r._key,t,e,n):Hl(i,"updateDoc",r._key,t),ei(s,[a.toMutation(r._key,dt.exists(!0))])}function ty(r){return ei(H(r.firestore,nt),[new Ke(r._key,dt.none())])}function ey(r,t){let e=H(r.firestore,nt),n=Ql(r),s=oa(r.converter,t);return ei(e,[ra(xn(r.firestore),"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,dt.exists(!1))]).then(()=>n)}function Sr(r,...t){var e,n,s;r=pt(r);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||tr(t[a])||(i=t[a++]);let u={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(tr(t[a])){let m=t[a];t[a]=(e=m.next)===null||e===void 0?void 0:e.bind(m),t[a+1]=(n=m.error)===null||n===void 0?void 0:n.bind(m),t[a+2]=(s=m.complete)===null||s===void 0?void 0:s.bind(m)}let c,h,f;if(r instanceof ot)h=H(r.firestore,nt),f=Rr(r._key.path),c={next:m=>{t[a]&&t[a](Yl(h,r,m))},error:t[a+1],complete:t[a+2]};else{let m=H(r,St);h=H(m.firestore,nt),f=m._query;let p=new ue(h);c={next:A=>{t[a]&&t[a](new Gt(h,p,m,A))},error:t[a+1],complete:t[a+2]},bp(r._query)}return function(p,A,C,x){let N=new Tr(x),U=new Us(A,N,C);return p.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Ol(yield Er(p),U)})),()=>{N.Ou(),p.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Ml(yield Er(p),U)}))}}(lt(h),f,u,c)}function Lv(r,t,...e){let n=pt(r),s=function(c){let h={bundle:"",bundleName:"",bundleSource:""},f=["bundle","bundleName","bundleSource"];for(let m of f){if(!(m in c)){h.error=`snapshotJson missing required field: ${m}`;break}let p=c[m];if(typeof p!="string"){h.error=`snapshotJson field '${m}' must be a string.`;break}if(p.length===0){h.error=`snapshotJson field '${m}' cannot be an empty string.`;break}m==="bundle"?h.bundle=p:m==="bundleName"?h.bundleName=p:m==="bundleSource"&&(h.bundleSource=p)}return h}(t);if(s.error)throw new D(S.INVALID_ARGUMENT,s.error);let i,a=0;if(typeof e[a]!="object"||tr(e[a])||(i=e[a++]),s.bundleSource==="QuerySnapshot"){let u=null;if(typeof e[a]=="object"&&tr(e[a])){let c=e[a++];u={next:c.next,error:c.error,complete:c.complete}}else u={next:e[a++],error:e[a++],complete:e[a++]};return function(h,f,m,p,A){let C,x=!1;return ko(h,f.bundle).then(()=>Wl(h,f.bundleName)).then(U=>{U&&!x&&(A&&U.withConverter(A),C=Sr(U,m||{},p))}).catch(U=>(p.error&&p.error(U),()=>{})),()=>{x||(x=!0,C&&C())}}(n,s,i,u,e[a])}if(s.bundleSource==="DocumentSnapshot"){let u=null;if(typeof e[a]=="object"&&tr(e[a])){let c=e[a++];u={next:c.next,error:c.error,complete:c.complete}}else u={next:e[a++],error:e[a++],complete:e[a++]};return function(h,f,m,p,A){let C,x=!1;return ko(h,f.bundle).then(()=>{if(!x){let U=new ot(h,A||null,M.fromPath(f.bundleName));C=Sr(U,m||{},p)}}).catch(U=>(p.error&&p.error(U),()=>{})),()=>{x||(x=!0,C&&C())}}(n,s,i,u,e[a])}throw new D(S.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function ny(r,t){return nv(lt(r=H(r,nt)),tr(t)?t:{next:t})}function ei(r,t){return function(n,s){let i=new It;return n.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Fw(yield Gl(n),s,i)})),i.promise}(lt(r),t)}function Yl(r,t,e){let n=e.docs.get(t._key),s=new ue(r);return new zt(r,s,t._key,n,new ne(e.hasPendingWrites,e.fromCache),t.converter)}function aa(r){return Zl(r,{count:lv()})}function Zl(r,t){let e=H(r.firestore,nt),n=lt(e),s=Vm(t,(i,a)=>new Zi(a,i.aggregateType,i._internalFieldPath));return ev(n,r._query,s).then(i=>function(u,c,h){let f=new ue(u);return new Wc(c,f,h)}(e,r,i))}var rl=class{constructor(t){this.kind="memory",this._onlineComponentProvider=xr.provider,t?.garbageCollector?this._offlineComponentProvider=t.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new js(void 0)}}toJSON(){return{kind:this.kind}}},sl=class{constructor(t){let e;this.kind="persistent",t?.tabManager?(t.tabManager._initialize(t),e=t.tabManager):(e=dv(void 0),e._initialize(t)),this._onlineComponentProvider=e._onlineComponentProvider,this._offlineComponentProvider=e._offlineComponentProvider}toJSON(){return{kind:this.kind}}},il=class{constructor(){this.kind="memoryEager",this._offlineComponentProvider=ta.provider}toJSON(){return{kind:this.kind}}},ol=class{constructor(t){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new js(t)}}toJSON(){return{kind:this.kind}}};function qv(){return new il}function Uv(r){return new ol(r?.cacheSizeBytes)}function Bv(r){return new rl(r)}function jv(r){return new sl(r)}var al=class{constructor(t){this.forceOwnership=t,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=xr.provider,this._offlineComponentProvider={build:e=>new $s(e,t?.cacheSizeBytes,this.forceOwnership)}}},ul=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=xr.provider,this._offlineComponentProvider={build:e=>new Do(e,t?.cacheSizeBytes)}}};function dv(r){return new al(r?.forceOwnership)}function $v(){return new ul}var fv={maxAttempts:5};var cl=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=xn(t)}set(t,e,n){this._verifyNotCommitted();let s=Fe(t,this._firestore),i=oa(s.converter,e,n),a=ra(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,n);return this._mutations.push(a.toMutation(s._key,dt.none())),this}update(t,e,n,...s){this._verifyNotCommitted();let i=Fe(t,this._firestore),a;return a=typeof(e=pt(e))=="string"||e instanceof Te?Xl(this._dataReader,"WriteBatch.update",i._key,e,n,s):Hl(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(a.toMutation(i._key,dt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Fe(t,this._firestore);return this._mutations=this._mutations.concat(new Ke(e._key,dt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Fe(r,t){if((r=pt(r)).firestore!==t)throw new D(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var ll=class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=xn(t)}get(t){let e=Fe(t,this._firestore),n=new Ws(this._firestore);return this._transaction.lookup([e._key]).then(s=>{if(!s||s.length!==1)return L(24041);let i=s[0];if(i.isFoundDocument())return new Pn(this._firestore,n,i.key,i,e.converter);if(i.isNoDocument())return new Pn(this._firestore,n,e._key,null,e.converter);throw L(18433,{doc:i})})}set(t,e,n){let s=Fe(t,this._firestore),i=oa(s.converter,e,n),a=ra(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,n);return this._transaction.set(s._key,a),this}update(t,e,n,...s){let i=Fe(t,this._firestore),a;return a=typeof(e=pt(e))=="string"||e instanceof Te?Xl(this._dataReader,"Transaction.update",i._key,e,n,s):Hl(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,a),this}delete(t){let e=Fe(t,this._firestore);return this._transaction.delete(e._key),this}};var hl=class extends ll{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Fe(t,this._firestore),n=new ue(this._firestore);return super.get(t).then(s=>new zt(this._firestore,n,e._key,s._document,new ne(!1,!1),e.converter))}};function ry(r,t,e){r=H(r,nt);let n=Object.assign(Object.assign({},fv),e);return function(i){if(i.maxAttempts<1)throw new D(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(i,a,u){let c=new It;return i.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){let h=yield tp(i);new Gc(i.asyncQueue,h,u,a,c).zu()})),c.promise}(lt(r),s=>t(new hl(r,s)),n)}function sy(){return new zs("deleteField")}function zv(){return new Jc("serverTimestamp")}function Gv(...r){return new Yc("arrayUnion",r)}function Kv(...r){return new Zc("arrayRemove",r)}function iy(r){return new tl("increment",r)}function oy(r){return new ye(r)}function ay(r){return lt(r=H(r,nt)),new cl(r,t=>ei(r,t))}function uy(r,t){let e=lt(r=H(r,nt));if(!e._uninitializedComponentsProvider||e._uninitializedComponentsProvider._offline.kind==="memory")return Mt("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(i){let a=typeof i=="string"?function(h){try{return JSON.parse(h)}catch(f){throw new D(S.INVALID_ARGUMENT,"Failed to parse JSON: "+f?.message)}}(i):i,u=[];if(Array.isArray(a.indexes))for(let c of a.indexes){let h=om(c,"collectionGroup"),f=[];if(Array.isArray(c.fields))for(let m of c.fields){let p=sa("setIndexConfiguration",om(m,"fieldPath"));m.arrayConfig==="CONTAINS"?f.push(new ge(p,2)):m.order==="ASCENDING"?f.push(new ge(p,0)):m.order==="DESCENDING"&&f.push(new ge(p,1))}u.push(new qe(qe.UNKNOWN_ID,h,f,sr.empty()))}return u}(t);return iv(e,n)}function om(r,t){if(typeof r[t]!="string")throw new D(S.INVALID_ARGUMENT,"Missing string value for: "+t);return r[t]}var dl=class{constructor(t){this._firestore=t,this.type="PersistentCacheIndexManager"}};function cy(r){var t;r=H(r,nt);let e=am.get(r);if(e)return e;if(((t=lt(r)._uninitializedComponentsProvider)===null||t===void 0?void 0:t._offline.kind)!=="persistent")return null;let n=new dl(r);return am.set(r,n),n}function ly(r){fy(r,!0)}function hy(r){fy(r,!1)}function dy(r){av(lt(r._firestore)).then(t=>k("deleting all persistent cache indexes succeeded")).catch(t=>Mt("deleting all persistent cache indexes failed",t))}function fy(r,t){ov(lt(r._firestore),t).then(e=>k(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>Mt(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}var am=new WeakMap;function Qv(r){var t;let e=(t=lt(H(r.firestore,nt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return e===void 0?null:Xo(e,kt(r._query)).Vt}function Wv(r,t){var e;let n=Vm(t,(i,a)=>new Zi(a,i.aggregateType,i._internalFieldPath)),s=(e=lt(H(r.firestore,nt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return s===void 0?null:gg(s,Gm(r._query),n,!0).request}var um=class{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(t){return fl.instance.onExistenceFilterMismatch(t)}},fl=class r{constructor(){this.Fc=new Map}static get instance(){return Ci||(Ci=new r,function(e){if(to)throw new Error("a TestingHooksSpi instance is already set");to=e}(Ci)),Ci}ct(t){this.Fc.forEach(e=>e(t))}onExistenceFilterMismatch(t){let e=Symbol(),n=this.Fc;return n.set(e,t),()=>n.delete(e)}},Ci=null;(function(t,e=!0){(function(s){br=s})(kd),Dd(new Vd("firestore",(n,{instanceIdentifier:s,options:i})=>{let a=n.getProvider("app").getImmediate(),u=new nt(new au(n.getProvider("auth-internal")),new lu(a,n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new D(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new cr(h.options.projectId,f)}(a,s),a);return i=Object.assign({useFetchStreams:e},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),qn(zd,Gd,t),qn(zd,Gd,"esm2017")})();var ua=function(){return ua=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},ua.apply(this,arguments)};function nh(r,t,e){if(e||arguments.length===2)for(var n=0,s=t.length,i;n<s;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return r.concat(i||Array.prototype.slice.call(t))}var mv={includeMetadataChanges:!1};function ni(r,t){return t===void 0&&(t=mv),new ld(function(e){var n=Sr(r,t,{next:e.next.bind(e),error:e.error.bind(e),complete:e.complete.bind(e)});return{unsubscribe:n}})}function rh(r){return ni(r,{includeMetadataChanges:!0})}function my(r,t){return t===void 0&&(t={}),rh(r).pipe(on(function(e){return ca(e,t)}))}function ca(r,t){var e;t===void 0&&(t={});var n=r.data(t);return!r.exists()||typeof n!="object"||n===null||!t.idField?n:ua(ua({},n),(e={},e[t.idField]=r.id,e))}var gy=["added","modified","removed"],gv=function(r){return La(function(t){for(var e=!1,n=0;n<t.length;n++){var s=t[n];if(r&&r.indexOf(s.type)>=0){e=!0;break}}return e})};function th(r,t,e){for(var n=[],s=3;s<arguments.length;s++)n[s-3]=arguments[s];var i=r.slice();return i.splice.apply(i,nh([t,e],n,!1)),i}function pv(r,t){switch(t.type){case"added":if(!(r[t.newIndex]&&tn(r[t.newIndex].doc.ref,t.doc.ref)))return th(r,t.newIndex,0,t);break;case"modified":if(r[t.oldIndex]==null||tn(r[t.oldIndex].doc.ref,t.doc.ref))if(t.oldIndex!==t.newIndex){var e=r.slice();return e.splice(t.oldIndex,1),e.splice(t.newIndex,0,t),e}else return th(r,t.newIndex,1,t);break;case"removed":if(r[t.oldIndex]&&tn(r[t.oldIndex].doc.ref,t.doc.ref))return th(r,t.oldIndex,1);break}return r}function yv(r,t,e){return e===void 0&&(e=gy),t.forEach(function(n){e.indexOf(n.type)>-1&&(r=pv(r,n))}),r}var py=function(){return Ma(pd(void 0),gd())},eh=function(r,t){return JSON.stringify(r.metadata)===JSON.stringify(t.metadata)},_v=function(){return Ma(py(),La(function(r){var t=r[0],e=r[1];return e.length>0||t===void 0}),on(function(r){var t=r[1];return t}))};function la(r,t){return t===void 0&&(t={}),ni(r,{includeMetadataChanges:!0}).pipe(py(),on(function(e){var n=e[0],s=e[1],i=s.docChanges();return n&&!eh(n,s)&&s.docs.forEach(function(a,u){var c=i.find(function(f){return tn(f.doc.ref,a.ref)});if(c){if(eh(c.doc,a))return}else{var h=n?.docs.find(function(f){return tn(f.ref,a.ref)});if(h&&eh(h,a))return}i.push({oldIndex:u,newIndex:u,type:"modified",doc:a})}),i}),gv(t.events||gy),_v())}function sh(r){return ni(r,{includeMetadataChanges:!0}).pipe(on(function(t){return t.docs}))}function yy(r,t){return t===void 0&&(t={}),la(r,t).pipe(qa(function(e,n){return yv(e,n,t.events)},[]),md())}function _y(r,t){return t===void 0&&(t={}),la(r,t).pipe(qa(function(e,n){return nh(nh([],e,!0),n,!0)},[]))}function wy(r,t){return t===void 0&&(t={}),sh(r).pipe(on(function(e){return e.map(function(n){return ca(n,t)})}))}function ih(r){return Ii(aa(r))}function vy(r){return ih(r).pipe(on(function(t){return t.data().count}))}var ri=class{constructor(t){return t}},ah="firestore",oh=class{constructor(){return Ga(ah)}},gI=hd(0,300).pipe(dd(()=>Ii(Ga(ah))),fd()),uh=new _d("angularfire2.firestore-instances");function wv(r,t){let e=Od(ah,r,t);return e&&new ri(e)}function vv(r){return(t,e)=>{let n=t.runOutsideAngular(()=>r(e));return new ri(n)}}var Iy={provide:oh,deps:[[new Zr,uh]]},Ty={provide:ri,useFactory:wv,deps:[[new Zr,uh],Ld]},pI=(()=>{class r{constructor(){qn("angularfire",za.full,"fst")}static \u0275fac=function(n){return new(n||r)};static \u0275mod=Id({type:r});static \u0275inj=yd({providers:[Ty,Iy]})}return r})();function yI(r,...t){return qn("angularfire",za.full,"fst"),wd([Ty,Iy,{provide:uh,useFactory:vv(r),multi:!0,deps:[Td,vd,Md,qd,[new Zr,Bd],[new Zr,Ud],...t]}])}var _I=q(_y,!0),wI=q(sh,!0),vI=q(la,!0),II=q(vy,!0),TI=q(ih,!0),EI=q(wy,!0),AI=q(rh,!0),SI=q(my,!0),bI=q(ni,!0),RI=q(ca,!0),PI=q(yy,!0),VI=q(ey,!0,2),CI=q(jp,!0,2),DI=q($p,!0,2),xI=q(Cp,!0,2),NI=q(mp,!0),kI=q(op,!0,2),FI=q(ap,!0,2),OI=q(Kl,!0),MI=q(dy,!0),LI=q(ty,!0,2),qI=q(sy,!0,2),UI=q(yp,!0),BI=q(hy,!0),jI=q(Ql,!0,2),$I=q(wp,!0,2),zI=q(hp,!0),GI=q(dp,!0),KI=q(pp,!0),QI=q(ly,!0),WI=q(Mp,!0,2),HI=q(Op,!0,2),XI=q(Zl,!0),JI=q(aa,!0),YI=q(Kp,!0),ZI=q(Qp,!0),tT=q(Wp,!0),eT=q(Hp,!0),nT=q(Xp,!0),rT=q(Jp,!0),sT=q(cp,!0),iT=q(cy,!0),oT=q(iy,!0,2),aT=q(up,!0),uT=q(xp,!0,2),cT=q(Np,!0,2),lT=q(ko,!0),hT=q(Wl,!0,2),dT=q(Sr,!0),fT=q(ny,!0),mT=q(Vp,!0,2),gT=q(Dp,!0,2),pT=q(Rp,!0,2),yT=q(na,!0,2),_T=q(tn,!0,2),wT=q(ry,!0),vT=q(Yp,!0,2),IT=q(uy,!0),TT=q(cm,!0),ET=q(Gp,!0,2),AT=q(Fp,!0,2),ST=q(kp,!0,2),bT=q(Bp,!0,2),RT=q(_p,!0),PT=q(Zp,!0,2),VT=q(oy,!0,2),CT=q(gp,!0),DT=q(Pp,!0,2),xT=q(ay,!0,2);export{Mt as a,Dv as b,D as c,iu as d,Kd as e,ys as f,Tt as g,M as h,a_ as i,H as j,ct as k,Nv as l,gt as m,cr as n,St as o,ot as p,ie as q,Qc as r,kv as s,lt as t,Rn as u,Wc as v,pe as w,Te as x,Ee as y,Me as z,ye as A,Vn as B,Qs as C,Ar as D,nl as E,Lo as F,qo as G,Uo as H,Bo as I,Fv as J,lv as K,ne as L,zt as M,Ov as N,er as O,Gt as P,Mv as Q,Lv as R,ei as S,qv as T,Uv as U,Bv as V,jv as W,dv as X,$v as Y,cl as Z,hl as _,zv as $,Gv as aa,Kv as ba,dl as ca,Qv as da,Wv as ea,um as fa,ri as ga,oh as ha,gI as ia,pI as ja,yI as ka,_I as la,wI as ma,vI as na,II as oa,TI as pa,EI as qa,AI as ra,SI as sa,bI as ta,RI as ua,PI as va,VI as wa,CI as xa,DI as ya,xI as za,NI as Aa,kI as Ba,FI as Ca,OI as Da,MI as Ea,LI as Fa,qI as Ga,UI as Ha,BI as Ia,jI as Ja,$I as Ka,zI as La,GI as Ma,KI as Na,QI as Oa,WI as Pa,HI as Qa,XI as Ra,JI as Sa,YI as Ta,ZI as Ua,tT as Va,eT as Wa,nT as Xa,rT as Ya,sT as Za,iT as _a,oT as $a,aT as ab,uT as bb,cT as cb,lT as db,hT as eb,dT as fb,fT as gb,mT as hb,gT as ib,pT as jb,yT as kb,_T as lb,wT as mb,vT as nb,IT as ob,TT as pb,ET as qb,AT as rb,ST as sb,bT as tb,RT as ub,PT as vb,VT as wb,CT as xb,DT as yb,xT as zb};
