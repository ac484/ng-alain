import{b as y,d as v,e as h,f as p,g as d,h as T,i as l,j as D,n as g,o as w,p as C}from"./chunk-KNP3MJAK.js";import{oa as m,ta as b}from"./chunk-IDL4MXQM.js";import{i}from"./chunk-57BLH6QZ.js";var c=class c{constructor(){this.firestore=b(y)}useCollection(t){let e=d(this.firestore,t);return v(e,{idField:"key"})}useDoc(t,e){let s=l(this.firestore,t,e);return h(s,{idField:"key"})}add(t,e){return i(this,null,function*(){let s=d(this.firestore,t);return(yield p(s,e)).id})}update(t,e,s){return i(this,null,function*(){let r=l(this.firestore,t,e);yield C(r,s)})}delete(t,e){return i(this,null,function*(){let s=l(this.firestore,t,e);yield T(s)})}getNextContractSerial(){return i(this,null,function*(){let t=l(this.firestore,"hub/meta/counters/contractSerial"),e=1;return yield g(this.firestore,s=>i(this,null,function*(){let r=yield s.get(t),n=0,a=[];if(!r.exists())n=1,a=[],s.set(t,{value:n,available:a}),e=n;else{let o=r.data();n=o.value||0,a=Array.isArray(o.available)?[...o.available]:[],a.length>0?(a.sort((f,u)=>f-u),e=a.shift(),s.update(t,{available:a})):(e=n+1,s.update(t,{value:e}))}})),"C"+String(e).padStart(5,"0")})}recycleContractSerial(t){return i(this,null,function*(){let e=Number(t.replace(/^C/,""));if(!e||isNaN(e))return;let s=l(this.firestore,"hub/meta/counters/contractSerial");yield g(this.firestore,r=>i(this,null,function*(){let n=yield r.get(s);if(!n.exists())r.set(s,{value:e,available:[e]});else{let a=n.data(),o=Array.isArray(a.available)?[...a.available]:[];o.includes(e)||(o.push(e),o.sort((f,u)=>f-u),r.update(s,{available:o}))}}))})}getClientsSettings(){return i(this,null,function*(){let t=l(this.firestore,"hub/meta/settings/clients"),e=yield D(t);return e.exists()?e.data():null})}setClientsSettings(t){return i(this,null,function*(){let e=l(this.firestore,"hub/meta/settings/clients");yield w(e,t)})}getDefaultClient(){return i(this,null,function*(){return(yield this.getClientsSettings())?.default||""})}};c.\u0275fac=function(e){return new(e||c)},c.\u0275prov=m({token:c,factory:c.\u0275fac,providedIn:"root"});var P=c;export{P as a};
