import{a as P}from"./chunk-IH3LDCRA.js";import{a as ce}from"./chunk-JRBVWWGA.js";import{a as pe,b as se}from"./chunk-AQHAJTT3.js";import"./chunk-J45CC3UQ.js";import"./chunk-PWIGIY2E.js";import"./chunk-VAGS5EVQ.js";import{a as ae}from"./chunk-5F2XCZGF.js";import{f as ie,g as oe,h as re,k as le}from"./chunk-X4INL3GT.js";import{a as Y,c as Z,i as ee,j as te,k as ne}from"./chunk-C4NFM4BO.js";import"./chunk-RUQJZZK5.js";import"./chunk-XQY3PIEK.js";import{C as X,d as H,g as J,m as U}from"./chunk-3O3K3XB7.js";import"./chunk-ZGEIGK3V.js";import"./chunk-K7UCTXI2.js";import"./chunk-3DJMKMPP.js";import"./chunk-HFRURAVJ.js";import"./chunk-DPTHF4MY.js";import"./chunk-PE3VYITM.js";import"./chunk-2G5YCKNU.js";import"./chunk-3YOJPQZP.js";import"./chunk-5UWW7T45.js";import"./chunk-67O5LPFN.js";import"./chunk-R7NAW5VV.js";import"./chunk-2M2KBEEO.js";import"./chunk-ADAYBP2D.js";import"./chunk-KPMBVAUI.js";import{A as b,Bd as K,Dd as L,Ed as W,Gc as Q,Kd as j,Lc as S,Mc as D,Nb as _,Ob as l,Pb as r,Pc as v,Ph as q,Qb as C,Qh as G,Ub as E,Vb as h,Xb as g,_b as f,bb as a,bc as u,fc as M,gb as w,gc as k,hc as y,lc as N,nb as O,qc as m,rc as T,sc as F,tb as x,vc as B,wc as A,xa as p,xc as R,ya as s,zd as $}from"./chunk-JDZYPUOT.js";import{a as V,b as I}from"./chunk-57BLH6QZ.js";var ue=["rootMenu"],_e=()=>[];function fe(o,n){o&1&&C(0,"nz-icon",15)}function Ce(o,n){if(o&1&&(E(0),C(1,"nz-icon",19),l(2,"span",20),m(3),r(),l(4,"span",21),m(5),r(),l(6,"span",22),m(7),S(8,"lowercase"),r(),h()),o&2){let t=u(),e=t.$implicit,i=t.origin;a(3),T(e.title),a(),_("ngClass",i.taskStatus),a(),T(i.taskStatus),a(2),F("created by ",D(8,4,i.author))}}function ge(o,n){if(o&1){let t=g();E(0),l(1,"nz-icon",23),f("click",function(){p(t);let i=u(2).$implicit,c=u();return s(c.openFolder(i))}),r(),l(2,"span",24),m(3),r(),h()}if(o&2){let t=u(2).$implicit;a(),_("nzType",t.isExpanded?"folder-open":"folder"),a(2),T(t.title)}}function xe(o,n){if(o&1&&(C(0,"nz-icon",25),l(1,"span",26),m(2),r()),o&2){let t=u(2).$implicit;a(2),T(t.title)}}function Ne(o,n){if(o&1&&x(0,ge,4,2,"ng-container",18)(1,xe,3,1,"ng-template",null,5,v),o&2){let t=N(2),e=u().$implicit;_("ngIf",!e.isLeaf)("ngIfElse",t)}}function ze(o,n){if(o&1){let t=g();l(0,"span",16)(1,"span",17),f("contextmenu",function(i){let c=p(t).$implicit,d=u(),me=N(20);return s(d.contextMenu(i,me,c))}),x(2,Ce,9,6,"ng-container",18)(3,Ne,3,2,"ng-template",null,4,v),r()()}if(o&2){let t=n.origin,e=N(4);a(2),_("ngIf",t.isTask)("ngIfElse",e)}}function Te(o,n){if(o&1){let t=g();l(0,"li",13),f("click",function(){p(t);let i=u();return s(i.addTask())}),m(1,"\u65B0\u589E\u4EFB\u52D9"),r()}}function ve(o,n){if(o&1){let t=g();l(0,"li",13),f("click",function(){p(t);let i=u();return s(i.editNode())}),m(1,"\u7DE8\u8F2F\u7BC0\u9EDE"),r()}}function we(o,n){if(o&1){let t=g();l(0,"li",13),f("click",function(){p(t);let i=u();return s(i.deleteNode())}),m(1,"\u522A\u9664\u7BC0\u9EDE"),r()}}var z=class z{constructor(n,t){this.nzContextMenuService=n;this.crudService=t;this.searchValue="";this.contextNode=null;this.treeData$=this.crudService.getNodes().pipe(b(e=>Ee(e)))}openFolder(n){if(n instanceof ae)n.isExpanded=!n.isExpanded;else{let t=n.node;t&&(t.isExpanded=!t.isExpanded)}}activeNode(n){this.activatedNode=n.node}onDrop(n){let t=n.dragNode,e=n.node;if(!t||!e)return;let i=e.key;this.crudService.updateNode(t.key,{parentKey:i,order:0}).then(()=>{})}contextMenu(n,t,e){this.contextNode=e??null,this.nzContextMenuService.create(n,t)}onPanelContextMenu(n){n.target.closest(".ant-tree-node")||(n.preventDefault(),n.stopPropagation(),this.contextNode=null,this.rootMenu&&this.nzContextMenuService.create(n,this.rootMenu))}addNode(){this.crud.showAddModal(this.contextNode?.key)}editNode(){this.contextNode&&this.crud.showEditModal(this.contextNode.origin)}deleteNode(){this.contextNode&&this.crud.deleteNode(this.contextNode.origin)}addRootNode(){this.crud.showAddModal(null)}addTask(){if(!this.contextNode)return;let n=this.contextNode.key,t=new Date().toISOString(),e=`task-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i={id:e,key:e,title:"\u65B0\u4EFB\u52D9",name:"\u65B0\u4EFB\u52D9",type:"leaf",isTask:!0,order:0,parentKey:n,createdAt:t,updatedAt:t};this.crudService.addNode(i).then(()=>{})}selectDropdown(n){alert(n)}};z.\u0275fac=function(t){return new(t||z)(w(ne),w(ce))},z.\u0275cmp=O({type:z,selectors:[["app-tree-panel"]],viewQuery:function(t,e){if(t&1&&(M(P,5),M(ue,5)),t&2){let i;k(i=y())&&(e.crud=i.first),k(i=y())&&(e.rootMenu=i.first)}},decls:27,vars:11,consts:[["suffixIcon",""],["nzTreeTemplate",""],["rootMenu","nzDropdownMenu"],["menu","nzDropdownMenu"],["folderOrFile",""],["fileIcon",""],[1,"toolbar"],["nz-button","","nzType","default",2,"margin-bottom","8px",3,"click"],["nz-icon","","nzType","cluster"],[3,"nzSuffix"],["type","text","nz-input","","placeholder","\u641C\u5C0B\u7BC0\u9EDE",3,"ngModelChange","ngModel"],["nzBlockNode","","nzDraggable","","nzVirtualHeight","300px",3,"nzClick","nzDblClick","nzOnDrop","contextmenu","nzData","nzSearchValue","nzTreeTemplate"],["nz-menu",""],["nz-menu-item","",3,"click"],["nz-menu-item","",3,"click",4,"ngIf"],["nzType","search"],[1,"custom-node"],[3,"contextmenu"],[4,"ngIf","ngIfElse"],["nzType","check-circle",2,"color","#52c41a"],[1,"task-name"],[1,"task-status",3,"ngClass"],[1,"task-desc"],[3,"click","nzType"],[1,"folder-name"],["nzType","file"],[1,"file-name"]],template:function(t,e){if(t&1){let i=g();C(0,"app-firebase-crud"),l(1,"div",6)(2,"button",7),f("click",function(){return p(i),s(e.addRootNode())}),C(3,"span",8),m(4,"\u5EFA\u7ACB\u6839\u7D50\u9EDE "),r()(),l(5,"nz-input-group",9)(6,"input",10),R("ngModelChange",function(d){return p(i),A(e.searchValue,d)||(e.searchValue=d),s(d)}),r()(),x(7,fe,1,0,"ng-template",null,0,v),C(9,"br"),l(10,"nz-tree",11),S(11,"async"),f("nzClick",function(d){return p(i),s(e.activeNode(d))})("nzDblClick",function(d){return p(i),s(e.openFolder(d))})("nzOnDrop",function(d){return p(i),s(e.onDrop(d))})("contextmenu",function(d){return p(i),s(e.onPanelContextMenu(d))}),r(),x(12,ze,5,2,"ng-template",null,1,v),l(14,"nz-dropdown-menu",null,2)(16,"ul",12)(17,"li",13),f("click",function(){return p(i),s(e.addRootNode())}),m(18,"\u65B0\u589E\u6839\u7BC0\u9EDE"),r()()(),l(19,"nz-dropdown-menu",null,3)(21,"ul",12)(22,"li",13),f("click",function(){return p(i),s(e.addNode())}),m(23,"\u65B0\u589E\u7BC0\u9EDE"),r(),x(24,Te,2,0,"li",14)(25,ve,2,0,"li",14)(26,we,2,0,"li",14),r()()}if(t&2){let i=N(8),c=N(13);a(5),_("nzSuffix",i),a(),B("ngModel",e.searchValue),a(4),_("nzData",D(11,8,e.treeData$)??Q(10,_e))("nzSearchValue",e.searchValue)("nzTreeTemplate",c),a(14),_("ngIf",e.contextNode),a(),_("ngIf",e.contextNode),a(),_("ngIf",e.contextNode)}},dependencies:[j,$,K,X,H,J,U,se,pe,te,Z,Y,ee,G,q,le,ie,re,oe,P,L,W],styles:["nz-tree[_ngcontent-%COMP%]{overflow:hidden;margin:0 -24px;padding:0 24px}.custom-node[_ngcontent-%COMP%]{cursor:pointer;line-height:24px;margin-left:4px;display:inline-block}.file-name[_ngcontent-%COMP%], .folder-name[_ngcontent-%COMP%]{margin-left:4px}.file-desc[_ngcontent-%COMP%], .folder-desc[_ngcontent-%COMP%]{padding:0 8px;display:inline-block;background:#87ceff;color:#fff;position:relative;left:12px}.task-status.pending[_ngcontent-%COMP%]{color:#faad14}.task-status.in-progress[_ngcontent-%COMP%]{color:#1890ff}.task-status.completed[_ngcontent-%COMP%]{color:#52c41a}.task-status.cancelled[_ngcontent-%COMP%]{color:#f5222d}"]});var de=z;function Ee(o){let n=new Map,t=[];return o.forEach(e=>{n.set(e.key,I(V({},e),{children:[]}))}),n.forEach(e=>{e.parentKey&&n.has(e.parentKey)?n.get(e.parentKey).children.push(e):t.push(e)}),t}export{de as TreePanelComponent};
