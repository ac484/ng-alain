import{A as Yt,x as Zt}from"./chunk-BKEQE6WY.js";import"./chunk-VAGS5EVQ.js";import{a as Jn}from"./chunk-3L3546UY.js";import{a as It,b as ti}from"./chunk-HBT2OKRY.js";import{c as dr}from"./chunk-QJ3YEPZ3.js";import"./chunk-AJ4RFQ56.js";import{d as Re}from"./chunk-QQBJCJUO.js";import{C as se,G as me,H as Kn,I as ue,J as Qn,K as er,L as de,O as pe,P as ir,Q as or,R as ze,c as j,e as Vn,g as Z,i as $n,j as pi,k as ci,l as fi,m as zi,n as gi,o as hi,p as J,r as K,u as Q,v as Zn,w as Ci,x as ie,z as Xn}from"./chunk-4CHA47WD.js";import{$ as Gn,$a as mr,A as O,Aa as te,B as V,Ba as Dt,Ca as Tt,Da as oe,E as U,Ea as Kt,Fa as Vt,Ga as Qt,Ha as ei,Ia as ne,J as Pn,Ja as Yn,K as Ln,Ka as ae,L as G,M as Jt,N as W,Oa as le,P as In,Qa as Ut,R as H,Ra as ce,S as kn,Sa as tr,Ua as fe,Va as nr,W as On,Wa as rr,X as mo,Xa as ar,Y as $,Ya as sr,Z as Un,Za as lr,ab as ur,bb as ge,ca as jn,db as he,ea as Wn,fa as Hn,fb as Ce,ga as q,i as Et,ia as uo,j as Wi,k as Ie,ka as Y,l as kt,n as Xt,na as ui,oa as di,p as xt,pa as X,q as Ot,qa as po,r as wn,ra as R,s as An,sa as co,ta as Ft,v as Rn,va as fo,ya as ee,z as Bn,za as qn}from"./chunk-X3NOSVDL.js";import{$ as Wt,$b as Ee,Ac as Gi,Ag as A,B as Ko,Bb as mn,Bd as ro,Cb as un,Cd as li,Ch as k,Db as dn,Dd as mi,Dg as Sn,Ea as s,F as Ao,Hb as Gt,Hd as ao,Ib as pn,Ic as qt,J as Ro,Jb as ri,Jd as bn,Jh as so,Kd as ji,La as E,Lc as zn,Ld as Lo,Ma as ki,Mb as m,N as Qo,Na as Ji,Nb as Pe,Nc as gn,Ob as be,Qb as Fe,R as en,Ra as Ht,Rb as De,Rh as lo,Sb as Te,Sc as hn,Ta as Oi,Ua as an,Vg as En,W as Bo,Xb as Vi,Zc as oo,aa as Ii,ab as x,ac as Ui,ba as tn,bi as Tn,c as Pi,cb as F,d as wo,da as _,db as $t,e as Zi,eb as Lt,ec as At,fb as _e,fc as Rt,gb as Ne,hb as c,hc as cn,hg as St,ia as v,ib as r,ig as w,ja as y,jb as a,jd as Cn,jg as vn,kb as M,kd as Mn,kh as xn,ki as Se,lb as Ki,lc as Bt,lh as Fn,li as re,m as Xo,mb as Qi,md as _n,mh as Dn,na as on,ng as yn,nh as I,oa as Yi,ob as eo,pa as Be,pb as to,pd as si,qc as Po,qd as no,qg as P,rb as B,rg as L,s as Li,ta as Xi,ub as N,uc as fn,va as ni,w as Jo,xa as nn,xb as h,xd as Nn,xg as ye,yb as sn,yc as ai,za as rn,zb as ln,zc as io,zg as Me}from"./chunk-FM676GLM.js";import{a as Ae,b as qi,d as Sr,f as Yo,i as we}from"./chunk-57BLH6QZ.js";var Go=Sr((Vo,Uo)=>{"use strict";(function(o,i){typeof define=="function"&&define.amd?define([],i):typeof Vo<"u"?i():(i(),o.FileSaver={})})(Vo,function(){"use strict";function o(g,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(g.type)?new Blob(["\uFEFF",g],{type:g.type}):g}function i(g,l,u){var d=new XMLHttpRequest;d.open("GET",g),d.responseType="blob",d.onload=function(){f(d.response,l,u)},d.onerror=function(){console.error("could not download file")},d.send()}function e(g){var l=new XMLHttpRequest;l.open("HEAD",g,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function t(g){try{g.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),g.dispatchEvent(l)}}var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,p=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),f=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!p?function(g,l,u){var d=n.URL||n.webkitURL,z=document.createElement("a");l=l||g.name||"download",z.download=l,z.rel="noopener",typeof g=="string"?(z.href=g,z.origin===location.origin?t(z):e(z.href)?i(g,l,u):t(z,z.target="_blank")):(z.href=d.createObjectURL(g),setTimeout(function(){d.revokeObjectURL(z.href)},4e4),setTimeout(function(){t(z)},0))}:"msSaveOrOpenBlob"in navigator?function(g,l,u){if(l=l||g.name||"download",typeof g!="string")navigator.msSaveOrOpenBlob(o(g,u),l);else if(e(g))i(g,l,u);else{var d=document.createElement("a");d.href=g,d.target="_blank",setTimeout(function(){t(d)})}}:function(g,l,u,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof g=="string")return i(g,l,u);var z=g.type==="application/octet-stream",C=/constructor/i.test(n.HTMLElement)||n.safari,S=/CriOS\/[\d]+/.test(navigator.userAgent);if((S||z&&C||p)&&typeof FileReader<"u"){var b=new FileReader;b.onloadend=function(){var wt=b.result;wt=S?wt:wt.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=wt:location=wt,d=null},b.readAsDataURL(g)}else{var T=n.URL||n.webkitURL,D=T.createObjectURL(g);d?d.location=D:location.href=D,d=null,setTimeout(function(){T.revokeObjectURL(D)},4e4)}});n.saveAs=f.saveAs=f,typeof Uo<"u"&&(Uo.exports=f)})});var Er=()=>({x:"1200px"}),pr=(o,i)=>i.id,xr=(o,i)=>i.role;function Fr(o,i){if(o&1&&(M(0,"nz-alert",2),At(1,"json"),At(2,"json")),o&2){let e=h();c("nzDescription","\u76EE\u524D\u89D2\u8272: "+Rt(1,1,e.firebaseRoles())+" | \u6B0A\u9650: "+Rt(2,3,e.firebasePermissions()))}}function Dr(o,i){o&1&&M(0,"nz-alert",3)}function Tr(o,i){if(o&1&&M(0,"nz-alert",4),o&2){let e=h();c("nzMessage",e.firebaseError()||e.matrixError())}}function wr(o,i){if(o&1){let e=B();r(0,"div",17),M(1,"nz-divider",28),r(2,"div",5)(3,"div",6)(4,"nz-card",29)(5,"button",30),N("click",function(){v(e);let n=h();return y(n.setFirebaseRole("admin"))}),m(6," \u8A2D\u5B9A\u7BA1\u7406\u54E1 "),a(),r(7,"p",31),m(8,"\u64C1\u6709\u6240\u6709\u6B0A\u9650"),a()()(),r(9,"div",6)(10,"nz-card",32)(11,"button",18),N("click",function(){v(e);let n=h();return y(n.setFirebaseRole("moderator"))}),m(12," \u8A2D\u5B9A\u7248\u4E3B "),a(),r(13,"p",31),m(14,"\u5167\u5BB9\u7BA1\u7406\u6B0A\u9650"),a()()(),r(15,"div",6)(16,"nz-card",33)(17,"button",34),N("click",function(){v(e);let n=h();return y(n.setFirebaseRole("user"))}),m(18," \u8A2D\u5B9A\u4F7F\u7528\u8005 "),a(),r(19,"p",31),m(20,"\u57FA\u672C\u4F7F\u7528\u6B0A\u9650"),a()()(),r(21,"div",6)(22,"nz-card",35)(23,"button",34),N("click",function(){v(e);let n=h();return y(n.setFirebaseRole("guest"))}),m(24," \u8A2D\u5B9A\u8A2A\u5BA2 "),a(),r(25,"p",31),m(26,"\u50C5\u8B80\u53D6\u6B0A\u9650"),a()()()()()}if(o&2){let e=h();s(2),c("nzGutter",8),s(),c("nzSpan",6),s(2),c("nzLoading",e.isMatrixLoading())("disabled",!e.canManageFirebaseRoles()),s(4),c("nzSpan",6),s(2),c("nzLoading",e.isMatrixLoading())("disabled",!e.canManageFirebaseRoles()),s(4),c("nzSpan",6),s(2),c("nzLoading",e.isMatrixLoading()),s(4),c("nzSpan",6),s(2),c("nzLoading",e.isMatrixLoading())}}function Ar(o,i){o&1&&(r(0,"div",26),M(1,"nz-spin",36),r(2,"p",37),m(3,"\u8F09\u5165\u6B0A\u9650\u77E9\u9663\u4E2D..."),a()())}function Rr(o,i){if(o&1&&(r(0,"th",39),m(1),a()),o&2){let e=i.$implicit;c("title",e.description),s(),be(" ",e.name," ")}}function Br(o,i){if(o&1){let e=B();r(0,"td",42)(1,"nz-switch",43),N("ngModelChange",function(){let n=v(e).$implicit,p=h().$implicit,f=h(2);return y(f.togglePermissionInMatrix(p.role,n.id))}),a()()}if(o&2){let e=i.$implicit,t=h().$implicit,n=h(2);s(),c("ngModel",t.permissions[e.id])("nzDisabled",!n.canManageFirebaseRoles()||n.isMatrixLoading())}}function Pr(o,i){if(o&1&&(r(0,"tr")(1,"td",40)(2,"nz-tag",41),m(3),a()(),_e(4,Br,2,2,"td",42,pr),a()),o&2){let e=i.$implicit,t=h(2);s(2),c("nzColor",t.getRoleColor(e.role)),s(),be(" ",e.roleName," "),s(),Ne(t.availablePermissions())}}function Lr(o,i){if(o&1&&(r(0,"nz-table",27,0)(2,"thead")(3,"tr")(4,"th",38),m(5,"\u89D2\u8272"),a(),_e(6,Rr,2,2,"th",39,pr),a()(),r(8,"tbody"),_e(9,Pr,6,2,"tr",null,xr),a()()),o&2){let e=h();c("nzData",e.permissionMatrix())("nzPageSize",50)("nzScroll",Ee(3,Er)),s(6),Ne(e.availablePermissions()),s(3),Ne(e.permissionMatrix())}}function Ir(o,i){if(o&1&&(r(0,"nz-tag",49),m(1),a()),o&2){let e=i.$implicit,t=h(3);c("nzColor",t.getRoleColor(e)),s(),be(" ",t.getRoleName(e)," ")}}function kr(o,i){if(o&1&&_e(0,Ir,2,2,"nz-tag",49,Lt),o&2){let e=h(2);Ne(e.firebaseRoles())}}function Or(o,i){o&1&&M(0,"nz-empty",45)}function Vr(o,i){if(o&1&&(r(0,"nz-tag",50),m(1),a()),o&2){let e=i.$implicit,t=h(3);s(),be(" ",t.getPermissionName(e)," ")}}function Ur(o,i){if(o&1&&(r(0,"div",47),_e(1,Vr,2,1,"nz-tag",50,Lt),a()),o&2){let e=h(2);s(),Ne(e.firebasePermissions())}}function Gr(o,i){o&1&&M(0,"nz-empty",48)}function jr(o,i){if(o&1&&(r(0,"div",15)(1,"div",6)(2,"nz-card",44),x(3,kr,2,0)(4,Or,1,0,"nz-empty",45),a()(),r(5,"div",6)(6,"nz-card",46),x(7,Ur,3,0,"div",47)(8,Gr,1,0,"nz-empty",48),a()()()),o&2){let e=h();c("nzGutter",8),s(),c("nzSpan",12),s(2),F(e.firebaseRoles().length>0?3:4),s(2),c("nzSpan",12),s(2),F(e.firebasePermissions().length>0?7:8)}}var Mi=class Mi{constructor(){this.aclSrv=_(ao);this.menuSrv=_(so);this.firebaseRoleService=_(Yt);this.firebaseAuthService=_(Zt);this.message=_(Re);this.full=!0;this.roleA="";this.roleB="";this.firebaseUser=this.firebaseAuthService.currentUser;this.firebaseRoles=this.firebaseRoleService.userRoles;this.firebasePermissions=this.firebaseRoleService.userPermissions;this.firebaseCustomClaims=this.firebaseRoleService.customClaims;this.isFirebaseLoading=this.firebaseRoleService.isLoading;this.firebaseError=this.firebaseRoleService.error;this.hasFirebaseUser=Bt(()=>this.firebaseUser()!==null);this.isFirebaseAdmin=this.firebaseRoleService.isAdmin;this.isFirebaseGuest=this.firebaseRoleService.isGuest;this.availableRoles=this.firebaseRoleService.availableRoles;this.availablePermissions=this.firebaseRoleService.availablePermissions;this.permissionMatrix=Be([]);this.isMatrixLoading=Be(!1);this.matrixError=Be("");this.buildPermissionMatrix()}get data(){return this.aclSrv.data}reMenu(){this.menuSrv.resume()}toggleFull(){this.full=!this.full,this.aclSrv.setFull(this.full),this.reMenu()}toggleRoleA(){this.full=!1,this.roleA=this.roleA==="role-a"?"":"role-a",this.aclSrv.setFull(this.full),this.aclSrv.setRole([this.roleA]),this.reMenu()}toggleRoleB(){this.full=!1,this.roleB=this.roleB==="role-b"?"":"role-b",this.aclSrv.setFull(this.full),this.aclSrv.setRole([this.roleB]),this.reMenu()}buildPermissionMatrix(){try{this.isMatrixLoading.set(!0),this.matrixError.set("");let i=this.availableRoles(),e=this.availablePermissions(),t=i.map(n=>{let p={};return e.forEach(f=>{p[f.id]=n.permissions.includes(f.id)}),{role:n.id,roleName:n.name,permissions:p}});this.permissionMatrix.set(t)}catch(i){console.error("Error building permission matrix:",i),this.matrixError.set("\u5EFA\u7ACB\u6B0A\u9650\u77E9\u9663\u5931\u6557")}finally{this.isMatrixLoading.set(!1)}}syncFirebasePermissions(){return we(this,null,function*(){try{if(!this.hasFirebaseUser()){this.message.warning("\u8ACB\u5148\u767B\u5165 Firebase \u5E33\u865F");return}this.isMatrixLoading.set(!0),this.matrixError.set(""),yield this.firebaseRoleService.syncWithACL(),this.reMenu(),this.message.success("Firebase \u6B0A\u9650\u540C\u6B65\u6210\u529F")}catch(i){console.error("Error syncing Firebase permissions:",i),this.matrixError.set("Firebase \u6B0A\u9650\u540C\u6B65\u5931\u6557"),this.message.error("Firebase \u6B0A\u9650\u540C\u6B65\u5931\u6557")}finally{this.isMatrixLoading.set(!1)}})}setFirebaseRole(i){return we(this,null,function*(){try{if(!this.hasFirebaseUser()){this.message.warning("\u8ACB\u5148\u767B\u5165 Firebase \u5E33\u865F");return}let e=this.firebaseUser();if(!e)return;this.isMatrixLoading.set(!0),this.matrixError.set(""),(yield this.firebaseRoleService.setCustomClaims(e.uid,{roles:[i],permissions:this.getRolePermissions(i)}))?(yield this.firebaseRoleService.syncWithACL(),this.reMenu(),this.message.success(`\u5DF2\u8A2D\u5B9A Firebase \u89D2\u8272: ${this.getRoleName(i)}`)):this.message.error("\u8A2D\u5B9A Firebase \u89D2\u8272\u5931\u6557")}catch(e){console.error("Error setting Firebase role:",e),this.matrixError.set("\u8A2D\u5B9A Firebase \u89D2\u8272\u5931\u6557"),this.message.error("\u8A2D\u5B9A Firebase \u89D2\u8272\u5931\u6557")}finally{this.isMatrixLoading.set(!1)}})}togglePermissionInMatrix(i,e){return we(this,null,function*(){try{this.isMatrixLoading.set(!0),this.matrixError.set("");let t=this.permissionMatrix(),n=t.find(g=>g.role===i);if(!n){this.message.error("\u627E\u4E0D\u5230\u6307\u5B9A\u89D2\u8272");return}let p=!n.permissions[e];n.permissions[e]=p,this.permissionMatrix.set([...t]),this.firebaseRoles().includes(i)&&(yield this.updateFirebasePermissions(i,n.permissions)),this.message.success(`\u5DF2${p?"\u555F\u7528":"\u505C\u7528"} ${this.getRoleName(i)} \u7684 ${this.getPermissionName(e)} \u6B0A\u9650`)}catch(t){console.error("Error toggling permission:",t),this.matrixError.set("\u5207\u63DB\u6B0A\u9650\u5931\u6557"),this.message.error("\u5207\u63DB\u6B0A\u9650\u5931\u6557")}finally{this.isMatrixLoading.set(!1)}})}updateFirebasePermissions(i,e){return we(this,null,function*(){let t=this.firebaseUser();if(!t)return;let n=Object.entries(e).filter(([p,f])=>f).map(([p,f])=>p);yield this.firebaseRoleService.setCustomClaims(t.uid,{roles:[i],permissions:n}),yield this.firebaseRoleService.syncWithACL()})}refreshPermissionMatrix(){return we(this,null,function*(){try{this.isMatrixLoading.set(!0),this.matrixError.set(""),yield this.firebaseRoleService.refreshCurrentUserRoles(),this.buildPermissionMatrix(),this.message.success("\u6B0A\u9650\u77E9\u9663\u5DF2\u91CD\u65B0\u6574\u7406")}catch(i){console.error("Error refreshing permission matrix:",i),this.matrixError.set("\u91CD\u65B0\u6574\u7406\u6B0A\u9650\u77E9\u9663\u5931\u6557"),this.message.error("\u91CD\u65B0\u6574\u7406\u6B0A\u9650\u77E9\u9663\u5931\u6557")}finally{this.isMatrixLoading.set(!1)}})}getRolePermissions(i){return this.availableRoles().find(t=>t.id===i)?.permissions||[]}getRoleName(i){return this.availableRoles().find(t=>t.id===i)?.name||i}getPermissionName(i){return this.availablePermissions().find(t=>t.id===i)?.name||i}canManageFirebaseRoles(){return this.isFirebaseAdmin()||this.firebaseRoleService.hasPermission("role:assign")}getRoleColor(i){return{admin:"red",moderator:"orange",user:"blue",guest:"default"}[i]||"default"}getPermissionCategoryColor(i){return{\u4F7F\u7528\u8005\u7BA1\u7406:"blue",\u89D2\u8272\u7BA1\u7406:"green",\u7CFB\u7D71\u7BA1\u7406:"red",\u5167\u5BB9\u7BA1\u7406:"orange"}[i]||"default"}formatPermissionDisplay(i){let e=this.availablePermissions().find(t=>t.id===i);return e?`${e.name} (${e.category})`:i}isSystemRole(i){return["admin","moderator","user","guest"].includes(i)}getRoleDescription(i){return this.availableRoles().find(t=>t.id===i)?.description||""}getRolePermissionCount(i){let e=this.permissionMatrix().find(t=>t.role===i);return e?Object.values(e.permissions).filter(t=>t).length:0}isCurrentUserRole(i){return this.firebaseRoles().includes(i)}exportPermissionMatrix(){try{let i=this.permissionMatrix(),e={exportTime:new Date().toISOString(),roles:this.availableRoles(),permissions:this.availablePermissions(),matrix:i},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),p=document.createElement("a");p.href=URL.createObjectURL(n),p.download=`firebase-permission-matrix-${new Date().toISOString().split("T")[0]}.json`,p.click(),this.message.success("\u6B0A\u9650\u77E9\u9663\u5DF2\u532F\u51FA")}catch(i){console.error("Error exporting permission matrix:",i),this.message.error("\u532F\u51FA\u6B0A\u9650\u77E9\u9663\u5931\u6557")}}};Mi.\u0275fac=function(e){return new(e||Mi)},Mi.\u0275cmp=E({type:Mi,selectors:[["app-acl"]],decls:57,vars:27,consts:[["permissionTable",""],[1,"alain-default__content-title"],["nzType","info","nzMessage","Firebase \u4F7F\u7528\u8005\u5DF2\u767B\u5165","nzShowIcon","",1,"mb-md",3,"nzDescription"],["nzType","warning","nzMessage","\u672A\u767B\u5165 Firebase","nzDescription","\u8ACB\u5148\u767B\u5165 Firebase \u5E33\u865F\u4EE5\u4F7F\u7528\u5B8C\u6574\u7684\u6B0A\u9650\u7BA1\u7406\u529F\u80FD","nzShowIcon","",1,"mb-md"],["nzType","error","nzShowIcon","","nzCloseable","",1,"mb-md",3,"nzMessage"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nzTitle","\u6309\u94AE\u7C92\u5EA6"],["nz-button","",3,"acl"],["nz-button","",1,"ml-sm",3,"acl"],["nzTitle","\u5168\u91CF"],["nz-button","",3,"click"],[1,"pt-md"],["nzTitle","\u89D2\u8272[role-a]"],["nzTitle","\u89D2\u8272[role-b]"],["nz-row","",1,"mt-md",3,"nzGutter"],["nzTitle","Firebase \u6B0A\u9650\u7BA1\u7406"],[1,"mb-md"],["nz-button","","nzType","primary",3,"click","nzLoading","disabled"],["nz-icon","","nzType","sync"],["nz-button","",1,"ml-sm",3,"click","nzLoading"],["nz-icon","","nzType","reload"],["nz-button","",1,"ml-sm",3,"click","disabled"],["nz-icon","","nzType","download"],["nzTitle","Firebase \u6B0A\u9650\u77E9\u9663"],["nzType","info","nzMessage","\u6B0A\u9650\u77E9\u9663\u8AAA\u660E","nzDescription","\u6B64\u77E9\u9663\u986F\u793A\u6240\u6709\u89D2\u8272\u8207\u529F\u80FD\u6B0A\u9650\u7684\u5C0D\u61C9\u95DC\u4FC2\u3002\u60A8\u53EF\u4EE5\u5373\u6642\u7DE8\u8F2F\u6B0A\u9650\u8A2D\u5B9A\uFF0C\u8B8A\u66F4\u6703\u540C\u6B65\u5230 Firebase Custom Claims\u3002","nzShowIcon",""],[1,"text-center","py-lg"],["nzSize","small",3,"nzData","nzPageSize","nzScroll"],["nzText","\u5FEB\u901F\u8A2D\u5B9A Firebase \u89D2\u8272"],["nzTitle","\u7BA1\u7406\u54E1","nzSize","small"],["nz-button","","nzType","primary","nzDanger","",3,"click","nzLoading","disabled"],[1,"mt-sm","text-grey"],["nzTitle","\u7248\u4E3B","nzSize","small"],["nzTitle","\u4F7F\u7528\u8005","nzSize","small"],["nz-button","",3,"click","nzLoading"],["nzTitle","\u8A2A\u5BA2","nzSize","small"],["nzSize","large"],[1,"mt-md"],["nzWidth","120px","nzLeft",""],["nzWidth","100px",1,"text-center",3,"title"],["nzLeft",""],[1,"role-tag",3,"nzColor"],[1,"text-center"],["nzSize","small",3,"ngModelChange","ngModel","nzDisabled"],["nzTitle","\u76EE\u524D\u4F7F\u7528\u8005\u89D2\u8272"],["nzNotFoundImage","simple","nzNotFoundContent","\u5C1A\u672A\u5206\u914D\u89D2\u8272"],["nzTitle","\u76EE\u524D\u4F7F\u7528\u8005\u6B0A\u9650"],[1,"permission-list"],["nzNotFoundImage","simple","nzNotFoundContent","\u5C1A\u672A\u5206\u914D\u6B0A\u9650"],[1,"mb-sm",3,"nzColor"],["nzColor","blue",1,"mb-sm"]],template:function(e,t){e&1&&(r(0,"div",1)(1,"h1"),m(2," ACL \u8BBF\u95EE\u63A7\u5236 "),r(3,"small"),m(4," \u6CE8\u610F\u89C2\u5BDF\u5DE6\u8FB9\u7684\u83DC\u5355\uFF1BACLService\u63D0\u4F9B\u4E00\u4E2A\u5B8C\u6574\u7684\u57FA\u4E8E\u89D2\u8272\u7684\u8BBF\u95EE\u63A7\u5236\u7684\u670D\u52A1\uFF0C\u82E5\u9700\u8981\u652F\u6301\u8DEF\u7531\u5B88\u536B\uFF0C\u8BF7\u914D\u5408ACLService\u4E0ERoute Guard\u914D\u5408\u7B80\u4FBF\u5B9E\u73B0\u3002 \u73FE\u5DF2\u6574\u5408 Firebase Authentication \u6B0A\u9650\u7BA1\u7406\u7CFB\u7D71\u3002 "),a()()(),x(5,Fr,3,5,"nz-alert",2)(6,Dr,1,0,"nz-alert",3),x(7,Tr,1,1,"nz-alert",4),r(8,"div",5)(9,"div",6)(10,"nz-card",7),m(11),At(12,"json"),r(13,"button",8),m(14,"role-a"),a(),r(15,"button",9),m(16,"role-b"),a()()()(),r(17,"div",5)(18,"div",6)(19,"nz-card",10)(20,"button",11),N("click",function(){return t.toggleFull()}),r(21,"span"),m(22),a()(),r(23,"p",12),m(24,"\u5168\u91CF\u7C7B\u6307\u7CFB\u7EDF\u7BA1\u7406\u5458\u89D2\u8272\uFF0C\u65E0\u4EFB\u4F55\u53D7\u9650\u3002"),a()()(),r(25,"div",6)(26,"nz-card",13)(27,"button",11),N("click",function(){return t.toggleRoleA()}),r(28,"span"),m(29),a()()()(),r(30,"div",6)(31,"nz-card",14)(32,"button",11),N("click",function(){return t.toggleRoleB()}),r(33,"span"),m(34),a()()()()(),r(35,"div",15)(36,"div",6)(37,"nz-card",16)(38,"div",17)(39,"button",18),N("click",function(){return t.syncFirebasePermissions()}),M(40,"i",19),m(41," \u540C\u6B65 Firebase \u6B0A\u9650 "),a(),r(42,"button",20),N("click",function(){return t.refreshPermissionMatrix()}),M(43,"i",21),m(44," \u91CD\u65B0\u6574\u7406\u77E9\u9663 "),a(),r(45,"button",22),N("click",function(){return t.exportPermissionMatrix()}),M(46,"i",23),m(47," \u532F\u51FA\u77E9\u9663 "),a()(),x(48,wr,27,11,"div",17),a()()(),r(49,"div",15)(50,"div",6)(51,"nz-card",24)(52,"div",17),M(53,"nz-alert",25),a(),x(54,Ar,4,0,"div",26)(55,Lr,11,4,"nz-table",27),a()()(),x(56,jr,9,5,"div",15)),e&2&&(s(5),F(t.hasFirebaseUser()?5:6),s(2),F(t.firebaseError()||t.matrixError()?7:-1),s(),c("nzGutter",8),s(),c("nzSpan",24),s(2),be(" ACL\u539F\u59CB\u6570\u636E\uFF1A",Rt(12,25,t.data)," "),s(2),c("acl","role-a"),s(2),c("acl","role-b"),s(2),c("nzGutter",8),s(),c("nzSpan",8),s(4),be("",t.full?"\u79BB\u5F00":"\u8BBE\u7F6E","\u6743\u9650"),s(3),c("nzSpan",8),s(4),be("",t.roleA.length>0?"\u79BB\u5F00":"\u8BBE\u7F6E","\u6743\u9650"),s(),c("nzSpan",8),s(4),be("",t.roleB.length>0?"\u79BB\u5F00":"\u8BBE\u7F6E","\u6743\u9650"),s(),c("nzGutter",8),s(),c("nzSpan",24),s(3),c("nzLoading",t.isFirebaseLoading())("disabled",!t.hasFirebaseUser()),s(3),c("nzLoading",t.isMatrixLoading()),s(3),c("disabled",t.permissionMatrix().length===0),s(3),F(t.hasFirebaseUser()?48:-1),s(),c("nzGutter",8),s(),c("nzSpan",24),s(4),F(t.isMatrixLoading()?54:55),s(2),F(t.hasFirebaseUser()?56:-1))},dependencies:[O,Ie,xt,V,se,ie,pe,de,ue,bn,A,Me,L,ye,q,oe,Tt,Dt,G,H,he,X,w,St,U,ce,Ut,I,J,zi,pi,ci,hi,fi,gi,$n,k,le,ee,te,Q,ze,K,W,Jt,me,ge,ae,Yn,j,ne,fe,R,po,re,Se,$,mo,Ce,Z,P,Y,uo,qt],encapsulation:2});var zo=Mi;var Wr=()=>({minRows:2,maxRows:6}),Hr=(o,i)=>i.uid,ko=(o,i)=>i.id;function $r(o,i){if(o&1&&M(0,"nz-alert",2),o&2){let e=h();c("nzMessage",e.error())}}function qr(o,i){if(o&1&&(r(0,"nz-tag",12),m(1),a()),o&2){let e=i.$implicit,t=h(2);c("nzColor",t.getRoleColor(e)),s(),be(" ",t.getRoleName(e)," ")}}function Zr(o,i){if(o&1){let e=B();r(0,"tr")(1,"td")(2,"div",10),M(3,"nz-avatar",11),m(4),a()(),r(5,"td"),m(6),a(),r(7,"td"),_e(8,qr,2,2,"nz-tag",12,Lt),a(),r(10,"td")(11,"nz-tag"),m(12),a()(),r(13,"td")(14,"button",13),N("click",function(){let n=v(e).$implicit,p=h();return y(p.selectUser(n))}),m(15," \u9078\u64C7 "),a()()()}if(o&2){let e,t=i.$implicit,n=h();ri("ant-table-row-selected",((e=n.selectedUser())==null?null:e.uid)===t.uid),s(4),be(" ",t.displayName||"\u672A\u547D\u540D\u4F7F\u7528\u8005"," "),s(2),Pe(t.email||"\u7121 Email"),s(2),Ne(t.roles),s(4),be("",t.permissions.length," \u500B\u6B0A\u9650"),s(2),c("disabled",n.isLoading())}}function Yr(o,i){if(o&1){let e=B();r(0,"i",26),N("click",function(){v(e);let n=h().$implicit,p=h(3);return y(p.removeRole(n))}),a()}o&2&&c("nzTooltipTitle","\u79FB\u9664\u89D2\u8272")}function Xr(o,i){if(o&1&&(r(0,"nz-tag",24),m(1),x(2,Yr,1,1,"i",25),a()),o&2){let e=i.$implicit,t=h(3);c("nzColor",t.getRoleColor(e)),s(),be(" ",t.getRoleName(e)," "),s(),F(!t.isSystemRole(e)||t.canManageRoles()?2:-1)}}function Jr(o,i){if(o&1&&_e(0,Xr,3,3,"nz-tag",24,Lt),o&2){let e=h(2);Ne(e.selectedUser().roles)}}function Kr(o,i){o&1&&M(0,"nz-empty",18)}function Qr(o,i){if(o&1&&M(0,"nz-option",28),o&2){let e=h().$implicit;c("nzValue",e.id)("nzLabel",e.name)}}function ea(o,i){if(o&1&&x(0,Qr,1,2,"nz-option",28),o&2){let e=i.$implicit,t=h(3);F(t.hasRole(e.id)?-1:0)}}function ta(o,i){if(o&1){let e=B();r(0,"div",17)(1,"h4"),m(2,"\u5206\u914D\u65B0\u89D2\u8272"),a(),r(3,"form",21),N("ngSubmit",function(){v(e);let n=h(2);return y(n.assignRole())}),r(4,"nz-form-item")(5,"nz-form-control")(6,"nz-select",27),_e(7,ea,1,1,null,null,ko),a()()(),r(9,"button",23),m(10," \u5206\u914D\u89D2\u8272 "),a()()()}if(o&2){let e=h(2);s(3),c("formGroup",e.roleForm),s(4),Ne(e.availableRoles()),s(2),c("disabled",e.roleForm.invalid||e.isLoading())}}function ia(o,i){if(o&1){let e=B();r(0,"button",29),N("click",function(){v(e);let n=h(2);return y(n.openCreateRoleForm())}),M(1,"i",30),m(2," \u5EFA\u7ACB\u81EA\u8A02\u89D2\u8272 "),a()}if(o&2){let e=h(2);c("disabled",e.isLoading())}}function oa(o,i){if(o&1&&(r(0,"label",34),m(1),r(2,"small",35),m(3),a()()),o&2){let e=i.$implicit,t=h(3);c("nzValue",e.id)("nzDisabled",!t.canManageRoles()),s(),be(" ",e.name," "),s(2),Pe(e.description)}}function na(o,i){if(o&1&&(r(0,"div",22)(1,"nz-divider",31)(2,"nz-tag",32),m(3),a()(),r(4,"nz-checkbox-group",33),_e(5,oa,4,4,"label",34,ko),a()()),o&2){let e=i.$implicit,t=h(2);s(),c("nzText",e),s(),c("nzColor",t.getCategoryColor(e)),s(),Pe(e),s(2),Ne(t.getPermissionsByCategory(e))}}function ra(o,i){if(o&1&&(r(0,"button",23),m(1," \u66F4\u65B0\u6B0A\u9650 "),a()),o&2){let e=h(2);c("disabled",e.isLoading())}}function aa(o,i){if(o&1){let e=B();r(0,"nz-card",6)(1,"div",14)(2,"div",15)(3,"nz-card",16)(4,"div",17)(5,"h4"),m(6,"\u7576\u524D\u89D2\u8272"),a(),x(7,Jr,2,0)(8,Kr,1,0,"nz-empty",18),a(),x(9,ta,11,2,"div",17),x(10,ia,3,1,"button",19),a()(),r(11,"div",15)(12,"nz-card",20)(13,"form",21),N("ngSubmit",function(){v(e);let n=h();return y(n.updatePermissions())}),_e(14,na,7,3,"div",22,Lt),x(16,ra,2,1,"button",23),a()()()()()}if(o&2){let e,t,n=h();c("nzTitle","\u7BA1\u7406\u4F7F\u7528\u8005: "+((e=n.selectedUser())==null?null:e.displayName))("nzLoading",n.isLoading()),s(),c("nzGutter",16),s(),c("nzSpan",12),s(5),F((t=n.selectedUser())!=null&&t.roles&&n.selectedUser().roles.length>0?7:8),s(2),F(n.canManageRoles()?9:-1),s(),F(n.canManageRoles()?10:-1),s(),c("nzSpan",12),s(2),c("formGroup",n.permissionForm),s(),Ne(n.getPermissionCategories()),s(2),F(n.canManageRoles()?16:-1)}}function sa(o,i){o&1&&(r(0,"nz-card",7),M(1,"nz-empty",36),a())}function la(o,i){if(o&1&&(r(0,"label",47),m(1),r(2,"small",35),m(3),a()()),o&2){let e=i.$implicit;c("nzValue",e.id),s(),be(" ",e.name," "),s(2),Pe(e.description)}}function ma(o,i){if(o&1&&(r(0,"div",22)(1,"h4")(2,"nz-tag",32),m(3),a()(),_e(4,la,4,3,"label",47,ko),a()),o&2){let e=i.$implicit,t=h(2);s(2),c("nzColor",t.getCategoryColor(e)),s(),Pe(e),s(),Ne(t.getPermissionsByCategory(e))}}function ua(o,i){if(o&1){let e=B();eo(0),r(1,"form",21),N("ngSubmit",function(){v(e);let n=h();return y(n.onCreateCustomRole())}),r(2,"nz-form-item")(3,"nz-form-label",37),m(4,"\u89D2\u8272 ID"),a(),r(5,"nz-form-control",38),M(6,"input",39),a()(),r(7,"nz-form-item")(8,"nz-form-label",37),m(9,"\u89D2\u8272\u540D\u7A31"),a(),r(10,"nz-form-control",40),M(11,"input",41),a()(),r(12,"nz-form-item")(13,"nz-form-label"),m(14,"\u89D2\u8272\u63CF\u8FF0"),a(),r(15,"nz-form-control")(16,"textarea",42),m(17," "),a()()(),r(18,"nz-form-item")(19,"nz-form-control")(20,"label",43),m(21," \u8A2D\u70BA\u9810\u8A2D\u89D2\u8272\uFF08\u65B0\u4F7F\u7528\u8005\u81EA\u52D5\u5206\u914D\uFF09 "),a()()(),M(22,"nz-divider",44),r(23,"nz-form-item")(24,"nz-form-control")(25,"nz-checkbox-group",33),_e(26,ma,6,2,"div",22,Lt),a()()(),r(28,"nz-form-item")(29,"nz-form-control")(30,"button",45),m(31," \u5EFA\u7ACB\u89D2\u8272 "),a(),r(32,"button",46),N("click",function(){v(e);let n=h();return y(n.closeModal())}),m(33," \u53D6\u6D88 "),a()()()(),to()}if(o&2){let e=h();s(),c("formGroup",e.customRoleForm),s(15),c("nzAutosize",Ee(4,Wr)),s(10),Ne(e.getPermissionCategories()),s(4),c("nzLoading",e.isLoading())("disabled",e.customRoleForm.invalid)}}var _i=class _i{constructor(){this.firebaseRoleService=_(Yt);this.firebaseAuthService=_(Zt);this.message=_(Re);this.fb=_(Bn);this.firebaseUser=this.firebaseAuthService.currentUser;this.isLoading=Be(!1);this.error=Be("");this.availableRoles=Be([{id:It.ADMIN,name:"\u7BA1\u7406\u54E1"},{id:It.MODERATOR,name:"\u7248\u4E3B"},{id:It.USER,name:"\u4F7F\u7528\u8005"},{id:It.GUEST,name:"\u8A2A\u5BA2"}]);this.availablePermissions=Be([{id:ti.USER_READ,name:"\u8B80\u53D6\u4F7F\u7528\u8005",category:"\u4F7F\u7528\u8005\u7BA1\u7406"},{id:ti.USER_WRITE,name:"\u7DE8\u8F2F\u4F7F\u7528\u8005",category:"\u4F7F\u7528\u8005\u7BA1\u7406"},{id:ti.ROLE_READ,name:"\u8B80\u53D6\u89D2\u8272",category:"\u89D2\u8272\u7BA1\u7406"},{id:ti.ROLE_ASSIGN,name:"\u5206\u914D\u89D2\u8272",category:"\u89D2\u8272\u7BA1\u7406"},{id:ti.CONTENT_READ,name:"\u8B80\u53D6\u5167\u5BB9",category:"\u5167\u5BB9\u7BA1\u7406"},{id:ti.CONTENT_WRITE,name:"\u7DE8\u8F2F\u5167\u5BB9",category:"\u5167\u5BB9\u7BA1\u7406"}]);this.availableUsers=Be([]);this.selectedUser=Be(null);this.showNewRoleForm=Be(!1);this.hasFirebaseUser=Bt(()=>this.firebaseUser()!==null);this.canManageRoles=Bt(()=>this.firebaseRoleService.isAdmin());this.hasSelectedUser=Bt(()=>this.selectedUser()!==null);this.isAdmin=Bt(()=>this.firebaseRoleService.isAdmin());this.roleForm=this.fb.group({selectedRole:["",Wi.required]}),this.permissionForm=this.fb.group({permissions:[[]]}),this.customRoleForm=this.fb.group({id:["",[Wi.required,Wi.pattern(/^[a-z][a-z0-9_]*$/)]],name:["",Wi.required],description:[""],permissions:[[]],isDefault:[!1]}),this.initializeData()}initializeData(){return we(this,null,function*(){try{this.isLoading.set(!0),this.error.set(""),this.availableUsers.set([{uid:"user1",email:"user1@example.com",displayName:"User One",isAnonymous:!1,roles:["user"],permissions:["content:read"]},{uid:"user2",email:"user2@example.com",displayName:"User Two",isAnonymous:!1,roles:["moderator"],permissions:["content:read","content:write"]}])}catch(i){console.error("Error initializing data:",i),this.error.set("\u521D\u59CB\u5316\u6578\u64DA\u5931\u6557")}finally{this.isLoading.set(!1)}})}selectUser(i){this.selectedUser.set(i),this.permissionForm.patchValue({permissions:i.permissions})}assignRole(){return we(this,null,function*(){let i=this.selectedUser(),e=this.roleForm.value.selectedRole;if(!i||!e){this.message.warning("\u8ACB\u9078\u64C7\u4F7F\u7528\u8005\u548C\u89D2\u8272");return}try{if(this.isLoading.set(!0),!0){let n=qi(Ae({},i),{roles:[...i.roles,e]});this.selectedUser.set(n);let p=this.availableUsers(),f=p.findIndex(g=>g.uid===i.uid);f>=0&&(p[f]=n,this.availableUsers.set([...p])),this.message.success(`\u5DF2\u5206\u914D\u89D2\u8272: ${e}`),this.roleForm.reset()}else this.message.error("\u5206\u914D\u89D2\u8272\u5931\u6557")}catch(t){console.error("Error assigning role:",t),this.message.error("\u5206\u914D\u89D2\u8272\u5931\u6557")}finally{this.isLoading.set(!1)}})}removeRole(i){return we(this,null,function*(){let e=this.selectedUser();if(!e){this.message.warning("\u8ACB\u9078\u64C7\u4F7F\u7528\u8005");return}try{if(this.isLoading.set(!0),!0){let n=qi(Ae({},e),{roles:e.roles.filter(g=>g!==i)});this.selectedUser.set(n);let p=this.availableUsers(),f=p.findIndex(g=>g.uid===e.uid);f>=0&&(p[f]=n,this.availableUsers.set([...p])),this.message.success(`\u5DF2\u79FB\u9664\u89D2\u8272: ${i}`)}else this.message.error("\u79FB\u9664\u89D2\u8272\u5931\u6557")}catch(t){console.error("Error removing role:",t),this.message.error("\u79FB\u9664\u89D2\u8272\u5931\u6557")}finally{this.isLoading.set(!1)}})}updatePermissions(){return we(this,null,function*(){let i=this.selectedUser(),e=this.permissionForm.value.permissions;if(!i){this.message.warning("\u8ACB\u9078\u64C7\u4F7F\u7528\u8005");return}try{if(this.isLoading.set(!0),!0){let n=qi(Ae({},i),{permissions:e});this.selectedUser.set(n);let p=this.availableUsers(),f=p.findIndex(g=>g.uid===i.uid);f>=0&&(p[f]=n,this.availableUsers.set([...p])),this.message.success("\u5DF2\u66F4\u65B0\u6B0A\u9650")}else this.message.error("\u66F4\u65B0\u6B0A\u9650\u5931\u6557")}catch(t){console.error("Error updating permissions:",t),this.message.error("\u66F4\u65B0\u6B0A\u9650\u5931\u6557")}finally{this.isLoading.set(!1)}})}onCreateCustomRole(){return we(this,null,function*(){if(this.customRoleForm.invalid){this.message.warning("\u8ACB\u586B\u5BEB\u5FC5\u8981\u6B04\u4F4D");return}try{this.isLoading.set(!0);let i=this.customRoleForm.value;!0?(this.message.success(`\u5DF2\u5EFA\u7ACB\u89D2\u8272: ${i.name}`),this.showNewRoleForm.set(!1),this.customRoleForm.reset()):this.message.error("\u5EFA\u7ACB\u89D2\u8272\u5931\u6557")}catch(i){console.error("Error creating custom role:",i),this.message.error("\u5EFA\u7ACB\u89D2\u8272\u5931\u6557")}finally{this.isLoading.set(!1)}})}openCreateRoleForm(){this.showNewRoleForm.set(!0),this.customRoleForm.reset()}closeModal(){this.showNewRoleForm.set(!1)}hasRole(i){let e=this.selectedUser();return e?e.roles.includes(i):!1}hasPermission(i){let e=this.selectedUser();return e?e.permissions.includes(i):!1}getRoleName(i){return{admin:"\u7BA1\u7406\u54E1",moderator:"\u7248\u4E3B",user:"\u4F7F\u7528\u8005",guest:"\u8A2A\u5BA2"}[i]||i}getPermissionName(i){return this.availablePermissions().find(t=>t.id===i)?.name||i}getRoleColor(i){return{admin:"red",moderator:"orange",user:"blue",guest:"default"}[i]||"default"}isSystemRole(i){return["admin","moderator","user","guest"].includes(i)}getPermissionCategories(){let i=new Set;return this.availablePermissions().forEach(e=>{e.category&&i.add(e.category)}),Array.from(i)}getPermissionsByCategory(i){return this.availablePermissions().filter(e=>e.category===i)}getCategoryColor(i){return{\u4F7F\u7528\u8005\u7BA1\u7406:"blue",\u89D2\u8272\u7BA1\u7406:"green",\u7CFB\u7D71\u7BA1\u7406:"red",\u5167\u5BB9\u7BA1\u7406:"orange"}[i]||"default"}};_i.\u0275fac=function(e){return new(e||_i)},_i.\u0275cmp=E({type:_i,selectors:[["app-firebase-role-manager"]],decls:28,vars:7,consts:[["userTable",""],[1,"alain-default__content-title"],["nzType","error","nzShowIcon","","nzCloseable","",1,"mb-md",3,"nzMessage"],["nzTitle","\u4F7F\u7528\u8005\u5217\u8868",3,"nzLoading"],["nzSize","small",3,"nzData","nzPageSize"],[3,"ant-table-row-selected"],[1,"mt-md",3,"nzTitle","nzLoading"],[1,"mt-md"],["nzTitle","\u5EFA\u7ACB\u81EA\u8A02\u89D2\u8272",3,"nzOnCancel","nzVisibleChange","nzVisible","nzFooter"],[4,"nzModalContent"],[1,"d-flex","align-items-center"],["nzIcon","user",1,"mr-sm"],[1,"mr-xs",3,"nzColor"],["nz-button","","nzType","primary","nzSize","small",3,"click","disabled"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nzTitle","\u89D2\u8272\u5206\u914D","nzSize","small"],[1,"mb-md"],["nzNotFoundImage","simple","nzNotFoundContent","\u5C1A\u672A\u5206\u914D\u89D2\u8272"],["nz-button","","nzType","dashed",3,"disabled"],["nzTitle","\u6B0A\u9650\u7BA1\u7406","nzSize","small"],["nz-form","",3,"ngSubmit","formGroup"],[1,"permission-category","mb-md"],["nz-button","","nzType","primary","type","submit",3,"disabled"],[1,"mb-sm","mr-sm",3,"nzColor"],["nz-icon","","nzType","close","nz-tooltip","",1,"ml-xs","cursor-pointer",3,"nzTooltipTitle"],["nz-icon","","nzType","close","nz-tooltip","",1,"ml-xs","cursor-pointer",3,"click","nzTooltipTitle"],["formControlName","selectedRole","nzPlaceHolder","\u9078\u64C7\u89D2\u8272"],[3,"nzValue","nzLabel"],["nz-button","","nzType","dashed",3,"click","disabled"],["nz-icon","","nzType","plus"],["nzOrientation","left",3,"nzText"],[3,"nzColor"],["formControlName","permissions"],["nz-checkbox","",1,"d-block","mb-sm",3,"nzValue","nzDisabled"],[1,"text-muted","d-block"],["nzNotFoundContent","\u8ACB\u5148\u9078\u64C7\u4E00\u500B\u4F7F\u7528\u8005"],["nzRequired",""],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u89D2\u8272 ID\uFF08\u5C0F\u5BEB\u82F1\u6587\u958B\u982D\uFF09"],["nz-input","","formControlName","id","placeholder","\u4F8B\u5982: editor"],["nzErrorTip","\u8ACB\u8F38\u5165\u89D2\u8272\u540D\u7A31"],["nz-input","","formControlName","name","placeholder","\u4F8B\u5982: \u7DE8\u8F2F\u8005"],["nz-input","","formControlName","description","placeholder","\u89D2\u8272\u7528\u9014\u63CF\u8FF0",3,"nzAutosize"],["nz-checkbox","","formControlName","isDefault"],["nzText","\u9078\u64C7\u6B0A\u9650"],["nz-button","","nzType","primary","type","submit",3,"nzLoading","disabled"],["nz-button","","type","button",1,"ml-sm",3,"click"],["nz-checkbox","",1,"d-block","mb-sm",3,"nzValue"]],template:function(e,t){if(e&1){let n=B();r(0,"div",1)(1,"h1"),m(2," Firebase \u89D2\u8272\u7BA1\u7406 "),r(3,"small"),m(4,"\u7BA1\u7406 Firebase \u4F7F\u7528\u8005\u89D2\u8272\u548C\u6B0A\u9650\uFF0C\u652F\u63F4\u81EA\u8A02\u89D2\u8272\u5EFA\u7ACB\u548C\u6B0A\u9650\u5206\u914D\u3002"),a()()(),x(5,$r,1,1,"nz-alert",2),r(6,"nz-card",3)(7,"nz-table",4,0)(9,"thead")(10,"tr")(11,"th"),m(12,"\u4F7F\u7528\u8005"),a(),r(13,"th"),m(14,"Email"),a(),r(15,"th"),m(16,"\u89D2\u8272"),a(),r(17,"th"),m(18,"\u6B0A\u9650"),a(),r(19,"th"),m(20,"\u64CD\u4F5C"),a()()(),r(21,"tbody"),_e(22,Zr,16,6,"tr",5,Hr),a()()(),x(24,aa,17,10,"nz-card",6)(25,sa,2,0,"nz-card",7),r(26,"nz-modal",8),N("nzOnCancel",function(){return v(n),y(t.showNewRoleForm.set(!1))})("nzVisibleChange",function(f){return v(n),y(t.showNewRoleForm.set(f))}),Ht(27,ua,34,5,"ng-container",9),a()}e&2&&(s(5),F(t.error()?5:-1),s(),c("nzLoading",t.isLoading()),s(),c("nzData",t.availableUsers())("nzPageSize",10),s(15),Ne(t.availableUsers()),s(2),F(t.hasSelectedUser()?24:t.isLoading()?-1:25),s(2),c("nzVisible",t.showNewRoleForm())("nzFooter",null))},dependencies:[O,Ot,Et,Ie,kt,V,An,Rn,se,ie,pe,de,ue,A,Me,L,ye,q,oe,Tt,Dt,G,Pn,Ln,H,In,he,X,ui,di,w,St,U,ce,Ut,I,Dn,Fn,J,zi,pi,ci,hi,fi,gi,k,le,ee,Ft,co,te,Q,ze,K,W,Jt,me,ge,ae,j,ne,Vt,Kt,ei,Qt,fe,tr,R,re,Se,$,mo,Ce,Z,P,Y,uo],styles:[".permission-category[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:8px}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}.ant-table-row-selected[_ngcontent-%COMP%]{background-color:#e6f7ff}.mr-xs[_ngcontent-%COMP%]{margin-right:4px}.mr-sm[_ngcontent-%COMP%]{margin-right:8px}.mb-sm[_ngcontent-%COMP%]{margin-bottom:8px}.mb-md[_ngcontent-%COMP%]{margin-bottom:16px}.mt-md[_ngcontent-%COMP%]{margin-top:16px}.ml-xs[_ngcontent-%COMP%]{margin-left:4px}.ml-sm[_ngcontent-%COMP%]{margin-left:8px}.d-flex[_ngcontent-%COMP%]{display:flex}.align-items-center[_ngcontent-%COMP%]{align-items:center}.d-block[_ngcontent-%COMP%]{display:block}.text-muted[_ngcontent-%COMP%]{color:#999}"]});var go=_i;var da=new tn("DC_STORE_STORAGE_TOKEN",{providedIn:"root",factory:()=>new Oo}),Oo=class{platform=_(Lo);get(i){return this.platform.isBrowser&&JSON.parse(localStorage.getItem(i)||"null")||null}set(i,e){return this.platform.isBrowser&&localStorage.setItem(i,JSON.stringify(e)),!0}remove(i){this.platform.isBrowser&&localStorage.removeItem(i)}},cr=(()=>{class o{store=_(da);http=_(oo);platform=_(Lo);memory=new Map;notifyBuffer=new Map;meta=new Set;freqTick=3e3;freqTime;cog=_(li).merge("cache",{mode:"promise",reName:"",prefix:"",meta_key:"__cache_meta"});constructor(){this.platform.isBrowser&&(this.loadMeta(),this.startExpireNotify())}pushMeta(e){this.meta.has(e)||(this.meta.add(e),this.saveMeta())}removeMeta(e){this.meta.has(e)&&(this.meta.delete(e),this.saveMeta())}loadMeta(){let e=this.store.get(this.cog.meta_key);e&&e.v&&e.v.forEach(t=>this.meta.add(t))}saveMeta(){let e=[];this.meta.forEach(t=>e.push(t)),this.store.set(this.cog.meta_key,{v:e,e:0})}getMeta(){return this.meta}set(e,t,n={}){if(!this.platform.isBrowser)return;let p=0,{type:f,expire:g}=this.cog;n=Ae({type:f,expire:g},n),n.expire&&(p=Sn(new Date,n.expire).valueOf());let l=n.emitNotify!==!1;if(!(t instanceof Pi)){this.save(n.type,e,{v:t,e:p},l);return}return t.pipe(Bo(u=>{this.save(n.type,e,{v:u,e:p},l)}))}save(e,t,n,p=!0){e==="m"?this.memory.set(t,n):(this.store.set(this.cog.prefix+t,n),this.pushMeta(t)),p&&this.runNotify(t,"set")}get(e,t={}){if(!this.platform.isBrowser)return null;let n=t.mode!=="none"&&this.cog.mode==="promise",p=this.memory.has(e)?this.memory.get(e):this.store.get(this.cog.prefix+e);return!p||p.e&&p.e>0&&p.e<new Date().valueOf()?n?(this.cog.request?this.cog.request(e):this.http.get(e)).pipe(Jo(f=>Nn(f,this.cog.reName,f)),Bo(f=>this.set(e,f,{type:t.type,expire:t.expire,emitNotify:t.emitNotify}))):null:n?Li(p.v):p.v}getNone(e){return this.get(e,{mode:"none"})}tryGet(e,t,n={}){if(!this.platform.isBrowser)return null;let p=this.getNone(e);return p===null?t instanceof Pi?this.set(e,t,n):(this.set(e,t,n),t):Li(p)}has(e){return this.memory.has(e)||this.meta.has(e)}_remove(e,t){if(t&&this.runNotify(e,"remove"),this.memory.has(e)){this.memory.delete(e);return}this.store.remove(this.cog.prefix+e),this.removeMeta(e)}remove(e){this.platform.isBrowser&&this._remove(e,!0)}clear(){this.platform.isBrowser&&(this.notifyBuffer.forEach((e,t)=>this.runNotify(t,"remove")),this.memory.clear(),this.meta.forEach(e=>this.store.remove(this.cog.prefix+e)))}set freq(e){this.freqTick=Math.max(20,e),this.abortExpireNotify(),this.startExpireNotify()}startExpireNotify(){this.checkExpireNotify(),this.runExpireNotify()}runExpireNotify(){this.freqTime=setTimeout(()=>{this.checkExpireNotify(),this.runExpireNotify()},this.freqTick)}checkExpireNotify(){let e=[];this.notifyBuffer.forEach((t,n)=>{this.has(n)&&this.getNone(n)===null&&e.push(n)}),e.forEach(t=>{this.runNotify(t,"expire"),this._remove(t,!1)})}abortExpireNotify(){clearTimeout(this.freqTime)}runNotify(e,t){this.notifyBuffer.has(e)&&this.notifyBuffer.get(e).next({type:t,value:this.getNone(e)})}notify(e){if(!this.notifyBuffer.has(e)){let t=new Zi(this.getNone(e));this.notifyBuffer.set(e,t)}return this.notifyBuffer.get(e).asObservable()}cancelNotify(e){this.notifyBuffer.has(e)&&(this.notifyBuffer.get(e).unsubscribe(),this.notifyBuffer.delete(e))}hasNotify(e){return this.notifyBuffer.has(e)}clearNotify(){this.notifyBuffer.forEach(e=>e.unsubscribe()),this.notifyBuffer.clear()}ngOnDestroy(){this.memory.clear(),this.abortExpireNotify(),this.clearNotify()}static \u0275fac=function(t){return new(t||o)};static \u0275prov=Wt({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Hs=new hn(()=>({}));var Ni=class Ni{constructor(){this.cache=_(cr);this.msg=_(Re);this.KEY="user"}set(){this.cache.set(this.KEY,+new Date)}get(){this.msg.success(this.cache.getNone(this.KEY))}};Ni.\u0275fac=function(e){return new(e||Ni)},Ni.\u0275cmp=E({type:Ni,selectors:[["app-cache"]],decls:10,vars:0,consts:[[1,"alain-default__content-title"],["href","https://ng-alain.com/components/cache","target","_blank"],["nzTitle","Service"],["nz-button","",3,"click"],["nz-button","",1,"ml-sm",3,"click"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"h1"),m(2," Cache \u7F13\u5B58, "),r(3,"a",1),m(4,"Document"),a()()(),r(5,"nz-card",2)(6,"button",3),N("click",function(){return t.set()}),m(7,"\u8BBE\u7F6E"),a(),r(8,"button",4),N("click",function(){return t.get()}),m(9,"\u83B7\u53D6"),a()())},dependencies:[O,V,se,ie,pe,de,ue,A,Me,L,ye,q,oe,G,H,he,X,w,U,ce,I,J,k,le,ee,te,Q,ze,K,W,me,ge,ae,j,ne,fe,R,re,Se,$,Ce,Z,P,Y],encapsulation:2});var ho=Ni;var fr=Yo(Go(),1);var zr=(()=>{class o{el=_(ni).nativeElement;_http=_(lo);httpData;httpBody;httpMethod="get";httpUrl;fileName;pre;success=new Oi;error=new Oi;getDisposition(e){return(e||"").split(";").filter(n=>n.includes("=")).map(n=>{let p=n.split("="),f="UTF-8''",g=p[1];return g.startsWith(f)&&(g=g.substring(f.length)),{[p[0].trim()]:g}}).reduce((n,p)=>p,{})}isFileSaverSupported=!1;constructor(){try{this.isFileSaverSupported=!!new Blob}catch{}this.isFileSaverSupported||this.el.classList.add("down-file__not-support")}setDisabled(e){let t=this.el;t.disabled=e,t.classList[e?"add":"remove"]("down-file__disabled")}_click(e){return we(this,null,function*(){if(!this.isFileSaverSupported||typeof this.pre=="function"&&!(yield this.pre(e))){e.stopPropagation(),e.preventDefault();return}this.setDisabled(!0),this._http.request(this.httpMethod,this.httpUrl,{params:this.httpData||{},responseType:"blob",observe:"response",body:this.httpBody}).pipe(Qo(()=>this.setDisabled(!1))).subscribe({next:t=>{if(t.status!==200||t.body.size<=0){this.error.emit(t);return}let n=this.getDisposition(t.headers.get("content-disposition")),p=this.fileName;typeof p=="function"&&(p=p(t)),p=p||n["filename*"]||n.filename||t.headers.get("filename")||t.headers.get("x-filename"),(0,fr.saveAs)(t.body,decodeURI(p)),this.success.emit(t)},error:t=>this.error.emit(t)})})}static \u0275fac=function(t){return new(t||o)};static \u0275dir=Ji({type:o,selectors:[["","down-file",""]],hostBindings:function(t,n){t&1&&N("click",function(f){return n._click(f)})},inputs:{httpData:[0,"http-data","httpData"],httpBody:[0,"http-body","httpBody"],httpMethod:[0,"http-method","httpMethod"],httpUrl:[0,"http-url","httpUrl"],fileName:[0,"file-name","fileName"],pre:"pre"},outputs:{success:"success",error:"error"},exportAs:["downFile"]})}return o})();function pa(o,i){if(o&1&&(r(0,"button",2),m(1),a()),o&2){let e=i.$implicit,t=h();c("http-url",Vi("assets/tmp/demo",e))("http-data",t.data),s(),be(" ",e," ")}}var bi=class bi{constructor(){this.fileTypes=[".xlsx",".docx",".pptx",".pdf"];this.data={otherdata:1,time:new Date}}};bi.\u0275fac=function(e){return new(e||bi)},bi.\u0275cmp=E({type:bi,selectors:[["app-down-file"]],decls:6,vars:0,consts:[[1,"alain-default__content-title"],["nzTitle","DEMO"],["nz-button","","down-file","","file-name","demo\u4E2D\u6587",1,"mr-sm",3,"http-data","http-url"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"h1"),m(2,"Download a file"),a()(),r(3,"nz-card",1),_e(4,pa,2,4,"button",2,$t),a()),e&2&&(s(4),Ne(t.fileTypes))},dependencies:[O,V,se,ie,pe,de,ue,A,Me,L,ye,q,oe,G,H,he,X,w,U,ce,I,J,k,le,ee,te,Q,ze,K,W,me,ge,ae,j,ne,fe,R,re,Se,$,Ce,Z,P,Y,zr],encapsulation:2});var Co=bi;var ca=o=>({params:o}),vi=class vi{constructor(){this.params={};this.url="/user";this.searchSchema={properties:{no:{type:"string",title:"\u7F16\u53F7"}}};this.columns=[{title:"\u7F16\u53F7",index:"no"},{title:"\u8C03\u7528\u6B21\u6570",type:"number",index:"callNo"},{title:"\u5934\u50CF",type:"img",width:"50px",index:"avatar"},{title:"\u65F6\u95F4",type:"date",index:"updatedAt"}]}};vi.\u0275fac=function(e){return new(e||vi)},vi.\u0275cmp=E({type:vi,selectors:[["app-delon-form"]],decls:5,vars:8,consts:[["st",""],[3,"title"],["mode","search",3,"formSubmit","formReset","schema","formData"],[3,"data","columns","req"]],template:function(e,t){if(e&1){let n=B();M(0,"page-header",1),r(1,"nz-card")(2,"sf",2),N("formSubmit",function(f){v(n);let g=Gt(4);return y(g.reset(f))})("formReset",function(){v(n);let f=Gt(4);return y(f.reset(t.params))}),a(),M(3,"st",3,0),a()}e&2&&(c("title","Page Name"),s(2),c("schema",t.searchSchema)("formData",t.params),s(),c("data",t.url)("columns",t.columns)("req",Ui(6,ca,t.params)))},dependencies:[O,V,se,Xn,ie,Ci,pe,de,ue,Kn,A,q,oe,G,H,he,X,w,U,ce,I,J,k,le,ee,te,Q,ze,K,W,me,ge,ae,j,ne,fe,R,re,Se,$,Ce,Z,P,Y],encapsulation:2});var Mo=vi;var yi=class yi{};yi.\u0275fac=function(e){return new(e||yi)},yi.\u0275cmp=E({type:yi,selectors:[["app-guard-admin"]],decls:2,vars:0,template:function(e,t){e&1&&(Ki(0,"p"),m(1,"\u8FD9\u662F\u4E00\u4E2Aadmin\u9875\u9762"),Qi())},encapsulation:2});var _o=yi;var Si=class Si{};Si.\u0275fac=function(e){return new(e||Si)},Si.\u0275cmp=E({type:Si,selectors:[["app-guard-auth"]],decls:2,vars:0,template:function(e,t){e&1&&(Ki(0,"p"),m(1,"\u8FD9\u662F\u4E00\u4E2Auser1\u9875\u9762"),Qi())},encapsulation:2});var No=Si;function fa(o,i){o&1&&(r(0,"nz-tag",6),M(1,"i",24),m(2," \u533F\u540D\u4F7F\u7528\u8005 "),a())}function za(o,i){o&1&&(r(0,"nz-tag",7),M(1,"i",25),m(2," \u8A2A\u5BA2 "),a())}function ga(o,i){o&1&&(r(0,"nz-tag",8),M(1,"i",26),m(2," \u5DF2\u767B\u5165\u4F7F\u7528\u8005 "),a())}function ha(o,i){if(o&1){let e=B();r(0,"button",27),N("click",function(){v(e);let n=h();return y(n.onUpgradeAccount())}),M(1,"i",28),m(2," \u5347\u7D1A\u5E33\u865F "),a()}}function Ca(o,i){if(o&1){let e=B();r(0,"button",27),N("click",function(){v(e);let n=h();return y(n.onGoToLogin())}),M(1,"i",29),m(2," \u7ACB\u5373\u767B\u5165 "),a(),r(3,"button",30),N("click",function(){v(e);let n=h();return y(n.onGoToRegister())}),M(4,"i",28),m(5," \u8A3B\u518A\u5E33\u865F "),a()}}var Ei=class Ei{constructor(){this.router=_(si);this.firebaseAuthService=_(Zt);this.firebaseRoleService=_(Yt);this.currentUser=this.firebaseAuthService.currentUser;this.isGuest=this.firebaseRoleService.isGuest;this.isAnonymous=Bt(()=>this.currentUser()?.isAnonymous||!1)}onUpgradeAccount(){this.router.navigate(["/passport/register"],{queryParams:{upgrade:"true"}})}onGoToLogin(){this.router.navigate(["/passport/login"])}onGoToRegister(){this.router.navigate(["/passport/register"])}};Ei.\u0275fac=function(e){return new(e||Ei)},Ei.\u0275cmp=E({type:Ei,selectors:[["app-guard-guest"]],decls:79,vars:2,consts:[[1,"guest-page"],["nzTitle","\u8A2A\u5BA2\u9801\u9762",1,"guest-card"],[1,"guest-content"],["nzType","info","nzMessage","\u6B61\u8FCE\u8A2A\u5BA2\u4F7F\u7528\u8005","nzDescription","\u60A8\u76EE\u524D\u4EE5\u8A2A\u5BA2\u8EAB\u4EFD\u5B58\u53D6\u6B64\u9801\u9762\uFF0C\u529F\u80FD\u6709\u9650\u3002","nzShowIcon","",1,"mb-md"],[1,"guest-description"],[1,"user-status","mb-lg"],["nzColor","orange",1,"status-tag"],["nzColor","default",1,"status-tag"],["nzColor","green",1,"status-tag"],[1,"available-features","mb-lg"],["nzSize","small"],["nz-icon","","nzType","read",1,"feature-icon"],["nz-icon","","nzType","search",1,"feature-icon"],["nz-icon","","nzType","download",1,"feature-icon"],[1,"restricted-features","mb-lg"],["nz-icon","","nzType","edit",1,"feature-icon","disabled"],["nz-list-item-actions",""],["nzColor","red"],["nz-icon","","nzType","message",1,"feature-icon","disabled"],["nz-icon","","nzType","cloud-upload",1,"feature-icon","disabled"],[1,"upgrade-prompt"],["nzType","warning","nzMessage","\u60F3\u8981\u4F7F\u7528\u5B8C\u6574\u529F\u80FD\u55CE\uFF1F","nzDescription","\u8A3B\u518A\u5E33\u865F\u5373\u53EF\u89E3\u9396\u6240\u6709\u529F\u80FD\uFF0C\u4EAB\u53D7\u5B8C\u6574\u7684\u4F7F\u7528\u9AD4\u9A57\u3002","nzShowIcon","",1,"mb-md"],[1,"upgrade-actions"],["nz-button","","nzType","primary"],["nz-icon","","nzType","user"],["nz-icon","","nzType","eye"],["nz-icon","","nzType","check-circle"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","user-add"],["nz-icon","","nzType","login"],["nz-button","",1,"ml-sm",3,"click"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"nz-card",1)(2,"div",2),M(3,"nz-alert",3),r(4,"p",4),m(5," \u9019\u662F\u4E00\u500B\u5C08\u70BA\u533F\u540D\u4F7F\u7528\u8005\u548C\u8A2A\u5BA2\u8A2D\u8A08\u7684\u9801\u9762\u3002\u60A8\u53EF\u4EE5\u700F\u89BD\u57FA\u672C\u5167\u5BB9\uFF0C\u4F46\u67D0\u4E9B\u529F\u80FD\u9700\u8981\u8A3B\u518A\u5E33\u865F\u624D\u80FD\u4F7F\u7528\u3002 "),a(),r(6,"div",5)(7,"h4"),m(8,"\u76EE\u524D\u72C0\u614B"),a(),x(9,fa,3,0,"nz-tag",6)(10,za,3,0,"nz-tag",7)(11,ga,3,0,"nz-tag",8),a(),r(12,"div",9)(13,"h4"),m(14,"\u53EF\u7528\u529F\u80FD"),a(),r(15,"nz-list",10)(16,"nz-list-item")(17,"nz-list-item-meta")(18,"nz-list-item-meta-title"),M(19,"i",11),m(20," \u700F\u89BD\u5167\u5BB9 "),a(),r(21,"nz-list-item-meta-description"),m(22," \u53EF\u4EE5\u67E5\u770B\u516C\u958B\u7684\u6587\u7AE0\u548C\u8CC7\u8A0A "),a()()(),r(23,"nz-list-item")(24,"nz-list-item-meta")(25,"nz-list-item-meta-title"),M(26,"i",12),m(27," \u641C\u5C0B\u529F\u80FD "),a(),r(28,"nz-list-item-meta-description"),m(29," \u53EF\u4EE5\u641C\u5C0B\u516C\u958B\u7684\u5167\u5BB9\u548C\u8CC7\u6E90 "),a()()(),r(30,"nz-list-item")(31,"nz-list-item-meta")(32,"nz-list-item-meta-title"),M(33,"i",13),m(34," \u4E0B\u8F09\u516C\u958B\u8CC7\u6E90 "),a(),r(35,"nz-list-item-meta-description"),m(36," \u53EF\u4EE5\u4E0B\u8F09\u6A19\u8A18\u70BA\u516C\u958B\u7684\u6A94\u6848\u548C\u8CC7\u6E90 "),a()()()()(),r(37,"div",14)(38,"h4"),m(39,"\u9700\u8981\u8A3B\u518A\u7684\u529F\u80FD"),a(),r(40,"nz-list",10)(41,"nz-list-item")(42,"nz-list-item-meta")(43,"nz-list-item-meta-title"),M(44,"i",15),m(45," \u5EFA\u7ACB\u548C\u7DE8\u8F2F\u5167\u5BB9 "),a(),r(46,"nz-list-item-meta-description"),m(47," \u9700\u8981\u8A3B\u518A\u5E33\u865F\u624D\u80FD\u5EFA\u7ACB\u6216\u7DE8\u8F2F\u5167\u5BB9 "),a()(),r(48,"ul",16)(49,"nz-list-item-action")(50,"nz-tag",17),m(51,"\u9700\u8981\u8A3B\u518A"),a()()()(),r(52,"nz-list-item")(53,"nz-list-item-meta")(54,"nz-list-item-meta-title"),M(55,"i",18),m(56," \u7559\u8A00\u548C\u8A55\u8AD6 "),a(),r(57,"nz-list-item-meta-description"),m(58," \u9700\u8981\u8A3B\u518A\u5E33\u865F\u624D\u80FD\u767C\u8868\u7559\u8A00\u6216\u8A55\u8AD6 "),a()(),r(59,"ul",16)(60,"nz-list-item-action")(61,"nz-tag",17),m(62,"\u9700\u8981\u8A3B\u518A"),a()()()(),r(63,"nz-list-item")(64,"nz-list-item-meta")(65,"nz-list-item-meta-title"),M(66,"i",19),m(67," \u4E0A\u50B3\u6A94\u6848 "),a(),r(68,"nz-list-item-meta-description"),m(69," \u9700\u8981\u8A3B\u518A\u5E33\u865F\u624D\u80FD\u4E0A\u50B3\u6A94\u6848\u6216\u8CC7\u6E90 "),a()(),r(70,"ul",16)(71,"nz-list-item-action")(72,"nz-tag",17),m(73,"\u9700\u8981\u8A3B\u518A"),a()()()()()(),r(74,"div",20),M(75,"nz-alert",21),r(76,"div",22),x(77,ha,3,0,"button",23)(78,Ca,6,0),a()()()()()),e&2&&(s(9),F(t.isAnonymous()?9:t.isGuest()?10:11),s(68),F(t.isAnonymous()?77:78))},dependencies:[O,V,se,ie,pe,de,ue,A,Me,L,ye,q,oe,G,H,he,X,w,St,U,ce,Ut,I,J,k,le,ee,te,Q,ze,K,W,Jt,me,ge,mr,ur,ar,nr,rr,lr,sr,ae,j,ne,fe,R,re,Se,$,Ce,Z,P,Y],styles:[".guest-page[_ngcontent-%COMP%]{padding:24px;max-width:800px;margin:0 auto}.guest-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 8px #0000001a}.guest-content[_ngcontent-%COMP%]{padding:16px}.guest-description[_ngcontent-%COMP%]{font-size:16px;line-height:1.6;color:#666;margin-bottom:24px}.user-status[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .available-features[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .restricted-features[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#262626;font-weight:600;margin-bottom:16px;border-bottom:2px solid #f0f0f0;padding-bottom:8px}.status-tag[_ngcontent-%COMP%]{font-size:14px;padding:4px 12px;border-radius:16px}.feature-icon[_ngcontent-%COMP%]{margin-right:8px;color:#1890ff}.feature-icon.disabled[_ngcontent-%COMP%]{color:#bfbfbf}.upgrade-prompt[_ngcontent-%COMP%]{background:#f6ffed;border:1px solid #b7eb8f;border-radius:6px;padding:16px;margin-top:24px}.upgrade-actions[_ngcontent-%COMP%]{margin-top:16px;text-align:center}.ant-list-item-meta-title[_ngcontent-%COMP%]{font-weight:500}.ant-list-item-meta-description[_ngcontent-%COMP%]{color:#8c8c8c}@media (max-width: 768px){.guest-page[_ngcontent-%COMP%]{padding:16px}.upgrade-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}}"]});var bo=Ei;var gr=()=>{let o=_(xn);return new Pi(i=>{o.confirm({nzTitle:"\u786E\u8BA4\u8981\u79BB\u5F00\u5417\uFF1F",nzContent:"\u4F60\u5DF2\u7ECF\u586B\u5199\u4E86\u90E8\u5206\u8868\u5355\u79BB\u5F00\u4F1A\u653E\u5F03\u5DF2\u7ECF\u586B\u5199\u7684\u5185\u5BB9\u3002",nzOkText:"\u79BB\u5F00",nzCancelText:"\u53D6\u6D88",nzOnOk:()=>{i.next(!0),i.complete()},nzOnCancel:()=>{i.next(!1),i.complete()}})})};var _a=()=>["/delon/guard/leave"],Na=()=>["/delon/guard/auth"],ba=()=>["/delon/guard/admin"],va=()=>["/delon/guard/guest"];function ya(o,i){if(o&1&&(M(0,"nz-alert",1),At(1,"json")),o&2){let e=h();c("nzDescription","\u76EE\u524D Firebase \u89D2\u8272: "+Rt(1,1,e.firebaseRoles()))}}function Sa(o,i){o&1&&M(0,"nz-alert",2)}function Ea(o,i){if(o&1&&M(0,"nz-alert",3),o&2){let e=h();c("nzMessage",e.firebaseError())}}function xa(o,i){if(o&1){let e=B();r(0,"div",19)(1,"h3"),m(2,"Firebase \u89D2\u8272\u8A2D\u5B9A"),a(),r(3,"nz-space-compact",8)(4,"button",20),N("click",function(){v(e);let n=h();return y(n.setFirebaseRole("admin"))}),M(5,"i",10),r(6,"span"),m(7,"\u8A2D\u7F6E Firebase \u7BA1\u7406\u54E1"),a()(),r(8,"button",21),N("click",function(){v(e);let n=h();return y(n.setFirebaseRole("moderator"))}),M(9,"i",15),r(10,"span"),m(11,"\u8A2D\u7F6E Firebase \u7248\u4E3B"),a()(),r(12,"button",22),N("click",function(){v(e);let n=h();return y(n.setFirebaseRole("user"))}),M(13,"i",11),r(14,"span"),m(15,"\u8A2D\u7F6E Firebase \u4F7F\u7528\u8005"),a()(),r(16,"button",22),N("click",function(){v(e);let n=h();return y(n.setFirebaseRole("guest"))}),M(17,"i",12),r(18,"span"),m(19,"\u8A2D\u7F6E Firebase \u8A2A\u5BA2"),a()()()(),r(20,"div",23)(21,"h3"),m(22,"\u540C\u6B65\u89D2\u8272\u8A2D\u5B9A (ACL + Firebase)"),a(),r(23,"nz-space-compact",8)(24,"button",24),N("click",function(){v(e);let n=h();return y(n.setRoleWithFirebase(!0))}),M(25,"i",25),r(26,"span"),m(27,"\u540C\u6B65\u7BA1\u7406\u54E1"),a()(),r(28,"button",26),N("click",function(){v(e);let n=h();return y(n.setRoleWithFirebase("user"))}),M(29,"i",25),r(30,"span"),m(31,"\u540C\u6B65\u4F7F\u7528\u8005"),a()(),r(32,"button",26),N("click",function(){v(e);let n=h();return y(n.setRoleWithFirebase("guest"))}),M(33,"i",25),r(34,"span"),m(35,"\u540C\u6B65\u8A2A\u5BA2"),a()()()()}if(o&2){let e=h();s(4),c("nzLoading",e.isFirebaseLoading())("disabled",!e.canManageFirebaseRoles()),s(4),c("nzLoading",e.isFirebaseLoading())("disabled",!e.canManageFirebaseRoles()),s(4),c("nzLoading",e.isFirebaseLoading()),s(4),c("nzLoading",e.isFirebaseLoading()),s(8),c("nzLoading",e.isFirebaseLoading())("disabled",!e.canManageFirebaseRoles()),s(4),c("nzLoading",e.isFirebaseLoading()),s(4),c("nzLoading",e.isFirebaseLoading())}}function Fa(o,i){if(o&1&&(r(0,"nz-tag",30),m(1),a()),o&2){let e=i.$implicit,t=h(3);c("nzColor",t.getFirebaseRoleColor(e)),s(),be(" ",e," ")}}function Da(o,i){if(o&1&&_e(0,Fa,2,2,"nz-tag",30,Lt),o&2){let e=h(2);Ne(e.firebaseRoles())}}function Ta(o,i){o&1&&(r(0,"span",28),m(1,"\u7121\u89D2\u8272"),a())}function wa(o,i){if(o&1&&(r(0,"nz-descriptions-item",27),x(1,Da,2,0)(2,Ta,2,0,"span",28),a(),r(3,"nz-descriptions-item",29),m(4),a()),o&2){let e,t=h();s(),F(t.firebaseRoles().length>0?1:2),s(3),be(" ",((e=t.firebaseUser())==null?null:e.email)||((e=t.firebaseUser())==null?null:e.uid)," ")}}var xi=class xi{constructor(){this.aclSrv=_(ao);this.menuSrv=_(so);this.router=_(si);this.message=_(Re);this.firebaseAuthService=_(Zt);this.firebaseRoleService=_(Yt);this.firebaseUser=this.firebaseAuthService.currentUser;this.firebaseRoles=this.firebaseRoleService.userRoles;this.availableRoles=this.firebaseRoleService.availableRoles;this.isFirebaseLoading=Be(!1);this.firebaseError=Be("");this.hasFirebaseUser=Bt(()=>this.firebaseUser()!==null);this.isFirebaseAdmin=this.firebaseRoleService.isAdmin}get data(){return this.aclSrv.data}setRole(i){this.aclSrv.setFull(!1),typeof i=="boolean"?this.aclSrv.setFull(i):this.aclSrv.set({role:[i]}),this.menuSrv.resume(),this.router.navigate(["/delon/guard"])}setFirebaseRole(i){return we(this,null,function*(){try{if(!this.hasFirebaseUser()){this.message.warning("\u8ACB\u5148\u767B\u5165 Firebase \u5E33\u865F");return}let e=this.firebaseUser();if(!e)return;this.isFirebaseLoading.set(!0),this.firebaseError.set(""),(yield this.firebaseRoleService.setCustomClaims(e.uid,{roles:[i],permissions:this.getRolePermissions(i)}))?(yield this.firebaseRoleService.syncWithACL(),this.menuSrv.resume(),this.message.success(`\u5DF2\u8A2D\u5B9A Firebase \u89D2\u8272: ${this.getRoleName(i)}`)):this.message.error("\u8A2D\u5B9A Firebase \u89D2\u8272\u5931\u6557")}catch(e){console.error("Error setting Firebase role:",e),this.firebaseError.set("\u8A2D\u5B9A Firebase \u89D2\u8272\u5931\u6557"),this.message.error("\u8A2D\u5B9A Firebase \u89D2\u8272\u5931\u6557")}finally{this.isFirebaseLoading.set(!1)}})}setRoleWithFirebase(i){return we(this,null,function*(){this.setRole(i),typeof i=="string"&&this.hasFirebaseUser()&&(yield this.setFirebaseRole(i))})}getRolePermissions(i){return this.availableRoles().find(t=>t.id===i)?.permissions||[]}getRoleName(i){return this.availableRoles().find(t=>t.id===i)?.name||i}canManageFirebaseRoles(){return this.isFirebaseAdmin()||this.firebaseRoleService.hasPermission("role:assign")}getFirebaseRoleColor(i){return{[It.ADMIN]:"red",[It.MODERATOR]:"orange",[It.USER]:"blue",[It.GUEST]:"default"}[i]||"purple"}};xi.\u0275fac=function(e){return new(e||xi)},xi.\u0275cmp=E({type:xi,selectors:[["app-guard"]],decls:59,vars:15,consts:[[1,"alain-default__content-title"],["nzType","info","nzMessage","Firebase \u4F7F\u7528\u8005\u5DF2\u767B\u5165","nzShowIcon","",1,"mb-md",3,"nzDescription"],["nzType","warning","nzMessage","\u672A\u767B\u5165 Firebase","nzDescription","\u90E8\u5206 Firebase \u89D2\u8272\u529F\u80FD\u9700\u8981\u767B\u5165\u5F8C\u624D\u80FD\u4F7F\u7528","nzShowIcon","",1,"mb-md"],["nzType","error","nzShowIcon","","nzCloseable","",1,"mb-md",3,"nzMessage"],[1,"guard-actions","mb-md"],["nz-button","",3,"routerLink"],["nz-icon","","nzType","logout"],[1,"role-section","mb-lg"],[1,"mb-sm"],["nz-button","",3,"click"],["nz-icon","","nzType","crown"],["nz-icon","","nzType","user"],["nz-icon","","nzType","eye"],[1,"test-pages","mb-lg"],["nz-icon","","nzType","lock"],["nz-icon","","nzType","safety-certificate"],[1,"status-info"],["nzBordered","","nzSize","small","nzTitle","\u7576\u524D\u72C0\u614B\u8CC7\u8A0A"],["nzTitle","ACL \u8CC7\u8A0A"],[1,"firebase-role-section","mb-lg"],["nz-button","","nzType","primary","nzDanger","",3,"click","nzLoading","disabled"],["nz-button","","nzType","primary",3,"click","nzLoading","disabled"],["nz-button","",3,"click","nzLoading"],[1,"sync-role-section","mb-lg"],["nz-button","","nzType","dashed",3,"click","nzLoading","disabled"],["nz-icon","","nzType","sync"],["nz-button","","nzType","dashed",3,"click","nzLoading"],["nzTitle","Firebase \u89D2\u8272"],[1,"text-muted"],["nzTitle","Firebase \u4F7F\u7528\u8005"],[1,"mr-sm",3,"nzColor"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"h1"),m(2," \u8DEF\u7531\u5B88\u536B "),r(3,"small"),m(4,"\u6E2C\u8A66\u8DEF\u7531\u5B88\u885B\u548C\u6B0A\u9650\u63A7\u5236\u529F\u80FD\uFF0C\u73FE\u5DF2\u6574\u5408 Firebase \u89D2\u8272\u7BA1\u7406"),a()()(),x(5,ya,2,3,"nz-alert",1)(6,Sa,1,0,"nz-alert",2),x(7,Ea,1,1,"nz-alert",3),r(8,"div",4)(9,"nz-space-compact")(10,"button",5),M(11,"i",6),r(12,"span"),m(13,"\u96E2\u958B\u78BA\u8A8D\u9801"),a()()()(),r(14,"div",7)(15,"h3"),m(16,"ACL \u89D2\u8272\u8A2D\u5B9A"),a(),r(17,"nz-space-compact",8)(18,"button",9),N("click",function(){return t.setRole(!0)}),M(19,"i",10),r(20,"span"),m(21,"\u8A2D\u7F6E\u7BA1\u7406\u54E1"),a()(),r(22,"button",9),N("click",function(){return t.setRole("user1")}),M(23,"i",11),r(24,"span"),m(25,"\u8A2D\u7F6E\u54E1\u5DE51"),a()(),r(26,"button",9),N("click",function(){return t.setRole("user2")}),M(27,"i",11),r(28,"span"),m(29,"\u8A2D\u7F6E\u54E1\u5DE52"),a()(),r(30,"button",9),N("click",function(){return t.setRole("guest")}),M(31,"i",12),r(32,"span"),m(33,"\u8A2D\u7F6E\u8A2A\u5BA2"),a()()()(),x(34,xa,36,10),r(35,"div",13)(36,"h3"),m(37,"\u6E2C\u8A66\u9801\u9762"),a(),r(38,"nz-space-compact")(39,"button",5),M(40,"i",14),r(41,"span"),m(42,"\u9700\u8981 user1"),a()(),r(43,"button",5),M(44,"i",15),r(45,"span"),m(46,"\u9700\u8981\u7BA1\u7406\u54E1"),a()(),r(47,"button",5),M(48,"i",12),r(49,"span"),m(50,"\u9700\u8981\u8A2A\u5BA2"),a()()()(),r(51,"div",16)(52,"nz-descriptions",17)(53,"nz-descriptions-item",18)(54,"pre"),m(55),At(56,"json"),a()(),x(57,wa,5,2),a()(),M(58,"router-outlet")),e&2&&(s(5),F(t.hasFirebaseUser()?5:6),s(2),F(t.firebaseError()?7:-1),s(3),c("routerLink",Ee(11,_a)),s(24),F(t.hasFirebaseUser()?34:-1),s(5),c("routerLink",Ee(12,Na)),s(4),c("routerLink",Ee(13,ba)),s(4),c("routerLink",Ee(14,va)),s(8),Pe(Rt(56,9,t.data)),s(2),F(t.hasFirebaseUser()?57:-1))},dependencies:[O,V,no,_n,se,ie,pe,de,ue,A,Me,L,ye,q,oe,G,H,he,X,w,St,U,ce,Ut,I,J,k,le,ee,te,Q,ze,or,ir,K,W,Jt,me,ge,ae,j,ne,fe,R,re,$,Ce,Z,P,yn,Y,qt],encapsulation:2});var vo=xi;var Aa=()=>["/delon/guard"],Fi=class Fi{};Fi.\u0275fac=function(e){return new(e||Fi)},Fi.\u0275cmp=E({type:Fi,selectors:[["app-guard-leave"]],decls:5,vars:3,consts:[["nz-button","",3,"nzType","routerLink"]],template:function(e,t){e&1&&(r(0,"p"),m(1,"\u79BB\u5F00\u65F6\u9700\u8981\u786E\u8BA4"),a(),r(2,"button",0)(3,"span"),m(4,"\u6211\u8981\u79BB\u5F00"),a()()),e&2&&(s(2),c("nzType","primary")("routerLink",Ee(2,Aa)))},dependencies:[O,V,no,se,ie,pe,de,ue,A,Me,L,ye,q,oe,G,H,he,X,w,U,ce,I,J,k,le,ee,te,Q,ze,K,W,me,ge,ae,j,ne,fe,R,re,$,Ce,Z,P,Y],encapsulation:2});var yo=Fi;var hr=(()=>{class o{scriptSrv=_(ro);cogSrv=_(li);defaultConfig;_cog;pending=!1;_lodop=null;_init=new wo;_events=new wo;printBuffer=[];constructor(){this.defaultConfig=this.cogSrv.merge("lodop",{url:"http://localhost:8443/CLodopfuncs.js",name:"CLODOP",companyName:"",checkMaxCount:100}),this.cog=this.defaultConfig}get cog(){return this._cog}set cog(e){this._cog=Ae(Ae({},this.defaultConfig),e)}get events(){return this._events.asObservable()}get lodop(){return this._lodop?Li({ok:!0,lodop:this._lodop}):this.pending?this._init.asObservable():(this.request(),this._init.asObservable())}get printer(){this.check();let e=[],t=this._lodop.GET_PRINTER_COUNT();for(let n=0;n<t;n++)e.push(this._lodop.GET_PRINTER_NAME(n));return e}check(){if(!this._lodop)throw new Error("\u8BF7\u52A1\u5FC5\u5148\u8C03\u7528 lodop \u83B7\u53D6\u5BF9\u8C61")}request(){this.pending=!0;let e=new URL(this.cog.url);e.searchParams.set("name",this.cog.name);let t=e.toString(),n=this.cog.checkMaxCount,p=(g,l)=>{this._init.next({ok:g==="ok",status:g,error:l,lodop:this._lodop})},f=()=>{if(--n,this._lodop.webskt&&this._lodop.webskt.readyState===1)p("ok");else{if(n<0){p("check-limit");return}setTimeout(()=>f(),100)}};this.scriptSrv.loadScript(t).then(g=>{if(g.status!=="ok"){this.pending=!1,p("script-load-error",g[0]);return}let l=window;if(Object.prototype.hasOwnProperty.call(l,this.cog.name)&&(this._lodop=l[this.cog.name]),this._lodop===null){p("load-variable-name-error",{name:this.cog.name});return}this._lodop.SET_LICENSES(this.cog.companyName,this.cog.license,this.cog.licenseA,this.cog.licenseB),f()})}reset(){this._lodop=null,this.pending=!1,this.request()}attachCode(e,t,n){this.check(),n||(n=/LODOP\.([^(]+)\(([^\n]+)?\);/i),e.split(`
`).forEach(p=>{let f=n.exec(p.trim());if(!f)return;let g=this._lodop[f[1]];if(g){let l=null;try{l=new Function(`return [${f[2]}]`)()}catch{}if(l!=null&&Array.isArray(l)&&t)for(let u=0;u<l.length;u++)typeof l[u]=="string"&&(l[u]=l[u].replace(/{{(.*?)}}/g,(d,z)=>t[z.trim()]||""));g.apply(this._lodop,l)}})}design(){this.check();let e=this._lodop.PRINT_DESIGN();return new Promise(t=>{this._lodop.On_Return=(n,p)=>{e===n&&(this._lodop.On_Return=null,t(`${p}`))}})}printDo(){let e=this.printBuffer.shift();if(!e)return;this.attachCode(e.code,e.item,e.parser);let t=this._lodop.PRINT();this._lodop.On_Return=(n,p)=>{t===n&&(this._lodop.On_Return=null,this._events.next(Ae({ok:p===!0,error:p===!0?null:p},e)),this.printDo())}}print(e,t,n){this.check(),t&&this.printBuffer.push(...(Array.isArray(t)?t:[t]).map(p=>({code:e,parser:n,item:p}))),this.printDo()}ngOnDestroy(){this._init.unsubscribe(),this._events.unsubscribe()}static \u0275fac=function(t){return new(t||o)};static \u0275prov=Wt({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function Ra(o,i){o&1&&(m(0," \u8BF7\u5148\u4E0B\u8F7D "),r(1,"a",5),m(2,"Lodop\u63D2\u4EF6"),a(),m(3,"\u3002 "))}function Ba(o,i){if(o&1&&(r(0,"nz-alert",3),Ht(1,Ra,4,0,"ng-template",null,0,cn),a()),o&2){let e=Gt(2);c("nzType","warning")("nzMessage",e)}}function Pa(o,i){if(o&1&&M(0,"nz-option",12),o&2){let e=i.$implicit;c("nzLabel",e)("nzValue",e)}}function La(o,i){if(o&1&&M(0,"nz-option",12),o&2){let e=i.$implicit;c("nzLabel",e)("nzValue",e)}}function Ia(o,i){if(o&1){let e=B();r(0,"form",4)(1,"nz-form-item",6)(2,"nz-form-label",7),m(3,"\u6253\u5370\u670D\u52A1\u5668"),a(),r(4,"nz-form-control",7)(5,"nz-input-group")(6,"div",8)(7,"input",9),Te("ngModelChange",function(n){v(e);let p=h();return De(p.cog.url,n)||(p.cog.url=n),y(n)}),a()(),r(8,"div",8)(9,"button",10),N("click",function(){v(e);let n=h();return y(n.reload(null))}),m(10,"\u91CD\u65B0\u52A0\u8F7D\u6253\u5370\u673A"),a()()()()(),r(11,"nz-form-item",6)(12,"nz-form-label",7),m(13,"\u6253\u5370\u673A"),a(),r(14,"nz-form-control",7)(15,"nz-select",11),Te("ngModelChange",function(n){v(e);let p=h();return De(p.cog.printer,n)||(p.cog.printer=n),y(n)}),N("ngModelChange",function(n){v(e);let p=h();return y(p.changePinter(n))}),_e(16,Pa,1,2,"nz-option",12,$t),a()()(),r(18,"nz-form-item",6)(19,"nz-form-label",7),m(20,"\u7EB8\u5F20\u7C7B\u578B"),a(),r(21,"nz-form-control",7)(22,"nz-select",13),Te("ngModelChange",function(n){v(e);let p=h();return De(p.cog.paper,n)||(p.cog.paper=n),y(n)}),_e(23,La,1,2,"nz-option",12,$t),a()()(),r(25,"nz-form-item",6)(26,"nz-form-label",7),m(27,"\u6253\u5370\u5185\u5BB9"),a(),r(28,"nz-form-control",7)(29,"textarea",14),Te("ngModelChange",function(n){v(e);let p=h();return De(p.cog.html,n)||(p.cog.html=n),y(n)}),a(),r(30,"div",15),m(31,"\u4EC5\u9650HTML\uFF0C\u66F4\u591A\u7C7B\u578B\u652F\u6301\u8BF7\u53C2\u8003\u5B98\u7F51"),a()()(),r(32,"nz-form-item",6)(33,"nz-form-control",16)(34,"button",17),N("click",function(){v(e);let n=h();return y(n.print(!0))}),m(35,"\u6253\u5370\u9884\u89C8"),a(),r(36,"button",17),N("click",function(){v(e);let n=h();return y(n.print())}),m(37,"\u76F4\u63A5\u6253\u5370"),a()()()()}if(o&2){let e=h();s(2),c("nzSm",6),s(2),c("nzSm",18),s(2),c("nzSpan",16),s(),Fe("ngModel",e.cog.url),s(),c("nzSpan",8),s(4),c("nzSm",6),s(2),c("nzSm",18),s(),Fe("ngModel",e.cog.printer),s(),Ne(e.pinters),s(3),c("nzSm",6),s(2),c("nzSm",18),s(),Fe("ngModel",e.cog.paper),s(),Ne(e.papers),s(3),c("nzSm",6),s(2),c("nzSm",18),s(),Fe("ngModel",e.cog.html),s(4),c("nzSm",18)("nzOffset",6),s(),c("nzLoading",e.printing),s(2),c("nzLoading",e.printing)}}var Di=class Di{constructor(){this.lodopSrv=_(hr);this.msg=_(Re);this.cog={url:"https://localhost:8443/CLodopfuncs.js",printer:"",paper:"",html:`
      <h1>Title</h1>
      <p>\u8FD9~\uFF01@#\uFFE5%\u2026\u2026&*\uFF08\uFF09\u2014\u2014sdilfjnvn</p>
      <p>\u8FD9~\uFF01@#\uFFE5%\u2026\u2026&*\uFF08\uFF09\u2014\u2014sdilfjnvn</p>
      <p>\u8FD9~\uFF01@#\uFFE5%\u2026\u2026&*\uFF08\uFF09\u2014\u2014sdilfjnvn</p>
      <p>\u8FD9~\uFF01@#\uFFE5%\u2026\u2026&*\uFF08\uFF09\u2014\u2014sdilfjnvn</p>
      <p>\u8FD9~\uFF01@#\uFFE5%\u2026\u2026&*\uFF08\uFF09\u2014\u2014sdilfjnvn</p>
    `};this.error=!1;this.lodop=null;this.pinters=[];this.papers=[];this.printing=!1;this.lodopSrv.lodop.subscribe(({lodop:i,ok:e})=>{if(!e){this.error=!0;return}this.error=!1,this.msg.success("\u6253\u5370\u673A\u52A0\u8F7D\u6210\u529F"),this.lodop=i,this.pinters=this.lodopSrv.printer})}reload(i={url:"https://localhost:8443/CLodopfuncs.js"}){this.pinters=[],this.papers=[],this.cog.printer="",this.cog.paper="",this.lodopSrv.cog=Ae(Ae({},this.cog),i),this.error=!1,i===null&&this.lodopSrv.reset()}changePinter(i){this.lodop!=null&&(this.papers=this.lodop.GET_PAGESIZES_LIST(i,`
`).split(`
`))}print(i=!1){let e=this.lodop;e.PRINT_INITA(10,20,810,610,"\u6D4B\u8BD5C-Lodop\u8FDC\u7A0B\u6253\u5370\u56DB\u6B65\u9AA4"),e.SET_PRINTER_INDEXA(this.cog.printer),e.SET_PRINT_PAGESIZE(0,0,0,this.cog.paper),e.ADD_PRINT_TEXT(1,1,300,200,"\u4E0B\u9762\u8F93\u51FA\u7684\u662F\u672C\u9875\u6E90\u4EE3\u7801\u53CA\u5176\u5C55\u73B0\u6548\u679C\uFF1A"),e.ADD_PRINT_TEXT(20,10,"90%","95%",this.cog.html),e.SET_PRINT_STYLEA(0,"ItemType",4),e.NEWPAGEA(),e.ADD_PRINT_HTM(20,10,"90%","95%",this.cog.html),i?e.PREVIEW():e.PRINT()}};Di.\u0275fac=function(e){return new(e||Di)},Di.\u0275cmp=E({type:Di,selectors:[["app-print"]],decls:10,vars:2,consts:[["message",""],[1,"alain-default__content-title"],["href","https://ng-alain.com/components/lodop","target","_blank"],[3,"nzType","nzMessage"],["nz-form",""],["href","http://c-lodop.com/download.html","target","_blank"],["nz-row",""],["nz-col","",3,"nzSm"],["nz-col","",3,"nzSpan"],["nz-input","","nzPlaceHolder","https://localhost:8443/CLodopfuncs.js","name","url",3,"ngModelChange","ngModel"],["nz-button","",3,"click"],["nzPlaceHolder","\u8BF7\u9009\u62E9\u6253\u5370\u673A","nzShowSearch","","nzAllowClear","","name","printer",2,"width","90%",3,"ngModelChange","ngModel"],[3,"nzLabel","nzValue"],["nzPlaceHolder","\u8BF7\u9009\u62E9\u7EB8\u5F20\u7C7B\u578B","nzShowSearch","","nzAllowClear","","name","paper",2,"width","90%",3,"ngModelChange","ngModel"],["nz-input","","name","html","nzAutosize","",3,"ngModelChange","ngModel"],["nz-form-extra",""],["nz-col","",3,"nzSm","nzOffset"],["nz-button","",3,"click","nzLoading"]],template:function(e,t){e&1&&(r(0,"div",1)(1,"h1"),m(2," Lodop\u6253\u5370 "),r(3,"small"),m(4," \u66F4\u591A\u4F53\u9A8C\u8BF7\u81F3 "),r(5,"a",2),m(6,"NG-ALAIN.com"),a()()()(),r(7,"nz-card"),x(8,Ba,3,2,"nz-alert",3),x(9,Ia,38,18,"form",4),a()),e&2&&(s(8),F(t.error?8:-1),s(),F(t.error?-1:9))},dependencies:[O,Ot,Et,Ie,kt,xt,Xt,V,se,ie,pe,de,ue,A,Me,L,ye,q,oe,Tt,Dt,G,H,he,X,ui,di,w,U,ce,Ut,I,J,k,le,ee,Ft,fo,co,te,Q,ze,K,W,me,ge,ae,j,ne,Vt,Kt,ei,Qt,fe,R,re,Se,$,Ce,Z,P,Y],encapsulation:2});var So=Di;var ka=["canvas"];function Oa(o,i){if(o&1&&(eo(0),m(1),to()),o&2){let e=h(2);s(),Pe(e.nzStatusRender)}}function Va(o,i){if(o&1&&(r(0,"div",1),Ht(1,Oa,2,1,"ng-container",2),a()),o&2){let e=h();s(),c("nzStringTemplateOutlet",e.nzStatusRender)}}function Ua(o,i){o&1&&M(0,"nz-spin")}function Ga(o,i){if(o&1){let e=B();r(0,"div")(1,"p",3),m(2),a(),r(3,"button",4),N("click",function(){v(e);let n=h(2);return y(n.reloadQRCode())}),M(4,"nz-icon",5),r(5,"span"),m(6),a()()()}if(o&2){let e=h(2);s(2),Pe(e.locale.expired),s(4),Pe(e.locale.refresh)}}function ja(o,i){if(o&1&&(r(0,"div")(1,"p",3),m(2),a()()),o&2){let e=h(2);s(2),Pe(e.locale.scanned)}}function Wa(o,i){if(o&1&&(r(0,"div",1),x(1,Ua,1,0,"nz-spin")(2,Ga,7,2,"div")(3,ja,3,1,"div"),a()),o&2){let e,t=h();s(),F((e=t.nzStatus)==="loading"?1:e==="expired"?2:e==="scanned"?3:-1)}}function Ha(o,i){o&1&&M(0,"canvas",null,0)}var ii;(function(o){let i=(()=>{class f{version;errorCorrectionLevel;static encodeText(l,u){let d=o.QrSegment.makeSegments(l);return f.encodeSegments(d,u)}static encodeBinary(l,u){let d=o.QrSegment.makeBytes(l);return f.encodeSegments([d],u)}static encodeSegments(l,u,d=1,z=40,C=-1,S=!0){if(!(f.MIN_VERSION<=d&&d<=z&&z<=f.MAX_VERSION)||C<-1||C>7)throw new RangeError("Invalid value");let b,T;for(b=d;;b++){let ve=f.getNumDataCodewords(b,u)*8,Ue=p.getTotalBits(l,b);if(Ue<=ve){T=Ue;break}if(b>=z)throw new RangeError("Data too long")}for(let ve of[f.Ecc.MEDIUM,f.Ecc.QUARTILE,f.Ecc.HIGH])S&&T<=f.getNumDataCodewords(b,ve)*8&&(u=ve);let D=[];for(let ve of l){e(ve.mode.modeBits,4,D),e(ve.numChars,ve.mode.numCharCountBits(b),D);for(let Ue of ve.getData())D.push(Ue)}n(D.length==T);let wt=f.getNumDataCodewords(b,u)*8;n(D.length<=wt),e(0,Math.min(4,wt-D.length),D),e(0,(8-D.length%8)%8,D),n(D.length%8==0);for(let ve=236;D.length<wt;ve^=253)e(ve,8,D);let jt=[];for(;jt.length*8<D.length;)jt.push(0);return D.forEach((ve,Ue)=>jt[Ue>>>3]|=ve<<7-(Ue&7)),new f(b,u,jt,C)}size;mask;modules=[];isFunction=[];constructor(l,u,d,z){if(this.version=l,this.errorCorrectionLevel=u,l<f.MIN_VERSION||l>f.MAX_VERSION)throw new RangeError("Version value out of range");if(z<-1||z>7)throw new RangeError("Mask value out of range");this.size=l*4+17;let C=[];for(let b=0;b<this.size;b++)C.push(!1);for(let b=0;b<this.size;b++)this.modules.push(C.slice()),this.isFunction.push(C.slice());this.drawFunctionPatterns();let S=this.addEccAndInterleave(d);if(this.drawCodewords(S),z==-1){let b=1e9;for(let T=0;T<8;T++){this.applyMask(T),this.drawFormatBits(T);let D=this.getPenaltyScore();D<b&&(z=T,b=D),this.applyMask(T)}}n(z>=0&&z<=7),this.mask=z,this.applyMask(z),this.drawFormatBits(z),this.isFunction=[]}getModule(l,u){return l>=0&&l<this.size&&u>=0&&u<this.size&&this.modules[u][l]}getModules(){return this.modules}drawFunctionPatterns(){for(let d=0;d<this.size;d++)this.setFunctionModule(6,d,d%2==0),this.setFunctionModule(d,6,d%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);let l=this.getAlignmentPatternPositions(),u=l.length;for(let d=0;d<u;d++)for(let z=0;z<u;z++)d==0&&z==0||d==0&&z==u-1||d==u-1&&z==0||this.drawAlignmentPattern(l[d],l[z]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(l){let u=this.errorCorrectionLevel.formatBits<<3|l,d=u;for(let C=0;C<10;C++)d=d<<1^(d>>>9)*1335;let z=(u<<10|d)^21522;n(z>>>15==0);for(let C=0;C<=5;C++)this.setFunctionModule(8,C,t(z,C));this.setFunctionModule(8,7,t(z,6)),this.setFunctionModule(8,8,t(z,7)),this.setFunctionModule(7,8,t(z,8));for(let C=9;C<15;C++)this.setFunctionModule(14-C,8,t(z,C));for(let C=0;C<8;C++)this.setFunctionModule(this.size-1-C,8,t(z,C));for(let C=8;C<15;C++)this.setFunctionModule(8,this.size-15+C,t(z,C));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let l=this.version;for(let d=0;d<12;d++)l=l<<1^(l>>>11)*7973;let u=this.version<<12|l;n(u>>>18==0);for(let d=0;d<18;d++){let z=t(u,d),C=this.size-11+d%3,S=Math.floor(d/3);this.setFunctionModule(C,S,z),this.setFunctionModule(S,C,z)}}drawFinderPattern(l,u){for(let d=-4;d<=4;d++)for(let z=-4;z<=4;z++){let C=Math.max(Math.abs(z),Math.abs(d)),S=l+z,b=u+d;S>=0&&S<this.size&&b>=0&&b<this.size&&this.setFunctionModule(S,b,C!=2&&C!=4)}}drawAlignmentPattern(l,u){for(let d=-2;d<=2;d++)for(let z=-2;z<=2;z++)this.setFunctionModule(l+z,u+d,Math.max(Math.abs(z),Math.abs(d))!=1)}setFunctionModule(l,u,d){this.modules[u][l]=d,this.isFunction[u][l]=!0}addEccAndInterleave(l){let u=this.version,d=this.errorCorrectionLevel;if(l.length!=f.getNumDataCodewords(u,d))throw new RangeError("Invalid argument");let z=f.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][u],C=f.ECC_CODEWORDS_PER_BLOCK[d.ordinal][u],S=Math.floor(f.getNumRawDataModules(u)/8),b=z-S%z,T=Math.floor(S/z),D=[],wt=f.reedSolomonComputeDivisor(C);for(let ve=0,Ue=0;ve<z;ve++){let oi=l.slice(Ue,Ue+T-C+(ve<b?0:1));Ue+=oi.length;let yr=f.reedSolomonComputeRemainder(oi,wt);ve<b&&oi.push(0),D.push(oi.concat(yr))}let jt=[];for(let ve=0;ve<D[0].length;ve++)D.forEach((Ue,oi)=>{(ve!=T-C||oi>=b)&&jt.push(Ue[ve])});return n(jt.length==S),jt}drawCodewords(l){if(l.length!=Math.floor(f.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let u=0;for(let d=this.size-1;d>=1;d-=2){d==6&&(d=5);for(let z=0;z<this.size;z++)for(let C=0;C<2;C++){let S=d-C,T=(d+1&2)==0?this.size-1-z:z;!this.isFunction[T][S]&&u<l.length*8&&(this.modules[T][S]=t(l[u>>>3],7-(u&7)),u++)}}n(u==l.length*8)}applyMask(l){if(l<0||l>7)throw new RangeError("Mask value out of range");for(let u=0;u<this.size;u++)for(let d=0;d<this.size;d++){let z;switch(l){case 0:z=(d+u)%2==0;break;case 1:z=u%2==0;break;case 2:z=d%3==0;break;case 3:z=(d+u)%3==0;break;case 4:z=(Math.floor(d/3)+Math.floor(u/2))%2==0;break;case 5:z=d*u%2+d*u%3==0;break;case 6:z=(d*u%2+d*u%3)%2==0;break;case 7:z=((d+u)%2+d*u%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[u][d]&&z&&(this.modules[u][d]=!this.modules[u][d])}}getPenaltyScore(){let l=0;for(let C=0;C<this.size;C++){let S=!1,b=0,T=[0,0,0,0,0,0,0];for(let D=0;D<this.size;D++)this.modules[C][D]==S?(b++,b==5?l+=f.PENALTY_N1:b>5&&l++):(this.finderPenaltyAddHistory(b,T),S||(l+=this.finderPenaltyCountPatterns(T)*f.PENALTY_N3),S=this.modules[C][D],b=1);l+=this.finderPenaltyTerminateAndCount(S,b,T)*f.PENALTY_N3}for(let C=0;C<this.size;C++){let S=!1,b=0,T=[0,0,0,0,0,0,0];for(let D=0;D<this.size;D++)this.modules[D][C]==S?(b++,b==5?l+=f.PENALTY_N1:b>5&&l++):(this.finderPenaltyAddHistory(b,T),S||(l+=this.finderPenaltyCountPatterns(T)*f.PENALTY_N3),S=this.modules[D][C],b=1);l+=this.finderPenaltyTerminateAndCount(S,b,T)*f.PENALTY_N3}for(let C=0;C<this.size-1;C++)for(let S=0;S<this.size-1;S++){let b=this.modules[C][S];b==this.modules[C][S+1]&&b==this.modules[C+1][S]&&b==this.modules[C+1][S+1]&&(l+=f.PENALTY_N2)}let u=0;for(let C of this.modules)u=C.reduce((S,b)=>S+(b?1:0),u);let d=this.size*this.size,z=Math.ceil(Math.abs(u*20-d*10)/d)-1;return n(z>=0&&z<=9),l+=z*f.PENALTY_N4,n(l>=0&&l<=2568888),l}getAlignmentPatternPositions(){if(this.version==1)return[];{let l=Math.floor(this.version/7)+2,u=Math.floor((this.version*8+l*3+5)/(l*4-4))*2,d=[6];for(let z=this.size-7;d.length<l;z-=u)d.splice(1,0,z);return d}}static getNumRawDataModules(l){if(l<f.MIN_VERSION||l>f.MAX_VERSION)throw new RangeError("Version number out of range");let u=(16*l+128)*l+64;if(l>=2){let d=Math.floor(l/7)+2;u-=(25*d-10)*d-55,l>=7&&(u-=36)}return n(u>=208&&u<=29648),u}static getNumDataCodewords(l,u){return Math.floor(f.getNumRawDataModules(l)/8)-f.ECC_CODEWORDS_PER_BLOCK[u.ordinal][l]*f.NUM_ERROR_CORRECTION_BLOCKS[u.ordinal][l]}static reedSolomonComputeDivisor(l){if(l<1||l>255)throw new RangeError("Degree out of range");let u=[];for(let z=0;z<l-1;z++)u.push(0);u.push(1);let d=1;for(let z=0;z<l;z++){for(let C=0;C<u.length;C++)u[C]=f.reedSolomonMultiply(u[C],d),C+1<u.length&&(u[C]^=u[C+1]);d=f.reedSolomonMultiply(d,2)}return u}static reedSolomonComputeRemainder(l,u){let d=u.map(z=>0);for(let z of l){let C=z^d.shift();d.push(0),u.forEach((S,b)=>d[b]^=f.reedSolomonMultiply(S,C))}return d}static reedSolomonMultiply(l,u){if(l>>>8||u>>>8)throw new RangeError("Byte out of range");let d=0;for(let z=7;z>=0;z--)d=d<<1^(d>>>7)*285,d^=(u>>>z&1)*l;return n(d>>>8==0),d}finderPenaltyCountPatterns(l){let u=l[1];n(u<=this.size*3);let d=u>0&&l[2]==u&&l[3]==u*3&&l[4]==u&&l[5]==u;return(d&&l[0]>=u*4&&l[6]>=u?1:0)+(d&&l[6]>=u*4&&l[0]>=u?1:0)}finderPenaltyTerminateAndCount(l,u,d){return l&&(this.finderPenaltyAddHistory(u,d),u=0),u+=this.size,this.finderPenaltyAddHistory(u,d),this.finderPenaltyCountPatterns(d)}finderPenaltyAddHistory(l,u){u[0]==0&&(l+=this.size),u.pop(),u.unshift(l)}static MIN_VERSION=1;static MAX_VERSION=40;static PENALTY_N1=3;static PENALTY_N2=3;static PENALTY_N3=40;static PENALTY_N4=10;static ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]];static NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]]}return f})();o.QrCode=i;function e(f,g,l){if(g<0||g>31||f>>>g)throw new RangeError("Value out of range");for(let u=g-1;u>=0;u--)l.push(f>>>u&1)}function t(f,g){return(f>>>g&1)!=0}function n(f){if(!f)throw new Error("Assertion error")}let p=(()=>{class f{mode;numChars;bitData;static makeBytes(l){let u=[];for(let d of l)e(d,8,u);return new f(f.Mode.BYTE,l.length,u)}static makeNumeric(l){if(!f.isNumeric(l))throw new RangeError("String contains non-numeric characters");let u=[];for(let d=0;d<l.length;){let z=Math.min(l.length-d,3);e(parseInt(l.substring(d,d+z),10),z*3+1,u),d+=z}return new f(f.Mode.NUMERIC,l.length,u)}static makeAlphanumeric(l){if(!f.isAlphanumeric(l))throw new RangeError("String contains unencodable characters in alphanumeric mode");let u=[],d;for(d=0;d+2<=l.length;d+=2){let z=f.ALPHANUMERIC_CHARSET.indexOf(l.charAt(d))*45;z+=f.ALPHANUMERIC_CHARSET.indexOf(l.charAt(d+1)),e(z,11,u)}return d<l.length&&e(f.ALPHANUMERIC_CHARSET.indexOf(l.charAt(d)),6,u),new f(f.Mode.ALPHANUMERIC,l.length,u)}static makeSegments(l){return l==""?[]:f.isNumeric(l)?[f.makeNumeric(l)]:f.isAlphanumeric(l)?[f.makeAlphanumeric(l)]:[f.makeBytes(f.toUtf8ByteArray(l))]}static makeEci(l){let u=[];if(l<0)throw new RangeError("ECI assignment value out of range");if(l<128)e(l,8,u);else if(l<16384)e(2,2,u),e(l,14,u);else if(l<1e6)e(6,3,u),e(l,21,u);else throw new RangeError("ECI assignment value out of range");return new f(f.Mode.ECI,0,u)}static isNumeric(l){return f.NUMERIC_REGEX.test(l)}static isAlphanumeric(l){return f.ALPHANUMERIC_REGEX.test(l)}constructor(l,u,d){if(this.mode=l,this.numChars=u,this.bitData=d,u<0)throw new RangeError("Invalid argument");this.bitData=d.slice()}getData(){return this.bitData.slice()}static getTotalBits(l,u){let d=0;for(let z of l){let C=z.mode.numCharCountBits(u);if(z.numChars>=1<<C)return 1/0;d+=4+C+z.bitData.length}return d}static toUtf8ByteArray(l){l=encodeURI(l);let u=[];for(let d=0;d<l.length;d++)l.charAt(d)!="%"?u.push(l.charCodeAt(d)):(u.push(parseInt(l.substring(d+1,d+3),16)),d+=2);return u}static NUMERIC_REGEX=/^[0-9]*$/;static ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+./:-]*$/;static ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:"}return f})();o.QrSegment=p})(ii||(ii={}));(function(o){let i;(function(e){class t{ordinal;formatBits;static LOW=new t(0,1);static MEDIUM=new t(1,0);static QUARTILE=new t(2,3);static HIGH=new t(3,2);constructor(p,f){this.ordinal=p,this.formatBits=f}}e.Ecc=t})(i=o.QrCode||(o.QrCode={}))})(ii||(ii={}));(function(o){let i;(function(e){class t{modeBits;numBitsCharCount;static NUMERIC=new t(1,[10,12,14]);static ALPHANUMERIC=new t(2,[9,11,13]);static BYTE=new t(4,[8,16,16]);static KANJI=new t(8,[8,10,12]);static ECI=new t(7,[0,0,0]);constructor(p,f){this.modeBits=p,this.numBitsCharCount=f}numCharCountBits(p){return this.numBitsCharCount[Math.floor((p+7)/17)]}}e.Mode=t})(i=o.QrSegment||(o.QrSegment={}))})(ii||(ii={}));var Hi=ii,$a={L:Hi.QrCode.Ecc.LOW,M:Hi.QrCode.Ecc.MEDIUM,Q:Hi.QrCode.Ecc.QUARTILE,H:Hi.QrCode.Ecc.HIGH},qa=160,Za=10,Ya=10,Xa="#000000",Ja="#FFFFFF",Ka=40,Qa="M",es=(o,i=Qa)=>o?Hi.QrCode.encodeText(o,$a[i]):null;function ts(o,i,e=qa,t=Za,n=Ya,p=Xa,f=Ja,g=Ka,l){let u=o.getContext("2d"),d=is(n);if(o.style.width=`${e}px`,o.style.height=`${e}px`,!i){u.fillStyle="rgba(0, 0, 0, 0)",u.fillRect(0,0,o.width,o.height);return}if(o.width=i.size*t+d[1]+d[3],o.height=i.size*t+d[0]+d[2],!l)Wo(u,o.width,o.height,t,f),jo(u,i,t,d,f,p);else{let z=new Image;z.src=l,z.crossOrigin="anonymous",z.width=g*(o.width/e),z.height=g*(o.width/e);let C=()=>{b(),Wo(u,o.width,o.height,t,f),jo(u,i,t,d,f,p);let T=o.width/2-g*(o.width/e)/2;u.fillRect(T,T,g*(o.width/e),g*(o.width/e)),u.drawImage(z,T,T,g*(o.width/e),g*(o.width/e))},S=()=>{b(),Wo(u,o.width,o.height,t,f),jo(u,i,t,d,f,p)},b=()=>{z.removeEventListener("load",C),z.removeEventListener("error",S)};z.addEventListener("load",C),z.addEventListener("error",S)}}function jo(o,i,e,t,n,p){for(let f=0;f<i.size;f++)for(let g=0;g<i.size;g++)o.fillStyle=i.getModule(g,f)?p:n,o.fillRect(t[3]+g*e,t[0]+f*e,e,e)}function Wo(o,i,e,t,n){o.fillStyle=n,o.fillRect(0,0,i*t,e*t)}function is(o){return Array.isArray(o)?Array(4).fill(0).map((i,e)=>o[e%o.length]):[o,o,o,o]}var Cr=(()=>{class o{i18n=_(En);el=_(ni);cdr=_(ai);destroyRef=_(Yi);isBrowser=gn(_(nn));canvas;nzValue="";nzPadding=0;nzColor="#000000";nzBgColor="#FFFFFF";nzSize=160;nzIcon="";nzIconSize=40;nzBordered=!0;nzStatus="active";nzLevel="M";nzStatusRender=null;nzRefresh=new Oi;locale;ngOnInit(){this.el.nativeElement.style.backgroundColor=this.nzBgColor,this.i18n.localeChange.pipe(mi(this.destroyRef)).subscribe(()=>{this.locale=this.i18n.getLocaleData("QRCode"),this.cdr.markForCheck()})}ngOnChanges(e){let{nzValue:t,nzIcon:n,nzLevel:p,nzSize:f,nzIconSize:g,nzColor:l,nzPadding:u,nzBgColor:d}=e;(t||n||p||f||g||l||u||d)&&this.canvas&&this.drawCanvasQRCode(),d&&(this.el.nativeElement.style.backgroundColor=this.nzBgColor)}ngAfterViewInit(){this.drawCanvasQRCode()}reloadQRCode(){this.drawCanvasQRCode(),this.nzRefresh.emit("refresh")}drawCanvasQRCode(){this.canvas&&ts(this.canvas.nativeElement,es(this.nzValue,this.nzLevel),this.nzSize,10,this.nzPadding,this.nzColor,this.nzBgColor,this.nzIconSize,this.nzIcon)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=E({type:o,selectors:[["nz-qrcode"]],viewQuery:function(t,n){if(t&1&&mn(ka,5),t&2){let p;un(p=dn())&&(n.canvas=p.first)}},hostAttrs:[1,"ant-qrcode"],hostVars:2,hostBindings:function(t,n){t&2&&ri("ant-qrcode-border",n.nzBordered)},inputs:{nzValue:"nzValue",nzPadding:"nzPadding",nzColor:"nzColor",nzBgColor:"nzBgColor",nzSize:[2,"nzSize","nzSize",Gi],nzIcon:"nzIcon",nzIconSize:[2,"nzIconSize","nzIconSize",Gi],nzBordered:[2,"nzBordered","nzBordered",io],nzStatus:"nzStatus",nzLevel:"nzLevel",nzStatusRender:"nzStatusRender"},outputs:{nzRefresh:"nzRefresh"},exportAs:["nzQRCode"],features:[Xi],decls:3,vars:2,consts:[["canvas",""],[1,"ant-qrcode-mask"],[4,"nzStringTemplateOutlet"],[1,"ant-qrcode-expired"],["nz-button","","nzType","link",3,"click"],["nzType","reload","nzTheme","outline"]],template:function(t,n){t&1&&(x(0,Va,2,1,"div",1)(1,Wa,4,1,"div",1),x(2,Ha,2,0,"canvas")),t&2&&(F(n.nzStatusRender?0:n.nzStatus!=="active"?1:-1),s(2),F(n.isBrowser?2:-1))},dependencies:[R,po,A,Me,L,w,St,vn],encapsulation:2,changeDetection:0})}return o})();var $i=()=>({standalone:!0}),Ti=class Ti{constructor(){this.value="https://ng-alain.com/";this.background="#ffffff";this.foreground="#000000";this.level="L";this.mime="image/png";this.padding=10;this.size=220}};Ti.\u0275fac=function(e){return new(e||Ti)},Ti.\u0275cmp=E({type:Ti,selectors:[["app-qr"]],decls:44,vars:39,consts:[[1,"alain-default__content-title"],["href","https://ng.ant.design/components/qr-code","target","_blank"],[3,"nzGutter"],[1,"text-center",3,"nzSpan"],[3,"nzValue","nzBgColor","nzColor","nzLevel","nzSize","nzPadding"],[3,"nzSpan"],["nz-form",""],["nz-input","","type","color",2,"width","100px",3,"ngModelChange","ngModel","ngModelOptions"],[3,"ngModelChange","ngModel","ngModelOptions"],["nzValue","L","nzLabel","L"],["nzValue","M","nzLabel","M"],["nzValue","Q","nzLabel","Q"],["nzValue","H","nzLabel","H"],[3,"ngModelChange","ngModel","ngModelOptions","nzMin","nzMax"],[3,"ngModelChange","ngModel","ngModelOptions","nzMin","nzMax","nzStep"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"h1"),m(2," \u4E8C\u7EF4\u7801 "),r(3,"a",1),m(4,"Document"),a()()(),r(5,"nz-card")(6,"nz-row",2)(7,"nz-col",3),M(8,"nz-qrcode",4),a(),r(9,"nz-col",5)(10,"form",6)(11,"nz-form-item")(12,"nz-form-label",5),m(13,"\u80CC\u666F"),a(),r(14,"nz-form-control",5)(15,"nz-input-group")(16,"input",7),Te("ngModelChange",function(p){return De(t.background,p)||(t.background=p),p}),a()()()(),r(17,"nz-form-item")(18,"nz-form-label",5),m(19,"\u524D\u666F"),a(),r(20,"nz-form-control",5)(21,"nz-input-group")(22,"input",7),Te("ngModelChange",function(p){return De(t.foreground,p)||(t.foreground=p),p}),a()()()(),r(23,"nz-form-item")(24,"nz-form-label",5),m(25,"\u8BEF\u5DEE"),a(),r(26,"nz-form-control",5)(27,"nz-select",8),Te("ngModelChange",function(p){return De(t.level,p)||(t.level=p),p}),M(28,"nz-option",9)(29,"nz-option",10)(30,"nz-option",11)(31,"nz-option",12),a()()(),r(32,"nz-form-item")(33,"nz-form-label",5),m(34,"\u5185\u8FB9\u8DDD"),a(),r(35,"nz-form-control",5)(36,"nz-input-number",13),Te("ngModelChange",function(p){return De(t.padding,p)||(t.padding=p),p}),a(),m(37,"px "),a()(),r(38,"nz-form-item")(39,"nz-form-label",5),m(40,"\u5927\u5C0F"),a(),r(41,"nz-form-control",5)(42,"nz-input-number",14),Te("ngModelChange",function(p){return De(t.size,p)||(t.size=p),p}),a(),m(43,"px "),a()()()()()()),e&2&&(s(6),c("nzGutter",24),s(),c("nzSpan",8),s(),c("nzValue",t.value)("nzBgColor",t.background)("nzColor",t.foreground)("nzLevel",t.level)("nzSize",t.size)("nzPadding",t.padding),s(),c("nzSpan",16),s(3),c("nzSpan",8),s(2),c("nzSpan",16),s(2),Fe("ngModel",t.background),c("ngModelOptions",Ee(34,$i)),s(2),c("nzSpan",8),s(2),c("nzSpan",16),s(2),Fe("ngModel",t.foreground),c("ngModelOptions",Ee(35,$i)),s(2),c("nzSpan",8),s(2),c("nzSpan",16),s(),Fe("ngModel",t.level),c("ngModelOptions",Ee(36,$i)),s(6),c("nzSpan",8),s(2),c("nzSpan",16),s(),Fe("ngModel",t.padding),c("ngModelOptions",Ee(37,$i))("nzMin",0)("nzMax",100),s(3),c("nzSpan",8),s(2),c("nzSpan",16),s(),Fe("ngModel",t.size),c("ngModelOptions",Ee(38,$i))("nzMin",100)("nzMax",1e3)("nzStep",t.padding))},dependencies:[O,Ot,Et,Ie,kt,xt,Xt,V,se,ie,pe,de,ue,A,L,q,oe,Tt,Dt,G,H,he,X,ui,di,w,U,ce,I,J,k,le,ee,Ft,fo,te,qn,Q,ze,K,W,me,ge,ae,j,ne,Vt,Kt,ei,Qt,fe,R,re,Se,$,Ce,Z,P,Y,Cr],encapsulation:2});var Eo=Ti;var os=["*"],ns=(()=>{class o{_change=new Zi(null);toggle(){this._change.next(!0)}get change(){return this._change.pipe(en())}static \u0275fac=function(t){return new(t||o)};static \u0275prov=Wt({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Ho="full-content__body",$o="full-content__opened",qo="full-content__hidden-title",Zo=(()=>{class o{destroy$=_(Yi);el=_(ni).nativeElement;cdr=_(ai);srv=_(ns);router=_(si);doc=_(on);bodyEl=this.doc.querySelector("body");inited=!1;id=`_full-content-${Math.random().toString(36).substring(2)}`;_height=0;hideTitle=Po(!0,{transform:io});padding=Po(24,{transform:Gi});fullscreen=fn();updateCls(){let e=this.bodyEl.classList;this.fullscreen()?(e.add($o),this.hideTitle()&&e.add(qo)):(e.remove($o),this.hideTitle()&&e.remove(qo))}update(){this.updateCls(),this.updateHeight(),this.fullscreen.set(this.fullscreen())}updateHeight(){this._height=this.bodyEl.getBoundingClientRect().height-this.el.getBoundingClientRect().top-this.padding(),this.cdr.detectChanges()}removeInBody(){this.bodyEl.classList.remove(Ho,$o,qo)}ngOnInit(){this.inited=!0,this.bodyEl.classList.add(Ho),this.el.id=this.id,this.updateCls(),Ko(window,"resize").pipe(mi(this.destroy$),Ro(200)).subscribe(()=>this.updateHeight()),this.srv.change.pipe(mi(this.destroy$),Ao(e=>e!==null)).subscribe(()=>this.toggle()),this.router.events.pipe(mi(this.destroy$),Ao(e=>e instanceof Cn||e instanceof Mn),Ro(200)).subscribe(()=>{this.doc.querySelector(`#${this.id}`)?(this.bodyEl.classList.add(Ho),this.updateCls()):this.removeInBody()})}toggle(){this.fullscreen.set(!this.fullscreen()),this.update(),this.updateHeight()}ngAfterViewInit(){setTimeout(()=>this.updateHeight())}ngOnChanges(){this.inited&&this.update()}ngOnDestroy(){this.removeInBody()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=E({type:o,selectors:[["full-content"]],hostVars:4,hostBindings:function(t,n){t&2&&(pn("height",n._height,"px"),ri("full-content",!0))},inputs:{hideTitle:[1,"hideTitle"],padding:[1,"padding"],fullscreen:[1,"fullscreen"]},outputs:{fullscreen:"fullscreenChange"},exportAs:["fullContent"],features:[Xi],ngContentSelectors:os,decls:1,vars:0,template:function(t,n){t&1&&(sn(),ln(0))},encapsulation:2,changeDetection:0})}return o})(),Mr=(()=>{class o{parent=_(Zo);_click(){this.parent.toggle()}static \u0275fac=function(t){return new(t||o)};static \u0275dir=Ji({type:o,selectors:[["","full-toggle",""]],hostBindings:function(t,n){t&1&&N("click",function(){return n._click()})},exportAs:["fullToggle"]})}return o})();var _r=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=ki({type:o});static \u0275inj=Ii({imports:[zn]})}return o})();var as=o=>({params:o}),ss=()=>({list:"results"}),ls=o=>({reName:o}),ms=()=>[0,0,0,0];function us(o,i){if(o&1&&M(0,"g2-mini-bar",21),o&2){let e=h();c("padding",Ee(2,ms))("data",e.events)}}var wi=class wi{constructor(){this.http=_(lo);this.message=_(Re);this.ps=20;this.total=200;this.args={_allow_anonymous:!0,userid:null};this.url="https://api.randomuser.me/?results=20";this.events=[];this.scroll={y:"230px"};this.columns=[{title:"id",index:"id.value",type:"checkbox"},{title:"Avatar",index:"picture.thumbnail",type:"img",width:80},{title:"Name",index:"name.first",width:150,format:i=>`${i.name.first} ${i.name.last}`,type:"link",click:i=>this.message.info(`${i.name.first}`)},{title:"Email",index:"email"},{title:"Gender",index:"gender",type:"yn",yn:{truth:"female",yes:"\u7537",no:"\u5973",mode:"text"},width:120},{title:"Events",render:"events",width:90},{title:"Registered",index:"registered.date",type:"date",width:170},{title:"Actions",width:120,buttons:[{text:"Edit",click:i=>this.message.info(`edit [${i.id.value}]`),iif:i=>i.gender==="female"},{text:"Delete",type:"del",click:i=>this.message.info(`deleted [${i.id.value}]`)}]}]}ngOnInit(){this.http.get("/chart/visit").subscribe(i=>this.events=i.slice(0,8))}fullChange(i){this.scroll=i?{y:"350px"}:{y:"230px"}}};wi.\u0275fac=function(e){return new(e||wi)},wi.\u0275cmp=E({type:wi,selectors:[["app-st"]],decls:43,vars:18,consts:[["exportMenu","nzDropdownMenu"],["st",""],[1,"alain-default__content-title"],["href","//ng-alain.com/components/table","target","_blank"],["href","//ng-alain.com/components/full-content","target","_blank"],[3,"fullscreenChange"],["nz-row","",1,"mb-md"],["nz-col","","nzSpan","12"],["nz-form","","nzLayout","inline","se-container",""],["label","User ID","labelWidth","0"],["nz-input","","name","userid","id","userid",3,"ngModelChange","ngModel"],["nz-button","",3,"click","nzType","nzLoading"],["nz-button","",3,"click","disabled"],[1,"text-right"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu"],["nz-icon","","nzType","down"],["nz-menu",""],["nz-menu-item",""],["nz-button","","full-toggle","",1,"ml-sm",3,"nzType"],[3,"data","req","res","total","ps","columns","scroll"],["st-row","events"],["height","15","theme","mini","color","#999","borderWidth","3","tooltipType","mini",3,"padding","data"]],template:function(e,t){if(e&1){let n=B();r(0,"div",2)(1,"h1"),m(2," Fullscreen & ST "),r(3,"small"),m(4,"\u4F7F\u7528 "),r(5,"a",3),m(6,"st"),a(),m(7,"\u3001 "),r(8,"a",4),m(9,"full-content"),a(),m(10," \u7EC4\u5408\uFF0C\u7531\u4E8E nz-table \u56FA\u5B9A\u8868\u5934\u6682\u4E0D\u652F\u6301\u81EA\u9002\u5E94\uFF0C\u56E0\u6B64\u8868\u683C\u7684\u5C55\u793A\u7684\u6548\u679C\u5728\u54CD\u5E94\u5F0F\u91CC\u9762\u6548\u679C\u5E76\u4E0D\u662F\u7279\u522B\u597D\u3002"),a()()(),r(11,"full-content",5),N("fullscreenChange",function(f){return v(n),y(t.fullChange(f))}),r(12,"nz-card")(13,"div",6)(14,"div",7)(15,"form",8)(16,"se",9)(17,"input",10),Te("ngModelChange",function(f){return v(n),De(t.args.userid,f)||(t.args.userid=f),y(f)}),a()(),r(18,"se")(19,"button",11),N("click",function(){v(n);let f=Gt(41);return y(f.load())}),m(20,"Search"),a(),r(21,"button",12),N("click",function(){v(n);let f=Gt(41);return y(f.load(1,{_allow_anonymous:!0}))}),m(22,"Clear"),a()()()(),r(23,"div",7)(24,"div",13)(25,"button",14)(26,"span"),m(27,"Export"),a(),M(28,"i",15),a(),r(29,"nz-dropdown-menu",null,0)(31,"ul",16)(32,"li",17),m(33,"Excel"),a(),r(34,"li",17),m(35,"JSON"),a(),r(36,"li",17),m(37,"PNG"),a()()(),r(38,"button",18),m(39,"Full"),a()()()(),r(40,"st",19,1),Ht(42,us,1,3,"ng-template",20),a()()()}if(e&2){let n=Gt(30);s(17),Fe("ngModel",t.args.userid),s(2),c("nzType","primary")("nzLoading",t.http.loading),s(2),c("disabled",t.http.loading),s(4),c("nzDropdownMenu",n),s(13),c("nzType","default"),s(2),c("data",t.url)("req",Ui(13,as,t.args))("res",Ui(16,ls,Ee(15,ss)))("total",t.total)("ps",t.ps)("columns",t.columns)("scroll",t.scroll)}},dependencies:[O,Ot,Et,Ie,kt,xt,Xt,V,se,ie,Ci,Zn,pe,de,Qn,er,ue,A,Me,L,ye,q,Gn,Un,jn,Hn,Wn,oe,Tt,Dt,G,H,he,X,w,St,U,ce,I,J,k,le,ee,Ft,te,Q,ze,K,W,me,ge,ae,j,ne,Vt,fe,R,re,Se,$,Ce,Z,P,Y,_r,Zo,Mr,dr],encapsulation:2});var xo=wi;var Nr=()=>({standalone:!0}),Ai=class Ai{constructor(){this.messageSrv=_(Re);this.format_str="this is ${name}";this.format_res="";this.format_obj=JSON.stringify({name:"asdf"});this.content=`time ${+new Date}

    \u4E2D\u6587\uFF01@#\uFFE5%\u2026\u2026&*`}onFormat(){let i=null;try{i=JSON.parse(this.format_obj)}catch{this.messageSrv.error("\u65E0\u6CD5\u4F7F\u7528 JSON.parse \u8F6C\u6362");return}this.format_res=kn(this.format_str,i,!0)}onYuan(i){this.yuan_res=Jn(i)}onCopy(){Tn(`time ${+new Date}`).then(()=>this.messageSrv.success("success"))}};Ai.\u0275fac=function(e){return new(e||Ai)},Ai.\u0275cmp=E({type:Ai,selectors:[["app-util"]],decls:39,vars:23,consts:[[1,"alain-default__content-title"],[3,"nzGutter"],[3,"nzSpan"],["nzTitle","\u5B57\u7B26\u4E32\u7C7B"],["nzType","inner","nzTitle","format"],["nz-form",""],[3,"nzSm"],["nz-input","",3,"ngModelChange","ngModel","ngModelOptions"],[3,"nzSpan","nzOffset"],["nz-button","",3,"click"],["nzType","inner","nzTitle","yuan"],["type","number","nz-input","",3,"ngModelChange","ngModel"],[3,"innerHTML"],["nzTitle","\u5176\u5B83\u7C7B"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"h1"),m(2," \u5DE5\u5177\u96C6 "),r(3,"small"),m(4,"@delon/util \u65E5\u5E38\u7528\u6CD5\u3002"),a()()(),r(5,"nz-row",1)(6,"nz-col",2)(7,"nz-card",3)(8,"nz-card",4)(9,"form",5)(10,"nz-form-item")(11,"nz-form-label",6),m(12,"String"),a(),r(13,"nz-form-control",6)(14,"input",7),Te("ngModelChange",function(p){return De(t.format_str,p)||(t.format_str=p),p}),a()()(),r(15,"nz-form-item")(16,"nz-form-label",6),m(17,"Object"),a(),r(18,"nz-form-control",6)(19,"input",7),Te("ngModelChange",function(p){return De(t.format_obj,p)||(t.format_obj=p),p}),a()()(),r(20,"nz-form-item")(21,"nz-form-control",8)(22,"button",9),N("click",function(){return t.onFormat()}),m(23,"Run"),a()()(),r(24,"nz-form-item")(25,"nz-form-label",6),m(26,"Result"),a(),r(27,"nz-form-control",6),m(28),a()()()(),r(29,"nz-card",10)(30,"nz-row",1)(31,"nz-col",2)(32,"input",11),Te("ngModelChange",function(p){return De(t.yuan_str,p)||(t.yuan_str=p),p}),N("ngModelChange",function(p){return t.onYuan(p)}),a()(),r(33,"nz-col",2),M(34,"div",12),a()()()()(),r(35,"nz-col",2)(36,"nz-card",13)(37,"button",9),N("click",function(){return t.onCopy()}),m(38,"Copy"),a()()()()),e&2&&(s(5),c("nzGutter",16),s(),c("nzSpan",12),s(5),c("nzSm",8),s(2),c("nzSm",16),s(),Fe("ngModel",t.format_str),c("ngModelOptions",Ee(21,Nr)),s(2),c("nzSm",8),s(2),c("nzSm",16),s(),Fe("ngModel",t.format_obj),c("ngModelOptions",Ee(22,Nr)),s(2),c("nzSpan",16)("nzOffset",8),s(4),c("nzSm",8),s(2),c("nzSm",16),s(),be(" ",t.format_res," "),s(2),c("nzGutter",16),s(),c("nzSpan",12),s(),Fe("ngModel",t.yuan_str),s(),c("nzSpan",12),s(),c("innerHTML",t.yuan_res,rn),s(),c("nzSpan",12))},dependencies:[O,Ot,Et,wn,Ie,kt,xt,Xt,V,se,ie,pe,de,ue,A,Me,L,ye,q,oe,Tt,Dt,G,H,he,X,w,U,ce,I,J,k,le,ee,Ft,te,Q,ze,K,W,me,ge,ae,j,ne,Vt,Kt,ei,Qt,fe,R,re,Se,$,Ce,Z,P,Y],encapsulation:2});var Fo=Ai;var Ri=class Ri{constructor(){this.xlsx=_(Vn);this.users=Array(100).fill(0).map((i,e)=>({id:e+1,name:`name ${e+1}`,age:Math.ceil(Math.random()*10)+20}));this.columns=[{title:"\u7F16\u53F7",index:"id",type:"checkbox"},{title:"\u59D3\u540D",index:"name"},{title:"\u5E74\u9F84",index:"age"}]}url(){this.xlsx.import("./assets/tmp/demo.xlsx").then(i=>this.data=i)}change(i){let e=i.target.files[0];this.xlsx.import(e).then(t=>this.data=t)}download(){let i=[this.columns.map(e=>e.title)];this.users.forEach(e=>i.push(this.columns.map(t=>e[t.index]))),this.xlsx.export({sheets:[{data:i,name:"sheet name"}]})}};Ri.\u0275fac=function(e){return new(e||Ri)},Ri.\u0275cmp=E({type:Ri,selectors:[["app-xlsx"]],decls:16,vars:6,consts:[[1,"alain-default__content-title"],["href","//ng-alain.com/components/xlsx","target","_blank"],["nzTitle","Import"],["nz-button","",3,"click"],["type","file","multiple","false",1,"ml-sm",3,"change"],[1,"mt-sm"],["nzTitle","Export"],[1,"mt-sm",3,"data","ps","columns"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"h1"),m(2," Import & Export excel file, "),r(3,"a",1),m(4,"Document"),a()()(),r(5,"nz-card",2)(6,"button",3),N("click",function(){return t.url()}),m(7,"Via Url"),a(),r(8,"input",4),N("change",function(p){return t.change(p)}),a(),r(9,"p",5),m(10),At(11,"json"),a()(),r(12,"nz-card",6)(13,"button",3),N("click",function(){return t.download()}),m(14,"Export"),a(),M(15,"st",7),a()),e&2&&(s(10),be("result: ",Rt(11,4,t.data)),s(5),c("data",t.users)("ps",3)("columns",t.columns))},dependencies:[O,V,se,ie,Ci,pe,de,ue,A,Me,L,ye,q,oe,G,H,he,X,w,U,ce,I,J,k,le,ee,te,Q,ze,K,W,me,ge,ae,j,ne,fe,R,re,Se,$,Ce,Z,P,Y,qt],encapsulation:2});var Do=Ri;var br=Yo(Go(),1);var vr=(()=>{class o{http=_(oo);lazy=_(ro);ngZone=_(an);cogSrv=_(li);cog;constructor(){this.cog=this.cogSrv.merge("zip",{url:"https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js",utils:[]})}init(){return this.lazy.load([this.cog.url].concat(this.cog.utils))}check(e){if(!e)throw new Error("get instance via `ZipService.create()`")}read(e,t){return new Promise((n,p)=>{let f=g=>{this.ngZone.run(()=>n(g))};this.init().then(()=>{if(typeof e=="string"){this.http.request("GET",e,{responseType:"arraybuffer"}).subscribe({next:l=>{JSZip.loadAsync(l,t).then(u=>f(u))},error:l=>{p(l)}});return}let g=new FileReader;g.onload=l=>{JSZip.loadAsync(l.target.result,t).then(u=>f(u))},g.readAsBinaryString(e)})})}create(){return new Promise(e=>{this.init().then(()=>{let t=new JSZip;e(t)}).catch(()=>e(null))})}pushUrl(e,t,n){return this.check(e),new Promise((p,f)=>{this.http.request("GET",n,{responseType:"arraybuffer"}).subscribe({next:g=>{e.file(t,g),p()},error:g=>{f({url:n,error:g})}})})}save(e,t){this.check(e);let n=Ae({filename:"download.zip"},t);return new Promise((p,f)=>{e.generateAsync(Ae({type:"blob"},n.options),n.update).then(g=>{n.callback&&n.callback(g),(0,br.saveAs)(g,n.filename),p()},g=>{f(g)})})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=Wt({token:o,factory:o.\u0275fac,providedIn:"root"})}return Xo([On()],o.prototype,"read",null),o})();function ds(o,i){if(o&1&&(r(0,"li"),m(1),At(2,"json"),a()),o&2){let e=i.$implicit;s(),Pe(Rt(2,1,e))}}function ps(o,i){if(o&1){let e=B();r(0,"nz-card",2)(1,"button",4),N("click",function(){v(e);let n=h();return y(n.url())}),m(2,"Via Url"),a(),r(3,"input",5),N("change",function(n){v(e);let p=h();return y(p.change(n))}),a(),r(4,"ol"),_e(5,ds,3,3,"li",null,$t),a()()}if(o&2){let e=h();s(5),Ne(e.list)}}function cs(o,i){if(o&1){let e=B();r(0,"tr")(1,"td")(2,"input",9),Te("ngModelChange",function(n){let p=v(e).$implicit;return De(p.path,n)||(p.path=n),y(n)}),a()(),r(3,"td")(4,"input",9),Te("ngModelChange",function(n){let p=v(e).$implicit;return De(p.url,n)||(p.url=n),y(n)}),a()()()}if(o&2){let e=i.$implicit,t=i.$index;s(2),c("name",Vi("path",t)),Fe("ngModel",e.path),s(2),c("name",Vi("url",t)),Fe("ngModel",e.url)}}function fs(o,i){if(o&1){let e=B();r(0,"nz-card",3)(1,"button",6),N("click",function(){v(e);let n=h();return y(n.data.push({}))}),m(2,"new"),a(),r(3,"button",7),N("click",function(){v(e);let n=h();return y(n.download())}),m(4,"download"),a(),r(5,"nz-table",8)(6,"thead")(7,"tr")(8,"th")(9,"span"),m(10,"path"),a()(),r(11,"th")(12,"span"),m(13,"url"),a()()()(),r(14,"tbody"),_e(15,cs,5,6,"tr",null,$t),a()()()}if(o&2){let e=h();s(),c("nzType","primary"),s(4),c("nzData",e.data)("nzFrontPagination",!1)("nzShowPagination",!1),s(10),Ne(e.data)}}var Bi=class Bi{constructor(){this.zip=_(vr);this.msg=_(Re);this.cdr=_(ai);this.instance=null;this.data=[{path:"demo.docx",url:"https://ng-alain.com/assets/demo.docx"},{path:"\u5C0F\u7A0B\u5E8F\u6807\u5FD7.zip",url:"https://wximg.gtimg.com/shake_tv/mina/standard_logo.zip"}]}ngOnInit(){this.zip.create().then(i=>{this.instance=i,this.cdr.detectChanges()})}format(i){let e=i.files;this.list=Object.keys(e).map(t=>({name:t,dir:e[t].dir,date:e[t].date})),this.cdr.detectChanges()}url(){this.zip.read("./assets/tmp/demo.zip").then(i=>this.format(i))}change(i){let e=i.target.files[0];this.zip.read(e).then(t=>this.format(t))}download(){let i=[];this.data.forEach(e=>{i.push(this.zip.pushUrl(this.instance,e.path,e.url))}),Promise.all(i).then(()=>{this.zip.save(this.instance).then(()=>{this.msg.success("download success"),this.data=[]})},e=>{console.warn(e),this.msg.error(JSON.stringify(e))})}};Bi.\u0275fac=function(e){return new(e||Bi)},Bi.\u0275cmp=E({type:Bi,selectors:[["app-zip"]],decls:7,vars:2,consts:[[1,"alain-default__content-title"],["href","//ng-alain.com/components/zip","target","_blank"],["nzTitle","\u89E3\u538B"],["nzTitle","\u538B\u7F29"],["nz-button","",3,"click"],["type","file","multiple","false",1,"ml-sm",3,"change"],["nz-button","",3,"click","nzType"],["nz-button","",1,"ml-sm",3,"click"],[1,"mt-sm",3,"nzData","nzFrontPagination","nzShowPagination"],["nz-input","",3,"ngModelChange","ngModel","name"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"h1"),m(2," Read & Write zip file, "),r(3,"a",1),m(4,"Document"),a()()(),x(5,ps,7,0,"nz-card",2),x(6,fs,17,4,"nz-card",3)),e&2&&(s(5),F(t.instance?5:-1),s(),F(t.instance?6:-1))},dependencies:[O,Et,Ie,xt,V,se,ie,pe,de,ue,A,Me,L,ye,q,oe,G,H,he,X,w,U,ce,I,J,zi,pi,ci,hi,fi,gi,k,le,ee,Ft,te,Q,ze,K,W,me,ge,ae,j,ne,fe,R,re,Se,$,Ce,Z,P,Y,qt],encapsulation:2,changeDetection:0});var To=Bi;var Fu=[{path:"st",component:xo},{path:"util",component:Fo},{path:"print",component:So},{path:"acl",component:zo},{path:"firebase-role-manager",component:go,canActivate:[ji],data:{guard:"admin"}},{path:"guard",component:vo,children:[{path:"leave",component:yo,canDeactivate:[gr]},{path:"auth",component:No,canActivate:[ji],data:{guard:"user1"}},{path:"admin",component:_o,canActivate:[ji],data:{guard:"admin"}},{path:"guest",component:bo,canActivate:[ji],data:{guard:"guest"}}]},{path:"cache",component:ho},{path:"qr",component:Eo},{path:"downfile",component:Co},{path:"xlsx",component:Do},{path:"zip",component:To},{path:"form",component:Mo}];export{Fu as routes};
