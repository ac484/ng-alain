import{a as E}from"./chunk-V6WIK557.js";import{$ as je,A as At,B as Et,C as St,D as oe,E as be,F as Nt,G as N,H as bt,I as Tt,J as Ct,K as Ft,L as jt,M as Dt,N as Ot,O as Pt,P as xt,Q as ae,R as Rt,S as Te,T as Ce,U as Mt,V as qt,W as kt,X as Ut,Y as Bt,Z as $t,_ as Fe,a as rt,aa as Wt,b as nt,ba as Lt,c as it,ca as De,d as U,da as Vt,e as st,ea as zt,f as ot,fa as Gt,g as at,ga as Qt,h as lt,ha as Kt,i as dt,ia as Zt,j as ct,ja as Jt,k as ut,ka as Ht,l as ht,la as Yt,m as Q,n as Se,o as ft,p as se,q as Ne,r as pt,s as gt,u as mt,v as yt,w as _t,x as wt,y as It,z as vt}from"./chunk-2Q27IRVC.js";import{d as ne,k as ie}from"./chunk-V5232PIM.js";import{I as Ee,J as tt}from"./chunk-2DVOMO4J.js";import{$ as te,G as Ye,H as z,Jd as re,Q as Xe,Qa as G,S as et,W as X,X as ee,Z as Ie,aa as F,ba as ve,cd as Ae,ce as g,d as L,g as Je,ja as q,k as He,ma as h,na as l,o as V,oa as j,p as Y,q as b,r as T,sa as k,tb as D,w as u}from"./chunk-67N3UCKF.js";import{a as _,b as A}from"./chunk-57BLH6QZ.js";var gr="firebase",mr="11.10.0";E.registerVersion(gr,mr,"app-compat");var yr=["ngOnDestroy"],er=(r,e,t,n={})=>new Proxy(r,{get:(i,s)=>t.runOutsideAngular(()=>{if(r[s])return n?.spy?.get&&n.spy.get(s,r[s]),r[s];if(yr.indexOf(s)>-1)return()=>{};let a=e.toPromise().then(o=>{let d=o?.[s];return typeof d=="function"?d.bind(o):d?.then?d.then(p=>t.run(()=>p)):t.run(()=>d)});return new Proxy(()=>{},{get:(o,d)=>a[d],apply:(o,d,p)=>a.then(w=>{let I=w?.(...p);return n?.spy?.apply&&n.spy.apply(s,p,I),I})})})});var Oe=class{constructor(e){return e}},le=new h("angularfire2.app.options"),de=new h("angularfire2.app.name");function ce(r,e,t){let n=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||n;let a=E.apps.filter(o=>o&&o.name===i.name)[0]||e.runOutsideAngular(()=>E.initializeApp(r,i));try{if(JSON.stringify(r)!==JSON.stringify(a.options)){let o=!!module.hot;_r("error",`${a.name} Firebase App already initialized with different options${o?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Oe(a)}var _r=(r,...e)=>{Ae()&&typeof console<"u"&&console[r](...e)};function ue(r,e,t,n,i){let[,s,a]=globalThis.\u0275AngularfireInstanceCache.find(o=>o[0]===r)||[];if(s)return wr(i,a)||(Xt("error",`${e} was already initialized on the ${t} Firebase App with different settings.${Ir?" You may need to reload as Firebase is not HMR aware.":""}`),Xt("warn",{is:i,was:a})),s;{let o=n();return globalThis.\u0275AngularfireInstanceCache.push([r,o,i]),o}}function wr(r,e){try{return r.toString()===e.toString()}catch{return r===e}}var Ir=typeof module<"u"&&!!module.hot,Xt=(r,...e)=>{Ae()&&typeof console<"u"&&console[r](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Pe=new h("angularfire2.auth.use-emulator"),xe=new h("angularfire2.auth.settings"),Re=new h("angularfire2.auth.tenant-id"),Me=new h("angularfire2.auth.langugage-code"),qe=new h("angularfire2.auth.use-device-language"),ke=new h("angularfire.auth.persistence"),Ue=(r,e,t,n,i,s,a,o)=>ue(`${r.name}.auth`,"AngularFireAuth",r.name,()=>{let d=e.runOutsideAngular(()=>r.auth());if(t&&d.useEmulator(...t),n&&(d.tenantId=n),d.languageCode=i,s&&d.useDeviceLanguage(),a)for(let[p,w]of Object.entries(a))d.settings[p]=w;return o&&d.setPersistence(o),d},[t,n,i,s,a,o]),rr=(()=>{class r{injector=j(k);authState;idToken;user;idTokenResult;credential;constructor(t,n,i,s,a,o,d,p,w,I,we,Ze){let Z=new Je,C=T(void 0).pipe(V(a.outsideAngular),F(()=>s.runOutsideAngular(()=>import("./chunk-5DLZWRPV.js"))),u(()=>ce(t,s,n)),u(v=>Ue(v,s,o,p,w,I,d,we)),Ie({bufferSize:1,refCount:!1}));if(re(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=T(null);else{C.pipe(et()).subscribe();let v=C.pipe(F(c=>c.getRedirectResult().then(m=>m,()=>null)),g(this.injector),Ie({bufferSize:1,refCount:!1})),J=C.pipe(F(c=>new L(m=>({unsubscribe:s.runOutsideAngular(()=>c.onAuthStateChanged(y=>m.next(y),y=>m.error(y),()=>m.complete()))})))),H=C.pipe(F(c=>new L(m=>({unsubscribe:s.runOutsideAngular(()=>c.onIdTokenChanged(y=>m.next(y),y=>m.error(y),()=>m.complete()))}))));this.authState=v.pipe(ve(J),Y(a.outsideAngular),V(a.insideAngular)),this.user=v.pipe(ve(H),Y(a.outsideAngular),V(a.insideAngular)),this.idToken=this.user.pipe(F(c=>c?b(c.getIdToken()):T(null))),this.idTokenResult=this.user.pipe(F(c=>c?b(c.getIdTokenResult()):T(null))),this.credential=Ye(v,Z,this.authState.pipe(z(c=>!c))).pipe(u(c=>c?.user?c:null),Y(a.outsideAngular),V(a.insideAngular))}return er(this,C,s,{spy:{apply:(v,J,H)=>{(v.startsWith("signIn")||v.startsWith("createUser"))&&H.then(c=>Z.next(c))}}})}static \u0275fac=function(n){return new(n||r)(l(le),l(de,8),l(G),l(D),l(ne),l(Pe,8),l(xe,8),l(Re,8),l(Me,8),l(qe,8),l(ke,8),l(ie,8))};static \u0275prov=q({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})();var br="@firebase/firestore-compat",Tr="0.3.53";function ze(r,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new U("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function nr(){if(typeof Uint8Array>"u")throw new U("unimplemented","Uint8Arrays are not available in this environment.")}function ir(){if(!ct())throw new U("unimplemented","Blobs are unavailable in Firestore in this environment.")}var he=class r{constructor(e){this._delegate=e}static fromBase64String(e){return ir(),new r(oe.fromBase64String(e))}static fromUint8Array(e){return nr(),new r(oe.fromUint8Array(e))}toBase64(){return ir(),this._delegate.toBase64()}toUint8Array(){return nr(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Be(r){return Cr(r,["next","error","complete"])}function Cr(r,e){if(typeof r!="object"||r===null)return!1;let t=r;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var $e=class{enableIndexedDbPersistence(e,t){return yt(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return _t(e._delegate)}clearIndexedDbPersistence(e){return wt(e._delegate)}},fe=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof ut||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&nt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){ht(this._delegate,e,t,n)}enableNetwork(){return vt(this._delegate)}disableNetwork(){return At(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,at("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return It(this._delegate)}onSnapshotsInSync(e){return Vt(this._delegate,e)}get app(){if(!this._appCompat)throw new U("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new W(this,Se(this._delegate,e))}catch(t){throw f(t,"collection()","Firestore.collection()")}}doc(e){try{return new S(this,se(this._delegate,e))}catch(t){throw f(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new R(this,ft(this._delegate,e))}catch(t){throw f(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Qt(this._delegate,t=>e(new pe(this,t)))}batch(){return mt(this._delegate),new ge(new Gt(this._delegate,e=>zt(this._delegate,e)))}loadBundle(e){return Et(this._delegate,e)}namedQuery(e){return St(this._delegate,e).then(t=>t?new R(this,t):null)}},B=class extends xt{constructor(e){super(),this.firestore=e}convertBytes(e){return new he(new oe(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return S.forKey(t,this.firestore,null)}};function Fr(r){rt(r)}var pe=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new B(e)}get(e){let t=O(e);return this._delegate.get(t).then(n=>new P(this._firestore,new ae(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let i=O(e);return n?(ze("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=O(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=O(e);return this._delegate.delete(t),this}},ge=class{constructor(e){this._delegate=e}set(e,t,n){let i=O(e);return n?(ze("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=O(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=O(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},$=class r{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new Rt(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new x(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=r.INSTANCES,i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new r(e,new B(e),t),i.set(t,s)),s}};$.INSTANCES=new WeakMap;var S=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new B(e)}static forPath(e,t,n){if(e.length%2!==0)throw new U("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new r(t,new Q(t._delegate,n,new ot(e)))}static forKey(e,t,n){return new r(t,new Q(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new W(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new W(this.firestore,Se(this._delegate,e))}catch(t){throw f(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Ee(e),e instanceof Q?Ne(this._delegate,e):!1}set(e,t){t=ze("DocumentReference.set",t);try{return t?Fe(this._delegate,e,t):Fe(this._delegate,e)}catch(n){throw f(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?je(this._delegate,e):je(this._delegate,e,t,...n)}catch(i){throw f(i,"updateDoc()","DocumentReference.update()")}}delete(){return Wt(this._delegate)}onSnapshot(...e){let t=sr(e),n=or(e,i=>new P(this.firestore,new ae(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return De(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=qt(this._delegate):e?.source==="server"?t=kt(this._delegate):t=Mt(this._delegate),t.then(n=>new P(this.firestore,new ae(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter($.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function f(r,e,t){return r.message=r.message.replace(e,t),r}function sr(r){for(let e of r)if(typeof e=="object"&&!Be(e))return e;return{}}function or(r,e){var t,n;let i;return Be(r[0])?i=r[0]:Be(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var P=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new S(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Ce(this._delegate,e._delegate)}},x=class extends P{data(e){let t=this._delegate.data(e);return this._delegate._converter||it(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},R=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new B(e)}where(e,t,n){try{return new r(this.firestore,N(this._delegate,bt(e,t,n)))}catch(i){throw f(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new r(this.firestore,N(this._delegate,Tt(e,t)))}catch(n){throw f(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new r(this.firestore,N(this._delegate,Ct(e)))}catch(t){throw f(t,"limit()","Query.limit()")}}limitToLast(e){try{return new r(this.firestore,N(this._delegate,Ft(e)))}catch(t){throw f(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new r(this.firestore,N(this._delegate,jt(...e)))}catch(t){throw f(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new r(this.firestore,N(this._delegate,Dt(...e)))}catch(t){throw f(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new r(this.firestore,N(this._delegate,Ot(...e)))}catch(t){throw f(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new r(this.firestore,N(this._delegate,Pt(...e)))}catch(t){throw f(t,"endAt()","Query.endAt()")}}isEqual(e){return pt(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=Bt(this._delegate):e?.source==="server"?t=$t(this._delegate):t=Ut(this._delegate),t.then(n=>new K(this.firestore,new Te(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=sr(e),n=or(e,i=>new K(this.firestore,new Te(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return De(this._delegate,t,n)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter($.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},We=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new x(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},K=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new R(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new x(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new We(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new x(this._firestore,n))})}isEqual(e){return Ce(this._delegate,e._delegate)}},W=class r extends R{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new S(this.firestore,e):null}doc(e){try{return e===void 0?new S(this.firestore,se(this._delegate)):new S(this.firestore,se(this._delegate,e))}catch(t){throw f(t,"doc()","CollectionReference.doc()")}}add(e){return Lt(this._delegate,e).then(t=>new S(this.firestore,t))}isEqual(e){return Ne(this._delegate,e._delegate)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter($.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function O(r){return lt(r,Q)}var Le=class r{constructor(...e){this._delegate=new be(...e)}static documentId(){return new r(st.keyField().canonicalString())}isEqual(e){return e=Ee(e),e instanceof be?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Ve=class r{static serverTimestamp(){let e=Zt();return e._methodName="FieldValue.serverTimestamp",new r(e)}static delete(){let e=Kt();return e._methodName="FieldValue.delete",new r(e)}static arrayUnion(...e){let t=Jt(...e);return t._methodName="FieldValue.arrayUnion",new r(t)}static arrayRemove(...e){let t=Ht(...e);return t._methodName="FieldValue.arrayRemove",new r(t)}static increment(e){let t=Yt(e);return t._methodName="FieldValue.increment",new r(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}};var jr={Firestore:fe,GeoPoint:Nt,Timestamp:dt,Blob:he,Transaction:pe,WriteBatch:ge,DocumentReference:S,DocumentSnapshot:P,Query:R,QueryDocumentSnapshot:x,QuerySnapshot:K,CollectionReference:W,FieldPath:Le,FieldValue:Ve,setLogLevel:Fr,CACHE_SIZE_UNLIMITED:gt};function Dr(r,e){r.INTERNAL.registerComponent(new tt("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},jr)))}function Or(r){Dr(r,(e,t)=>new fe(e,t,new $e)),r.registerVersion(br,Tr)}Or(E);function Pr(r,e=He){return new L(t=>{let n;return e!=null?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function ar(r,e){return Pr(r,e)}function xr(r,e){return ar(r,e).pipe(te(void 0),X(),u(t=>{let[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Ke(r,e){return ar(r,e).pipe(u(t=>({payload:t,type:"query"})))}var me=class{ref;afs;injector=j(k);constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:i,query:s}=cr(n,t);return new _e(i,s,this.afs)}snapshotChanges(){return xr(this.ref,this.afs.schedulers.outsideAngular).pipe(g(this.injector))}valueChanges(e={}){return this.snapshotChanges().pipe(u(({payload:t})=>e.idField?A(_({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return b(this.ref.get(e)).pipe(g(this.injector))}};function ye(r,e){return Ke(r,e).pipe(te(void 0),X(),u(t=>{let[n,i]=t,s=i.payload.docChanges(),a=s.map(o=>({type:o.type,payload:o}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((o,d)=>{let p=s.find(I=>I.doc.ref.isEqual(o.ref)),w=n?.payload.docs.find(I=>I.ref.isEqual(o.ref));p&&JSON.stringify(p.doc.metadata)===JSON.stringify(o.metadata)||!p&&w&&JSON.stringify(w.metadata)===JSON.stringify(o.metadata)||a.push({type:"modified",payload:{oldIndex:d,newIndex:d,type:"modified",doc:o}})}),a}))}function lr(r,e,t){return ye(r,t).pipe(ee((n,i)=>Rr(n,i.map(s=>s.payload),e),[]),Xe(),u(n=>n.map(i=>({type:i.type,payload:i}))))}function Rr(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=Mr(r,n))}),r}function Ge(r,e,t,...n){let i=r.slice();return i.splice(e,t,...n),i}function Mr(r,e){switch(e.type){case"added":if(!r[e.newIndex]?.doc.ref.isEqual(e.doc.ref))return Ge(r,e.newIndex,0,e);break;case"modified":if(r[e.oldIndex]==null||r[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Ge(r,e.newIndex,1,e);break;case"removed":if(r[e.oldIndex]?.doc.ref.isEqual(e.doc.ref))return Ge(r,e.oldIndex,1);break}return r}function dr(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var _e=class{ref;query;afs;injector=j(k);constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=ye(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(u(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(te(void 0),X(),z(([n,i])=>i.length>0||!n),u(([,n])=>n),g(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(ee((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=dr(e);return lr(this.query,t,this.afs.schedulers.outsideAngular).pipe(g(this.injector))}valueChanges(e={}){return Ke(this.query,this.afs.schedulers.outsideAngular).pipe(u(t=>t.payload.docs.map(n=>e.idField?A(_({},n.data()),{[e.idField]:n.id}):n.data())),g(this.injector))}get(e){return b(this.query.get(e)).pipe(g(this.injector))}add(e){return this.ref.add(e)}doc(e){return new me(this.ref.doc(e),this.afs)}},Qe=class{query;afs;injector=j(k);constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?ye(this.query,this.afs.schedulers.outsideAngular).pipe(g(this.injector)):ye(this.query,this.afs.schedulers.outsideAngular).pipe(u(t=>t.filter(n=>e.indexOf(n.type)>-1)),z(t=>t.length>0),g(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(ee((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=dr(e);return lr(this.query,t,this.afs.schedulers.outsideAngular).pipe(g(this.injector))}valueChanges(e={}){return Ke(this.query,this.afs.schedulers.outsideAngular).pipe(u(n=>n.payload.docs.map(i=>e.idField?_({[e.idField]:i.id},i.data()):i.data())),g(this.injector))}get(e){return b(this.query.get(e)).pipe(g(this.injector))}},qr=new h("angularfire2.enableFirestorePersistence"),kr=new h("angularfire2.firestore.persistenceSettings"),Ur=new h("angularfire2.firestore.settings"),Br=new h("angularfire2.firestore.use-emulator");function cr(r,e=t=>t){return{query:e(r),ref:r}}var ur=(()=>{class r{schedulers;firestore;persistenceEnabled$;ngZone=j(D);constructor(t,n,i,s,a,o,d,p,w,I,we,Ze,Z,C,v,J,H){this.schedulers=d;let c=ce(t,o,n),m=w;I&&Ue(c,o,we,Z,C,v,Ze,J),[this.firestore,this.persistenceEnabled$]=ue(`${c.name}.firestore`,"AngularFirestore",c.name,()=>{let y=o.runOutsideAngular(()=>c.firestore());if(s&&y.settings(s),m&&y.useEmulator(...m),i&&!re(a)){let fr=()=>{try{return b(y.enablePersistence(p||void 0).then(()=>!0,()=>!1))}catch(pr){return typeof console<"u"&&console.warn(pr),T(!1)}};return[y,o.runOutsideAngular(fr)]}else return[y,T(!1)]},[s,m,i])}collection(t,n){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:a}=cr(i,n),o=this.ngZone.run(()=>s);return new _e(o,a,this)}collectionGroup(t,n){let i=n||(a=>a),s=this.firestore.collectionGroup(t);return new Qe(i(s),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let i=this.ngZone.run(()=>n);return new me(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(l(le),l(de,8),l(qr,8),l(Ur,8),l(G),l(D),l(ne),l(kr,8),l(Br,8),l(rr,8),l(Pe,8),l(xe,8),l(Re,8),l(Me,8),l(qe,8),l(ke,8),l(ie,8))};static \u0275prov=q({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})();var M=class M{constructor(e){this.firestore=e;this.nodesCollection=this.firestore.collection("tree-nodes")}getNodes(){return this.nodesCollection.snapshotChanges().pipe(u(e=>e.map(t=>{let n=t.payload.doc.data(),i=t.payload.doc.id;return A(_({},n),{id:i})})))}getNode(e){return this.nodesCollection.doc(e).valueChanges().pipe(u(t=>t?A(_({},t),{id:e}):void 0))}addNode(e){let t=A(_({},e),{createdAt:new Date,updatedAt:new Date});return this.nodesCollection.add(t).then()}updateNode(e,t){return this.nodesCollection.doc(e).update(A(_({},t),{updatedAt:new Date}))}deleteNode(e){return this.nodesCollection.doc(e).delete()}getChildren(e){return this.firestore.collection("tree-nodes",t=>t.where("parentKey","==",e)).snapshotChanges().pipe(u(t=>t.map(n=>{let i=n.payload.doc.data(),s=n.payload.doc.id;return A(_({},i),{id:s})})))}buildTree(e){let t=new Map,n=[];return e.forEach(i=>{t.set(i.key,A(_({},i),{children:[]}))}),e.forEach(i=>{let s=t.get(i.key);if(s)if(i.parentKey&&t.has(i.parentKey)){let a=t.get(i.parentKey);a&&a.children&&a.children.push(s)}else n.push(s)}),n}};M.\u0275fac=function(t){return new(t||M)(l(ur))},M.\u0275prov=q({token:M,factory:M.\u0275fac,providedIn:"root"});var hr=M;export{hr as a};
