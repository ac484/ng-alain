import{a as b,b as A,g as u,i as n,j as g,k as m,m as h,o as v,p as C,q as L}from"./chunk-KNP3MJAK.js";import{g as R}from"./chunk-6LCMXABZ.js";import{B as a,oa as f,ta as p,u as o,v as U}from"./chunk-IDL4MXQM.js";import{a as c,b as y}from"./chunk-57BLH6QZ.js";var l=class l{constructor(){this.firestore=p(A);this.aclSrv=p(R);this.userACL$=U(null)}loadUserACL(e){let r=n(this.firestore,"acl_users",e);return o(g(r)).pipe(a(s=>s.exists()?s.data():null))}applyACL(e){this.aclSrv.set({role:e.roles,ability:e.permissions})}updateUserACL(e,r,s){let t=n(this.firestore,"acl_users",e);return o(v(t,{uid:e,roles:r,permissions:s,isActive:!0,updatedAt:new Date},{merge:!0}))}clearACL(){this.aclSrv.setFull(!1),this.aclSrv.set({role:[],ability:[]})}getRoles(){let e=u(this.firestore,"acl_roles"),r=h(e,L("isActive","==",!0));return o(m(r)).pipe(a(s=>s.docs.map(t=>c({id:t.id},t.data()))))}getPermissions(){let e=u(this.firestore,"acl_permissions"),r=h(e,L("isActive","==",!0));return o(m(r)).pipe(a(s=>s.docs.map(t=>c({id:t.id},t.data()))))}can(e){return this.aclSrv.can(e)}hasRole(e){return this.aclSrv.can(e)}get data(){return this.aclSrv.data}};l.\u0275fac=function(r){return new(r||l)},l.\u0275prov=f({token:l,factory:l.\u0275fac,providedIn:"root"});var P=l;var d=class d{constructor(){this.firestore=p(A)}saveUser(e,r){let s=n(this.firestore,"acl_users",e.uid),t=b(),i={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,emailVerified:e.emailVerified,roles:["user"],permissions:["dashboard"],lastLoginAt:t,updatedAt:t,loginMethod:r,isActive:!0};return o(v(s,i,{merge:!0}))}getUserProfile(e){let r=n(this.firestore,"acl_users",e);return o(g(r)).pipe(a(s=>{if(s.exists()){let t=s.data();return{uid:t.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,emailVerified:t.emailVerified,role:t.roles?.[0]||"user",permissions:t.permissions||["dashboard"],createdAt:t.createdAt,updatedAt:t.updatedAt,lastLoginAt:t.lastLoginAt,loginMethod:t.loginMethod,isActive:t.isActive}}return null}))}getAllUsers(){let e=u(this.firestore,"acl_users");return o(m(e)).pipe(a(r=>{let s=[];return r.forEach(t=>{let i=t.data();s.push({uid:i.uid,email:i.email,displayName:i.displayName,photoURL:i.photoURL,emailVerified:i.emailVerified,role:i.roles?.[0]||"user",permissions:i.permissions||["dashboard"],createdAt:i.createdAt,updatedAt:i.updatedAt,lastLoginAt:i.lastLoginAt,loginMethod:i.loginMethod,isActive:i.isActive})}),s}))}updateUserProfile(e,r){let s=n(this.firestore,"acl_users",e),t=y(c({},r),{updatedAt:b()});return o(C(s,t))}};d.\u0275fac=function(r){return new(r||d)},d.\u0275prov=f({token:d,factory:d.\u0275fac,providedIn:"root"});var O=d;export{P as a,O as b};
