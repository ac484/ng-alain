import{b as oe}from"./chunk-FGZ6ITCH.js";import{a as re,c as ae,d as le,f as se,g as ce}from"./chunk-JN23DAPO.js";import{a as te,b as ne,c as ie}from"./chunk-UYXFCDCY.js";import"./chunk-LZHHB3SB.js";import"./chunk-SIZM2XL7.js";import"./chunk-2DVOMO4J.js";import"./chunk-MFG6XL3Q.js";import"./chunk-OETAK3GR.js";import"./chunk-DNAKBF6E.js";import"./chunk-GXVUYNK4.js";import"./chunk-BQVMEIZ5.js";import{d as J,e as Q,f as X,j as Y,k as Z,l as ee}from"./chunk-EJPHIAHG.js";import{b as W}from"./chunk-ZEZPGFWG.js";import"./chunk-PUGKNFED.js";import"./chunk-FKZEB7ER.js";import{d as j}from"./chunk-3UXJQ3KI.js";import{m as I}from"./chunk-EXZNONST.js";import{a as G,c as K}from"./chunk-FWGM4PSC.js";import"./chunk-L6VFZVUC.js";import{f as q,g as H}from"./chunk-5G6BXQUB.js";import{a as A,b as B,d as $,e as U}from"./chunk-L3XAXJTY.js";import"./chunk-SUWO6CW6.js";import"./chunk-PV63DGP2.js";import"./chunk-EOTHDIY5.js";import"./chunk-6W2MZKTD.js";import"./chunk-TWOZTKVL.js";import{j as V}from"./chunk-27W33B5M.js";import"./chunk-VF6IKWU5.js";import{Cb as E,Da as S,Dc as k,Eb as D,Fd as O,Jb as f,Jh as P,Kb as a,Kh as L,Lb as r,Lc as h,Mb as s,Qc as M,Tb as _,Wb as g,Za as m,Zb as p,hc as C,jb as b,mc as l,nc as F,oa as y,oc as T,pb as R,ua as u,va as d}from"./chunk-BJGZKRME.js";import"./chunk-PMZOYKO3.js";import{i as N}from"./chunk-57BLH6QZ.js";var de=o=>[o];function fe(o,t){if(o&1){let e=_();a(0,"nz-result",11)(1,"div",13)(2,"button",7),g("click",function(){u(e);let n=p();return d(n.refresh())}),l(3,"\u91CD\u8A66"),r()()()}if(o&2){let e=p();f("nzSubTitle",e.error())}}function ge(o,t){if(o&1&&(a(0,"nz-list-item",14)(1,"nz-list-item-meta")(2,"nz-list-item-meta-title")(3,"span",15),l(4),r()(),a(5,"nz-list-item-meta-description")(6,"div",16)(7,"span",17),s(8,"span",18),l(9),r(),a(10,"span",17),s(11,"span",19),l(12),r(),a(13,"span",17),s(14,"span",20),l(15),r()()()()()),o&2){let e=t.$implicit,i=p(2),n=C(16);f("nzActions",k(6,de,n)),m(4),F(e.fileName),m(4),f("nzType",e.fileType==="pdf"?"file-pdf":"file-text"),m(),T(" ",e.fileType.toUpperCase()," "),m(3),T(" \u6A94\u6848\u5927\u5C0F\uFF1A",i.formatFileSize(e.fileSize)," "),m(3),T(" \u5EFA\u7ACB\u6642\u9593\uFF1A",i.formatDate(e.createdAt)," ")}}function _e(o,t){if(o&1&&(a(0,"nz-list",12),R(1,ge,16,8,"ng-template",null,3,h),r()),o&2){let e=C(2),i=p(),n=C(14);f("nzDataSource",i.scanResults())("nzRenderItem",e)("nzItemLayout","horizontal")("nzLoading",i.isLoading())("nzNoResult",n)}}function xe(o,t){if(o&1){let e=_();a(0,"button",21),g("click",function(){u(e);let n=p();return d(n.goToScan())}),s(1,"span",8),l(2," \u6383\u63CF "),r()}}function ze(o,t){if(o&1){let e=_();a(0,"nz-empty",22)(1,"button",7),g("click",function(){u(e);let n=p();return d(n.goToScan())}),s(2,"span",8),l(3," \u958B\u59CB\u6383\u63CF "),r()()}}function Ce(o,t){if(o&1){let e=_();a(0,"button",21),g("click",function(){let n=u(e).$implicit,c=p();return d(c.downloadFile(n))}),s(1,"span",18),l(2," \u4E0B\u8F09 "),r()}if(o&2){let e=t.$implicit;m(),f("nzType",e.fileType==="pdf"?"file-pdf":"file-text")}}var x=class x{constructor(){this.storage=y(re);this.router=y(I);this.message=y(j);this.isLoading=S(!0);this.error=S("");this.scanResults=S([]);this.hasResults=M(()=>this.scanResults().length>0);this.hasError=M(()=>this.error()!=="")}ngOnInit(){this.loadScanResults()}loadScanResults(){return N(this,null,function*(){this.isLoading.set(!0),this.error.set("");try{let t=ce(this.storage,"pdf-uploads"),e=yield se(t),i=[];for(let n of e.items){let c=yield le(n),pe=yield ae(n),z=c.name,ue=z.endsWith(".pdf")?"pdf":z.endsWith(".txt")?"txt":"pdf",v=z.match(/(\d+)_pages-(\d+)-(\d+)\.(pdf|txt)$/),w=new Date;v&&(w=new Date(parseInt(v[1]))),i.push({id:z,fileName:z,fileType:ue,createdAt:w,fileSize:c.size,url:pe})}i.sort((n,c)=>c.createdAt.getTime()-n.createdAt.getTime()),this.scanResults.set(i)}catch(t){console.error("Error loading scan results:",t),this.error.set("\u8F09\u5165\u6383\u63CF\u7D50\u679C\u5931\u6557"),this.scanResults.set([])}finally{this.isLoading.set(!1)}})}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,i=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,n)).toFixed(2))+" "+i[n]}formatDate(t){return new Date(t).toLocaleString()}viewResult(t){t.id&&this.router.navigate(["/tree/scan-result",t.id])}downloadFile(t){let e=document.createElement("a");e.href=t.url,e.download=t.fileName,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),this.message.success(`${t.fileType.toUpperCase()} \u6587\u4EF6\u5DF2\u4E0B\u8F09`)}goToScan(){this.router.navigate(["/tree/pdf-scan"])}refresh(){this.loadScanResults()}};x.\u0275fac=function(e){return new(e||x)},x.\u0275cmp=b({type:x,selectors:[["app-scan-result"]],decls:17,vars:2,consts:[["extraTemplate",""],["emptyTemplate",""],["downloadAction",""],["item",""],["nzTitle","\u6383\u63CF\u7D50\u679C\u5217\u8868",3,"nzExtra"],[1,"results-container"],[1,"header-actions"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","scan"],["nz-button","",3,"click"],["nz-icon","","nzType","reload"],["nzStatus","error","nzTitle","\u8F09\u5165\u5931\u6557",3,"nzSubTitle"],[3,"nzDataSource","nzRenderItem","nzItemLayout","nzLoading","nzNoResult"],["nz-result-extra",""],[3,"nzActions"],[1,"file-name"],[1,"file-info"],[1,"info-item"],["nz-icon","",3,"nzType"],["nz-icon","","nzType","file"],["nz-icon","","nzType","clock-circle"],["nz-button","","nzType","link",3,"click"],["nzNotFoundImage","simple","nzNotFoundContent","\u76EE\u524D\u6C92\u6709\u6383\u63CF\u7D50\u679C"]],template:function(e,i){if(e&1){let n=_();a(0,"nz-card",4)(1,"div",5)(2,"div",6)(3,"button",7),g("click",function(){return u(n),d(i.goToScan())}),s(4,"span",8),l(5," \u65B0\u589E\u6383\u63CF "),r(),a(6,"button",9),g("click",function(){return u(n),d(i.refresh())}),s(7,"span",10),l(8," \u91CD\u65B0\u6574\u7406 "),r()(),E(9,fe,4,1,"nz-result",11)(10,_e,3,5,"nz-list",12),r()(),R(11,xe,3,0,"ng-template",null,0,h)(13,ze,4,0,"ng-template",null,1,h)(15,Ce,3,1,"ng-template",null,2,h)}if(e&2){let n=C(12);f("nzExtra",n),m(9),D(i.hasError()?9:10)}},dependencies:[O,H,q,U,$,A,B,L,P,ie,ne,te,oe,W,V,ee,Y,Z,X,J,Q,K,G],styles:[".results-container[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto}.header-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px;justify-content:flex-end}.file-name[_ngcontent-%COMP%]{color:#1890ff;cursor:pointer;font-weight:500}.file-name[_ngcontent-%COMP%]:hover{color:#40a9ff;text-decoration:underline}.file-info[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;margin-top:8px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:#666;font-size:14px}.info-item[_ngcontent-%COMP%]   span[nz-icon][_ngcontent-%COMP%]{color:#999}[_nghost-%COMP%]     .ant-list-item{padding:16px;border-radius:6px;margin-bottom:8px;border:1px solid #f0f0f0;transition:all .3s}[_nghost-%COMP%]     .ant-list-item:hover{border-color:#d9d9d9;box-shadow:0 2px 8px #0000001a}[_nghost-%COMP%]     .ant-list-item-meta-title{margin-bottom:8px}[_nghost-%COMP%]     .ant-list-item-action{margin-left:16px}@media (max-width: 768px){.results-container[_ngcontent-%COMP%]{max-width:100%;padding:0 16px}.header-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.file-info[_ngcontent-%COMP%]{flex-direction:column;gap:8px}[_nghost-%COMP%]     .ant-list-item{flex-direction:column;align-items:stretch}[_nghost-%COMP%]     .ant-list-item .ant-list-item-action{margin-left:0;margin-top:12px;justify-content:flex-start}}"],changeDetection:0});var me=x;export{me as ScanResultComponent};
