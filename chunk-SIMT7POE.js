import{a as se,b as ze,d as Fe,e as fe,f as ve,g as Ce,h as ge}from"./chunk-ZN4SMX4K.js";import{d as j}from"./chunk-BPXOC4B3.js";import{c as ae,h as ue}from"./chunk-P3L244CT.js";import{a as ce,b as de}from"./chunk-JAVLZK5L.js";import{f as me,k as le,p as pe}from"./chunk-WHRI2AXL.js";import{f as Z,i as ee,k as te,m as ne,n as ie,o as re,q as oe}from"./chunk-HDPTZYQ7.js";import{e as K,f as Q}from"./chunk-EO7VZDHM.js";import"./chunk-IFPPFMNI.js";import"./chunk-4O5NHTAF.js";import"./chunk-E2CCMZAM.js";import{d as U,e as X,f as Y}from"./chunk-F4IBXQAQ.js";import"./chunk-754CTGRH.js";import"./chunk-MPLSKRO5.js";import{i as V,m as _}from"./chunk-HNEBRDLY.js";import"./chunk-45FQ6IMJ.js";import{B as H,F as L,H as J,l as k,m as p,o as q,p as G,v as $,y as W}from"./chunk-53SO5WPT.js";import{Ac as h,Fc as F,Hc as b,Ib as o,Ic as f,Jb as n,Ji as he,Kb as e,Ki as Se,Lb as s,Od as M,Sb as A,Vb as g,Za as t,bi as w,cb as c,gc as B,ib as N,ii as R,ki as O,lc as i,li as P,mc as z,nc as m,ob as D,qd as y,vd as x,xa as v,ya as C,yd as I,zd as T}from"./chunk-W6OF5JYC.js";import"./chunk-57BLH6QZ.js";var Ne=()=>[],De=()=>({minRows:3,maxRows:5});function Ae(S,u){if(S&1&&(n(0,"tr")(1,"td")(2,"nz-tag",25),i(3),e()(),n(4,"td"),i(5),e(),n(6,"td"),i(7),F(8,"currency"),e(),n(9,"td"),i(10),e(),n(11,"td"),i(12),F(13,"date"),e()()),S&2){let a=u.$implicit;t(2),o("nzColor",a.type==="\u8FFD\u52A0"?"success":"error"),t(),m(" ",a.type," "),t(2),z(a.description),t(2),z(f(8,6,a.amount,"TWD","symbol","1.0-0")),t(3),z(a.version),t(2),z(b(13,11,a.date,"yyyy-MM-dd"))}}var d=class d{constructor(u,a,r,l,E){this.fb=u;this.route=a;this.router=r;this.message=l;this.http=E;this.changeForm=this.fb.group({type:["",[p.required]],description:["",[p.required]],amount:[null,[p.required,p.min(0)]],date:[null,[p.required]],version:["",[p.required]]})}ngOnInit(){this.contractId=this.route.snapshot.paramMap.get("id")||void 0,this.contractId&&this.loadContractData()}loadContractData(){this.http.get(`/contract/${this.contractId}`).subscribe(u=>{this.contract=u,this.changeForm.patchValue({version:this.getNextVersion(u.changeVersion)})})}getNextVersion(u){let a=u.split("."),r=parseInt(a[0]),l=parseInt(a[1])+1;return`${r}.${l}`}onSubmit(){if(this.changeForm.valid){let u=this.changeForm.value;this.http.post(`/contract/${this.contractId}/change`,u).subscribe(()=>{this.message.success("\u5408\u7D04\u8B8A\u66F4\u63D0\u4EA4\u6210\u529F"),this.loadContractData(),this.changeForm.reset(),this.changeForm.patchValue({version:this.getNextVersion(this.contract.changeVersion)})})}else Object.values(this.changeForm.controls).forEach(u=>{u.invalid&&u.markAsTouched()})}onCancel(){this.router.navigate(["/contract/detail",this.contractId])}};d.\u0275fac=function(a){return new(a||d)(c(L),c(V),c(_),c(j),c(M))},d.\u0275cmp=N({type:d,selectors:[["app-contract-change"]],decls:82,vars:39,consts:[["changeTable",""],["title","\u5408\u7D04\u8FFD\u52A0\u8FFD\u6E1B"],["title","\u5408\u7D04\u8CC7\u8A0A",2,"margin-bottom","16px",3,"nzSize"],[2,"display","grid","grid-template-columns","1fr 1fr","gap","16px"],["title","\u8B8A\u66F4\u6B77\u53F2",2,"margin-bottom","16px"],[3,"nzData","nzPageSize"],[4,"ngFor","ngForOf"],["title","\u65B0\u589E\u8B8A\u66F4"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","",3,"nzSpan"],["nzErrorTip","\u8ACB\u9078\u64C7\u8B8A\u66F4\u985E\u578B",3,"nzSpan"],["formControlName","type","placeholder","\u8ACB\u9078\u64C7\u8B8A\u66F4\u985E\u578B"],["nzValue","\u8FFD\u52A0","nzLabel","\u8FFD\u52A0"],["nzValue","\u8FFD\u6E1B","nzLabel","\u8FFD\u6E1B"],["nzErrorTip","\u8ACB\u8F38\u5165\u8B8A\u66F4\u63CF\u8FF0",3,"nzSpan"],["nz-input","","formControlName","description","placeholder","\u8ACB\u8F38\u5165\u8B8A\u66F4\u63CF\u8FF0",3,"nzAutosize"],["nzErrorTip","\u8ACB\u8F38\u5165\u8B8A\u66F4\u91D1\u984D",3,"nzSpan"],["formControlName","amount","placeholder","\u8ACB\u8F38\u5165\u8B8A\u66F4\u91D1\u984D",2,"width","100%",3,"nzMin","nzStep"],["nzErrorTip","\u8ACB\u9078\u64C7\u8B8A\u66F4\u65E5\u671F",3,"nzSpan"],["formControlName","date","placeholder","\u8ACB\u9078\u64C7\u8B8A\u66F4\u65E5\u671F",2,"width","100%"],["nzErrorTip","\u8ACB\u8F38\u5165\u65B0\u7248\u672C\u865F",3,"nzSpan"],["nz-input","","formControlName","version","placeholder","\u8ACB\u8F38\u5165\u65B0\u7248\u672C\u865F"],[3,"nzOffset","nzSpan"],["nz-button","","nzType","primary","type","submit",3,"disabled"],["nz-button","",2,"margin-left","8px",3,"click"],[3,"nzColor"]],template:function(a,r){if(a&1){let l=A();n(0,"nz-card",1)(1,"nz-card",2)(2,"div",3)(3,"div")(4,"strong"),i(5,"\u5408\u7D04\u6A19\u984C\uFF1A"),e(),i(6),e(),n(7,"div")(8,"strong"),i(9,"\u5BA2\u6236\uFF1A"),e(),i(10),e(),n(11,"div")(12,"strong"),i(13,"\u539F\u59CB\u91D1\u984D\uFF1A"),e(),i(14),F(15,"currency"),e(),n(16,"div")(17,"strong"),i(18,"\u73FE\u884C\u91D1\u984D\uFF1A"),e(),i(19),F(20,"currency"),e(),n(21,"div")(22,"strong"),i(23,"\u7248\u672C\u865F\uFF1A"),e(),i(24),e(),n(25,"div")(26,"strong"),i(27,"\u8B8A\u66F4\u7248\u672C\u865F\uFF1A"),e(),i(28),e()()(),n(29,"nz-card",4)(30,"nz-table",5,0)(32,"thead")(33,"tr")(34,"th"),i(35,"\u985E\u578B"),e(),n(36,"th"),i(37,"\u63CF\u8FF0"),e(),n(38,"th"),i(39,"\u91D1\u984D"),e(),n(40,"th"),i(41,"\u7248\u672C"),e(),n(42,"th"),i(43,"\u65E5\u671F"),e()()(),n(44,"tbody"),D(45,Ae,14,14,"tr",6),e()()(),n(46,"nz-card",7)(47,"form",8),g("ngSubmit",function(){return v(l),C(r.onSubmit())}),n(48,"nz-form-item")(49,"nz-form-label",9),i(50,"\u8B8A\u66F4\u985E\u578B"),e(),n(51,"nz-form-control",10)(52,"nz-select",11),s(53,"nz-option",12)(54,"nz-option",13),e()()(),n(55,"nz-form-item")(56,"nz-form-label",9),i(57,"\u8B8A\u66F4\u63CF\u8FF0"),e(),n(58,"nz-form-control",14)(59,"textarea",15),i(60,"              "),e()()(),n(61,"nz-form-item")(62,"nz-form-label",9),i(63,"\u8B8A\u66F4\u91D1\u984D"),e(),n(64,"nz-form-control",16),s(65,"nz-input-number",17),e()(),n(66,"nz-form-item")(67,"nz-form-label",9),i(68,"\u8B8A\u66F4\u65E5\u671F"),e(),n(69,"nz-form-control",18),s(70,"nz-date-picker",19),e()(),n(71,"nz-form-item")(72,"nz-form-label",9),i(73,"\u65B0\u7248\u672C\u865F"),e(),n(74,"nz-form-control",20),s(75,"input",21),e()(),n(76,"nz-form-item")(77,"nz-form-control",22)(78,"button",23),i(79," \u63D0\u4EA4\u8B8A\u66F4 "),e(),n(80,"button",24),g("click",function(){return v(l),C(r.onCancel())}),i(81," \u53D6\u6D88 "),e()()()()()()}if(a&2){let l=B(31);t(),o("nzSize","small"),t(5),m("",r.contract==null?null:r.contract.title," "),t(4),m("",r.contract==null?null:r.contract.client," "),t(4),m("",f(15,27,r.contract==null?null:r.contract.originalAmount,"TWD","symbol","1.0-0")," "),t(5),m("",f(20,32,r.contract==null?null:r.contract.currentAmount,"TWD","symbol","1.0-0")," "),t(5),m("",r.contract==null?null:r.contract.version," "),t(4),m("",r.contract==null?null:r.contract.changeVersion," "),t(2),o("nzData",(r.contract==null?null:r.contract.changes)||h(37,Ne))("nzPageSize",5),t(15),o("ngForOf",l.data),t(2),o("formGroup",r.changeForm),t(2),o("nzSpan",4),t(2),o("nzSpan",20),t(5),o("nzSpan",4),t(2),o("nzSpan",20),t(),o("nzAutosize",h(38,De)),t(3),o("nzSpan",4),t(2),o("nzSpan",20),t(),o("nzMin",0)("nzStep",1e3),t(2),o("nzSpan",4),t(2),o("nzSpan",20),t(3),o("nzSpan",4),t(2),o("nzSpan",20),t(3),o("nzOffset",4)("nzSpan",20),t(),o("disabled",!r.changeForm.valid)}},dependencies:[T,y,J,$,k,q,G,W,H,ge,ze,se,fe,Fe,Ce,ve,pe,le,me,de,ce,ue,ae,Y,U,X,P,O,w,R,Se,he,oe,ne,Z,ee,re,te,ie,Q,K,I,x],encapsulation:2});var Ee=d;export{Ee as ContractChangeComponent};
