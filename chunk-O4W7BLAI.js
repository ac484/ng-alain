import{a as B}from"./chunk-IWTLJND4.js";import{B as A,D as k,d as E,e as T,g as x,h as D,n as I,q as V,t as K}from"./chunk-OCWJW6EQ.js";import{h as z}from"./chunk-IQUWA4QL.js";import{d as w}from"./chunk-4SIYTYPC.js";import{Pb as c,Qb as o,Rb as n,Rc as M,Sb as p,Zb as N,ac as f,db as C,dc as h,hc as S,ib as d,ic as F,jc as _,pb as g,sc as s,vb as b,xb as y,ya as m,za as u}from"./chunk-BUZ3SHNN.js";var O=["crudModal"];function R(v,t){if(v&1){let e=N();o(0,"form",1),f("ngSubmit",function(){let i=m(e).$implicit,l=h();return u(l.handleOk(i))}),o(1,"div",2)(2,"div",3)(3,"label"),s(4,"\u6A19\u984C"),n()(),o(5,"div",4),p(6,"input",5),n()(),o(7,"div",2)(8,"div",3)(9,"label"),s(10,"\u7236\u7BC0\u9EDE"),n()(),o(11,"div",4),p(12,"input",6),n()(),o(13,"div",7)(14,"button",8),f("click",function(){let i=m(e).$implicit;return u(i.destroy())}),s(15,"\u53D6\u6D88"),n(),o(16,"button",9),s(17,"\u78BA\u5B9A"),n()()()}if(v&2){let e=h();c("formGroup",e.nodeForm),C(16),c("disabled",!e.nodeForm.valid)}}var a=class a{constructor(t,e,r,i){this.fb=t;this.modal=e;this.message=r;this.crud=i;this.dataChanged=new y;this.isEditMode=!1;this.modalTitle="\u65B0\u589E\u7BC0\u9EDE";this.editNodeId=null;this.nodeForm=this.fb.group({title:["",T.required],parentKey:[""]})}refresh(){}showAddModal(t){this.isEditMode=!1,this.modalTitle="\u65B0\u589E\u7BC0\u9EDE",this.nodeForm.reset({title:"",parentKey:t??""}),this.modal.create({nzTitle:this.modalTitle,nzContent:this.crudModal,nzFooter:null})}showEditModal(t){this.isEditMode=!0,this.modalTitle="\u7DE8\u8F2F\u7BC0\u9EDE",this.editNodeId=t.id,this.nodeForm.reset({title:t.title,parentKey:t.parentKey??""}),this.modal.create({nzTitle:this.modalTitle,nzContent:this.crudModal,nzFooter:null})}handleOk(t){if(this.nodeForm.valid){let e=this.nodeForm.value;if(this.isEditMode&&this.editNodeId)this.crud.updateNode(this.editNodeId,{title:e.title,parentKey:e.parentKey||null}).then(()=>{this.message.success("\u7BC0\u9EDE\u66F4\u65B0\u6210\u529F"),t.destroy(),this.refresh(),this.dataChanged.emit()});else{let r=new Date().toISOString(),i=`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l={id:i,key:i,title:e.title,name:e.title,type:"branch",status:"active",order:0,parentKey:e.parentKey||null,createdAt:r,updatedAt:r};this.crud.addNode(l).then(()=>{this.message.success("\u7BC0\u9EDE\u65B0\u589E\u6210\u529F"),t.destroy(),this.refresh(),this.dataChanged.emit()})}}}deleteNode(t){this.crud.deleteNode(t.id).then(()=>{this.message.success("\u522A\u9664\u6210\u529F"),this.refresh(),this.dataChanged.emit()})}};a.\u0275fac=function(e){return new(e||a)(d(A),d(z),d(w),d(B))},a.\u0275cmp=g({type:a,selectors:[["app-firebase-crud"]],viewQuery:function(e,r){if(e&1&&S(O,7),e&2){let i;F(i=_())&&(r.crudModal=i.first)}},outputs:{dataChanged:"dataChanged"},decls:2,vars:0,consts:[["crudModal",""],[3,"ngSubmit","formGroup"],["nz-form-item",""],["nz-form-label",""],["nz-form-control",""],["nz-input","","formControlName","title"],["nz-input","","formControlName","parentKey"],[2,"text-align","right"],["nz-button","","nzType","default",3,"click"],["nz-button","","nzType","primary","htmlType","submit",3,"disabled"]],template:function(e,r){e&1&&b(0,R,18,2,"ng-template",null,0,M)},dependencies:[k,I,E,x,D,V,K],encapsulation:2});var G=a;export{G as a};
