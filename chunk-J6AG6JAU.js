import{b as u,d as N,e as T,f as c,g as b,h as d,i as g,l as z,n as y,o as v}from"./chunk-FI2MKTH7.js";import{A as m,ma as h,qa as O,u as f}from"./chunk-GM6XQ5SX.js";import{a as s,b as n,i as a}from"./chunk-57BLH6QZ.js";var i=class i{constructor(e){this.firestore=e;this.collectionName="tree-nodes"}getNodes(){let e=c(this.firestore,this.collectionName);return N(e,{idField:"id"})}getNode(e){let t=d(this.firestore,this.collectionName+"/"+e);return f(g(t)).pipe(m(o=>o.exists()?s({id:o.id},o.data()):void 0))}addNode(e){return a(this,null,function*(){let t=c(this.firestore,this.collectionName),o=new Date().toISOString(),r=n(s({},e),{createdAt:o,updatedAt:o});yield T(t,r)})}updateNode(e,t){return a(this,null,function*(){let o=d(this.firestore,this.collectionName+"/"+e);yield y(o,n(s({},t),{updatedAt:new Date().toISOString()}))})}deleteNode(e){return a(this,null,function*(){let t=d(this.firestore,this.collectionName+"/"+e);yield b(t)})}getChildren(e){let t=c(this.firestore,this.collectionName),o=z(t,v("parentKey","==",e));return N(o,{idField:"id"})}buildTree(e){let t=new Map,o=[];return e.forEach(r=>{t.set(r.key,n(s({},r),{children:[]}))}),e.forEach(r=>{let l=t.get(r.key);if(l)if(r.parentKey&&t.has(r.parentKey)){let p=t.get(r.parentKey);p&&p.children&&p.children.push(l)}else o.push(l)}),o}};i.\u0275fac=function(t){return new(t||i)(O(u))},i.\u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"});var w=i;export{w as a};
