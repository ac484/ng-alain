import{B as F,G as bt,a as nt,h as A}from"./chunk-NDYQMC6H.js";import{a as Se,b as pe,c as Ne}from"./chunk-I37CWRWG.js";import"./chunk-VAGS5EVQ.js";import{a as _t,b as St,c as Nt}from"./chunk-Y7P3YCRI.js";import{d as B}from"./chunk-HGFRKFU7.js";import{Aa as H,B as q,Ba as Y,Ca as we,Da as K,Ea as X,Fa as J,Ha as Q,J as lt,L as st,La as Te,Ma as ke,Na as xe,Oa as ft,P as pt,Pa as Ee,Qa as Me,R as mt,Ra as gt,Ta as zt,bb as vt,cb as ht,db as Ct,eb as yt,i as R,j as d,k as V,l as L,m as ot,ma as ct,na as ut,o as at,oa as dt,q as U,s as O,sa as $,ua as W,v as G,xa as j,z as me}from"./chunk-RIIMSFG6.js";import{$b as Qe,Ea as r,Eh as E,Hb as k,Kh as M,La as h,Lb as He,Mb as u,Mh as I,N as he,Nb as S,Nh as P,Ob as z,Qb as Ye,Ra as T,Rb as Ke,Sb as Xe,Tc as be,Vi as se,Xb as Je,Zi as D,_b as Ce,ab as b,ac as Ze,aj as _e,cb as _,da as s,ec as m,fc as c,gc as et,hb as l,hc as x,ia as C,ib as n,ja as y,jb as a,kb as f,od as N,pd as oe,rb as ne,ub as g,vh as ae,wh as le,wi as tt,xb as ee,xi as it,yc as ye,yi as rt}from"./chunk-GSKYGLQZ.js";import{a as Ge,i as w}from"./chunk-57BLH6QZ.js";var ce=class ce{constructor(){this.socialService=s(pe);this.settingsSrv=s(se);this.type=""}ngOnInit(){this.mockModel()}mockModel(){let e={token:"123456789",name:"cipchk",email:`${this.type}@${this.type}.com`,id:1e4,time:+new Date};this.settingsSrv.setUser(Ge(Ge({},this.settingsSrv.user),e)),this.socialService.callback(e)}};ce.\u0275fac=function(t){return new(t||ce)},ce.\u0275cmp=h({type:ce,selectors:[["app-callback"]],inputs:{type:"type"},features:[Ce([pe])],decls:0,vars:0,template:function(t,i){},encapsulation:2});var Ie=ce;var ue=class ue{constructor(){this.tokenService=s(Se);this.settings=s(se);this.router=s(N);this.f=new ot({password:new at("",{nonNullable:!0,validators:[d.required]})})}get user(){return this.settings.user}submit(){this.f.controls.password.markAsDirty(),this.f.controls.password.updateValueAndValidity(),this.f.valid&&(console.log("Valid!"),console.log(this.f.value),this.tokenService.set({token:"123"}),this.router.navigate(["dashboard"]))}};ue.\u0275fac=function(t){return new(t||ue)},ue.\u0275cmp=h({type:ue,selectors:[["passport-lock"]],decls:15,vars:11,consts:[[1,"ant-card","width-lg",2,"margin","0 auto"],[1,"ant-card-body"],[1,"avatar"],["nzIcon","user","nzSize","large",3,"nzSrc"],["nz-form","","role","form",1,"mt-md",3,"ngSubmit","formGroup"],[3,"nzErrorTip"],["nzSuffixIcon","lock"],["type","password","nz-input","","formControlName","password"],["nz-row","","nzType","flex","nzAlign","middle"],["nz-col","",2,"text-align","right",3,"nzOffset","nzSpan"],["nz-button","","nzType","primary",3,"disabled"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),f(3,"nz-avatar",3),a(),n(4,"form",4),g("ngSubmit",function(){return i.submit()}),n(5,"nz-form-item")(6,"nz-form-control",5),m(7,"i18n"),n(8,"nz-input-group",6),f(9,"input",7),a()()(),n(10,"div",8)(11,"div",9)(12,"button",10),u(13),m(14,"i18n"),a()()()()()()),t&2&&(r(3),l("nzSrc",i.user.avatar),r(),l("formGroup",i.f),r(2),l("nzErrorTip",c(7,7,"validation.password.required")),r(5),l("nzOffset",12)("nzSpan",12),r(),l("disabled",!i.f.valid),r(),S(c(14,9,"app.lock")))},dependencies:[q,U,R,V,L,O,G,zt,gt,Q,Y,H,X,K,J,we,P,I,E,M,j,$,W,D],styles:["[_nghost-%COMP%]     .ant-card-body{position:relative;margin-top:80px}[_nghost-%COMP%]     .avatar{position:absolute;top:-20px;left:50%;margin-left:-20px}"]});var Pe=ue;var de=class de{constructor(){this.router=s(N);this.message=s(B);this.firebaseAuth=s(F);this.startupService=s(A);this.loading=!1}loginAnonymously(){return w(this,null,function*(){this.loading=!0;try{(yield this.firebaseAuth.loginAnonymously().toPromise())&&(this.message.success("\u533F\u540D\u767B\u5165\u6210\u529F\uFF01"),this.startupService.load().subscribe(()=>{this.router.navigateByUrl("/")}))}catch(e){console.error("\u533F\u540D\u767B\u5165\u5931\u6557:",e),this.message.error("\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};de.\u0275fac=function(t){return new(t||de)},de.\u0275cmp=h({type:de,selectors:[["app-anonymous-login"]],decls:1,vars:0,consts:[["nzType","user","nzTheme","outline",1,"icon",3,"click"]],template:function(t,i){t&1&&(n(0,"nz-icon",0),g("click",function(){return i.loginAnonymously()}),a())},dependencies:[le,ae],encapsulation:2});var Fe=de;var fe=class fe{constructor(){this.modalRef=s(tt);this.message=s(B);this.firebaseAuth=s(F);this.startupService=s(A);this.router=s(N);this.fb=s(me);this.loading=!1;this.currentTab=0;this.loginForm=this.fb.nonNullable.group({email:["",[d.required,d.email]],password:["",[d.required,d.minLength(6)]]});this.registerForm=this.fb.nonNullable.group({email:["",[d.required,d.email]],password:["",[d.required,d.minLength(6)]],confirmPassword:["",[d.required]]},{validators:this.passwordMatchValidator});this.resetForm=this.fb.nonNullable.group({email:["",[d.required,d.email]]})}switchTab(e){this.currentTab=e.index}passwordMatchValidator(e){let t=e.get("password"),i=e.get("confirmPassword");return t&&i&&t.value!==i.value?{passwordMismatch:!0}:null}login(){return w(this,null,function*(){if(this.loginForm.invalid){this.markFormGroupTouched(this.loginForm);return}this.loading=!0;let{email:e,password:t}=this.loginForm.value;try{let i=yield this.firebaseAuth.loginWithEmail(e,t).toPromise();i&&(this.message.success("\u767B\u5165\u6210\u529F\uFF01"),this.modalRef.close(i),this.startupService.load().subscribe(()=>{this.router.navigateByUrl("/")}))}catch(i){console.error("\u767B\u5165\u5931\u6557:",i),this.message.error(this.getErrorMessage(i.code))}finally{this.loading=!1}})}register(){return w(this,null,function*(){if(this.registerForm.invalid){this.markFormGroupTouched(this.registerForm);return}this.loading=!0;let{email:e,password:t}=this.registerForm.value;try{let i=yield this.firebaseAuth.registerWithEmail(e,t).toPromise();i&&(this.message.success("\u8A3B\u518A\u6210\u529F\uFF01\u8ACB\u6AA2\u67E5\u90F5\u7BB1\u9032\u884C\u9A57\u8B49\u3002"),this.modalRef.close(i),this.startupService.load().subscribe(()=>{this.router.navigateByUrl("/")}))}catch(i){console.error("\u8A3B\u518A\u5931\u6557:",i),this.message.error(this.getErrorMessage(i.code))}finally{this.loading=!1}})}resetPassword(){return w(this,null,function*(){if(this.resetForm.invalid){this.markFormGroupTouched(this.resetForm);return}this.loading=!0;let{email:e}=this.resetForm.value;try{yield this.firebaseAuth.sendPasswordReset(e).toPromise(),this.message.success("\u5BC6\u78BC\u91CD\u7F6E\u90F5\u7BB1\u5DF2\u767C\u9001\uFF0C\u8ACB\u6AA2\u67E5\u90F5\u7BB1\u3002"),this.modalRef.close()}catch(t){console.error("\u767C\u9001\u91CD\u7F6E\u90F5\u7BB1\u5931\u6557:",t),this.message.error(this.getErrorMessage(t.code))}finally{this.loading=!1}})}markFormGroupTouched(e){Object.keys(e.controls).forEach(t=>{let i=e.controls[t];i.markAsTouched(),i.controls&&this.markFormGroupTouched(i)})}getErrorMessage(e){switch(e){case"auth/user-not-found":return"\u7528\u6236\u4E0D\u5B58\u5728";case"auth/wrong-password":return"\u5BC6\u78BC\u932F\u8AA4";case"auth/email-already-in-use":return"\u90F5\u7BB1\u5DF2\u88AB\u4F7F\u7528";case"auth/weak-password":return"\u5BC6\u78BC\u5F37\u5EA6\u592A\u5F31";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u64CD\u4F5C\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};fe.\u0275fac=function(t){return new(t||fe)},fe.\u0275cmp=h({type:fe,selectors:[["app-email-login-modal"]],decls:41,vars:10,consts:[[1,"email-auth-modal"],[3,"nzSelectChange","nzAnimated"],[3,"nzTitle"],["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nzErrorTip","\u8ACB\u8F38\u5165\u5BC6\u78BC"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","\u5BC6\u78BC"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"],["nzErrorTip","\u5BC6\u78BC\u81F3\u5C116\u4F4D"],["nzErrorTip","\u8ACB\u78BA\u8A8D\u5BC6\u78BC"],["nz-input","","type","password","formControlName","confirmPassword","placeholder","\u78BA\u8A8D\u5BC6\u78BC"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"nz-tabs",1),g("nzSelectChange",function(v){return i.switchTab(v)}),n(2,"nz-tab",2)(3,"form",3),g("ngSubmit",function(){return i.login()}),n(4,"nz-form-item")(5,"nz-form-control",4)(6,"nz-input-group",5),f(7,"input",6),a()()(),n(8,"nz-form-item")(9,"nz-form-control",7)(10,"nz-input-group",8),f(11,"input",9),a()()(),n(12,"nz-form-item")(13,"button",10),u(14," \u767B\u5165 "),a()()()(),n(15,"nz-tab",2)(16,"form",3),g("ngSubmit",function(){return i.register()}),n(17,"nz-form-item")(18,"nz-form-control",4)(19,"nz-input-group",5),f(20,"input",6),a()()(),n(21,"nz-form-item")(22,"nz-form-control",11)(23,"nz-input-group",8),f(24,"input",9),a()()(),n(25,"nz-form-item")(26,"nz-form-control",12)(27,"nz-input-group",8),f(28,"input",13),a()()(),n(29,"nz-form-item")(30,"button",10),u(31," \u8A3B\u518A "),a()()()(),n(32,"nz-tab",2)(33,"form",3),g("ngSubmit",function(){return i.resetPassword()}),n(34,"nz-form-item")(35,"nz-form-control",4)(36,"nz-input-group",5),f(37,"input",6),a()()(),n(38,"nz-form-item")(39,"button",10),u(40," \u767C\u9001\u91CD\u7F6E\u90F5\u7BB1 "),a()()()()()()),t&2&&(r(),l("nzAnimated",!1),r(),l("nzTitle","\u767B\u5165"),r(),l("formGroup",i.loginForm),r(10),l("nzLoading",i.loading),r(2),l("nzTitle","\u8A3B\u518A"),r(),l("formGroup",i.registerForm),r(14),l("nzLoading",i.loading),r(2),l("nzTitle","\u91CD\u7F6E\u5BC6\u78BC"),r(),l("formGroup",i.resetForm),r(6),l("nzLoading",i.loading))},dependencies:[q,U,R,V,L,O,G,rt,Q,Y,H,X,K,J,j,$,W,P,I,E,M,xe,ke,Te],styles:[".email-auth-modal[_ngcontent-%COMP%]{padding:20px 0}nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}.ant-tabs-content-holder[_ngcontent-%COMP%]{padding-top:16px}"]});var Re=fe;var ge=class ge{constructor(){this.router=s(N);this.message=s(B);this.modalService=s(it);this.firebaseAuth=s(F);this.startupService=s(A);this.loading=!1}loginWithEmail(){return w(this,null,function*(){this.loading=!0;try{this.modalService.create({nzTitle:"\u90F5\u7BB1\u767B\u5165/\u8A3B\u518A",nzContent:Re,nzWidth:400,nzFooter:null,nzClosable:!0,nzMaskClosable:!1}).afterClose.subscribe(t=>{t&&this.message.success("\u64CD\u4F5C\u6210\u529F\uFF01")})}catch(e){console.error("\u90F5\u7BB1\u767B\u5165\u5931\u6557:",e),this.message.error("\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};ge.\u0275fac=function(t){return new(t||ge)},ge.\u0275cmp=h({type:ge,selectors:[["app-email-login"]],decls:1,vars:0,consts:[["nzType","mail","nzTheme","outline",1,"icon",3,"click"]],template:function(t,i){t&1&&(n(0,"nz-icon",0),g("click",function(){return i.loginWithEmail()}),a())},dependencies:[le,ae],encapsulation:2});var Ve=ge;function It(o,e){if(o&1&&f(0,"nz-alert",4),o&2){let t=ee();l("nzType","error")("nzMessage",t.error)("nzShowIcon",!0)}}function Pt(o,e){o&1&&(u(0),m(1,"i18n")),o&2&&z(" ",c(1,1,"validation.phone-number.required")," ")}function Dt(o,e){o&1&&(u(0),m(1,"i18n")),o&2&&z(" ",c(1,1,"validation.phone-number.wrong-format")," ")}function Bt(o,e){if(o&1&&(b(0,Pt,2,3),b(1,Dt,2,3)),o&2){let t=e.$implicit;_(t.errors.required?0:-1),r(),_(t.errors.pattern?1:-1)}}var ze=class ze{constructor(){this.router=s(N);this.settingsService=s(se);this.socialService=s(pe);this.reuseTabService=s(ft,{optional:!0});this.tokenService=s(Se);this.startupSrv=s(A);this.http=s(_e);this.cdr=s(ye);this.firebaseAuth=s(F);this.form=s(me).nonNullable.group({userName:["",[d.required,d.pattern(/^(admin|user)$/)]],password:["",[d.required,d.pattern(/^(ng-alain\.com)$/)]],mobile:["",[d.required,d.pattern(/^1\d{10}$/)]],captcha:["",[d.required]],remember:[!0]});this.error="";this.type=0;this.loading=!1;this.count=0}switch({index:e}){this.type=e}getCaptcha(){let e=this.form.controls.mobile;if(e.invalid){e.markAsDirty({onlySelf:!0}),e.updateValueAndValidity({onlySelf:!0});return}this.count=59,this.interval$=setInterval(()=>{this.count-=1,this.count<=0&&clearInterval(this.interval$)},1e3)}submit(){if(this.error="",this.type===0){let{userName:e,password:t}=this.form.controls;if(e.markAsDirty(),e.updateValueAndValidity(),t.markAsDirty(),t.updateValueAndValidity(),e.invalid||t.invalid)return}else{let{mobile:e,captcha:t}=this.form.controls;if(e.markAsDirty(),e.updateValueAndValidity(),t.markAsDirty(),t.updateValueAndValidity(),e.invalid||t.invalid)return}this.loading=!0,this.cdr.detectChanges(),this.http.post("/login/account",{type:this.type,userName:this.form.value.userName,password:this.form.value.password},null,{context:new be().set(Ne,!0)}).pipe(he(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(e=>{if(e.msg!=="ok"){this.error=e.msg,this.cdr.detectChanges();return}this.reuseTabService?.clear(),e.user.expired=+new Date+1e3*60*5,this.tokenService.set(e.user),this.startupSrv.load().subscribe(()=>{let t=this.tokenService.referrer.url||"/";t.includes("/passport")&&(t="/"),this.router.navigateByUrl(t)})})}open(e,t="href"){let i="",p="";switch(nt.production?p=`https://ng-alain.github.io/ng-alain/#/passport/callback/${e}`:p=`http://localhost:4200/#/passport/callback/${e}`,e){case"auth0":i=`//cipchk.auth0.com/login?client=8gcNydIDzGBYxzqV0Vm1CX_RXH-wsWo5&redirect_uri=${decodeURIComponent(p)}`;break;case"github":i=`//github.com/login/oauth/authorize?client_id=9d6baae4b04a23fcafa2&response_type=code&redirect_uri=${decodeURIComponent(p)}`;break;case"weibo":i=`https://api.weibo.com/oauth2/authorize?client_id=1239507802&response_type=code&redirect_uri=${decodeURIComponent(p)}`;break}t==="window"?this.socialService.login(i,"/",{type:"window"}).subscribe(v=>{v&&(this.settingsService.setUser(v),this.router.navigateByUrl("/"))}):this.socialService.login(i,"/",{type:"href"})}loginWithGoogle(){return w(this,null,function*(){try{(yield this.firebaseAuth.loginWithGoogle().toPromise())&&(this.reuseTabService?.clear(),this.startupSrv.load().subscribe(()=>{let t=this.tokenService.referrer.url||"/";t.includes("/passport")&&(t="/"),this.router.navigateByUrl(t)}))}catch(e){console.error("Google \u767B\u5165\u5931\u6557:",e)}})}ngOnDestroy(){this.interval$&&clearInterval(this.interval$)}};ze.\u0275fac=function(t){return new(t||ze)},ze.\u0275cmp=h({type:ze,selectors:[["passport-login"]],features:[Ce([pe])],decls:57,vars:39,consts:[["mobileErrorTip",""],["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"tabs",3,"nzSelectChange","nzAnimated"],[3,"nzTitle"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],["nzErrorTip","Please enter mobile number, muse be: admin or user"],["nzSize","large","nzPrefixIcon","user"],["nz-input","","formControlName","userName","placeholder","username: admin or user"],["nzErrorTip","Please enter password, muse be: ng-alain.com"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","password: ng-alain.com"],[3,"nzErrorTip"],["nz-input","","formControlName","mobile","placeholder","mobile number"],[3,"nzGutter"],[3,"nzSpan"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","captcha","placeholder","captcha"],["type","button","nz-button","","nzSize","large","nzBlock","",3,"click","disabled","nzLoading"],["nz-checkbox","","formControlName","remember"],[1,"text-right",3,"nzSpan"],["routerLink","/passport/register",1,"forgot"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"],[1,"other"],["nz-tooltip","","nzTooltipTitle","in fact Auth0 via window","nz-icon","","nzType","alipay-circle",1,"icon",3,"click"],["nz-tooltip","","nzTooltipTitle","in fact Github via redirect","nz-icon","","nzType","taobao-circle",1,"icon",3,"click"],["nz-icon","","nzType","weibo-circle",1,"icon",3,"click"],["nzType","google","nzTheme","outline",1,"icon",3,"click"],["routerLink","/passport/register",1,"register"]],template:function(t,i){if(t&1){let p=ne();n(0,"form",1),g("ngSubmit",function(){return C(p),y(i.submit())}),n(1,"nz-tabs",2),g("nzSelectChange",function(Z){return C(p),y(i.switch(Z))}),n(2,"nz-tab",3),m(3,"i18n"),b(4,It,1,3,"nz-alert",4),n(5,"nz-form-item")(6,"nz-form-control",5)(7,"nz-input-group",6),f(8,"input",7),a()()(),n(9,"nz-form-item")(10,"nz-form-control",8)(11,"nz-input-group",9),f(12,"input",10),a()()()(),n(13,"nz-tab",3),m(14,"i18n"),n(15,"nz-form-item")(16,"nz-form-control",11)(17,"nz-input-group",6),f(18,"input",12),a(),T(19,Bt,2,2,"ng-template",null,0,x),a()(),n(21,"nz-form-item")(22,"nz-form-control",11),m(23,"i18n"),n(24,"nz-row",13)(25,"nz-col",14)(26,"nz-input-group",15),f(27,"input",16),a()(),n(28,"nz-col",14)(29,"button",17),g("click",function(){return C(p),y(i.getCaptcha())}),u(30),m(31,"i18n"),a()()()()()()(),n(32,"nz-form-item")(33,"nz-col",14)(34,"label",18),u(35),m(36,"i18n"),a()(),n(37,"nz-col",19)(38,"a",20),u(39),m(40,"i18n"),a()()(),n(41,"nz-form-item")(42,"button",21),u(43),m(44,"i18n"),a()()(),n(45,"div",22),u(46),m(47,"i18n"),n(48,"i",23),g("click",function(){return C(p),y(i.open("auth0","window"))}),a(),n(49,"i",24),g("click",function(){return C(p),y(i.open("github"))}),a(),n(50,"i",25),g("click",function(){return C(p),y(i.open("weibo","window"))}),a(),n(51,"nz-icon",26),g("click",function(){return C(p),y(i.loginWithGoogle())}),a(),f(52,"app-anonymous-login")(53,"app-email-login"),n(54,"a",27),u(55),m(56,"i18n"),a()()}if(t&2){let p=k(20);l("formGroup",i.form),r(),l("nzAnimated",!1),r(),l("nzTitle",c(3,21,"app.login.tab-login-credentials")),r(2),_(i.error?4:-1),r(9),l("nzTitle",c(14,23,"app.login.tab-login-mobile")),r(3),l("nzErrorTip",p),r(6),l("nzErrorTip",c(23,25,"validation.verification-code.required")),r(2),l("nzGutter",8),r(),l("nzSpan",16),r(3),l("nzSpan",8),r(),l("disabled",i.count>=0)("nzLoading",i.loading),r(),z(" ",i.count?i.count+"s":c(31,27,"app.register.get-verification-code")," "),r(3),l("nzSpan",12),r(2),S(c(36,29,"app.login.remember-me")),r(2),l("nzSpan",12),r(2),S(c(40,31,"app.login.forgot-password")),r(3),l("nzLoading",i.loading),r(),z(" ",c(44,33,"app.login.login")," "),r(3),z(" ",c(47,35,"app.login.sign-in-with")," "),r(9),S(c(56,37,"app.login.signup"))}},dependencies:[oe,q,U,R,V,L,O,G,st,lt,xe,ke,Te,Me,Ee,Q,Y,H,X,K,J,j,$,W,P,I,E,M,mt,pt,le,ae,Fe,Ve,D],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     .ant-tabs .ant-tabs-bar{margin-bottom:24px;text-align:center;border-bottom:0}[_nghost-%COMP%]     .ant-tabs-tab{font-size:16px;line-height:24px}[_nghost-%COMP%]     .ant-input-affix-wrapper .ant-input:not(:first-child){padding-left:4px}[_nghost-%COMP%]     .icon{cursor:pointer;margin-left:16px;font-size:24px;color:#0003;vertical-align:middle;transition:color .3s}[_nghost-%COMP%]     .icon:hover{color:#1890ff}[_nghost-%COMP%]     app-anonymous-login, [_nghost-%COMP%]     app-email-login, [_nghost-%COMP%]     app-logout{margin-left:16px;display:inline-block;vertical-align:middle}[_nghost-%COMP%]     .other{margin-top:24px;line-height:22px;text-align:left}[_nghost-%COMP%]     .other nz-tooltip{vertical-align:middle}[_nghost-%COMP%]     .other .register{float:right}[data-theme=dark]   [_nghost-%COMP%]     .icon{color:#fff3}[data-theme=dark]   [_nghost-%COMP%]     .icon:hover{color:#fff}"],changeDetection:0});var Le=ze;function Tt(o,e){return t=>{let i=t.get(o),p=t.get(e);return p.errors&&!p.errors.matchControl||(i.value!==p.value?p.setErrors({matchControl:!0}):p.setErrors(null)),null}}var At=()=>({"width.px":240});function Ft(o,e){if(o&1&&f(0,"nz-alert",6),o&2){let t=ee();l("nzType","error")("nzMessage",t.error)("nzShowIcon",!0)}}function Rt(o,e){o&1&&(u(0),m(1,"i18n")),o&2&&z(" ",c(1,1,"validation.email.required")," ")}function Vt(o,e){o&1&&(u(0),m(1,"i18n")),o&2&&z(" ",c(1,1,"validation.email.wrong-format")," ")}function Lt(o,e){if(o&1&&(b(0,Rt,2,3),b(1,Vt,2,3)),o&2){let t=e.$implicit;_(t.errors!=null&&t.errors.required?0:-1),r(),_(t.errors!=null&&t.errors.email?1:-1)}}function Ut(o,e){o&1&&(n(0,"div",24),u(1),m(2,"i18n"),a()),o&2&&(r(),S(c(2,1,"validation.password.strength.strong")))}function Ot(o,e){o&1&&(n(0,"div",25),u(1),m(2,"i18n"),a()),o&2&&(r(),S(c(2,1,"validation.password.strength.medium")))}function Gt(o,e){o&1&&(n(0,"div",26),u(1),m(2,"i18n"),a()),o&2&&(r(),S(c(2,1,"validation.password.strength.short")))}function qt(o,e){if(o&1&&(n(0,"div",23),b(1,Ut,3,3,"div",24)(2,Ot,3,3,"div",25)(3,Gt,3,3,"div",26),n(4,"div"),f(5,"nz-progress",27),a(),n(6,"p",28),u(7),m(8,"i18n"),a()()),o&2){let t,i=ee();r(),_((t=i.status)==="ok"?1:t==="pass"?2:3),r(3),He(Je("progress-",i.status)),r(),l("nzPercent",i.progress)("nzStatus",i.passwordProgressMap[i.status])("nzStrokeWidth",6)("nzShowInfo",!1),r(2),S(c(8,9,"validation.password.strength.msg"))}}function $t(o,e){o&1&&(u(0),m(1,"i18n")),o&2&&z(" ",c(1,1,"validation.confirm-password.required")," ")}function Wt(o,e){o&1&&(u(0),m(1,"i18n")),o&2&&z(" ",c(1,1,"validation.password.twice")," ")}function jt(o,e){if(o&1&&(b(0,$t,2,3),b(1,Wt,2,3)),o&2){let t=e.$implicit;_(t.errors!=null&&t.errors.required?0:-1),r(),_(t.errors!=null&&t.errors.matchControl?1:-1)}}function Ht(o,e){o&1&&(n(0,"nz-select",29),f(1,"nz-option",30)(2,"nz-option",30),a()),o&2&&(r(),l("nzLabel","+86")("nzValue","+86"),r(),l("nzLabel","+87")("nzValue","+87"))}function Yt(o,e){o&1&&(u(0),m(1,"i18n")),o&2&&z(" ",c(1,1,"validation.phone-number.required")," ")}function Kt(o,e){o&1&&(u(0),m(1,"i18n")),o&2&&z(" ",c(1,1,"validation.phone-number.wrong-format")," ")}function Xt(o,e){if(o&1&&(b(0,Yt,2,3),b(1,Kt,2,3)),o&2){let t=e.$implicit;_(t.errors!=null&&t.errors.required?0:-1),r(),_(t.errors!=null&&t.errors.pattern?1:-1)}}var re=class re{constructor(){this.router=s(N);this.http=s(_e);this.cdr=s(ye);this.form=s(me).nonNullable.group({mail:["",[d.required,d.email]],password:["",[d.required,d.minLength(6),re.checkPassword.bind(this)]],confirm:["",[d.required,d.minLength(6)]],mobilePrefix:["+86"],mobile:["",[d.required,d.pattern(/^1\d{10}$/)]],captcha:["",[d.required]]},{validators:Tt("password","confirm")});this.error="";this.type=0;this.loading=!1;this.visible=!1;this.status="pool";this.progress=0;this.passwordProgressMap={ok:"success",pass:"normal",pool:"exception"};this.count=0}static checkPassword(e){if(!e)return null;let t=this;t.visible=!!e.value,e.value&&e.value.length>9?t.status="ok":e.value&&e.value.length>5?t.status="pass":t.status="pool",t.visible&&(t.progress=e.value.length*10>100?100:e.value.length*10)}getCaptcha(){let{mobile:e}=this.form.controls;if(e.invalid){e.markAsDirty({onlySelf:!0}),e.updateValueAndValidity({onlySelf:!0});return}this.count=59,this.cdr.detectChanges(),this.interval$=setInterval(()=>{this.count-=1,this.cdr.detectChanges(),this.count<=0&&clearInterval(this.interval$)},1e3)}submit(){if(this.error="",Object.keys(this.form.controls).forEach(t=>{let i=this.form.controls[t];i.markAsDirty(),i.updateValueAndValidity()}),this.form.invalid)return;let e=this.form.value;this.loading=!0,this.cdr.detectChanges(),this.http.post("/register",e,null,{context:new be().set(Ne,!0)}).pipe(he(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(()=>{this.router.navigate(["passport","register-result"],{queryParams:{email:e.mail}})})}ngOnDestroy(){this.interval$&&clearInterval(this.interval$)}};re.\u0275fac=function(t){return new(t||re)},re.\u0275cmp=h({type:re,selectors:[["passport-register"]],decls:50,vars:34,consts:[["mailErrorTip",""],["pwdCdkTpl",""],["confirmErrorTip",""],["addOnBeforeTemplate",""],["mobileErrorTip",""],["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],[3,"nzErrorTip"],["nzSize","large","nzAddonBeforeIcon","user"],["nz-input","","formControlName","mail","placeholder","Email"],["nzSize","large","nzAddonBeforeIcon","lock","nz-popover","","nzPopoverPlacement","right","nzPopoverTrigger","focus","nzPopoverOverlayClassName","register-password-cdk",3,"nzPopoverVisibleChange","nzPopoverVisible","nzPopoverOverlayStyle","nzPopoverContent"],["nz-input","","type","password","formControlName","password","placeholder","Password"],["nzSize","large","nzAddonBeforeIcon","lock"],["nz-input","","type","password","formControlName","confirm","placeholder","Confirm Password"],["nzSize","large",3,"nzAddOnBefore"],["formControlName","mobile","nz-input","","placeholder","Phone number"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nzSize","large","nzAddonBeforeIcon","mail"],["nz-input","","formControlName","captcha","placeholder","Captcha"],["type","button","nz-button","","nzSize","large","nzBlock","",3,"click","disabled","nzLoading"],["nz-button","","nzType","primary","nzSize","large","type","submit",1,"submit",3,"nzLoading"],["routerLink","/passport/login",1,"login"],[2,"padding","4px 0"],[1,"success"],[1,"warning"],[1,"error"],[3,"nzPercent","nzStatus","nzStrokeWidth","nzShowInfo"],[1,"mt-sm"],["formControlName","mobilePrefix",2,"width","100px"],[3,"nzLabel","nzValue"]],template:function(t,i){if(t&1){let p=ne();n(0,"h3"),u(1),m(2,"i18n"),a(),n(3,"form",5),g("ngSubmit",function(){return C(p),y(i.submit())}),b(4,Ft,1,3,"nz-alert",6),n(5,"nz-form-item")(6,"nz-form-control",7)(7,"nz-input-group",8),f(8,"input",9),a(),T(9,Lt,2,2,"ng-template",null,0,x),a()(),n(11,"nz-form-item")(12,"nz-form-control",7),m(13,"i18n"),n(14,"nz-input-group",10),Xe("nzPopoverVisibleChange",function(Z){return C(p),Ke(i.visible,Z)||(i.visible=Z),y(Z)}),f(15,"input",11),a(),T(16,qt,9,11,"ng-template",null,1,x),a()(),n(18,"nz-form-item")(19,"nz-form-control",7)(20,"nz-input-group",12),f(21,"input",13),a(),T(22,jt,2,2,"ng-template",null,2,x),a()(),n(24,"nz-form-item")(25,"nz-form-control",7)(26,"nz-input-group",14),T(27,Ht,3,4,"ng-template",null,3,x),f(29,"input",15),a(),T(30,Xt,2,2,"ng-template",null,4,x),a()(),n(32,"nz-form-item")(33,"nz-form-control",7),m(34,"i18n"),n(35,"div",16)(36,"div",17)(37,"nz-input-group",18),f(38,"input",19),a()(),n(39,"div",17)(40,"button",20),g("click",function(){return C(p),y(i.getCaptcha())}),u(41),m(42,"i18n"),a()()()()(),n(43,"nz-form-item")(44,"button",21),u(45),m(46,"i18n"),a(),n(47,"a",22),u(48),m(49,"i18n"),a()()()}if(t&2){let p=k(10),v=k(17),Z=k(23),kt=k(28),xt=k(31);r(),S(c(2,21,"app.register.register")),r(2),l("formGroup",i.form),r(),_(i.error?4:-1),r(2),l("nzErrorTip",p),r(6),l("nzErrorTip",c(13,23,"validation.password.required")),r(2),Ye("nzPopoverVisible",i.visible),l("nzPopoverOverlayStyle",Qe(33,At))("nzPopoverContent",v),r(5),l("nzErrorTip",Z),r(6),l("nzErrorTip",xt),r(),l("nzAddOnBefore",kt),r(7),l("nzErrorTip",c(34,25,"validation.verification-code.required")),r(2),l("nzGutter",8),r(),l("nzSpan",16),r(3),l("nzSpan",8),r(),l("disabled",i.count>0)("nzLoading",i.loading),r(),z(" ",i.count?i.count+"s":c(42,27,"app.register.get-verification-code")," "),r(3),l("nzLoading",i.loading),r(),z(" ",c(46,29,"app.register.register")," "),r(3),S(c(49,31,"app.register.sign-in"))}},dependencies:[q,U,R,V,L,O,G,oe,Me,Ee,Q,Y,H,X,K,J,j,$,W,ht,vt,yt,Ct,dt,ct,ut,we,P,I,E,M,D],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     h3{margin-bottom:20px;font-size:16px}[_nghost-%COMP%]     .submit{width:50%}[_nghost-%COMP%]     .login{float:right;line-height:40px}  .register-password-cdk .success,   .register-password-cdk .warning,   .register-password-cdk .error{transition:color .3s}  .register-password-cdk .success{color:#52c41a}  .register-password-cdk .warning{color:#faad14}  .register-password-cdk .error{color:#ff4d4f}  .register-password-cdk .progress-pass>.progress .ant-progress-bg{background-color:#faad14}"],changeDetection:0});var Ue=re;var Jt=o=>({email:o});function Qt(o,e){if(o&1&&(n(0,"div",5),u(1),m(2,"i18n"),a()),o&2){let t=ee();r(),z(" ",et(2,1,"app.register-result.msg",Ze(4,Jt,t.email))," ")}}var ve=class ve{constructor(){this.msg=s(B);this.email=""}};ve.\u0275fac=function(t){return new(t||ve)},ve.\u0275cmp=h({type:ve,selectors:[["passport-register-result"]],inputs:{email:"email"},decls:11,vars:11,consts:[["title",""],["nzStatus","success",3,"nzTitle","nzSubTitle"],["nz-result-extra",""],["nz-button","","nzSize","large",3,"click","nzType"],["routerLink","/","nz-button","","nzSize","large"],[1,"title",2,"font-size","20px"]],template:function(t,i){if(t&1){let p=ne();n(0,"nz-result",1),m(1,"i18n"),T(2,Qt,3,6,"ng-template",null,0,x),n(4,"div",2)(5,"button",3),g("click",function(){return C(p),y(i.msg.success("email"))}),u(6),m(7,"i18n"),a(),n(8,"button",4),u(9),m(10,"i18n"),a()()()}if(t&2){let p=k(3);l("nzTitle",p)("nzSubTitle",c(1,5,"app.register-result.activation-email")),r(5),l("nzType","primary"),r(),z(" ",c(7,7,"app.register-result.view-mailbox")," "),r(3),z(" ",c(10,9,"app.register-result.back-home")," ")}},dependencies:[oe,P,I,E,M,Nt,St,_t,D],encapsulation:2});var Oe=ve;var yn=[{path:"passport",component:bt,children:[{path:"login",component:Le,data:{title:"\u767B\u5F55",titleI18n:"app.login.login"}},{path:"register",component:Ue,data:{title:"\u6CE8\u518C",titleI18n:"app.register.register"}},{path:"register-result",component:Oe,data:{title:"\u6CE8\u518C\u7ED3\u679C",titleI18n:"app.register.register"}},{path:"lock",component:Pe,data:{title:"\u9501\u5C4F",titleI18n:"app.lock"}}]},{path:"passport/callback/:type",component:Ie}];export{yn as routes};
