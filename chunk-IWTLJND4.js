import{b as Ca,d as Va,e as Da,f as xa,g as dn,h as Na,l as ka,m as Oa}from"./chunk-MJVXNEER.js";import{I as Pa}from"./chunk-VAGS5EVQ.js";import{B as ba,na as Sa,ra as Ra,u as Aa}from"./chunk-BUZ3SHNN.js";import{a as J,b as ve,i as N}from"./chunk-57BLH6QZ.js";var Ma=()=>{};var Ba=function(n){let t=[],e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Vl=function(n){let t=[],e=0,r=0;for(;e<n.length;){let s=n[e++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){let o=n[e++];t[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){let o=n[e++],u=n[e++],l=n[e++],f=((s&7)<<18|(o&63)<<12|(u&63)<<6|l&63)-65536;t[r++]=String.fromCharCode(55296+(f>>10)),t[r++]=String.fromCharCode(56320+(f&1023))}else{let o=n[e++],u=n[e++];t[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|u&63)}}return t.join("")},Ua={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){let o=n[s],u=s+1<n.length,l=u?n[s+1]:0,f=s+2<n.length,g=f?n[s+2]:0,v=o>>2,b=(o&3)<<4|l>>4,A=(l&15)<<2|g>>6,x=g&63;f||(x=64,u||(A=64)),r.push(e[v],e[b],e[A],e[x])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Ba(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Vl(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){let o=e[n.charAt(s++)],l=s<n.length?e[n.charAt(s)]:0;++s;let g=s<n.length?e[n.charAt(s)]:64;++s;let b=s<n.length?e[n.charAt(s)]:64;if(++s,o==null||l==null||g==null||b==null)throw new mi;let A=o<<2|l>>4;if(r.push(A),g!==64){let x=l<<4&240|g>>2;if(r.push(x),b!==64){let V=g<<6&192|b;r.push(V)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},mi=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Dl=function(n){let t=Ba(n);return Ua.encodeByteArray(t,!0)},mn=function(n){return Dl(n).replace(/\./g,"")},qa=function(n){try{return Ua.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function ja(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var xl=()=>ja().__FIREBASE_DEFAULTS__,Nl=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},kl=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=n&&qa(n[1]);return t&&JSON.parse(t)},pi=()=>{try{return Ma()||xl()||Nl()||kl()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ol=n=>pi()?.emulatorHosts?.[n],za=n=>{let t=Ol(n);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},gi=()=>pi()?.config;var nr=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}};function rr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function $a(n){return N(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Ga(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},r=t||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let u=J({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[mn(JSON.stringify(e)),mn(JSON.stringify(u)),""].join(".")}var fn={};function Ml(){let n={prod:[],emulator:[]};for(let t of Object.keys(fn))fn[t]?n.emulator.push(t):n.prod.push(t);return n}function Fl(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}var Fa=!1;function Ka(n,t){if(typeof window>"u"||typeof document>"u"||!rr(window.location.host)||fn[n]===t||fn[n]||Fa)return;fn[n]=t;function e(A){return`__firebase__banner__${A}`}let r="__firebase__banner",o=Ml().prod.length>0;function u(){let A=document.getElementById(r);A&&A.remove()}function l(A){A.style.display="flex",A.style.background="#7faaf0",A.style.position="fixed",A.style.bottom="5px",A.style.left="5px",A.style.padding=".5em",A.style.borderRadius="5px",A.style.alignItems="center"}function f(A,x){A.setAttribute("width","24"),A.setAttribute("id",x),A.setAttribute("height","24"),A.setAttribute("viewBox","0 0 24 24"),A.setAttribute("fill","none"),A.style.marginLeft="-6px"}function g(){let A=document.createElement("span");return A.style.cursor="pointer",A.style.marginLeft="16px",A.style.fontSize="24px",A.innerHTML=" &times;",A.onclick=()=>{Fa=!0,u()},A}function v(A,x){A.setAttribute("id",x),A.innerText="Learn more",A.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",A.setAttribute("target","__blank"),A.style.paddingLeft="5px",A.style.textDecoration="underline"}function b(){let A=Fl(r),x=e("text"),V=document.getElementById(x)||document.createElement("span"),B=e("learnmore"),O=document.getElementById(B)||document.createElement("a"),nt=e("preprendIcon"),Q=document.getElementById(nt)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(A.created){let G=A.element;l(G),v(O,B);let ft=g();f(Q,nt),G.append(Q,V,O,ft),document.body.appendChild(G)}o?(V.innerText="Preview backend disconnected.",Q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,V.innerText="Preview backend running in this workspace."),V.setAttribute("id",x)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",b):b()}function Qa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ll(){let n=pi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Ha(){return!Ll()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function yi(){try{return typeof indexedDB=="object"}catch{return!1}}function Wa(){return new Promise((n,t)=>{try{let e=!0,r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}var Bl="FirebaseError",xt=class n extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=Bl,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,pn.prototype.create)}},pn=class{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){let r=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],u=o?Ul(o,r):"Error",l=`${this.serviceName}: ${u} (${s}).`;return new xt(s,l,r)}};function Ul(n,t){return n.replace(ql,(e,r)=>{let s=t[r];return s!=null?String(s):`<${r}?>`})}var ql=/\{\$([^}]+)}/g;function Te(n,t){if(n===t)return!0;let e=Object.keys(n),r=Object.keys(t);for(let s of e){if(!r.includes(s))return!1;let o=n[s],u=t[s];if(La(o)&&La(u)){if(!Te(o,u))return!1}else if(o!==u)return!1}for(let s of r)if(!e.includes(s))return!1;return!0}function La(n){return n!==null&&typeof n=="object"}var mf=4*60*60*1e3;function Nt(n){return n&&n._delegate?n._delegate:n}var kt=class{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var oe="[DEFAULT]";var _i=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let r=new nr;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:e});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){let e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(zl(t))try{this.getOrInitializeService({instanceIdentifier:oe})}catch{}for(let[e,r]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(e);try{let o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(t=oe){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return N(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=oe){return this.instances.has(t)}getOptions(t=oe){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:r,options:e});for(let[o,u]of this.instancesDeferred.entries()){let l=this.normalizeInstanceIdentifier(o);r===l&&u.resolve(s)}return s}onInit(t,e){let r=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(r)??new Set;s.add(t),this.onInitCallbacks.set(r,s);let o=this.instances.get(r);return o&&t(o,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){let r=this.onInitCallbacks.get(e);if(r)for(let s of r)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:jl(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=oe){return this.component?this.component.multipleInstances?t:oe:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function jl(n){return n===oe?void 0:n}function zl(n){return n.instantiationMode==="EAGER"}var ir=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new _i(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var $l=[],F=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(F||{}),Gl={debug:F.DEBUG,verbose:F.VERBOSE,info:F.INFO,warn:F.WARN,error:F.ERROR,silent:F.SILENT},Kl=F.INFO,Ql={[F.DEBUG]:"log",[F.VERBOSE]:"log",[F.INFO]:"info",[F.WARN]:"warn",[F.ERROR]:"error"},Hl=(n,t,...e)=>{if(t<n.logLevel)return;let r=new Date().toISOString(),s=Ql[t];if(s)console[s](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},Ae=class{constructor(t){this.name=t,this._logLevel=Kl,this._logHandler=Hl,this._userLogHandler=null,$l.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in F))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Gl[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,F.DEBUG,...t),this._logHandler(this,F.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,F.VERBOSE,...t),this._logHandler(this,F.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,F.INFO,...t),this._logHandler(this,F.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,F.WARN,...t),this._logHandler(this,F.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,F.ERROR,...t),this._logHandler(this,F.ERROR,...t)}};var Ei=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Wl(e)){let r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}};function Wl(n){return n.getComponent()?.type==="VERSION"}var Ii="@firebase/app",Ja="0.14.0";var Ot=new Ae("@firebase/app"),Jl="@firebase/app-compat",Xl="@firebase/analytics-compat",Yl="@firebase/analytics",Zl="@firebase/app-check-compat",th="@firebase/app-check",eh="@firebase/auth",nh="@firebase/auth-compat",rh="@firebase/database",ih="@firebase/data-connect",sh="@firebase/database-compat",oh="@firebase/functions",ah="@firebase/functions-compat",ch="@firebase/installations",uh="@firebase/installations-compat",lh="@firebase/messaging",hh="@firebase/messaging-compat",dh="@firebase/performance",fh="@firebase/performance-compat",mh="@firebase/remote-config",ph="@firebase/remote-config-compat",gh="@firebase/storage",yh="@firebase/storage-compat",_h="@firebase/firestore",wh="@firebase/ai",Eh="@firebase/firestore-compat",Ih="firebase",vh="12.0.0";var vi="[DEFAULT]",Th={[Ii]:"fire-core",[Jl]:"fire-core-compat",[Yl]:"fire-analytics",[Xl]:"fire-analytics-compat",[th]:"fire-app-check",[Zl]:"fire-app-check-compat",[eh]:"fire-auth",[nh]:"fire-auth-compat",[rh]:"fire-rtdb",[ih]:"fire-data-connect",[sh]:"fire-rtdb-compat",[oh]:"fire-fn",[ah]:"fire-fn-compat",[ch]:"fire-iid",[uh]:"fire-iid-compat",[lh]:"fire-fcm",[hh]:"fire-fcm-compat",[dh]:"fire-perf",[fh]:"fire-perf-compat",[mh]:"fire-rc",[ph]:"fire-rc-compat",[gh]:"fire-gcs",[yh]:"fire-gcs-compat",[_h]:"fire-fst",[Eh]:"fire-fst-compat",[wh]:"fire-vertex","fire-js":"fire-js",[Ih]:"fire-js-all"};var sr=new Map,Ah=new Map,Ti=new Map;function Xa(n,t){try{n.container.addComponent(t)}catch(e){Ot.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function gn(n){let t=n.name;if(Ti.has(t))return Ot.debug(`There were multiple attempts to register component ${t}.`),!1;Ti.set(t,n);for(let e of sr.values())Xa(e,n);for(let e of Ah.values())Xa(e,n);return!0}function ec(n,t){let e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function nc(n){return n==null?!1:n.settings!==void 0}var bh={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ht=new pn("app","Firebase",bh);var Ai=class{constructor(t,e,r){this._isDeleted=!1,this._options=J({},t),this._config=J({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new kt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ht.create("app-deleted",{appName:this._name})}};var rc=vh;function Sh(n,t={}){let e=n;typeof t!="object"&&(t={name:t});let r=J({name:vi,automaticDataCollectionEnabled:!0},t),s=r.name;if(typeof s!="string"||!s)throw Ht.create("bad-app-name",{appName:String(s)});if(e||(e=gi()),!e)throw Ht.create("no-options");let o=sr.get(s);if(o){if(Te(e,o.options)&&Te(r,o.config))return o;throw Ht.create("duplicate-app",{appName:s})}let u=new ir(s);for(let f of Ti.values())u.addComponent(f);let l=new Ai(e,r,u);return sr.set(s,l),l}function ic(n=vi){let t=sr.get(n);if(!t&&n===vi&&gi())return Sh();if(!t)throw Ht.create("no-app",{appName:n});return t}function be(n,t,e){let r=Th[n]??n;e&&(r+=`-${e}`);let s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let u=[`Unable to register library "${r}" with version "${t}":`];s&&u.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&u.push("and"),o&&u.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Ot.warn(u.join(" "));return}gn(new kt(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}var Rh="firebase-heartbeat-database",Ph=1,yn="firebase-heartbeat-store",wi=null;function sc(){return wi||(wi=Pa(Rh,Ph,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(yn)}catch(e){console.warn(e)}}}}).catch(n=>{throw Ht.create("idb-open",{originalErrorMessage:n.message})})),wi}function Ch(n){return N(this,null,function*(){try{let e=(yield sc()).transaction(yn),r=yield e.objectStore(yn).get(oc(n));return yield e.done,r}catch(t){if(t instanceof xt)Ot.warn(t.message);else{let e=Ht.create("idb-get",{originalErrorMessage:t?.message});Ot.warn(e.message)}}})}function Ya(n,t){return N(this,null,function*(){try{let r=(yield sc()).transaction(yn,"readwrite");yield r.objectStore(yn).put(t,oc(n)),yield r.done}catch(e){if(e instanceof xt)Ot.warn(e.message);else{let r=Ht.create("idb-set",{originalErrorMessage:e?.message});Ot.warn(r.message)}}})}function oc(n){return`${n.name}!${n.options.appId}`}var Vh=1024,Dh=30,bi=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new Si(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return N(this,null,function*(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Za();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>Dh){let s=Nh(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Ot.warn(t)}})}getHeartbeatsHeader(){return N(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Za(),{heartbeatsToSend:e,unsentEntries:r}=xh(this._heartbeatsCache.heartbeats),s=mn(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Ot.warn(t),""}})}};function Za(){return new Date().toISOString().substring(0,10)}function xh(n,t=Vh){let e=[],r=n.slice();for(let s of n){let o=e.find(u=>u.agent===s.agent);if(o){if(o.dates.push(s.date),tc(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),tc(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}var Si=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return N(this,null,function*(){return yi()?Wa().then(()=>!0).catch(()=>!1):!1})}read(){return N(this,null,function*(){if(yield this._canUseIndexedDBPromise){let e=yield Ch(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return N(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return Ya(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return N(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return Ya(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return})}};function tc(n){return mn(JSON.stringify({version:2,heartbeats:n})).length}function Nh(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function kh(n){gn(new kt("platform-logger",t=>new Ei(t),"PRIVATE")),gn(new kt("heartbeat",t=>new bi(t),"PRIVATE")),be(Ii,Ja,n),be(Ii,Ja,"esm2020"),be("fire-js","")}kh("");var ac=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},cc={};var or,uc;(function(){var n;function t(E,d){function p(){}p.prototype=d.prototype,E.D=d.prototype,E.prototype=new p,E.prototype.constructor=E,E.C=function(y,_,I){for(var m=Array(arguments.length-2),Ct=2;Ct<arguments.length;Ct++)m[Ct-2]=arguments[Ct];return d.prototype[_].apply(y,m)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,d,p){p||(p=0);var y=Array(16);if(typeof d=="string")for(var _=0;16>_;++_)y[_]=d.charCodeAt(p++)|d.charCodeAt(p++)<<8|d.charCodeAt(p++)<<16|d.charCodeAt(p++)<<24;else for(_=0;16>_;++_)y[_]=d[p++]|d[p++]<<8|d[p++]<<16|d[p++]<<24;d=E.g[0],p=E.g[1],_=E.g[2];var I=E.g[3],m=d+(I^p&(_^I))+y[0]+3614090360&4294967295;d=p+(m<<7&4294967295|m>>>25),m=I+(_^d&(p^_))+y[1]+3905402710&4294967295,I=d+(m<<12&4294967295|m>>>20),m=_+(p^I&(d^p))+y[2]+606105819&4294967295,_=I+(m<<17&4294967295|m>>>15),m=p+(d^_&(I^d))+y[3]+3250441966&4294967295,p=_+(m<<22&4294967295|m>>>10),m=d+(I^p&(_^I))+y[4]+4118548399&4294967295,d=p+(m<<7&4294967295|m>>>25),m=I+(_^d&(p^_))+y[5]+1200080426&4294967295,I=d+(m<<12&4294967295|m>>>20),m=_+(p^I&(d^p))+y[6]+2821735955&4294967295,_=I+(m<<17&4294967295|m>>>15),m=p+(d^_&(I^d))+y[7]+4249261313&4294967295,p=_+(m<<22&4294967295|m>>>10),m=d+(I^p&(_^I))+y[8]+1770035416&4294967295,d=p+(m<<7&4294967295|m>>>25),m=I+(_^d&(p^_))+y[9]+2336552879&4294967295,I=d+(m<<12&4294967295|m>>>20),m=_+(p^I&(d^p))+y[10]+4294925233&4294967295,_=I+(m<<17&4294967295|m>>>15),m=p+(d^_&(I^d))+y[11]+2304563134&4294967295,p=_+(m<<22&4294967295|m>>>10),m=d+(I^p&(_^I))+y[12]+1804603682&4294967295,d=p+(m<<7&4294967295|m>>>25),m=I+(_^d&(p^_))+y[13]+4254626195&4294967295,I=d+(m<<12&4294967295|m>>>20),m=_+(p^I&(d^p))+y[14]+2792965006&4294967295,_=I+(m<<17&4294967295|m>>>15),m=p+(d^_&(I^d))+y[15]+1236535329&4294967295,p=_+(m<<22&4294967295|m>>>10),m=d+(_^I&(p^_))+y[1]+4129170786&4294967295,d=p+(m<<5&4294967295|m>>>27),m=I+(p^_&(d^p))+y[6]+3225465664&4294967295,I=d+(m<<9&4294967295|m>>>23),m=_+(d^p&(I^d))+y[11]+643717713&4294967295,_=I+(m<<14&4294967295|m>>>18),m=p+(I^d&(_^I))+y[0]+3921069994&4294967295,p=_+(m<<20&4294967295|m>>>12),m=d+(_^I&(p^_))+y[5]+3593408605&4294967295,d=p+(m<<5&4294967295|m>>>27),m=I+(p^_&(d^p))+y[10]+38016083&4294967295,I=d+(m<<9&4294967295|m>>>23),m=_+(d^p&(I^d))+y[15]+3634488961&4294967295,_=I+(m<<14&4294967295|m>>>18),m=p+(I^d&(_^I))+y[4]+3889429448&4294967295,p=_+(m<<20&4294967295|m>>>12),m=d+(_^I&(p^_))+y[9]+568446438&4294967295,d=p+(m<<5&4294967295|m>>>27),m=I+(p^_&(d^p))+y[14]+3275163606&4294967295,I=d+(m<<9&4294967295|m>>>23),m=_+(d^p&(I^d))+y[3]+4107603335&4294967295,_=I+(m<<14&4294967295|m>>>18),m=p+(I^d&(_^I))+y[8]+1163531501&4294967295,p=_+(m<<20&4294967295|m>>>12),m=d+(_^I&(p^_))+y[13]+2850285829&4294967295,d=p+(m<<5&4294967295|m>>>27),m=I+(p^_&(d^p))+y[2]+4243563512&4294967295,I=d+(m<<9&4294967295|m>>>23),m=_+(d^p&(I^d))+y[7]+1735328473&4294967295,_=I+(m<<14&4294967295|m>>>18),m=p+(I^d&(_^I))+y[12]+2368359562&4294967295,p=_+(m<<20&4294967295|m>>>12),m=d+(p^_^I)+y[5]+4294588738&4294967295,d=p+(m<<4&4294967295|m>>>28),m=I+(d^p^_)+y[8]+2272392833&4294967295,I=d+(m<<11&4294967295|m>>>21),m=_+(I^d^p)+y[11]+1839030562&4294967295,_=I+(m<<16&4294967295|m>>>16),m=p+(_^I^d)+y[14]+4259657740&4294967295,p=_+(m<<23&4294967295|m>>>9),m=d+(p^_^I)+y[1]+2763975236&4294967295,d=p+(m<<4&4294967295|m>>>28),m=I+(d^p^_)+y[4]+1272893353&4294967295,I=d+(m<<11&4294967295|m>>>21),m=_+(I^d^p)+y[7]+4139469664&4294967295,_=I+(m<<16&4294967295|m>>>16),m=p+(_^I^d)+y[10]+3200236656&4294967295,p=_+(m<<23&4294967295|m>>>9),m=d+(p^_^I)+y[13]+681279174&4294967295,d=p+(m<<4&4294967295|m>>>28),m=I+(d^p^_)+y[0]+3936430074&4294967295,I=d+(m<<11&4294967295|m>>>21),m=_+(I^d^p)+y[3]+3572445317&4294967295,_=I+(m<<16&4294967295|m>>>16),m=p+(_^I^d)+y[6]+76029189&4294967295,p=_+(m<<23&4294967295|m>>>9),m=d+(p^_^I)+y[9]+3654602809&4294967295,d=p+(m<<4&4294967295|m>>>28),m=I+(d^p^_)+y[12]+3873151461&4294967295,I=d+(m<<11&4294967295|m>>>21),m=_+(I^d^p)+y[15]+530742520&4294967295,_=I+(m<<16&4294967295|m>>>16),m=p+(_^I^d)+y[2]+3299628645&4294967295,p=_+(m<<23&4294967295|m>>>9),m=d+(_^(p|~I))+y[0]+4096336452&4294967295,d=p+(m<<6&4294967295|m>>>26),m=I+(p^(d|~_))+y[7]+1126891415&4294967295,I=d+(m<<10&4294967295|m>>>22),m=_+(d^(I|~p))+y[14]+2878612391&4294967295,_=I+(m<<15&4294967295|m>>>17),m=p+(I^(_|~d))+y[5]+4237533241&4294967295,p=_+(m<<21&4294967295|m>>>11),m=d+(_^(p|~I))+y[12]+1700485571&4294967295,d=p+(m<<6&4294967295|m>>>26),m=I+(p^(d|~_))+y[3]+2399980690&4294967295,I=d+(m<<10&4294967295|m>>>22),m=_+(d^(I|~p))+y[10]+4293915773&4294967295,_=I+(m<<15&4294967295|m>>>17),m=p+(I^(_|~d))+y[1]+2240044497&4294967295,p=_+(m<<21&4294967295|m>>>11),m=d+(_^(p|~I))+y[8]+1873313359&4294967295,d=p+(m<<6&4294967295|m>>>26),m=I+(p^(d|~_))+y[15]+4264355552&4294967295,I=d+(m<<10&4294967295|m>>>22),m=_+(d^(I|~p))+y[6]+2734768916&4294967295,_=I+(m<<15&4294967295|m>>>17),m=p+(I^(_|~d))+y[13]+1309151649&4294967295,p=_+(m<<21&4294967295|m>>>11),m=d+(_^(p|~I))+y[4]+4149444226&4294967295,d=p+(m<<6&4294967295|m>>>26),m=I+(p^(d|~_))+y[11]+3174756917&4294967295,I=d+(m<<10&4294967295|m>>>22),m=_+(d^(I|~p))+y[2]+718787259&4294967295,_=I+(m<<15&4294967295|m>>>17),m=p+(I^(_|~d))+y[9]+3951481745&4294967295,E.g[0]=E.g[0]+d&4294967295,E.g[1]=E.g[1]+(_+(m<<21&4294967295|m>>>11))&4294967295,E.g[2]=E.g[2]+_&4294967295,E.g[3]=E.g[3]+I&4294967295}r.prototype.u=function(E,d){d===void 0&&(d=E.length);for(var p=d-this.blockSize,y=this.B,_=this.h,I=0;I<d;){if(_==0)for(;I<=p;)s(this,E,I),I+=this.blockSize;if(typeof E=="string"){for(;I<d;)if(y[_++]=E.charCodeAt(I++),_==this.blockSize){s(this,y),_=0;break}}else for(;I<d;)if(y[_++]=E[I++],_==this.blockSize){s(this,y),_=0;break}}this.h=_,this.o+=d},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var d=1;d<E.length-8;++d)E[d]=0;var p=8*this.o;for(d=E.length-8;d<E.length;++d)E[d]=p&255,p/=256;for(this.u(E),E=Array(16),d=p=0;4>d;++d)for(var y=0;32>y;y+=8)E[p++]=this.g[d]>>>y&255;return E};function o(E,d){var p=l;return Object.prototype.hasOwnProperty.call(p,E)?p[E]:p[E]=d(E)}function u(E,d){this.h=d;for(var p=[],y=!0,_=E.length-1;0<=_;_--){var I=E[_]|0;y&&I==d||(p[_]=I,y=!1)}this.g=p}var l={};function f(E){return-128<=E&&128>E?o(E,function(d){return new u([d|0],0>d?-1:0)}):new u([E|0],0>E?-1:0)}function g(E){if(isNaN(E)||!isFinite(E))return b;if(0>E)return O(g(-E));for(var d=[],p=1,y=0;E>=p;y++)d[y]=E/p|0,p*=4294967296;return new u(d,0)}function v(E,d){if(E.length==0)throw Error("number format error: empty string");if(d=d||10,2>d||36<d)throw Error("radix out of range: "+d);if(E.charAt(0)=="-")return O(v(E.substring(1),d));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var p=g(Math.pow(d,8)),y=b,_=0;_<E.length;_+=8){var I=Math.min(8,E.length-_),m=parseInt(E.substring(_,_+I),d);8>I?(I=g(Math.pow(d,I)),y=y.j(I).add(g(m))):(y=y.j(p),y=y.add(g(m)))}return y}var b=f(0),A=f(1),x=f(16777216);n=u.prototype,n.m=function(){if(B(this))return-O(this).m();for(var E=0,d=1,p=0;p<this.g.length;p++){var y=this.i(p);E+=(0<=y?y:4294967296+y)*d,d*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(V(this))return"0";if(B(this))return"-"+O(this).toString(E);for(var d=g(Math.pow(E,6)),p=this,y="";;){var _=ft(p,d).g;p=nt(p,_.j(d));var I=((0<p.g.length?p.g[0]:p.h)>>>0).toString(E);if(p=_,V(p))return I+y;for(;6>I.length;)I="0"+I;y=I+y}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function V(E){if(E.h!=0)return!1;for(var d=0;d<E.g.length;d++)if(E.g[d]!=0)return!1;return!0}function B(E){return E.h==-1}n.l=function(E){return E=nt(this,E),B(E)?-1:V(E)?0:1};function O(E){for(var d=E.g.length,p=[],y=0;y<d;y++)p[y]=~E.g[y];return new u(p,~E.h).add(A)}n.abs=function(){return B(this)?O(this):this},n.add=function(E){for(var d=Math.max(this.g.length,E.g.length),p=[],y=0,_=0;_<=d;_++){var I=y+(this.i(_)&65535)+(E.i(_)&65535),m=(I>>>16)+(this.i(_)>>>16)+(E.i(_)>>>16);y=m>>>16,I&=65535,m&=65535,p[_]=m<<16|I}return new u(p,p[p.length-1]&-2147483648?-1:0)};function nt(E,d){return E.add(O(d))}n.j=function(E){if(V(this)||V(E))return b;if(B(this))return B(E)?O(this).j(O(E)):O(O(this).j(E));if(B(E))return O(this.j(O(E)));if(0>this.l(x)&&0>E.l(x))return g(this.m()*E.m());for(var d=this.g.length+E.g.length,p=[],y=0;y<2*d;y++)p[y]=0;for(y=0;y<this.g.length;y++)for(var _=0;_<E.g.length;_++){var I=this.i(y)>>>16,m=this.i(y)&65535,Ct=E.i(_)>>>16,Ke=E.i(_)&65535;p[2*y+2*_]+=m*Ke,Q(p,2*y+2*_),p[2*y+2*_+1]+=I*Ke,Q(p,2*y+2*_+1),p[2*y+2*_+1]+=m*Ct,Q(p,2*y+2*_+1),p[2*y+2*_+2]+=I*Ct,Q(p,2*y+2*_+2)}for(y=0;y<d;y++)p[y]=p[2*y+1]<<16|p[2*y];for(y=d;y<2*d;y++)p[y]=0;return new u(p,0)};function Q(E,d){for(;(E[d]&65535)!=E[d];)E[d+1]+=E[d]>>>16,E[d]&=65535,d++}function G(E,d){this.g=E,this.h=d}function ft(E,d){if(V(d))throw Error("division by zero");if(V(E))return new G(b,b);if(B(E))return d=ft(O(E),d),new G(O(d.g),O(d.h));if(B(d))return d=ft(E,O(d)),new G(O(d.g),d.h);if(30<E.g.length){if(B(E)||B(d))throw Error("slowDivide_ only works with positive integers.");for(var p=A,y=d;0>=y.l(E);)p=zt(p),y=zt(y);var _=yt(p,1),I=yt(y,1);for(y=yt(y,2),p=yt(p,2);!V(y);){var m=I.add(y);0>=m.l(E)&&(_=_.add(p),I=m),y=yt(y,1),p=yt(p,1)}return d=nt(E,_.j(d)),new G(_,d)}for(_=b;0<=E.l(d);){for(p=Math.max(1,Math.floor(E.m()/d.m())),y=Math.ceil(Math.log(p)/Math.LN2),y=48>=y?1:Math.pow(2,y-48),I=g(p),m=I.j(d);B(m)||0<m.l(E);)p-=y,I=g(p),m=I.j(d);V(I)&&(I=A),_=_.add(I),E=nt(E,m)}return new G(_,E)}n.A=function(E){return ft(this,E).h},n.and=function(E){for(var d=Math.max(this.g.length,E.g.length),p=[],y=0;y<d;y++)p[y]=this.i(y)&E.i(y);return new u(p,this.h&E.h)},n.or=function(E){for(var d=Math.max(this.g.length,E.g.length),p=[],y=0;y<d;y++)p[y]=this.i(y)|E.i(y);return new u(p,this.h|E.h)},n.xor=function(E){for(var d=Math.max(this.g.length,E.g.length),p=[],y=0;y<d;y++)p[y]=this.i(y)^E.i(y);return new u(p,this.h^E.h)};function zt(E){for(var d=E.g.length+1,p=[],y=0;y<d;y++)p[y]=E.i(y)<<1|E.i(y-1)>>>31;return new u(p,E.h)}function yt(E,d){var p=d>>5;d%=32;for(var y=E.g.length-p,_=[],I=0;I<y;I++)_[I]=0<d?E.i(I+p)>>>d|E.i(I+p+1)<<32-d:E.i(I+p);return new u(_,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,uc=cc.Md5=r,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=g,u.fromString=v,or=cc.Integer=u}).apply(typeof ac<"u"?ac:typeof self<"u"?self:typeof window<"u"?window:{});var ar=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Mt={};var Ri,Oh,Se,Pi,_n,cr,Ci,Vi,Di;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(i,a,c){return i==Array.prototype||i==Object.prototype||(i[a]=c.value),i};function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof ar=="object"&&ar];for(var a=0;a<i.length;++a){var c=i[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object")}var r=e(this);function s(i,a){if(a)t:{var c=r;i=i.split(".");for(var h=0;h<i.length-1;h++){var w=i[h];if(!(w in c))break t;c=c[w]}i=i[i.length-1],h=c[i],a=a(h),a!=h&&a!=null&&t(c,i,{configurable:!0,writable:!0,value:a})}}function o(i,a){i instanceof String&&(i+="");var c=0,h=!1,w={next:function(){if(!h&&c<i.length){var T=c++;return{value:a(T,i[T]),done:!1}}return h=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}s("Array.prototype.values",function(i){return i||function(){return o(this,function(a,c){return c})}});var u=u||{},l=this||self;function f(i){var a=typeof i;return a=a!="object"?a:i?Array.isArray(i)?"array":a:"null",a=="array"||a=="object"&&typeof i.length=="number"}function g(i){var a=typeof i;return a=="object"&&i!=null||a=="function"}function v(i,a,c){return i.call.apply(i.bind,arguments)}function b(i,a,c){if(!i)throw Error();if(2<arguments.length){var h=Array.prototype.slice.call(arguments,2);return function(){var w=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(w,h),i.apply(a,w)}}return function(){return i.apply(a,arguments)}}function A(i,a,c){return A=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?v:b,A.apply(null,arguments)}function x(i,a){var c=Array.prototype.slice.call(arguments,1);return function(){var h=c.slice();return h.push.apply(h,arguments),i.apply(this,h)}}function V(i,a){function c(){}c.prototype=a.prototype,i.aa=a.prototype,i.prototype=new c,i.prototype.constructor=i,i.Qb=function(h,w,T){for(var P=Array(arguments.length-2),j=2;j<arguments.length;j++)P[j-2]=arguments[j];return a.prototype[w].apply(h,P)}}function B(i){let a=i.length;if(0<a){let c=Array(a);for(let h=0;h<a;h++)c[h]=i[h];return c}return[]}function O(i,a){for(let c=1;c<arguments.length;c++){let h=arguments[c];if(f(h)){let w=i.length||0,T=h.length||0;i.length=w+T;for(let P=0;P<T;P++)i[w+P]=h[P]}else i.push(h)}}class nt{constructor(a,c){this.i=a,this.j=c,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}function Q(i){return/^[\s\xa0]*$/.test(i)}function G(){var i=l.navigator;return i&&(i=i.userAgent)?i:""}function ft(i){return ft[" "](i),i}ft[" "]=function(){};var zt=G().indexOf("Gecko")!=-1&&!(G().toLowerCase().indexOf("webkit")!=-1&&G().indexOf("Edge")==-1)&&!(G().indexOf("Trident")!=-1||G().indexOf("MSIE")!=-1)&&G().indexOf("Edge")==-1;function yt(i,a,c){for(let h in i)a.call(c,i[h],h,i)}function E(i,a){for(let c in i)a.call(void 0,i[c],c,i)}function d(i){let a={};for(let c in i)a[c]=i[c];return a}let p="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function y(i,a){let c,h;for(let w=1;w<arguments.length;w++){h=arguments[w];for(c in h)i[c]=h[c];for(let T=0;T<p.length;T++)c=p[T],Object.prototype.hasOwnProperty.call(h,c)&&(i[c]=h[c])}}function _(i){var a=1;i=i.split(":");let c=[];for(;0<a&&i.length;)c.push(i.shift()),a--;return i.length&&c.push(i.join(":")),c}function I(i){l.setTimeout(()=>{throw i},0)}function m(){var i=zr;let a=null;return i.g&&(a=i.g,i.g=i.g.next,i.g||(i.h=null),a.next=null),a}class Ct{constructor(){this.h=this.g=null}add(a,c){let h=Ke.get();h.set(a,c),this.h?this.h.next=h:this.g=h,this.h=h}}var Ke=new nt(()=>new Ju,i=>i.reset());class Ju{constructor(){this.next=this.g=this.h=null}set(a,c){this.h=a,this.g=c,this.next=null}reset(){this.next=this.g=this.h=null}}let Qe,He=!1,zr=new Ct,To=()=>{let i=l.Promise.resolve(void 0);Qe=()=>{i.then(Xu)}};var Xu=()=>{for(var i;i=m();){try{i.h.call(i.g)}catch(c){I(c)}var a=Ke;a.j(i),100>a.h&&(a.h++,i.next=a.g,a.g=i)}He=!1};function $t(){this.s=this.s,this.C=this.C}$t.prototype.s=!1,$t.prototype.ma=function(){this.s||(this.s=!0,this.N())},$t.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function at(i,a){this.type=i,this.g=this.target=a,this.defaultPrevented=!1}at.prototype.h=function(){this.defaultPrevented=!0};var Yu=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,a=Object.defineProperty({},"passive",{get:function(){i=!0}});try{let c=()=>{};l.addEventListener("test",c,a),l.removeEventListener("test",c,a)}catch{}return i}();function We(i,a){if(at.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var c=this.type=i.type,h=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=a,a=i.relatedTarget){if(zt){t:{try{ft(a.nodeName);var w=!0;break t}catch{}w=!1}w||(a=null)}}else c=="mouseover"?a=i.fromElement:c=="mouseout"&&(a=i.toElement);this.relatedTarget=a,h?(this.clientX=h.clientX!==void 0?h.clientX:h.pageX,this.clientY=h.clientY!==void 0?h.clientY:h.pageY,this.screenX=h.screenX||0,this.screenY=h.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:Zu[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&We.aa.h.call(this)}}V(We,at);var Zu={2:"touch",3:"pen",4:"mouse"};We.prototype.h=function(){We.aa.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var Je="closure_listenable_"+(1e6*Math.random()|0),tl=0;function el(i,a,c,h,w){this.listener=i,this.proxy=null,this.src=a,this.type=c,this.capture=!!h,this.ha=w,this.key=++tl,this.da=this.fa=!1}function Bn(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function Un(i){this.src=i,this.g={},this.h=0}Un.prototype.add=function(i,a,c,h,w){var T=i.toString();i=this.g[T],i||(i=this.g[T]=[],this.h++);var P=Gr(i,a,h,w);return-1<P?(a=i[P],c||(a.fa=!1)):(a=new el(a,this.src,T,!!h,w),a.fa=c,i.push(a)),a};function $r(i,a){var c=a.type;if(c in i.g){var h=i.g[c],w=Array.prototype.indexOf.call(h,a,void 0),T;(T=0<=w)&&Array.prototype.splice.call(h,w,1),T&&(Bn(a),i.g[c].length==0&&(delete i.g[c],i.h--))}}function Gr(i,a,c,h){for(var w=0;w<i.length;++w){var T=i[w];if(!T.da&&T.listener==a&&T.capture==!!c&&T.ha==h)return w}return-1}var Kr="closure_lm_"+(1e6*Math.random()|0),Qr={};function Ao(i,a,c,h,w){if(h&&h.once)return So(i,a,c,h,w);if(Array.isArray(a)){for(var T=0;T<a.length;T++)Ao(i,a[T],c,h,w);return null}return c=Xr(c),i&&i[Je]?i.K(a,c,g(h)?!!h.capture:!!h,w):bo(i,a,c,!1,h,w)}function bo(i,a,c,h,w,T){if(!a)throw Error("Invalid event type");var P=g(w)?!!w.capture:!!w,j=Wr(i);if(j||(i[Kr]=j=new Un(i)),c=j.add(a,c,h,P,T),c.proxy)return c;if(h=nl(),c.proxy=h,h.src=i,h.listener=c,i.addEventListener)Yu||(w=P),w===void 0&&(w=!1),i.addEventListener(a.toString(),h,w);else if(i.attachEvent)i.attachEvent(Po(a.toString()),h);else if(i.addListener&&i.removeListener)i.addListener(h);else throw Error("addEventListener and attachEvent are unavailable.");return c}function nl(){function i(c){return a.call(i.src,i.listener,c)}let a=rl;return i}function So(i,a,c,h,w){if(Array.isArray(a)){for(var T=0;T<a.length;T++)So(i,a[T],c,h,w);return null}return c=Xr(c),i&&i[Je]?i.L(a,c,g(h)?!!h.capture:!!h,w):bo(i,a,c,!0,h,w)}function Ro(i,a,c,h,w){if(Array.isArray(a))for(var T=0;T<a.length;T++)Ro(i,a[T],c,h,w);else h=g(h)?!!h.capture:!!h,c=Xr(c),i&&i[Je]?(i=i.i,a=String(a).toString(),a in i.g&&(T=i.g[a],c=Gr(T,c,h,w),-1<c&&(Bn(T[c]),Array.prototype.splice.call(T,c,1),T.length==0&&(delete i.g[a],i.h--)))):i&&(i=Wr(i))&&(a=i.g[a.toString()],i=-1,a&&(i=Gr(a,c,h,w)),(c=-1<i?a[i]:null)&&Hr(c))}function Hr(i){if(typeof i!="number"&&i&&!i.da){var a=i.src;if(a&&a[Je])$r(a.i,i);else{var c=i.type,h=i.proxy;a.removeEventListener?a.removeEventListener(c,h,i.capture):a.detachEvent?a.detachEvent(Po(c),h):a.addListener&&a.removeListener&&a.removeListener(h),(c=Wr(a))?($r(c,i),c.h==0&&(c.src=null,a[Kr]=null)):Bn(i)}}}function Po(i){return i in Qr?Qr[i]:Qr[i]="on"+i}function rl(i,a){if(i.da)i=!0;else{a=new We(a,this);var c=i.listener,h=i.ha||i.src;i.fa&&Hr(i),i=c.call(h,a)}return i}function Wr(i){return i=i[Kr],i instanceof Un?i:null}var Jr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Xr(i){return typeof i=="function"?i:(i[Jr]||(i[Jr]=function(a){return i.handleEvent(a)}),i[Jr])}function ct(){$t.call(this),this.i=new Un(this),this.M=this,this.F=null}V(ct,$t),ct.prototype[Je]=!0,ct.prototype.removeEventListener=function(i,a,c,h){Ro(this,i,a,c,h)};function mt(i,a){var c,h=i.F;if(h)for(c=[];h;h=h.F)c.push(h);if(i=i.M,h=a.type||a,typeof a=="string")a=new at(a,i);else if(a instanceof at)a.target=a.target||i;else{var w=a;a=new at(h,i),y(a,w)}if(w=!0,c)for(var T=c.length-1;0<=T;T--){var P=a.g=c[T];w=qn(P,h,!0,a)&&w}if(P=a.g=i,w=qn(P,h,!0,a)&&w,w=qn(P,h,!1,a)&&w,c)for(T=0;T<c.length;T++)P=a.g=c[T],w=qn(P,h,!1,a)&&w}ct.prototype.N=function(){if(ct.aa.N.call(this),this.i){var i=this.i,a;for(a in i.g){for(var c=i.g[a],h=0;h<c.length;h++)Bn(c[h]);delete i.g[a],i.h--}}this.F=null},ct.prototype.K=function(i,a,c,h){return this.i.add(String(i),a,!1,c,h)},ct.prototype.L=function(i,a,c,h){return this.i.add(String(i),a,!0,c,h)};function qn(i,a,c,h){if(a=i.i.g[String(a)],!a)return!0;a=a.concat();for(var w=!0,T=0;T<a.length;++T){var P=a[T];if(P&&!P.da&&P.capture==c){var j=P.listener,st=P.ha||P.src;P.fa&&$r(i.i,P),w=j.call(st,h)!==!1&&w}}return w&&!h.defaultPrevented}function Co(i,a,c){if(typeof i=="function")c&&(i=A(i,c));else if(i&&typeof i.handleEvent=="function")i=A(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(a)?-1:l.setTimeout(i,a||0)}function Vo(i){i.g=Co(()=>{i.g=null,i.i&&(i.i=!1,Vo(i))},i.l);let a=i.h;i.h=null,i.m.apply(null,a)}class il extends $t{constructor(a,c){super(),this.m=a,this.l=c,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:Vo(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Xe(i){$t.call(this),this.h=i,this.g={}}V(Xe,$t);var Do=[];function xo(i){yt(i.g,function(a,c){this.g.hasOwnProperty(c)&&Hr(a)},i),i.g={}}Xe.prototype.N=function(){Xe.aa.N.call(this),xo(this)},Xe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Yr=l.JSON.stringify,sl=l.JSON.parse,ol=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function Zr(){}Zr.prototype.h=null;function No(i){return i.h||(i.h=i.i())}function ko(){}var Ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ti(){at.call(this,"d")}V(ti,at);function ei(){at.call(this,"c")}V(ei,at);var ne={},Oo=null;function jn(){return Oo=Oo||new ct}ne.La="serverreachability";function Mo(i){at.call(this,ne.La,i)}V(Mo,at);function Ze(i){let a=jn();mt(a,new Mo(a))}ne.STAT_EVENT="statevent";function Fo(i,a){at.call(this,ne.STAT_EVENT,i),this.stat=a}V(Fo,at);function pt(i){let a=jn();mt(a,new Fo(a,i))}ne.Ma="timingevent";function Lo(i,a){at.call(this,ne.Ma,i),this.size=a}V(Lo,at);function tn(i,a){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},a)}function en(){this.g=!0}en.prototype.xa=function(){this.g=!1};function al(i,a,c,h,w,T){i.info(function(){if(i.g)if(T)for(var P="",j=T.split("&"),st=0;st<j.length;st++){var U=j[st].split("=");if(1<U.length){var ut=U[0];U=U[1];var lt=ut.split("_");P=2<=lt.length&&lt[1]=="type"?P+(ut+"="+U+"&"):P+(ut+"=redacted&")}}else P=null;else P=T;return"XMLHTTP REQ ("+h+") [attempt "+w+"]: "+a+`
`+c+`
`+P})}function cl(i,a,c,h,w,T,P){i.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+w+"]: "+a+`
`+c+`
`+T+" "+P})}function _e(i,a,c,h){i.info(function(){return"XMLHTTP TEXT ("+a+"): "+ll(i,c)+(h?" "+h:"")})}function ul(i,a){i.info(function(){return"TIMEOUT: "+a})}en.prototype.info=function(){};function ll(i,a){if(!i.g)return a;if(!a)return null;try{var c=JSON.parse(a);if(c){for(i=0;i<c.length;i++)if(Array.isArray(c[i])){var h=c[i];if(!(2>h.length)){var w=h[1];if(Array.isArray(w)&&!(1>w.length)){var T=w[0];if(T!="noop"&&T!="stop"&&T!="close")for(var P=1;P<w.length;P++)w[P]=""}}}}return Yr(c)}catch{return a}}var zn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Bo={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ni;function $n(){}V($n,Zr),$n.prototype.g=function(){return new XMLHttpRequest},$n.prototype.i=function(){return{}},ni=new $n;function Gt(i,a,c,h){this.j=i,this.i=a,this.l=c,this.R=h||1,this.U=new Xe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Uo}function Uo(){this.i=null,this.g="",this.h=!1}var qo={},ri={};function ii(i,a,c){i.L=1,i.v=Hn(Vt(a)),i.m=c,i.P=!0,jo(i,null)}function jo(i,a){i.F=Date.now(),Gn(i),i.A=Vt(i.v);var c=i.A,h=i.R;Array.isArray(h)||(h=[String(h)]),na(c.i,"t",h),i.C=0,c=i.j.J,i.h=new Uo,i.g=Ea(i.j,c?a:null,!i.m),0<i.O&&(i.M=new il(A(i.Y,i,i.g),i.O)),a=i.U,c=i.g,h=i.ca;var w="readystatechange";Array.isArray(w)||(w&&(Do[0]=w.toString()),w=Do);for(var T=0;T<w.length;T++){var P=Ao(c,w[T],h||a.handleEvent,!1,a.h||a);if(!P)break;a.g[P.key]=P}a=i.H?d(i.H):{},i.m?(i.u||(i.u="POST"),a["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.A,i.u,i.m,a)):(i.u="GET",i.g.ea(i.A,i.u,null,a)),Ze(),al(i.i,i.u,i.A,i.l,i.R,i.m)}Gt.prototype.ca=function(i){i=i.target;let a=this.M;a&&Dt(i)==3?a.j():this.Y(i)},Gt.prototype.Y=function(i){try{if(i==this.g)t:{let lt=Dt(this.g);var a=this.g.Ba();let Ie=this.g.Z();if(!(3>lt)&&(lt!=3||this.g&&(this.h.h||this.g.oa()||ua(this.g)))){this.J||lt!=4||a==7||(a==8||0>=Ie?Ze(3):Ze(2)),si(this);var c=this.g.Z();this.X=c;e:if(zo(this)){var h=ua(this.g);i="";var w=h.length,T=Dt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){re(this),nn(this);var P="";break e}this.h.i=new l.TextDecoder}for(a=0;a<w;a++)this.h.h=!0,i+=this.h.i.decode(h[a],{stream:!(T&&a==w-1)});h.length=0,this.h.g+=i,this.C=0,P=this.h.g}else P=this.g.oa();if(this.o=c==200,cl(this.i,this.u,this.A,this.l,this.R,lt,c),this.o){if(this.T&&!this.K){e:{if(this.g){var j,st=this.g;if((j=st.g?st.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Q(j)){var U=j;break e}}U=null}if(c=U)_e(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,oi(this,c);else{this.o=!1,this.s=3,pt(12),re(this),nn(this);break t}}if(this.P){c=!0;let At;for(;!this.J&&this.C<P.length;)if(At=hl(this,P),At==ri){lt==4&&(this.s=4,pt(14),c=!1),_e(this.i,this.l,null,"[Incomplete Response]");break}else if(At==qo){this.s=4,pt(15),_e(this.i,this.l,P,"[Invalid Chunk]"),c=!1;break}else _e(this.i,this.l,At,null),oi(this,At);if(zo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),lt!=4||P.length!=0||this.h.h||(this.s=1,pt(16),c=!1),this.o=this.o&&c,!c)_e(this.i,this.l,P,"[Invalid Chunked Response]"),re(this),nn(this);else if(0<P.length&&!this.W){this.W=!0;var ut=this.j;ut.g==this&&ut.ba&&!ut.M&&(ut.j.info("Great, no buffering proxy detected. Bytes received: "+P.length),di(ut),ut.M=!0,pt(11))}}else _e(this.i,this.l,P,null),oi(this,P);lt==4&&re(this),this.o&&!this.J&&(lt==4?ga(this.j,this):(this.o=!1,Gn(this)))}else Pl(this.g),c==400&&0<P.indexOf("Unknown SID")?(this.s=3,pt(12)):(this.s=0,pt(13)),re(this),nn(this)}}}catch{}finally{}};function zo(i){return i.g?i.u=="GET"&&i.L!=2&&i.j.Ca:!1}function hl(i,a){var c=i.C,h=a.indexOf(`
`,c);return h==-1?ri:(c=Number(a.substring(c,h)),isNaN(c)?qo:(h+=1,h+c>a.length?ri:(a=a.slice(h,h+c),i.C=h+c,a)))}Gt.prototype.cancel=function(){this.J=!0,re(this)};function Gn(i){i.S=Date.now()+i.I,$o(i,i.I)}function $o(i,a){if(i.B!=null)throw Error("WatchDog timer not null");i.B=tn(A(i.ba,i),a)}function si(i){i.B&&(l.clearTimeout(i.B),i.B=null)}Gt.prototype.ba=function(){this.B=null;let i=Date.now();0<=i-this.S?(ul(this.i,this.A),this.L!=2&&(Ze(),pt(17)),re(this),this.s=2,nn(this)):$o(this,this.S-i)};function nn(i){i.j.G==0||i.J||ga(i.j,i)}function re(i){si(i);var a=i.M;a&&typeof a.ma=="function"&&a.ma(),i.M=null,xo(i.U),i.g&&(a=i.g,i.g=null,a.abort(),a.ma())}function oi(i,a){try{var c=i.j;if(c.G!=0&&(c.g==i||ai(c.h,i))){if(!i.K&&ai(c.h,i)&&c.G==3){try{var h=c.Da.g.parse(a)}catch{h=null}if(Array.isArray(h)&&h.length==3){var w=h;if(w[0]==0){t:if(!c.u){if(c.g)if(c.g.F+3e3<i.F)Zn(c),Xn(c);else break t;hi(c),pt(18)}}else c.za=w[1],0<c.za-c.T&&37500>w[2]&&c.F&&c.v==0&&!c.C&&(c.C=tn(A(c.Za,c),6e3));if(1>=Qo(c.h)&&c.ca){try{c.ca()}catch{}c.ca=void 0}}else se(c,11)}else if((i.K||c.g==i)&&Zn(c),!Q(a))for(w=c.Da.g.parse(a),a=0;a<w.length;a++){let U=w[a];if(c.T=U[0],U=U[1],c.G==2)if(U[0]=="c"){c.K=U[1],c.ia=U[2];let ut=U[3];ut!=null&&(c.la=ut,c.j.info("VER="+c.la));let lt=U[4];lt!=null&&(c.Aa=lt,c.j.info("SVER="+c.Aa));let Ie=U[5];Ie!=null&&typeof Ie=="number"&&0<Ie&&(h=1.5*Ie,c.L=h,c.j.info("backChannelRequestTimeoutMs_="+h)),h=c;let At=i.g;if(At){let er=At.g?At.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(er){var T=h.h;T.g||er.indexOf("spdy")==-1&&er.indexOf("quic")==-1&&er.indexOf("h2")==-1||(T.j=T.l,T.g=new Set,T.h&&(ci(T,T.h),T.h=null))}if(h.D){let fi=At.g?At.g.getResponseHeader("X-HTTP-Session-Id"):null;fi&&(h.ya=fi,z(h.I,h.D,fi))}}c.G=3,c.l&&c.l.ua(),c.ba&&(c.R=Date.now()-i.F,c.j.info("Handshake RTT: "+c.R+"ms")),h=c;var P=i;if(h.qa=wa(h,h.J?h.ia:null,h.W),P.K){Ho(h.h,P);var j=P,st=h.L;st&&(j.I=st),j.B&&(si(j),Gn(j)),h.g=P}else ma(h);0<c.i.length&&Yn(c)}else U[0]!="stop"&&U[0]!="close"||se(c,7);else c.G==3&&(U[0]=="stop"||U[0]=="close"?U[0]=="stop"?se(c,7):li(c):U[0]!="noop"&&c.l&&c.l.ta(U),c.v=0)}}Ze(4)}catch{}}var dl=class{constructor(i,a){this.g=i,this.map=a}};function Go(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ko(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Qo(i){return i.h?1:i.g?i.g.size:0}function ai(i,a){return i.h?i.h==a:i.g?i.g.has(a):!1}function ci(i,a){i.g?i.g.add(a):i.h=a}function Ho(i,a){i.h&&i.h==a?i.h=null:i.g&&i.g.has(a)&&i.g.delete(a)}Go.prototype.cancel=function(){if(this.i=Wo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let i of this.g.values())i.cancel();this.g.clear()}};function Wo(i){if(i.h!=null)return i.i.concat(i.h.D);if(i.g!=null&&i.g.size!==0){let a=i.i;for(let c of i.g.values())a=a.concat(c.D);return a}return B(i.i)}function fl(i){if(i.V&&typeof i.V=="function")return i.V();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(f(i)){for(var a=[],c=i.length,h=0;h<c;h++)a.push(i[h]);return a}a=[],c=0;for(h in i)a[c++]=i[h];return a}function ml(i){if(i.na&&typeof i.na=="function")return i.na();if(!i.V||typeof i.V!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(f(i)||typeof i=="string"){var a=[];i=i.length;for(var c=0;c<i;c++)a.push(c);return a}a=[],c=0;for(let h in i)a[c++]=h;return a}}}function Jo(i,a){if(i.forEach&&typeof i.forEach=="function")i.forEach(a,void 0);else if(f(i)||typeof i=="string")Array.prototype.forEach.call(i,a,void 0);else for(var c=ml(i),h=fl(i),w=h.length,T=0;T<w;T++)a.call(void 0,h[T],c&&c[T],i)}var Xo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pl(i,a){if(i){i=i.split("&");for(var c=0;c<i.length;c++){var h=i[c].indexOf("="),w=null;if(0<=h){var T=i[c].substring(0,h);w=i[c].substring(h+1)}else T=i[c];a(T,w?decodeURIComponent(w.replace(/\+/g," ")):"")}}}function ie(i){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,i instanceof ie){this.h=i.h,Kn(this,i.j),this.o=i.o,this.g=i.g,Qn(this,i.s),this.l=i.l;var a=i.i,c=new on;c.i=a.i,a.g&&(c.g=new Map(a.g),c.h=a.h),Yo(this,c),this.m=i.m}else i&&(a=String(i).match(Xo))?(this.h=!1,Kn(this,a[1]||"",!0),this.o=rn(a[2]||""),this.g=rn(a[3]||"",!0),Qn(this,a[4]),this.l=rn(a[5]||"",!0),Yo(this,a[6]||"",!0),this.m=rn(a[7]||"")):(this.h=!1,this.i=new on(null,this.h))}ie.prototype.toString=function(){var i=[],a=this.j;a&&i.push(sn(a,Zo,!0),":");var c=this.g;return(c||a=="file")&&(i.push("//"),(a=this.o)&&i.push(sn(a,Zo,!0),"@"),i.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.s,c!=null&&i.push(":",String(c))),(c=this.l)&&(this.g&&c.charAt(0)!="/"&&i.push("/"),i.push(sn(c,c.charAt(0)=="/"?_l:yl,!0))),(c=this.i.toString())&&i.push("?",c),(c=this.m)&&i.push("#",sn(c,El)),i.join("")};function Vt(i){return new ie(i)}function Kn(i,a,c){i.j=c?rn(a,!0):a,i.j&&(i.j=i.j.replace(/:$/,""))}function Qn(i,a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);i.s=a}else i.s=null}function Yo(i,a,c){a instanceof on?(i.i=a,Il(i.i,i.h)):(c||(a=sn(a,wl)),i.i=new on(a,i.h))}function z(i,a,c){i.i.set(a,c)}function Hn(i){return z(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function rn(i,a){return i?a?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function sn(i,a,c){return typeof i=="string"?(i=encodeURI(i).replace(a,gl),c&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function gl(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Zo=/[#\/\?@]/g,yl=/[#\?:]/g,_l=/[#\?]/g,wl=/[#\?@]/g,El=/#/g;function on(i,a){this.h=this.g=null,this.i=i||null,this.j=!!a}function Kt(i){i.g||(i.g=new Map,i.h=0,i.i&&pl(i.i,function(a,c){i.add(decodeURIComponent(a.replace(/\+/g," ")),c)}))}n=on.prototype,n.add=function(i,a){Kt(this),this.i=null,i=we(this,i);var c=this.g.get(i);return c||this.g.set(i,c=[]),c.push(a),this.h+=1,this};function ta(i,a){Kt(i),a=we(i,a),i.g.has(a)&&(i.i=null,i.h-=i.g.get(a).length,i.g.delete(a))}function ea(i,a){return Kt(i),a=we(i,a),i.g.has(a)}n.forEach=function(i,a){Kt(this),this.g.forEach(function(c,h){c.forEach(function(w){i.call(a,w,h,this)},this)},this)},n.na=function(){Kt(this);let i=Array.from(this.g.values()),a=Array.from(this.g.keys()),c=[];for(let h=0;h<a.length;h++){let w=i[h];for(let T=0;T<w.length;T++)c.push(a[h])}return c},n.V=function(i){Kt(this);let a=[];if(typeof i=="string")ea(this,i)&&(a=a.concat(this.g.get(we(this,i))));else{i=Array.from(this.g.values());for(let c=0;c<i.length;c++)a=a.concat(i[c])}return a},n.set=function(i,a){return Kt(this),this.i=null,i=we(this,i),ea(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[a]),this.h+=1,this},n.get=function(i,a){return i?(i=this.V(i),0<i.length?String(i[0]):a):a};function na(i,a,c){ta(i,a),0<c.length&&(i.i=null,i.g.set(we(i,a),B(c)),i.h+=c.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let i=[],a=Array.from(this.g.keys());for(var c=0;c<a.length;c++){var h=a[c];let T=encodeURIComponent(String(h)),P=this.V(h);for(h=0;h<P.length;h++){var w=T;P[h]!==""&&(w+="="+encodeURIComponent(String(P[h]))),i.push(w)}}return this.i=i.join("&")};function we(i,a){return a=String(a),i.j&&(a=a.toLowerCase()),a}function Il(i,a){a&&!i.j&&(Kt(i),i.i=null,i.g.forEach(function(c,h){var w=h.toLowerCase();h!=w&&(ta(this,h),na(this,w,c))},i)),i.j=a}function vl(i,a){let c=new en;if(l.Image){let h=new Image;h.onload=x(Qt,c,"TestLoadImage: loaded",!0,a,h),h.onerror=x(Qt,c,"TestLoadImage: error",!1,a,h),h.onabort=x(Qt,c,"TestLoadImage: abort",!1,a,h),h.ontimeout=x(Qt,c,"TestLoadImage: timeout",!1,a,h),l.setTimeout(function(){h.ontimeout&&h.ontimeout()},1e4),h.src=i}else a(!1)}function Tl(i,a){let c=new en,h=new AbortController,w=setTimeout(()=>{h.abort(),Qt(c,"TestPingServer: timeout",!1,a)},1e4);fetch(i,{signal:h.signal}).then(T=>{clearTimeout(w),T.ok?Qt(c,"TestPingServer: ok",!0,a):Qt(c,"TestPingServer: server error",!1,a)}).catch(()=>{clearTimeout(w),Qt(c,"TestPingServer: error",!1,a)})}function Qt(i,a,c,h,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),h(c)}catch{}}function Al(){this.g=new ol}function bl(i,a,c){let h=c||"";try{Jo(i,function(w,T){let P=w;g(w)&&(P=Yr(w)),a.push(h+T+"="+encodeURIComponent(P))})}catch(w){throw a.push(h+"type="+encodeURIComponent("_badmap")),w}}function an(i){this.l=i.Ub||null,this.j=i.eb||!1}V(an,Zr),an.prototype.g=function(){return new Wn(this.l,this.j)},an.prototype.i=function(i){return function(){return i}}({});function Wn(i,a){ct.call(this),this.D=i,this.o=a,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}V(Wn,ct),n=Wn.prototype,n.open=function(i,a){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=i,this.A=a,this.readyState=1,un(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let a={headers:this.u,method:this.B,credentials:this.m,cache:void 0};i&&(a.body=i),(this.D||l).fetch(new Request(this.A,a)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,cn(this)),this.readyState=0},n.Sa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,un(this)),this.g&&(this.readyState=3,un(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ra(this)}else i.text().then(this.Ra.bind(this),this.ga.bind(this))};function ra(i){i.j.read().then(i.Pa.bind(i)).catch(i.ga.bind(i))}n.Pa=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var a=i.value?i.value:new Uint8Array(0);(a=this.v.decode(a,{stream:!i.done}))&&(this.response=this.responseText+=a)}i.done?cn(this):un(this),this.readyState==3&&ra(this)}},n.Ra=function(i){this.g&&(this.response=this.responseText=i,cn(this))},n.Qa=function(i){this.g&&(this.response=i,cn(this))},n.ga=function(){this.g&&cn(this)};function cn(i){i.readyState=4,i.l=null,i.j=null,i.v=null,un(i)}n.setRequestHeader=function(i,a){this.u.append(i,a)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let i=[],a=this.h.entries();for(var c=a.next();!c.done;)c=c.value,i.push(c[0]+": "+c[1]),c=a.next();return i.join(`\r
`)};function un(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(Wn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function ia(i){let a="";return yt(i,function(c,h){a+=h,a+=":",a+=c,a+=`\r
`}),a}function ui(i,a,c){t:{for(h in c){var h=!1;break t}h=!0}h||(c=ia(c),typeof i=="string"?c!=null&&encodeURIComponent(String(c)):z(i,a,c))}function H(i){ct.call(this),this.headers=new Map,this.o=i||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}V(H,ct);var Sl=/^https?$/i,Rl=["POST","PUT"];n=H.prototype,n.Ha=function(i){this.J=i},n.ea=function(i,a,c,h){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);a=a?a.toUpperCase():"GET",this.D=i,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ni.g(),this.v=this.o?No(this.o):No(ni),this.g.onreadystatechange=A(this.Ea,this);try{this.B=!0,this.g.open(a,String(i),!0),this.B=!1}catch(T){sa(this,T);return}if(i=c||"",c=new Map(this.headers),h)if(Object.getPrototypeOf(h)===Object.prototype)for(var w in h)c.set(w,h[w]);else if(typeof h.keys=="function"&&typeof h.get=="function")for(let T of h.keys())c.set(T,h.get(T));else throw Error("Unknown input type for opt_headers: "+String(h));h=Array.from(c.keys()).find(T=>T.toLowerCase()=="content-type"),w=l.FormData&&i instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Rl,a,void 0))||h||w||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[T,P]of c)this.g.setRequestHeader(T,P);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ca(this),this.u=!0,this.g.send(i),this.u=!1}catch(T){sa(this,T)}};function sa(i,a){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=a,i.m=5,oa(i),Jn(i)}function oa(i){i.A||(i.A=!0,mt(i,"complete"),mt(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=i||7,mt(this,"complete"),mt(this,"abort"),Jn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Jn(this,!0)),H.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?aa(this):this.bb())},n.bb=function(){aa(this)};function aa(i){if(i.h&&typeof u<"u"&&(!i.v[1]||Dt(i)!=4||i.Z()!=2)){if(i.u&&Dt(i)==4)Co(i.Ea,0,i);else if(mt(i,"readystatechange"),Dt(i)==4){i.h=!1;try{let P=i.Z();t:switch(P){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break t;default:a=!1}var c;if(!(c=a)){var h;if(h=P===0){var w=String(i.D).match(Xo)[1]||null;!w&&l.self&&l.self.location&&(w=l.self.location.protocol.slice(0,-1)),h=!Sl.test(w?w.toLowerCase():"")}c=h}if(c)mt(i,"complete"),mt(i,"success");else{i.m=6;try{var T=2<Dt(i)?i.g.statusText:""}catch{T=""}i.l=T+" ["+i.Z()+"]",oa(i)}}finally{Jn(i)}}}}function Jn(i,a){if(i.g){ca(i);let c=i.g,h=i.v[0]?()=>{}:null;i.g=null,i.v=null,a||mt(i,"ready");try{c.onreadystatechange=h}catch{}}}function ca(i){i.I&&(l.clearTimeout(i.I),i.I=null)}n.isActive=function(){return!!this.g};function Dt(i){return i.g?i.g.readyState:0}n.Z=function(){try{return 2<Dt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(i){if(this.g){var a=this.g.responseText;return i&&a.indexOf(i)==0&&(a=a.substring(i.length)),sl(a)}};function ua(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.H){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Pl(i){let a={};i=(i.g&&2<=Dt(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let h=0;h<i.length;h++){if(Q(i[h]))continue;var c=_(i[h]);let w=c[0];if(c=c[1],typeof c!="string")continue;c=c.trim();let T=a[w]||[];a[w]=T,T.push(c)}E(a,function(h){return h.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ln(i,a,c){return c&&c.internalChannelParams&&c.internalChannelParams[i]||a}function la(i){this.Aa=0,this.i=[],this.j=new en,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ln("failFast",!1,i),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ln("baseRetryDelayMs",5e3,i),this.cb=ln("retryDelaySeedMs",1e4,i),this.Wa=ln("forwardChannelMaxRetries",2,i),this.wa=ln("forwardChannelRequestTimeoutMs",2e4,i),this.pa=i&&i.xmlHttpFactory||void 0,this.Xa=i&&i.Tb||void 0,this.Ca=i&&i.useFetchStreams||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.h=new Go(i&&i.concurrentRequestLimit),this.Da=new Al,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=i&&i.Rb||!1,i&&i.xa&&this.j.xa(),i&&i.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&i&&i.detectBufferingProxy||!1,this.ja=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.ja=i.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=la.prototype,n.la=8,n.G=1,n.connect=function(i,a,c,h){pt(0),this.W=i,this.H=a||{},c&&h!==void 0&&(this.H.OSID=c,this.H.OAID=h),this.F=this.X,this.I=wa(this,null,this.W),Yn(this)};function li(i){if(ha(i),i.G==3){var a=i.U++,c=Vt(i.I);if(z(c,"SID",i.K),z(c,"RID",a),z(c,"TYPE","terminate"),hn(i,c),a=new Gt(i,i.j,a),a.L=2,a.v=Hn(Vt(c)),c=!1,l.navigator&&l.navigator.sendBeacon)try{c=l.navigator.sendBeacon(a.v.toString(),"")}catch{}!c&&l.Image&&(new Image().src=a.v,c=!0),c||(a.g=Ea(a.j,null),a.g.ea(a.v)),a.F=Date.now(),Gn(a)}_a(i)}function Xn(i){i.g&&(di(i),i.g.cancel(),i.g=null)}function ha(i){Xn(i),i.u&&(l.clearTimeout(i.u),i.u=null),Zn(i),i.h.cancel(),i.s&&(typeof i.s=="number"&&l.clearTimeout(i.s),i.s=null)}function Yn(i){if(!Ko(i.h)&&!i.s){i.s=!0;var a=i.Ga;Qe||To(),He||(Qe(),He=!0),zr.add(a,i),i.B=0}}function Cl(i,a){return Qo(i.h)>=i.h.j-(i.s?1:0)?!1:i.s?(i.i=a.D.concat(i.i),!0):i.G==1||i.G==2||i.B>=(i.Va?0:i.Wa)?!1:(i.s=tn(A(i.Ga,i,a),ya(i,i.B)),i.B++,!0)}n.Ga=function(i){if(this.s)if(this.s=null,this.G==1){if(!i){this.U=Math.floor(1e5*Math.random()),i=this.U++;let w=new Gt(this,this.j,i),T=this.o;if(this.S&&(T?(T=d(T),y(T,this.S)):T=this.S),this.m!==null||this.O||(w.H=T,T=null),this.P)t:{for(var a=0,c=0;c<this.i.length;c++){e:{var h=this.i[c];if("__data__"in h.map&&(h=h.map.__data__,typeof h=="string")){h=h.length;break e}h=void 0}if(h===void 0)break;if(a+=h,4096<a){a=c;break t}if(a===4096||c===this.i.length-1){a=c+1;break t}}a=1e3}else a=1e3;a=fa(this,w,a),c=Vt(this.I),z(c,"RID",i),z(c,"CVER",22),this.D&&z(c,"X-HTTP-Session-Id",this.D),hn(this,c),T&&(this.O?a="headers="+encodeURIComponent(String(ia(T)))+"&"+a:this.m&&ui(c,this.m,T)),ci(this.h,w),this.Ua&&z(c,"TYPE","init"),this.P?(z(c,"$req",a),z(c,"SID","null"),w.T=!0,ii(w,c,null)):ii(w,c,a),this.G=2}}else this.G==3&&(i?da(this,i):this.i.length==0||Ko(this.h)||da(this))};function da(i,a){var c;a?c=a.l:c=i.U++;let h=Vt(i.I);z(h,"SID",i.K),z(h,"RID",c),z(h,"AID",i.T),hn(i,h),i.m&&i.o&&ui(h,i.m,i.o),c=new Gt(i,i.j,c,i.B+1),i.m===null&&(c.H=i.o),a&&(i.i=a.D.concat(i.i)),a=fa(i,c,1e3),c.I=Math.round(.5*i.wa)+Math.round(.5*i.wa*Math.random()),ci(i.h,c),ii(c,h,a)}function hn(i,a){i.H&&yt(i.H,function(c,h){z(a,h,c)}),i.l&&Jo({},function(c,h){z(a,h,c)})}function fa(i,a,c){c=Math.min(i.i.length,c);var h=i.l?A(i.l.Na,i.l,i):null;t:{var w=i.i;let T=-1;for(;;){let P=["count="+c];T==-1?0<c?(T=w[0].g,P.push("ofs="+T)):T=0:P.push("ofs="+T);let j=!0;for(let st=0;st<c;st++){let U=w[st].g,ut=w[st].map;if(U-=T,0>U)T=Math.max(0,w[st].g-100),j=!1;else try{bl(ut,P,"req"+U+"_")}catch{h&&h(ut)}}if(j){h=P.join("&");break t}}}return i=i.i.splice(0,c),a.D=i,h}function ma(i){if(!i.g&&!i.u){i.Y=1;var a=i.Fa;Qe||To(),He||(Qe(),He=!0),zr.add(a,i),i.v=0}}function hi(i){return i.g||i.u||3<=i.v?!1:(i.Y++,i.u=tn(A(i.Fa,i),ya(i,i.v)),i.v++,!0)}n.Fa=function(){if(this.u=null,pa(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var i=2*this.R;this.j.info("BP detection timer enabled: "+i),this.A=tn(A(this.ab,this),i)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,pt(10),Xn(this),pa(this))};function di(i){i.A!=null&&(l.clearTimeout(i.A),i.A=null)}function pa(i){i.g=new Gt(i,i.j,"rpc",i.Y),i.m===null&&(i.g.H=i.o),i.g.O=0;var a=Vt(i.qa);z(a,"RID","rpc"),z(a,"SID",i.K),z(a,"AID",i.T),z(a,"CI",i.F?"0":"1"),!i.F&&i.ja&&z(a,"TO",i.ja),z(a,"TYPE","xmlhttp"),hn(i,a),i.m&&i.o&&ui(a,i.m,i.o),i.L&&(i.g.I=i.L);var c=i.g;i=i.ia,c.L=1,c.v=Hn(Vt(a)),c.m=null,c.P=!0,jo(c,i)}n.Za=function(){this.C!=null&&(this.C=null,Xn(this),hi(this),pt(19))};function Zn(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function ga(i,a){var c=null;if(i.g==a){Zn(i),di(i),i.g=null;var h=2}else if(ai(i.h,a))c=a.D,Ho(i.h,a),h=1;else return;if(i.G!=0){if(a.o)if(h==1){c=a.m?a.m.length:0,a=Date.now()-a.F;var w=i.B;h=jn(),mt(h,new Lo(h,c)),Yn(i)}else ma(i);else if(w=a.s,w==3||w==0&&0<a.X||!(h==1&&Cl(i,a)||h==2&&hi(i)))switch(c&&0<c.length&&(a=i.h,a.i=a.i.concat(c)),w){case 1:se(i,5);break;case 4:se(i,10);break;case 3:se(i,6);break;default:se(i,2)}}}function ya(i,a){let c=i.Ta+Math.floor(Math.random()*i.cb);return i.isActive()||(c*=2),c*a}function se(i,a){if(i.j.info("Error code "+a),a==2){var c=A(i.fb,i),h=i.Xa;let w=!h;h=new ie(h||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Kn(h,"https"),Hn(h),w?vl(h.toString(),c):Tl(h.toString(),c)}else pt(2);i.G=0,i.l&&i.l.sa(a),_a(i),ha(i)}n.fb=function(i){i?(this.j.info("Successfully pinged google.com"),pt(2)):(this.j.info("Failed to ping google.com"),pt(1))};function _a(i){if(i.G=0,i.ka=[],i.l){let a=Wo(i.h);(a.length!=0||i.i.length!=0)&&(O(i.ka,a),O(i.ka,i.i),i.h.i.length=0,B(i.i),i.i.length=0),i.l.ra()}}function wa(i,a,c){var h=c instanceof ie?Vt(c):new ie(c);if(h.g!="")a&&(h.g=a+"."+h.g),Qn(h,h.s);else{var w=l.location;h=w.protocol,a=a?a+"."+w.hostname:w.hostname,w=+w.port;var T=new ie(null);h&&Kn(T,h),a&&(T.g=a),w&&Qn(T,w),c&&(T.l=c),h=T}return c=i.D,a=i.ya,c&&a&&z(h,c,a),z(h,"VER",i.la),hn(i,h),h}function Ea(i,a,c){if(a&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return a=i.Ca&&!i.pa?new H(new an({eb:c})):new H(i.pa),a.Ha(i.J),a}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ia(){}n=Ia.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function tr(){}tr.prototype.g=function(i,a){return new _t(i,a)};function _t(i,a){ct.call(this),this.g=new la(a),this.l=i,this.h=a&&a.messageUrlParams||null,i=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(i?i["X-WebChannel-Content-Type"]=a.messageContentType:i={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.va&&(i?i["X-WebChannel-Client-Profile"]=a.va:i={"X-WebChannel-Client-Profile":a.va}),this.g.S=i,(i=a&&a.Sb)&&!Q(i)&&(this.g.m=i),this.v=a&&a.supportsCrossDomainXhr||!1,this.u=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!Q(a)&&(this.g.D=a,i=this.h,i!==null&&a in i&&(i=this.h,a in i&&delete i[a])),this.j=new Ee(this)}V(_t,ct),_t.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_t.prototype.close=function(){li(this.g)},_t.prototype.o=function(i){var a=this.g;if(typeof i=="string"){var c={};c.__data__=i,i=c}else this.u&&(c={},c.__data__=Yr(i),i=c);a.i.push(new dl(a.Ya++,i)),a.G==3&&Yn(a)},_t.prototype.N=function(){this.g.l=null,delete this.j,li(this.g),delete this.g,_t.aa.N.call(this)};function va(i){ti.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var a=i.__sm__;if(a){t:{for(let c in a){i=c;break t}i=void 0}(this.i=i)&&(i=this.i,a=a!==null&&i in a?a[i]:void 0),this.data=a}else this.data=i}V(va,ti);function Ta(){ei.call(this),this.status=1}V(Ta,ei);function Ee(i){this.g=i}V(Ee,Ia),Ee.prototype.ua=function(){mt(this.g,"a")},Ee.prototype.ta=function(i){mt(this.g,new va(i))},Ee.prototype.sa=function(i){mt(this.g,new Ta)},Ee.prototype.ra=function(){mt(this.g,"b")},tr.prototype.createWebChannel=tr.prototype.g,_t.prototype.send=_t.prototype.o,_t.prototype.open=_t.prototype.m,_t.prototype.close=_t.prototype.close,Di=Mt.createWebChannelTransport=function(){return new tr},Vi=Mt.getStatEventTarget=function(){return jn()},Ci=Mt.Event=ne,cr=Mt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},zn.NO_ERROR=0,zn.TIMEOUT=8,zn.HTTP_ERROR=6,_n=Mt.ErrorCode=zn,Bo.COMPLETE="complete",Pi=Mt.EventType=Bo,ko.EventType=Ye,Ye.OPEN="a",Ye.CLOSE="b",Ye.ERROR="c",Ye.MESSAGE="d",ct.prototype.listen=ct.prototype.K,Se=Mt.WebChannel=ko,Oh=Mt.FetchXmlHttpFactory=an,H.prototype.listenOnce=H.prototype.L,H.prototype.getLastError=H.prototype.Ka,H.prototype.getLastErrorCode=H.prototype.Ba,H.prototype.getStatus=H.prototype.Z,H.prototype.getResponseJson=H.prototype.Oa,H.prototype.getResponseText=H.prototype.oa,H.prototype.send=H.prototype.ea,H.prototype.setWithCredentials=H.prototype.Ha,Ri=Mt.XhrIo=H}).apply(typeof ar<"u"?ar:typeof self<"u"?self:typeof window<"u"?window:{});var lc="@firebase/firestore",hc="4.9.0";var rt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};rt.UNAUTHENTICATED=new rt(null),rt.GOOGLE_CREDENTIALS=new rt("google-credentials-uid"),rt.FIRST_PARTY=new rt("first-party-uid"),rt.MOCK_USER=new rt("mock-user");var $e="12.0.0";var he=new Ae("@firebase/firestore");function Re(){return he.logLevel}function D(n,...t){if(he.logLevel<=F.DEBUG){let e=t.map(ao);he.debug(`Firestore (${$e}): ${n}`,...e)}}function Ge(n,...t){if(he.logLevel<=F.ERROR){let e=t.map(ao);he.error(`Firestore (${$e}): ${n}`,...e)}}function Mr(n,...t){if(he.logLevel<=F.WARN){let e=t.map(ao);he.warn(`Firestore (${$e}): ${n}`,...e)}}function ao(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function k(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,$c(n,r,e)}function $c(n,t,e){let r=`FIRESTORE (${$e}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw Ge(r),new Error(r)}function tt(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||$c(t,s,r)}function ot(n,t){return n}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},C=class extends xt{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ft=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var mr=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Fi=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(rt.UNAUTHENTICATED))}shutdown(){}},Li=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Bi=class{constructor(t){this.t=t,this.currentUser=rt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){tt(this.o===void 0,42304);let r=this.i,s=f=>this.i!==r?(r=this.i,e(f)):Promise.resolve(),o=new Ft;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ft,t.enqueueRetryable(()=>s(this.currentUser))};let u=()=>{let f=o;t.enqueueRetryable(()=>N(this,null,function*(){yield f.promise,yield s(this.currentUser)}))},l=f=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(f=>l(f)),setTimeout(()=>{if(!this.auth){let f=this.t.getImmediate({optional:!0});f?l(f):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ft)}},0),u()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(tt(typeof r.accessToken=="string",31837,{l:r}),new mr(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return tt(t===null||typeof t=="string",2055,{h:t}),new rt(t)}},Ui=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=rt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},qi=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new Ui(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(rt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},pr=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ji=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,nc(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){tt(this.o===void 0,3512);let r=o=>{o.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let u=o.token!==this.m;return this.m=o.token,D("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>r(o))};let s=o=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?s(o):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new pr(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(tt(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new pr(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Mh(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var Rn=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let s=Mh(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}};function q(n,t){return n<t?-1:n>t?1:0}function zi(n,t){let e=Math.min(n.length,t.length);for(let r=0;r<e;r++){let s=n.charAt(r),o=t.charAt(r);if(s!==o)return xi(s)===xi(o)?q(s,o):xi(s)?1:-1}return q(n.length,t.length)}var Fh=55296,Lh=57343;function xi(n){let t=n.charCodeAt(0);return t>=Fh&&t<=Lh}function De(n,t,e){return n.length===t.length&&n.every((r,s)=>e(r,t[s]))}var dc="__name__",gr=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&k(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&k(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let s=0;s<r;s++){let o=n.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return q(t.length,e.length)}static compareSegments(t,e){let r=n.isNumericId(t),s=n.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?n.extractNumericId(t).compare(n.extractNumericId(e)):zi(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return or.fromString(t.substring(4,t.length-2))}},W=class n extends gr{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new C(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(s=>s.length>0))}return new n(e)}static emptyPath(){return new n([])}},Bh=/^[_a-zA-Z][_a-zA-Z0-9]*$/,vt=class n extends gr{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return Bh.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===dc}static keyField(){return new n([dc])}static fromServerFormat(t){let e=[],r="",s=0,o=()=>{if(r.length===0)throw new C(S.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},u=!1;for(;s<t.length;){let l=t[s];if(l==="\\"){if(s+1===t.length)throw new C(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let f=t[s+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new C(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=f,s+=2}else l==="`"?(u=!u,s++):l!=="."||u?(r+=l,s++):(o(),s++)}if(o(),u)throw new C(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var M=class n{constructor(t){this.path=t}static fromPath(t){return new n(W.fromString(t))}static fromName(t){return new n(W.fromString(t).popFirst(5))}static empty(){return new n(W.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&W.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return W.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new W(t.slice()))}};function Uh(n,t,e){if(!e)throw new C(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function qh(n,t,e,r){if(t===!0&&r===!0)throw new C(S.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function fc(n){if(!M.isDocumentKey(n))throw new C(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Gc(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function co(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":k(12329,{type:typeof n})}function Kc(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new C(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=co(n);throw new C(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function Z(n,t){let e={typeString:n};return t&&(e.value=t),e}function Ln(n,t){if(!Gc(n))throw new C(S.INVALID_ARGUMENT,"JSON must be an object");let e;for(let r in t)if(t[r]){let s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}let u=n[r];if(s&&typeof u!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&u!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new C(S.INVALID_ARGUMENT,e);return!0}var mc=-62135596800,pc=1e6,et=class n{static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*pc);return new n(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new C(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new C(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<mc)throw new C(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new C(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/pc}_compareTo(t){return this.seconds===t.seconds?q(this.nanoseconds,t.nanoseconds):q(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Ln(t,n._jsonSchema))return new n(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-mc;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};et._jsonSchemaVersion="firestore/timestamp/1.0",et._jsonSchema={type:Z("string",et._jsonSchemaVersion),seconds:Z("number"),nanoseconds:Z("number")};var $=class n{static fromTimestamp(t){return new n(t)}static min(){return new n(new et(0,0))}static max(){return new n(new et(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Pn=-1,$i=class{constructor(t,e,r,s){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=s}};$i.UNKNOWN_ID=-1;function jh(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=$.fromTimestamp(r===1e9?new et(e+1,0):new et(e,r));return new de(s,M.empty(),t)}function zh(n){return new de(n.readTime,n.key,Pn)}var de=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n($.min(),M.empty(),Pn)}static max(){return new n($.max(),M.empty(),Pn)}};function $h(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(n.documentKey,t.documentKey),e!==0?e:q(n.largestBatchId,t.largestBatchId))}var Gh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Gi=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Kh(n){return N(this,null,function*(){if(n.code!==S.FAILED_PRECONDITION||n.message!==Gh)throw n;D("LocalStore","Unexpectedly lost primary lease")})}var R=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&k(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let s=0,o=0,u=!1;t.forEach(l=>{++s,l.next(()=>{++o,u&&o===s&&e()},f=>r(f))}),u=!0,o===s&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(s=>s?n.resolve(s):r());return e}static forEach(t,e){let r=[];return t.forEach((s,o)=>{r.push(e.call(this,s,o))}),this.waitFor(r)}static mapArray(t,e){return new n((r,s)=>{let o=t.length,u=new Array(o),l=0;for(let f=0;f<o;f++){let g=f;e(t[g]).next(v=>{u[g]=v,++l,l===o&&r(u)},v=>s(v))}})}static doWhile(t,e){return new n((r,s)=>{let o=()=>{t()===!0?e().next(()=>{o()},s):r()};o()})}};function Qh(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Fr(n){return n.name==="IndexedDbTransactionError"}var Qc=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>r.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}n.ce=-1;return n})(),Hh=-1;function Lr(n){return n==null}function Cn(n){return n===0&&1/n==-1/0}function Wh(n){return typeof n=="number"&&Number.isInteger(n)&&!Cn(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Hc="";function Jh(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=gc(t)),t=Xh(n.get(e),t);return gc(t)}function Xh(n,t){let e=t,r=n.length;for(let s=0;s<r;s++){let o=n.charAt(s);switch(o){case"\0":e+="";break;case Hc:e+="";break;default:e+=o}}return e}function gc(n){return n+Hc+""}var Yh="remoteDocuments",Wc="owner";var Jc="mutationQueues";var Xc="mutations";var Yc="documentMutations",Zh="remoteDocumentsV14";var Zc="remoteDocumentGlobal";var tu="targets";var eu="targetDocuments";var nu="targetGlobal",ru="collectionParents";var iu="clientMetadata";var su="bundles";var ou="namedQueries";var td="indexConfiguration";var ed="indexState";var nd="indexEntries";var au="documentOverlays";var rd="globals";var id=[Jc,Xc,Yc,Yh,tu,Wc,nu,eu,iu,Zc,ru,su,ou],Gf=[...id,au],sd=[Jc,Xc,Yc,Zh,tu,Wc,nu,eu,iu,Zc,ru,su,ou,au],od=sd,ad=[...od,td,ed,nd];var Kf=[...ad,rd];function yc(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function ge(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function cu(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var Tt=class n{constructor(t,e){this.comparator=t,this.root=e||Rt.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Rt.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Rt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ce(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ce(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ce(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ce(this.root,t,this.comparator,!0)}},Ce=class{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Rt=class n{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new n(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this,o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw k(43730,{key:this.key,value:this.value});if(this.right.isRed())throw k(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw k(27949);return t+(this.isRed()?0:1)}};Rt.EMPTY=null,Rt.RED=!0,Rt.BLACK=!1;Rt.EMPTY=new class{constructor(){this.size=0}get key(){throw k(57766)}get value(){throw k(16141)}get color(){throw k(16727)}get left(){throw k(29726)}get right(){throw k(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new Rt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var dt=class n{constructor(t){this.comparator=t,this.data=new Tt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new yr(this.data.getIterator())}getIteratorFrom(t){return new yr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},yr=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var bt=class n{constructor(t){this.fields=t,t.sort(vt.comparator)}static empty(){return new n([])}unionWith(t){let e=new dt(vt.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return De(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var Ki=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Bt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Ki("Invalid base64 string: "+o):o}}(t);return new n(e)}static fromUint8Array(t){let e=function(s){let o="";for(let u=0;u<s.length;++u)o+=String.fromCharCode(s[u]);return o}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return q(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};Bt.EMPTY_BYTE_STRING=new Bt("");var cd=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ut(n){if(tt(!!n,39018),typeof n=="string"){let t=0,e=cd.exec(n);if(tt(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:K(n.seconds),nanos:K(n.nanos)}}function K(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Xt(n){return typeof n=="string"?Bt.fromBase64String(n):Bt.fromUint8Array(n)}var uu="server_timestamp",lu="__type__",hu="__previous_value__",du="__local_write_time__";function uo(n){return(n?.mapValue?.fields||{})[lu]?.stringValue===uu}function Br(n){let t=n.mapValue.fields[hu];return uo(t)?Br(t):t}function Vn(n){let t=Ut(n.mapValue.fields[du].timestampValue);return new et(t.seconds,t.nanos)}var Qi=class{constructor(t,e,r,s,o,u,l,f,g,v){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=u,this.autoDetectLongPolling=l,this.longPollingOptions=f,this.useFetchStreams=g,this.isUsingEmulator=v}},_r="(default)",wr=class n{constructor(t,e){this.projectId=t,this.database=e||_r}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===_r}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var lo="__type__",fu="__max__",ur={mapValue:{fields:{__type__:{stringValue:fu}}}},ho="__vector__",xe="value";function Yt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?uo(n)?4:pu(n)?9007199254740991:mu(n)?10:11:k(28295,{value:n})}function Pt(n,t){if(n===t)return!0;let e=Yt(n);if(e!==Yt(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Vn(n).isEqual(Vn(t));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;let u=Ut(s.timestampValue),l=Ut(o.timestampValue);return u.seconds===l.seconds&&u.nanos===l.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(s,o){return Xt(s.bytesValue).isEqual(Xt(o.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(s,o){return K(s.geoPointValue.latitude)===K(o.geoPointValue.latitude)&&K(s.geoPointValue.longitude)===K(o.geoPointValue.longitude)}(n,t);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return K(s.integerValue)===K(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){let u=K(s.doubleValue),l=K(o.doubleValue);return u===l?Cn(u)===Cn(l):isNaN(u)&&isNaN(l)}return!1}(n,t);case 9:return De(n.arrayValue.values||[],t.arrayValue.values||[],Pt);case 10:case 11:return function(s,o){let u=s.mapValue.fields||{},l=o.mapValue.fields||{};if(yc(u)!==yc(l))return!1;for(let f in u)if(u.hasOwnProperty(f)&&(l[f]===void 0||!Pt(u[f],l[f])))return!1;return!0}(n,t);default:return k(52216,{left:n})}}function Dn(n,t){return(n.values||[]).find(e=>Pt(e,t))!==void 0}function Ne(n,t){if(n===t)return 0;let e=Yt(n),r=Yt(t);if(e!==r)return q(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,t.booleanValue);case 2:return function(o,u){let l=K(o.integerValue||o.doubleValue),f=K(u.integerValue||u.doubleValue);return l<f?-1:l>f?1:l===f?0:isNaN(l)?isNaN(f)?0:-1:1}(n,t);case 3:return _c(n.timestampValue,t.timestampValue);case 4:return _c(Vn(n),Vn(t));case 5:return zi(n.stringValue,t.stringValue);case 6:return function(o,u){let l=Xt(o),f=Xt(u);return l.compareTo(f)}(n.bytesValue,t.bytesValue);case 7:return function(o,u){let l=o.split("/"),f=u.split("/");for(let g=0;g<l.length&&g<f.length;g++){let v=q(l[g],f[g]);if(v!==0)return v}return q(l.length,f.length)}(n.referenceValue,t.referenceValue);case 8:return function(o,u){let l=q(K(o.latitude),K(u.latitude));return l!==0?l:q(K(o.longitude),K(u.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return wc(n.arrayValue,t.arrayValue);case 10:return function(o,u){let l=o.fields||{},f=u.fields||{},g=l[xe]?.arrayValue,v=f[xe]?.arrayValue,b=q(g?.values?.length||0,v?.values?.length||0);return b!==0?b:wc(g,v)}(n.mapValue,t.mapValue);case 11:return function(o,u){if(o===ur.mapValue&&u===ur.mapValue)return 0;if(o===ur.mapValue)return 1;if(u===ur.mapValue)return-1;let l=o.fields||{},f=Object.keys(l),g=u.fields||{},v=Object.keys(g);f.sort(),v.sort();for(let b=0;b<f.length&&b<v.length;++b){let A=zi(f[b],v[b]);if(A!==0)return A;let x=Ne(l[f[b]],g[v[b]]);if(x!==0)return x}return q(f.length,v.length)}(n.mapValue,t.mapValue);default:throw k(23264,{he:e})}}function _c(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return q(n,t);let e=Ut(n),r=Ut(t),s=q(e.seconds,r.seconds);return s!==0?s:q(e.nanos,r.nanos)}function wc(n,t){let e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){let o=Ne(e[s],r[s]);if(o)return o}return q(e.length,r.length)}function ke(n){return Hi(n)}function Hi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=Ut(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Xt(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return M.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",s=!0;for(let o of e.values||[])s?s=!1:r+=",",r+=Hi(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),s="{",o=!0;for(let u of r)o?o=!1:s+=",",s+=`${u}:${Hi(e.fields[u])}`;return s+"}"}(n.mapValue):k(61005,{value:n})}function dr(n){switch(Yt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=Br(n);return t?16+dr(t):16;case 5:return 2*n.stringValue.length;case 6:return Xt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,o)=>s+dr(o),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return ge(r.fields,(o,u)=>{s+=o.length+dr(u)}),s}(n.mapValue);default:throw k(13486,{value:n})}}function Wi(n){return!!n&&"integerValue"in n}function fo(n){return!!n&&"arrayValue"in n}function Ni(n){return!!n&&"mapValue"in n}function mu(n){return(n?.mapValue?.fields||{})[lo]?.stringValue===ho}function In(n){if(n.geoPointValue)return{geoPointValue:J({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:J({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return ge(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=In(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=In(n.arrayValue.values[e]);return t}return J({},n)}function pu(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===fu}var Hf={mapValue:{fields:{[lo]:{stringValue:ho},[xe]:{arrayValue:{}}}}};var It=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Ni(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=In(e)}setAll(t){let e=vt.emptyPath(),r={},s=[];t.forEach((u,l)=>{if(!e.isImmediateParentOf(l)){let f=this.getFieldsMap(e);this.applyChanges(f,r,s),r={},s=[],e=l.popLast()}u?r[l.lastSegment()]=In(u):s.push(l.lastSegment())});let o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){let e=this.field(t.popLast());Ni(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Pt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];Ni(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){ge(e,(s,o)=>t[s]=o);for(let s of r)delete t[s]}clone(){return new n(In(this.value))}};var Zt=class n{constructor(t,e,r,s,o,u,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=u,this.documentState=l}static newInvalidDocument(t){return new n(t,0,$.min(),$.min(),$.min(),It.empty(),0)}static newFoundDocument(t,e,r,s){return new n(t,1,e,$.min(),r,s,0)}static newNoDocument(t,e){return new n(t,2,e,$.min(),$.min(),It.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,$.min(),$.min(),It.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual($.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=It.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=It.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Oe=class{constructor(t,e){this.position=t,this.inclusive=e}};function Ec(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){let o=t[s],u=n.position[s];if(o.field.isKeyField()?r=M.comparator(M.fromName(u.referenceValue),e.key):r=Ne(u,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ic(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Pt(n.position[e],t.position[e]))return!1;return!0}var Me=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function ud(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Er=class{},it=class n extends Er{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Xi(t,e,r):e==="array-contains"?new ts(t,r):e==="in"?new es(t,r):e==="not-in"?new ns(t,r):e==="array-contains-any"?new rs(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Yi(t,r):new Zi(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ne(e,this.value)):e!==null&&Yt(this.value)===Yt(e)&&this.matchesComparison(Ne(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return k(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},te=class n extends Er{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new n(t,e)}matches(t){return gu(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function gu(n){return n.op==="and"}function yu(n){return ld(n)&&gu(n)}function ld(n){for(let t of n.filters)if(t instanceof te)return!1;return!0}function Ji(n){if(n instanceof it)return n.field.canonicalString()+n.op.toString()+ke(n.value);if(yu(n))return n.filters.map(t=>Ji(t)).join(",");{let t=n.filters.map(e=>Ji(e)).join(",");return`${n.op}(${t})`}}function _u(n,t){return n instanceof it?function(r,s){return s instanceof it&&r.op===s.op&&r.field.isEqual(s.field)&&Pt(r.value,s.value)}(n,t):n instanceof te?function(r,s){return s instanceof te&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,u,l)=>o&&_u(u,s.filters[l]),!0):!1}(n,t):void k(19439)}function wu(n){return n instanceof it?function(e){return`${e.field.canonicalString()} ${e.op} ${ke(e.value)}`}(n):n instanceof te?function(e){return e.op.toString()+" {"+e.getFilters().map(wu).join(" ,")+"}"}(n):"Filter"}var Xi=class extends it{constructor(t,e,r){super(t,e,r),this.key=M.fromName(r.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},Yi=class extends it{constructor(t,e){super(t,"in",e),this.keys=Eu("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Zi=class extends it{constructor(t,e){super(t,"not-in",e),this.keys=Eu("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Eu(n,t){return(t.arrayValue?.values||[]).map(e=>M.fromName(e.referenceValue))}var ts=class extends it{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return fo(e)&&Dn(e.arrayValue,this.value)}},es=class extends it{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Dn(this.value.arrayValue,e)}},ns=class extends it{constructor(t,e){super(t,"not-in",e)}matches(t){if(Dn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Dn(this.value.arrayValue,e)}},rs=class extends it{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!fo(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>Dn(this.value.arrayValue,r))}};var is=class{constructor(t,e=null,r=[],s=[],o=null,u=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=u,this.endAt=l,this.Te=null}};function vc(n,t=null,e=[],r=[],s=null,o=null,u=null){return new is(n,t,e,r,s,o,u)}function mo(n){let t=ot(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>Ji(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),Lr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>ke(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>ke(r)).join(",")),t.Te=e}return t.Te}function po(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!ud(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!_u(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Ic(n.startAt,t.startAt)&&Ic(n.endAt,t.endAt)}var Fe=class{constructor(t,e=null,r=[],s=[],o=null,u="F",l=null,f=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=u,this.startAt=l,this.endAt=f,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function hd(n,t,e,r,s,o,u,l){return new Fe(n,t,e,r,s,o,u,l)}function dd(n){return new Fe(n)}function Tc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function fd(n){return n.collectionGroup!==null}function vn(n){let t=ot(n);if(t.Ie===null){t.Ie=[];let e=new Set;for(let o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(u){let l=new dt(vt.comparator);return u.filters.forEach(f=>{f.getFlattenedFilters().forEach(g=>{g.isInequality()&&(l=l.add(g.field))})}),l})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new Me(o,r))}),e.has(vt.keyField().canonicalString())||t.Ie.push(new Me(vt.keyField(),r))}return t.Ie}function ue(n){let t=ot(n);return t.Ee||(t.Ee=md(t,vn(n))),t.Ee}function md(n,t){if(n.limitType==="F")return vc(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(s=>{let o=s.dir==="desc"?"asc":"desc";return new Me(s.field,o)});let e=n.endAt?new Oe(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Oe(n.startAt.position,n.startAt.inclusive):null;return vc(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function ss(n,t,e){return new Fe(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Iu(n,t){return po(ue(n),ue(t))&&n.limitType===t.limitType}function vu(n){return`${mo(ue(n))}|lt:${n.limitType}`}function wn(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(s=>wu(s)).join(", ")}]`),Lr(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(s=>function(u){return`${u.field.canonicalString()} (${u.dir})`}(s)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>ke(s)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>ke(s)).join(",")),`Target(${r})`}(ue(n))}; limitType=${n.limitType})`}function go(n,t){return t.isFoundDocument()&&function(r,s){let o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):M.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,t)&&function(r,s){for(let o of vn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(n,t)&&function(r,s){for(let o of r.filters)if(!o.matches(s))return!1;return!0}(n,t)&&function(r,s){return!(r.startAt&&!function(u,l,f){let g=Ec(u,l,f);return u.inclusive?g<=0:g<0}(r.startAt,vn(r),s)||r.endAt&&!function(u,l,f){let g=Ec(u,l,f);return u.inclusive?g>=0:g>0}(r.endAt,vn(r),s))}(n,t)}function pd(n){return(t,e)=>{let r=!1;for(let s of vn(n)){let o=gd(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function gd(n,t,e){let r=n.field.isKeyField()?M.comparator(t.key,e.key):function(o,u,l){let f=u.data.field(o),g=l.data.field(o);return f!==null&&g!==null?Ne(f,g):k(42886)}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return k(19790,{direction:n.dir})}}var qt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){ge(this.inner,(e,r)=>{for(let[s,o]of r)t(s,o)})}isEmpty(){return cu(this.inner)}size(){return this.innerSize}};var yd=new Tt(M.comparator);function os(){return yd}var Tu=new Tt(M.comparator);function lr(...n){let t=Tu;for(let e of n)t=t.insert(e.key,e);return t}function _d(n){let t=Tu;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function ae(){return Tn()}function Au(){return Tn()}function Tn(){return new qt(n=>n.toString(),(n,t)=>n.isEqual(t))}var Wf=new Tt(M.comparator),wd=new dt(M.comparator);function wt(...n){let t=wd;for(let e of n)t=t.add(e);return t}var Ed=new dt(q);function Id(){return Ed}function yo(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Cn(t)?"-0":t}}function bu(n){return{integerValue:""+n}}function vd(n,t){return Wh(t)?bu(t):yo(n,t)}var Le=class{constructor(){this._=void 0}};function Td(n,t,e){return n instanceof Be?function(s,o){let u={fields:{[lu]:{stringValue:uu},[du]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&uo(o)&&(o=Br(o)),o&&(u.fields[hu]=o),{mapValue:u}}(e,t):n instanceof fe?Su(n,t):n instanceof me?Ru(n,t):function(s,o){let u=bd(s,o),l=Ac(u)+Ac(s.Ae);return Wi(u)&&Wi(s.Ae)?bu(l):yo(s.serializer,l)}(n,t)}function Ad(n,t,e){return n instanceof fe?Su(n,t):n instanceof me?Ru(n,t):e}function bd(n,t){return n instanceof Ue?function(r){return Wi(r)||function(o){return!!o&&"doubleValue"in o}(r)}(t)?t:{integerValue:0}:null}var Be=class extends Le{},fe=class extends Le{constructor(t){super(),this.elements=t}};function Su(n,t){let e=Pu(t);for(let r of n.elements)e.some(s=>Pt(s,r))||e.push(r);return{arrayValue:{values:e}}}var me=class extends Le{constructor(t){super(),this.elements=t}};function Ru(n,t){let e=Pu(t);for(let r of n.elements)e=e.filter(s=>!Pt(s,r));return{arrayValue:{values:e}}}var Ue=class extends Le{constructor(t,e){super(),this.serializer=t,this.Ae=e}};function Ac(n){return K(n.integerValue||n.doubleValue)}function Pu(n){return fo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Sd(n,t){return n.field.isEqual(t.field)&&function(r,s){return r instanceof fe&&s instanceof fe||r instanceof me&&s instanceof me?De(r.elements,s.elements,Pt):r instanceof Ue&&s instanceof Ue?Pt(r.Ae,s.Ae):r instanceof Be&&s instanceof Be}(n.transform,t.transform)}var St=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function fr(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var qe=class{};function Cu(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new xn(n.key,St.none()):new pe(n.key,n.data,St.none());{let e=n.data,r=It.empty(),s=new dt(vt.comparator);for(let o of t.fields)if(!s.has(o)){let u=e.field(o);u===null&&o.length>1&&(o=o.popLast(),u=e.field(o)),u===null?r.delete(o):r.set(o,u),s=s.add(o)}return new jt(n.key,r,new bt(s.toArray()),St.none())}}function Rd(n,t,e){n instanceof pe?function(s,o,u){let l=s.value.clone(),f=Sc(s.fieldTransforms,o,u.transformResults);l.setAll(f),o.convertToFoundDocument(u.version,l).setHasCommittedMutations()}(n,t,e):n instanceof jt?function(s,o,u){if(!fr(s.precondition,o))return void o.convertToUnknownDocument(u.version);let l=Sc(s.fieldTransforms,o,u.transformResults),f=o.data;f.setAll(Vu(s)),f.setAll(l),o.convertToFoundDocument(u.version,f).setHasCommittedMutations()}(n,t,e):function(s,o,u){o.convertToNoDocument(u.version).setHasCommittedMutations()}(0,t,e)}function An(n,t,e,r){return n instanceof pe?function(o,u,l,f){if(!fr(o.precondition,u))return l;let g=o.value.clone(),v=Rc(o.fieldTransforms,f,u);return g.setAll(v),u.convertToFoundDocument(u.version,g).setHasLocalMutations(),null}(n,t,e,r):n instanceof jt?function(o,u,l,f){if(!fr(o.precondition,u))return l;let g=Rc(o.fieldTransforms,f,u),v=u.data;return v.setAll(Vu(o)),v.setAll(g),u.convertToFoundDocument(u.version,v).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(b=>b.field))}(n,t,e,r):function(o,u,l){return fr(o.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):l}(n,t,e)}function bc(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&De(r,s,(o,u)=>Sd(o,u))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var pe=class extends qe{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},jt=class extends qe{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function Vu(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function Sc(n,t,e){let r=new Map;tt(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let s=0;s<e.length;s++){let o=n[s],u=o.transform,l=t.data.field(o.field);r.set(o.field,Ad(u,l,e[s]))}return r}function Rc(n,t,e){let r=new Map;for(let s of n){let o=s.transform,u=e.data.field(s.field);r.set(s.field,Td(o,u,t))}return r}var xn=class extends qe{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ir=class extends qe{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var as=class{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let o=this.mutations[s];o.key.isEqual(t.key)&&Rd(o,t,r[s])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=An(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=An(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=Au();return this.mutations.forEach(s=>{let o=t.get(s.key),u=o.overlayedDocument,l=this.applyToLocalView(u,o.mutatedFields);l=e.has(s.key)?null:l;let f=Cu(u,l);f!==null&&r.set(s.key,f),u.isValidDocument()||u.convertToNoDocument($.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),wt())}isEqual(t){return this.batchId===t.batchId&&De(this.mutations,t.mutations,(e,r)=>bc(e,r))&&De(this.baseMutations,t.baseMutations,(e,r)=>bc(e,r))}};var cs=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var X,L;function Pd(n){switch(n){case S.OK:return k(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return k(15467,{code:n})}}function Cd(n){if(n===void 0)return Ge("GRPC error has no .code"),S.UNKNOWN;switch(n){case X.OK:return S.OK;case X.CANCELLED:return S.CANCELLED;case X.UNKNOWN:return S.UNKNOWN;case X.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case X.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case X.INTERNAL:return S.INTERNAL;case X.UNAVAILABLE:return S.UNAVAILABLE;case X.UNAUTHENTICATED:return S.UNAUTHENTICATED;case X.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case X.NOT_FOUND:return S.NOT_FOUND;case X.ALREADY_EXISTS:return S.ALREADY_EXISTS;case X.PERMISSION_DENIED:return S.PERMISSION_DENIED;case X.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case X.ABORTED:return S.ABORTED;case X.OUT_OF_RANGE:return S.OUT_OF_RANGE;case X.UNIMPLEMENTED:return S.UNIMPLEMENTED;case X.DATA_LOSS:return S.DATA_LOSS;default:return k(39323,{code:n})}}(L=X||(X={}))[L.OK=0]="OK",L[L.CANCELLED=1]="CANCELLED",L[L.UNKNOWN=2]="UNKNOWN",L[L.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",L[L.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",L[L.NOT_FOUND=5]="NOT_FOUND",L[L.ALREADY_EXISTS=6]="ALREADY_EXISTS",L[L.PERMISSION_DENIED=7]="PERMISSION_DENIED",L[L.UNAUTHENTICATED=16]="UNAUTHENTICATED",L[L.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",L[L.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",L[L.ABORTED=10]="ABORTED",L[L.OUT_OF_RANGE=11]="OUT_OF_RANGE",L[L.UNIMPLEMENTED=12]="UNIMPLEMENTED",L[L.INTERNAL=13]="INTERNAL",L[L.UNAVAILABLE=14]="UNAVAILABLE",L[L.DATA_LOSS=15]="DATA_LOSS";var Jf=new or([4294967295,4294967295],0);var us=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function ls(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Vd(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Dd(n,t){return ls(n,t.toTimestamp())}function bn(n){return tt(!!n,49232),$.fromTimestamp(function(e){let r=Ut(e);return new et(r.seconds,r.nanos)}(n))}function Du(n,t){return hs(n,t).canonicalString()}function hs(n,t){let e=function(s){return new W(["projects",s.projectId,"databases",s.database])}(n).child("documents");return t===void 0?e:e.child(t)}function xu(n){let t=W.fromString(n);return tt(Ou(t),10190,{key:t.toString()}),t}function vr(n,t){return Du(n.databaseId,t.path)}function Pc(n,t){let e=xu(t);if(e.get(1)!==n.databaseId.projectId)throw new C(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new C(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new M(Nu(e))}function xd(n){let t=xu(n);return t.length===4?W.emptyPath():Nu(t)}function Nu(n){return tt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Cc(n,t,e){return{name:vr(n,t),fields:e.value.mapValue.fields}}function Nd(n,t){return"found"in t?function(r,s){tt(!!s.found,43571),s.found.name,s.found.updateTime;let o=Pc(r,s.found.name),u=bn(s.found.updateTime),l=s.found.createTime?bn(s.found.createTime):$.min(),f=new It({mapValue:{fields:s.found.fields}});return Zt.newFoundDocument(o,u,l,f)}(n,t):"missing"in t?function(r,s){tt(!!s.missing,3894),tt(!!s.readTime,22933);let o=Pc(r,s.missing),u=bn(s.readTime);return Zt.newNoDocument(o,u)}(n,t):k(7234,{result:t})}function kd(n,t){let e;if(t instanceof pe)e={update:Cc(n,t.key,t.value)};else if(t instanceof xn)e={delete:vr(n,t.key)};else if(t instanceof jt)e={update:Cc(n,t.key,t.data),updateMask:Md(t.fieldMask)};else{if(!(t instanceof Ir))return k(16599,{Vt:t.type});e={verify:vr(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(o,u){let l=u.transform;if(l instanceof Be)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof fe)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof me)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ue)return{fieldPath:u.field.canonicalString(),increment:l.Ae};throw k(20930,{transform:u.transform})}(0,r))),t.precondition.isNone||(e.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:Dd(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:k(27497)}(n,t.precondition)),e}function Od(n){let t=xd(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,s=null;if(r>0){tt(r===1,65062);let v=e.from[0];v.allDescendants?s=v.collectionId:t=t.child(v.collectionId)}let o=[];e.where&&(o=function(b){let A=ku(b);return A instanceof te&&yu(A)?A.getFilters():[A]}(e.where));let u=[];e.orderBy&&(u=function(b){return b.map(A=>function(V){return new Me(Pe(V.field),function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(V.direction))}(A))}(e.orderBy));let l=null;e.limit&&(l=function(b){let A;return A=typeof b=="object"?b.value:b,Lr(A)?null:A}(e.limit));let f=null;e.startAt&&(f=function(b){let A=!!b.before,x=b.values||[];return new Oe(x,A)}(e.startAt));let g=null;return e.endAt&&(g=function(b){let A=!b.before,x=b.values||[];return new Oe(x,A)}(e.endAt)),hd(t,s,u,o,l,"F",f,g)}function ku(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=Pe(e.unaryFilter.field);return it.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=Pe(e.unaryFilter.field);return it.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=Pe(e.unaryFilter.field);return it.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let u=Pe(e.unaryFilter.field);return it.create(u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return k(61313);default:return k(60726)}}(n):n.fieldFilter!==void 0?function(e){return it.create(Pe(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return k(58110);default:return k(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return te.create(e.compositeFilter.filters.map(r=>ku(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return k(1026)}}(e.compositeFilter.op))}(n):k(30097,{filter:n})}function Pe(n){return vt.fromServerFormat(n.fieldPath)}function Md(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Ou(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ds=class{constructor(t){this.yt=t}};function Fd(n){let t=Od({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ss(t,t.limit,"L"):t}var Tr=class{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(K(t.integerValue));else if("doubleValue"in t){let r=K(t.doubleValue);isNaN(r)?this.Ft(e,13):(this.Ft(e,15),Cn(r)?e.Mt(0):e.Mt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Ft(e,20),typeof r=="string"&&(r=Ut(r)),e.xt(`${r.seconds||""}`),e.Mt(r.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(Xt(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Ft(e,45),e.Mt(r.latitude||0),e.Mt(r.longitude||0)}else"mapValue"in t?pu(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):mu(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):k(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){let r=t.fields||{};this.Ft(e,55);for(let s of Object.keys(r))this.Ot(s,e),this.Ct(r[s],e)}kt(t,e){let r=t.fields||{};this.Ft(e,53);let s=xe,o=r[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(K(o)),this.Ot(s,e),this.Ct(r[s],e)}Qt(t,e){let r=t.values||[];this.Ft(e,50);for(let s of r)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),M.fromName(t).path.forEach(r=>{this.Ft(e,60),this.Ut(r,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}};Tr.Kt=new Tr;var fs=class{constructor(){this.Cn=new ms}addToCollectionParentIndex(t,e){return this.Cn.add(e),R.resolve()}getCollectionParents(t,e){return R.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return R.resolve()}deleteFieldIndex(t,e){return R.resolve()}deleteAllFieldIndexes(t){return R.resolve()}createTargetIndexes(t,e){return R.resolve()}getDocumentsMatchingTarget(t,e){return R.resolve(null)}getIndexType(t,e){return R.resolve(0)}getFieldIndexes(t,e){return R.resolve([])}getNextCollectionGroupToUpdate(t){return R.resolve(null)}getMinOffset(t,e){return R.resolve(de.min())}getMinOffsetFromCollectionGroup(t,e){return R.resolve(de.min())}updateCollectionGroup(t,e,r){return R.resolve()}updateIndexEntries(t,e){return R.resolve()}},ms=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new dt(W.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new dt(W.comparator)).toArray()}};var Xf=new Uint8Array(0);var Vc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Mu=41943040,Et=class n{static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}};Et.DEFAULT_COLLECTION_PERCENTILE=10,Et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Et.DEFAULT=new Et(Mu,Et.DEFAULT_COLLECTION_PERCENTILE,Et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Et.DISABLED=new Et(-1,0,0);var Nn=class n{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new n(0)}static cr(){return new n(-1)}};var Dc="LruGarbageCollector",Ld=1048576;function xc([n,t],[e,r]){let s=q(n,e);return s===0?q(t,r):s}var ps=class{constructor(t){this.Ir=t,this.buffer=new dt(xc),this.Er=0}dr(){return++this.Er}Ar(t){let e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();xc(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},gs=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){D(Dc,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>N(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Fr(e)?D(Dc,"Ignoring IndexedDB error during garbage collection: ",e):yield Kh(e)}yield this.Vr(3e5)}))}},ys=class{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return R.resolve(Qc.ce);let r=new ps(e);return this.mr.forEachTarget(t,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(t,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.mr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(Vc)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Vc):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let r,s,o,u,l,f,g,v=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),s=this.params.maximumSequenceNumbersToCollect):s=b,u=Date.now(),this.nthSequenceNumber(t,s))).next(b=>(r=b,l=Date.now(),this.removeTargets(t,r,e))).next(b=>(o=b,f=Date.now(),this.removeOrphanedDocuments(t,r))).next(b=>(g=Date.now(),Re()<=F.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-v}ms
	Determined least recently used ${s} in `+(l-u)+`ms
	Removed ${o} targets in `+(f-l)+`ms
	Removed ${b} documents in `+(g-f)+`ms
Total Duration: ${g-v}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:b})))}};function Bd(n,t){return new ys(n,t)}var _s=class{constructor(){this.changes=new qt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Zt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?R.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var ws=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Es=class{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(r!==null&&An(r.mutation,s,bt.empty(),et.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,wt()).next(()=>r))}getLocalViewOfDocuments(t,e,r=wt()){let s=ae();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,r).next(o=>{let u=lr();return o.forEach((l,f)=>{u=u.insert(l,f.overlayedDocument)}),u}))}getOverlayedDocuments(t,e){let r=ae();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,wt()))}populateOverlays(t,e,r){let s=[];return r.forEach(o=>{e.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(t,s).next(o=>{o.forEach((u,l)=>{e.set(u,l)})})}computeViews(t,e,r,s){let o=os(),u=Tn(),l=function(){return Tn()}();return e.forEach((f,g)=>{let v=r.get(g.key);s.has(g.key)&&(v===void 0||v.mutation instanceof jt)?o=o.insert(g.key,g):v!==void 0?(u.set(g.key,v.mutation.getFieldMask()),An(v.mutation,g,v.mutation.getFieldMask(),et.now())):u.set(g.key,bt.empty())}),this.recalculateAndSaveOverlays(t,o).next(f=>(f.forEach((g,v)=>u.set(g,v)),e.forEach((g,v)=>l.set(g,new ws(v,u.get(g)??null))),l))}recalculateAndSaveOverlays(t,e){let r=Tn(),s=new Tt((u,l)=>u-l),o=wt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(u=>{for(let l of u)l.keys().forEach(f=>{let g=e.get(f);if(g===null)return;let v=r.get(f)||bt.empty();v=l.applyToLocalView(g,v),r.set(f,v);let b=(s.get(l.batchId)||wt()).add(f);s=s.insert(l.batchId,b)})}).next(()=>{let u=[],l=s.getReverseIterator();for(;l.hasNext();){let f=l.getNext(),g=f.key,v=f.value,b=Au();v.forEach(A=>{if(!o.has(A)){let x=Cu(e.get(A),r.get(A));x!==null&&b.set(A,x),o=o.add(A)}}),u.push(this.documentOverlayCache.saveOverlays(t,g,b))}return R.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,s){return function(u){return M.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):fd(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next(o=>{let u=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):R.resolve(ae()),l=Pn,f=o;return u.next(g=>R.forEach(g,(v,b)=>(l<b.largestBatchId&&(l=b.largestBatchId),o.get(v)?R.resolve():this.remoteDocumentCache.getEntry(t,v).next(A=>{f=f.insert(v,A)}))).next(()=>this.populateOverlays(t,g,o)).next(()=>this.computeViews(t,f,g,wt())).next(v=>({batchId:l,changes:_d(v)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(r=>{let s=lr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){let o=e.collectionGroup,u=lr();return this.indexManager.getCollectionParents(t,o).next(l=>R.forEach(l,f=>{let g=function(b,A){return new Fe(A,null,b.explicitOrderBy.slice(),b.filters.slice(),b.limit,b.limitType,b.startAt,b.endAt)}(e,f.child(o));return this.getDocumentsMatchingCollectionQuery(t,g,r,s).next(v=>{v.forEach((b,A)=>{u=u.insert(b,A)})})}).next(()=>u))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(u=>(o=u,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s))).next(u=>{o.forEach((f,g)=>{let v=g.getKey();u.get(v)===null&&(u=u.insert(v,Zt.newInvalidDocument(v)))});let l=lr();return u.forEach((f,g)=>{let v=o.get(f);v!==void 0&&An(v.mutation,g,bt.empty(),et.now()),go(e,g)&&(l=l.insert(f,g))}),l})}};var Is=class{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return R.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:bn(s.createTime)}}(e)),R.resolve()}getNamedQuery(t,e){return R.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(s){return{name:s.name,query:Fd(s.bundledQuery),readTime:bn(s.readTime)}}(e)),R.resolve()}};var vs=class{constructor(){this.overlays=new Tt(M.comparator),this.qr=new Map}getOverlay(t,e){return R.resolve(this.overlays.get(e))}getOverlays(t,e){let r=ae();return R.forEach(e,s=>this.getOverlay(t,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((s,o)=>{this.St(t,e,o)}),R.resolve()}removeOverlaysForBatchId(t,e,r){let s=this.qr.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.qr.delete(r)),R.resolve()}getOverlaysForCollection(t,e,r){let s=ae(),o=e.length+1,u=new M(e.child("")),l=this.overlays.getIteratorFrom(u);for(;l.hasNext();){let f=l.getNext().value,g=f.getKey();if(!e.isPrefixOf(g.path))break;g.path.length===o&&f.largestBatchId>r&&s.set(f.getKey(),f)}return R.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new Tt((g,v)=>g-v),u=this.overlays.getIterator();for(;u.hasNext();){let g=u.getNext().value;if(g.getKey().getCollectionGroup()===e&&g.largestBatchId>r){let v=o.get(g.largestBatchId);v===null&&(v=ae(),o=o.insert(g.largestBatchId,v)),v.set(g.getKey(),g)}}let l=ae(),f=o.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((g,v)=>l.set(g,v)),!(l.size()>=s)););return R.resolve(l)}St(t,e,r){let s=this.overlays.get(r.key);if(s!==null){let u=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new cs(e,r));let o=this.qr.get(e);o===void 0&&(o=wt(),this.qr.set(e,o)),this.qr.set(e,o.add(r.key))}};var Ts=class{constructor(){this.sessionToken=Bt.EMPTY_BYTE_STRING}getSessionToken(t){return R.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,R.resolve()}};var kn=class{constructor(){this.Qr=new dt(Y.$r),this.Ur=new dt(Y.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){let r=new Y(t,e);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Gr(new Y(t,e))}zr(t,e){t.forEach(r=>this.removeReference(r,e))}jr(t){let e=new M(new W([])),r=new Y(e,t),s=new Y(e,t+1),o=[];return this.Ur.forEachInRange([r,s],u=>{this.Gr(u),o.push(u.key)}),o}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){let e=new M(new W([])),r=new Y(e,t),s=new Y(e,t+1),o=wt();return this.Ur.forEachInRange([r,s],u=>{o=o.add(u.key)}),o}containsKey(t){let e=new Y(t,0),r=this.Qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},Y=class{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return M.comparator(t.key,e.key)||q(t.Yr,e.Yr)}static Kr(t,e){return q(t.Yr,e.Yr)||M.comparator(t.key,e.key)}};var As=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new dt(Y.$r)}checkEmpty(t){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){let o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let u=new as(o,e,r,s);this.mutationQueue.push(u);for(let l of s)this.Zr=this.Zr.add(new Y(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return R.resolve(u)}lookupMutationBatch(t,e){return R.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,s=this.ei(r),o=s<0?0:s;return R.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?Hh:this.tr-1)}getAllMutationBatches(t){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new Y(e,0),s=new Y(e,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],u=>{let l=this.Xr(u.Yr);o.push(l)}),R.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new dt(q);return e.forEach(s=>{let o=new Y(s,0),u=new Y(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,u],l=>{r=r.add(l.Yr)})}),R.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,s=r.length+1,o=r;M.isDocumentKey(o)||(o=o.child(""));let u=new Y(new M(o),0),l=new dt(q);return this.Zr.forEachWhile(f=>{let g=f.key.path;return!!r.isPrefixOf(g)&&(g.length===s&&(l=l.add(f.Yr)),!0)},u),R.resolve(this.ti(l))}ti(t){let e=[];return t.forEach(r=>{let s=this.Xr(r);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){tt(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return R.forEach(e.mutations,s=>{let o=new Y(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Zr=r})}ir(t){}containsKey(t,e){let r=new Y(e,0),s=this.Zr.firstAfterOrEqual(r);return R.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,R.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){let e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var bs=class{constructor(t){this.ri=t,this.docs=function(){return new Tt(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,s=this.docs.get(r),o=s?s.size:0,u=this.ri(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:u}),this.size+=u-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return R.resolve(r?r.document.mutableCopy():Zt.newInvalidDocument(e))}getEntries(t,e){let r=os();return e.forEach(s=>{let o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Zt.newInvalidDocument(s))}),R.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=os(),u=e.path,l=new M(u.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(l);for(;f.hasNext();){let{key:g,value:{document:v}}=f.getNext();if(!u.isPrefixOf(g.path))break;g.path.length>u.length+1||$h(zh(v),r)<=0||(s.has(v.key)||go(e,v))&&(o=o.insert(v.key,v.mutableCopy()))}return R.resolve(o)}getAllFromCollectionGroup(t,e,r,s){k(9500)}ii(t,e){return R.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new Ss(this)}getSize(t){return R.resolve(this.size)}},Ss=class extends _s{constructor(t){super(),this.Nr=t}applyChanges(t){let e=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(r)}),R.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}};var Rs=class{constructor(t){this.persistence=t,this.si=new qt(e=>mo(e),po),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.oi=0,this._i=new kn,this.targetCount=0,this.ai=Nn.ur()}forEachTarget(t,e){return this.si.forEach((r,s)=>e(s)),R.resolve()}getLastRemoteSnapshotVersion(t){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return R.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.oi&&(this.oi=e),R.resolve()}Pr(t){this.si.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.ai=new Nn(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,R.resolve()}updateTargetData(t,e){return this.Pr(e),R.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,R.resolve()}removeTargets(t,e,r){let s=0,o=[];return this.si.forEach((u,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.si.delete(u),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)}),R.waitFor(o).next(()=>s)}getTargetCount(t){return R.resolve(this.targetCount)}getTargetData(t,e){let r=this.si.get(e)||null;return R.resolve(r)}addMatchingKeys(t,e,r){return this._i.Wr(e,r),R.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);let s=this.persistence.referenceDelegate,o=[];return s&&e.forEach(u=>{o.push(s.markPotentiallyOrphaned(t,u))}),R.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),R.resolve()}getMatchingKeysForTargetId(t,e){let r=this._i.Hr(e);return R.resolve(r)}containsKey(t,e){return R.resolve(this._i.containsKey(e))}};var Ar=class{constructor(t,e){this.ui={},this.overlays={},this.ci=new Qc(0),this.li=!1,this.li=!0,this.hi=new Ts,this.referenceDelegate=t(this),this.Pi=new Rs(this),this.indexManager=new fs,this.remoteDocumentCache=function(s){return new bs(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new ds(e),this.Ii=new Is(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new vs,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ui[t.toKey()];return r||(r=new As(e,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,r){D("MemoryPersistence","Starting transaction:",t);let s=new Ps(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(o=>this.referenceDelegate.di(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Ai(t,e){return R.or(Object.values(this.ui).map(r=>()=>r.containsKey(t,e)))}},Ps=class extends Gi{constructor(t){super(),this.currentSequenceNumber=t}},Cs=class n{constructor(t){this.persistence=t,this.Ri=new kn,this.Vi=null}static mi(t){return new n(t)}get fi(){if(this.Vi)return this.Vi;throw k(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.fi.delete(r.toString()),R.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.fi.add(r.toString()),R.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),R.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(s=>this.fi.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(o=>this.fi.add(o.toString()))}).next(()=>r.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.fi,r=>{let s=M.fromPath(r);return this.gi(t,s).next(o=>{o||e.removeEntry(s,$.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(r=>{r?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return R.or([()=>R.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}},br=class n{constructor(t,e){this.persistence=t,this.pi=new qt(r=>Jh(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Bd(this,e)}static mi(t,e){return new n(t,e)}Ei(){}di(t){return R.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){let e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>e.next(s=>r+s))}wr(t){let e=0;return this.pr(t,r=>{e++}).next(()=>e)}pr(t,e){return R.forEach(this.pi,(r,s)=>this.br(t,r,s).next(o=>o?R.resolve():e(s)))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0,s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(t,u=>this.br(t,u,e).next(l=>{l||(r++,o.removeEntry(u,$.min()))})).next(()=>o.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),R.resolve()}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),R.resolve()}removeReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),R.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),R.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=dr(t.data.value)),e}br(t,e,r){return R.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.pi.get(e);return R.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var Vs=class n{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Es=r,this.ds=s}static As(t,e){let r=wt(),s=wt();for(let o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new n(t,e.fromCache,r,s)}};var Ds=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var xs=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return Ha()?8:Qh(Qa())>0?6:4}()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,s){let o={result:null};return this.ys(t,e).next(u=>{o.result=u}).next(()=>{if(!o.result)return this.ws(t,e,s,r).next(u=>{o.result=u})}).next(()=>{if(o.result)return;let u=new Ds;return this.Ss(t,e,u).next(l=>{if(o.result=l,this.Vs)return this.bs(t,e,u,l.size)})}).next(()=>o.result)}bs(t,e,r,s){return r.documentReadCount<this.fs?(Re()<=F.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",wn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),R.resolve()):(Re()<=F.DEBUG&&D("QueryEngine","Query:",wn(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Re()<=F.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",wn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,ue(e))):R.resolve())}ys(t,e){if(Tc(e))return R.resolve(null);let r=ue(e);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=ss(e,null,"F"),r=ue(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(o=>{let u=wt(...o);return this.ps.getDocuments(t,u).next(l=>this.indexManager.getMinOffset(t,r).next(f=>{let g=this.Ds(e,l);return this.Cs(e,g,u,f.readTime)?this.ys(t,ss(e,null,"F")):this.vs(t,g,e,f)}))})))}ws(t,e,r,s){return Tc(e)||s.isEqual($.min())?R.resolve(null):this.ps.getDocuments(t,r).next(o=>{let u=this.Ds(e,o);return this.Cs(e,u,r,s)?R.resolve(null):(Re()<=F.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),wn(e)),this.vs(t,u,e,jh(s,Pn)).next(l=>l))})}Ds(t,e){let r=new dt(pd(t));return e.forEach((s,o)=>{go(t,o)&&(r=r.add(o))}),r}Cs(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(t,e,r){return Re()<=F.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",wn(e)),this.ps.getDocumentsMatchingQuery(t,e,de.min(),r)}vs(t,e,r,s){return this.ps.getDocumentsMatchingQuery(t,r,s).next(o=>(e.forEach(u=>{o=o.insert(u.key,u)}),o))}};var Ud="LocalStore";var Ns=class{constructor(t,e,r,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new Tt(q),this.xs=new qt(o=>mo(o),po),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Es(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}};function qd(n,t,e,r){return new Ns(n,t,e,r)}function Fu(n,t){return N(this,null,function*(){let e=ot(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,e.Bs(t),e.mutationQueue.getAllMutationBatches(r))).next(o=>{let u=[],l=[],f=wt();for(let g of s){u.push(g.batchId);for(let v of g.mutations)f=f.add(v.key)}for(let g of o){l.push(g.batchId);for(let v of g.mutations)f=f.add(v.key)}return e.localDocuments.getDocuments(r,f).next(g=>({Ls:g,removedBatchIds:u,addedBatchIds:l}))})})})}var Sr=class{constructor(){this.activeTargetIds=Id()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var ks=class{constructor(){this.Mo=new Sr,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,r){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Sr,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Os=class{Oo(t){}shutdown(){}};var Nc="ConnectivityMonitor",Rr=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){D(Nc,"Network connectivity changed: AVAILABLE");for(let t of this.qo)t(0)}ko(){D(Nc,"Network connectivity changed: UNAVAILABLE");for(let t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var hr=null;function Ms(){return hr===null?hr=function(){return 268435456+Math.round(2147483648*Math.random())}():hr++,"0x"+hr.toString(16)}var ki="RestConnection",jd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Fs=class{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===_r?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(t,e,r,s,o){let u=Ms(),l=this.zo(t,e.toUriEncodedString());D(ki,`Sending RPC '${t}' ${u}:`,l,r);let f={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(f,s,o);let{host:g}=new URL(l),v=rr(g);return this.Jo(t,l,f,r,v).then(b=>(D(ki,`Received RPC '${t}' ${u}: `,b),b),b=>{throw Mr(ki,`RPC '${t}' ${u} failed with error: `,b,"url: ",l,"request:",r),b})}Ho(t,e,r,s,o,u){return this.Go(t,e,r,s,o)}jo(t,e,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+$e}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}zo(t,e){let r=jd[t];return`${this.Uo}/v1/${e}:${r}`}terminate(){}};var Ls=class{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}};var ht="WebChannelConnection",Bs=class extends Fs{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,s,o){let u=Ms();return new Promise((l,f)=>{let g=new Ri;g.setWithCredentials(!0),g.listenOnce(Pi.COMPLETE,()=>{try{switch(g.getLastErrorCode()){case _n.NO_ERROR:let b=g.getResponseJson();D(ht,`XHR for RPC '${t}' ${u} received:`,JSON.stringify(b)),l(b);break;case _n.TIMEOUT:D(ht,`RPC '${t}' ${u} timed out`),f(new C(S.DEADLINE_EXCEEDED,"Request time out"));break;case _n.HTTP_ERROR:let A=g.getStatus();if(D(ht,`RPC '${t}' ${u} failed with status:`,A,"response text:",g.getResponseText()),A>0){let x=g.getResponseJson();Array.isArray(x)&&(x=x[0]);let V=x?.error;if(V&&V.status&&V.message){let B=function(nt){let Q=nt.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(Q)>=0?Q:S.UNKNOWN}(V.status);f(new C(B,V.message))}else f(new C(S.UNKNOWN,"Server responded with status "+g.getStatus()))}else f(new C(S.UNAVAILABLE,"Connection failed."));break;default:k(9055,{l_:t,streamId:u,h_:g.getLastErrorCode(),P_:g.getLastError()})}}finally{D(ht,`RPC '${t}' ${u} completed.`)}});let v=JSON.stringify(s);D(ht,`RPC '${t}' ${u} sending request:`,s),g.send(e,"POST",v,r,15)})}T_(t,e,r){let s=Ms(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],u=Di(),l=Vi(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;g!==void 0&&(f.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,e,r),f.encodeInitMessageHeaders=!0;let v=o.join("");D(ht,`Creating RPC '${t}' stream ${s}: ${v}`,f);let b=u.createWebChannel(v,f);this.I_(b);let A=!1,x=!1,V=new Ls({Yo:O=>{x?D(ht,`Not sending because RPC '${t}' stream ${s} is closed:`,O):(A||(D(ht,`Opening RPC '${t}' stream ${s} transport.`),b.open(),A=!0),D(ht,`RPC '${t}' stream ${s} sending:`,O),b.send(O))},Zo:()=>b.close()}),B=(O,nt,Q)=>{O.listen(nt,G=>{try{Q(G)}catch(ft){setTimeout(()=>{throw ft},0)}})};return B(b,Se.EventType.OPEN,()=>{x||(D(ht,`RPC '${t}' stream ${s} transport opened.`),V.o_())}),B(b,Se.EventType.CLOSE,()=>{x||(x=!0,D(ht,`RPC '${t}' stream ${s} transport closed`),V.a_(),this.E_(b))}),B(b,Se.EventType.ERROR,O=>{x||(x=!0,Mr(ht,`RPC '${t}' stream ${s} transport errored. Name:`,O.name,"Message:",O.message),V.a_(new C(S.UNAVAILABLE,"The operation could not be completed")))}),B(b,Se.EventType.MESSAGE,O=>{if(!x){let nt=O.data[0];tt(!!nt,16349);let Q=nt,G=Q?.error||Q[0]?.error;if(G){D(ht,`RPC '${t}' stream ${s} received error:`,G);let ft=G.status,zt=function(d){let p=X[d];if(p!==void 0)return Cd(p)}(ft),yt=G.message;zt===void 0&&(zt=S.INTERNAL,yt="Unknown error status: "+ft+" with message "+G.message),x=!0,V.a_(new C(zt,yt)),b.close()}else D(ht,`RPC '${t}' stream ${s} received:`,nt),V.u_(nt)}}),B(l,Ci.STAT_EVENT,O=>{O.stat===cr.PROXY?D(ht,`RPC '${t}' stream ${s} detected buffering proxy`):O.stat===cr.NOPROXY&&D(ht,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{V.__()},0),V}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}};function Oi(){return typeof document<"u"?document:null}function Ur(n){return new us(n,!0)}var Pr=class{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Mi=t,this.timerId=e,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();let e=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-r);s>0&&D("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var Us=class{},qs=class extends Us{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new C(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Go(t,hs(e,r),s,o,u)).catch(o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new C(S.UNKNOWN,o.toString())})}Ho(t,e,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,l])=>this.connection.Ho(t,hs(e,r),s,u,l,o)).catch(u=>{throw u.name==="FirebaseError"?(u.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new C(S.UNKNOWN,u.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},js=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ge(e),this.aa=!1):D("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var _o="RemoteStore",zs=class{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo(u=>{r.enqueueAndForget(()=>N(this,null,function*(){Eo(this)&&(D(_o,"Restarting streams for network reachability change."),yield function(f){return N(this,null,function*(){let g=ot(f);g.Ea.add(4),yield qr(g),g.Ra.set("Unknown"),g.Ea.delete(4),yield wo(g)})}(this))}))}),this.Ra=new js(r,s)}};function wo(n){return N(this,null,function*(){if(Eo(n))for(let t of n.da)yield t(!0)})}function qr(n){return N(this,null,function*(){for(let t of n.da)yield t(!1)})}function Eo(n){return ot(n).Ea.size===0}function kc(n,t){return N(this,null,function*(){let e=ot(n);e.asyncQueue.verifyOperationInProgress(),D(_o,"RemoteStore received new credentials");let r=Eo(e);e.Ea.add(3),yield qr(e),r&&e.Ra.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),yield wo(e)})}function zd(n,t){return N(this,null,function*(){let e=ot(n);t?(e.Ea.delete(2),yield wo(e)):t||(e.Ea.add(2),yield qr(e),e.Ra.set("Unknown"))})}var $s=class n{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new Ft,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){let u=Date.now()+r,l=new n(t,e,u,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new C(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function $d(n,t){if(Ge("AsyncQueue",`${t}: ${n}`),Fr(n))return new C(S.UNAVAILABLE,`${t}: ${n}`);throw n}var Gs=class{constructor(){this.queries=Oc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){let s=ot(e),o=s.queries;s.queries=Oc(),o.forEach((u,l)=>{for(let f of l.Sa)f.onError(r)})})(this,new C(S.ABORTED,"Firestore shutting down"))}};function Oc(){return new qt(n=>vu(n),Iu)}function Gd(n){n.Ca.forEach(t=>{t.next()})}var Mc,Fc;(Fc=Mc||(Mc={})).Ma="default",Fc.Cache="cache";var Kd="SyncEngine";var Ks=class{constructor(t,e,r,s,o,u){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=u,this.Pu={},this.Tu=new qt(l=>vu(l),Iu),this.Iu=new Map,this.Eu=new Set,this.du=new Tt(M.comparator),this.Au=new Map,this.Ru=new kn,this.Vu={},this.mu=new Map,this.fu=Nn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function Lc(n,t,e){let r=ot(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let s=[];r.Tu.forEach((o,u)=>{let l=u.view.va(t);l.snapshot&&s.push(l.snapshot)}),function(u,l){let f=ot(u);f.onlineState=l;let g=!1;f.queries.forEach((v,b)=>{for(let A of b.Sa)A.va(l)&&(g=!0)}),g&&Gd(f)}(r.eventManager,t),s.length&&r.Pu.H_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Qd(n,t,e){return N(this,null,function*(){let r=ot(n),s=[],o=[],u=[];r.Tu.isEmpty()||(r.Tu.forEach((l,f)=>{u.push(r.pu(f,t,e).then(g=>{if((g||e)&&r.isPrimaryClient){let v=g?!g.fromCache:e?.targetChanges.get(f.targetId)?.current;r.sharedClientState.updateQueryState(f.targetId,v?"current":"not-current")}if(g){s.push(g);let v=Vs.As(f.targetId,g);o.push(v)}}))}),yield Promise.all(u),r.Pu.H_(s),yield function(f,g){return N(this,null,function*(){let v=ot(f);try{yield v.persistence.runTransaction("notifyLocalViewChanges","readwrite",b=>R.forEach(g,A=>R.forEach(A.Es,x=>v.persistence.referenceDelegate.addReference(b,A.targetId,x)).next(()=>R.forEach(A.ds,x=>v.persistence.referenceDelegate.removeReference(b,A.targetId,x)))))}catch(b){if(!Fr(b))throw b;D(Ud,"Failed to update sequence numbers: "+b)}for(let b of g){let A=b.targetId;if(!b.fromCache){let x=v.Ms.get(A),V=x.snapshotVersion,B=x.withLastLimboFreeSnapshotVersion(V);v.Ms=v.Ms.insert(A,B)}}})}(r.localStore,o))})}function Hd(n,t){return N(this,null,function*(){let e=ot(n);if(!e.currentUser.isEqual(t)){D(Kd,"User change. New user:",t.toKey());let r=yield Fu(e.localStore,t);e.currentUser=t,function(o,u){o.mu.forEach(l=>{l.forEach(f=>{f.reject(new C(S.CANCELLED,u))})}),o.mu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield Qd(e,r.Ls)}})}var Lu=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return N(this,null,function*(){this.serializer=Ur(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)})}Fu(e,r){return null}Mu(e,r){return null}vu(e){return qd(this.persistence,new xs,e.initialUser,this.serializer)}Cu(e){return new Ar(Cs.mi,this.serializer)}Du(e){return new ks}terminate(){return N(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Qs=class extends Lu{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){tt(this.persistence.referenceDelegate instanceof br,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new gs(r,t.asyncQueue,e)}Cu(t){let e=this.cacheSizeBytes!==void 0?Et.withCacheSize(this.cacheSizeBytes):Et.DEFAULT;return new Ar(r=>br.mi(r,e),this.serializer)}};var Wd=(()=>{class n{initialize(e,r){return N(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Lc(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Hd.bind(null,this.syncEngine),yield zd(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Gs}()}createDatastore(e){let r=Ur(e.databaseInfo.databaseId),s=function(u){return new Bs(u)}(e.databaseInfo);return function(u,l,f,g){return new qs(u,l,f,g)}(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return function(s,o,u,l,f){return new zs(s,o,u,l,f)}(this.localStore,this.datastore,e.asyncQueue,r=>Lc(this.syncEngine,r,0),function(){return Rr.v()?new Rr:new Os}())}createSyncEngine(e,r){return function(o,u,l,f,g,v,b){let A=new Ks(o,u,l,f,g,v);return b&&(A.gu=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}terminate(){return N(this,null,function*(){yield function(r){return N(this,null,function*(){let s=ot(r);D(_o,"RemoteStore shutting down."),s.Ea.add(5),yield qr(s),s.Aa.shutdown(),s.Ra.set("Unknown")})}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return n.provider={build:()=>new n},n})();var Hs=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new C(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(s,o){return N(this,null,function*(){let u=ot(s),l={documents:o.map(b=>vr(u.serializer,b))},f=yield u.Ho("BatchGetDocuments",u.serializer.databaseId,W.emptyPath(),l,o.length),g=new Map;f.forEach(b=>{let A=Nd(u.serializer,b);g.set(A.key.toString(),A)});let v=[];return o.forEach(b=>{let A=g.get(b.toString());tt(!!A,55234,{key:b}),v.push(A)}),v})}(this.datastore,t);return e.forEach(r=>this.recordVersion(r)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new xn(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,r)=>{let s=M.fromPath(r);this.mutations.push(new Ir(s,this.precondition(s)))}),yield function(r,s){return N(this,null,function*(){let o=ot(r),u={writes:s.map(l=>kd(o.serializer,l))};yield o.Go("Commit",o.serializer.databaseId,W.emptyPath(),u)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw k(50498,{Gu:t.constructor.name});e=$.min()}let r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new C(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual($.min())?St.exists(!1):St.updateTime(e):St.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual($.min()))throw new C(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return St.updateTime(e)}return St.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var Ws=class{constructor(t,e,r,s,o){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=s,this.deferred=o,this.zu=r.maxAttempts,this.M_=new Pr(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(()=>N(this,null,function*(){let t=new Hs(this.datastore),e=this.Hu(t);e&&e.then(r=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})}))}Hu(t){try{let e=this.updateFunction(t);return!Lr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Yu(t){this.zu>0&&this.Zu(t)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(t)}Zu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Pd(e)}return!1}};var ee="FirestoreClient",Js=class{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=rt.UNAUTHENTICATED,this.clientId=Rn.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,u=>N(this,null,function*(){D(ee,"Received user=",u.uid),yield this.authCredentialListener(u),this.user=u})),this.appCheckCredentials.start(r,u=>(D(ee,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new Ft;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=$d(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Mi(n,t){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),D(ee,"Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(s=>N(null,null,function*(){r.isEqual(s)||(yield Fu(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function Bc(n,t){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield Jd(n);D(ee,"Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>kc(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>kc(t.remoteStore,s)),n._onlineComponents=t})}function Jd(n){return N(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){D(ee,"Using user provided OfflineComponentProvider");try{yield Mi(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;Mr("Error using user provided cache. Falling back to memory cache: "+e),yield Mi(n,new Lu)}}else D(ee,"Using default OfflineComponentProvider"),yield Mi(n,new Qs(void 0));return n._offlineComponents})}function Xd(n){return N(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(D(ee,"Using user provided OnlineComponentProvider"),yield Bc(n,n._uninitializedComponentsProvider._online)):(D(ee,"Using default OnlineComponentProvider"),yield Bc(n,new Wd))),n._onlineComponents})}function Yd(n){return Xd(n).then(t=>t.datastore)}function Bu(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Uc=new Map;var Uu="firestore.googleapis.com",qc=!0,Cr=class{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new C(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Uu,this.ssl=qc}else this.host=t.host,this.ssl=t.ssl??qc;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Mu;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Ld)throw new C(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}qh("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Bu(t.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new C(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},On=class{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Cr({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new C(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new C(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Cr(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Fi;switch(r.type){case"firstParty":return new qi(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new C(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return N(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=Uc.get(e);r&&(D("ComponentProvider","Removing Datastore"),Uc.delete(e),r.terminate())}(this),Promise.resolve()}};function Zd(n,t,e,r={}){n=Kc(n,On);let s=rr(t),o=n._getSettings(),u=ve(J({},o),{emulatorOptions:n._getEmulatorOptions()}),l=`${t}:${e}`;s&&($a(`https://${l}`),Ka("Firestore",!0)),o.host!==Uu&&o.host!==l&&Mr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let f=ve(J({},o),{host:l,ssl:s,emulatorOptions:r});if(!Te(f,u)&&(n._setSettings(f),r.mockUserToken)){let g,v;if(typeof r.mockUserToken=="string")g=r.mockUserToken,v=rt.MOCK_USER;else{g=Ga(r.mockUserToken,n._app?.options.projectId);let b=r.mockUserToken.sub||r.mockUserToken.user_id;if(!b)throw new C(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");v=new rt(b)}n._authCredentials=new Li(new mr(g,v))}}var Xs=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},gt=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mn(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(Ln(e,n._jsonSchema))return new n(t,r||null,new M(W.fromString(e.referencePath)))}};gt._jsonSchemaVersion="firestore/documentReference/1.0",gt._jsonSchema={type:Z("string",gt._jsonSchemaVersion),referencePath:Z("string")};var Mn=class n extends Xs{constructor(t,e,r){super(t,e,dd(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new gt(this.firestore,null,new M(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function qu(n,t,...e){if(n=Nt(n),arguments.length===1&&(t=Rn.newId()),Uh("doc","path",t),n instanceof On){let r=W.fromString(t,...e);return fc(r),new gt(n,null,new M(r))}{if(!(n instanceof gt||n instanceof Mn))throw new C(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(W.fromString(t,...e));return fc(r),new gt(n.firestore,n instanceof Mn?n.converter:null,new M(r))}}var jc="AsyncQueue",Vr=class{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Pr(this,"async_queue_retry"),this._c=()=>{let r=Oi();r&&D(jc,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;let e=Oi();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;let e=Oi();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});let e=new Ft;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}lc(){return N(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Fr(t))throw t;D(jc,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(t){let e=this.ac.then(()=>(this.rc=!0,t().catch(r=>{throw this.nc=r,this.rc=!1,Ge("INTERNAL UNHANDLED ERROR: ",zc(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);let s=$s.createAndSchedule(this,t,e,r,o=>this.hc(o));return this.tc.push(s),s}uc(){this.nc&&k(47125,{Pc:zc(this.nc)})}verifyOperationInProgress(){}Tc(){return N(this,null,function*(){let t;do t=this.ac,yield t;while(t!==this.ac)})}Ic(t){for(let e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){let e=this.tc.indexOf(t);this.tc.splice(e,1)}};function zc(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}var Dr=class extends On{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new Vr,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return N(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new Vr(t),this._firestoreClient=void 0,yield t}})}};function ju(n,t){let e=typeof n=="object"?n:ic(),r=typeof n=="string"?n:t||_r,s=ec(e,"firestore").getImmediate({identifier:r});if(!s._initialized){let o=za("firestore");o&&Zd(s,...o)}return s}function tf(n){if(n._terminated)throw new C(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||ef(n),n._firestoreClient}function ef(n){let t=n._freezeSettings(),e=function(s,o,u,l){return new Qi(s,o,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Bu(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)}(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new Js(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&function(s){let o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}}(n._componentsProvider))}var Lt=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(Bt.fromBase64String(t))}catch(e){throw new C(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(Bt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Ln(t,n._jsonSchema))return n.fromBase64String(t.bytes)}};Lt._jsonSchemaVersion="firestore/bytes/1.0",Lt._jsonSchema={type:Z("string",Lt._jsonSchemaVersion),bytes:Z("string")};var je=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new C(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new vt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Fn=class{constructor(t){this._methodName=t}};var Wt=class n{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new C(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new C(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return q(this._lat,t._lat)||q(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(t){if(Ln(t,n._jsonSchema))return new n(t.latitude,t.longitude)}};Wt._jsonSchemaVersion="firestore/geoPoint/1.0",Wt._jsonSchema={type:Z("string",Wt._jsonSchemaVersion),latitude:Z("number"),longitude:Z("number")};var Jt=class n{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}(this._values,t._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Ln(t,n._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new n(t.vectorValues);throw new C(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Jt._jsonSchemaVersion="firestore/vectorValue/1.0",Jt._jsonSchema={type:Z("string",Jt._jsonSchemaVersion),vectorValues:Z("object")};var nf=/^__.*__$/,Ys=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new jt(t,this.data,this.fieldMask,e,this.fieldTransforms):new pe(t,this.data,e,this.fieldTransforms)}},xr=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new jt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function zu(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw k(40011,{Ac:n})}}var Zs=class n{constructor(t,e,r,s,o,u){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new n(J(J({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){let e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.gc(t),r}yc(t){let e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return kr(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(zu(this.Ac)&&nf.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}},to=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||Ur(t)}Cc(t,e,r,s=!1){return new Zs({Ac:t,methodName:e,Dc:r,path:vt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function rf(n){let t=n._freezeSettings(),e=Ur(n._databaseId);return new to(n._databaseId,!!t.ignoreUndefinedProperties,e)}function sf(n,t,e,r,s,o={}){let u=n.Cc(o.merge||o.mergeFields?2:0,t,e,s);Io("Data must be an object, but it was:",u,r);let l=$u(r,u),f,g;if(o.merge)f=new bt(u.fieldMask),g=u.fieldTransforms;else if(o.mergeFields){let v=[];for(let b of o.mergeFields){let A=eo(t,b,e);if(!u.contains(A))throw new C(S.INVALID_ARGUMENT,`Field '${A}' is specified in your field mask but missing from your input data.`);Ku(v,A)||v.push(A)}f=new bt(v),g=u.fieldTransforms.filter(b=>f.covers(b.field))}else f=null,g=u.fieldTransforms;return new Ys(new It(l),f,g)}var Nr=class n extends Fn{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function of(n,t,e,r){let s=n.Cc(1,t,e);Io("Data must be an object, but it was:",s,r);let o=[],u=It.empty();ge(r,(f,g)=>{let v=vo(t,f,e);g=Nt(g);let b=s.yc(v);if(g instanceof Nr)o.push(v);else{let A=jr(g,b);A!=null&&(o.push(v),u.set(v,A))}});let l=new bt(o);return new xr(u,l,s.fieldTransforms)}function af(n,t,e,r,s,o){let u=n.Cc(1,t,e),l=[eo(t,r,e)],f=[s];if(o.length%2!=0)throw new C(S.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let A=0;A<o.length;A+=2)l.push(eo(t,o[A])),f.push(o[A+1]);let g=[],v=It.empty();for(let A=l.length-1;A>=0;--A)if(!Ku(g,l[A])){let x=l[A],V=f[A];V=Nt(V);let B=u.yc(x);if(V instanceof Nr)g.push(x);else{let O=jr(V,B);O!=null&&(g.push(x),v.set(x,O))}}let b=new bt(g);return new xr(v,b,u.fieldTransforms)}function jr(n,t){if(Gu(n=Nt(n)))return Io("Unsupported field value:",t,n),$u(n,t);if(n instanceof Fn)return function(r,s){if(!zu(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return function(r,s){let o=[],u=0;for(let l of r){let f=jr(l,s.wc(u));f==null&&(f={nullValue:"NULL_VALUE"}),o.push(f),u++}return{arrayValue:{values:o}}}(n,t)}return function(r,s){if((r=Nt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return vd(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=et.fromDate(r);return{timestampValue:ls(s.serializer,o)}}if(r instanceof et){let o=new et(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ls(s.serializer,o)}}if(r instanceof Wt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Lt)return{bytesValue:Vd(s.serializer,r._byteString)};if(r instanceof gt){let o=s.databaseId,u=r.firestore._databaseId;if(!u.isEqual(o))throw s.Sc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Du(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Jt)return function(u,l){return{mapValue:{fields:{[lo]:{stringValue:ho},[xe]:{arrayValue:{values:u.toArray().map(g=>{if(typeof g!="number")throw l.Sc("VectorValues must only contain numeric values.");return yo(l.serializer,g)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${co(r)}`)}(n,t)}function $u(n,t){let e={};return cu(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ge(n,(r,s)=>{let o=jr(s,t.mc(r));o!=null&&(e[r]=o)}),{mapValue:{fields:e}}}function Gu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof et||n instanceof Wt||n instanceof Lt||n instanceof gt||n instanceof Fn||n instanceof Jt)}function Io(n,t,e){if(!Gu(e)||!Gc(e)){let r=co(e);throw r==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+r)}}function eo(n,t,e){if((t=Nt(t))instanceof je)return t._internalPath;if(typeof t=="string")return vo(n,t);throw kr("Field path arguments must be of type string or ",n,!1,void 0,e)}var cf=new RegExp("[~\\*/\\[\\]]");function vo(n,t,e){if(t.search(cf)>=0)throw kr(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new je(...t.split("."))._internalPath}catch{throw kr(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function kr(n,t,e,r,s){let o=r&&!r.isEmpty(),u=s!==void 0,l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let f="";return(o||u)&&(f+=" (found",o&&(f+=` in field ${r}`),u&&(f+=` in document ${s}`),f+=")"),new C(S.INVALID_ARGUMENT,l+n+f)}function Ku(n,t){return n.some(e=>e.isEqual(t))}var ze=class{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new gt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new no(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Qu("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},no=class extends ze{data(){return super.data()}};function Qu(n,t){return typeof t=="string"?vo(n,t):t instanceof je?t._internalPath:t._delegate._internalPath}var Or=class{convertValue(t,e="none"){switch(Yt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return K(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Xt(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw k(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return ge(t,(s,o)=>{r[s]=this.convertValue(o,e)}),r}convertVectorValue(t){let e=t.fields?.[xe].arrayValue?.values?.map(r=>K(r.doubleValue));return new Jt(e)}convertGeoPoint(t){return new Wt(K(t.latitude),K(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=Br(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Vn(t));default:return null}}convertTimestamp(t){let e=Ut(t);return new et(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=W.fromString(t);tt(Ou(r),9688,{name:t});let s=new wr(r.get(1),r.get(3)),o=new M(r.popFirst(5));return s.isEqual(e)||Ge(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}};function uf(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var ro=class extends Or{constructor(t){super(),this.firestore=t}convertBytes(t){return new Lt(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new gt(this.firestore,null,e)}};var ce=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},le=class n extends ze{constructor(t,e,r,s,o,u){super(t,e,r,s,u),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Ve(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(Qu("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new C(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=n._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};le._jsonSchemaVersion="firestore/documentSnapshot/1.0",le._jsonSchema={type:Z("string",le._jsonSchemaVersion),bundleSource:Z("string","DocumentSnapshot"),bundleName:Z("string"),bundle:Z("string")};var Ve=class extends le{data(t={}){return super.data(t)}},Sn=class n{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new ce(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new Ve(this._firestore,this._userDataWriter,r.key,r,new ce(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new C(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let u=0;return s._snapshot.docChanges.map(l=>{let f=new Ve(s._firestore,s._userDataWriter,l.doc.key,l.doc,new ce(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:f,oldIndex:-1,newIndex:u++}})}{let u=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{let f=new Ve(s._firestore,s._userDataWriter,l.doc.key,l.doc,new ce(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter),g=-1,v=-1;return l.type!==0&&(g=u.indexOf(l.doc.key),u=u.delete(l.doc.key)),l.type!==1&&(u=u.add(l.doc),v=u.indexOf(l.doc.key)),{type:lf(l.type),doc:f,oldIndex:g,newIndex:v}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new C(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=n._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Rn.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],r=[],s=[];return this.docs.forEach(o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function lf(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return k(61501,{type:n})}}Sn._jsonSchemaVersion="firestore/querySnapshot/1.0",Sn._jsonSchema={type:Z("string",Sn._jsonSchemaVersion),bundleSource:Z("string","QuerySnapshot"),bundleName:Z("string"),bundle:Z("string")};var io=class extends Or{constructor(t){super(),this.firestore=t}convertBytes(t){return new Lt(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new gt(this.firestore,null,e)}};var hf={maxAttempts:5};function En(n,t){if((n=Nt(n)).firestore!==t)throw new C(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var so=class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=rf(t)}get(t){let e=En(t,this._firestore),r=new ro(this._firestore);return this._transaction.lookup([e._key]).then(s=>{if(!s||s.length!==1)return k(24041);let o=s[0];if(o.isFoundDocument())return new ze(this._firestore,r,o.key,o,e.converter);if(o.isNoDocument())return new ze(this._firestore,r,e._key,null,e.converter);throw k(18433,{doc:o})})}set(t,e,r){let s=En(t,this._firestore),o=uf(s.converter,e,r),u=sf(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,r);return this._transaction.set(s._key,u),this}update(t,e,r,...s){let o=En(t,this._firestore),u;return u=typeof(e=Nt(e))=="string"||e instanceof je?af(this._dataReader,"Transaction.update",o._key,e,r,s):of(this._dataReader,"Transaction.update",o._key,e),this._transaction.update(o._key,u),this}delete(t){let e=En(t,this._firestore);return this._transaction.delete(e._key),this}};var oo=class extends so{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=En(t,this._firestore),r=new io(this._firestore);return super.get(t).then(s=>new le(this._firestore,r,e._key,s._document,new ce(!1,!1),e.converter))}};function Hu(n,t,e){n=Kc(n,Dr);let r=J(J({},hf),e);return function(o){if(o.maxAttempts<1)throw new C(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(o,u,l){let f=new Ft;return o.asyncQueue.enqueueAndForget(()=>N(null,null,function*(){let g=yield Yd(o);new Ws(o.asyncQueue,g,l,u,f).ju()})),f.promise}(tf(n),s=>t(new oo(n,s)),r)}(function(t,e=!0){(function(s){$e=s})(rc),gn(new kt("firestore",(r,{instanceIdentifier:s,options:o})=>{let u=r.getProvider("app").getImmediate(),l=new Dr(new Bi(r.getProvider("auth-internal")),new ji(u,r.getProvider("app-check-internal")),function(g,v){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new C(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wr(g.options.projectId,v)}(u,s),u);return o=J({useFetchStreams:e},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),be(lc,hc,t),be(lc,hc,"esm2020")})();var ye=class ye{constructor(t){this.firestore=t;this.collectionName="tree-nodes"}getNodes(){let t=Da(this.firestore,this.collectionName);return Va(t,{idField:"id"})}getNode(t){let e=dn(this.firestore,`${this.collectionName}/${t}`);return Aa(Na(e)).pipe(ba(r=>{if(!r.exists())return;let s=r.data();return ve(J({},s),{id:r.id})}))}addNode(t){let e=dn(this.firestore,`${this.collectionName}/${t.id}`);return ka(e,t)}updateNode(t,e){let r=dn(this.firestore,`${this.collectionName}/${t}`);return Oa(r,ve(J({},e),{updatedAt:new Date().toISOString()}))}deleteNode(t){let e=dn(this.firestore,`${this.collectionName}/${t}`);return xa(e)}moveNodesBatch(t){let e=ju();return Hu(e,r=>N(this,null,function*(){for(let s of t){let o=qu(e,`${this.collectionName}/${s.id}`);r.update(o,{parentKey:s.parentKey,order:s.order,updatedAt:new Date().toISOString()})}}))}};ye.\u0275fac=function(e){return new(e||ye)(Ra(Ca))},ye.\u0275prov=Sa({token:ye,factory:ye.\u0275fac,providedIn:"root"});var Wu=ye;export{Wu as a};
