import{a as ce,b as S}from"./chunk-L4FYC27N.js";import{a as pe,b as se}from"./chunk-NKQGF4W7.js";import"./chunk-NLAA2TSK.js";import"./chunk-4PFPQ2C7.js";import"./chunk-VAGS5EVQ.js";import{a as le}from"./chunk-UZZMGHRG.js";import"./chunk-BS5K6EIF.js";import{f as ie,g as oe,h as re,k as ae}from"./chunk-OI4IKJ3Q.js";import{a as Y,c as Z,i as ee,j as te,k as ne}from"./chunk-M5QTXINY.js";import"./chunk-63VM7TI4.js";import"./chunk-Y2FV5RLC.js";import{d as H,g as J,m as U,z as X}from"./chunk-3D6KDIVE.js";import"./chunk-U7EI3GVC.js";import"./chunk-PWEMU7N6.js";import"./chunk-XD54FOSU.js";import"./chunk-P3TSDKRM.js";import"./chunk-4AUQJYLJ.js";import"./chunk-QGODTUP7.js";import"./chunk-PL7GK5XX.js";import"./chunk-PSBNAOCS.js";import"./chunk-NRI632AK.js";import"./chunk-7P4Y3DWL.js";import"./chunk-LTIIWQ67.js";import"./chunk-CTFRTJ4R.js";import"./chunk-DUG42QMT.js";import{A as D,Bd as L,Dd as Q,Ed as W,Gc as R,Kd as j,Lc as w,Mc as k,Nb as _,Ob as l,Pb as r,Pc as h,Ph as G,Qb as C,Qh as q,Ub as y,Vb as v,Xb as g,_b as f,bb as a,bc as m,fc as b,gb as E,gc as I,hc as O,lc as z,nb as P,qc as u,rc as T,sc as F,tb as x,vc as K,wc as B,xa as s,xc as A,ya as d,zd as $}from"./chunk-7MK5X7GX.js";import{a as M,b as V}from"./chunk-57BLH6QZ.js";var ue=()=>[];function _e(o,n){o&1&&C(0,"nz-icon",14)}function fe(o,n){if(o&1&&(y(0),C(1,"nz-icon",18),l(2,"span",19),u(3),r(),l(4,"span",20),u(5),r(),l(6,"span",21),u(7),w(8,"lowercase"),r(),v()),o&2){let e=m(),t=e.$implicit,i=e.origin;a(3),T(t.title),a(),_("ngClass",i.taskStatus),a(),T(i.taskStatus),a(2),F("created by ",k(8,4,i.author))}}function Ce(o,n){if(o&1){let e=g();y(0),l(1,"nz-icon",22),f("click",function(){s(e);let i=m(2).$implicit,c=m();return d(c.openFolder(i))}),r(),l(2,"span",23),u(3),r(),v()}if(o&2){let e=m(2).$implicit;a(),_("nzType",e.isExpanded?"folder-open":"folder"),a(2),T(e.title)}}function ge(o,n){if(o&1&&(C(0,"nz-icon",24),l(1,"span",25),u(2),r()),o&2){let e=m(2).$implicit;a(2),T(e.title)}}function xe(o,n){if(o&1&&x(0,Ce,4,2,"ng-container",17)(1,ge,3,1,"ng-template",null,4,h),o&2){let e=z(2),t=m().$implicit;_("ngIf",!t.isLeaf)("ngIfElse",e)}}function ze(o,n){if(o&1){let e=g();l(0,"span",15)(1,"span",16),f("contextmenu",function(i){let c=s(e).$implicit,p=m(),me=z(15);return d(p.contextMenu(i,me,c))}),x(2,fe,9,6,"ng-container",17)(3,xe,3,2,"ng-template",null,3,h),r()()}if(o&2){let e=n.origin,t=z(4);a(2),_("ngIf",e.isTask)("ngIfElse",t)}}function Ne(o,n){if(o&1){let e=g();l(0,"li",12),f("click",function(){s(e);let i=m();return d(i.addTask())}),u(1,"\u65B0\u589E\u4EFB\u52D9"),r()}}function Te(o,n){if(o&1){let e=g();l(0,"li",12),f("click",function(){s(e);let i=m();return d(i.editNode())}),u(1,"\u7DE8\u8F2F\u7BC0\u9EDE"),r()}}function he(o,n){if(o&1){let e=g();l(0,"li",12),f("click",function(){s(e);let i=m();return d(i.deleteNode())}),u(1,"\u522A\u9664\u7BC0\u9EDE"),r()}}var N=class N{constructor(n,e){this.nzContextMenuService=n;this.crudService=e;this.searchValue="";this.contextNode=null;this.expandedKeys=[];this.treeData$=this.crudService.getNodes().pipe(D(t=>Ee(t)))}onExpandChange(n){let e=n.node.key;n.expanded?this.expandedKeys.includes(e)||(this.expandedKeys=[...this.expandedKeys,e]):this.expandedKeys=this.expandedKeys.filter(t=>t!==e)}openFolder(n){if(n instanceof le)n.isExpanded=!n.isExpanded;else{let e=n.node;e&&(e.isExpanded=!e.isExpanded)}}activeNode(n){this.activatedNode=n.node}onDrop(n){let e=n.dragNode,t=n.node;if(!e||!t)return;let i=t.key;this.crudService.updateNode(e.key,{parentKey:i,order:0}).then(()=>{})}contextMenu(n,e,t){this.contextNode=t??null,this.nzContextMenuService.create(n,e)}addNode(){this.crud.showAddModal(this.contextNode?.key)}editNode(){this.contextNode&&this.crud.showEditModal(this.contextNode.origin)}deleteNode(){this.contextNode&&this.crud.deleteNode(this.contextNode.origin)}addRootNode(){this.crud.showAddModal(null)}addTask(){if(!this.contextNode)return;let n=this.contextNode.key,e=new Date().toISOString(),t="task-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),i={id:t,key:t,title:"\u65B0\u4EFB\u52D9",name:"\u65B0\u4EFB\u52D9",type:"leaf",isTask:!0,taskStatus:"pending",order:0,parentKey:n,createdAt:e,updatedAt:e};this.crudService.addNode(i).then(()=>{n&&!this.expandedKeys.includes(n)&&(this.expandedKeys=[...this.expandedKeys,n])})}selectDropdown(n){alert(n)}};N.\u0275fac=function(e){return new(e||N)(E(ne),E(ce))},N.\u0275cmp=P({type:N,selectors:[["app-tree-panel"]],viewQuery:function(e,t){if(e&1&&b(S,5),e&2){let i;I(i=O())&&(t.crud=i.first)}},decls:22,vars:12,consts:[["suffixIcon",""],["nzTreeTemplate",""],["menu","nzDropdownMenu"],["folderOrFile",""],["fileIcon",""],[1,"toolbar"],["nz-button","","nzType","default",2,"margin-bottom","8px",3,"click"],["nz-icon","","nzType","cluster"],[3,"nzSuffix"],["type","text","nz-input","","placeholder","\u641C\u5C0B\u7BC0\u9EDE",3,"ngModelChange","ngModel"],["nzBlockNode","","nzDraggable","","nzVirtualHeight","300px",3,"nzExpandChange","nzClick","nzDblClick","nzOnDrop","nzData","nzSearchValue","nzExpandedKeys","nzTreeTemplate"],["nz-menu",""],["nz-menu-item","",3,"click"],["nz-menu-item","",3,"click",4,"ngIf"],["nzType","search"],[1,"custom-node"],[3,"contextmenu"],[4,"ngIf","ngIfElse"],["nzType","check-circle",2,"color","#52c41a"],[1,"task-name"],[1,"task-status",3,"ngClass"],[1,"task-desc"],[3,"click","nzType"],[1,"folder-name"],["nzType","file"],[1,"file-name"]],template:function(e,t){if(e&1){let i=g();C(0,"app-firebase-crud"),l(1,"div",5)(2,"button",6),f("click",function(){return s(i),d(t.addRootNode())}),C(3,"span",7),u(4,"\u5EFA\u7ACB\u6839\u7D50\u9EDE "),r()(),l(5,"nz-input-group",8)(6,"input",9),A("ngModelChange",function(p){return s(i),B(t.searchValue,p)||(t.searchValue=p),d(p)}),r()(),x(7,_e,1,0,"ng-template",null,0,h),C(9,"br"),l(10,"nz-tree",10),w(11,"async"),f("nzExpandChange",function(p){return s(i),d(t.onExpandChange(p))})("nzClick",function(p){return s(i),d(t.activeNode(p))})("nzDblClick",function(p){return s(i),d(t.openFolder(p))})("nzOnDrop",function(p){return s(i),d(t.onDrop(p))}),r(),x(12,ze,5,2,"ng-template",null,1,h),l(14,"nz-dropdown-menu",null,2)(16,"ul",11)(17,"li",12),f("click",function(){return s(i),d(t.addNode())}),u(18,"\u65B0\u589E\u7BC0\u9EDE"),r(),x(19,Ne,2,0,"li",13)(20,Te,2,0,"li",13)(21,he,2,0,"li",13),r()()}if(e&2){let i=z(8),c=z(13);a(5),_("nzSuffix",i),a(),K("ngModel",t.searchValue),a(4),_("nzData",k(11,9,t.treeData$)??R(11,ue))("nzSearchValue",t.searchValue)("nzExpandedKeys",t.expandedKeys)("nzTreeTemplate",c),a(9),_("ngIf",t.contextNode),a(),_("ngIf",t.contextNode),a(),_("ngIf",t.contextNode)}},dependencies:[j,$,L,X,H,J,U,se,pe,te,Z,Y,ee,q,G,ae,ie,re,oe,S,Q,W],styles:["nz-tree[_ngcontent-%COMP%]{overflow:hidden;margin:0 -24px;padding:0 24px}.custom-node[_ngcontent-%COMP%]{cursor:pointer;line-height:24px;margin-left:4px;display:inline-block}.file-name[_ngcontent-%COMP%], .folder-name[_ngcontent-%COMP%]{margin-left:4px}.file-desc[_ngcontent-%COMP%], .folder-desc[_ngcontent-%COMP%]{padding:0 8px;display:inline-block;background:#87ceff;color:#fff;position:relative;left:12px}.task-status.pending[_ngcontent-%COMP%]{color:#faad14}.task-status.in-progress[_ngcontent-%COMP%]{color:#1890ff}.task-status.completed[_ngcontent-%COMP%]{color:#52c41a}.task-status.cancelled[_ngcontent-%COMP%]{color:#f5222d}"]});var de=N;function Ee(o){let n=new Map,e=[];return o.forEach(t=>{n.set(t.key,V(M({},t),{children:[]}))}),n.forEach(t=>{t.parentKey&&n.has(t.parentKey)?n.get(t.parentKey).children.push(t):e.push(t)}),e}export{de as TreePanelComponent};
