import{a as Uh,b as Bh,c as jh,d as $h,e as Gt,f as zh,g as Gh,k as Kh,o as Qh}from"./chunk-SR3AZCXX.js";import{C as ei,I as wt,J as Nh,K as Yt,L as kh,R as Fh,S as Oh,T as Mh,U as Lh,W as qh,Z as jr,d as bh,f as Rh,i as ua,j as Ph,k as Vh,l as Ch,m as Br,t as ca,u as la,v as Dh,y as xh}from"./chunk-2DVOMO4J.js";import{Ha as Ur,d as Ih,ma as Th,pa as Eh,tb as Sh,w as aa,ya as Ah}from"./chunk-67N3UCKF.js";import{h as oa,i as V}from"./chunk-57BLH6QZ.js";var Wh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Hh={};var le,ha;(function(){var r;function t(v,p){function w(){}w.prototype=p.prototype,v.D=p.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(I,T,A){for(var y=Array(arguments.length-2),ae=2;ae<arguments.length;ae++)y[ae-2]=arguments[ae];return p.prototype[T].apply(I,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,p,w){w||(w=0);var I=Array(16);if(typeof p=="string")for(var T=0;16>T;++T)I[T]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(T=0;16>T;++T)I[T]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=v.g[0],w=v.g[1],T=v.g[2];var A=v.g[3],y=p+(A^w&(T^A))+I[0]+3614090360&4294967295;p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[1]+3905402710&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[2]+606105819&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[3]+3250441966&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(A^w&(T^A))+I[4]+4118548399&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[5]+1200080426&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[6]+2821735955&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[7]+4249261313&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(A^w&(T^A))+I[8]+1770035416&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[9]+2336552879&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[10]+4294925233&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[11]+2304563134&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(A^w&(T^A))+I[12]+1804603682&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[13]+4254626195&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[14]+2792965006&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[15]+1236535329&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(T^A&(w^T))+I[1]+4129170786&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[6]+3225465664&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[11]+643717713&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[0]+3921069994&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(w^T))+I[5]+3593408605&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[10]+38016083&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[15]+3634488961&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[4]+3889429448&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(w^T))+I[9]+568446438&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[14]+3275163606&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[3]+4107603335&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[8]+1163531501&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(w^T))+I[13]+2850285829&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[2]+4243563512&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[7]+1735328473&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[12]+2368359562&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(w^T^A)+I[5]+4294588738&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[8]+2272392833&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[11]+1839030562&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[14]+4259657740&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(w^T^A)+I[1]+2763975236&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[4]+1272893353&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[7]+4139469664&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[10]+3200236656&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(w^T^A)+I[13]+681279174&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[0]+3936430074&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[3]+3572445317&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[6]+76029189&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(w^T^A)+I[9]+3654602809&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[12]+3873151461&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[15]+530742520&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[2]+3299628645&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(T^(w|~A))+I[0]+4096336452&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[7]+1126891415&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[14]+2878612391&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[5]+4237533241&4294967295,w=T+(y<<21&4294967295|y>>>11),y=p+(T^(w|~A))+I[12]+1700485571&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[3]+2399980690&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[10]+4293915773&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[1]+2240044497&4294967295,w=T+(y<<21&4294967295|y>>>11),y=p+(T^(w|~A))+I[8]+1873313359&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[15]+4264355552&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[6]+2734768916&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[13]+1309151649&4294967295,w=T+(y<<21&4294967295|y>>>11),y=p+(T^(w|~A))+I[4]+4149444226&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[11]+3174756917&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[2]+718787259&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+T&4294967295,v.g[3]=v.g[3]+A&4294967295}n.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var w=p-this.blockSize,I=this.B,T=this.h,A=0;A<p;){if(T==0)for(;A<=w;)s(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<p;)if(I[T++]=v.charCodeAt(A++),T==this.blockSize){s(this,I),T=0;break}}else for(;A<p;)if(I[T++]=v[A++],T==this.blockSize){s(this,I),T=0;break}}this.h=T,this.o+=p},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var w=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=w&255,w/=256;for(this.u(v),v=Array(16),p=w=0;4>p;++p)for(var I=0;32>I;I+=8)v[w++]=this.g[p]>>>I&255;return v};function i(v,p){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=p(v)}function a(v,p){this.h=p;for(var w=[],I=!0,T=v.length-1;0<=T;T--){var A=v[T]|0;I&&A==p||(w[T]=A,I=!1)}this.g=w}var u={};function l(v){return-128<=v&&128>v?i(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return g;if(0>v)return N(d(-v));for(var p=[],w=1,I=0;v>=w;I++)p[I]=v/w|0,w*=4294967296;return new a(p,0)}function f(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return N(f(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(p,8)),I=g,T=0;T<v.length;T+=8){var A=Math.min(8,v.length-T),y=parseInt(v.substring(T,T+A),p);8>A?(A=d(Math.pow(p,A)),I=I.j(A).add(d(y))):(I=I.j(w),I=I.add(d(y)))}return I}var g=l(0),_=l(1),b=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-N(this).m();for(var v=0,p=1,w=0;w<this.g.length;w++){var I=this.i(w);v+=(0<=I?I:4294967296+I)*p,p*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(D(this))return"0";if(k(this))return"-"+N(this).toString(v);for(var p=d(Math.pow(v,6)),w=this,I="";;){var T=W(w,p).g;w=$(w,T.j(p));var A=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=T,D(w))return A+I;for(;6>A.length;)A="0"+A;I=A+I}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function D(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function k(v){return v.h==-1}r.l=function(v){return v=$(this,v),k(v)?-1:D(v)?0:1};function N(v){for(var p=v.g.length,w=[],I=0;I<p;I++)w[I]=~v.g[I];return new a(w,~v.h).add(_)}r.abs=function(){return k(this)?N(this):this},r.add=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0,T=0;T<=p;T++){var A=I+(this.i(T)&65535)+(v.i(T)&65535),y=(A>>>16)+(this.i(T)>>>16)+(v.i(T)>>>16);I=y>>>16,A&=65535,y&=65535,w[T]=y<<16|A}return new a(w,w[w.length-1]&-2147483648?-1:0)};function $(v,p){return v.add(N(p))}r.j=function(v){if(D(this)||D(v))return g;if(k(this))return k(v)?N(this).j(N(v)):N(N(this).j(v));if(k(v))return N(this.j(N(v)));if(0>this.l(b)&&0>v.l(b))return d(this.m()*v.m());for(var p=this.g.length+v.g.length,w=[],I=0;I<2*p;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<v.g.length;T++){var A=this.i(I)>>>16,y=this.i(I)&65535,ae=v.i(T)>>>16,Ir=v.i(T)&65535;w[2*I+2*T]+=y*Ir,j(w,2*I+2*T),w[2*I+2*T+1]+=A*Ir,j(w,2*I+2*T+1),w[2*I+2*T+1]+=y*ae,j(w,2*I+2*T+1),w[2*I+2*T+2]+=A*ae,j(w,2*I+2*T+2)}for(I=0;I<p;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=p;I<2*p;I++)w[I]=0;return new a(w,0)};function j(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function B(v,p){this.g=v,this.h=p}function W(v,p){if(D(p))throw Error("division by zero");if(D(v))return new B(g,g);if(k(v))return p=W(N(v),p),new B(N(p.g),N(p.h));if(k(p))return p=W(v,N(p)),new B(N(p.g),p.h);if(30<v.g.length){if(k(v)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var w=_,I=p;0>=I.l(v);)w=Z(w),I=Z(I);var T=K(w,1),A=K(I,1);for(I=K(I,2),w=K(w,2);!D(I);){var y=A.add(I);0>=y.l(v)&&(T=T.add(w),A=y),I=K(I,1),w=K(w,1)}return p=$(v,T.j(p)),new B(T,p)}for(T=g;0<=v.l(p);){for(w=Math.max(1,Math.floor(v.m()/p.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),A=d(w),y=A.j(p);k(y)||0<y.l(v);)w-=I,A=d(w),y=A.j(p);D(A)&&(A=_),T=T.add(A),v=$(v,y)}return new B(T,v)}r.A=function(v){return W(this,v).h},r.and=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0;I<p;I++)w[I]=this.i(I)&v.i(I);return new a(w,this.h&v.h)},r.or=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0;I<p;I++)w[I]=this.i(I)|v.i(I);return new a(w,this.h|v.h)},r.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0;I<p;I++)w[I]=this.i(I)^v.i(I);return new a(w,this.h^v.h)};function Z(v){for(var p=v.g.length+1,w=[],I=0;I<p;I++)w[I]=v.i(I)<<1|v.i(I-1)>>>31;return new a(w,v.h)}function K(v,p){var w=p>>5;p%=32;for(var I=v.g.length-w,T=[],A=0;A<I;A++)T[A]=0<p?v.i(A+w)>>>p|v.i(A+w+1)<<32-p:v.i(A+w);return new a(T,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,ha=Hh.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,le=Hh.Integer=a}).apply(typeof Wh<"u"?Wh:typeof self<"u"?self:typeof window<"u"?window:{});var ni=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},he={};var da,dp,Vn,fa,$r,ri,ma,ga,pa;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ni=="object"&&ni];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function s(o,c){if(c)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var E=o[m];if(!(E in h))break t;h=h[E]}o=o[o.length-1],m=h[o],c=c(m),c!=m&&c!=null&&t(h,o,{configurable:!0,writable:!0,value:c})}}function i(o,c){o instanceof String&&(o+="");var h=0,m=!1,E={next:function(){if(!m&&h<o.length){var P=h++;return{value:c(P,o[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}s("Array.prototype.values",function(o){return o||function(){return i(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function f(o,c,h){return o.call.apply(o.bind,arguments)}function g(o,c,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,m),o.apply(c,E)}}return function(){return o.apply(c,arguments)}}function _(o,c,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,_.apply(null,arguments)}function b(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function D(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,E,P){for(var F=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)F[nt-2]=arguments[nt];return c.prototype[E].apply(m,F)}}function k(o){let c=o.length;if(0<c){let h=Array(c);for(let m=0;m<c;m++)h[m]=o[m];return h}return[]}function N(o,c){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(l(m)){let E=o.length||0,P=m.length||0;o.length=E+P;for(let F=0;F<P;F++)o[E+F]=m[F]}else o.push(m)}}class ${constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function j(o){return/^[\s\xa0]*$/.test(o)}function B(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function W(o){return W[" "](o),o}W[" "]=function(){};var Z=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function K(o,c,h){for(let m in o)c.call(h,o[m],m,o)}function v(o,c){for(let h in o)c.call(void 0,o[h],h,o)}function p(o){let c={};for(let h in o)c[h]=o[h];return c}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(o,c){let h,m;for(let E=1;E<arguments.length;E++){m=arguments[E];for(h in m)o[h]=m[h];for(let P=0;P<w.length;P++)h=w[P],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function T(o){var c=1;o=o.split(":");let h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=Fo;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class ae{constructor(){this.h=this.g=null}add(c,h){let m=Ir.get();m.set(c,h),this.h?this.h.next=m:this.g=m,this.h=m}}var Ir=new $(()=>new xg,o=>o.reset());class xg{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Tr,Er=!1,Fo=new ae,vl=()=>{let o=u.Promise.resolve(void 0);Tr=()=>{o.then(Ng)}};var Ng=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var c=Ir;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}Er=!1};function Te(){this.s=this.s,this.C=this.C}Te.prototype.s=!1,Te.prototype.ma=function(){this.s||(this.s=!0,this.N())},Te.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function St(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}St.prototype.h=function(){this.defaultPrevented=!0};var kg=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return o}();function Ar(o,c){if(St.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(Z){t:{try{W(c.nodeName);var E=!0;break t}catch{}E=!1}E||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Fg[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Ar.aa.h.call(this)}}D(Ar,St);var Fg={2:"touch",3:"pen",4:"mouse"};Ar.prototype.h=function(){Ar.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Sr="closure_listenable_"+(1e6*Math.random()|0),Og=0;function Mg(o,c,h,m,E){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!m,this.ha=E,this.key=++Og,this.da=this.fa=!1}function Ls(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function qs(o){this.src=o,this.g={},this.h=0}qs.prototype.add=function(o,c,h,m,E){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var F=Mo(o,c,m,E);return-1<F?(c=o[F],h||(c.fa=!1)):(c=new Mg(c,this.src,P,!!m,E),c.fa=h,o.push(c)),c};function Oo(o,c){var h=c.type;if(h in o.g){var m=o.g[h],E=Array.prototype.indexOf.call(m,c,void 0),P;(P=0<=E)&&Array.prototype.splice.call(m,E,1),P&&(Ls(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Mo(o,c,h,m){for(var E=0;E<o.length;++E){var P=o[E];if(!P.da&&P.listener==c&&P.capture==!!h&&P.ha==m)return E}return-1}var Lo="closure_lm_"+(1e6*Math.random()|0),qo={};function Il(o,c,h,m,E){if(m&&m.once)return El(o,c,h,m,E);if(Array.isArray(c)){for(var P=0;P<c.length;P++)Il(o,c[P],h,m,E);return null}return h=$o(h),o&&o[Sr]?o.K(c,h,d(m)?!!m.capture:!!m,E):Tl(o,c,h,!1,m,E)}function Tl(o,c,h,m,E,P){if(!c)throw Error("Invalid event type");var F=d(E)?!!E.capture:!!E,nt=Bo(o);if(nt||(o[Lo]=nt=new qs(o)),h=nt.add(c,h,m,F,P),h.proxy)return h;if(m=Lg(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)kg||(E=F),E===void 0&&(E=!1),o.addEventListener(c.toString(),m,E);else if(o.attachEvent)o.attachEvent(Sl(c.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Lg(){function o(h){return c.call(o.src,o.listener,h)}let c=qg;return o}function El(o,c,h,m,E){if(Array.isArray(c)){for(var P=0;P<c.length;P++)El(o,c[P],h,m,E);return null}return h=$o(h),o&&o[Sr]?o.L(c,h,d(m)?!!m.capture:!!m,E):Tl(o,c,h,!0,m,E)}function Al(o,c,h,m,E){if(Array.isArray(c))for(var P=0;P<c.length;P++)Al(o,c[P],h,m,E);else m=d(m)?!!m.capture:!!m,h=$o(h),o&&o[Sr]?(o=o.i,c=String(c).toString(),c in o.g&&(P=o.g[c],h=Mo(P,h,m,E),-1<h&&(Ls(P[h]),Array.prototype.splice.call(P,h,1),P.length==0&&(delete o.g[c],o.h--)))):o&&(o=Bo(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Mo(c,h,m,E)),(h=-1<o?c[o]:null)&&Uo(h))}function Uo(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Sr])Oo(c.i,o);else{var h=o.type,m=o.proxy;c.removeEventListener?c.removeEventListener(h,m,o.capture):c.detachEvent?c.detachEvent(Sl(h),m):c.addListener&&c.removeListener&&c.removeListener(m),(h=Bo(c))?(Oo(h,o),h.h==0&&(h.src=null,c[Lo]=null)):Ls(o)}}}function Sl(o){return o in qo?qo[o]:qo[o]="on"+o}function qg(o,c){if(o.da)o=!0;else{c=new Ar(c,this);var h=o.listener,m=o.ha||o.src;o.fa&&Uo(o),o=h.call(m,c)}return o}function Bo(o){return o=o[Lo],o instanceof qs?o:null}var jo="__closure_events_fn_"+(1e9*Math.random()>>>0);function $o(o){return typeof o=="function"?o:(o[jo]||(o[jo]=function(c){return o.handleEvent(c)}),o[jo])}function bt(){Te.call(this),this.i=new qs(this),this.M=this,this.F=null}D(bt,Te),bt.prototype[Sr]=!0,bt.prototype.removeEventListener=function(o,c,h,m){Al(this,o,c,h,m)};function xt(o,c){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=c.type||c,typeof c=="string")c=new St(c,o);else if(c instanceof St)c.target=c.target||o;else{var E=c;c=new St(m,o),I(c,E)}if(E=!0,h)for(var P=h.length-1;0<=P;P--){var F=c.g=h[P];E=Us(F,m,!0,c)&&E}if(F=c.g=o,E=Us(F,m,!0,c)&&E,E=Us(F,m,!1,c)&&E,h)for(P=0;P<h.length;P++)F=c.g=h[P],E=Us(F,m,!1,c)&&E}bt.prototype.N=function(){if(bt.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],m=0;m<h.length;m++)Ls(h[m]);delete o.g[c],o.h--}}this.F=null},bt.prototype.K=function(o,c,h,m){return this.i.add(String(o),c,!1,h,m)},bt.prototype.L=function(o,c,h,m){return this.i.add(String(o),c,!0,h,m)};function Us(o,c,h,m){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var E=!0,P=0;P<c.length;++P){var F=c[P];if(F&&!F.da&&F.capture==h){var nt=F.listener,Et=F.ha||F.src;F.fa&&Oo(o.i,F),E=nt.call(Et,m)!==!1&&E}}return E&&!m.defaultPrevented}function bl(o,c,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function Rl(o){o.g=bl(()=>{o.g=null,o.i&&(o.i=!1,Rl(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class Ug extends Te{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Rl(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function br(o){Te.call(this),this.h=o,this.g={}}D(br,Te);var Pl=[];function Vl(o){K(o.g,function(c,h){this.g.hasOwnProperty(h)&&Uo(c)},o),o.g={}}br.prototype.N=function(){br.aa.N.call(this),Vl(this)},br.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var zo=u.JSON.stringify,Bg=u.JSON.parse,jg=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Go(){}Go.prototype.h=null;function Cl(o){return o.h||(o.h=o.i())}function Dl(){}var Rr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ko(){St.call(this,"d")}D(Ko,St);function Qo(){St.call(this,"c")}D(Qo,St);var Je={},xl=null;function Bs(){return xl=xl||new bt}Je.La="serverreachability";function Nl(o){St.call(this,Je.La,o)}D(Nl,St);function Pr(o){let c=Bs();xt(c,new Nl(c))}Je.STAT_EVENT="statevent";function kl(o,c){St.call(this,Je.STAT_EVENT,o),this.stat=c}D(kl,St);function Nt(o){let c=Bs();xt(c,new kl(c,o))}Je.Ma="timingevent";function Fl(o,c){St.call(this,Je.Ma,o),this.size=c}D(Fl,St);function Vr(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function Cr(){this.g=!0}Cr.prototype.xa=function(){this.g=!1};function $g(o,c,h,m,E,P){o.info(function(){if(o.g)if(P)for(var F="",nt=P.split("&"),Et=0;Et<nt.length;Et++){var J=nt[Et].split("=");if(1<J.length){var Rt=J[0];J=J[1];var Pt=Rt.split("_");F=2<=Pt.length&&Pt[1]=="type"?F+(Rt+"="+J+"&"):F+(Rt+"=redacted&")}}else F=null;else F=P;return"XMLHTTP REQ ("+m+") [attempt "+E+"]: "+c+`
`+h+`
`+F})}function zg(o,c,h,m,E,P,F){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+E+"]: "+c+`
`+h+`
`+P+" "+F})}function Sn(o,c,h,m){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Kg(o,h)+(m?" "+m:"")})}function Gg(o,c){o.info(function(){return"TIMEOUT: "+c})}Cr.prototype.info=function(){};function Kg(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var E=m[1];if(Array.isArray(E)&&!(1>E.length)){var P=E[0];if(P!="noop"&&P!="stop"&&P!="close")for(var F=1;F<E.length;F++)E[F]=""}}}}return zo(h)}catch{return c}}var js={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ol={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Wo;function $s(){}D($s,Go),$s.prototype.g=function(){return new XMLHttpRequest},$s.prototype.i=function(){return{}},Wo=new $s;function Ee(o,c,h,m){this.j=o,this.i=c,this.l=h,this.R=m||1,this.U=new br(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ml}function Ml(){this.i=null,this.g="",this.h=!1}var Ll={},Ho={};function Xo(o,c,h){o.L=1,o.v=Qs(ue(c)),o.m=h,o.P=!0,ql(o,null)}function ql(o,c){o.F=Date.now(),zs(o),o.A=ue(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),Zl(h.i,"t",m),o.C=0,h=o.j.J,o.h=new Ml,o.g=yh(o.j,h?c:null,!o.m),0<o.O&&(o.M=new Ug(_(o.Y,o,o.g),o.O)),c=o.U,h=o.g,m=o.ca;var E="readystatechange";Array.isArray(E)||(E&&(Pl[0]=E.toString()),E=Pl);for(var P=0;P<E.length;P++){var F=Il(h,E[P],m||c.handleEvent,!1,c.h||c);if(!F)break;c.g[F.key]=F}c=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),Pr(),$g(o.i,o.u,o.A,o.l,o.R,o.m)}Ee.prototype.ca=function(o){o=o.target;let c=this.M;c&&ce(o)==3?c.j():this.Y(o)},Ee.prototype.Y=function(o){try{if(o==this.g)t:{let Pt=ce(this.g);var c=this.g.Ba();let Pn=this.g.Z();if(!(3>Pt)&&(Pt!=3||this.g&&(this.h.h||this.g.oa()||oh(this.g)))){this.J||Pt!=4||c==7||(c==8||0>=Pn?Pr(3):Pr(2)),Jo(this);var h=this.g.Z();this.X=h;e:if(Ul(this)){var m=oh(this.g);o="";var E=m.length,P=ce(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ye(this),Dr(this);var F="";break e}this.h.i=new u.TextDecoder}for(c=0;c<E;c++)this.h.h=!0,o+=this.h.i.decode(m[c],{stream:!(P&&c==E-1)});m.length=0,this.h.g+=o,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=h==200,zg(this.i,this.u,this.A,this.l,this.R,Pt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var nt,Et=this.g;if((nt=Et.g?Et.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(nt)){var J=nt;break e}}J=null}if(h=J)Sn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Yo(this,h);else{this.o=!1,this.s=3,Nt(12),Ye(this),Dr(this);break t}}if(this.P){h=!0;let zt;for(;!this.J&&this.C<F.length;)if(zt=Qg(this,F),zt==Ho){Pt==4&&(this.s=4,Nt(14),h=!1),Sn(this.i,this.l,null,"[Incomplete Response]");break}else if(zt==Ll){this.s=4,Nt(15),Sn(this.i,this.l,F,"[Invalid Chunk]"),h=!1;break}else Sn(this.i,this.l,zt,null),Yo(this,zt);if(Ul(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Pt!=4||F.length!=0||this.h.h||(this.s=1,Nt(16),h=!1),this.o=this.o&&h,!h)Sn(this.i,this.l,F,"[Invalid Chunked Response]"),Ye(this),Dr(this);else if(0<F.length&&!this.W){this.W=!0;var Rt=this.j;Rt.g==this&&Rt.ba&&!Rt.M&&(Rt.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),sa(Rt),Rt.M=!0,Nt(11))}}else Sn(this.i,this.l,F,null),Yo(this,F);Pt==4&&Ye(this),this.o&&!this.J&&(Pt==4?fh(this.j,this):(this.o=!1,zs(this)))}else lp(this.g),h==400&&0<F.indexOf("Unknown SID")?(this.s=3,Nt(12)):(this.s=0,Nt(13)),Ye(this),Dr(this)}}}catch{}finally{}};function Ul(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Qg(o,c){var h=o.C,m=c.indexOf(`
`,h);return m==-1?Ho:(h=Number(c.substring(h,m)),isNaN(h)?Ll:(m+=1,m+h>c.length?Ho:(c=c.slice(m,m+h),o.C=m+h,c)))}Ee.prototype.cancel=function(){this.J=!0,Ye(this)};function zs(o){o.S=Date.now()+o.I,Bl(o,o.I)}function Bl(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=Vr(_(o.ba,o),c)}function Jo(o){o.B&&(u.clearTimeout(o.B),o.B=null)}Ee.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Gg(this.i,this.A),this.L!=2&&(Pr(),Nt(17)),Ye(this),this.s=2,Dr(this)):Bl(this,this.S-o)};function Dr(o){o.j.G==0||o.J||fh(o.j,o)}function Ye(o){Jo(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,Vl(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function Yo(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||Zo(h.h,o))){if(!o.K&&Zo(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(c)}catch{m=null}if(Array.isArray(m)&&m.length==3){var E=m;if(E[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)Ys(h),Xs(h);else break t;ra(h),Nt(18)}}else h.za=E[1],0<h.za-h.T&&37500>E[2]&&h.F&&h.v==0&&!h.C&&(h.C=Vr(_(h.Za,h),6e3));if(1>=zl(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else tn(h,11)}else if((o.K||h.g==o)&&Ys(h),!j(c))for(E=h.Da.g.parse(c),c=0;c<E.length;c++){let J=E[c];if(h.T=J[0],J=J[1],h.G==2)if(J[0]=="c"){h.K=J[1],h.ia=J[2];let Rt=J[3];Rt!=null&&(h.la=Rt,h.j.info("VER="+h.la));let Pt=J[4];Pt!=null&&(h.Aa=Pt,h.j.info("SVER="+h.Aa));let Pn=J[5];Pn!=null&&typeof Pn=="number"&&0<Pn&&(m=1.5*Pn,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let zt=o.g;if(zt){let ti=zt.g?zt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ti){var P=m.h;P.g||ti.indexOf("spdy")==-1&&ti.indexOf("quic")==-1&&ti.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(ta(P,P.h),P.h=null))}if(m.D){let ia=zt.g?zt.g.getResponseHeader("X-HTTP-Session-Id"):null;ia&&(m.ya=ia,rt(m.I,m.D,ia))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var F=o;if(m.qa=ph(m,m.J?m.ia:null,m.W),F.K){Gl(m.h,F);var nt=F,Et=m.L;Et&&(nt.I=Et),nt.B&&(Jo(nt),zs(nt)),m.g=F}else hh(m);0<h.i.length&&Js(h)}else J[0]!="stop"&&J[0]!="close"||tn(h,7);else h.G==3&&(J[0]=="stop"||J[0]=="close"?J[0]=="stop"?tn(h,7):na(h):J[0]!="noop"&&h.l&&h.l.ta(J),h.v=0)}}Pr(4)}catch{}}var Wg=class{constructor(o,c){this.g=o,this.map=c}};function jl(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function $l(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function zl(o){return o.h?1:o.g?o.g.size:0}function Zo(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function ta(o,c){o.g?o.g.add(c):o.h=c}function Gl(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}jl.prototype.cancel=function(){if(this.i=Kl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Kl(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let h of o.g.values())c=c.concat(h.D);return c}return k(o.i)}function Hg(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var c=[],h=o.length,m=0;m<h;m++)c.push(o[m]);return c}c=[],h=0;for(m in o)c[h++]=o[m];return c}function Xg(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(let m in o)c[h++]=m;return c}}}function Ql(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=Xg(o),m=Hg(o),E=m.length,P=0;P<E;P++)c.call(void 0,m[P],h&&h[P],o)}var Wl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Jg(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),E=null;if(0<=m){var P=o[h].substring(0,m);E=o[h].substring(m+1)}else P=o[h];c(P,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function Ze(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Ze){this.h=o.h,Gs(this,o.j),this.o=o.o,this.g=o.g,Ks(this,o.s),this.l=o.l;var c=o.i,h=new kr;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),Hl(this,h),this.m=o.m}else o&&(c=String(o).match(Wl))?(this.h=!1,Gs(this,c[1]||"",!0),this.o=xr(c[2]||""),this.g=xr(c[3]||"",!0),Ks(this,c[4]),this.l=xr(c[5]||"",!0),Hl(this,c[6]||"",!0),this.m=xr(c[7]||"")):(this.h=!1,this.i=new kr(null,this.h))}Ze.prototype.toString=function(){var o=[],c=this.j;c&&o.push(Nr(c,Xl,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Nr(c,Xl,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Nr(h,h.charAt(0)=="/"?tp:Zg,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Nr(h,np)),o.join("")};function ue(o){return new Ze(o)}function Gs(o,c,h){o.j=h?xr(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Ks(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function Hl(o,c,h){c instanceof kr?(o.i=c,rp(o.i,o.h)):(h||(c=Nr(c,ep)),o.i=new kr(c,o.h))}function rt(o,c,h){o.i.set(c,h)}function Qs(o){return rt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function xr(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Nr(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,Yg),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Yg(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Xl=/[#\/\?@]/g,Zg=/[#\?:]/g,tp=/[#\?]/g,ep=/[#\?@]/g,np=/#/g;function kr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Ae(o){o.g||(o.g=new Map,o.h=0,o.i&&Jg(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}r=kr.prototype,r.add=function(o,c){Ae(this),this.i=null,o=bn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function Jl(o,c){Ae(o),c=bn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Yl(o,c){return Ae(o),c=bn(o,c),o.g.has(c)}r.forEach=function(o,c){Ae(this),this.g.forEach(function(h,m){h.forEach(function(E){o.call(c,E,m,this)},this)},this)},r.na=function(){Ae(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let m=0;m<c.length;m++){let E=o[m];for(let P=0;P<E.length;P++)h.push(c[m])}return h},r.V=function(o){Ae(this);let c=[];if(typeof o=="string")Yl(this,o)&&(c=c.concat(this.g.get(bn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},r.set=function(o,c){return Ae(this),this.i=null,o=bn(this,o),Yl(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function Zl(o,c,h){Jl(o,c),0<h.length&&(o.i=null,o.g.set(bn(o,c),k(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var m=c[h];let P=encodeURIComponent(String(m)),F=this.V(m);for(m=0;m<F.length;m++){var E=P;F[m]!==""&&(E+="="+encodeURIComponent(String(F[m]))),o.push(E)}}return this.i=o.join("&")};function bn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function rp(o,c){c&&!o.j&&(Ae(o),o.i=null,o.g.forEach(function(h,m){var E=m.toLowerCase();m!=E&&(Jl(this,m),Zl(this,E,h))},o)),o.j=c}function sp(o,c){let h=new Cr;if(u.Image){let m=new Image;m.onload=b(Se,h,"TestLoadImage: loaded",!0,c,m),m.onerror=b(Se,h,"TestLoadImage: error",!1,c,m),m.onabort=b(Se,h,"TestLoadImage: abort",!1,c,m),m.ontimeout=b(Se,h,"TestLoadImage: timeout",!1,c,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else c(!1)}function ip(o,c){let h=new Cr,m=new AbortController,E=setTimeout(()=>{m.abort(),Se(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:m.signal}).then(P=>{clearTimeout(E),P.ok?Se(h,"TestPingServer: ok",!0,c):Se(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(E),Se(h,"TestPingServer: error",!1,c)})}function Se(o,c,h,m,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),m(h)}catch{}}function op(){this.g=new jg}function ap(o,c,h){let m=h||"";try{Ql(o,function(E,P){let F=E;d(E)&&(F=zo(E)),c.push(m+P+"="+encodeURIComponent(F))})}catch(E){throw c.push(m+"type="+encodeURIComponent("_badmap")),E}}function Fr(o){this.l=o.Ub||null,this.j=o.eb||!1}D(Fr,Go),Fr.prototype.g=function(){return new Ws(this.l,this.j)},Fr.prototype.i=function(o){return function(){return o}}({});function Ws(o,c){bt.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(Ws,bt),r=Ws.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,Mr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Or(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Mr(this)),this.g&&(this.readyState=3,Mr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;th(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function th(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Or(this):Mr(this),this.readyState==3&&th(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Or(this))},r.Qa=function(o){this.g&&(this.response=o,Or(this))},r.ga=function(){this.g&&Or(this)};function Or(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Mr(o)}r.setRequestHeader=function(o,c){this.u.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Mr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Ws.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function eh(o){let c="";return K(o,function(h,m){c+=m,c+=":",c+=h,c+=`\r
`}),c}function ea(o,c,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=eh(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):rt(o,c,h))}function ct(o){bt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(ct,bt);var up=/^https?$/i,cp=["POST","PUT"];r=ct.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,c,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Wo.g(),this.v=this.o?Cl(this.o):Cl(Wo),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(P){nh(this,P);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var E in m)h.set(E,m[E]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())h.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(cp,c,void 0))||m||E||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,F]of h)this.g.setRequestHeader(P,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ih(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){nh(this,P)}};function nh(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,rh(o),Hs(o)}function rh(o){o.A||(o.A=!0,xt(o,"complete"),xt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,xt(this,"complete"),xt(this,"abort"),Hs(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Hs(this,!0)),ct.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?sh(this):this.bb())},r.bb=function(){sh(this)};function sh(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ce(o)!=4||o.Z()!=2)){if(o.u&&ce(o)==4)bl(o.Ea,0,o);else if(xt(o,"readystatechange"),ce(o)==4){o.h=!1;try{let F=o.Z();t:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var m;if(m=F===0){var E=String(o.D).match(Wl)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),m=!up.test(E?E.toLowerCase():"")}h=m}if(h)xt(o,"complete"),xt(o,"success");else{o.m=6;try{var P=2<ce(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",rh(o)}}finally{Hs(o)}}}}function Hs(o,c){if(o.g){ih(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||xt(o,"ready");try{h.onreadystatechange=m}catch{}}}function ih(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function ce(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<ce(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),Bg(c)}};function oh(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function lp(o){let c={};o=(o.g&&2<=ce(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(j(o[m]))continue;var h=T(o[m]);let E=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let P=c[E]||[];c[E]=P,P.push(h)}v(c,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Lr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function ah(o){this.Aa=0,this.i=[],this.j=new Cr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Lr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Lr("baseRetryDelayMs",5e3,o),this.cb=Lr("retryDelaySeedMs",1e4,o),this.Wa=Lr("forwardChannelMaxRetries",2,o),this.wa=Lr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new jl(o&&o.concurrentRequestLimit),this.Da=new op,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=ah.prototype,r.la=8,r.G=1,r.connect=function(o,c,h,m){Nt(0),this.W=o,this.H=c||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=ph(this,null,this.W),Js(this)};function na(o){if(uh(o),o.G==3){var c=o.U++,h=ue(o.I);if(rt(h,"SID",o.K),rt(h,"RID",c),rt(h,"TYPE","terminate"),qr(o,h),c=new Ee(o,o.j,c),c.L=2,c.v=Qs(ue(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=yh(c.j,null),c.g.ea(c.v)),c.F=Date.now(),zs(c)}gh(o)}function Xs(o){o.g&&(sa(o),o.g.cancel(),o.g=null)}function uh(o){Xs(o),o.u&&(u.clearTimeout(o.u),o.u=null),Ys(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function Js(o){if(!$l(o.h)&&!o.s){o.s=!0;var c=o.Ga;Tr||vl(),Er||(Tr(),Er=!0),Fo.add(c,o),o.B=0}}function hp(o,c){return zl(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=Vr(_(o.Ga,o,c),mh(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new Ee(this,this.j,o),P=this.o;if(this.S&&(P?(P=p(P),I(P,this.S)):P=this.S),this.m!==null||this.O||(E.H=P,P=null),this.P)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(c+=m,4096<c){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=lh(this,E,c),h=ue(this.I),rt(h,"RID",o),rt(h,"CVER",22),this.D&&rt(h,"X-HTTP-Session-Id",this.D),qr(this,h),P&&(this.O?c="headers="+encodeURIComponent(String(eh(P)))+"&"+c:this.m&&ea(h,this.m,P)),ta(this.h,E),this.Ua&&rt(h,"TYPE","init"),this.P?(rt(h,"$req",c),rt(h,"SID","null"),E.T=!0,Xo(E,h,null)):Xo(E,h,c),this.G=2}}else this.G==3&&(o?ch(this,o):this.i.length==0||$l(this.h)||ch(this))};function ch(o,c){var h;c?h=c.l:h=o.U++;let m=ue(o.I);rt(m,"SID",o.K),rt(m,"RID",h),rt(m,"AID",o.T),qr(o,m),o.m&&o.o&&ea(m,o.m,o.o),h=new Ee(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=lh(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),ta(o.h,h),Xo(h,m,c)}function qr(o,c){o.H&&K(o.H,function(h,m){rt(c,m,h)}),o.l&&Ql({},function(h,m){rt(c,m,h)})}function lh(o,c,h){h=Math.min(o.i.length,h);var m=o.l?_(o.l.Na,o.l,o):null;t:{var E=o.i;let P=-1;for(;;){let F=["count="+h];P==-1?0<h?(P=E[0].g,F.push("ofs="+P)):P=0:F.push("ofs="+P);let nt=!0;for(let Et=0;Et<h;Et++){let J=E[Et].g,Rt=E[Et].map;if(J-=P,0>J)P=Math.max(0,E[Et].g-100),nt=!1;else try{ap(Rt,F,"req"+J+"_")}catch{m&&m(Rt)}}if(nt){m=F.join("&");break t}}}return o=o.i.splice(0,h),c.D=o,m}function hh(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;Tr||vl(),Er||(Tr(),Er=!0),Fo.add(c,o),o.v=0}}function ra(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=Vr(_(o.Fa,o),mh(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,dh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=Vr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Nt(10),Xs(this),dh(this))};function sa(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function dh(o){o.g=new Ee(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=ue(o.qa);rt(c,"RID","rpc"),rt(c,"SID",o.K),rt(c,"AID",o.T),rt(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&rt(c,"TO",o.ja),rt(c,"TYPE","xmlhttp"),qr(o,c),o.m&&o.o&&ea(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Qs(ue(c)),h.m=null,h.P=!0,ql(h,o)}r.Za=function(){this.C!=null&&(this.C=null,Xs(this),ra(this),Nt(19))};function Ys(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function fh(o,c){var h=null;if(o.g==c){Ys(o),sa(o),o.g=null;var m=2}else if(Zo(o.h,c))h=c.D,Gl(o.h,c),m=1;else return;if(o.G!=0){if(c.o)if(m==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var E=o.B;m=Bs(),xt(m,new Fl(m,h)),Js(o)}else hh(o);else if(E=c.s,E==3||E==0&&0<c.X||!(m==1&&hp(o,c)||m==2&&ra(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),E){case 1:tn(o,5);break;case 4:tn(o,10);break;case 3:tn(o,6);break;default:tn(o,2)}}}function mh(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function tn(o,c){if(o.j.info("Error code "+c),c==2){var h=_(o.fb,o),m=o.Xa;let E=!m;m=new Ze(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Gs(m,"https"),Qs(m),E?sp(m.toString(),h):ip(m.toString(),h)}else Nt(2);o.G=0,o.l&&o.l.sa(c),gh(o),uh(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Nt(2)):(this.j.info("Failed to ping google.com"),Nt(1))};function gh(o){if(o.G=0,o.ka=[],o.l){let c=Kl(o.h);(c.length!=0||o.i.length!=0)&&(N(o.ka,c),N(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function ph(o,c,h){var m=h instanceof Ze?ue(h):new Ze(h);if(m.g!="")c&&(m.g=c+"."+m.g),Ks(m,m.s);else{var E=u.location;m=E.protocol,c=c?c+"."+E.hostname:E.hostname,E=+E.port;var P=new Ze(null);m&&Gs(P,m),c&&(P.g=c),E&&Ks(P,E),h&&(P.l=h),m=P}return h=o.D,c=o.ya,h&&c&&rt(m,h,c),rt(m,"VER",o.la),qr(o,m),m}function yh(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new ct(new Fr({eb:h})):new ct(o.pa),c.Ha(o.J),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function _h(){}r=_h.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Zs(){}Zs.prototype.g=function(o,c){return new Lt(o,c)};function Lt(o,c){bt.call(this),this.g=new ah(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!j(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!j(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new Rn(this)}D(Lt,bt),Lt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Lt.prototype.close=function(){na(this.g)},Lt.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=zo(o),o=h);c.i.push(new Wg(c.Ya++,o)),c.G==3&&Js(c)},Lt.prototype.N=function(){this.g.l=null,delete this.j,na(this.g),delete this.g,Lt.aa.N.call(this)};function wh(o){Ko.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(let h in c){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}D(wh,Ko);function vh(){Qo.call(this),this.status=1}D(vh,Qo);function Rn(o){this.g=o}D(Rn,_h),Rn.prototype.ua=function(){xt(this.g,"a")},Rn.prototype.ta=function(o){xt(this.g,new wh(o))},Rn.prototype.sa=function(o){xt(this.g,new vh)},Rn.prototype.ra=function(){xt(this.g,"b")},Zs.prototype.createWebChannel=Zs.prototype.g,Lt.prototype.send=Lt.prototype.o,Lt.prototype.open=Lt.prototype.m,Lt.prototype.close=Lt.prototype.close,pa=he.createWebChannelTransport=function(){return new Zs},ga=he.getStatEventTarget=function(){return Bs()},ma=he.Event=Je,ri=he.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},js.NO_ERROR=0,js.TIMEOUT=8,js.HTTP_ERROR=6,$r=he.ErrorCode=js,Ol.COMPLETE="complete",fa=he.EventType=Ol,Dl.EventType=Rr,Rr.OPEN="a",Rr.CLOSE="b",Rr.ERROR="c",Rr.MESSAGE="d",bt.prototype.listen=bt.prototype.K,Vn=he.WebChannel=Dl,dp=he.FetchXmlHttpFactory=Fr,ct.prototype.listenOnce=ct.prototype.L,ct.prototype.getLastError=ct.prototype.Ka,ct.prototype.getLastErrorCode=ct.prototype.Ba,ct.prototype.getStatus=ct.prototype.Z,ct.prototype.getResponseJson=ct.prototype.Oa,ct.prototype.getResponseText=ct.prototype.oa,ct.prototype.send=ct.prototype.ea,ct.prototype.setWithCredentials=ct.prototype.Ha,da=he.XhrIo=ct}).apply(typeof ni<"u"?ni:typeof self<"u"?self:typeof window<"u"?window:{});var Xh="@firebase/firestore",Jh="4.8.0";var pt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};pt.UNAUTHENTICATED=new pt(null),pt.GOOGLE_CREDENTIALS=new pt("google-credentials-uid"),pt.FIRST_PARTY=new pt("first-party-uid"),pt.MOCK_USER=new pt("mock-user");var gr="11.10.0";var Fe=new kh("@firebase/firestore");function On(){return Fe.logLevel}function fp(r){Fe.setLogLevel(r)}function x(r,...t){if(Fe.logLevel<=Yt.DEBUG){let e=t.map(Vc);Fe.debug(`Firestore (${gr}): ${r}`,...e)}}function ht(r,...t){if(Fe.logLevel<=Yt.ERROR){let e=t.map(Vc);Fe.error(`Firestore (${gr}): ${r}`,...e)}}function jt(r,...t){if(Fe.logLevel<=Yt.WARN){let e=t.map(Vc);Fe.warn(`Firestore (${gr}): ${r}`,...e)}}function Vc(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function L(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,mf(r,n,e)}function mf(r,t,e){let n=`FIRESTORE (${gr}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw ht(n),new Error(n)}function q(r,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,r||mf(t,s,n)}function cw(r,t){r||L(57014,t)}function M(r,t){return r}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},C=class extends xh{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var vt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var yi=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Aa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(pt.UNAUTHENTICATED))}shutdown(){}},Sa=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},ba=class{constructor(t){this.t=t,this.currentUser=pt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){q(this.o===void 0,42304);let n=this.i,s=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve(),i=new vt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new vt,t.enqueueRetryable(()=>s(this.currentUser))};let a=()=>{let l=i;t.enqueueRetryable(()=>V(this,null,function*(){yield l.promise,yield s(this.currentUser)}))},u=l=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new vt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q(typeof n.accessToken=="string",31837,{l:n}),new yi(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string",2055,{h:t}),new pt(t)}},Ra=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=pt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Pa=class{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new Ra(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(pt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},_i=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Va=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Mh(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){q(this.o===void 0,3512);let n=i=>{i.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let a=i.token!==this.m;return this.m=i.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>n(i))};let s=i=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.V.getImmediate({optional:!0});i?s(i):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new _i(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(q(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new _i(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function mp(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}function Cc(){return new TextEncoder}var ss=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let s=mp(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}};function z(r,t){return r<t?-1:r>t?1:0}function Ca(r,t){let e=0;for(;e<r.length&&e<t.length;){let n=r.codePointAt(e),s=t.codePointAt(e);if(n!==s){if(n<128&&s<128)return z(n,s);{let i=Cc(),a=gp(i.encode(Yh(r,e)),i.encode(Yh(t,e)));return a!==0?a:z(n,s)}}e+=n>65535?2:1}return z(r.length,t.length)}function Yh(r,t){return r.codePointAt(t)>65535?r.substring(t,t+2):r.substring(t,t+1)}function gp(r,t){for(let e=0;e<r.length&&e<t.length;++e)if(r[e]!==t[e])return z(r[e],t[e]);return z(r.length,t.length)}function Kn(r,t,e){return r.length===t.length&&r.every((n,s)=>e(n,t[s]))}function gf(r){return r+"\0"}var Zh="__name__",wi=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&L(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&L(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let s=0;s<n;s++){let i=r.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return z(t.length,e.length)}static compareSegments(t,e){let n=r.isNumericId(t),s=r.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?r.extractNumericId(t).compare(r.extractNumericId(e)):Ca(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return le.fromString(t.substring(4,t.length-2))}},H=class r extends wi{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new C(R.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(s=>s.length>0))}return new r(e)}static emptyPath(){return new r([])}},pp=/^[_a-zA-Z][_a-zA-Z0-9]*$/,It=class r extends wi{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return pp.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Zh}static keyField(){return new r([Zh])}static fromServerFormat(t){let e=[],n="",s=0,i=()=>{if(n.length===0)throw new C(R.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;s<t.length;){let u=t[s];if(u==="\\"){if(s+1===t.length)throw new C(R.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let l=t[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new C(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(n+=u,s++):(i(),s++)}if(i(),a)throw new C(R.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var O=class r{constructor(t){this.path=t}static fromPath(t){return new r(H.fromString(t))}static fromName(t){return new r(H.fromString(t).popFirst(5))}static empty(){return new r(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&H.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return H.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new H(t.slice()))}};function Dc(r,t,e){if(!e)throw new C(R.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function yp(r,t,e,n){if(t===!0&&n===!0)throw new C(R.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function td(r){if(!O.isDocumentKey(r))throw new C(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ed(r){if(O.isDocumentKey(r))throw new C(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function pf(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function vo(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":L(12329,{type:typeof r})}function Y(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new C(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=vo(r);throw new C(R.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function yf(r,t){if(t<=0)throw new C(R.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}function yt(r,t){let e={typeString:r};return t&&(e.value=t),e}function Vs(r,t){if(!pf(r))throw new C(R.INVALID_ARGUMENT,"JSON must be an object");let e;for(let n in t)if(t[n]){let s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}let a=r[n];if(s&&typeof a!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){e=`Expected '${n}' field to equal '${i.value}'`;break}}if(e)throw new C(R.INVALID_ARGUMENT,e);return!0}var nd=-62135596800,rd=1e6,ot=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*rd);return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new C(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new C(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<nd)throw new C(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new C(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/rd}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:r._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Vs(t,r._jsonSchema))return new r(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-nd;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};ot._jsonSchemaVersion="firestore/timestamp/1.0",ot._jsonSchema={type:yt("string",ot._jsonSchemaVersion),seconds:yt("number"),nanoseconds:yt("number")};var U=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new ot(0,0))}static max(){return new r(new ot(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Qn=-1,Wn=class{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}};function Da(r){return r.fields.find(t=>t.kind===2)}function nn(r){return r.fields.filter(t=>t.kind!==2)}Wn.UNKNOWN_ID=-1;var jn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var is=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,$t.min())}};function _f(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=U.fromTimestamp(n===1e9?new ot(e+1,0):new ot(e,n));return new $t(s,O.empty(),t)}function wf(r){return new $t(r.readTime,r.key,Qn)}var $t=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(U.min(),O.empty(),Qn)}static max(){return new r(U.max(),O.empty(),Qn)}};function xc(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=O.comparator(r.documentKey,t.documentKey),e!==0?e:z(r.largestBatchId,t.largestBatchId))}var vf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",vi=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Ke(r){return V(this,null,function*(){if(r.code!==R.FAILED_PRECONDITION||r.message!==vf)throw r;x("LocalStore","Unexpectedly lost primary lease")})}var S=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let s=0,i=0,a=!1;t.forEach(u=>{++s,u.next(()=>{++i,a&&i===s&&e()},l=>n(l))}),a=!0,i===s&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(s=>s?r.resolve(s):n());return e}static forEach(t,e){let n=[];return t.forEach((s,i)=>{n.push(e.call(this,s,i))}),this.waitFor(n)}static mapArray(t,e){return new r((n,s)=>{let i=t.length,a=new Array(i),u=0;for(let l=0;l<i;l++){let d=l;e(t[d]).next(f=>{a[d]=f,++u,u===i&&n(a)},f=>s(f))}})}static doWhile(t,e){return new r((n,s)=>{let i=()=>{t()===!0?e().next(()=>{i()},s):n()};i()})}};var qt="SimpleDb",Ii=class r{static open(t,e,n,s){try{return new r(e,t.transaction(s,n))}catch(i){throw new hn(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new vt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new hn(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{let s=Nc(n.target.error);this.S.reject(new hn(t,s))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(x(qt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Na(e)}},Oe=class r{static delete(t){return x(qt,"Removing database:",t),sn(bh().indexedDB.deleteDatabase(t)).toPromise()}static C(){if(!Dh())return!1;if(r.F())return!0;let t=Br(),e=r.M(t),n=0<e&&e<10,s=If(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static F(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.O)==="YES"}static N(t,e){return t.store(e)}static M(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.B=n,this.L=null,r.M(Br())===12.2&&ht("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(t){return V(this,null,function*(){return this.db||(x(qt,"Opening database:",this.name),this.db=yield new Promise((e,n)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{let a=i.target.result;e(a)},s.onblocked=()=>{n(new hn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{let a=i.target.error;a.name==="VersionError"?n(new C(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new C(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new hn(t,a))},s.onupgradeneeded=i=>{x(qt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);let a=i.target.result;if(this.L!==null&&this.L!==i.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${i.oldVersion}, event.newVersion=${i.newVersion}, db.version=${a.version}`);this.B.q(a,s.transaction,i.oldVersion,this.version).next(()=>{x(qt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let n=e.target;this.L=n.version},{passive:!0})),this.db.addEventListener("versionchange",e=>{var n;e.newVersion===null&&(jt('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(n=this.databaseDeletedListener)===null||n===void 0||n.call(this))},{passive:!0}),this.db})}setDatabaseDeletedListener(t){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=t}runTransaction(t,e,n,s){return V(this,null,function*(){let i=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.k(t);let u=Ii.open(this.db,t,i?"readonly":"readwrite",n),l=s(u).next(d=>(u.v(),d)).catch(d=>(u.abort(d),S.reject(d))).toPromise();return l.catch(()=>{}),yield u.D,l}catch(u){let l=u,d=l.name!=="FirebaseError"&&a<3;if(x(qt,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function If(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var xa=class{constructor(t){this.$=t,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(t){this.$=t}done(){this.U=!0}G(t){this.K=t}delete(){return sn(this.$.delete())}},hn=class extends C{constructor(t,e){super(R.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Qe(r){return r.name==="IndexedDbTransactionError"}var Na=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(x(qt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(x(qt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),sn(n)}add(t){return x(qt,"ADD",this.store.name,t,t),sn(this.store.add(t))}get(t){return sn(this.store.get(t)).next(e=>(e===void 0&&(e=null),x(qt,"GET",this.store.name,t,e),e))}delete(t){return x(qt,"DELETE",this.store.name,t),sn(this.store.delete(t))}count(){return x(qt,"COUNT",this.store.name),sn(this.store.count())}j(t,e){let n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){let i=s.getAll(n.range);return new S((a,u)=>{i.onerror=l=>{u(l.target.error)},i.onsuccess=l=>{a(l.target.result)}})}{let i=this.cursor(n),a=[];return this.J(i,(u,l)=>{a.push(l)}).next(()=>a)}}H(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new S((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}})}Y(t,e){x(qt,"DELETE ALL",this.store.name);let n=this.options(t,e);n.Z=!1;let s=this.cursor(n);return this.J(s,(i,a,u)=>u.delete())}X(t,e){let n;e?n=t:(n={},e=t);let s=this.cursor(n);return this.J(s,e)}ee(t){let e=this.cursor({});return new S((n,s)=>{e.onerror=i=>{let a=Nc(i.target.error);s(a)},e.onsuccess=i=>{let a=i.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}J(t,e){let n=[];return new S((s,i)=>{t.onerror=a=>{i(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void s();let l=new xa(u),d=e(u.primaryKey,u.value,l);if(d instanceof S){let f=d.catch(g=>(l.done(),S.reject(g)));n.push(f)}l.isDone?s():l.W===null?u.continue():u.continue(l.W)}}).next(()=>S.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.Z?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function sn(r){return new S((t,e)=>{r.onsuccess=n=>{let s=n.target.result;t(s)},r.onerror=n=>{let s=Nc(n.target.error);e(s)}})}var sd=!1;function Nc(r){let t=Oe.M(Br());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sd||(sd=!0,setTimeout(()=>{throw n},0)),n}}return r}var Xr="IndexBackfiller",ka=class{constructor(t,e){this.asyncQueue=t,this.te=e,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(t){x(Xr,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>V(this,null,function*(){this.task=null;try{let e=yield this.te.re();x(Xr,`Documents written: ${e}`)}catch(e){Qe(e)?x(Xr,"Ignoring IndexedDB error during index backfill: ",e):yield Ke(e)}yield this.ne(6e4)}))}},Fa=class{constructor(t,e){this.localStore=t,this.persistence=e}re(t=50){return V(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.ie(e,t))})}ie(t,e){let n=new Set,s=e,i=!0;return S.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return x(Xr,`Processing collection: ${a}`),this.se(t,a,s).next(u=>{s-=u,n.add(a)});i=!1})).next(()=>e-s)}se(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next(i=>{let a=i.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.oe(s,i)).next(u=>(x(Xr,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}oe(t,e){let n=t;return e.changes.forEach((s,i)=>{let a=wf(i);xc(a,n)>0&&(n=a)}),new $t(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Ut=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this._e(s),this.ae=s=>n.writeSequenceNumber(s))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}}r.ue=-1;return r})(),xe=-1;function Cs(r){return r==null}function os(r){return r===0&&1/r==-1/0}function Tf(r){return typeof r=="number"&&Number.isInteger(r)&&!os(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}var Ti="";function Dt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=id(t)),t=_p(r.get(e),t);return id(t)}function _p(r,t){let e=t,n=r.length;for(let s=0;s<n;s++){let i=r.charAt(s);switch(i){case"\0":e+="";break;case Ti:e+="";break;default:e+=i}}return e}function id(r){return r+Ti+""}function te(r){let t=r.length;if(q(t>=2,64408,{path:r}),t===2)return q(r.charAt(0)===Ti&&r.charAt(1)==="",56145,{path:r}),H.emptyPath();let e=t-2,n=[],s="";for(let i=0;i<t;){let a=r.indexOf(Ti,i);switch((a<0||a>e)&&L(50515,{path:r}),r.charAt(a+1)){case"":let u=r.substring(i,a),l;s.length===0?l=u:(s+=u,l=s,s=""),n.push(l);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:L(61167,{path:r})}i=a+2}return new H(n)}var rn="remoteDocuments",Ds="owner",Cn="owner",as="mutationQueues",wp="userId",Kt="mutations",od="batchId",cn="userMutationsIndex",ad=["userId","batchId"];function ci(r,t){return[r,Dt(t)]}function Ef(r,t,e){return[r,Dt(t),e]}var vp={},Hn="documentMutations",Ei="remoteDocumentsV14",Ip=["prefixPath","collectionGroup","readTime","documentId"],li="documentKeyIndex",Tp=["prefixPath","collectionGroup","documentId"],Af="collectionGroupIndex",Ep=["collectionGroup","readTime","prefixPath","documentId"],us="remoteDocumentGlobal",Oa="remoteDocumentGlobalKey",Xn="targets",Sf="queryTargetsIndex",Ap=["canonicalId","targetId"],Jn="targetDocuments",Sp=["targetId","path"],kc="documentTargetsIndex",bp=["path","targetId"],Ai="targetGlobalKey",dn="targetGlobal",cs="collectionParents",Rp=["collectionId","parent"],Yn="clientMetadata",Pp="clientId",Io="bundles",Vp="bundleId",To="namedQueries",Cp="name",Fc="indexConfiguration",Dp="indexId",Ma="collectionGroupIndex",xp="collectionGroup",Jr="indexState",Np=["indexId","uid"],bf="sequenceNumberIndex",kp=["uid","sequenceNumber"],Yr="indexEntries",Fp=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Rf="documentKeyIndex",Op=["indexId","uid","orderedDocumentKey"],Eo="documentOverlays",Mp=["userId","collectionPath","documentId"],La="collectionPathOverlayIndex",Lp=["userId","collectionPath","largestBatchId"],Pf="collectionGroupOverlayIndex",qp=["userId","collectionGroup","largestBatchId"],Oc="globals",Up="name",Vf=[as,Kt,Hn,rn,Xn,Ds,dn,Jn,Yn,us,cs,Io,To],Bp=[...Vf,Eo],Cf=[as,Kt,Hn,Ei,Xn,Ds,dn,Jn,Yn,us,cs,Io,To,Eo],Df=Cf,Mc=[...Df,Fc,Jr,Yr],jp=Mc,xf=[...Mc,Oc],$p=xf;var ls=class extends vi{constructor(t,e){super(),this.ce=t,this.currentSequenceNumber=e}};function Tt(r,t){let e=M(r);return Oe.N(e.ce,t)}function ud(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function We(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Nf(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var st=class r{constructor(t,e){this.comparator=t,this.root=e||ne.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ne.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ne.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Bn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Bn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Bn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Bn(this.root,t,this.comparator,!0)}},Bn=class{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},ne=class r{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??r.RED,this.left=s??r.EMPTY,this.right=i??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new r(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this,i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return r.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw L(27949);return t+(this.isRed()?0:1)}};ne.EMPTY=null,ne.RED=!0,ne.BLACK=!1;ne.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(t,e,n,s,i){return this}insert(t,e,n){return new ne(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var et=class r{constructor(t){this.comparator=t,this.data=new st(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Si(this.data.getIterator())}getIteratorFrom(t){return new Si(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Si=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Dn(r){return r.hasNext()?r.getNext():void 0}var Bt=class r{constructor(t){this.fields=t,t.sort(It.comparator)}static empty(){return new r([])}unionWith(t){let e=new et(It.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Kn(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var bi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function hw(){return typeof atob<"u"}var ft=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new bi("Invalid base64 string: "+i):i}}(t);return new r(e)}static fromUint8Array(t){let e=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};ft.EMPTY_BYTE_STRING=new ft("");var zp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ge(r){if(q(!!r,39018),typeof r=="string"){let t=0,e=zp.exec(r);if(q(!!e,46558,{timestamp:r}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:it(r.seconds),nanos:it(r.nanos)}}function it(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function pe(r){return typeof r=="string"?ft.fromBase64String(r):ft.fromUint8Array(r)}var kf="server_timestamp",Ff="__type__",Of="__previous_value__",Mf="__local_write_time__";function Ao(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Ff])===null||e===void 0?void 0:e.stringValue)===kf}function So(r){let t=r.mapValue.fields[Of];return Ao(t)?So(t):t}function hs(r){let t=ge(r.mapValue.fields[Mf].timestampValue);return new ot(t.seconds,t.nanos)}var qa=class{constructor(t,e,n,s,i,a,u,l,d,f){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=f}},Ri="(default)",Zn=class r{constructor(t,e){this.projectId=t,this.database=e||Ri}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===Ri}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Lc="__type__",Lf="__max__",Ce={mapValue:{fields:{__type__:{stringValue:Lf}}}},qc="__vector__",tr="value",hi={nullValue:"NULL_VALUE"};function Me(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ao(r)?4:qf(r)?9007199254740991:bo(r)?10:11:L(28295,{value:r})}function ie(r,t){if(r===t)return!0;let e=Me(r);if(e!==Me(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return hs(r).isEqual(hs(t));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;let a=ge(s.timestampValue),u=ge(i.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(s,i){return pe(s.bytesValue).isEqual(pe(i.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(s,i){return it(s.geoPointValue.latitude)===it(i.geoPointValue.latitude)&&it(s.geoPointValue.longitude)===it(i.geoPointValue.longitude)}(r,t);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return it(s.integerValue)===it(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){let a=it(s.doubleValue),u=it(i.doubleValue);return a===u?os(a)===os(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return Kn(r.arrayValue.values||[],t.arrayValue.values||[],ie);case 10:case 11:return function(s,i){let a=s.mapValue.fields||{},u=i.mapValue.fields||{};if(ud(a)!==ud(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!ie(a[l],u[l])))return!1;return!0}(r,t);default:return L(52216,{left:r})}}function ds(r,t){return(r.values||[]).find(e=>ie(e,t))!==void 0}function Le(r,t){if(r===t)return 0;let e=Me(r),n=Me(t);if(e!==n)return z(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return z(r.booleanValue,t.booleanValue);case 2:return function(i,a){let u=it(i.integerValue||i.doubleValue),l=it(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(r,t);case 3:return cd(r.timestampValue,t.timestampValue);case 4:return cd(hs(r),hs(t));case 5:return Ca(r.stringValue,t.stringValue);case 6:return function(i,a){let u=pe(i),l=pe(a);return u.compareTo(l)}(r.bytesValue,t.bytesValue);case 7:return function(i,a){let u=i.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let f=z(u[d],l[d]);if(f!==0)return f}return z(u.length,l.length)}(r.referenceValue,t.referenceValue);case 8:return function(i,a){let u=z(it(i.latitude),it(a.latitude));return u!==0?u:z(it(i.longitude),it(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return ld(r.arrayValue,t.arrayValue);case 10:return function(i,a){var u,l,d,f;let g=i.fields||{},_=a.fields||{},b=(u=g[tr])===null||u===void 0?void 0:u.arrayValue,D=(l=_[tr])===null||l===void 0?void 0:l.arrayValue,k=z(((d=b?.values)===null||d===void 0?void 0:d.length)||0,((f=D?.values)===null||f===void 0?void 0:f.length)||0);return k!==0?k:ld(b,D)}(r.mapValue,t.mapValue);case 11:return function(i,a){if(i===Ce.mapValue&&a===Ce.mapValue)return 0;if(i===Ce.mapValue)return 1;if(a===Ce.mapValue)return-1;let u=i.fields||{},l=Object.keys(u),d=a.fields||{},f=Object.keys(d);l.sort(),f.sort();for(let g=0;g<l.length&&g<f.length;++g){let _=Ca(l[g],f[g]);if(_!==0)return _;let b=Le(u[l[g]],d[f[g]]);if(b!==0)return b}return z(l.length,f.length)}(r.mapValue,t.mapValue);default:throw L(23264,{le:e})}}function cd(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return z(r,t);let e=ge(r),n=ge(t),s=z(e.seconds,n.seconds);return s!==0?s:z(e.nanos,n.nanos)}function ld(r,t){let e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){let i=Le(e[s],n[s]);if(i)return i}return z(e.length,n.length)}function er(r){return Ua(r)}function Ua(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=ge(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return pe(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return O.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",s=!0;for(let i of e.values||[])s?s=!1:n+=",",n+=Ua(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),s="{",i=!0;for(let a of n)i?i=!1:s+=",",s+=`${a}:${Ua(e.fields[a])}`;return s+"}"}(r.mapValue):L(61005,{value:r})}function di(r){switch(Me(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=So(r);return t?16+di(t):16;case 5:return 2*r.stringValue.length;case 6:return pe(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((s,i)=>s+di(i),0)}(r.arrayValue);case 10:case 11:return function(n){let s=0;return We(n.fields,(i,a)=>{s+=i.length+di(a)}),s}(r.mapValue);default:throw L(13486,{value:r})}}function fn(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Ba(r){return!!r&&"integerValue"in r}function fs(r){return!!r&&"arrayValue"in r}function hd(r){return!!r&&"nullValue"in r}function dd(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function fi(r){return!!r&&"mapValue"in r}function bo(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Lc])===null||e===void 0?void 0:e.stringValue)===qc}function Zr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return We(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Zr(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Zr(r.arrayValue.values[e]);return t}return Object.assign({},r)}function qf(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Lf}var Uf={mapValue:{fields:{[Lc]:{stringValue:qc},[tr]:{arrayValue:{}}}}};function Gp(r){return"nullValue"in r?hi:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?fn(Zn.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?bo(r)?Uf:{mapValue:{}}:L(35942,{value:r})}function Kp(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?fn(Zn.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Uf:"mapValue"in r?bo(r)?{mapValue:{}}:Ce:L(61959,{value:r})}function fd(r,t){let e=Le(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function md(r,t){let e=Le(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Ct=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!fi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Zr(e)}setAll(t){let e=It.emptyPath(),n={},s=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let l=this.getFieldsMap(e);this.applyChanges(l,n,s),n={},s=[],e=u.popLast()}a?n[u.lastSegment()]=Zr(a):s.push(u.lastSegment())});let i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){let e=this.field(t.popLast());fi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ie(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];fi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){We(e,(s,i)=>t[s]=i);for(let s of n)delete t[s]}clone(){return new r(Zr(this.value))}};function Bf(r){let t=[];return We(r.fields,(e,n)=>{let s=new It([e]);if(fi(n)){let i=Bf(n.mapValue).fields;if(i.length===0)t.push(s);else for(let a of i)t.push(s.child(a))}else t.push(s)}),new Bt(t)}var _t=class r{constructor(t,e,n,s,i,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,U.min(),U.min(),U.min(),Ct.empty(),0)}static newFoundDocument(t,e,n,s){return new r(t,1,e,U.min(),n,s,0)}static newNoDocument(t,e){return new r(t,2,e,U.min(),U.min(),Ct.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,U.min(),U.min(),Ct.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ct.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ct.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var oe=class{constructor(t,e){this.position=t,this.inclusive=e}};function gd(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){let i=t[s],a=r.position[s];if(i.field.isKeyField()?n=O.comparator(O.fromName(a.referenceValue),e.key):n=Le(a,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function pd(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!ie(r.position[e],t.position[e]))return!1;return!0}var mn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Qp(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var Pi=class{},Q=class r extends Pi{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new za(t,e,n):e==="array-contains"?new Qa(t,n):e==="in"?new Vi(t,n):e==="not-in"?new Wa(t,n):e==="array-contains-any"?new Ha(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new Ga(t,n):new Ka(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Le(e,this.value)):e!==null&&Me(this.value)===Me(e)&&this.matchesComparison(Le(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},tt=class r extends Pi{constructor(t,e){super(),this.filters=t,this.op=e,this.he=null}static create(t,e){return new r(t,e)}matches(t){return nr(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function nr(r){return r.op==="and"}function ja(r){return r.op==="or"}function Uc(r){return jf(r)&&nr(r)}function jf(r){for(let t of r.filters)if(t instanceof tt)return!1;return!0}function $a(r){if(r instanceof Q)return r.field.canonicalString()+r.op.toString()+er(r.value);if(Uc(r))return r.filters.map(t=>$a(t)).join(",");{let t=r.filters.map(e=>$a(e)).join(",");return`${r.op}(${t})`}}function $f(r,t){return r instanceof Q?function(n,s){return s instanceof Q&&n.op===s.op&&n.field.isEqual(s.field)&&ie(n.value,s.value)}(r,t):r instanceof tt?function(n,s){return s instanceof tt&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((i,a,u)=>i&&$f(a,s.filters[u]),!0):!1}(r,t):void L(19439)}function zf(r,t){let e=r.filters.concat(t);return tt.create(e,r.op)}function Gf(r){return r instanceof Q?function(e){return`${e.field.canonicalString()} ${e.op} ${er(e.value)}`}(r):r instanceof tt?function(e){return e.op.toString()+" {"+e.getFilters().map(Gf).join(" ,")+"}"}(r):"Filter"}var za=class extends Q{constructor(t,e,n){super(t,e,n),this.key=O.fromName(n.referenceValue)}matches(t){let e=O.comparator(t.key,this.key);return this.matchesComparison(e)}},Ga=class extends Q{constructor(t,e){super(t,"in",e),this.keys=Kf("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Ka=class extends Q{constructor(t,e){super(t,"not-in",e),this.keys=Kf("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Kf(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>O.fromName(n.referenceValue))}var Qa=class extends Q{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return fs(e)&&ds(e.arrayValue,this.value)}},Vi=class extends Q{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&ds(this.value.arrayValue,e)}},Wa=class extends Q{constructor(t,e){super(t,"not-in",e)}matches(t){if(ds(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!ds(this.value.arrayValue,e)}},Ha=class extends Q{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!fs(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>ds(this.value.arrayValue,n))}};var Xa=class{constructor(t,e=null,n=[],s=[],i=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=u,this.Pe=null}};function Ja(r,t=null,e=[],n=[],s=null,i=null,a=null){return new Xa(r,t,e,n,s,i,a)}function gn(r){let t=M(r);if(t.Pe===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>$a(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),Cs(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>er(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>er(n)).join(",")),t.Pe=e}return t.Pe}function xs(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Qp(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!$f(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!pd(r.startAt,t.startAt)&&pd(r.endAt,t.endAt)}function Ci(r){return O.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Di(r,t){return r.filters.filter(e=>e instanceof Q&&e.field.isEqual(t))}function yd(r,t,e){let n=hi,s=!0;for(let i of Di(r,t)){let a=hi,u=!0;switch(i.op){case"<":case"<=":a=Gp(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,u=!1;break;case"!=":case"not-in":a=hi}fd({value:n,inclusive:s},{value:a,inclusive:u})<0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];fd({value:n,inclusive:s},{value:a,inclusive:e.inclusive})<0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function _d(r,t,e){let n=Ce,s=!0;for(let i of Di(r,t)){let a=Ce,u=!0;switch(i.op){case">=":case">":a=Kp(i.value),u=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,u=!1;break;case"!=":case"not-in":a=Ce}md({value:n,inclusive:s},{value:a,inclusive:u})>0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];md({value:n,inclusive:s},{value:a,inclusive:e.inclusive})>0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}var Ht=class{constructor(t,e=null,n=[],s=[],i=null,a="F",u=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=u,this.endAt=l,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function Qf(r,t,e,n,s,i,a,u){return new Ht(r,t,e,n,s,i,a,u)}function pr(r){return new Ht(r)}function wd(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Bc(r){return r.collectionGroup!==null}function $n(r){let t=M(r);if(t.Te===null){t.Te=[];let e=new Set;for(let i of t.explicitOrderBy)t.Te.push(i),e.add(i.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new et(It.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Te.push(new mn(i,n))}),e.has(It.keyField().canonicalString())||t.Te.push(new mn(It.keyField(),n))}return t.Te}function kt(r){let t=M(r);return t.Ie||(t.Ie=Wp(t,$n(r))),t.Ie}function Wp(r,t){if(r.limitType==="F")return Ja(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(s=>{let i=s.dir==="desc"?"asc":"desc";return new mn(s.field,i)});let e=r.endAt?new oe(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new oe(r.startAt.position,r.startAt.inclusive):null;return Ja(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function Ya(r,t){let e=r.filters.concat([t]);return new Ht(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function xi(r,t,e){return new Ht(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function Ns(r,t){return xs(kt(r),kt(t))&&r.limitType===t.limitType}function Wf(r){return`${gn(kt(r))}|lt:${r.limitType}`}function Mn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(s=>Gf(s)).join(", ")}]`),Cs(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>er(s)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>er(s)).join(",")),`Target(${n})`}(kt(r))}; limitType=${r.limitType})`}function ks(r,t){return t.isFoundDocument()&&function(n,s){let i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):O.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,t)&&function(n,s){for(let i of $n(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(r,t)&&function(n,s){for(let i of n.filters)if(!i.matches(s))return!1;return!0}(r,t)&&function(n,s){return!(n.startAt&&!function(a,u,l){let d=gd(a,u,l);return a.inclusive?d<=0:d<0}(n.startAt,$n(n),s)||n.endAt&&!function(a,u,l){let d=gd(a,u,l);return a.inclusive?d>=0:d>0}(n.endAt,$n(n),s))}(r,t)}function Hf(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Xf(r){return(t,e)=>{let n=!1;for(let s of $n(r)){let i=Hp(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function Hp(r,t,e){let n=r.field.isKeyField()?O.comparator(t.key,e.key):function(i,a,u){let l=a.data.field(i),d=u.data.field(i);return l!==null&&d!==null?Le(l,d):L(42886)}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L(19790,{direction:r.dir})}}var Xt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){We(this.inner,(e,n)=>{for(let[s,i]of n)t(s,i)})}isEmpty(){return Nf(this.inner)}size(){return this.innerSize}};var Xp=new st(O.comparator);function Mt(){return Xp}var Jf=new st(O.comparator);function Wr(...r){let t=Jf;for(let e of r)t=t.insert(e.key,e);return t}function Yf(r){let t=Jf;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function ee(){return ts()}function Zf(){return ts()}function ts(){return new Xt(r=>r.toString(),(r,t)=>r.isEqual(t))}var Jp=new st(O.comparator),Yp=new et(O.comparator);function G(...r){let t=Yp;for(let e of r)t=t.add(e);return t}var Zp=new et(z);function jc(){return Zp}function $c(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:os(t)?"-0":t}}function tm(r){return{integerValue:""+r}}function em(r,t){return Tf(t)?tm(t):$c(r,t)}var rr=class{constructor(){this._=void 0}};function ty(r,t,e){return r instanceof qe?function(s,i){let a={fields:{[Ff]:{stringValue:kf},[Mf]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Ao(i)&&(i=So(i)),i&&(a.fields[Of]=i),{mapValue:a}}(e,t):r instanceof ye?rm(r,t):r instanceof _e?sm(r,t):function(s,i){let a=nm(s,i),u=vd(a)+vd(s.Ee);return Ba(a)&&Ba(s.Ee)?tm(u):$c(s.serializer,u)}(r,t)}function ey(r,t,e){return r instanceof ye?rm(r,t):r instanceof _e?sm(r,t):e}function nm(r,t){return r instanceof Ue?function(n){return Ba(n)||function(i){return!!i&&"doubleValue"in i}(n)}(t)?t:{integerValue:0}:null}var qe=class extends rr{},ye=class extends rr{constructor(t){super(),this.elements=t}};function rm(r,t){let e=im(t);for(let n of r.elements)e.some(s=>ie(s,n))||e.push(n);return{arrayValue:{values:e}}}var _e=class extends rr{constructor(t){super(),this.elements=t}};function sm(r,t){let e=im(t);for(let n of r.elements)e=e.filter(s=>!ie(s,n));return{arrayValue:{values:e}}}var Ue=class extends rr{constructor(t,e){super(),this.serializer=t,this.Ee=e}};function vd(r){return it(r.integerValue||r.doubleValue)}function im(r){return fs(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var pn=class{constructor(t,e){this.field=t,this.transform=e}};function ny(r,t){return r.field.isEqual(t.field)&&function(n,s){return n instanceof ye&&s instanceof ye||n instanceof _e&&s instanceof _e?Kn(n.elements,s.elements,ie):n instanceof Ue&&s instanceof Ue?ie(n.Ee,s.Ee):n instanceof qe&&s instanceof qe}(r.transform,t.transform)}var Za=class{constructor(t,e){this.version=t,this.transformResults=e}},lt=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function mi(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var sr=class{};function om(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new je(r.key,lt.none()):new Be(r.key,r.data,lt.none());{let e=r.data,n=Ct.empty(),s=new et(It.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new Jt(r.key,n,new Bt(s.toArray()),lt.none())}}function ry(r,t,e){r instanceof Be?function(s,i,a){let u=s.value.clone(),l=Td(s.fieldTransforms,i,a.transformResults);u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof Jt?function(s,i,a){if(!mi(s.precondition,i))return void i.convertToUnknownDocument(a.version);let u=Td(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(am(s)),l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,t,e):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function es(r,t,e,n){return r instanceof Be?function(i,a,u,l){if(!mi(i.precondition,a))return u;let d=i.value.clone(),f=Ed(i.fieldTransforms,l,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof Jt?function(i,a,u,l){if(!mi(i.precondition,a))return u;let d=Ed(i.fieldTransforms,l,a),f=a.data;return f.setAll(am(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))}(r,t,e,n):function(i,a,u){return mi(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function sy(r,t){let e=null;for(let n of r.fieldTransforms){let s=t.data.field(n.field),i=nm(n.transform,s||null);i!=null&&(e===null&&(e=Ct.empty()),e.set(n.field,i))}return e||null}function Id(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Kn(n,s,(i,a)=>ny(i,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Be=class extends sr{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Jt=class extends sr{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function am(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function Td(r,t,e){let n=new Map;q(r.length===e.length,32656,{Ae:e.length,Re:r.length});for(let s=0;s<e.length;s++){let i=r[s],a=i.transform,u=t.data.field(i.field);n.set(i.field,ey(a,u,e[s]))}return n}function Ed(r,t,e){let n=new Map;for(let s of r){let i=s.transform,a=e.data.field(s.field);n.set(s.field,ty(i,a,t))}return n}var je=class extends sr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ms=class extends sr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var gs=class{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(t.key)&&ry(i,t,n[s])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=es(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=es(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=Zf();return this.mutations.forEach(s=>{let i=t.get(s.key),a=i.overlayedDocument,u=this.applyToLocalView(a,i.mutatedFields);u=e.has(s.key)?null:u;let l=om(a,u);l!==null&&n.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(U.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),G())}isEqual(t){return this.batchId===t.batchId&&Kn(this.mutations,t.mutations,(e,n)=>Id(e,n))&&Kn(this.baseMutations,t.baseMutations,(e,n)=>Id(e,n))}},tu=class r{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){q(t.mutations.length===n.length,58842,{Ve:t.mutations.length,me:n.length});let s=function(){return Jp}(),i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new r(t,e,n,s)}};var ps=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var eu=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var mt,X;function um(r){switch(r){case R.OK:return L(64938);case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return L(15467,{code:r})}}function cm(r){if(r===void 0)return ht("GRPC error has no .code"),R.UNKNOWN;switch(r){case mt.OK:return R.OK;case mt.CANCELLED:return R.CANCELLED;case mt.UNKNOWN:return R.UNKNOWN;case mt.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case mt.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case mt.INTERNAL:return R.INTERNAL;case mt.UNAVAILABLE:return R.UNAVAILABLE;case mt.UNAUTHENTICATED:return R.UNAUTHENTICATED;case mt.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case mt.NOT_FOUND:return R.NOT_FOUND;case mt.ALREADY_EXISTS:return R.ALREADY_EXISTS;case mt.PERMISSION_DENIED:return R.PERMISSION_DENIED;case mt.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case mt.ABORTED:return R.ABORTED;case mt.OUT_OF_RANGE:return R.OUT_OF_RANGE;case mt.UNIMPLEMENTED:return R.UNIMPLEMENTED;case mt.DATA_LOSS:return R.DATA_LOSS;default:return L(39323,{code:r})}}(X=mt||(mt={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";var Ad=null;var iy=new le([4294967295,4294967295],0);function Sd(r){let t=Cc().encode(r),e=new ha;return e.update(t),new Uint8Array(e.digest())}function bd(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new le([e,n],0),new le([s,i],0)]}var nu=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new ln(`Invalid padding: ${e}`);if(n<0)throw new ln(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new ln(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new ln(`Invalid padding when bitmap length is 0: ${e}`);this.fe=8*t.length-e,this.ge=le.fromNumber(this.fe)}pe(t,e,n){let s=t.add(e.multiply(le.fromNumber(n)));return s.compare(iy)===1&&(s=new le([s.getBits(0),s.getBits(1)],0)),s.modulo(this.ge).toNumber()}ye(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.fe===0)return!1;let e=Sd(t),[n,s]=bd(e);for(let i=0;i<this.hashCount;i++){let a=this.pe(n,s,i);if(!this.ye(a))return!1}return!0}static create(t,e,n){let s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new r(i,s,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.fe===0)return;let e=Sd(t),[n,s]=bd(e);for(let i=0;i<this.hashCount;i++){let a=this.pe(n,s,i);this.we(a)}}we(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},ln=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ys=class r{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let s=new Map;return s.set(t,_s.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(U.min(),s,new st(z),Mt(),G())}},_s=class r{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,G(),G(),G())}};var zn=class{constructor(t,e,n,s){this.Se=t,this.removedTargetIds=e,this.key=n,this.be=s}},Ni=class{constructor(t,e){this.targetId=t,this.De=e}},ki=class{constructor(t,e,n=ft.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}},Fi=class{constructor(){this.ve=0,this.Ce=Rd(),this.Fe=ft.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(t){t.approximateByteSize()>0&&(this.xe=!0,this.Fe=t)}Le(){let t=G(),e=G(),n=G();return this.Ce.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:L(38017,{changeType:i})}}),new _s(this.Fe,this.Me,t,e,n)}ke(){this.xe=!1,this.Ce=Rd()}qe(t,e){this.xe=!0,this.Ce=this.Ce.insert(t,e)}Qe(t){this.xe=!0,this.Ce=this.Ce.remove(t)}$e(){this.ve+=1}Ue(){this.ve-=1,q(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},ru=class{constructor(t){this.We=t,this.Ge=new Map,this.ze=Mt(),this.je=si(),this.Je=si(),this.He=new st(z)}Ye(t){for(let e of t.Se)t.be&&t.be.isFoundDocument()?this.Ze(e,t.be):this.Xe(e,t.key,t.be);for(let e of t.removedTargetIds)this.Xe(e,t.key,t.be)}et(t){this.forEachTarget(t,e=>{let n=this.tt(e);switch(t.state){case 0:this.nt(e)&&n.Be(t.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(t.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(e);break;case 3:this.nt(e)&&(n.Ke(),n.Be(t.resumeToken));break;case 4:this.nt(e)&&(this.rt(e),n.Be(t.resumeToken));break;default:L(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ge.forEach((n,s)=>{this.nt(s)&&e(s)})}it(t){let e=t.targetId,n=t.De.count,s=this.st(e);if(s){let i=s.target;if(Ci(i))if(n===0){let a=new O(i.path);this.Xe(e,a,_t.newNoDocument(a,U.min()))}else q(n===1,20013,{expectedCount:n});else{let a=this.ot(e);if(a!==n){let u=this._t(t),l=u?this.ut(u,t,a):1;if(l!==0){this.rt(e);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(e,d)}Ad?.ct(function(f,g,_,b,D){var k,N,$,j,B,W;let Z={localCacheCount:f,existenceFilterCount:g.count,databaseId:_.database,projectId:_.projectId},K=g.unchangedNames;return K&&(Z.bloomFilter={applied:D===0,hashCount:(k=K?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(j=($=(N=K?.bits)===null||N===void 0?void 0:N.bitmap)===null||$===void 0?void 0:$.length)!==null&&j!==void 0?j:0,padding:(W=(B=K?.bits)===null||B===void 0?void 0:B.padding)!==null&&W!==void 0?W:0,mightContain:v=>{var p;return(p=b?.mightContain(v))!==null&&p!==void 0&&p}}),Z}(a,t.De,this.We.lt(),u,l))}}}}_t(t){let e=t.De.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e,a,u;try{a=pe(n).toUint8Array()}catch(l){if(l instanceof bi)return jt("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new nu(a,s,i)}catch(l){return jt(l instanceof ln?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.fe===0?null:u}ut(t,e,n){return e.De.count===n-this.ht(t,e.targetId)?0:2}ht(t,e){let n=this.We.getRemoteKeysForTarget(e),s=0;return n.forEach(i=>{let a=this.We.lt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(u)||(this.Xe(e,i,null),s++)}),s}Pt(t){let e=new Map;this.Ge.forEach((i,a)=>{let u=this.st(a);if(u){if(i.current&&Ci(u.target)){let l=new O(u.target.path);this.Tt(l).has(a)||this.It(a,l)||this.Xe(a,l,_t.newNoDocument(l,t))}i.Ne&&(e.set(a,i.Le()),i.ke())}});let n=G();this.Je.forEach((i,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.st(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(i))}),this.ze.forEach((i,a)=>a.setReadTime(t));let s=new ys(t,e,this.He,this.ze,n);return this.ze=Mt(),this.je=si(),this.Je=si(),this.He=new st(z),s}Ze(t,e){if(!this.nt(t))return;let n=this.It(t,e.key)?2:0;this.tt(t).qe(e.key,n),this.ze=this.ze.insert(e.key,e),this.je=this.je.insert(e.key,this.Tt(e.key).add(t)),this.Je=this.Je.insert(e.key,this.dt(e.key).add(t))}Xe(t,e,n){if(!this.nt(t))return;let s=this.tt(t);this.It(t,e)?s.qe(e,1):s.Qe(e),this.Je=this.Je.insert(e,this.dt(e).delete(t)),this.Je=this.Je.insert(e,this.dt(e).add(t)),n&&(this.ze=this.ze.insert(e,n))}removeTarget(t){this.Ge.delete(t)}ot(t){let e=this.tt(t).Le();return this.We.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}$e(t){this.tt(t).$e()}tt(t){let e=this.Ge.get(t);return e||(e=new Fi,this.Ge.set(t,e)),e}dt(t){let e=this.Je.get(t);return e||(e=new et(z),this.Je=this.Je.insert(t,e)),e}Tt(t){let e=this.je.get(t);return e||(e=new et(z),this.je=this.je.insert(t,e)),e}nt(t){let e=this.st(t)!==null;return e||x("WatchChangeAggregator","Detected inactive target",t),e}st(t){let e=this.Ge.get(t);return e&&e.Oe?null:this.We.Et(t)}rt(t){this.Ge.set(t,new Fi),this.We.getRemoteKeysForTarget(t).forEach(e=>{this.Xe(t,e,null)})}It(t,e){return this.We.getRemoteKeysForTarget(t).has(e)}};function si(){return new st(O.comparator)}function Rd(){return new st(O.comparator)}var oy={asc:"ASCENDING",desc:"DESCENDING"},ay={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},uy={and:"AND",or:"OR"},su=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function iu(r,t){return r.useProto3Json||Cs(t)?t:{value:t}}function ir(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function lm(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function cy(r,t){return ir(r,t.toTimestamp())}function dt(r){return q(!!r,49232),U.fromTimestamp(function(e){let n=ge(e);return new ot(n.seconds,n.nanos)}(r))}function zc(r,t){return ou(r,t).canonicalString()}function ou(r,t){let e=function(s){return new H(["projects",s.projectId,"databases",s.database])}(r).child("documents");return t===void 0?e:e.child(t)}function hm(r){let t=H.fromString(r);return q(Im(t),10190,{key:t.toString()}),t}function ws(r,t){return zc(r.databaseId,t.path)}function re(r,t){let e=hm(t);if(e.get(1)!==r.databaseId.projectId)throw new C(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new C(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new O(mm(e))}function dm(r,t){return zc(r.databaseId,t)}function fm(r){let t=hm(r);return t.length===4?H.emptyPath():mm(t)}function au(r){return new H(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function mm(r){return q(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function Pd(r,t,e){return{name:ws(r,t),fields:e.value.mapValue.fields}}function gm(r,t,e){let n=re(r,t.name),s=dt(t.updateTime),i=t.createTime?dt(t.createTime):U.min(),a=new Ct({mapValue:{fields:t.fields}}),u=_t.newFoundDocument(n,s,i,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function ly(r,t){return"found"in t?function(n,s){q(!!s.found,43571),s.found.name,s.found.updateTime;let i=re(n,s.found.name),a=dt(s.found.updateTime),u=s.found.createTime?dt(s.found.createTime):U.min(),l=new Ct({mapValue:{fields:s.found.fields}});return _t.newFoundDocument(i,a,u,l)}(r,t):"missing"in t?function(n,s){q(!!s.missing,3894),q(!!s.readTime,22933);let i=re(n,s.missing),a=dt(s.readTime);return _t.newNoDocument(i,a)}(r,t):L(7234,{result:t})}function hy(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L(39313,{state:d})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(d,f){return d.useProto3Json?(q(f===void 0||typeof f=="string",58123),ft.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),ft.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(d){let f=d.code===void 0?R.UNKNOWN:cm(d.code);return new C(f,d.message||"")}(a);e=new ki(n,s,i,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let s=re(r,n.document.name),i=dt(n.document.updateTime),a=n.document.createTime?dt(n.document.createTime):U.min(),u=new Ct({mapValue:{fields:n.document.fields}}),l=_t.newFoundDocument(s,i,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new zn(d,f,l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let s=re(r,n.document),i=n.readTime?dt(n.readTime):U.min(),a=_t.newNoDocument(s,i),u=n.removedTargetIds||[];e=new zn([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let s=re(r,n.document),i=n.removedTargetIds||[];e=new zn([],i,s,null)}else{if(!("filter"in t))return L(11601,{At:t});{t.filter;let n=t.filter;n.targetId;let{count:s=0,unchangedNames:i}=n,a=new eu(s,i),u=n.targetId;e=new Ni(u,a)}}return e}function vs(r,t){let e;if(t instanceof Be)e={update:Pd(r,t.key,t.value)};else if(t instanceof je)e={delete:ws(r,t.key)};else if(t instanceof Jt)e={update:Pd(r,t.key,t.data),updateMask:yy(t.fieldMask)};else{if(!(t instanceof ms))return L(16599,{Rt:t.type});e={verify:ws(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(i,a){let u=a.transform;if(u instanceof qe)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ye)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof _e)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Ue)return{fieldPath:a.field.canonicalString(),increment:u.Ee};throw L(20930,{transform:a.transform})}(0,n))),t.precondition.isNone||(e.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:cy(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:L(27497)}(r,t.precondition)),e}function uu(r,t){let e=t.currentDocument?function(i){return i.updateTime!==void 0?lt.updateTime(dt(i.updateTime)):i.exists!==void 0?lt.exists(i.exists):lt.none()}(t.currentDocument):lt.none(),n=t.updateTransforms?t.updateTransforms.map(s=>function(a,u){let l=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),l=new qe;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];l=new ye(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];l=new _e(f)}else"increment"in u?l=new Ue(a,u.increment):L(16584,{proto:u});let d=It.fromServerFormat(u.fieldPath);return new pn(d,l)}(r,s)):[];if(t.update){t.update.name;let s=re(r,t.update.name),i=new Ct({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(l){let d=l.fieldPaths||[];return new Bt(d.map(f=>It.fromServerFormat(f)))}(t.updateMask);return new Jt(s,i,a,e,n)}return new Be(s,i,e,n)}if(t.delete){let s=re(r,t.delete);return new je(s,e)}if(t.verify){let s=re(r,t.verify);return new ms(s,e)}return L(1463,{proto:t})}function dy(r,t){return r&&r.length>0?(q(t!==void 0,14353),r.map(e=>function(s,i){let a=s.updateTime?dt(s.updateTime):dt(i);return a.isEqual(U.min())&&(a=dt(i)),new Za(a,s.transformResults||[])}(e,t))):[]}function pm(r,t){return{documents:[dm(r,t.path)]}}function ym(r,t){let e={structuredQuery:{}},n=t.path,s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=dm(r,s);let i=function(d){if(d.length!==0)return vm(tt.create(d,"and"))}(t.filters);i&&(e.structuredQuery.where=i);let a=function(d){if(d.length!==0)return d.map(f=>function(_){return{field:Ln(_.field),direction:my(_.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=iu(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{Vt:e,parent:s}}function _m(r){let t=fm(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,s=null;if(n>0){q(n===1,65062);let f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let i=[];e.where&&(i=function(g){let _=wm(g);return _ instanceof tt&&Uc(_)?_.getFilters():[_]}(e.where));let a=[];e.orderBy&&(a=function(g){return g.map(_=>function(D){return new mn(qn(D.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(D.direction))}(_))}(e.orderBy));let u=null;e.limit&&(u=function(g){let _;return _=typeof g=="object"?g.value:g,Cs(_)?null:_}(e.limit));let l=null;e.startAt&&(l=function(g){let _=!!g.before,b=g.values||[];return new oe(b,_)}(e.startAt));let d=null;return e.endAt&&(d=function(g){let _=!g.before,b=g.values||[];return new oe(b,_)}(e.endAt)),Qf(t,s,a,i,u,"F",l,d)}function fy(r,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:s})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function wm(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=qn(e.unaryFilter.field);return Q.create(n,"==",{doubleValue:NaN});case"IS_NULL":let s=qn(e.unaryFilter.field);return Q.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=qn(e.unaryFilter.field);return Q.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=qn(e.unaryFilter.field);return Q.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}}(r):r.fieldFilter!==void 0?function(e){return Q.create(qn(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return tt.create(e.compositeFilter.filters.map(n=>wm(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return L(1026)}}(e.compositeFilter.op))}(r):L(30097,{filter:r})}function my(r){return oy[r]}function gy(r){return ay[r]}function py(r){return uy[r]}function Ln(r){return{fieldPath:r.canonicalString()}}function qn(r){return It.fromServerFormat(r.fieldPath)}function vm(r){return r instanceof Q?function(e){if(e.op==="=="){if(dd(e.value))return{unaryFilter:{field:Ln(e.field),op:"IS_NAN"}};if(hd(e.value))return{unaryFilter:{field:Ln(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(dd(e.value))return{unaryFilter:{field:Ln(e.field),op:"IS_NOT_NAN"}};if(hd(e.value))return{unaryFilter:{field:Ln(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ln(e.field),op:gy(e.op),value:e.value}}}(r):r instanceof tt?function(e){let n=e.getFilters().map(s=>vm(s));return n.length===1?n[0]:{compositeFilter:{op:py(e.op),filters:n}}}(r):L(54877,{filter:r})}function yy(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Im(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var or=class r{constructor(t,e,n,s,i=U.min(),a=U.min(),u=ft.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Oi=class{constructor(t){this.gt=t}};function _y(r,t){let e;if(t.document)e=gm(r.gt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=O.fromSegments(t.noDocument.path),s=_n(t.noDocument.readTime);e=_t.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L(56709);{let n=O.fromSegments(t.unknownDocument.path),s=_n(t.unknownDocument.version);e=_t.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime(function(s){let i=new ot(s[0],s[1]);return U.fromTimestamp(i)}(t.readTime)),e}function Vd(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Mi(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(i,a){return{name:ws(i,a.key),fields:a.data.value.mapValue.fields,updateTime:ir(i,a.version.toTimestamp()),createTime:ir(i,a.createTime.toTimestamp())}}(r.gt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:yn(t.version)};else{if(!t.isUnknownDocument())return L(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:yn(t.version)}}return n}function Mi(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function yn(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function _n(r){let t=new ot(r.seconds,r.nanoseconds);return U.fromTimestamp(t)}function on(r,t){let e=(t.baseMutations||[]).map(i=>uu(r.gt,i));for(let i=0;i<t.mutations.length-1;++i){let a=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){let u=t.mutations[i+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}let n=t.mutations.map(i=>uu(r.gt,i)),s=ot.fromMillis(t.localWriteTimeMs);return new gs(t.batchId,s,e,n)}function Hr(r){let t=_n(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?_n(r.lastLimboFreeSnapshotVersion):U.min(),n;return n=function(i){return i.documents!==void 0}(r.query)?function(i){let a=i.documents.length;return q(a===1,1966,{count:a}),kt(pr(fm(i.documents[0])))}(r.query):function(i){return kt(_m(i))}(r.query),new or(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,ft.fromBase64String(r.resumeToken))}function Tm(r,t){let e=yn(t.snapshotVersion),n=yn(t.lastLimboFreeSnapshotVersion),s;s=Ci(t.target)?pm(r.gt,t.target):ym(r.gt,t.target).Vt;let i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:gn(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function Gc(r){let t=_m({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?xi(t,t.limit,"L"):t}function ya(r,t){return new ps(t.largestBatchId,uu(r.gt,t.overlayMutation))}function Cd(r,t){let e=t.path.lastSegment();return[r,Dt(t.path.popLast()),e]}function Dd(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:yn(n.readTime),documentKey:Dt(n.documentKey.path),largestBatchId:n.largestBatchId}}var cu=class{getBundleMetadata(t,e){return xd(t).get(e).next(n=>{if(n)return function(i){return{id:i.bundleId,createTime:_n(i.createTime),version:i.version}}(n)})}saveBundleMetadata(t,e){return xd(t).put(function(s){return{bundleId:s.id,createTime:yn(dt(s.createTime)),version:s.version}}(e))}getNamedQuery(t,e){return Nd(t).get(e).next(n=>{if(n)return function(i){return{name:i.name,query:Gc(i.bundledQuery),readTime:_n(i.readTime)}}(n)})}saveNamedQuery(t,e){return Nd(t).put(function(s){return{name:s.name,readTime:yn(dt(s.readTime)),bundledQuery:s.bundledQuery}}(e))}};function xd(r){return Tt(r,Io)}function Nd(r){return Tt(r,To)}var Li=class r{constructor(t,e){this.serializer=t,this.userId=e}static yt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return zr(t).get(Cd(this.userId,e)).next(n=>n?ya(this.serializer,n):null)}getOverlays(t,e){let n=ee();return S.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){let s=[];return n.forEach((i,a)=>{let u=new ps(e,a);s.push(this.wt(t,u))}),S.waitFor(s)}removeOverlaysForBatchId(t,e,n){let s=new Set;e.forEach(a=>s.add(Dt(a.getCollectionPath())));let i=[];return s.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(zr(t).Y(La,u))}),S.waitFor(i)}getOverlaysForCollection(t,e,n){let s=ee(),i=Dt(e),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return zr(t).j(La,a).next(u=>{for(let l of u){let d=ya(this.serializer,l);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(t,e,n,s){let i=ee(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return zr(t).X({index:Pf,range:u},(l,d,f)=>{let g=ya(this.serializer,d);i.size()<s||g.largestBatchId===a?(i.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>i)}wt(t,e){return zr(t).put(function(s,i,a){let[u,l,d]=Cd(i,a.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:vs(s.gt,a.mutation)}}(this.serializer,this.userId,e))}};function zr(r){return Tt(r,Eo)}var lu=class{St(t){return Tt(t,Oc)}getSessionToken(t){return this.St(t).get("sessionToken").next(e=>{let n=e?.value;return n?ft.fromUint8Array(n):ft.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.St(t).put({name:"sessionToken",value:e.toUint8Array()})}};var de=class{constructor(){}bt(t,e){this.Dt(t,e),e.vt()}Dt(t,e){if("nullValue"in t)this.Ct(e,5);else if("booleanValue"in t)this.Ct(e,10),e.Ft(t.booleanValue?1:0);else if("integerValue"in t)this.Ct(e,15),e.Ft(it(t.integerValue));else if("doubleValue"in t){let n=it(t.doubleValue);isNaN(n)?this.Ct(e,13):(this.Ct(e,15),os(n)?e.Ft(0):e.Ft(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ct(e,20),typeof n=="string"&&(n=ge(n)),e.Mt(`${n.seconds||""}`),e.Ft(n.nanos||0)}else if("stringValue"in t)this.xt(t.stringValue,e),this.Ot(e);else if("bytesValue"in t)this.Ct(e,30),e.Nt(pe(t.bytesValue)),this.Ot(e);else if("referenceValue"in t)this.Bt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Ct(e,45),e.Ft(n.latitude||0),e.Ft(n.longitude||0)}else"mapValue"in t?qf(t)?this.Ct(e,Number.MAX_SAFE_INTEGER):bo(t)?this.Lt(t.mapValue,e):(this.kt(t.mapValue,e),this.Ot(e)):"arrayValue"in t?(this.qt(t.arrayValue,e),this.Ot(e)):L(19022,{Qt:t})}xt(t,e){this.Ct(e,25),this.$t(t,e)}$t(t,e){e.Mt(t)}kt(t,e){let n=t.fields||{};this.Ct(e,55);for(let s of Object.keys(n))this.xt(s,e),this.Dt(n[s],e)}Lt(t,e){var n,s;let i=t.fields||{};this.Ct(e,53);let a=tr,u=((s=(n=i[a].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.length)||0;this.Ct(e,15),e.Ft(it(u)),this.xt(a,e),this.Dt(i[a],e)}qt(t,e){let n=t.values||[];this.Ct(e,50);for(let s of n)this.Dt(s,e)}Bt(t,e){this.Ct(e,37),O.fromName(t).path.forEach(n=>{this.Ct(e,60),this.$t(n,e)})}Ct(t,e){t.Ft(e)}Ot(t){t.Ft(2)}};de.Ut=new de;var xn=255;function wy(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function kd(r){let t=64-function(n){let s=0;for(let i=0;i<8;++i){let a=wy(255&n[i]);if(s+=a,a!==8)break}return s}(r);return Math.ceil(t/8)}var hu=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Wt(n.value),n=e.next();this.Gt()}zt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.jt(n.value),n=e.next();this.Jt()}Ht(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Wt(n);else if(n<2048)this.Wt(960|n>>>6),this.Wt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Wt(480|n>>>12),this.Wt(128|63&n>>>6),this.Wt(128|63&n);else{let s=e.codePointAt(0);this.Wt(240|s>>>18),this.Wt(128|63&s>>>12),this.Wt(128|63&s>>>6),this.Wt(128|63&s)}}this.Gt()}Yt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.jt(n);else if(n<2048)this.jt(960|n>>>6),this.jt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.jt(480|n>>>12),this.jt(128|63&n>>>6),this.jt(128|63&n);else{let s=e.codePointAt(0);this.jt(240|s>>>18),this.jt(128|63&s>>>12),this.jt(128|63&s>>>6),this.jt(128|63&s)}}this.Jt()}Zt(t){let e=this.Xt(t),n=kd(e);this.en(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}tn(t){let e=this.Xt(t),n=kd(e);this.en(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}nn(){this.rn(xn),this.rn(255)}sn(){this._n(xn),this._n(255)}reset(){this.position=0}seed(t){this.en(t.length),this.buffer.set(t,this.position),this.position+=t.length}an(){return this.buffer.slice(0,this.position)}Xt(t){let e=function(i){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Wt(t){let e=255&t;e===0?(this.rn(0),this.rn(255)):e===xn?(this.rn(xn),this.rn(0)):this.rn(e)}jt(t){let e=255&t;e===0?(this._n(0),this._n(255)):e===xn?(this._n(xn),this._n(0)):this._n(t)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(t){this.en(1),this.buffer[this.position++]=t}_n(t){this.en(1),this.buffer[this.position++]=~t}en(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}},du=class{constructor(t){this.un=t}Nt(t){this.un.Kt(t)}Mt(t){this.un.Ht(t)}Ft(t){this.un.Zt(t)}vt(){this.un.nn()}},fu=class{constructor(t){this.un=t}Nt(t){this.un.zt(t)}Mt(t){this.un.Yt(t)}Ft(t){this.un.tn(t)}vt(){this.un.sn()}},an=class{constructor(){this.un=new hu,this.cn=new du(this.un),this.ln=new fu(this.un)}seed(t){this.un.seed(t)}hn(t){return t===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}};var un=class r{constructor(t,e,n,s){this.Pn=t,this.Tn=e,this.In=n,this.dn=s}En(){let t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.dn,0),e!==t?n.set([0],this.dn.length):++n[n.length-1],new r(this.Pn,this.Tn,this.In,n)}An(t,e,n){return{indexId:this.Pn,uid:t,arrayValue:gi(this.In),directionalValue:gi(this.dn),orderedDocumentKey:gi(e),documentKey:n.path.toArray()}}Rn(t,e,n){let s=this.An(t,e,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}};function be(r,t){let e=r.Pn-t.Pn;return e!==0?e:(e=Fd(r.In,t.In),e!==0?e:(e=Fd(r.dn,t.dn),e!==0?e:O.comparator(r.Tn,t.Tn)))}function Fd(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function gi(r){return la()?function(e){let n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n}(r):r}function Od(r){return typeof r!="string"?r:function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(r)}var qi=class{constructor(t){this.Vn=new et((e,n)=>It.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.mn=t.orderBy,this.fn=[];for(let e of t.filters){let n=e;n.isInequality()?this.Vn=this.Vn.add(n):this.fn.push(n)}}get gn(){return this.Vn.size>1}pn(t){if(q(t.collectionGroup===this.collectionId,49279),this.gn)return!1;let e=Da(t);if(e!==void 0&&!this.yn(e))return!1;let n=nn(t),s=new Set,i=0,a=0;for(;i<n.length&&this.yn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size>0){let u=this.Vn.getIterator().getNext();if(!s.has(u.field.canonicalString())){let l=n[i];if(!this.wn(u,l)||!this.Sn(this.mn[a++],l))return!1}++i}for(;i<n.length;++i){let u=n[i];if(a>=this.mn.length||!this.Sn(this.mn[a++],u))return!1}return!0}bn(){if(this.gn)return null;let t=new et(It.comparator),e=[];for(let n of this.fn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new jn(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new jn(n.field,0))}for(let n of this.mn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new jn(n.field,n.dir==="asc"?0:1)));return new Wn(Wn.UNKNOWN_ID,this.collectionId,e,is.empty())}yn(t){for(let e of this.fn)if(this.wn(e,t))return!0;return!1}wn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}Sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Em(r){var t,e;if(q(r instanceof Q||r instanceof tt,20012),r instanceof Q){if(r instanceof Vi){let s=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(i=>Q.create(r.field,"==",i)))||[];return tt.create(s,"or")}return r}let n=r.filters.map(s=>Em(s));return tt.create(n,r.op)}function vy(r){if(r.getFilters().length===0)return[];let t=pu(Em(r));return q(Am(t),7391),mu(t)||gu(t)?[t]:t.getFilters()}function mu(r){return r instanceof Q}function gu(r){return r instanceof tt&&Uc(r)}function Am(r){return mu(r)||gu(r)||function(e){if(e instanceof tt&&ja(e)){for(let n of e.getFilters())if(!mu(n)&&!gu(n))return!1;return!0}return!1}(r)}function pu(r){if(q(r instanceof Q||r instanceof tt,34018),r instanceof Q)return r;if(r.filters.length===1)return pu(r.filters[0]);let t=r.filters.map(n=>pu(n)),e=tt.create(t,r.op);return e=Ui(e),Am(e)?e:(q(e instanceof tt,64498),q(nr(e),40251),q(e.filters.length>1,57927),e.filters.reduce((n,s)=>Kc(n,s)))}function Kc(r,t){let e;return q(r instanceof Q||r instanceof tt,38388),q(t instanceof Q||t instanceof tt,25473),e=r instanceof Q?t instanceof Q?function(s,i){return tt.create([s,i],"and")}(r,t):Md(r,t):t instanceof Q?Md(t,r):function(s,i){if(q(s.filters.length>0&&i.filters.length>0,48005),nr(s)&&nr(i))return zf(s,i.getFilters());let a=ja(s)?s:i,u=ja(s)?i:s,l=a.filters.map(d=>Kc(d,u));return tt.create(l,"or")}(r,t),Ui(e)}function Md(r,t){if(nr(t))return zf(t,r.getFilters());{let e=t.filters.map(n=>Kc(r,n));return tt.create(e,"or")}}function Ui(r){if(q(r instanceof Q||r instanceof tt,11850),r instanceof Q)return r;let t=r.getFilters();if(t.length===1)return Ui(t[0]);if(jf(r))return r;let e=t.map(s=>Ui(s)),n=[];return e.forEach(s=>{s instanceof Q?n.push(s):s instanceof tt&&(s.op===r.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:tt.create(n,r.op)}var yu=class{constructor(){this.Dn=new Is}addToCollectionParentIndex(t,e){return this.Dn.add(e),S.resolve()}getCollectionParents(t,e){return S.resolve(this.Dn.getEntries(e))}addFieldIndex(t,e){return S.resolve()}deleteFieldIndex(t,e){return S.resolve()}deleteAllFieldIndexes(t){return S.resolve()}createTargetIndexes(t,e){return S.resolve()}getDocumentsMatchingTarget(t,e){return S.resolve(null)}getIndexType(t,e){return S.resolve(0)}getFieldIndexes(t,e){return S.resolve([])}getNextCollectionGroupToUpdate(t){return S.resolve(null)}getMinOffset(t,e){return S.resolve($t.min())}getMinOffsetFromCollectionGroup(t,e){return S.resolve($t.min())}updateCollectionGroup(t,e,n){return S.resolve()}updateIndexEntries(t,e){return S.resolve()}},Is=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new et(H.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new et(H.comparator)).toArray()}};var Ld="IndexedDbIndexManager",ii=new Uint8Array(0),_u=class{constructor(t,e){this.databaseId=e,this.vn=new Is,this.Cn=new Xt(n=>gn(n),(n,s)=>xs(n,s)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){let n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener(()=>{this.vn.add(e)});let i={collectionId:n,parent:Dt(s)};return qd(t).put(i)}return S.resolve()}getCollectionParents(t,e){let n=[],s=IDBKeyRange.bound([e,""],[gf(e),""],!1,!0);return qd(t).j(s).next(i=>{for(let a of i){if(a.collectionId!==e)break;n.push(te(a.parent))}return n})}addFieldIndex(t,e){let n=Gr(t),s=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(e);delete s.indexId;let i=n.add(s);if(e.indexState){let a=kn(t);return i.next(u=>{a.put(Dd(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return i.next()}deleteFieldIndex(t,e){let n=Gr(t),s=kn(t),i=Nn(t);return n.delete(e.indexId).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=Gr(t),n=Nn(t),s=kn(t);return e.Y().next(()=>n.Y()).next(()=>s.Y())}createTargetIndexes(t,e){return S.forEach(this.Fn(e),n=>this.getIndexType(t,n).next(s=>{if(s===0||s===1){let i=new qi(n).bn();if(i!=null)return this.addFieldIndex(t,i)}}))}getDocumentsMatchingTarget(t,e){let n=Nn(t),s=!0,i=new Map;return S.forEach(this.Fn(e),a=>this.Mn(t,a).next(u=>{s&&(s=!!u),i.set(a,u)})).next(()=>{if(s){let a=G(),u=[];return S.forEach(i,(l,d)=>{x(Ld,`Using index ${function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(l)} to execute ${gn(e)}`);let f=function(B,W){let Z=Da(W);if(Z===void 0)return null;for(let K of Di(B,Z.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null}(d,l),g=function(B,W){let Z=new Map;for(let K of nn(W))for(let v of Di(B,K.fieldPath))switch(v.op){case"==":case"in":Z.set(K.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return Z.set(K.fieldPath.canonicalString(),v.value),Array.from(Z.values())}return null}(d,l),_=function(B,W){let Z=[],K=!0;for(let v of nn(W)){let p=v.kind===0?yd(B,v.fieldPath,B.startAt):_d(B,v.fieldPath,B.startAt);Z.push(p.value),K&&(K=p.inclusive)}return new oe(Z,K)}(d,l),b=function(B,W){let Z=[],K=!0;for(let v of nn(W)){let p=v.kind===0?_d(B,v.fieldPath,B.endAt):yd(B,v.fieldPath,B.endAt);Z.push(p.value),K&&(K=p.inclusive)}return new oe(Z,K)}(d,l),D=this.xn(l,d,_),k=this.xn(l,d,b),N=this.On(l,d,g),$=this.Nn(l.indexId,f,D,_.inclusive,k,b.inclusive,N);return S.forEach($,j=>n.H(j,e.limit).next(B=>{B.forEach(W=>{let Z=O.fromSegments(W.documentKey);a.has(Z)||(a=a.add(Z),u.push(Z))})}))}).next(()=>u)}return S.resolve(null)})}Fn(t){let e=this.Cn.get(t);return e||(t.filters.length===0?e=[t]:e=vy(tt.create(t.filters,"and")).map(n=>Ja(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.Cn.set(t,e),e)}Nn(t,e,n,s,i,a,u){let l=(e!=null?e.length:1)*Math.max(n.length,i.length),d=l/(e!=null?e.length:1),f=[];for(let g=0;g<l;++g){let _=e?this.Bn(e[g/d]):ii,b=this.Ln(t,_,n[g%d],s),D=this.kn(t,_,i[g%d],a),k=u.map(N=>this.Ln(t,_,N,!0));f.push(...this.createRange(b,D,k))}return f}Ln(t,e,n,s){let i=new un(t,O.empty(),e,n);return s?i:i.En()}kn(t,e,n,s){let i=new un(t,O.empty(),e,n);return s?i.En():i}Mn(t,e){let n=new qi(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next(i=>{let a=null;for(let u of i)n.pn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,s=this.Fn(e);return S.forEach(s,i=>this.Mn(t,i).next(a=>{a?n!==0&&a.fields.length<function(l){let d=new et(It.comparator),f=!1;for(let g of l.filters)for(let _ of g.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let g of l.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)}(i)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&s.length>1&&n===2?1:n)}qn(t,e){let n=new an;for(let s of nn(t)){let i=e.data.field(s.fieldPath);if(i==null)return null;let a=n.hn(s.kind);de.Ut.bt(i,a)}return n.an()}Bn(t){let e=new an;return de.Ut.bt(t,e.hn(0)),e.an()}Qn(t,e){let n=new an;return de.Ut.bt(fn(this.databaseId,e),n.hn(function(i){let a=nn(i);return a.length===0?0:a[a.length-1].kind}(t))),n.an()}On(t,e,n){if(n===null)return[];let s=[];s.push(new an);let i=0;for(let a of nn(t)){let u=n[i++];for(let l of s)if(this.$n(e,a.fieldPath)&&fs(u))s=this.Un(s,a,u);else{let d=l.hn(a.kind);de.Ut.bt(u,d)}}return this.Kn(s)}xn(t,e,n){return this.On(t,e,n.position)}Kn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].an();return e}Un(t,e,n){let s=[...t],i=[];for(let a of n.arrayValue.values||[])for(let u of s){let l=new an;l.seed(u.an()),de.Ut.bt(a,l.hn(e.kind)),i.push(l)}return i}$n(t,e){return!!t.filters.find(n=>n instanceof Q&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=Gr(t),s=kn(t);return(e?n.j(Ma,IDBKeyRange.bound(e,e)):n.j()).next(i=>{let a=[];return S.forEach(i,u=>s.get([u.indexId,this.uid]).next(l=>{a.push(function(f,g){let _=g?new is(g.sequenceNumber,new $t(_n(g.readTime),new O(te(g.documentKey)),g.largestBatchId)):is.empty(),b=f.fields.map(([D,k])=>new jn(It.fromServerFormat(D),k));return new Wn(f.indexId,f.collectionGroup,b,_)}(u,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,s)=>{let i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:z(n.collectionGroup,s.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let s=Gr(t),i=kn(t);return this.Wn(t).next(a=>s.j(Ma,IDBKeyRange.bound(e,e)).next(u=>S.forEach(u,l=>i.put(Dd(l.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return S.forEach(e,(s,i)=>{let a=n.get(s.collectionGroup);return(a?S.resolve(a):this.getFieldIndexes(t,s.collectionGroup)).next(u=>(n.set(s.collectionGroup,u),S.forEach(u,l=>this.Gn(t,s,l).next(d=>{let f=this.zn(i,l);return d.isEqual(f)?S.resolve():this.jn(t,i,l,d,f)}))))})}Jn(t,e,n,s){return Nn(t).put(s.An(this.uid,this.Qn(n,e.key),e.key))}Hn(t,e,n,s){return Nn(t).delete(s.Rn(this.uid,this.Qn(n,e.key),e.key))}Gn(t,e,n){let s=Nn(t),i=new et(be);return s.X({index:Rf,range:IDBKeyRange.only([n.indexId,this.uid,gi(this.Qn(n,e))])},(a,u)=>{i=i.add(new un(n.indexId,e,Od(u.arrayValue),Od(u.directionalValue)))}).next(()=>i)}zn(t,e){let n=new et(be),s=this.qn(e,t);if(s==null)return n;let i=Da(e);if(i!=null){let a=t.data.field(i.fieldPath);if(fs(a))for(let u of a.arrayValue.values||[])n=n.add(new un(e.indexId,t.key,this.Bn(u),s))}else n=n.add(new un(e.indexId,t.key,ii,s));return n}jn(t,e,n,s,i){x(Ld,"Updating index entries for document '%s'",e.key);let a=[];return function(l,d,f,g,_){let b=l.getIterator(),D=d.getIterator(),k=Dn(b),N=Dn(D);for(;k||N;){let $=!1,j=!1;if(k&&N){let B=f(k,N);B<0?j=!0:B>0&&($=!0)}else k!=null?j=!0:$=!0;$?(g(N),N=Dn(D)):j?(_(k),k=Dn(b)):(k=Dn(b),N=Dn(D))}}(s,i,be,u=>{a.push(this.Jn(t,e,n,u))},u=>{a.push(this.Hn(t,e,n,u))}),S.waitFor(a)}Wn(t){let e=1;return kn(t).X({index:bf,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,i)=>{i.done(),e=s.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>be(a,u)).filter((a,u,l)=>!u||be(a,l[u-1])!==0);let s=[];s.push(t);for(let a of n){let u=be(a,t),l=be(a,e);if(u===0)s[0]=t.En();else if(u>0&&l<0)s.push(a),s.push(a.En());else if(l>0)break}s.push(e);let i=[];for(let a=0;a<s.length;a+=2){if(this.Yn(s[a],s[a+1]))return[];let u=s[a].Rn(this.uid,ii,O.empty()),l=s[a+1].Rn(this.uid,ii,O.empty());i.push(IDBKeyRange.bound(u,l))}return i}Yn(t,e){return be(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Ud)}getMinOffset(t,e){return S.mapArray(this.Fn(e),n=>this.Mn(t,n).next(s=>s||L(44426))).next(Ud)}};function qd(r){return Tt(r,cs)}function Nn(r){return Tt(r,Yr)}function Gr(r){return Tt(r,Fc)}function kn(r){return Tt(r,Jr)}function Ud(r){q(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let s=r[n].indexState.offset;xc(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new $t(t.readTime,t.documentKey,e)}var Bd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Sm=41943040,Ot=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};function bm(r,t,e){let n=r.store(Kt),s=r.store(Hn),i=[],a=IDBKeyRange.only(e.batchId),u=0,l=n.X({range:a},(f,g,_)=>(u++,_.delete()));i.push(l.next(()=>{q(u===1,47070,{batchId:e.batchId})}));let d=[];for(let f of e.mutations){let g=Ef(t,f.key.path,e.batchId);i.push(s.delete(g)),d.push(f.key)}return S.waitFor(i).next(()=>d)}function Bi(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw L(14731);t=r.noDocument}return JSON.stringify(t).length}Ot.DEFAULT_COLLECTION_PERCENTILE=10,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ot.DEFAULT=new Ot(Sm,Ot.DEFAULT_COLLECTION_PERCENTILE,Ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ot.DISABLED=new Ot(-1,0,0);var ji=class r{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Zn={}}static yt(t,e,n,s){q(t.uid!=="",64387);let i=t.isAuthenticated()?t.uid:"";return new r(i,e,n,s)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Re(t).X({index:cn,range:n},(s,i,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,s){let i=Un(t),a=Re(t);return a.add({}).next(u=>{q(typeof u=="number",49019);let l=new gs(u,e,n,s),d=function(b,D,k){let N=k.baseMutations.map(j=>vs(b.gt,j)),$=k.mutations.map(j=>vs(b.gt,j));return{userId:D,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:N,mutations:$}}(this.serializer,this.userId,l),f=[],g=new et((_,b)=>z(_.canonicalString(),b.canonicalString()));for(let _ of s){let b=Ef(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(d)),f.push(i.put(b,vp))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(t,_))}),t.addOnCommittedListener(()=>{this.Zn[u]=l.keys()}),S.waitFor(f).next(()=>l)})}lookupMutationBatch(t,e){return Re(t).get(e).next(n=>n?(q(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),on(this.serializer,n)):null)}Xn(t,e){return this.Zn[e]?S.resolve(this.Zn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let s=n.keys();return this.Zn[e]=s,s}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]),i=null;return Re(t).X({index:cn,range:s},(a,u,l)=>{u.userId===this.userId&&(q(u.batchId>=n,47524,{er:n}),i=on(this.serializer,u)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=xe;return Re(t).X({index:cn,range:e,reverse:!0},(s,i,a)=>{n=i.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,xe],[this.userId,Number.POSITIVE_INFINITY]);return Re(t).j(cn,e).next(n=>n.map(s=>on(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=ci(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Un(t).X({range:s},(a,u,l)=>{let[d,f,g]=a,_=te(f);if(d===this.userId&&e.path.isEqual(_))return Re(t).get(g).next(b=>{if(!b)throw L(61480,{tr:a,batchId:g});q(b.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:b.userId,batchId:g}),i.push(on(this.serializer,b))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(z),s=[];return e.forEach(i=>{let a=ci(this.userId,i.path),u=IDBKeyRange.lowerBound(a),l=Un(t).X({range:u},(d,f,g)=>{let[_,b,D]=d,k=te(b);_===this.userId&&i.path.isEqual(k)?n=n.add(D):g.done()});s.push(l)}),S.waitFor(s).next(()=>this.nr(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=ci(this.userId,n),a=IDBKeyRange.lowerBound(i),u=new et(z);return Un(t).X({range:a},(l,d,f)=>{let[g,_,b]=l,D=te(_);g===this.userId&&n.isPrefixOf(D)?D.length===s&&(u=u.add(b)):f.done()}).next(()=>this.nr(t,u))}nr(t,e){let n=[],s=[];return e.forEach(i=>{s.push(Re(t).get(i).next(a=>{if(a===null)throw L(35274,{batchId:i});q(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),n.push(on(this.serializer,a))}))}),S.waitFor(s).next(()=>n)}removeMutationBatch(t,e){return bm(t.ce,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.rr(e.batchId)}),S.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))}rr(t){delete this.Zn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return S.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return Un(t).X({range:n},(i,a,u)=>{if(i[0]===this.userId){let l=te(i[1]);s.push(l)}else u.done()}).next(()=>{q(s.length===0,56720,{ir:s.map(i=>i.canonicalString())})})})}containsKey(t,e){return Rm(t,this.userId,e)}sr(t){return Pm(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:xe,lastStreamToken:""})}};function Rm(r,t,e){let n=ci(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n),a=!1;return Un(r).X({range:i,Z:!0},(u,l,d)=>{let[f,g,_]=u;f===t&&g===s&&(a=!0),d.done()}).next(()=>a)}function Re(r){return Tt(r,Kt)}function Un(r){return Tt(r,Hn)}function Pm(r){return Tt(r,as)}var ar=class r{constructor(t){this._r=t}next(){return this._r+=2,this._r}static ar(){return new r(0)}static ur(){return new r(-1)}};var wu=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.cr(t).next(e=>{let n=new ar(e.highestTargetId);return e.highestTargetId=n.next(),this.lr(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.cr(t).next(e=>U.fromTimestamp(new ot(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.cr(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.cr(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.lr(t,s)))}addTargetData(t,e){return this.hr(t,e).next(()=>this.cr(t).next(n=>(n.targetCount+=1,this.Pr(e,n),this.lr(t,n))))}updateTargetData(t,e){return this.hr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Fn(t).delete(e.targetId)).next(()=>this.cr(t)).next(n=>(q(n.targetCount>0,8065),n.targetCount-=1,this.lr(t,n)))}removeTargets(t,e,n){let s=0,i=[];return Fn(t).X((a,u)=>{let l=Hr(u);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(t,l)))}).next(()=>S.waitFor(i)).next(()=>s)}forEachTarget(t,e){return Fn(t).X((n,s)=>{let i=Hr(s);e(i)})}cr(t){return jd(t).get(Ai).next(e=>(q(e!==null,2888),e))}lr(t,e){return jd(t).put(Ai,e)}hr(t,e){return Fn(t).put(Tm(this.serializer,e))}Pr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.cr(t).next(e=>e.targetCount)}getTargetData(t,e){let n=gn(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Fn(t).X({range:s,index:Sf},(a,u,l)=>{let d=Hr(u);xs(e,d.target)&&(i=d,l.done())}).next(()=>i)}addMatchingKeys(t,e,n){let s=[],i=Ve(t);return e.forEach(a=>{let u=Dt(a.path);s.push(i.put({targetId:n,path:u})),s.push(this.referenceDelegate.addReference(t,n,a))}),S.waitFor(s)}removeMatchingKeys(t,e,n){let s=Ve(t);return S.forEach(e,i=>{let a=Dt(i.path);return S.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(t,n,i)])})}removeMatchingKeysForTargetId(t,e){let n=Ve(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),s=Ve(t),i=G();return s.X({range:n,Z:!0},(a,u,l)=>{let d=te(a[1]),f=new O(d);i=i.add(f)}).next(()=>i)}containsKey(t,e){let n=Dt(e.path),s=IDBKeyRange.bound([n],[gf(n)],!1,!0),i=0;return Ve(t).X({index:kc,Z:!0,range:s},([a,u],l,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}Et(t,e){return Fn(t).get(e).next(n=>n?Hr(n):null)}};function Fn(r){return Tt(r,Xn)}function jd(r){return Tt(r,dn)}function Ve(r){return Tt(r,Jn)}var $d="LruGarbageCollector",Iy=1048576;function zd([r,t],[e,n]){let s=z(r,e);return s===0?z(t,n):s}var vu=class{constructor(t){this.Tr=t,this.buffer=new et(zd),this.Ir=0}dr(){return++this.Ir}Er(t){let e=[t,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();zd(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},$i=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(t){x($d,`Garbage collection scheduled in ${t}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>V(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Qe(e)?x($d,"Ignoring IndexedDB error during garbage collection: ",e):yield Ke(e)}yield this.Rr(3e5)}))}},Iu=class{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.mr(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return S.resolve(Ut.ue);let n=new vu(e);return this.Vr.forEachTarget(t,s=>n.Er(s.sequenceNumber)).next(()=>this.Vr.gr(t,s=>n.Er(s))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Vr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(x("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Bd)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bd):this.pr(t,e))}getCacheSize(t){return this.Vr.getCacheSize(t)}pr(t,e){let n,s,i,a,u,l,d,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,a=Date.now(),this.nthSequenceNumber(t,s))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(i=g,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(d=Date.now(),On()<=Yt.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${i} targets in `+(l-u)+`ms
	Removed ${g} documents in `+(d-l)+`ms
Total Duration: ${d-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:g})))}};function Vm(r,t){return new Iu(r,t)}var Tu=class{constructor(t,e){this.db=t,this.garbageCollector=Vm(this,e)}mr(t){let e=this.yr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}yr(t){let e=0;return this.gr(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}gr(t,e){return this.wr(t,(n,s)=>e(s))}addReference(t,e,n){return oi(t,n)}removeReference(t,e,n){return oi(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return oi(t,e)}Sr(t,e){return function(s,i){let a=!1;return Pm(s).ee(u=>Rm(s,u,i).next(l=>(l&&(a=!0),S.resolve(!l)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],i=0;return this.wr(t,(a,u)=>{if(u<=e){let l=this.Sr(t,a).next(d=>{if(!d)return i++,n.getEntry(t,a).next(()=>(n.removeEntry(a,U.min()),Ve(t).delete(function(g){return[0,Dt(g.path)]}(a))))});s.push(l)}}).next(()=>S.waitFor(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return oi(t,e)}wr(t,e){let n=Ve(t),s,i=Ut.ue;return n.X({index:kc},([a,u],{path:l,sequenceNumber:d})=>{a===0?(i!==Ut.ue&&e(new O(te(s)),i),i=d,s=l):i=Ut.ue}).next(()=>{i!==Ut.ue&&e(new O(te(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function oi(r,t){return Ve(r).put(function(n,s){return{targetId:0,path:Dt(n.path),sequenceNumber:s}}(t,r.currentSequenceNumber))}var zi=class{constructor(){this.changes=new Xt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,_t.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?S.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Eu=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return en(t).put(n)}removeEntry(t,e,n){return en(t).delete(function(i,a){let u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Mi(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.br(t,n)))}getEntry(t,e){let n=_t.newInvalidDocument(e);return en(t).X({index:li,range:IDBKeyRange.only(Kr(e))},(s,i)=>{n=this.Dr(e,i)}).next(()=>n)}vr(t,e){let n={size:0,document:_t.newInvalidDocument(e)};return en(t).X({index:li,range:IDBKeyRange.only(Kr(e))},(s,i)=>{n={document:this.Dr(e,i),size:Bi(i)}}).next(()=>n)}getEntries(t,e){let n=Mt();return this.Cr(t,e,(s,i)=>{let a=this.Dr(s,i);n=n.insert(s,a)}).next(()=>n)}Fr(t,e){let n=Mt(),s=new st(O.comparator);return this.Cr(t,e,(i,a)=>{let u=this.Dr(i,a);n=n.insert(i,u),s=s.insert(i,Bi(a))}).next(()=>({documents:n,Mr:s}))}Cr(t,e,n){if(e.isEmpty())return S.resolve();let s=new et(Qd);e.forEach(l=>s=s.add(l));let i=IDBKeyRange.bound(Kr(s.first()),Kr(s.last())),a=s.getIterator(),u=a.getNext();return en(t).X({index:li,range:i},(l,d,f)=>{let g=O.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&Qd(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.G(Kr(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,s,i){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),Mi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return en(t).j(IDBKeyRange.bound(u,l,!0)).next(d=>{i?.incrementDocumentReadCount(d.length);let f=Mt();for(let g of d){let _=this.Dr(O.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(ks(e,_)||s.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(t,e,n,s){let i=Mt(),a=Kd(e,n),u=Kd(e,$t.max());return en(t).X({index:Af,range:IDBKeyRange.bound(a,u,!0)},(l,d,f)=>{let g=this.Dr(O.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(g.key,g),i.size===s&&f.done()}).next(()=>i)}newChangeBuffer(t){return new Au(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Gd(t).get(Oa).next(e=>(q(!!e,20021),e))}br(t,e){return Gd(t).put(Oa,e)}Dr(t,e){if(e){let n=_y(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(U.min())))return n}return _t.newInvalidDocument(t)}};function Cm(r){return new Eu(r)}var Au=class extends zi{constructor(t,e){super(),this.Or=t,this.trackRemovals=e,this.Nr=new Xt(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(t){let e=[],n=0,s=new et((i,a)=>z(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{let u=this.Nr.get(i);if(e.push(this.Or.removeEntry(t,i,u.readTime)),a.isValidDocument()){let l=Vd(this.Or.serializer,a);s=s.add(i.path.popLast());let d=Bi(l);n+=d-u.size,e.push(this.Or.addEntry(t,i,l))}else if(n-=u.size,this.trackRemovals){let l=Vd(this.Or.serializer,a.convertToNoDocument(U.min()));e.push(this.Or.addEntry(t,i,l))}}),s.forEach(i=>{e.push(this.Or.indexManager.addToCollectionParentIndex(t,i))}),e.push(this.Or.updateMetadata(t,n)),S.waitFor(e)}getFromCache(t,e){return this.Or.vr(t,e).next(n=>(this.Nr.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.Or.Fr(t,e).next(({documents:n,Mr:s})=>(s.forEach((i,a)=>{this.Nr.set(i,{size:a,readTime:n.get(i).readTime})}),n))}};function Gd(r){return Tt(r,us)}function en(r){return Tt(r,Ei)}function Kr(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Kd(r,t){let e=t.documentKey.path.toArray();return[r,Mi(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Qd(r,t){let e=r.path.toArray(),n=t.path.toArray(),s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=z(e[i],n[i]),s)return s;return s=z(e.length,n.length),s||(s=z(e[e.length-2],n[n.length-2]),s||z(e[e.length-1],n[n.length-1]))}var Su=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Gi=class{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(n=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(n!==null&&es(n.mutation,s,Bt.empty(),ot.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,G()).next(()=>n))}getLocalViewOfDocuments(t,e,n=G()){let s=ee();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,n).next(i=>{let a=Wr();return i.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=ee();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,G()))}populateOverlays(t,e,n){let s=[];return n.forEach(i=>{e.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(t,s).next(i=>{i.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,s){let i=Mt(),a=ts(),u=function(){return ts()}();return e.forEach((l,d)=>{let f=n.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof Jt)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),es(f.mutation,d,f.mutation.getFieldMask(),ot.now())):a.set(d.key,Bt.empty())}),this.recalculateAndSaveOverlays(t,i).next(l=>(l.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var g;return u.set(d,new Su(f,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(t,e){let n=ts(),s=new st((a,u)=>a-u),i=G();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=e.get(l);if(d===null)return;let f=n.get(l)||Bt.empty();f=u.applyToLocalView(d,f),n.set(l,f);let g=(s.get(u.batchId)||G()).add(l);s=s.insert(u.batchId,g)})}).next(()=>{let a=[],u=s.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,f=l.value,g=Zf();f.forEach(_=>{if(!i.has(_)){let b=om(e.get(_),n.get(_));b!==null&&g.set(_,b),i=i.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return S.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,s){return function(a){return O.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Bc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next(i=>{let a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):S.resolve(ee()),u=Qn,l=i;return a.next(d=>S.forEach(d,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),i.get(f)?S.resolve():this.remoteDocumentCache.getEntry(t,f).next(_=>{l=l.insert(f,_)}))).next(()=>this.populateOverlays(t,d,i)).next(()=>this.computeViews(t,l,d,G())).next(f=>({batchId:u,changes:Yf(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new O(e)).next(n=>{let s=Wr();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){let i=e.collectionGroup,a=Wr();return this.indexManager.getCollectionParents(t,i).next(u=>S.forEach(u,l=>{let d=function(g,_){return new Ht(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(e,l.child(i));return this.getDocumentsMatchingCollectionQuery(t,d,n,s).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s))).next(a=>{i.forEach((l,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,_t.newInvalidDocument(f)))});let u=Wr();return a.forEach((l,d)=>{let f=i.get(l);f!==void 0&&es(f.mutation,d,Bt.empty(),ot.now()),ks(e,d)&&(u=u.insert(l,d))}),u})}};var bu=class{constructor(t){this.serializer=t,this.Br=new Map,this.Lr=new Map}getBundleMetadata(t,e){return S.resolve(this.Br.get(e))}saveBundleMetadata(t,e){return this.Br.set(e.id,function(s){return{id:s.id,version:s.version,createTime:dt(s.createTime)}}(e)),S.resolve()}getNamedQuery(t,e){return S.resolve(this.Lr.get(e))}saveNamedQuery(t,e){return this.Lr.set(e.name,function(s){return{name:s.name,query:Gc(s.bundledQuery),readTime:dt(s.readTime)}}(e)),S.resolve()}};var Ru=class{constructor(){this.overlays=new st(O.comparator),this.kr=new Map}getOverlay(t,e){return S.resolve(this.overlays.get(e))}getOverlays(t,e){let n=ee();return S.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((s,i)=>{this.wt(t,e,i)}),S.resolve()}removeOverlaysForBatchId(t,e,n){let s=this.kr.get(n);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.kr.delete(n)),S.resolve()}getOverlaysForCollection(t,e,n){let s=ee(),i=e.length+1,a=new O(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===i&&l.largestBatchId>n&&s.set(l.getKey(),l)}return S.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new st((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=i.get(d.largestBatchId);f===null&&(f=ee(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=ee(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=s)););return S.resolve(u)}wt(t,e,n){let s=this.overlays.get(n.key);if(s!==null){let a=this.kr.get(s.largestBatchId).delete(n.key);this.kr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new ps(e,n));let i=this.kr.get(e);i===void 0&&(i=G(),this.kr.set(e,i)),this.kr.set(e,i.add(n.key))}};var Pu=class{constructor(){this.sessionToken=ft.EMPTY_BYTE_STRING}getSessionToken(t){return S.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,S.resolve()}};var Ts=class{constructor(){this.qr=new et(gt.Qr),this.$r=new et(gt.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(t,e){let n=new gt(t,e);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Wr(new gt(t,e))}Gr(t,e){t.forEach(n=>this.removeReference(n,e))}zr(t){let e=new O(new H([])),n=new gt(e,t),s=new gt(e,t+1),i=[];return this.$r.forEachInRange([n,s],a=>{this.Wr(a),i.push(a.key)}),i}jr(){this.qr.forEach(t=>this.Wr(t))}Wr(t){this.qr=this.qr.delete(t),this.$r=this.$r.delete(t)}Jr(t){let e=new O(new H([])),n=new gt(e,t),s=new gt(e,t+1),i=G();return this.$r.forEachInRange([n,s],a=>{i=i.add(a.key)}),i}containsKey(t){let e=new gt(t,0),n=this.qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},gt=class{constructor(t,e){this.key=t,this.Hr=e}static Qr(t,e){return O.comparator(t.key,e.key)||z(t.Hr,e.Hr)}static Ur(t,e){return z(t.Hr,e.Hr)||O.comparator(t.key,e.key)}};var Vu=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.er=1,this.Yr=new et(gt.Qr)}checkEmpty(t){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){let i=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new gs(i,e,n,s);this.mutationQueue.push(a);for(let u of s)this.Yr=this.Yr.add(new gt(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return S.resolve(a)}lookupMutationBatch(t,e){return S.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=this.Xr(n),i=s<0?0:s;return S.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?xe:this.er-1)}getAllMutationBatches(t){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new gt(e,0),s=new gt(e,Number.POSITIVE_INFINITY),i=[];return this.Yr.forEachInRange([n,s],a=>{let u=this.Zr(a.Hr);i.push(u)}),S.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(z);return e.forEach(s=>{let i=new gt(s,0),a=new gt(s,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([i,a],u=>{n=n.add(u.Hr)})}),S.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=n;O.isDocumentKey(i)||(i=i.child(""));let a=new gt(new O(i),0),u=new et(z);return this.Yr.forEachWhile(l=>{let d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===s&&(u=u.add(l.Hr)),!0)},a),S.resolve(this.ei(u))}ei(t){let e=[];return t.forEach(n=>{let s=this.Zr(n);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){q(this.ti(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Yr;return S.forEach(e.mutations,s=>{let i=new gt(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Yr=n})}rr(t){}containsKey(t,e){let n=new gt(e,0),s=this.Yr.firstAfterOrEqual(n);return S.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,S.resolve()}ti(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){let e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Cu=class{constructor(t){this.ni=t,this.docs=function(){return new st(O.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,s=this.docs.get(n),i=s?s.size:0,a=this.ni(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return S.resolve(n?n.document.mutableCopy():_t.newInvalidDocument(e))}getEntries(t,e){let n=Mt();return e.forEach(s=>{let i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():_t.newInvalidDocument(s))}),S.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=Mt(),a=e.path,u=new O(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:f}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||xc(wf(f),n)<=0||(s.has(f.key)||ks(e,f))&&(i=i.insert(f.key,f.mutableCopy()))}return S.resolve(i)}getAllFromCollectionGroup(t,e,n,s){L(9500)}ri(t,e){return S.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new Du(this)}getSize(t){return S.resolve(this.size)}},Du=class extends zi{constructor(t){super(),this.Or=t}applyChanges(t){let e=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?e.push(this.Or.addEntry(t,s)):this.Or.removeEntry(n)}),S.waitFor(e)}getFromCache(t,e){return this.Or.getEntry(t,e)}getAllFromCache(t,e){return this.Or.getEntries(t,e)}};var xu=class{constructor(t){this.persistence=t,this.ii=new Xt(e=>gn(e),xs),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.si=0,this.oi=new Ts,this.targetCount=0,this._i=ar.ar()}forEachTarget(t,e){return this.ii.forEach((n,s)=>e(s)),S.resolve()}getLastRemoteSnapshotVersion(t){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return S.resolve(this.si)}allocateTargetId(t){return this.highestTargetId=this._i.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.si&&(this.si=e),S.resolve()}hr(t){this.ii.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this._i=new ar(e),this.highestTargetId=e),t.sequenceNumber>this.si&&(this.si=t.sequenceNumber)}addTargetData(t,e){return this.hr(e),this.targetCount+=1,S.resolve()}updateTargetData(t,e){return this.hr(e),S.resolve()}removeTargetData(t,e){return this.ii.delete(e.target),this.oi.zr(e.targetId),this.targetCount-=1,S.resolve()}removeTargets(t,e,n){let s=0,i=[];return this.ii.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.ii.delete(a),i.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)}),S.waitFor(i).next(()=>s)}getTargetCount(t){return S.resolve(this.targetCount)}getTargetData(t,e){let n=this.ii.get(e)||null;return S.resolve(n)}addMatchingKeys(t,e,n){return this.oi.Kr(e,n),S.resolve()}removeMatchingKeys(t,e,n){this.oi.Gr(e,n);let s=this.persistence.referenceDelegate,i=[];return s&&e.forEach(a=>{i.push(s.markPotentiallyOrphaned(t,a))}),S.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.oi.zr(e),S.resolve()}getMatchingKeysForTargetId(t,e){let n=this.oi.Jr(e);return S.resolve(n)}containsKey(t,e){return S.resolve(this.oi.containsKey(e))}};var Es=class{constructor(t,e){this.ai={},this.overlays={},this.ui=new Ut(0),this.ci=!1,this.ci=!0,this.li=new Pu,this.referenceDelegate=t(this),this.hi=new xu(this),this.indexManager=new yu,this.remoteDocumentCache=function(s){return new Cu(s)}(n=>this.referenceDelegate.Pi(n)),this.serializer=new Oi(e),this.Ti=new bu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Ru,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ai[t.toKey()];return n||(n=new Vu(e,this.referenceDelegate),this.ai[t.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(t,e,n){x("MemoryPersistence","Starting transaction:",t);let s=new Nu(this.ui.next());return this.referenceDelegate.Ii(),n(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ei(t,e){return S.or(Object.values(this.ai).map(n=>()=>n.containsKey(t,e)))}},Nu=class extends vi{constructor(t){super(),this.currentSequenceNumber=t}},Ki=class r{constructor(t){this.persistence=t,this.Ai=new Ts,this.Ri=null}static Vi(t){return new r(t)}get mi(){if(this.Ri)return this.Ri;throw L(60996)}addReference(t,e,n){return this.Ai.addReference(n,e),this.mi.delete(n.toString()),S.resolve()}removeReference(t,e,n){return this.Ai.removeReference(n,e),this.mi.add(n.toString()),S.resolve()}markPotentiallyOrphaned(t,e){return this.mi.add(e.toString()),S.resolve()}removeTarget(t,e){this.Ai.zr(e.targetId).forEach(s=>this.mi.add(s.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(i=>this.mi.add(i.toString()))}).next(()=>n.removeTargetData(t,e))}Ii(){this.Ri=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.mi,n=>{let s=O.fromPath(n);return this.fi(t,s).next(i=>{i||e.removeEntry(s,U.min())})}).next(()=>(this.Ri=null,e.apply(t)))}updateLimboDocument(t,e){return this.fi(t,e).next(n=>{n?this.mi.delete(e.toString()):this.mi.add(e.toString())})}Pi(t){return 0}fi(t,e){return S.or([()=>S.resolve(this.Ai.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}},Qi=class r{constructor(t,e){this.persistence=t,this.gi=new Xt(n=>Dt(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=Vm(this,e)}static Vi(t,e){return new r(t,e)}Ii(){}di(t){return S.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}mr(t){let e=this.yr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}yr(t){let e=0;return this.gr(t,n=>{e++}).next(()=>e)}gr(t,e){return S.forEach(this.gi,(n,s)=>this.Sr(t,n,s).next(i=>i?S.resolve():e(s)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ri(t,a=>this.Sr(t,a,e).next(u=>{u||(n++,i.removeEntry(a,U.min()))})).next(()=>i.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.gi.set(e,t.currentSequenceNumber),S.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.gi.set(n,t.currentSequenceNumber),S.resolve()}removeReference(t,e,n){return this.gi.set(n,t.currentSequenceNumber),S.resolve()}updateLimboDocument(t,e){return this.gi.set(e,t.currentSequenceNumber),S.resolve()}Pi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=di(t.data.value)),e}Sr(t,e,n){return S.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.gi.get(e);return S.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var ku=class{constructor(t){this.serializer=t}q(t,e,n,s){let i=new Ii("createOrUpgrade",e);n<1&&s>=1&&(function(l){l.createObjectStore(Ds)}(t),function(l){l.createObjectStore(as,{keyPath:wp}),l.createObjectStore(Kt,{keyPath:od,autoIncrement:!0}).createIndex(cn,ad,{unique:!0}),l.createObjectStore(Hn)}(t),Wd(t),function(l){l.createObjectStore(rn)}(t));let a=S.resolve();return n<3&&s>=3&&(n!==0&&(function(l){l.deleteObjectStore(Jn),l.deleteObjectStore(Xn),l.deleteObjectStore(dn)}(t),Wd(t)),a=a.next(()=>function(l){let d=l.store(dn),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:U.min().toTimestamp(),targetCount:0};return d.put(Ai,f)}(i))),n<4&&s>=4&&(n!==0&&(a=a.next(()=>function(l,d){return d.store(Kt).j().next(g=>{l.deleteObjectStore(Kt),l.createObjectStore(Kt,{keyPath:od,autoIncrement:!0}).createIndex(cn,ad,{unique:!0});let _=d.store(Kt),b=g.map(D=>_.put(D));return S.waitFor(b)})}(t,i))),a=a.next(()=>{(function(l){l.createObjectStore(Yn,{keyPath:Pp})})(t)})),n<5&&s>=5&&(a=a.next(()=>this.pi(i))),n<6&&s>=6&&(a=a.next(()=>(function(l){l.createObjectStore(us)}(t),this.yi(i)))),n<7&&s>=7&&(a=a.next(()=>this.wi(i))),n<8&&s>=8&&(a=a.next(()=>this.Si(t,i))),n<9&&s>=9&&(a=a.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&s>=10&&(a=a.next(()=>this.bi(i))),n<11&&s>=11&&(a=a.next(()=>{(function(l){l.createObjectStore(Io,{keyPath:Vp})})(t),function(l){l.createObjectStore(To,{keyPath:Cp})}(t)})),n<12&&s>=12&&(a=a.next(()=>{(function(l){let d=l.createObjectStore(Eo,{keyPath:Mp});d.createIndex(La,Lp,{unique:!1}),d.createIndex(Pf,qp,{unique:!1})})(t)})),n<13&&s>=13&&(a=a.next(()=>function(l){let d=l.createObjectStore(Ei,{keyPath:Ip});d.createIndex(li,Tp),d.createIndex(Af,Ep)}(t)).next(()=>this.Di(t,i)).next(()=>t.deleteObjectStore(rn))),n<14&&s>=14&&(a=a.next(()=>this.Ci(t,i))),n<15&&s>=15&&(a=a.next(()=>function(l){l.createObjectStore(Fc,{keyPath:Dp,autoIncrement:!0}).createIndex(Ma,xp,{unique:!1}),l.createObjectStore(Jr,{keyPath:Np}).createIndex(bf,kp,{unique:!1}),l.createObjectStore(Yr,{keyPath:Fp}).createIndex(Rf,Op,{unique:!1})}(t))),n<16&&s>=16&&(a=a.next(()=>{e.objectStore(Jr).clear()}).next(()=>{e.objectStore(Yr).clear()})),n<17&&s>=17&&(a=a.next(()=>{(function(l){l.createObjectStore(Oc,{keyPath:Up})})(t)})),n<18&&s>=18&&la()&&(a=a.next(()=>{e.objectStore(Jr).clear()}).next(()=>{e.objectStore(Yr).clear()})),a}yi(t){let e=0;return t.store(rn).X((n,s)=>{e+=Bi(s)}).next(()=>{let n={byteSize:e};return t.store(us).put(Oa,n)})}pi(t){let e=t.store(as),n=t.store(Kt);return e.j().next(s=>S.forEach(s,i=>{let a=IDBKeyRange.bound([i.userId,xe],[i.userId,i.lastAcknowledgedBatchId]);return n.j(cn,a).next(u=>S.forEach(u,l=>{q(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});let d=on(this.serializer,l);return bm(t,i.userId,d).next(()=>{})}))}))}wi(t){let e=t.store(Jn),n=t.store(rn);return t.store(dn).get(Ai).next(s=>{let i=[];return n.X((a,u)=>{let l=new H(a),d=function(g){return[0,Dt(g)]}(l);i.push(e.get(d).next(f=>f?S.resolve():(g=>e.put({targetId:0,path:Dt(g),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>S.waitFor(i))})}Si(t,e){t.createObjectStore(cs,{keyPath:Rp});let n=e.store(cs),s=new Is,i=a=>{if(s.add(a)){let u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:Dt(l)})}};return e.store(rn).X({Z:!0},(a,u)=>{let l=new H(a);return i(l.popLast())}).next(()=>e.store(Hn).X({Z:!0},([a,u,l],d)=>{let f=te(u);return i(f.popLast())}))}bi(t){let e=t.store(Xn);return e.X((n,s)=>{let i=Hr(s),a=Tm(this.serializer,i);return e.put(a)})}Di(t,e){let n=e.store(rn),s=[];return n.X((i,a)=>{let u=e.store(Ei),l=function(g){return g.document?new O(H.fromString(g.document.name).popFirst(5)):g.noDocument?O.fromSegments(g.noDocument.path):g.unknownDocument?O.fromSegments(g.unknownDocument.path):L(36783)}(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(u.put(d))}).next(()=>S.waitFor(s))}Ci(t,e){let n=e.store(Kt),s=Cm(this.serializer),i=new Es(Ki.Vi,this.serializer.gt);return n.j().next(a=>{let u=new Map;return a.forEach(l=>{var d;let f=(d=u.get(l.userId))!==null&&d!==void 0?d:G();on(this.serializer,l).keys().forEach(g=>f=f.add(g)),u.set(l.userId,f)}),S.forEach(u,(l,d)=>{let f=new pt(d),g=Li.yt(this.serializer,f),_=i.getIndexManager(f),b=ji.yt(f,this.serializer,_,i.referenceDelegate);return new Gi(s,b,g,_).recalculateAndSaveOverlaysForDocumentKeys(new ls(e,Ut.ue),l).next()})})}};function Wd(r){r.createObjectStore(Jn,{keyPath:Sp}).createIndex(kc,bp,{unique:!0}),r.createObjectStore(Xn,{keyPath:"targetId"}).createIndex(Sf,Ap,{unique:!0}),r.createObjectStore(dn)}var Pe="IndexedDbPersistence",_a=18e5,wa=5e3,va="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Dm="main",Fu=class r{constructor(t,e,n,s,i,a,u,l,d,f,g=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Fi=i,this.window=a,this.document=u,this.Mi=d,this.xi=f,this.Oi=g,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=_=>Promise.resolve(),!r.C())throw new C(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Tu(this,s),this.Qi=e+Dm,this.serializer=new Oi(l),this.$i=new Oe(this.Qi,this.Oi,new ku(this.serializer)),this.li=new lu,this.hi=new wu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Cm(this.serializer),this.Ti=new cu,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,f===!1&&ht(Pe,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(R.FAILED_PRECONDITION,va);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.hi.getHighestSequenceNumber(t))}).then(t=>{this.ui=new Ut(t,this.Mi)}).then(()=>{this.ci=!0}).catch(t=>(this.$i&&this.$i.close(),Promise.reject(t)))}ji(t){return this.qi=e=>V(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.$i.setDatabaseDeletedListener(t)}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Fi.enqueueAndForget(()=>V(this,null,function*(){this.started&&(yield this.Ki())})))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>ai(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(t).next(e=>{e||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(t)).next(e=>this.isPrimary&&!e?this.Yi(t).next(()=>!1):!!e&&this.Zi(t).next(()=>!0))).catch(t=>{if(Qe(t))return x(Pe,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return x(Pe,"Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Fi.enqueueRetryable(()=>this.qi(t)),this.isPrimary=t})}Ji(t){return Qr(t).get(Cn).next(e=>S.resolve(this.Xi(e)))}es(t){return ai(t).delete(this.clientId)}ts(){return V(this,null,function*(){if(this.isPrimary&&!this.ns(this.ki,_a)){this.ki=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=Tt(e,Yn);return n.j().next(s=>{let i=this.rs(s,_a),a=s.filter(u=>i.indexOf(u)===-1);return S.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ui)for(let e of t)this.Ui.removeItem(this.ss(e.clientId))}})}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(t){return!!t&&t.ownerId===this.clientId}Hi(t){return this.xi?S.resolve(!0):Qr(t).get(Cn).next(e=>{if(e!==null&&this.ns(e.leaseTimestampMs,wa)&&!this._s(e.ownerId)){if(this.Xi(e)&&this.networkEnabled)return!0;if(!this.Xi(e)){if(!e.allowTabSynchronization)throw new C(R.FAILED_PRECONDITION,va);return!1}}return!(!this.networkEnabled||!this.inForeground)||ai(t).j().next(n=>this.rs(n,wa).find(s=>{if(this.clientId!==s.clientId){let i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,u=this.networkEnabled===s.networkEnabled;if(i||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&x(Pe,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return V(this,null,function*(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),yield this.$i.runTransaction("shutdown","readwrite",[Ds,Yn],t=>{let e=new ls(t,Ut.ue);return this.Yi(e).next(()=>this.es(e))}),this.$i.close(),this.hs()})}rs(t,e){return t.filter(n=>this.ns(n.updateTimeMs,e)&&!this._s(n.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",t=>ai(t).j().next(e=>this.rs(e,_a).map(n=>n.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(t,e){return ji.yt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new _u(t,this.serializer.gt.databaseId)}getDocumentOverlayCache(t){return Li.yt(this.serializer,t)}getBundleCache(){return this.Ti}runTransaction(t,e,n){x(Pe,"Starting transaction:",t);let s=e==="readonly"?"readonly":"readwrite",i=function(l){return l===18?$p:l===17?xf:l===16?jp:l===15?Mc:l===14?Df:l===13?Cf:l===12?Bp:l===11?Vf:void L(60245)}(this.Oi),a;return this.$i.runTransaction(t,s,i,u=>(a=new ls(u,this.ui?this.ui.next():Ut.ue),e==="readwrite-primary"?this.Ji(a).next(l=>!!l||this.Hi(a)).next(l=>{if(!l)throw ht(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new C(R.FAILED_PRECONDITION,vf);return n(a)}).next(l=>this.Zi(a).next(()=>l)):this.Ts(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ts(t){return Qr(t).get(Cn).next(e=>{if(e!==null&&this.ns(e.leaseTimestampMs,wa)&&!this._s(e.ownerId)&&!this.Xi(e)&&!(this.xi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new C(R.FAILED_PRECONDITION,va)})}Zi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Qr(t).put(Cn,e)}static C(){return Oe.C()}Yi(t){let e=Qr(t);return e.get(Cn).next(n=>this.Xi(n)?(x(Pe,"Releasing primary lease."),e.delete(Cn)):S.resolve())}ns(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(ht(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Ni=()=>{this.us();let e=/(?:Version|Mobile)\/1[456]/;ca()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(t){var e;try{let n=((e=this.Ui)===null||e===void 0?void 0:e.getItem(this.ss(t)))!==null;return x(Pe,`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ht(Pe,"Failed to get zombied client id.",n),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(t){ht("Failed to set zombie client id.",t)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function Qr(r){return Tt(r,Ds)}function ai(r){return Tt(r,Yn)}function Qc(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var Ou=class r{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Is=n,this.ds=s}static Es(t,e){let n=G(),s=G();for(let i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new r(t,e.fromCache,n,s)}};var Mu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Wi=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return ca()?8:If(Br())>0?6:4}()}initialize(t,e){this.gs=t,this.indexManager=e,this.As=!0}getDocumentsMatchingQuery(t,e,n,s){let i={result:null};return this.ps(t,e).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ys(t,e,s,n).next(a=>{i.result=a})}).next(()=>{if(i.result)return;let a=new Mu;return this.ws(t,e,a).next(u=>{if(i.result=u,this.Rs)return this.Ss(t,e,a,u.size)})}).next(()=>i.result)}Ss(t,e,n,s){return n.documentReadCount<this.Vs?(On()<=Yt.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",Mn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),S.resolve()):(On()<=Yt.DEBUG&&x("QueryEngine","Query:",Mn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.fs*s?(On()<=Yt.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",Mn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,kt(e))):S.resolve())}ps(t,e){if(wd(e))return S.resolve(null);let n=kt(e);return this.indexManager.getIndexType(t,n).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=xi(e,null,"F"),n=kt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(i=>{let a=G(...i);return this.gs.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(l=>{let d=this.bs(e,u);return this.Ds(e,d,a,l.readTime)?this.ps(t,xi(e,null,"F")):this.vs(t,d,e,l)}))})))}ys(t,e,n,s){return wd(e)||s.isEqual(U.min())?S.resolve(null):this.gs.getDocuments(t,n).next(i=>{let a=this.bs(e,i);return this.Ds(e,a,n,s)?S.resolve(null):(On()<=Yt.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Mn(e)),this.vs(t,a,e,_f(s,Qn)).next(u=>u))})}bs(t,e){let n=new et(Xf(t));return e.forEach((s,i)=>{ks(t,i)&&(n=n.add(i))}),n}Ds(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ws(t,e,n){return On()<=Yt.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",Mn(e)),this.gs.getDocumentsMatchingQuery(t,e,$t.min(),n)}vs(t,e,n,s){return this.gs.getDocumentsMatchingQuery(t,n,s).next(i=>(e.forEach(a=>{i=i.insert(a.key,a)}),i))}};var Wc="LocalStore",Ty=3e8,Lu=class{constructor(t,e,n,s){this.persistence=t,this.Cs=e,this.serializer=s,this.Fs=new st(z),this.Ms=new Xt(i=>gn(i),xs),this.xs=new Map,this.Os=t.getRemoteDocumentCache(),this.hi=t.getTargetCache(),this.Ti=t.getBundleCache(),this.Ns(n)}Ns(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Gi(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Fs))}};function xm(r,t,e,n){return new Lu(r,t,e,n)}function Nm(r,t){return V(this,null,function*(){let e=M(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,e.Ns(t),e.mutationQueue.getAllMutationBatches(n))).next(i=>{let a=[],u=[],l=G();for(let d of s){a.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}for(let d of i){u.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}return e.localDocuments.getDocuments(n,l).next(d=>({Bs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function Ey(r,t){let e=M(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let s=t.batch.keys(),i=e.Os.newChangeBuffer({trackRemovals:!0});return function(u,l,d,f){let g=d.batch,_=g.keys(),b=S.resolve();return _.forEach(D=>{b=b.next(()=>f.getEntry(l,D)).next(k=>{let N=d.docVersions.get(D);q(N!==null,48541),k.version.compareTo(N)<0&&(g.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))})}),b.next(()=>u.mutationQueue.removeMutationBatch(l,g))}(e,n,t,i).next(()=>i.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let l=G();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l}(t))).next(()=>e.localDocuments.getDocuments(n,s))})}function km(r){let t=M(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}function Ay(r,t){let e=M(r),n=t.snapshotVersion,s=e.Fs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let a=e.Os.newChangeBuffer({trackRemovals:!0});s=e.Fs;let u=[];t.targetChanges.forEach((f,g)=>{let _=s.get(g);if(!_)return;u.push(e.hi.removeMatchingKeys(i,f.removedDocuments,g).next(()=>e.hi.addMatchingKeys(i,f.addedDocuments,g)));let b=_.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(g)!==null?b=b.withResumeToken(ft.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):f.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(f.resumeToken,n)),s=s.insert(g,b),function(k,N,$){return k.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=Ty?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(_,b,f)&&u.push(e.hi.updateTargetData(i,b))});let l=Mt(),d=G();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(i,f))}),u.push(Fm(i,a,t.documentUpdates).next(f=>{l=f.Ls,d=f.ks})),!n.isEqual(U.min())){let f=e.hi.getLastRemoteSnapshotVersion(i).next(g=>e.hi.setTargetsMetadata(i,i.currentSequenceNumber,n));u.push(f)}return S.waitFor(u).next(()=>a.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,l,d)).next(()=>l)}).then(i=>(e.Fs=s,i))}function Fm(r,t,e){let n=G(),s=G();return e.forEach(i=>n=n.add(i)),t.getEntries(r,n).next(i=>{let a=Mt();return e.forEach((u,l)=>{let d=i.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),l.isNoDocument()&&l.version.isEqual(U.min())?(t.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(u,l)):x(Wc,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{Ls:a,ks:s}})}function Sy(r,t){let e=M(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=xe),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function ur(r,t){let e=M(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return e.hi.getTargetData(n,t).next(i=>i?(s=i,S.resolve(s)):e.hi.allocateTargetId(n).next(a=>(s=new or(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.hi.addTargetData(n,s).next(()=>s))))}).then(n=>{let s=e.Fs.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Fs=e.Fs.insert(n.targetId,n),e.Ms.set(t,n.targetId)),n})}function cr(r,t,e){return V(this,null,function*(){let n=M(r),s=n.Fs.get(t),i=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",i,a=>n.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Qe(a))throw a;x(Wc,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Fs=n.Fs.remove(t),n.Ms.delete(s.target)})}function Hi(r,t,e){let n=M(r),s=U.min(),i=G();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,f){let g=M(l),_=g.Ms.get(f);return _!==void 0?S.resolve(g.Fs.get(_)):g.hi.getTargetData(d,f)}(n,a,kt(t)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.hi.getMatchingKeysForTargetId(a,u.targetId).next(l=>{i=l})}).next(()=>n.Cs.getDocumentsMatchingQuery(a,t,e?s:U.min(),e?i:G())).next(u=>(Lm(n,Hf(t),u),{documents:u,qs:i})))}function Om(r,t){let e=M(r),n=M(e.hi),s=e.Fs.get(t);return s?Promise.resolve(s.target):e.persistence.runTransaction("Get target data","readonly",i=>n.Et(i,t).next(a=>a?a.target:null))}function Mm(r,t){let e=M(r),n=e.xs.get(t)||U.min();return e.persistence.runTransaction("Get new document changes","readonly",s=>e.Os.getAllFromCollectionGroup(s,t,_f(n,Qn),Number.MAX_SAFE_INTEGER)).then(s=>(Lm(e,t,s),s))}function Lm(r,t,e){let n=r.xs.get(t)||U.min();e.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.xs.set(t,n)}function by(r,t,e,n){return V(this,null,function*(){let s=M(r),i=G(),a=Mt();for(let d of e){let f=t.Qs(d.metadata.name);d.document&&(i=i.add(f));let g=t.$s(d);g.setReadTime(t.Us(d.metadata.readTime)),a=a.insert(f,g)}let u=s.Os.newChangeBuffer({trackRemovals:!0}),l=yield ur(s,function(f){return kt(pr(H.fromString(`__bundle__/docs/${f}`)))}(n));return s.persistence.runTransaction("Apply bundle documents","readwrite",d=>Fm(d,u,a).next(f=>(u.apply(d),f)).next(f=>s.hi.removeMatchingKeysForTargetId(d,l.targetId).next(()=>s.hi.addMatchingKeys(d,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,f.Ls,f.ks)).next(()=>f.Ls)))})}function Ry(n,s){return V(this,arguments,function*(r,t,e=G()){let i=yield ur(r,kt(Gc(t.bundledQuery))),a=M(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let l=dt(t.readTime);if(i.snapshotVersion.compareTo(l)>=0)return a.Ti.saveNamedQuery(u,t);let d=i.withResumeToken(ft.EMPTY_BYTE_STRING,l);return a.Fs=a.Fs.insert(d.targetId,d),a.hi.updateTargetData(u,d).next(()=>a.hi.removeMatchingKeysForTargetId(u,i.targetId)).next(()=>a.hi.addMatchingKeys(u,e,i.targetId)).next(()=>a.Ti.saveNamedQuery(u,t))})})}var qm="firestore_clients";function Hd(r,t){return`${qm}_${r}_${t}`}var Um="firestore_mutations";function Xd(r,t,e){let n=`${Um}_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}var Bm="firestore_targets";function Ia(r,t){return`${Bm}_${r}_${t}`}var Zt="SharedClientState",Xi=class r{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Ks(t,e,n){let s=JSON.parse(n),i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new C(s.error.code,s.error.message))),a?new r(t,e,s.state,i):(ht(Zt,`Failed to parse mutation state for ID '${e}': ${n}`),null)}Ws(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},ns=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ks(t,e){let n=JSON.parse(e),s,i=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return i&&n.error&&(i=typeof n.error.message=="string"&&typeof n.error.code=="string",i&&(s=new C(n.error.code,n.error.message))),i?new r(t,n.state,s):(ht(Zt,`Failed to parse target state for ID '${t}': ${e}`),null)}Ws(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Ji=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ks(t,e){let n=JSON.parse(e),s=typeof n=="object"&&n.activeTargetIds instanceof Array,i=jc();for(let a=0;s&&a<n.activeTargetIds.length;++a)s=Tf(n.activeTargetIds[a]),i=i.add(n.activeTargetIds[a]);return s?new r(t,i):(ht(Zt,`Failed to parse client data for instance '${t}': ${e}`),null)}},qu=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Ks(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(ht(Zt,`Failed to parse online state: ${t}`),null)}},As=class{constructor(){this.activeTargetIds=jc()}Gs(t){this.activeTargetIds=this.activeTargetIds.add(t)}zs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},rs=class{constructor(t,e,n,s,i){this.window=t,this.Fi=e,this.persistenceKey=n,this.js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new st(z),this.started=!1,this.Zs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=Hd(this.persistenceKey,this.js),this.eo=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new As),this.no=new RegExp(`^${qm}_${a}_([^_]*)$`),this.ro=new RegExp(`^${Um}_${a}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${Bm}_${a}_(\\d+)$`),this.so=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.oo=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(t){return!(!t||!t.localStorage)}start(){return V(this,null,function*(){let t=yield this.syncEngine.Ps();for(let n of t){if(n===this.js)continue;let s=this.getItem(Hd(this.persistenceKey,n));if(s){let i=Ji.Ks(n,s);i&&(this.Ys=this.Ys.insert(i.clientId,i))}}this._o();let e=this.storage.getItem(this.so);if(e){let n=this.ao(e);n&&this.uo(n)}for(let n of this.Zs)this.Hs(n);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.eo,JSON.stringify(t))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(t){let e=!1;return this.Ys.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.lo(t,"pending")}updateMutationState(t,e,n){this.lo(t,e,n),this.ho(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let s=this.storage.getItem(Ia(this.persistenceKey,t));if(s){let i=ns.Ks(t,s);i&&(n=i.state)}}return e&&this.Po.Gs(t),this._o(),n}removeLocalQueryTarget(t){this.Po.zs(t),this._o()}isLocalQueryTarget(t){return this.Po.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Ia(this.persistenceKey,t))}updateQueryState(t,e,n){this.To(t,e,n)}handleUserChange(t,e,n){e.forEach(s=>{this.ho(s)}),this.currentUser=t,n.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(t){this.Io(t)}notifyBundleLoaded(t){this.Eo(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return x(Zt,"READ",t,e),e}setItem(t,e){x(Zt,"SET",t,e),this.storage.setItem(t,e)}removeItem(t){x(Zt,"REMOVE",t),this.storage.removeItem(t)}Hs(t){let e=t;if(e.storageArea===this.storage){if(x(Zt,"EVENT",e.key,e.newValue),e.key===this.Xs)return void ht("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(()=>V(this,null,function*(){if(this.started){if(e.key!==null){if(this.no.test(e.key)){if(e.newValue==null){let n=this.Ao(e.key);return this.Ro(n,null)}{let n=this.Vo(e.key,e.newValue);if(n)return this.Ro(n.clientId,n)}}else if(this.ro.test(e.key)){if(e.newValue!==null){let n=this.mo(e.key,e.newValue);if(n)return this.fo(n)}}else if(this.io.test(e.key)){if(e.newValue!==null){let n=this.po(e.key,e.newValue);if(n)return this.yo(n)}}else if(e.key===this.so){if(e.newValue!==null){let n=this.ao(e.newValue);if(n)return this.uo(n)}}else if(e.key===this.eo){let n=function(i){let a=Ut.ue;if(i!=null)try{let u=JSON.parse(i);q(typeof u=="number",30636,{wo:i}),a=u}catch(u){ht(Zt,"Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==Ut.ue&&this.sequenceNumberHandler(n)}else if(e.key===this.oo){let n=this.So(e.newValue);yield Promise.all(n.map(s=>this.syncEngine.bo(s)))}}}else this.Zs.push(e)}))}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(t,e,n){let s=new Xi(this.currentUser,t,e,n),i=Xd(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Ws())}ho(t){let e=Xd(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Io(t){let e={clientId:this.js,onlineState:t};this.storage.setItem(this.so,JSON.stringify(e))}To(t,e,n){let s=Ia(this.persistenceKey,t),i=new ns(t,e,n);this.setItem(s,i.Ws())}Eo(t){let e=JSON.stringify(Array.from(t));this.setItem(this.oo,e)}Ao(t){let e=this.no.exec(t);return e?e[1]:null}Vo(t,e){let n=this.Ao(t);return Ji.Ks(n,e)}mo(t,e){let n=this.ro.exec(t),s=Number(n[1]),i=n[2]!==void 0?n[2]:null;return Xi.Ks(new pt(i),s,e)}po(t,e){let n=this.io.exec(t),s=Number(n[1]);return ns.Ks(s,e)}ao(t){return qu.Ks(t)}So(t){return JSON.parse(t)}fo(t){return V(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Do(t.batchId,t.state,t.error);x(Zt,`Ignoring mutation for non-active user ${t.user.uid}`)})}yo(t){return this.syncEngine.vo(t.targetId,t.state,t.error)}Ro(t,e){let n=e?this.Ys.insert(t,e):this.Ys.remove(t),s=this.co(this.Ys),i=this.co(n),a=[],u=[];return i.forEach(l=>{s.has(l)||a.push(l)}),s.forEach(l=>{i.has(l)||u.push(l)}),this.syncEngine.Co(a,u).then(()=>{this.Ys=n})}uo(t){this.Ys.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}co(t){let e=jc();return t.forEach((n,s)=>{e=e.unionWith(s.activeTargetIds)}),e}},Yi=class{constructor(){this.Fo=new As,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Fo.Gs(t),this.Mo[t]||"not-current"}updateQueryState(t,e,n){this.Mo[t]=e}removeLocalQueryTarget(t){this.Fo.zs(t)}isLocalQueryTarget(t){return this.Fo.activeTargetIds.has(t)}clearQueryState(t){delete this.Mo[t]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(t){return this.Fo.activeTargetIds.has(t)}start(){return this.Fo=new As,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Uu=class{xo(t){}shutdown(){}};var Jd="ConnectivityMonitor",Zi=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(t){this.ko.push(t)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){x(Jd,"Network connectivity changed: AVAILABLE");for(let t of this.ko)t(0)}Lo(){x(Jd,"Network connectivity changed: UNAVAILABLE");for(let t of this.ko)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ui=null;function Bu(){return ui===null?ui=function(){return 268435456+Math.round(2147483648*Math.random())}():ui++,"0x"+ui.toString(16)}var Ta="RestConnection",Py={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},ju=class{get Qo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.$o=e+"://"+t.host,this.Uo=`projects/${n}/databases/${s}`,this.Ko=this.databaseId.database===Ri?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Wo(t,e,n,s,i){let a=Bu(),u=this.Go(t,e.toUriEncodedString());x(Ta,`Sending RPC '${t}' ${a}:`,u,n);let l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(l,s,i);let{host:d}=new URL(u),f=ua(d);return this.jo(t,u,l,n,f).then(g=>(x(Ta,`Received RPC '${t}' ${a}: `,g),g),g=>{throw jt(Ta,`RPC '${t}' ${a} failed with error: `,g,"url: ",u,"request:",n),g})}Jo(t,e,n,s,i,a){return this.Wo(t,e,n,s,i)}zo(t,e,n){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+gr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,i)=>t[i]=s),n&&n.headers.forEach((s,i)=>t[i]=s)}Go(t,e){let n=Py[t];return`${this.$o}/v1/${e}:${n}`}terminate(){}};var $u=class{constructor(t){this.Ho=t.Ho,this.Yo=t.Yo}Zo(t){this.Xo=t}e_(t){this.t_=t}n_(t){this.r_=t}onMessage(t){this.i_=t}close(){this.Yo()}send(t){this.Ho(t)}s_(){this.Xo()}o_(){this.t_()}__(t){this.r_(t)}a_(t){this.i_(t)}};var Vt="WebChannelConnection",zu=class extends ju{constructor(t){super(t),this.u_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}jo(t,e,n,s,i){let a=Bu();return new Promise((u,l)=>{let d=new da;d.setWithCredentials(!0),d.listenOnce(fa.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case $r.NO_ERROR:let g=d.getResponseJson();x(Vt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(g)),u(g);break;case $r.TIMEOUT:x(Vt,`RPC '${t}' ${a} timed out`),l(new C(R.DEADLINE_EXCEEDED,"Request time out"));break;case $r.HTTP_ERROR:let _=d.getStatus();if(x(Vt,`RPC '${t}' ${a} failed with status:`,_,"response text:",d.getResponseText()),_>0){let b=d.getResponseJson();Array.isArray(b)&&(b=b[0]);let D=b?.error;if(D&&D.status&&D.message){let k=function($){let j=$.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(j)>=0?j:R.UNKNOWN}(D.status);l(new C(k,D.message))}else l(new C(R.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new C(R.UNAVAILABLE,"Connection failed."));break;default:L(9055,{c_:t,streamId:a,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{x(Vt,`RPC '${t}' ${a} completed.`)}});let f=JSON.stringify(s);x(Vt,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",f,n,15)})}P_(t,e,n){let s=Bu(),i=[this.$o,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=pa(),u=ga(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.zo(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;let f=i.join("");x(Vt,`Creating RPC '${t}' stream ${s}: ${f}`,l);let g=a.createWebChannel(f,l);this.T_(g);let _=!1,b=!1,D=new $u({Ho:N=>{b?x(Vt,`Not sending because RPC '${t}' stream ${s} is closed:`,N):(_||(x(Vt,`Opening RPC '${t}' stream ${s} transport.`),g.open(),_=!0),x(Vt,`RPC '${t}' stream ${s} sending:`,N),g.send(N))},Yo:()=>g.close()}),k=(N,$,j)=>{N.listen($,B=>{try{j(B)}catch(W){setTimeout(()=>{throw W},0)}})};return k(g,Vn.EventType.OPEN,()=>{b||(x(Vt,`RPC '${t}' stream ${s} transport opened.`),D.s_())}),k(g,Vn.EventType.CLOSE,()=>{b||(b=!0,x(Vt,`RPC '${t}' stream ${s} transport closed`),D.__(),this.I_(g))}),k(g,Vn.EventType.ERROR,N=>{b||(b=!0,jt(Vt,`RPC '${t}' stream ${s} transport errored. Name:`,N.name,"Message:",N.message),D.__(new C(R.UNAVAILABLE,"The operation could not be completed")))}),k(g,Vn.EventType.MESSAGE,N=>{var $;if(!b){let j=N.data[0];q(!!j,16349);let B=j,W=B?.error||(($=B[0])===null||$===void 0?void 0:$.error);if(W){x(Vt,`RPC '${t}' stream ${s} received error:`,W);let Z=W.status,K=function(w){let I=mt[w];if(I!==void 0)return cm(I)}(Z),v=W.message;K===void 0&&(K=R.INTERNAL,v="Unknown error status: "+Z+" with message "+W.message),b=!0,D.__(new C(K,v)),g.close()}else x(Vt,`RPC '${t}' stream ${s} received:`,j),D.a_(j)}}),k(u,ma.STAT_EVENT,N=>{N.stat===ri.PROXY?x(Vt,`RPC '${t}' stream ${s} detected buffering proxy`):N.stat===ri.NOPROXY&&x(Vt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{D.o_()},0),D}terminate(){this.u_.forEach(t=>t.close()),this.u_=[]}T_(t){this.u_.push(t)}I_(t){this.u_=this.u_.filter(e=>e===t)}};function jm(){return typeof window<"u"?window:null}function pi(){return typeof document<"u"?document:null}function Fs(r){return new su(r,!0)}var Ss=class{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Fi=t,this.timerId=e,this.d_=n,this.E_=s,this.A_=i,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(t){this.cancel();let e=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),s=Math.max(0,e-n);s>0&&x("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.R_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,s,()=>(this.m_=Date.now(),t())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var Yd="PersistentStream",to=class{constructor(t,e,n,s,i,a,u,l){this.Fi=t,this.w_=n,this.S_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Ss(t,e)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return V(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(t){this.q_(),this.stream.send(t)}L_(){return V(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(t,e){return V(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,t!==4?this.F_.reset():e&&e.code===R.RESOURCE_EXHAUSTED?(ht(e.toString()),ht("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):e&&e.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.n_(e)})}U_(){}auth(){this.state=1;let t=this.K_(this.b_),e=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.b_===e&&this.W_(n,s)},n=>{t(()=>{let s=new C(R.UNKNOWN,"Fetching auth token failed: "+n.message);return this.G_(s)})})}W_(t,e){let n=this.K_(this.b_);this.stream=this.z_(t,e),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.e_(()=>{n(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(s=>{n(()=>this.G_(s))}),this.stream.onMessage(s=>{n(()=>++this.C_==1?this.j_(s):this.onNext(s))})}O_(){this.state=5,this.F_.g_(()=>V(this,null,function*(){this.state=0,this.start()}))}G_(t){return x(Yd,`close with error: ${t}`),this.stream=null,this.close(4,t)}K_(t){return e=>{this.Fi.enqueueAndForget(()=>this.b_===t?e():(x(Yd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Gu=class extends to{constructor(t,e,n,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}z_(t,e){return this.connection.P_("Listen",t,e)}j_(t){return this.onNext(t)}onNext(t){this.F_.reset();let e=hy(this.serializer,t),n=function(i){if(!("targetChange"in i))return U.min();let a=i.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?dt(a.readTime):U.min()}(t);return this.listener.J_(e,n)}H_(t){let e={};e.database=au(this.serializer),e.addTarget=function(i,a){let u,l=a.target;if(u=Ci(l)?{documents:pm(i,l)}:{query:ym(i,l).Vt},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=lm(i,a.resumeToken);let d=iu(i,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){u.readTime=ir(i,a.snapshotVersion.toTimestamp());let d=iu(i,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,t);let n=fy(this.serializer,t);n&&(e.labels=n),this.k_(e)}Y_(t){let e={};e.database=au(this.serializer),e.removeTarget=t,this.k_(e)}},Ku=class extends to{constructor(t,e,n,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(t,e){return this.connection.P_("Write",t,e)}j_(t){return q(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,q(!t.writeResults||t.writeResults.length===0,55816),this.listener.ea()}onNext(t){q(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.F_.reset();let e=dy(t.writeResults,t.commitTime),n=dt(t.commitTime);return this.listener.ta(n,e)}na(){let t={};t.database=au(this.serializer),this.k_(t)}X_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>vs(this.serializer,n))};this.k_(e)}};var Qu=class{},Wu=class extends Qu{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ra=!1}ia(){if(this.ra)throw new C(R.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,n,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Wo(t,ou(e,n),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new C(R.UNKNOWN,i.toString())})}Jo(t,e,n,s,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Jo(t,ou(e,n),s,a,u,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new C(R.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Hu=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(t){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ua("Offline")))}set(t){this.ha(),this.sa=0,t==="Online"&&(this._a=!1),this.ua(t)}ua(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ca(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(ht(e),this._a=!1):x("OnlineStateTracker",e)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var wn="RemoteStore",Xu=class{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=i,this.Ea.xo(a=>{n.enqueueAndForget(()=>V(this,null,function*(){He(this)&&(x(wn,"Restarting streams for network reachability change."),yield function(l){return V(this,null,function*(){let d=M(l);d.Ia.add(4),yield yr(d),d.Aa.set("Unknown"),d.Ia.delete(4),yield Os(d)})}(this))}))}),this.Aa=new Hu(n,s)}};function Os(r){return V(this,null,function*(){if(He(r))for(let t of r.da)yield t(!0)})}function yr(r){return V(this,null,function*(){for(let t of r.da)yield t(!1)})}function Ro(r,t){let e=M(r);e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),Jc(e)?Xc(e):wr(e).x_()&&Hc(e,t))}function lr(r,t){let e=M(r),n=wr(e);e.Ta.delete(t),n.x_()&&$m(e,t),e.Ta.size===0&&(n.x_()?n.B_():He(e)&&e.Aa.set("Unknown"))}function Hc(r,t){if(r.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(U.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}wr(r).H_(t)}function $m(r,t){r.Ra.$e(t),wr(r).Y_(t)}function Xc(r){r.Ra=new ru({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>r.Ta.get(t)||null,lt:()=>r.datastore.serializer.databaseId}),wr(r).start(),r.Aa.aa()}function Jc(r){return He(r)&&!wr(r).M_()&&r.Ta.size>0}function He(r){return M(r).Ia.size===0}function zm(r){r.Ra=void 0}function Vy(r){return V(this,null,function*(){r.Aa.set("Online")})}function Cy(r){return V(this,null,function*(){r.Ta.forEach((t,e)=>{Hc(r,t)})})}function Dy(r,t){return V(this,null,function*(){zm(r),Jc(r)?(r.Aa.la(t),Xc(r)):r.Aa.set("Unknown")})}function xy(r,t,e){return V(this,null,function*(){if(r.Aa.set("Online"),t instanceof ki&&t.state===2&&t.cause)try{yield function(s,i){return V(this,null,function*(){let a=i.cause;for(let u of i.targetIds)s.Ta.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.Ta.delete(u),s.Ra.removeTarget(u))})}(r,t)}catch(n){x(wn,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield eo(r,n)}else if(t instanceof zn?r.Ra.Ye(t):t instanceof Ni?r.Ra.it(t):r.Ra.et(t),!e.isEqual(U.min()))try{let n=yield km(r.localStore);e.compareTo(n)>=0&&(yield function(i,a){let u=i.Ra.Pt(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let f=i.Ta.get(d);f&&i.Ta.set(d,f.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let f=i.Ta.get(l);if(!f)return;i.Ta.set(l,f.withResumeToken(ft.EMPTY_BYTE_STRING,f.snapshotVersion)),$m(i,l);let g=new or(f.target,l,d,f.sequenceNumber);Hc(i,g)}),i.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){x(wn,"Failed to raise snapshot:",n),yield eo(r,n)}})}function eo(r,t,e){return V(this,null,function*(){if(!Qe(t))throw t;r.Ia.add(1),yield yr(r),r.Aa.set("Offline"),e||(e=()=>km(r.localStore)),r.asyncQueue.enqueueRetryable(()=>V(null,null,function*(){x(wn,"Retrying IndexedDB access"),yield e(),r.Ia.delete(1),yield Os(r)}))})}function Gm(r,t){return t().catch(e=>eo(r,e,t))}function _r(r){return V(this,null,function*(){let t=M(r),e=$e(t),n=t.Pa.length>0?t.Pa[t.Pa.length-1].batchId:xe;for(;Ny(t);)try{let s=yield Sy(t.localStore,n);if(s===null){t.Pa.length===0&&e.B_();break}n=s.batchId,ky(t,s)}catch(s){yield eo(t,s)}Km(t)&&Qm(t)})}function Ny(r){return He(r)&&r.Pa.length<10}function ky(r,t){r.Pa.push(t);let e=$e(r);e.x_()&&e.Z_&&e.X_(t.mutations)}function Km(r){return He(r)&&!$e(r).M_()&&r.Pa.length>0}function Qm(r){$e(r).start()}function Fy(r){return V(this,null,function*(){$e(r).na()})}function Oy(r){return V(this,null,function*(){let t=$e(r);for(let e of r.Pa)t.X_(e.mutations)})}function My(r,t,e){return V(this,null,function*(){let n=r.Pa.shift(),s=tu.from(n,t,e);yield Gm(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield _r(r)})}function Ly(r,t){return V(this,null,function*(){t&&$e(r).Z_&&(yield function(n,s){return V(this,null,function*(){if(function(a){return um(a)&&a!==R.ABORTED}(s.code)){let i=n.Pa.shift();$e(n).N_(),yield Gm(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s)),yield _r(n)}})}(r,t)),Km(r)&&Qm(r)})}function Zd(r,t){return V(this,null,function*(){let e=M(r);e.asyncQueue.verifyOperationInProgress(),x(wn,"RemoteStore received new credentials");let n=He(e);e.Ia.add(3),yield yr(e),n&&e.Aa.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),yield Os(e)})}function Ju(r,t){return V(this,null,function*(){let e=M(r);t?(e.Ia.delete(2),yield Os(e)):t||(e.Ia.add(2),yield yr(e),e.Aa.set("Unknown"))})}function wr(r){return r.Va||(r.Va=function(e,n,s){let i=M(e);return i.ia(),new Gu(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Zo:Vy.bind(null,r),e_:Cy.bind(null,r),n_:Dy.bind(null,r),J_:xy.bind(null,r)}),r.da.push(t=>V(null,null,function*(){t?(r.Va.N_(),Jc(r)?Xc(r):r.Aa.set("Unknown")):(yield r.Va.stop(),zm(r))}))),r.Va}function $e(r){return r.ma||(r.ma=function(e,n,s){let i=M(e);return i.ia(),new Ku(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Zo:()=>Promise.resolve(),e_:Fy.bind(null,r),n_:Ly.bind(null,r),ea:Oy.bind(null,r),ta:My.bind(null,r)}),r.da.push(t=>V(null,null,function*(){t?(r.ma.N_(),yield _r(r)):(yield r.ma.stop(),r.Pa.length>0&&(x(wn,`Stopping write stream with ${r.Pa.length} pending writes`),r.Pa=[]))}))),r.ma}var Yu=class r{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new vt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){let a=Date.now()+n,u=new r(t,e,a,s,i);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new C(R.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function vr(r,t){if(ht("AsyncQueue",`${t}: ${r}`),Qe(r))return new C(R.UNAVAILABLE,`${t}: ${r}`);throw r}var no=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||O.comparator(e.key,n.key):(e,n)=>O.comparator(e.key,n.key),this.keyedMap=Wr(),this.sortedSet=new st(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var ro=class{constructor(){this.fa=new st(O.comparator)}track(t){let e=t.doc.key,n=this.fa.get(e);n?t.type!==0&&n.type===3?this.fa=this.fa.insert(e,t):t.type===3&&n.type!==1?this.fa=this.fa.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.fa=this.fa.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.fa=this.fa.remove(e):t.type===1&&n.type===2?this.fa=this.fa.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):L(63341,{At:t,ga:n}):this.fa=this.fa.insert(e,t)}pa(){let t=[];return this.fa.inorderTraversal((e,n)=>{t.push(n)}),t}},hr=class r{constructor(t,e,n,s,i,a,u,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,s,i){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,no.emptySet(e),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ns(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}};var Zu=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(t=>t.ba())}},tc=class{constructor(){this.queries=tf(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(e,n){let s=M(e),i=s.queries;s.queries=tf(),i.forEach((a,u)=>{for(let l of u.wa)l.onError(n)})})(this,new C(R.ABORTED,"Firestore shutting down"))}};function tf(){return new Xt(r=>Wf(r),Ns)}function Yc(r,t){return V(this,null,function*(){let e=M(r),n=3,s=t.query,i=e.queries.get(s);i?!i.Sa()&&t.ba()&&(n=2):(i=new Zu,n=t.ba()?0:1);try{switch(n){case 0:i.ya=yield e.onListen(s,!0);break;case 1:i.ya=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(a){let u=vr(a,`Initialization of query '${Mn(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,i),i.wa.push(t),t.va(e.onlineState),i.ya&&t.Ca(i.ya)&&tl(e)})}function Zc(r,t){return V(this,null,function*(){let e=M(r),n=t.query,s=3,i=e.queries.get(n);if(i){let a=i.wa.indexOf(t);a>=0&&(i.wa.splice(a,1),i.wa.length===0?s=t.ba()?0:1:!i.Sa()&&t.ba()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function qy(r,t){let e=M(r),n=!1;for(let s of t){let i=s.query,a=e.queries.get(i);if(a){for(let u of a.wa)u.Ca(s)&&(n=!0);a.ya=s}}n&&tl(e)}function Uy(r,t,e){let n=M(r),s=n.queries.get(t);if(s)for(let i of s.wa)i.onError(e);n.queries.delete(t)}function tl(r){r.Da.forEach(t=>{t.next()})}var ec,ef;(ef=ec||(ec={})).Fa="default",ef.Cache="cache";var bs=class{constructor(t,e,n){this.query=t,this.Ma=e,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(t){if(!this.options.includeMetadataChanges){let n=[];for(let s of t.docChanges)s.type!==3&&n.push(s);t=new hr(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.xa?this.Na(t)&&(this.Ma.next(t),e=!0):this.Ba(t,this.onlineState)&&(this.La(t),e=!0),this.Oa=t,e}onError(t){this.Ma.error(t)}va(t){this.onlineState=t;let e=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,t)&&(this.La(this.Oa),e=!0),e}Ba(t,e){if(!t.fromCache||!this.ba())return!0;let n=e!=="Offline";return(!this.options.ka||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Na(t){if(t.docChanges.length>0)return!0;let e=this.Oa&&this.Oa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}La(t){t=hr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.xa=!0,this.Ma.next(t)}ba(){return this.options.source!==ec.Cache}};var nc=class{constructor(t,e){this.qa=t,this.byteLength=e}Qa(){return"metadata"in this.qa}};var so=class{constructor(t){this.serializer=t}Qs(t){return re(this.serializer,t)}$s(t){return t.metadata.exists?gm(this.serializer,t.document,!1):_t.newNoDocument(this.Qs(t.metadata.name),this.Us(t.metadata.readTime))}Us(t){return dt(t)}},rc=class{constructor(t,e){this.$a=t,this.serializer=e,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=Wm(t)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.qa.namedQuery)this.Ua.push(t.qa.namedQuery);else if(t.qa.documentMetadata){this.Ka.push({metadata:t.qa.documentMetadata}),t.qa.documentMetadata.exists||++e;let n=H.fromString(t.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.qa.document&&(this.Ka[this.Ka.length-1].document=t.qa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Ga(t){let e=new Map,n=new so(this.serializer);for(let s of t)if(s.metadata.queries){let i=n.Qs(s.metadata.name);for(let a of s.metadata.queries){let u=(e.get(a)||G()).add(i);e.set(a,u)}}return e}za(t){return V(this,null,function*(){let e=yield by(t,new so(this.serializer),this.Ka,this.$a.id),n=this.Ga(this.documents);for(let s of this.Ua)yield Ry(t,s,n.get(s.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:e}})}};function Wm(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var io=class{constructor(t){this.key=t}},oo=class{constructor(t){this.key=t}},ao=class{constructor(t,e){this.query=t,this.Ha=e,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=G(),this.mutatedKeys=G(),this.Xa=Xf(t),this.eu=new no(this.Xa)}get tu(){return this.Ha}nu(t,e){let n=e?e.ru:new ro,s=e?e.eu:this.eu,i=e?e.mutatedKeys:this.mutatedKeys,a=s,u=!1,l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((f,g)=>{let _=s.get(f),b=ks(this.query,g)?g:null,D=!!_&&this.mutatedKeys.has(_.key),k=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations),N=!1;_&&b?_.data.isEqual(b.data)?D!==k&&(n.track({type:3,doc:b}),N=!0):this.iu(_,b)||(n.track({type:2,doc:b}),N=!0,(l&&this.Xa(b,l)>0||d&&this.Xa(b,d)<0)&&(u=!0)):!_&&b?(n.track({type:0,doc:b}),N=!0):_&&!b&&(n.track({type:1,doc:_}),N=!0,(l||d)&&(u=!0)),N&&(b?(a=a.add(b),i=k?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),n.track({type:1,doc:f})}return{eu:a,ru:n,Ds:u,mutatedKeys:i}}iu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){let i=this.eu;this.eu=t.eu,this.mutatedKeys=t.mutatedKeys;let a=t.ru.pa();a.sort((f,g)=>function(b,D){let k=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{At:N})}};return k(b)-k(D)}(f.type,g.type)||this.Xa(f.doc,g.doc)),this.su(n),s=s!=null&&s;let u=e&&!s?this.ou():[],l=this.Za.size===0&&this.current&&!s?1:0,d=l!==this.Ya;return this.Ya=l,a.length!==0||d?{snapshot:new hr(this.query,t.eu,i,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:u}:{_u:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new ro,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(t){return!this.Ha.has(t)&&!!this.eu.has(t)&&!this.eu.get(t).hasLocalMutations}su(t){t&&(t.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=t.current)}ou(){if(!this.current)return[];let t=this.Za;this.Za=G(),this.eu.forEach(n=>{this.au(n.key)&&(this.Za=this.Za.add(n.key))});let e=[];return t.forEach(n=>{this.Za.has(n)||e.push(new oo(n))}),this.Za.forEach(n=>{t.has(n)||e.push(new io(n))}),e}uu(t){this.Ha=t.qs,this.Za=G();let e=this.nu(t.documents);return this.applyChanges(e,!0)}cu(){return hr.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},Xe="SyncEngine",sc=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},ic=class{constructor(t){this.key=t,this.lu=!1}},oc=class{constructor(t,e,n,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new Xt(u=>Wf(u),Ns),this.Tu=new Map,this.Iu=new Set,this.du=new st(O.comparator),this.Eu=new Map,this.Au=new Ts,this.Ru={},this.Vu=new Map,this.mu=ar.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function By(r,t,e=!0){return V(this,null,function*(){let n=Po(r),s,i=n.Pu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.cu()):s=yield Hm(n,t,e,!0),s})}function jy(r,t){return V(this,null,function*(){let e=Po(r);yield Hm(e,t,!0,!1)})}function Hm(r,t,e,n){return V(this,null,function*(){let s=yield ur(r.localStore,kt(t)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,e),u;return n&&(u=yield el(r,t,i,a==="current",s.resumeToken)),r.isPrimaryClient&&e&&Ro(r.remoteStore,s),u})}function el(r,t,e,n,s){return V(this,null,function*(){r.gu=(g,_,b)=>function(k,N,$,j){return V(this,null,function*(){let B=N.view.nu($);B.Ds&&(B=yield Hi(k.localStore,N.query,!1).then(({documents:v})=>N.view.nu(v,B)));let W=j&&j.targetChanges.get(N.targetId),Z=j&&j.targetMismatches.get(N.targetId)!=null,K=N.view.applyChanges(B,k.isPrimaryClient,W,Z);return ac(k,N.targetId,K._u),K.snapshot})}(r,g,_,b);let i=yield Hi(r.localStore,t,!0),a=new ao(t,i.qs),u=a.nu(i.documents),l=_s.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),d=a.applyChanges(u,r.isPrimaryClient,l);ac(r,e,d._u);let f=new sc(t,e,a);return r.Pu.set(t,f),r.Tu.has(e)?r.Tu.get(e).push(t):r.Tu.set(e,[t]),d.snapshot})}function $y(r,t,e){return V(this,null,function*(){let n=M(r),s=n.Pu.get(t),i=n.Tu.get(s.targetId);if(i.length>1)return n.Tu.set(s.targetId,i.filter(a=>!Ns(a,t))),void n.Pu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield cr(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),e&&lr(n.remoteStore,s.targetId),dr(n,s.targetId)}).catch(Ke))):(dr(n,s.targetId),yield cr(n.localStore,s.targetId,!0))})}function zy(r,t){return V(this,null,function*(){let e=M(r),n=e.Pu.get(t),s=e.Tu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),lr(e.remoteStore,n.targetId))})}function Gy(r,t,e){return V(this,null,function*(){let n=il(r);try{let s=yield function(a,u){let l=M(a),d=ot.now(),f=u.reduce((b,D)=>b.add(D.key),G()),g,_;return l.persistence.runTransaction("Locally write mutations","readwrite",b=>{let D=Mt(),k=G();return l.Os.getEntries(b,f).next(N=>{D=N,D.forEach(($,j)=>{j.isValidDocument()||(k=k.add($))})}).next(()=>l.localDocuments.getOverlayedDocuments(b,D)).next(N=>{g=N;let $=[];for(let j of u){let B=sy(j,g.get(j.key).overlayedDocument);B!=null&&$.push(new Jt(j.key,B,Bf(B.value.mapValue),lt.exists(!0)))}return l.mutationQueue.addMutationBatch(b,d,$,u)}).next(N=>{_=N;let $=N.applyToLocalDocumentSet(g,k);return l.documentOverlayCache.saveOverlays(b,N.batchId,$)})}).then(()=>({batchId:_.batchId,changes:Yf(g)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),function(a,u,l){let d=a.Ru[a.currentUser.toKey()];d||(d=new st(z)),d=d.insert(u,l),a.Ru[a.currentUser.toKey()]=d}(n,s.batchId,e),yield Ie(n,s.changes),yield _r(n.remoteStore)}catch(s){let i=vr(s,"Failed to persist write");e.reject(i)}})}function Xm(r,t){return V(this,null,function*(){let e=M(r);try{let n=yield Ay(e.localStore,t);t.targetChanges.forEach((s,i)=>{let a=e.Eu.get(i);a&&(q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.lu=!0:s.modifiedDocuments.size>0?q(a.lu,14607):s.removedDocuments.size>0&&(q(a.lu,42227),a.lu=!1))}),yield Ie(e,n,t)}catch(n){yield Ke(n)}})}function nf(r,t,e){let n=M(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let s=[];n.Pu.forEach((i,a)=>{let u=a.view.va(t);u.snapshot&&s.push(u.snapshot)}),function(a,u){let l=M(a);l.onlineState=u;let d=!1;l.queries.forEach((f,g)=>{for(let _ of g.wa)_.va(u)&&(d=!0)}),d&&tl(l)}(n.eventManager,t),s.length&&n.hu.J_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function Ky(r,t,e){return V(this,null,function*(){let n=M(r);n.sharedClientState.updateQueryState(t,"rejected",e);let s=n.Eu.get(t),i=s&&s.key;if(i){let a=new st(O.comparator);a=a.insert(i,_t.newNoDocument(i,U.min()));let u=G().add(i),l=new ys(U.min(),new Map,new st(z),a,u);yield Xm(n,l),n.du=n.du.remove(i),n.Eu.delete(t),sl(n)}else yield cr(n.localStore,t,!1).then(()=>dr(n,t,e)).catch(Ke)})}function Qy(r,t){return V(this,null,function*(){let e=M(r),n=t.batch.batchId;try{let s=yield Ey(e.localStore,t);rl(e,n,null),nl(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield Ie(e,s)}catch(s){yield Ke(s)}})}function Wy(r,t,e){return V(this,null,function*(){let n=M(r);try{let s=yield function(a,u){let l=M(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return l.mutationQueue.lookupMutationBatch(d,u).next(g=>(q(g!==null,37113),f=g.keys(),l.mutationQueue.removeMutationBatch(d,g))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>l.localDocuments.getDocuments(d,f))})}(n.localStore,t);rl(n,t,e),nl(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield Ie(n,s)}catch(s){yield Ke(s)}})}function Hy(r,t){return V(this,null,function*(){let e=M(r);He(e.remoteStore)||x(Xe,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=M(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>u.mutationQueue.getHighestUnacknowledgedBatchId(l))}(e.localStore);if(n===xe)return void t.resolve();let s=e.Vu.get(n)||[];s.push(t),e.Vu.set(n,s)}catch(n){let s=vr(n,"Initialization of waitForPendingWrites() operation failed");t.reject(s)}})}function nl(r,t){(r.Vu.get(t)||[]).forEach(e=>{e.resolve()}),r.Vu.delete(t)}function rl(r,t,e){let n=M(r),s=n.Ru[n.currentUser.toKey()];if(s){let i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.Ru[n.currentUser.toKey()]=s}}function dr(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Tu.get(t))r.Pu.delete(n),e&&r.hu.pu(n,e);r.Tu.delete(t),r.isPrimaryClient&&r.Au.zr(t).forEach(n=>{r.Au.containsKey(n)||Jm(r,n)})}function Jm(r,t){r.Iu.delete(t.path.canonicalString());let e=r.du.get(t);e!==null&&(lr(r.remoteStore,e),r.du=r.du.remove(t),r.Eu.delete(e),sl(r))}function ac(r,t,e){for(let n of e)n instanceof io?(r.Au.addReference(n.key,t),Xy(r,n)):n instanceof oo?(x(Xe,"Document no longer in limbo: "+n.key),r.Au.removeReference(n.key,t),r.Au.containsKey(n.key)||Jm(r,n.key)):L(19791,{yu:n})}function Xy(r,t){let e=t.key,n=e.path.canonicalString();r.du.get(e)||r.Iu.has(n)||(x(Xe,"New document in limbo: "+e),r.Iu.add(n),sl(r))}function sl(r){for(;r.Iu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){let t=r.Iu.values().next().value;r.Iu.delete(t);let e=new O(H.fromString(t)),n=r.mu.next();r.Eu.set(n,new ic(e)),r.du=r.du.insert(e,n),Ro(r.remoteStore,new or(kt(pr(e.path)),n,"TargetPurposeLimboResolution",Ut.ue))}}function Ie(r,t,e){return V(this,null,function*(){let n=M(r),s=[],i=[],a=[];n.Pu.isEmpty()||(n.Pu.forEach((u,l)=>{a.push(n.gu(l,t,e).then(d=>{var f;if((d||e)&&n.isPrimaryClient){let g=d?!d.fromCache:(f=e?.targetChanges.get(l.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(l.targetId,g?"current":"not-current")}if(d){s.push(d);let g=Ou.Es(l.targetId,d);i.push(g)}}))}),yield Promise.all(a),n.hu.J_(s),yield function(l,d){return V(this,null,function*(){let f=M(l);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(d,_=>S.forEach(_.Is,b=>f.persistence.referenceDelegate.addReference(g,_.targetId,b)).next(()=>S.forEach(_.ds,b=>f.persistence.referenceDelegate.removeReference(g,_.targetId,b)))))}catch(g){if(!Qe(g))throw g;x(Wc,"Failed to update sequence numbers: "+g)}for(let g of d){let _=g.targetId;if(!g.fromCache){let b=f.Fs.get(_),D=b.snapshotVersion,k=b.withLastLimboFreeSnapshotVersion(D);f.Fs=f.Fs.insert(_,k)}}})}(n.localStore,i))})}function Jy(r,t){return V(this,null,function*(){let e=M(r);if(!e.currentUser.isEqual(t)){x(Xe,"User change. New user:",t.toKey());let n=yield Nm(e.localStore,t);e.currentUser=t,function(i,a){i.Vu.forEach(u=>{u.forEach(l=>{l.reject(new C(R.CANCELLED,a))})}),i.Vu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield Ie(e,n.Bs)}})}function Yy(r,t){let e=M(r),n=e.Eu.get(t);if(n&&n.lu)return G().add(n.key);{let s=G(),i=e.Tu.get(t);if(!i)return s;for(let a of i){let u=e.Pu.get(a);s=s.unionWith(u.view.tu)}return s}}function Zy(r,t){return V(this,null,function*(){let e=M(r),n=yield Hi(e.localStore,t.query,!0),s=t.view.uu(n);return e.isPrimaryClient&&ac(e,t.targetId,s._u),s})}function t_(r,t){return V(this,null,function*(){let e=M(r);return Mm(e.localStore,t).then(n=>Ie(e,n))})}function e_(r,t,e,n){return V(this,null,function*(){let s=M(r),i=yield function(u,l){let d=M(u),f=M(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Xn(g,l).next(_=>_?d.localDocuments.getDocuments(g,_):S.resolve(null)))}(s.localStore,t);i!==null?(e==="pending"?yield _r(s.remoteStore):e==="acknowledged"||e==="rejected"?(rl(s,t,n||null),nl(s,t),function(u,l){M(M(u).mutationQueue).rr(l)}(s.localStore,t)):L(6720,"Unknown batchState",{wu:e}),yield Ie(s,i)):x(Xe,"Cannot apply mutation batch with id: "+t)})}function n_(r,t){return V(this,null,function*(){let e=M(r);if(Po(e),il(e),t===!0&&e.fu!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),s=yield rf(e,n.toArray());e.fu=!0,yield Ju(e.remoteStore,!0);for(let i of s)Ro(e.remoteStore,i)}else if(t===!1&&e.fu!==!1){let n=[],s=Promise.resolve();e.Tu.forEach((i,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):s=s.then(()=>(dr(e,a),cr(e.localStore,a,!0))),lr(e.remoteStore,a)}),yield s,yield rf(e,n),function(a){let u=M(a);u.Eu.forEach((l,d)=>{lr(u.remoteStore,d)}),u.Au.jr(),u.Eu=new Map,u.du=new st(O.comparator)}(e),e.fu=!1,yield Ju(e.remoteStore,!1)}})}function rf(r,t,e){return V(this,null,function*(){let n=M(r),s=[],i=[];for(let a of t){let u,l=n.Tu.get(a);if(l&&l.length!==0){u=yield ur(n.localStore,kt(l[0]));for(let d of l){let f=n.Pu.get(d),g=yield Zy(n,f);g.snapshot&&i.push(g.snapshot)}}else{let d=yield Om(n.localStore,a);u=yield ur(n.localStore,d),yield el(n,Ym(d),a,!1,u.resumeToken)}s.push(u)}return n.hu.J_(i),s})}function Ym(r){return Qf(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function r_(r){return function(e){return M(M(e).persistence).Ps()}(M(r).localStore)}function s_(r,t,e,n){return V(this,null,function*(){let s=M(r);if(s.fu)return void x(Xe,"Ignoring unexpected query state notification.");let i=s.Tu.get(t);if(i&&i.length>0)switch(e){case"current":case"not-current":{let a=yield Mm(s.localStore,Hf(i[0])),u=ys.createSynthesizedRemoteEventForCurrentChange(t,e==="current",ft.EMPTY_BYTE_STRING);yield Ie(s,a,u);break}case"rejected":yield cr(s.localStore,t,!0),dr(s,t,n);break;default:L(64155,e)}})}function i_(r,t,e){return V(this,null,function*(){let n=Po(r);if(n.fu){for(let s of t){if(n.Tu.has(s)&&n.sharedClientState.isActiveQueryTarget(s)){x(Xe,"Adding an already active target "+s);continue}let i=yield Om(n.localStore,s),a=yield ur(n.localStore,i);yield el(n,Ym(i),a.targetId,!1,a.resumeToken),Ro(n.remoteStore,a)}for(let s of e)n.Tu.has(s)&&(yield cr(n.localStore,s,!1).then(()=>{lr(n.remoteStore,s),dr(n,s)}).catch(Ke))}})}function Po(r){let t=M(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Xm.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Yy.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ky.bind(null,t),t.hu.J_=qy.bind(null,t.eventManager),t.hu.pu=Uy.bind(null,t.eventManager),t}function il(r){let t=M(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Qy.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Wy.bind(null,t),t}function o_(r,t,e){let n=M(r);(function(i,a,u){return V(this,null,function*(){try{let l=yield a.getMetadata();if(yield function(b,D){let k=M(b),N=dt(D.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",$=>k.Ti.getBundleMetadata($,D.id)).then($=>!!$&&$.createTime.compareTo(N)>=0)}(i.localStore,l))return yield a.close(),u._completeWith(function(b){return{taskState:"Success",documentsLoaded:b.totalDocuments,bytesLoaded:b.totalBytes,totalDocuments:b.totalDocuments,totalBytes:b.totalBytes}}(l)),Promise.resolve(new Set);u._updateProgress(Wm(l));let d=new rc(l,a.serializer),f=yield a.Su();for(;f;){let _=yield d.Wa(f);_&&u._updateProgress(_),f=yield a.Su()}let g=yield d.za(i.localStore);return yield Ie(i,g.Ja,void 0),yield function(b,D){let k=M(b);return k.persistence.runTransaction("Save bundle","readwrite",N=>k.Ti.saveBundleMetadata(N,D))}(i.localStore,l),u._completeWith(g.progress),Promise.resolve(g.ja)}catch(l){return jt(Xe,`Loading bundle failed with ${l}`),u._failWith(l),Promise.resolve(new Set)}})})(n,t,e).then(s=>{n.sharedClientState.notifyBundleLoaded(s)})}var ol=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return V(this,null,function*(){this.serializer=Fs(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)})}Cu(e,n){return null}Fu(e,n){return null}vu(e){return xm(this.persistence,new Wi,e.initialUser,this.serializer)}Du(e){return new Es(Ki.Vi,this.serializer)}bu(e){return new Yi}terminate(){return V(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),uc=class extends ol{constructor(t){super(),this.cacheSizeBytes=t}Cu(t,e){q(this.persistence.referenceDelegate instanceof Qi,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new $i(n,t.asyncQueue,e)}Du(t){let e=this.cacheSizeBytes!==void 0?Ot.withCacheSize(this.cacheSizeBytes):Ot.DEFAULT;return new Es(n=>Qi.Vi(n,e),this.serializer)}},uo=class r extends ol{constructor(t,e,n){super(),this.Mu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return V(this,null,function*(){yield oa(r.prototype,this,"initialize").call(this,t),yield this.Mu.initialize(this,t),yield il(this.Mu.syncEngine),yield _r(this.Mu.remoteStore),yield this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(t){return xm(this.persistence,new Wi,t.initialUser,this.serializer)}Cu(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new $i(n,t.asyncQueue,e)}Fu(t,e){let n=new Fa(e,this.persistence);return new ka(t.asyncQueue,n)}Du(t){let e=Qc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Ot.withCacheSize(this.cacheSizeBytes):Ot.DEFAULT;return new Fu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,jm(),pi(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(t){return new Yi}},cc=class r extends uo{constructor(t,e){super(t,e,!1),this.Mu=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return V(this,null,function*(){yield oa(r.prototype,this,"initialize").call(this,t);let e=this.Mu.syncEngine;this.sharedClientState instanceof rs&&(this.sharedClientState.syncEngine={Do:e_.bind(null,e),vo:s_.bind(null,e),Co:i_.bind(null,e),Ps:r_.bind(null,e),bo:t_.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.ji(n=>V(this,null,function*(){yield n_(this.Mu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}bu(t){let e=jm();if(!rs.C(e))throw new C(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=Qc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new rs(e,t.asyncQueue,n,t.clientId,t.initialUser)}},al=(()=>{class r{initialize(e,n){return V(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>nf(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Jy.bind(null,this.syncEngine),yield Ju(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new tc}()}createDatastore(e){let n=Fs(e.databaseInfo.databaseId),s=function(a){return new zu(a)}(e.databaseInfo);return function(a,u,l,d){return new Wu(a,u,l,d)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return function(s,i,a,u,l){return new Xu(s,i,a,u,l)}(this.localStore,this.datastore,e.asyncQueue,n=>nf(this.syncEngine,n,0),function(){return Zi.C()?new Zi:new Uu}())}createSyncEngine(e,n){return function(i,a,u,l,d,f,g){let _=new oc(i,a,u,l,d,f);return g&&(_.fu=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return V(this,null,function*(){var e,n;yield function(i){return V(this,null,function*(){let a=M(i);x(wn,"RemoteStore shutting down."),a.Ia.add(5),yield yr(a),a.Ea.shutdown(),a.Aa.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();function sf(r,t=10240){let e=0;return{read(){return V(this,null,function*(){if(e<r.byteLength){let s={value:r.slice(e,e+t),done:!1};return e+=t,s}return{done:!0}})},cancel(){return V(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var fr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.xu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.xu(this.observer.error,t):ht("Uncaught Error in snapshot listener:",t.toString()))}Ou(){this.muted=!0}xu(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var lc=class{constructor(t,e){this.Nu=t,this.serializer=e,this.metadata=new vt,this.buffer=new Uint8Array,this.Bu=function(){return new TextDecoder("utf-8")}(),this.Lu().then(n=>{n&&n.Qa()?this.metadata.resolve(n.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.qa)}`))},n=>this.metadata.reject(n))}close(){return this.Nu.cancel()}getMetadata(){return V(this,null,function*(){return this.metadata.promise})}Su(){return V(this,null,function*(){return yield this.getMetadata(),this.Lu()})}Lu(){return V(this,null,function*(){let t=yield this.ku();if(t===null)return null;let e=this.Bu.decode(t),n=Number(e);isNaN(n)&&this.qu(`length string (${e}) is not valid number`);let s=yield this.Qu(n);return new nc(JSON.parse(s),t.length+n)})}$u(){return this.buffer.findIndex(t=>t===123)}ku(){return V(this,null,function*(){for(;this.$u()<0&&!(yield this.Uu()););if(this.buffer.length===0)return null;let t=this.$u();t<0&&this.qu("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}Qu(t){return V(this,null,function*(){for(;this.buffer.length<t;)(yield this.Uu())&&this.qu("Reached the end of bundle when more is expected.");let e=this.Bu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}qu(t){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${t}`)}Uu(){return V(this,null,function*(){let t=yield this.Nu.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var hc=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new C(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(s,i){return V(this,null,function*(){let a=M(s),u={documents:i.map(g=>ws(a.serializer,g))},l=yield a.Jo("BatchGetDocuments",a.serializer.databaseId,H.emptyPath(),u,i.length),d=new Map;l.forEach(g=>{let _=ly(a.serializer,g);d.set(_.key.toString(),_)});let f=[];return i.forEach(g=>{let _=d.get(g.toString());q(!!_,55234,{key:g}),f.push(_)}),f})}(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new je(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let s=O.fromPath(n);this.mutations.push(new ms(s,this.precondition(s)))}),yield function(n,s){return V(this,null,function*(){let i=M(n),a={writes:s.map(u=>vs(i.serializer,u))};yield i.Wo("Commit",i.serializer.databaseId,H.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L(50498,{Wu:t.constructor.name});e=U.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new C(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(U.min())?lt.exists(!1):lt.updateTime(e):lt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(U.min()))throw new C(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return lt.updateTime(e)}return lt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var dc=class{constructor(t,e,n,s,i){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=s,this.deferred=i,this.Gu=n.maxAttempts,this.F_=new Ss(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(()=>V(this,null,function*(){let t=new hc(this.datastore),e=this.Ju(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(s=>{this.Hu(s)}))}).catch(n=>{this.Hu(n)})}))}Ju(t){try{let e=this.updateFunction(t);return!Cs(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Hu(t){this.Gu>0&&this.Yu(t)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(t)}Yu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!um(e)}return!1}};var ze="FirestoreClient",fc=class{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=pt.UNAUTHENTICATED,this.clientId=ss.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,a=>V(this,null,function*(){x(ze,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(x(ze,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new vt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=vr(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function Ea(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),x(ze,"Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(s=>V(null,null,function*(){n.isEqual(s)||(yield Nm(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener(()=>{jt("Terminating Firestore due to IndexedDb database deletion"),r.terminate().then(()=>{x("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(s=>{jt("Terminating Firestore due to IndexedDb database deletion failed",s)})}),r._offlineComponents=t})}function of(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield ul(r);x(ze,"Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Zd(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Zd(t.remoteStore,s)),r._onlineComponents=t})}function ul(r){return V(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){x(ze,"Using user provided OfflineComponentProvider");try{yield Ea(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===R.FAILED_PRECONDITION||s.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;jt("Error using user provided cache. Falling back to memory cache: "+e),yield Ea(r,new ol)}}else x(ze,"Using default OfflineComponentProvider"),yield Ea(r,new uc(void 0));return r._offlineComponents})}function Vo(r){return V(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(x(ze,"Using user provided OnlineComponentProvider"),yield of(r,r._uninitializedComponentsProvider._online)):(x(ze,"Using default OnlineComponentProvider"),yield of(r,new al))),r._onlineComponents})}function Zm(r){return ul(r).then(t=>t.persistence)}function cl(r){return ul(r).then(t=>t.localStore)}function tg(r){return Vo(r).then(t=>t.remoteStore)}function ll(r){return Vo(r).then(t=>t.syncEngine)}function a_(r){return Vo(r).then(t=>t.datastore)}function mr(r){return V(this,null,function*(){let t=yield Vo(r),e=t.eventManager;return e.onListen=By.bind(null,t.syncEngine),e.onUnlisten=$y.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=jy.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=zy.bind(null,t.syncEngine),e})}function u_(r){return r.asyncQueue.enqueue(()=>V(null,null,function*(){let t=yield Zm(r),e=yield tg(r);return t.setNetworkEnabled(!0),function(s){let i=M(s);return i.Ia.delete(0),Os(i)}(e)}))}function c_(r){return r.asyncQueue.enqueue(()=>V(null,null,function*(){let t=yield Zm(r),e=yield tg(r);return t.setNetworkEnabled(!1),function(s){return V(this,null,function*(){let i=M(s);i.Ia.add(0),yield yr(i),i.Aa.set("Offline")})}(e)}))}function l_(r,t){let e=new vt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(s,i,a){return V(this,null,function*(){try{let u=yield function(d,f){let g=M(d);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,f))}(s,i);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new C(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let l=vr(u,`Failed to get document '${i} from cache`);a.reject(l)}})}(yield cl(r),t,e)})),e.promise}function eg(r,t,e={}){let n=new vt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(i,a,u,l,d){let f=new fr({next:_=>{f.Ou(),a.enqueueAndForget(()=>Zc(i,g));let b=_.docs.has(u);!b&&_.fromCache?d.reject(new C(R.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&_.fromCache&&l&&l.source==="server"?d.reject(new C(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new bs(pr(u.path),f,{includeMetadataChanges:!0,ka:!0});return Yc(i,g)}(yield mr(r),r.asyncQueue,t,e,n)})),n.promise}function h_(r,t){let e=new vt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(s,i,a){return V(this,null,function*(){try{let u=yield Hi(s,i,!0),l=new ao(i,u.qs),d=l.nu(u.documents),f=l.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let l=vr(u,`Failed to execute query '${i} against cache`);a.reject(l)}})}(yield cl(r),t,e)})),e.promise}function ng(r,t,e={}){let n=new vt;return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(i,a,u,l,d){let f=new fr({next:_=>{f.Ou(),a.enqueueAndForget(()=>Zc(i,g)),_.fromCache&&l.source==="server"?d.reject(new C(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new bs(u,f,{includeMetadataChanges:!0,ka:!0});return Yc(i,g)}(yield mr(r),r.asyncQueue,t,e,n)})),n.promise}function d_(r,t){let e=new fr(t);return r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(s,i){M(s).Da.add(i),i.next()}(yield mr(r),e)})),()=>{e.Ou(),r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return function(s,i){M(s).Da.delete(i)}(yield mr(r),e)}))}}function f_(r,t,e,n){let s=function(a,u){let l;return l=typeof a=="string"?Cc().encode(a):a,function(f,g){return new lc(f,g)}(function(f,g){if(f instanceof Uint8Array)return sf(f,g);if(f instanceof ArrayBuffer)return sf(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),u)}(e,Fs(t));r.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){o_(yield ll(r),s,n)}))}function m_(r,t){return r.asyncQueue.enqueue(()=>V(null,null,function*(){return function(n,s){let i=M(n);return i.persistence.runTransaction("Get named query","readonly",a=>i.Ti.getNamedQuery(a,s))}(yield cl(r),t)}))}function rg(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var af=new Map;var sg="firestore.googleapis.com",uf=!0,co=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new C(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=sg,this.ssl=uf}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:uf;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Sm;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Iy)throw new C(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}yp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=rg((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new C(R.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new C(R.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new C(R.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},vn=class{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new co({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new C(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new C(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new co(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Aa;switch(n.type){case"firstParty":return new Pa(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return V(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=af.get(e);n&&(x("ComponentProvider","Removing Datastore"),af.delete(e),n.terminate())}(this),Promise.resolve()}};function ig(r,t,e,n={}){var s;r=Y(r,vn);let i=ua(t),a=r._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:r._getEmulatorOptions()}),l=`${t}:${e}`;i&&(Ph(`https://${l}`),Ch("Firestore",!0)),a.host!==sg&&a.host!==l&&jt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let d=Object.assign(Object.assign({},a),{host:l,ssl:i,emulatorOptions:n});if(!ei(d,u)&&(r._setSettings(d),n.mockUserToken)){let f,g;if(typeof n.mockUserToken=="string")f=n.mockUserToken,g=pt.MOCK_USER;else{f=Vh(n.mockUserToken,(s=r._app)===null||s===void 0?void 0:s.options.projectId);let _=n.mockUserToken.sub||n.mockUserToken.user_id;if(!_)throw new C(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new pt(_)}r._authCredentials=new Sa(new yi(f,g))}}var At=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},at=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new se(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}toJSON(){return{type:r._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Vs(e,r._jsonSchema))return new r(t,n||null,new O(H.fromString(e.referencePath)))}};at._jsonSchemaVersion="firestore/documentReference/1.0",at._jsonSchema={type:yt("string",at._jsonSchemaVersion),referencePath:yt("string")};var se=class r extends At{constructor(t,e,n){super(t,e,pr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new at(this.firestore,null,new O(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function og(r,t,...e){if(r=wt(r),Dc("collection","path",t),r instanceof vn){let n=H.fromString(t,...e);return ed(n),new se(r,null,n)}{if(!(r instanceof at||r instanceof se))throw new C(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(H.fromString(t,...e));return ed(n),new se(r.firestore,null,n)}}function g_(r,t){if(r=Y(r,vn),Dc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new C(R.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new At(r,null,function(n){return new Ht(H.emptyPath(),n)}(t))}function hl(r,t,...e){if(r=wt(r),arguments.length===1&&(t=ss.newId()),Dc("doc","path",t),r instanceof vn){let n=H.fromString(t,...e);return td(n),new at(r,null,new O(n))}{if(!(r instanceof at||r instanceof se))throw new C(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(H.fromString(t,...e));return td(n),new at(r.firestore,r instanceof se?r.converter:null,new O(n))}}function ag(r,t){return r=wt(r),t=wt(t),(r instanceof at||r instanceof se)&&(t instanceof at||t instanceof se)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function ug(r,t){return r=wt(r),t=wt(t),r instanceof At&&t instanceof At&&r.firestore===t.firestore&&Ns(r._query,t._query)&&r.converter===t.converter}var cf="AsyncQueue",lo=class{constructor(t=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Ss(this,"async_queue_retry"),this.oc=()=>{let n=pi();n&&x(cf,"Visibility state changed to "+n.visibilityState),this.F_.y_()},this._c=t;let e=pi();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.ac(),this.uc(t)}enterRestrictedMode(t){if(!this.Xu){this.Xu=!0,this.rc=t||!1;let e=pi();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.oc)}}enqueue(t){if(this.ac(),this.Xu)return new Promise(()=>{});let e=new vt;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Zu.push(t),this.cc()))}cc(){return V(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(t){if(!Qe(t))throw t;x(cf,"Operation failed with retryable error: "+t)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(t){let e=this._c.then(()=>(this.nc=!0,t().catch(n=>{throw this.tc=n,this.nc=!1,ht("INTERNAL UNHANDLED ERROR: ",lf(n)),n}).then(n=>(this.nc=!1,n))));return this._c=e,e}enqueueAfterDelay(t,e,n){this.ac(),this.sc.indexOf(t)>-1&&(e=0);let s=Yu.createAndSchedule(this,t,e,n,i=>this.lc(i));return this.ec.push(s),s}ac(){this.tc&&L(47125,{hc:lf(this.tc)})}verifyOperationInProgress(){}Pc(){return V(this,null,function*(){let t;do t=this._c,yield t;while(t!==this._c)})}Tc(t){for(let e of this.ec)if(e.timerId===t)return!0;return!1}Ic(t){return this.Pc().then(()=>{this.ec.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.ec)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Pc()})}dc(t){this.sc.push(t)}lc(t){let e=this.ec.indexOf(t);this.ec.splice(e,1)}};function lf(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}function mc(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let s=e;for(let i of n)if(i in s&&typeof s[i]=="function")return!0;return!1}(r,["next","error","complete"])}var gc=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new vt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var dw=-1,ut=class extends vn{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new lo,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return V(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new lo(t),this._firestoreClient=void 0,yield t}})}};function cg(r,t){let e=typeof r=="object"?r:qh(),n=typeof r=="string"?r:t||Ri,s=Oh(e,"firestore").getImmediate({identifier:n});if(!s._initialized){let i=Rh("firestore");i&&ig(s,...i)}return s}function Ft(r){if(r._terminated)throw new C(R.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||lg(r),r._firestoreClient}function lg(r){var t,e,n;let s=r._freezeSettings(),i=function(u,l,d,f){return new qa(u,l,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,rg(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,s);r._componentsProvider||!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=s.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),r._firestoreClient=new fc(r._authCredentials,r._appCheckCredentials,r._queue,i,r._componentsProvider&&function(u){let l=u?._online.build();return{_offline:u?._offline.build(l),_online:l}}(r._componentsProvider))}function p_(r,t){jt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return hg(r,al.provider,{build:n=>new uo(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function y_(r){return V(this,null,function*(){jt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();hg(r,al.provider,{build:e=>new cc(e,t.cacheSizeBytes)})})}function hg(r,t,e){if((r=Y(r,ut))._firestoreClient||r._terminated)throw new C(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new C(R.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},lg(r)}function __(r){if(r._initialized&&!r._terminated)throw new C(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new vt;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>V(null,null,function*(){try{yield function(n){return V(this,null,function*(){if(!Oe.C())return Promise.resolve();let s=n+Dm;yield Oe.delete(s)})}(Qc(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function w_(r){return function(e){let n=new vt;return e.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Hy(yield ll(e),n)})),n.promise}(Ft(r=Y(r,ut)))}function v_(r){return u_(Ft(r=Y(r,ut)))}function I_(r){return c_(Ft(r=Y(r,ut)))}function T_(r,t){let e=Ft(r=Y(r,ut)),n=new gc;return f_(e,r._databaseId,t,n),n}function E_(r,t){return m_(Ft(r=Y(r,ut)),t).then(e=>e?new At(r,null,e.query):null)}var me=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(ft.fromBase64String(t))}catch(e){throw new C(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(ft.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Vs(t,r._jsonSchema))return r.fromBase64String(t.bytes)}};me._jsonSchemaVersion="firestore/bytes/1.0",me._jsonSchema={type:yt("string",me._jsonSchemaVersion),bytes:yt("string")};var Ge=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new C(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new It(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var we=class{constructor(t){this._methodName=t}};var Ne=class r{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new C(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new C(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:r._jsonSchemaVersion}}static fromJSON(t){if(Vs(t,r._jsonSchema))return new r(t.latitude,t.longitude)}};Ne._jsonSchemaVersion="firestore/geoPoint/1.0",Ne._jsonSchema={type:yt("string",Ne._jsonSchemaVersion),latitude:yt("number"),longitude:yt("number")};var ke=class r{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,t._values)}toJSON(){return{type:r._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Vs(t,r._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new r(t.vectorValues);throw new C(R.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};ke._jsonSchemaVersion="firestore/vectorValue/1.0",ke._jsonSchema={type:yt("string",ke._jsonSchemaVersion),vectorValues:yt("object")};var A_=/^__.*__$/,pc=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Jt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Be(t,this.data,e,this.fieldTransforms)}},ho=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Jt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function dg(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ec:r})}}var fo=class r{constructor(t,e,n,s,i,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.Ac(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.Rc({path:n,mc:!1});return s.fc(t),s}gc(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.Rc({path:n,mc:!1});return s.Ac(),s}yc(t){return this.Rc({path:void 0,mc:!0})}wc(t){return mo(t,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ac(){if(this.path)for(let t=0;t<this.path.length;t++)this.fc(this.path.get(t))}fc(t){if(t.length===0)throw this.wc("Document fields must not be empty");if(dg(this.Ec)&&A_.test(t))throw this.wc('Document fields cannot begin and end with "__"')}},yc=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Fs(t)}Dc(t,e,n,s=!1){return new fo({Ec:t,methodName:e,bc:n,path:It.emptyPath(),mc:!1,Sc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function En(r){let t=r._freezeSettings(),e=Fs(r._databaseId);return new yc(r._databaseId,!!t.ignoreUndefinedProperties,e)}function Co(r,t,e,n,s,i={}){let a=r.Dc(i.merge||i.mergeFields?2:0,t,e,s);ml("Data must be an object, but it was:",a,n);let u=gg(n,a),l,d;if(i.merge)l=new Bt(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){let f=[];for(let g of i.mergeFields){let _=Tc(t,g,e);if(!a.contains(_))throw new C(R.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);yg(f,_)||f.push(_)}l=new Bt(f),d=a.fieldTransforms.filter(g=>l.covers(g.field))}else l=null,d=a.fieldTransforms;return new pc(new Ct(u),l,d)}var Rs=class r extends we{_toFieldTransform(t){if(t.Ec!==2)throw t.Ec===1?t.wc(`${this._methodName}() can only appear at the top level of your update data`):t.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function fg(r,t,e){return new fo({Ec:3,bc:t.settings.bc,methodName:r._methodName,mc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var _c=class r extends we{_toFieldTransform(t){return new pn(t.path,new qe)}isEqual(t){return t instanceof r}},wc=class r extends we{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=fg(this,t,!0),n=this.vc.map(i=>An(i,e)),s=new ye(n);return new pn(t.path,s)}isEqual(t){return t instanceof r&&ei(this.vc,t.vc)}},vc=class r extends we{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=fg(this,t,!0),n=this.vc.map(i=>An(i,e)),s=new _e(n);return new pn(t.path,s)}isEqual(t){return t instanceof r&&ei(this.vc,t.vc)}},Ic=class r extends we{constructor(t,e){super(t),this.Cc=e}_toFieldTransform(t){let e=new Ue(t.serializer,em(t.serializer,this.Cc));return new pn(t.path,e)}isEqual(t){return t instanceof r&&this.Cc===t.Cc}};function dl(r,t,e,n){let s=r.Dc(1,t,e);ml("Data must be an object, but it was:",s,n);let i=[],a=Ct.empty();We(n,(l,d)=>{let f=gl(t,l,e);d=wt(d);let g=s.gc(f);if(d instanceof Rs)i.push(f);else{let _=An(d,g);_!=null&&(i.push(f),a.set(f,_))}});let u=new Bt(i);return new ho(a,u,s.fieldTransforms)}function fl(r,t,e,n,s,i){let a=r.Dc(1,t,e),u=[Tc(t,n,e)],l=[s];if(i.length%2!=0)throw new C(R.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<i.length;_+=2)u.push(Tc(t,i[_])),l.push(i[_+1]);let d=[],f=Ct.empty();for(let _=u.length-1;_>=0;--_)if(!yg(d,u[_])){let b=u[_],D=l[_];D=wt(D);let k=a.gc(b);if(D instanceof Rs)d.push(b);else{let N=An(D,k);N!=null&&(d.push(b),f.set(b,N))}}let g=new Bt(d);return new ho(f,g,a.fieldTransforms)}function mg(r,t,e,n=!1){return An(e,r.Dc(n?4:3,t))}function An(r,t){if(pg(r=wt(r)))return ml("Unsupported field value:",t,r),gg(r,t);if(r instanceof we)return function(n,s){if(!dg(s.Ec))throw s.wc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.wc(`${n._methodName}() is not currently supported inside arrays`);let i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.mc&&t.Ec!==4)throw t.wc("Nested arrays are not supported");return function(n,s){let i=[],a=0;for(let u of n){let l=An(u,s.yc(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}}(r,t)}return function(n,s){if((n=wt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return em(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let i=ot.fromDate(n);return{timestampValue:ir(s.serializer,i)}}if(n instanceof ot){let i=new ot(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:ir(s.serializer,i)}}if(n instanceof Ne)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof me)return{bytesValue:lm(s.serializer,n._byteString)};if(n instanceof at){let i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:zc(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof ke)return function(a,u){return{mapValue:{fields:{[Lc]:{stringValue:qc},[tr]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.wc("VectorValues must only contain numeric values.");return $c(u.serializer,d)})}}}}}}(n,s);throw s.wc(`Unsupported field value: ${vo(n)}`)}(r,t)}function gg(r,t){let e={};return Nf(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):We(r,(n,s)=>{let i=An(s,t.Vc(n));i!=null&&(e[n]=i)}),{mapValue:{fields:e}}}function pg(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof ot||r instanceof Ne||r instanceof me||r instanceof at||r instanceof we||r instanceof ke)}function ml(r,t,e){if(!pg(e)||!pf(e)){let n=vo(e);throw n==="an object"?t.wc(r+" a custom object"):t.wc(r+" "+n)}}function Tc(r,t,e){if((t=wt(t))instanceof Ge)return t._internalPath;if(typeof t=="string")return gl(r,t);throw mo("Field path arguments must be of type string or ",r,!1,void 0,e)}var S_=new RegExp("[~\\*/\\[\\]]");function gl(r,t,e){if(t.search(S_)>=0)throw mo(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new Ge(...t.split("."))._internalPath}catch{throw mo(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function mo(r,t,e,n,s){let i=n&&!n.isEmpty(),a=s!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${n}`),a&&(l+=` in document ${s}`),l+=")"),new C(R.INVALID_ARGUMENT,u+r+l)}function yg(r,t){return r.some(e=>e.isEqual(t))}var In=class{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new at(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Ec(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Do("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Ec=class extends In{data(){return super.data()}};function Do(r,t){return typeof t=="string"?gl(r,t):t instanceof Ge?t._internalPath:t._delegate._internalPath}function _g(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new C(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ps=class{},Tn=class extends Ps{};function wg(r,t,...e){let n=[];t instanceof Ps&&n.push(t),n=n.concat(e),function(i){let a=i.filter(l=>l instanceof Ac).length,u=i.filter(l=>l instanceof go).length;if(a>1||a>0&&u>0)throw new C(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let s of n)r=s._apply(r);return r}var go=class r extends Tn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return Tg(t._query,e),new At(t.firestore,t.converter,Ya(t._query,e))}_parse(t){let e=En(t.firestore);return function(i,a,u,l,d,f,g){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new C(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){df(g,f);let D=[];for(let k of g)D.push(hf(l,i,k));_={arrayValue:{values:D}}}else _=hf(l,i,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||df(g,f),_=mg(u,a,g,f==="in"||f==="not-in");return Q.create(d,f,_)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function vg(r,t,e){let n=t,s=Do("where",r);return go._create(s,n,e)}var Ac=class r extends Ps{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:tt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(s,i){let a=s,u=i.getFlattenedFilters();for(let l of u)Tg(a,l),a=Ya(a,l)}(t._query,e),new At(t.firestore,t.converter,Ya(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Sc=class r extends Tn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(s,i,a){if(s.startAt!==null)throw new C(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new C(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new mn(i,a)}(t._query,this._field,this._direction);return new At(t.firestore,t.converter,function(s,i){let a=s.explicitOrderBy.concat([i]);return new Ht(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(t._query,e))}};function b_(r,t="asc"){let e=t,n=Do("orderBy",r);return Sc._create(n,e)}var po=class r extends Tn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new At(t.firestore,t.converter,xi(t._query,this._limit,this._limitType))}};function R_(r){return yf("limit",r),po._create("limit",r,"F")}function P_(r){return yf("limitToLast",r),po._create("limitToLast",r,"L")}var yo=class r extends Tn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Ig(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,function(s,i){return new Ht(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(t._query,e))}};function V_(...r){return yo._create("startAt",r,!0)}function C_(...r){return yo._create("startAfter",r,!1)}var _o=class r extends Tn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Ig(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,function(s,i){return new Ht(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(t._query,e))}};function D_(...r){return _o._create("endBefore",r,!1)}function x_(...r){return _o._create("endAt",r,!0)}function Ig(r,t,e,n){if(e[0]=wt(e[0]),e[0]instanceof In)return function(i,a,u,l,d){if(!l)throw new C(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of $n(i))if(g.field.isKeyField())f.push(fn(a,l.key));else{let _=l.data.field(g.field);if(Ao(_))throw new C(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let b=g.field.canonicalString();throw new C(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${b}' (used as the orderBy) does not exist.`)}f.push(_)}return new oe(f,d)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let s=En(r.firestore);return function(a,u,l,d,f,g){let _=a.explicitOrderBy;if(f.length>_.length)throw new C(R.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let b=[];for(let D=0;D<f.length;D++){let k=f[D];if(_[D].field.isKeyField()){if(typeof k!="string")throw new C(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof k}`);if(!Bc(a)&&k.indexOf("/")!==-1)throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${k}' contains a slash.`);let N=a.path.child(H.fromString(k));if(!O.isDocumentKey(N))throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);let $=new O(N);b.push(fn(u,$))}else{let N=mg(l,d,k);b.push(N)}}return new oe(b,g)}(r._query,r.firestore._databaseId,s,t,e,n)}}function hf(r,t,e){if(typeof(e=wt(e))=="string"){if(e==="")throw new C(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bc(t)&&e.indexOf("/")!==-1)throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(H.fromString(e));if(!O.isDocumentKey(n))throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return fn(r,new O(n))}if(e instanceof at)return fn(r,e._key);throw new C(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${vo(e)}.`)}function df(r,t){if(!Array.isArray(r)||r.length===0)throw new C(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Tg(r,t){let e=function(s,i){for(let a of s)for(let u of a.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new C(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new C(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var wo=class{convertValue(t,e="none"){switch(Me(t)){case 0:return null;case 1:return t.booleanValue;case 2:return it(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(pe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return We(t,(s,i)=>{n[s]=this.convertValue(i,e)}),n}convertVectorValue(t){var e,n,s;let i=(s=(n=(e=t.fields)===null||e===void 0?void 0:e[tr].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.map(a=>it(a.doubleValue));return new ke(i)}convertGeoPoint(t){return new Ne(it(t.latitude),it(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=So(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(hs(t));default:return null}}convertTimestamp(t){let e=ge(t);return new ot(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=H.fromString(t);q(Im(n),9688,{name:t});let s=new Zn(n.get(1),n.get(3)),i=new O(n.popFirst(5));return s.isEqual(e)||ht(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}};function xo(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var bc=class extends wo{constructor(t){super(),this.firestore=t}convertBytes(t){return new me(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new at(this.firestore,null,e)}};var fe=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Qt=class r extends In{constructor(t,e,n,s,i,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Gn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(Do("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new C(R.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=r._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};Qt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Qt._jsonSchema={type:yt("string",Qt._jsonSchemaVersion),bundleSource:yt("string","DocumentSnapshot"),bundleName:yt("string"),bundle:yt("string")};var Gn=class extends Qt{data(t={}){return super.data(t)}},Wt=class r{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new fe(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Gn(this._firestore,this._userDataWriter,n.key,n,new fe(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new C(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(u=>{let l=new Gn(s._firestore,s._userDataWriter,u.doc.key,u.doc,new fe(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||u.type!==3).map(u=>{let l=new Gn(s._firestore,s._userDataWriter,u.doc.key,u.doc,new fe(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:N_(u.type),doc:l,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new C(R.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=r._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=ss.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],n=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(e.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function N_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:r})}}function k_(r,t){return r instanceof Qt&&t instanceof Qt?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof Wt&&t instanceof Wt&&r._firestore===t._firestore&&ug(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function Eg(r){r=Y(r,at);let t=Y(r.firestore,ut);return eg(Ft(t),r._key).then(e=>yl(t,r,e))}Wt._jsonSchemaVersion="firestore/querySnapshot/1.0",Wt._jsonSchema={type:yt("string",Wt._jsonSchemaVersion),bundleSource:yt("string","QuerySnapshot"),bundleName:yt("string"),bundle:yt("string")};var ve=class extends wo{constructor(t){super(),this.firestore=t}convertBytes(t){return new me(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new at(this.firestore,null,e)}};function F_(r){r=Y(r,at);let t=Y(r.firestore,ut),e=Ft(t),n=new ve(t);return l_(e,r._key).then(s=>new Qt(t,n,r._key,s,new fe(s!==null&&s.hasLocalMutations,!0),r.converter))}function O_(r){r=Y(r,at);let t=Y(r.firestore,ut);return eg(Ft(t),r._key,{source:"server"}).then(e=>yl(t,r,e))}function Ag(r){r=Y(r,At);let t=Y(r.firestore,ut),e=Ft(t),n=new ve(t);return _g(r._query),ng(e,r._query).then(s=>new Wt(t,n,r,s))}function M_(r){r=Y(r,At);let t=Y(r.firestore,ut),e=Ft(t),n=new ve(t);return h_(e,r._query).then(s=>new Wt(t,n,r,s))}function L_(r){r=Y(r,At);let t=Y(r.firestore,ut),e=Ft(t),n=new ve(t);return ng(e,r._query,{source:"server"}).then(s=>new Wt(t,n,r,s))}function Sg(r,t,e){r=Y(r,at);let n=Y(r.firestore,ut),s=xo(r.converter,t,e);return No(n,[Co(En(n),"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,lt.none())])}function bg(r,t,e,...n){r=Y(r,at);let s=Y(r.firestore,ut),i=En(s),a;return a=typeof(t=wt(t))=="string"||t instanceof Ge?fl(i,"updateDoc",r._key,t,e,n):dl(i,"updateDoc",r._key,t),No(s,[a.toMutation(r._key,lt.exists(!0))])}function q_(r){return No(Y(r.firestore,ut),[new je(r._key,lt.none())])}function U_(r,t){let e=Y(r.firestore,ut),n=hl(r),s=xo(r.converter,t);return No(e,[Co(En(r.firestore),"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,lt.exists(!1))]).then(()=>n)}function pl(r,...t){var e,n,s;r=wt(r);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||mc(t[a])||(i=t[a++]);let u={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(mc(t[a])){let g=t[a];t[a]=(e=g.next)===null||e===void 0?void 0:e.bind(g),t[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),t[a+2]=(s=g.complete)===null||s===void 0?void 0:s.bind(g)}let l,d,f;if(r instanceof at)d=Y(r.firestore,ut),f=pr(r._key.path),l={next:g=>{t[a]&&t[a](yl(d,r,g))},error:t[a+1],complete:t[a+2]};else{let g=Y(r,At);d=Y(g.firestore,ut),f=g._query;let _=new ve(d);l={next:b=>{t[a]&&t[a](new Wt(d,_,g,b))},error:t[a+1],complete:t[a+2]},_g(r._query)}return function(_,b,D,k){let N=new fr(k),$=new bs(b,N,D);return _.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Yc(yield mr(_),$)})),()=>{N.Ou(),_.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Zc(yield mr(_),$)}))}}(Ft(d),f,u,l)}function B_(r,t){return d_(Ft(r=Y(r,ut)),mc(t)?t:{next:t})}function No(r,t){return function(n,s){let i=new vt;return n.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){return Gy(yield ll(n),s,i)})),i.promise}(Ft(r),t)}function yl(r,t,e){let n=e.docs.get(t._key),s=new ve(r);return new Qt(r,s,t._key,n,new fe(e.hasPendingWrites,e.fromCache),t.converter)}var j_={maxAttempts:5};var ff=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=En(t)}set(t,e,n){this._verifyNotCommitted();let s=De(t,this._firestore),i=xo(s.converter,e,n),a=Co(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,n);return this._mutations.push(a.toMutation(s._key,lt.none())),this}update(t,e,n,...s){this._verifyNotCommitted();let i=De(t,this._firestore),a;return a=typeof(e=wt(e))=="string"||e instanceof Ge?fl(this._dataReader,"WriteBatch.update",i._key,e,n,s):dl(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(a.toMutation(i._key,lt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=De(t,this._firestore);return this._mutations=this._mutations.concat(new je(e._key,lt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function De(r,t){if((r=wt(r)).firestore!==t)throw new C(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var Rc=class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=En(t)}get(t){let e=De(t,this._firestore),n=new bc(this._firestore);return this._transaction.lookup([e._key]).then(s=>{if(!s||s.length!==1)return L(24041);let i=s[0];if(i.isFoundDocument())return new In(this._firestore,n,i.key,i,e.converter);if(i.isNoDocument())return new In(this._firestore,n,e._key,null,e.converter);throw L(18433,{doc:i})})}set(t,e,n){let s=De(t,this._firestore),i=xo(s.converter,e,n),a=Co(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,n);return this._transaction.set(s._key,a),this}update(t,e,n,...s){let i=De(t,this._firestore),a;return a=typeof(e=wt(e))=="string"||e instanceof Ge?fl(this._dataReader,"Transaction.update",i._key,e,n,s):dl(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,a),this}delete(t){let e=De(t,this._firestore);return this._transaction.delete(e._key),this}};var Pc=class extends Rc{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=De(t,this._firestore),n=new ve(this._firestore);return super.get(t).then(s=>new Qt(this._firestore,n,e._key,s._document,new fe(!1,!1),e.converter))}};function $_(r,t,e){r=Y(r,ut);let n=Object.assign(Object.assign({},j_),e);return function(i){if(i.maxAttempts<1)throw new C(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(i,a,u){let l=new vt;return i.asyncQueue.enqueueAndForget(()=>V(null,null,function*(){let d=yield a_(i);new dc(i.asyncQueue,d,u,a,l).zu()})),l.promise}(Ft(r),s=>t(new Pc(r,s)),n)}function z_(){return new Rs("deleteField")}function fw(){return new _c("serverTimestamp")}function mw(...r){return new wc("arrayUnion",r)}function gw(...r){return new vc("arrayRemove",r)}function G_(r){return new Ic("increment",r)}(function(t,e=!0){(function(s){gr=s})(Lh),Fh(new Nh("firestore",(n,{instanceIdentifier:s,options:i})=>{let a=n.getProvider("app").getImmediate(),u=new ut(new ba(n.getProvider("auth-internal")),new Va(a,n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new C(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zn(d.options.projectId,f)}(a,s),a);return i=Object.assign({useFetchStreams:e},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),jr(Xh,Jh,t),jr(Xh,Jh,"esm2017")})();var ko=function(){return ko=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},ko.apply(this,arguments)};var Q_={includeMetadataChanges:!1};function Rg(r,t){return t===void 0&&(t=Q_),new Ih(function(e){var n=pl(r,t,{next:e.next.bind(e),error:e.error.bind(e),complete:e.complete.bind(e)});return{unsubscribe:n}})}function Pg(r,t){var e;t===void 0&&(t={});var n=r.data(t);return!r.exists()||typeof n!="object"||n===null||!t.idField?n:ko(ko({},n),(e={},e[t.idField]=r.id,e))}function Vg(r){return Rg(r,{includeMetadataChanges:!0}).pipe(aa(function(t){return t.docs}))}function Cg(r,t){return t===void 0&&(t={}),Vg(r).pipe(aa(function(e){return e.map(function(n){return Pg(n,t)})}))}var Ms=class{constructor(t){return t}},Dg="firestore",_l=class{constructor(){return jh(Dg)}};var wl=new Th("angularfire2.firestore-instances");function W_(r,t){let e=Bh(Dg,r,t);return e&&new Ms(e)}function H_(r){return(t,e)=>{let n=t.runOutsideAngular(()=>r(e));return new Ms(n)}}var X_={provide:_l,deps:[[new Ur,wl]]},J_={provide:Ms,useFactory:W_,deps:[[new Ur,wl],zh]};function cv(r,...t){return jr("angularfire",Uh.full,"fst"),Eh([J_,X_,{provide:wl,useFactory:H_(r),multi:!0,deps:[Sh,Ah,$h,Gh,[new Ur,Qh],[new Ur,Kh],...t]}])}var lv=Gt(Cg,!0);var hv=Gt(og,!0,2);var dv=Gt(hl,!0,2);var fv=Gt(Eg,!0);var mv=Gt(Ag,!0);var gv=Gt(cg,!0);var pv=Gt(wg,!0,2);var yv=Gt(Sg,!0,2);var _v=Gt(bg,!0,2);var wv=Gt(vg,!0,2);export{fp as a,jt as b,cw as c,C as d,It as e,O as f,yp as g,Y as h,ot as i,hw as j,Zn as k,ig as l,at as m,og as n,g_ as o,hl as p,ag as q,ug as r,dw as s,Ft as t,p_ as u,y_ as v,__ as w,w_ as x,v_ as y,I_ as z,T_ as A,E_ as B,me as C,Ge as D,Ne as E,wg as F,vg as G,b_ as H,R_ as I,P_ as J,V_ as K,C_ as L,D_ as M,x_ as N,wo as O,Qt as P,Gn as Q,Wt as R,k_ as S,Eg as T,F_ as U,O_ as V,Ag as W,M_ as X,L_ as Y,Sg as Z,bg as _,q_ as $,U_ as aa,pl as ba,B_ as ca,No as da,ff as ea,$_ as fa,z_ as ga,fw as ha,mw as ia,gw as ja,G_ as ka,Ms as la,cv as ma,lv as na,hv as oa,dv as pa,fv as qa,mv as ra,gv as sa,pv as ta,yv as ua,_v as va,wv as wa};
