{
  "version": 3,
  "sources": ["../../../../../../node_modules/@delon/abc/fesm2022/down-file.mjs"],
  "sourcesContent": ["import * as i0 from '@angular/core';\nimport { inject, ElementRef, EventEmitter, Output, Input, Directive, NgModule } from '@angular/core';\nimport { finalize } from 'rxjs';\nimport { saveAs } from 'file-saver';\nimport { _HttpClient, AlainThemeModule } from '@delon/theme';\nimport { CommonModule } from '@angular/common';\nclass DownFileDirective {\n  el = inject(ElementRef).nativeElement;\n  _http = inject(_HttpClient);\n  httpData;\n  httpBody;\n  httpMethod = 'get';\n  httpUrl;\n  fileName;\n  pre;\n  success = new EventEmitter();\n  error = new EventEmitter();\n  getDisposition(data) {\n    const arr = (data || '').split(';').filter(i => i.includes('=')).map(v => {\n      const strArr = v.split('=');\n      const utfId = `UTF-8''`;\n      let value = strArr[1];\n      if (value.startsWith(utfId)) value = value.substring(utfId.length);\n      return {\n        [strArr[0].trim()]: value\n      };\n    });\n    return arr.reduce((_o, item) => item, {});\n  }\n  isFileSaverSupported = false;\n  constructor() {\n    try {\n      this.isFileSaverSupported = !!new Blob();\n    } catch {}\n    if (!this.isFileSaverSupported) {\n      this.el.classList.add(`down-file__not-support`);\n    }\n  }\n  setDisabled(status) {\n    const el = this.el;\n    el.disabled = status;\n    el.classList[status ? 'add' : 'remove'](`down-file__disabled`);\n  }\n  async _click(ev) {\n    if (!this.isFileSaverSupported || typeof this.pre === 'function' && !(await this.pre(ev))) {\n      ev.stopPropagation();\n      ev.preventDefault();\n      return;\n    }\n    this.setDisabled(true);\n    this._http.request(this.httpMethod, this.httpUrl, {\n      params: this.httpData || {},\n      responseType: 'blob',\n      observe: 'response',\n      body: this.httpBody\n    }).pipe(finalize(() => this.setDisabled(false))).subscribe({\n      next: res => {\n        if (res.status !== 200 || res.body.size <= 0) {\n          this.error.emit(res);\n          return;\n        }\n        const disposition = this.getDisposition(res.headers.get('content-disposition'));\n        let fileName = this.fileName;\n        if (typeof fileName === 'function') fileName = fileName(res);\n        fileName = fileName || disposition[`filename*`] || disposition[`filename`] || res.headers.get('filename') || res.headers.get('x-filename');\n        saveAs(res.body, decodeURI(fileName));\n        this.success.emit(res);\n      },\n      error: err => this.error.emit(err)\n    });\n  }\n  static ɵfac = function DownFileDirective_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || DownFileDirective)();\n  };\n  static ɵdir = /* @__PURE__ */i0.ɵɵdefineDirective({\n    type: DownFileDirective,\n    selectors: [[\"\", \"down-file\", \"\"]],\n    hostBindings: function DownFileDirective_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵlistener(\"click\", function DownFileDirective_click_HostBindingHandler($event) {\n          return ctx._click($event);\n        });\n      }\n    },\n    inputs: {\n      httpData: [0, \"http-data\", \"httpData\"],\n      httpBody: [0, \"http-body\", \"httpBody\"],\n      httpMethod: [0, \"http-method\", \"httpMethod\"],\n      httpUrl: [0, \"http-url\", \"httpUrl\"],\n      fileName: [0, \"file-name\", \"fileName\"],\n      pre: \"pre\"\n    },\n    outputs: {\n      success: \"success\",\n      error: \"error\"\n    },\n    exportAs: [\"downFile\"]\n  });\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(DownFileDirective, [{\n    type: Directive,\n    args: [{\n      selector: '[down-file]',\n      exportAs: 'downFile',\n      host: {\n        '(click)': '_click($event)'\n      }\n    }]\n  }], () => [], {\n    httpData: [{\n      type: Input,\n      args: ['http-data']\n    }],\n    httpBody: [{\n      type: Input,\n      args: ['http-body']\n    }],\n    httpMethod: [{\n      type: Input,\n      args: ['http-method']\n    }],\n    httpUrl: [{\n      type: Input,\n      args: [{\n        alias: 'http-url',\n        required: true\n      }]\n    }],\n    fileName: [{\n      type: Input,\n      args: ['file-name']\n    }],\n    pre: [{\n      type: Input\n    }],\n    success: [{\n      type: Output\n    }],\n    error: [{\n      type: Output\n    }]\n  });\n})();\nconst DIRECTIVES = [DownFileDirective];\nclass DownFileModule {\n  static ɵfac = function DownFileModule_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || DownFileModule)();\n  };\n  static ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n    type: DownFileModule,\n    imports: [CommonModule, AlainThemeModule, DownFileDirective],\n    exports: [DownFileDirective]\n  });\n  static ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n    imports: [CommonModule, AlainThemeModule]\n  });\n}\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(DownFileModule, [{\n    type: NgModule,\n    args: [{\n      imports: [CommonModule, AlainThemeModule, ...DIRECTIVES],\n      exports: DIRECTIVES\n    }]\n  }], null, null);\n})();\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { DownFileDirective, DownFileModule };\n"],
  "mappings": "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",
  "names": []
}
