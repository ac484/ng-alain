import {
  NzPopoverDirective,
  NzPopoverModule
} from "./chunk-IRS3Q7P3.js";
import "./chunk-4P4HHPBT.js";
import {
  DelonLocaleModule,
  DelonLocaleService
} from "./chunk-WLPEXMS5.js";
import "./chunk-V4XBV55A.js";
import "./chunk-ZTNECFVY.js";
import "./chunk-VCVGLQF3.js";
import "./chunk-HGGVII4K.js";
import "./chunk-C2DAT26Y.js";
import {
  NzButtonComponent,
  NzButtonModule
} from "./chunk-MKB5HFAJ.js";
import "./chunk-KEGEU5UL.js";
import "./chunk-FBEQODFK.js";
import "./chunk-HXEEJHXJ.js";
import "./chunk-QYDDKLT3.js";
import "./chunk-LE4RSIF3.js";
import "./chunk-SQJ77OAJ.js";
import "./chunk-QZQ7SHKY.js";
import "./chunk-BHH4M3PU.js";
import "./chunk-2BDLX2FQ.js";
import "./chunk-C6MTXAAB.js";
import "./chunk-U5VATZ4Q.js";
import "./chunk-EGGX2FJX.js";
import "./chunk-76DJI4FU.js";
import {
  NzNoAnimationDirective,
  NzNoAnimationModule
} from "./chunk-MIQKVNBS.js";
import "./chunk-RH5RXJTD.js";
import "./chunk-Y5G3O3B7.js";
import {
  AlainConfigService
} from "./chunk-ES4WNO3Q.js";
import "./chunk-XMKNXNVX.js";
import "./chunk-GP3H6RZA.js";
import "./chunk-OAOHUKFD.js";
import "./chunk-BQ76GOFF.js";
import "./chunk-LSG4V6ID.js";
import {
  NzOutletModule,
  NzStringTemplateOutletDirective
} from "./chunk-KG76OIXO.js";
import "./chunk-J25EALHE.js";
import "./chunk-FZ3LGF3I.js";
import "./chunk-LTANXE67.js";
import {
  Router
} from "./chunk-36PX2JTV.js";
import "./chunk-BVIJPY5U.js";
import "./chunk-ZO4CS3CJ.js";
import "./chunk-I75K2H66.js";
import "./chunk-CQHDL44S.js";
import "./chunk-NDRILP3E.js";
import "./chunk-2WJ2IEY4.js";
import "./chunk-4NJAG2UW.js";
import "./chunk-IH6YTMYU.js";
import "./chunk-D4QSWQD6.js";
import "./chunk-NFHVISCS.js";
import {
  Directionality
} from "./chunk-TBGMZLZ3.js";
import {
  Platform
} from "./chunk-GIT7CFOZ.js";
import {
  CommonModule
} from "./chunk-GUTSRBNM.js";
import "./chunk-FTJJFYDV.js";
import {
  ApplicationRef,
  ChangeDetectionStrategy,
  ChangeDetectorRef,
  Component,
  ElementRef,
  EventEmitter,
  Injectable,
  NgModule,
  ViewChild,
  ViewEncapsulation,
  createComponent,
  setClassMetadata,
  ɵɵadvance,
  ɵɵattribute,
  ɵɵclassProp,
  ɵɵconditional,
  ɵɵconditionalCreate,
  ɵɵdefineComponent,
  ɵɵdefineNgModule,
  ɵɵelement,
  ɵɵelementContainerEnd,
  ɵɵelementContainerStart,
  ɵɵelementEnd,
  ɵɵelementStart,
  ɵɵgetCurrentView,
  ɵɵlistener,
  ɵɵloadQuery,
  ɵɵnextContext,
  ɵɵproperty,
  ɵɵpureFunction2,
  ɵɵqueryRefresh,
  ɵɵreference,
  ɵɵsanitizeHtml,
  ɵɵsanitizeStyle,
  ɵɵtemplate,
  ɵɵtemplateRefExtractor,
  ɵɵtext,
  ɵɵtextInterpolate,
  ɵɵtextInterpolate2,
  ɵɵviewQuery
} from "./chunk-NQBXVTYU.js";
import {
  DOCUMENT,
  InjectionToken,
  inject,
  ɵɵdefineInjectable,
  ɵɵdefineInjector,
  ɵɵresetView,
  ɵɵrestoreView
} from "./chunk-QZDSTGXI.js";
import "./chunk-KMLKBNXJ.js";
import "./chunk-Q4VD2BBX.js";
import {
  delay,
  of,
  pipe,
  switchMap
} from "./chunk-EBAU53KC.js";
import {
  __spreadValues
} from "./chunk-7CE4I3X6.js";

// node_modules/@delon/abc/fesm2022/onboarding.mjs
var _c0 = ["popover"];
var _c1 = (a0, a1) => ({
  "max-width.px": a0,
  direction: a1
});
function OnboardingComponent_Conditional_0_Template(rf, ctx) {
  if (rf & 1) {
    const _r1 = ɵɵgetCurrentView();
    ɵɵelementStart(0, "div", 3);
    ɵɵlistener("click", function OnboardingComponent_Conditional_0_Template_div_click_0_listener() {
      ɵɵrestoreView(_r1);
      const ctx_r1 = ɵɵnextContext();
      return ɵɵresetView(ctx_r1.handleMask());
    });
    ɵɵelementEnd();
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_ng_container_0_Template(rf, ctx) {
  if (rf & 1) {
    ɵɵelementContainerStart(0);
    ɵɵelement(1, "div", 13);
    ɵɵelementContainerEnd();
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(3);
    ɵɵadvance();
    ɵɵproperty("innerHTML", ctx_r1.item.content, ɵɵsanitizeHtml);
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_Conditional_3_Template(rf, ctx) {
  if (rf & 1) {
    ɵɵtext(0);
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(3);
    ɵɵtextInterpolate2(" ", ctx_r1.active + 1, "/", ctx_r1.max, " ");
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_Conditional_5_ng_container_1_Template(rf, ctx) {
  if (rf & 1) {
    ɵɵelementContainerStart(0);
    ɵɵtext(1);
    ɵɵelementContainerEnd();
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(4);
    ɵɵadvance();
    ɵɵtextInterpolate(ctx_r1.item.skip);
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_Conditional_5_Template(rf, ctx) {
  if (rf & 1) {
    const _r3 = ɵɵgetCurrentView();
    ɵɵelementStart(0, "a", 14);
    ɵɵlistener("click", function OnboardingComponent_Conditional_1_ng_template_2_Conditional_5_Template_a_click_0_listener() {
      ɵɵrestoreView(_r3);
      const ctx_r1 = ɵɵnextContext(3);
      return ɵɵresetView(ctx_r1.to("skip"));
    });
    ɵɵtemplate(1, OnboardingComponent_Conditional_1_ng_template_2_Conditional_5_ng_container_1_Template, 2, 1, "ng-container", 5);
    ɵɵelementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(3);
    ɵɵadvance();
    ɵɵproperty("nzStringTemplateOutlet", ctx_r1.item.skip);
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_Conditional_6_ng_container_1_Template(rf, ctx) {
  if (rf & 1) {
    ɵɵelementContainerStart(0);
    ɵɵtext(1);
    ɵɵelementContainerEnd();
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(4);
    ɵɵadvance();
    ɵɵtextInterpolate(ctx_r1.item.prev);
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_Conditional_6_Template(rf, ctx) {
  if (rf & 1) {
    const _r4 = ɵɵgetCurrentView();
    ɵɵelementStart(0, "a", 15);
    ɵɵlistener("click", function OnboardingComponent_Conditional_1_ng_template_2_Conditional_6_Template_a_click_0_listener() {
      ɵɵrestoreView(_r4);
      const ctx_r1 = ɵɵnextContext(3);
      return ɵɵresetView(ctx_r1.to("prev"));
    });
    ɵɵtemplate(1, OnboardingComponent_Conditional_1_ng_template_2_Conditional_6_ng_container_1_Template, 2, 1, "ng-container", 5);
    ɵɵelementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(3);
    ɵɵadvance();
    ɵɵproperty("nzStringTemplateOutlet", ctx_r1.item.prev);
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_Conditional_7_ng_container_1_Template(rf, ctx) {
  if (rf & 1) {
    ɵɵelementContainerStart(0);
    ɵɵtext(1);
    ɵɵelementContainerEnd();
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(4);
    ɵɵadvance();
    ɵɵtextInterpolate(ctx_r1.item.next);
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_Conditional_7_Template(rf, ctx) {
  if (rf & 1) {
    const _r5 = ɵɵgetCurrentView();
    ɵɵelementStart(0, "a", 16);
    ɵɵlistener("click", function OnboardingComponent_Conditional_1_ng_template_2_Conditional_7_Template_a_click_0_listener() {
      ɵɵrestoreView(_r5);
      const ctx_r1 = ɵɵnextContext(3);
      return ɵɵresetView(ctx_r1.to("next"));
    });
    ɵɵtemplate(1, OnboardingComponent_Conditional_1_ng_template_2_Conditional_7_ng_container_1_Template, 2, 1, "ng-container", 5);
    ɵɵelementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(3);
    ɵɵadvance();
    ɵɵproperty("nzStringTemplateOutlet", ctx_r1.item.next);
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_Conditional_8_ng_container_1_Template(rf, ctx) {
  if (rf & 1) {
    ɵɵelementContainerStart(0);
    ɵɵtext(1);
    ɵɵelementContainerEnd();
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(4);
    ɵɵadvance();
    ɵɵtextInterpolate(ctx_r1.item.done);
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_Conditional_8_Template(rf, ctx) {
  if (rf & 1) {
    const _r6 = ɵɵgetCurrentView();
    ɵɵelementStart(0, "a", 17);
    ɵɵlistener("click", function OnboardingComponent_Conditional_1_ng_template_2_Conditional_8_Template_a_click_0_listener() {
      ɵɵrestoreView(_r6);
      const ctx_r1 = ɵɵnextContext(3);
      return ɵɵresetView(ctx_r1.to("done"));
    });
    ɵɵtemplate(1, OnboardingComponent_Conditional_1_ng_template_2_Conditional_8_ng_container_1_Template, 2, 1, "ng-container", 5);
    ɵɵelementEnd();
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(3);
    ɵɵadvance();
    ɵɵproperty("nzStringTemplateOutlet", ctx_r1.item.done);
  }
}
function OnboardingComponent_Conditional_1_ng_template_2_Template(rf, ctx) {
  if (rf & 1) {
    ɵɵtemplate(0, OnboardingComponent_Conditional_1_ng_template_2_ng_container_0_Template, 2, 1, "ng-container", 5);
    ɵɵelementStart(1, "div", 6)(2, "span", 7);
    ɵɵconditionalCreate(3, OnboardingComponent_Conditional_1_ng_template_2_Conditional_3_Template, 1, 2);
    ɵɵelementEnd();
    ɵɵelementStart(4, "div", 8);
    ɵɵconditionalCreate(5, OnboardingComponent_Conditional_1_ng_template_2_Conditional_5_Template, 2, 1, "a", 9);
    ɵɵconditionalCreate(6, OnboardingComponent_Conditional_1_ng_template_2_Conditional_6_Template, 2, 1, "a", 10);
    ɵɵconditionalCreate(7, OnboardingComponent_Conditional_1_ng_template_2_Conditional_7_Template, 2, 1, "a", 11);
    ɵɵconditionalCreate(8, OnboardingComponent_Conditional_1_ng_template_2_Conditional_8_Template, 2, 1, "a", 12);
    ɵɵelementEnd()();
  }
  if (rf & 2) {
    const ctx_r1 = ɵɵnextContext(2);
    ɵɵproperty("nzStringTemplateOutlet", ctx_r1.item.content);
    ɵɵadvance(3);
    ɵɵconditional(ctx_r1.config.showTotal ? 3 : -1);
    ɵɵadvance(2);
    ɵɵconditional(!ctx_r1.last && ctx_r1.item.skip !== null && ctx_r1.item.skip !== void 0 ? 5 : -1);
    ɵɵadvance();
    ɵɵconditional(!ctx_r1.first && ctx_r1.item.prev !== null ? 6 : -1);
    ɵɵadvance();
    ɵɵconditional(!ctx_r1.last && ctx_r1.item.next !== null && ctx_r1.item.next !== void 0 ? 7 : -1);
    ɵɵadvance();
    ɵɵconditional(ctx_r1.last && ctx_r1.item.done !== null && ctx_r1.item.done !== void 0 ? 8 : -1);
  }
}
function OnboardingComponent_Conditional_1_Template(rf, ctx) {
  if (rf & 1) {
    ɵɵelement(0, "div", 4, 0);
    ɵɵtemplate(2, OnboardingComponent_Conditional_1_ng_template_2_Template, 9, 6, "ng-template", null, 1, ɵɵtemplateRefExtractor);
  }
  if (rf & 2) {
    const content_r7 = ɵɵreference(3);
    const ctx_r1 = ɵɵnextContext();
    ɵɵclassProp("onboarding__light-hide", ctx_r1.running);
    ɵɵproperty("nzPopoverTitle", ctx_r1.item.title)("nzPopoverContent", content_r7)("nzPopoverVisible", !ctx_r1.running)("nzPopoverTrigger", null)("nzPopoverPlacement", ctx_r1.item.position)("nzPopoverOverlayClassName", ctx_r1.item.className)("nzPopoverOverlayStyle", ɵɵpureFunction2(11, _c1, ctx_r1.item.width, ctx_r1.dir))("nzNoAnimation", true);
    ɵɵattribute("style", ctx_r1.item.lightStyle, ɵɵsanitizeStyle);
  }
}
var OnboardingComponent = class _OnboardingComponent {
  el = inject(ElementRef).nativeElement;
  platform = inject(Platform);
  cdr = inject(ChangeDetectorRef);
  doc = inject(DOCUMENT);
  time;
  prevSelectorEl;
  config;
  item;
  active = 0;
  max = 0;
  op = new EventEmitter();
  running = false;
  dir = "ltr";
  popover;
  get first() {
    return this.active === 0;
  }
  get last() {
    return this.active === this.max - 1;
  }
  _getDoc() {
    return this.doc;
  }
  _getWin() {
    return this._getDoc().defaultView || window;
  }
  getLightData() {
    const doc = this._getDoc();
    const win = this._getWin();
    const el = doc.querySelector(this.item.selectors);
    if (!el) {
      return null;
    }
    const scrollTop = win.scrollY || doc.documentElement.scrollTop || doc.body.scrollTop;
    const scrollLeft = win.scrollX || doc.documentElement.scrollLeft || doc.body.scrollLeft;
    const rect = el.getBoundingClientRect();
    const top = rect.top + scrollTop;
    const left = rect.left + scrollLeft;
    const padding = 8;
    const needPadding = top > padding && left > padding;
    const offsetPos = needPadding ? padding : 0;
    const offsetWH = needPadding ? padding * 2 : 0;
    return {
      top: top - offsetPos,
      left: left - offsetPos,
      width: rect.width + offsetWH,
      height: rect.height + offsetWH,
      el,
      clientWidth: doc.body.clientWidth,
      clientHeight: doc.body.clientHeight
    };
  }
  ngAfterViewInit() {
    this.popover.component.onClickOutside = () => {
    };
  }
  scroll(pos) {
    this.prevSelectorEl = pos.el;
    const scrollY = pos.top - (pos.clientHeight - pos.height) / 2;
    this._getWin().scrollTo({
      top: scrollY
    });
    this.updatePrevElStatus(true);
  }
  updateRunning(status) {
    this.running = status;
    this.cdr.detectChanges();
    if (!status) {
      this.updatePosition();
    }
  }
  updatePosition() {
    if (!this.platform.isBrowser) {
      return;
    }
    const pos = this.getLightData();
    if (pos == null) {
      if (typeof ngDevMode === "undefined" || ngDevMode) {
        console.warn(`Did not matches selectors [${this.item.selectors}]`);
      }
      return;
    }
    const lightStyle = this.el.querySelector(".onboarding__light").style;
    lightStyle.top = `${pos.top}px`;
    lightStyle.left = `${pos.left}px`;
    lightStyle.width = `${pos.width}px`;
    lightStyle.height = `${pos.height}px`;
    this.updatePrevElStatus(false);
    this.scroll(pos);
  }
  updatePrevElStatus(status) {
    if (this.prevSelectorEl) {
      this.prevSelectorEl.classList[status ? "add" : "remove"]("onboarding__light-el");
    }
  }
  to(type) {
    this.op.emit(type);
  }
  handleMask() {
    if (this.config.maskClosable === true) {
      this.popover.component.hide();
      this.to("done");
    }
  }
  ngOnDestroy() {
    clearTimeout(this.time);
    this.updatePrevElStatus(false);
  }
  static ɵfac = function OnboardingComponent_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _OnboardingComponent)();
  };
  static ɵcmp = ɵɵdefineComponent({
    type: _OnboardingComponent,
    selectors: [["onboarding"]],
    viewQuery: function OnboardingComponent_Query(rf, ctx) {
      if (rf & 1) {
        ɵɵviewQuery(_c0, 5);
      }
      if (rf & 2) {
        let _t;
        ɵɵqueryRefresh(_t = ɵɵloadQuery()) && (ctx.popover = _t.first);
      }
    },
    hostVars: 5,
    hostBindings: function OnboardingComponent_HostBindings(rf, ctx) {
      if (rf & 2) {
        ɵɵattribute("data-onboarding-active", ctx.active);
        ɵɵclassProp("onboarding", true)("onboarding-rtl", ctx.dir === "rtl");
      }
    },
    decls: 2,
    vars: 2,
    consts: [["popover", "nzPopover"], ["content", ""], [1, "onboarding__mask"], [1, "onboarding__mask", 3, "click"], ["nz-popover", "", 1, "onboarding__light", 3, "nzPopoverTitle", "nzPopoverContent", "nzPopoverVisible", "nzPopoverTrigger", "nzPopoverPlacement", "nzPopoverOverlayClassName", "nzPopoverOverlayStyle", "nzNoAnimation"], [4, "nzStringTemplateOutlet"], [1, "flex-center-between", "onboarding__footer"], [1, "onboarding__total"], [1, "onboarding__btns"], ["nz-button", "", "nzType", "link", "nzSize", "small", "data-btnType", "skip"], ["nz-button", "", "nzSize", "small", "data-btnType", "prev"], ["nz-button", "", "nzType", "primary", "nzSize", "small", "data-btnType", "next"], ["nz-button", "", "nzType", "primary", "nzSize", "small", "data-btnType", "done"], [3, "innerHTML"], ["nz-button", "", "nzType", "link", "nzSize", "small", "data-btnType", "skip", 3, "click"], ["nz-button", "", "nzSize", "small", "data-btnType", "prev", 3, "click"], ["nz-button", "", "nzType", "primary", "nzSize", "small", "data-btnType", "next", 3, "click"], ["nz-button", "", "nzType", "primary", "nzSize", "small", "data-btnType", "done", 3, "click"]],
    template: function OnboardingComponent_Template(rf, ctx) {
      if (rf & 1) {
        ɵɵconditionalCreate(0, OnboardingComponent_Conditional_0_Template, 1, 0, "div", 2);
        ɵɵconditionalCreate(1, OnboardingComponent_Conditional_1_Template, 4, 14);
      }
      if (rf & 2) {
        ɵɵconditional(!ctx.running && ctx.config.mask ? 0 : -1);
        ɵɵadvance();
        ɵɵconditional(ctx.item ? 1 : -1);
      }
    },
    dependencies: [NzPopoverDirective, NzStringTemplateOutletDirective, NzButtonComponent, NzNoAnimationDirective],
    encapsulation: 2,
    changeDetection: 0
  });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(OnboardingComponent, [{
    type: Component,
    args: [{
      selector: "onboarding",
      host: {
        "[class.onboarding]": `true`,
        "[class.onboarding-rtl]": `dir === 'rtl'`,
        "[attr.data-onboarding-active]": `active`
      },
      changeDetection: ChangeDetectionStrategy.OnPush,
      encapsulation: ViewEncapsulation.None,
      imports: [NzPopoverDirective, NzStringTemplateOutletDirective, NzButtonComponent, NzNoAnimationDirective],
      template: `@if (!running && config.mask) {
  <div class="onboarding__mask" (click)="handleMask()"></div>
}
@if (item) {
  <div
    class="onboarding__light"
    [class.onboarding__light-hide]="running"
    [attr.style]="item.lightStyle"
    nz-popover
    #popover="nzPopover"
    [nzPopoverTitle]="item.title"
    [nzPopoverContent]="content"
    [nzPopoverVisible]="!running"
    [nzPopoverTrigger]="null"
    [nzPopoverPlacement]="item.position"
    [nzPopoverOverlayClassName]="item.className"
    [nzPopoverOverlayStyle]="{ 'max-width.px': item.width, direction: dir }"
    [nzNoAnimation]="true"
  ></div>
  <ng-template #content>
    <ng-container *nzStringTemplateOutlet="item.content">
      <div [innerHTML]="item.content"></div>
    </ng-container>
    <div class="flex-center-between onboarding__footer">
      <span class="onboarding__total">
        @if (config.showTotal) {
          {{ active + 1 }}/{{ max }}
        }
      </span>
      <div class="onboarding__btns">
        @if (!last && item.skip !== null && item.skip !== undefined) {
          <a nz-button nzType="link" (click)="to('skip')" nzSize="small" data-btnType="skip">
            <ng-container *nzStringTemplateOutlet="item.skip">{{ item.skip }}</ng-container>
          </a>
        }
        @if (!first && item.prev !== null) {
          <a nz-button (click)="to('prev')" nzSize="small" data-btnType="prev">
            <ng-container *nzStringTemplateOutlet="item.prev">{{ item.prev }}</ng-container>
          </a>
        }
        @if (!last && item.next !== null && item.next !== undefined) {
          <a nz-button (click)="to('next')" nzType="primary" nzSize="small" data-btnType="next">
            <ng-container *nzStringTemplateOutlet="item.next">{{ item.next }}</ng-container>
          </a>
        }
        @if (last && item.done !== null && item.done !== undefined) {
          <a nz-button (click)="to('done')" nzType="primary" nzSize="small" data-btnType="done">
            <ng-container *nzStringTemplateOutlet="item.done">{{ item.done }}</ng-container>
          </a>
        }
      </div>
    </div>
  </ng-template>
}
`
    }]
  }], null, {
    popover: [{
      type: ViewChild,
      args: ["popover", {
        static: false
      }]
    }]
  });
})();
var ONBOARDING_STORE_TOKEN = new InjectionToken("ONBOARDING_STORE_TOKEN", {
  providedIn: "root",
  factory: ONBOARDING_STORE_TOKEN_FACTORY
});
function ONBOARDING_STORE_TOKEN_FACTORY() {
  return new LocalStorageStore();
}
var LocalStorageStore = class {
  get(key) {
    return localStorage.getItem(key);
  }
  set(key, version) {
    localStorage.setItem(key, `${version}`);
  }
};
var OnboardingService = class _OnboardingService {
  appRef = inject(ApplicationRef);
  router = inject(Router);
  doc = inject(DOCUMENT);
  configSrv = inject(AlainConfigService);
  keyStoreSrv = inject(ONBOARDING_STORE_TOKEN);
  directionality = inject(Directionality);
  compRef;
  op$;
  config;
  active = 0;
  running$ = null;
  _running = false;
  type = null;
  locale = inject(DelonLocaleService).valueSignal("onboarding");
  _getDoc() {
    return this.doc;
  }
  /**
   * Get whether it is booting
   *
   * 获取是否正在引导中
   */
  get running() {
    return this._running;
  }
  attach() {
    const compRef = createComponent(OnboardingComponent, {
      environmentInjector: this.appRef.injector
    });
    this.compRef = compRef;
    this.appRef.attachView(compRef.hostView);
    const compNode = compRef.hostView.rootNodes[0];
    const doc = this._getDoc();
    const cdk = doc.querySelector(".cdk-overlay-container");
    if (cdk) {
      doc.body.insertBefore(compNode, cdk);
    } else {
      doc.body.appendChild(compNode);
    }
    this.op$ = this.compRef.instance.op.subscribe((type) => {
      switch (type) {
        case "next":
          this.next();
          break;
        case "prev":
          this.prev();
          break;
        default:
          this.done();
          break;
      }
    });
  }
  cancelRunning() {
    if (this.running$) {
      this.running$.unsubscribe();
      this.running$ = null;
    }
    return this;
  }
  updateRunning(status) {
    this._running = status;
    this.compRef.instance.updateRunning(status);
    return this;
  }
  destroy() {
    const storeKey = this.config?.key;
    if (storeKey != null) {
      this.keyStoreSrv.set(storeKey, this.config?.keyVersion);
    }
    this.cancelRunning();
    if (this.compRef) {
      this.appRef.detachView(this.compRef.hostView);
      this.compRef.destroy();
      this.op$.unsubscribe();
    }
  }
  showItem(isStart = false) {
    const items = this.config.items;
    const item = __spreadValues(__spreadValues({
      position: "bottomLeft",
      before: of(true),
      after: of(true)
    }, this.locale()), items[this.active]);
    const dir = this.configSrv.get("onboarding").direction || this.directionality.value;
    Object.assign(this.compRef.instance, {
      item,
      config: this.config,
      active: this.active,
      max: items.length,
      dir
    });
    const pipes = [switchMap(() => item.url ? this.router.navigateByUrl(item.url) : of(true)), switchMap(() => {
      const obs = this.type === "prev" ? item.after : item.before;
      return typeof obs === "number" ? of(true).pipe(delay(obs)) : obs;
    })];
    if (!isStart) {
      pipes.push(delay(1));
    }
    this.updateRunning(true);
    this.running$ = of(true).pipe(pipe.apply(this, pipes)).subscribe({
      next: () => this.cancelRunning().updateRunning(false),
      error: () => this.done()
    });
  }
  /**
   * Start a new user guidance
   *
   * 开启新的用户引导流程
   */
  start(config) {
    const cog = __spreadValues({
      keyVersion: "",
      items: [],
      mask: true,
      maskClosable: true,
      showTotal: false
    }, config);
    const storeKey = cog?.key;
    if (storeKey != null && this.keyStoreSrv.get(storeKey) === cog.keyVersion) {
      return;
    }
    if (this.running) {
      return;
    }
    this.destroy();
    this.config = cog;
    this.active = 0;
    this.type = null;
    this.attach();
    this.showItem(true);
  }
  /**
   * Next
   *
   * 下一步
   */
  next() {
    if (this._running || this.active + 1 >= this.config.items.length) {
      this.done();
      return;
    }
    this.type = "next";
    ++this.active;
    this.showItem();
  }
  /**
   * Prev
   *
   * 上一步
   */
  prev() {
    if (this._running || this.active - 1 < 0) {
      return;
    }
    this.type = "prev";
    --this.active;
    this.showItem();
  }
  /**
   * Done
   *
   * 完成
   */
  done() {
    this.type = "done";
    this.destroy();
  }
  ngOnDestroy() {
    this.destroy();
  }
  static ɵfac = function OnboardingService_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _OnboardingService)();
  };
  static ɵprov = ɵɵdefineInjectable({
    token: _OnboardingService,
    factory: _OnboardingService.ɵfac,
    providedIn: "root"
  });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(OnboardingService, [{
    type: Injectable,
    args: [{
      providedIn: "root"
    }]
  }], null, null);
})();
var COMPONENTS = [OnboardingComponent];
var OnboardingModule = class _OnboardingModule {
  static ɵfac = function OnboardingModule_Factory(__ngFactoryType__) {
    return new (__ngFactoryType__ || _OnboardingModule)();
  };
  static ɵmod = ɵɵdefineNgModule({
    type: _OnboardingModule,
    imports: [CommonModule, DelonLocaleModule, NzPopoverModule, NzOutletModule, NzButtonModule, NzNoAnimationModule, OnboardingComponent],
    exports: [OnboardingComponent]
  });
  static ɵinj = ɵɵdefineInjector({
    imports: [CommonModule, DelonLocaleModule, NzPopoverModule, NzOutletModule, NzButtonModule, NzNoAnimationModule, COMPONENTS]
  });
};
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(OnboardingModule, [{
    type: NgModule,
    args: [{
      imports: [CommonModule, DelonLocaleModule, NzPopoverModule, NzOutletModule, NzButtonModule, NzNoAnimationModule, COMPONENTS],
      exports: COMPONENTS
    }]
  }], null, null);
})();
export {
  LocalStorageStore,
  ONBOARDING_STORE_TOKEN,
  ONBOARDING_STORE_TOKEN_FACTORY,
  OnboardingComponent,
  OnboardingModule,
  OnboardingService
};
//# sourceMappingURL=@delon_abc_onboarding.js.map
