import{b as le}from"./chunk-FGZ6ITCH.js";import{a as se,c as ce,d as me,e as pe,g as ue,h as v}from"./chunk-KF5HXNO5.js";import{a as oe,b as re,c as ae}from"./chunk-UYXFCDCY.js";import"./chunk-LZHHB3SB.js";import"./chunk-SIZM2XL7.js";import"./chunk-2DVOMO4J.js";import"./chunk-MFG6XL3Q.js";import"./chunk-OETAK3GR.js";import"./chunk-DNAKBF6E.js";import"./chunk-GXVUYNK4.js";import"./chunk-BQVMEIZ5.js";import{d as Y,e as Z,f as ee,j as te,k as ne,l as ie}from"./chunk-EJPHIAHG.js";import{a as K,b as q}from"./chunk-ZEZPGFWG.js";import"./chunk-PUGKNFED.js";import"./chunk-FKZEB7ER.js";import{d as G}from"./chunk-3UXJQ3KI.js";import{m as P}from"./chunk-EXZNONST.js";import{a as H,c as J}from"./chunk-FWGM4PSC.js";import"./chunk-L6VFZVUC.js";import{f as Q,g as X}from"./chunk-5G6BXQUB.js";import{a as U,b as $,d as j,e as W}from"./chunk-L3XAXJTY.js";import"./chunk-SUWO6CW6.js";import"./chunk-PV63DGP2.js";import"./chunk-EOTHDIY5.js";import"./chunk-6W2MZKTD.js";import"./chunk-TWOZTKVL.js";import{j as B}from"./chunk-27W33B5M.js";import"./chunk-VF6IKWU5.js";import{Cb as k,Da as y,Eb as V,Fc as O,Fd as F,Jb as z,Jh as A,Kb as l,Kh as L,Lb as r,Lc as x,Mb as c,Qc as T,Tb as f,Wb as d,Za as _,Zb as m,hc as g,jb as D,mc as s,nc as I,oa as S,oc as R,pb as w,ua as p,va as u}from"./chunk-BJGZKRME.js";import"./chunk-PMZOYKO3.js";import{i as E}from"./chunk-57BLH6QZ.js";var _e=(o,t,e)=>[o,t,e];function ge(o,t){if(o&1){let e=f();l(0,"nz-result",13)(1,"div",15)(2,"button",9),d("click",function(){p(e);let n=m();return u(n.refresh())}),s(3,"\u91CD\u8A66"),r()()()}if(o&2){let e=m();z("nzSubTitle",e.error())}}function xe(o,t){if(o&1&&(l(0,"nz-list-item",16)(1,"nz-list-item-meta")(2,"nz-list-item-meta-title")(3,"span",17),s(4),r()(),l(5,"nz-list-item-meta-description")(6,"div",18)(7,"nz-tag",19),s(8),r(),l(9,"span",20),c(10,"span",21),s(11),r(),l(12,"span",20),c(13,"span",22),s(14),r()()()()()),o&2){let e=t.$implicit,i=m(2),n=g(16),a=g(18),b=g(20);z("nzActions",O(6,_e,n,a,b)),_(4),I(e.fileName),_(3),z("nzColor",e.fileType==="pdf"?"blue":"green"),_(),R(" ",e.fileType.toUpperCase()," "),_(3),R(" ",i.formatFileSize(e.fileSize)," "),_(3),R(" ",i.formatDate(e.createdAt)," ")}}function ze(o,t){if(o&1&&(l(0,"nz-list",14),w(1,xe,15,10,"ng-template",null,5,x),r()),o&2){let e=g(2),i=m(),n=g(14);z("nzDataSource",i.scanResults())("nzRenderItem",e)("nzItemLayout","horizontal")("nzLoading",i.isLoading())("nzNoResult",n)}}function Ce(o,t){if(o&1){let e=f();l(0,"button",23),d("click",function(){p(e);let n=m();return u(n.goToScan())}),c(1,"span",10),s(2," \u6383\u63CF "),r()}}function he(o,t){if(o&1){let e=f();l(0,"nz-empty",24)(1,"button",9),d("click",function(){p(e);let n=m();return u(n.goToScan())}),c(2,"span",10),s(3," \u958B\u59CB\u6383\u63CF "),r()()}}function Se(o,t){if(o&1){let e=f();l(0,"button",23),d("click",function(){let n=p(e).$implicit,a=m();return u(a.previewFile(n))}),c(1,"span",25),s(2," \u9810\u89BD "),r()}}function ye(o,t){if(o&1){let e=f();l(0,"button",23),d("click",function(){let n=p(e).$implicit,a=m();return u(a.downloadFile(n))}),c(1,"span",26),s(2," \u4E0B\u8F09 "),r()}}function Re(o,t){if(o&1){let e=f();l(0,"button",27),d("click",function(){let n=p(e).$implicit,a=m();return u(a.deleteFile(n))}),c(1,"span",28),s(2," \u522A\u9664 "),r()}}var C=class C{constructor(){this.storage=S(se);this.router=S(P);this.message=S(G);this.isLoading=y(!0);this.error=y("");this.scanResults=y([]);this.hasResults=T(()=>this.scanResults().length>0);this.hasError=T(()=>this.error()!=="")}ngOnInit(){this.loadScanResults()}loadScanResults(){return E(this,null,function*(){this.isLoading.set(!0),this.error.set("");try{let t=v(this.storage,"pdf-uploads"),e=yield ue(t),i=[];for(let n of e.items){let a=yield pe(n),b=yield me(n),h=a.name,fe=h.endsWith(".pdf")?"pdf":h.endsWith(".txt")?"txt":"pdf",M=h.match(/(\d+)_pages-(\d+)-(\d+)\.(pdf|txt)$/),N=new Date;M&&(N=new Date(parseInt(M[1]))),i.push({id:h,fileName:h,fileType:fe,createdAt:N,fileSize:a.size,url:b})}i.sort((n,a)=>a.createdAt.getTime()-n.createdAt.getTime()),this.scanResults.set(i)}catch(t){console.error("Error loading scan results:",t),this.error.set("\u8F09\u5165\u6383\u63CF\u7D50\u679C\u5931\u6557"),this.scanResults.set([])}finally{this.isLoading.set(!1)}})}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,i=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,n)).toFixed(2))+" "+i[n]}formatDate(t){return new Date(t).toLocaleString()}viewResult(t){t.id&&this.router.navigate(["/tree/scan-result",t.id])}downloadFile(t){let e=document.createElement("a");e.href=t.url,e.download=t.fileName,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),this.message.success(`${t.fileType.toUpperCase()} \u6587\u4EF6\u5DF2\u4E0B\u8F09`)}deleteFile(t){let e=v(this.storage,`pdf-uploads/${t.fileName}`);ce(e).then(()=>{this.message.success("\u6A94\u6848\u5DF2\u522A\u9664"),this.loadScanResults()}).catch(i=>{console.error("\u522A\u9664\u6A94\u6848\u5931\u6557:",i),this.message.error("\u522A\u9664\u6A94\u6848\u5931\u6557")})}previewFile(t){if(t.fileType==="pdf"){let i=`https://docs.google.com/viewer?url=${encodeURIComponent(t.url)}&embedded=true`;window.open(i,"_blank")}else window.open(t.url,"_blank")}goToScan(){this.router.navigate(["/tree/pdf-scan"])}refresh(){this.loadScanResults()}};C.\u0275fac=function(e){return new(e||C)},C.\u0275cmp=D({type:C,selectors:[["app-scan-result"]],decls:21,vars:2,consts:[["extraTemplate",""],["emptyTemplate",""],["previewAction",""],["downloadAction",""],["deleteAction",""],["item",""],["nzTitle","\u6A94\u6848\u5217\u8868",3,"nzExtra"],[1,"results-container"],[1,"header-actions"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","scan"],["nz-button","",3,"click"],["nz-icon","","nzType","reload"],["nzStatus","error","nzTitle","\u8F09\u5165\u5931\u6557",3,"nzSubTitle"],[3,"nzDataSource","nzRenderItem","nzItemLayout","nzLoading","nzNoResult"],["nz-result-extra",""],[3,"nzActions"],[1,"file-name"],[1,"file-info"],[3,"nzColor"],[1,"info-item"],["nz-icon","","nzType","file"],["nz-icon","","nzType","clock-circle"],["nz-button","","nzType","link",3,"click"],["nzNotFoundImage","simple","nzNotFoundContent","\u76EE\u524D\u6C92\u6709\u6A94\u6848"],["nz-icon","","nzType","eye"],["nz-icon","","nzType","download"],["nz-button","","nzType","link","nzDanger","",3,"click"],["nz-icon","","nzType","delete"]],template:function(e,i){if(e&1){let n=f();l(0,"nz-card",6)(1,"div",7)(2,"div",8)(3,"button",9),d("click",function(){return p(n),u(i.goToScan())}),c(4,"span",10),s(5," \u6383\u63CF "),r(),l(6,"button",11),d("click",function(){return p(n),u(i.refresh())}),c(7,"span",12),s(8," \u91CD\u65B0\u6574\u7406 "),r()(),k(9,ge,4,1,"nz-result",13)(10,ze,3,5,"nz-list",14),r()(),w(11,Ce,3,0,"ng-template",null,0,x)(13,he,4,0,"ng-template",null,1,x)(15,Se,3,0,"ng-template",null,2,x)(17,ye,3,0,"ng-template",null,3,x)(19,Re,3,0,"ng-template",null,4,x)}if(e&2){let n=g(12);z("nzExtra",n),_(9),V(i.hasError()?9:10)}},dependencies:[F,X,Q,W,j,U,$,L,A,ae,re,oe,le,q,K,B,ie,te,ne,ee,Y,Z,J,H],styles:[".results-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.header-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px;justify-content:flex-end}.file-name[_ngcontent-%COMP%]{font-weight:500;color:#333}.file-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-top:8px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:#666;font-size:13px}.info-item[_ngcontent-%COMP%]   span[nz-icon][_ngcontent-%COMP%]{color:#999}[_nghost-%COMP%]     .ant-list-item{padding:12px 16px;border-radius:4px;margin-bottom:6px;border:1px solid #f0f0f0;transition:all .2s}[_nghost-%COMP%]     .ant-list-item:hover{border-color:#d9d9d9;background-color:#fafafa}[_nghost-%COMP%]     .ant-list-item-meta-title{margin-bottom:6px}[_nghost-%COMP%]     .ant-list-item-action{margin-left:12px}@media (max-width: 768px){.results-container[_ngcontent-%COMP%]{max-width:100%;padding:0 16px}.header-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.file-info[_ngcontent-%COMP%]{flex-direction:column;gap:8px}[_nghost-%COMP%]     .ant-list-item{flex-direction:column;align-items:stretch}[_nghost-%COMP%]     .ant-list-item .ant-list-item-action{margin-left:0;margin-top:12px;justify-content:flex-start}}"],changeDetection:0});var de=C;export{de as ScanResultComponent};
