import{a as Y,b as Z}from"./chunk-LVG2LAOY.js";import{a as O}from"./chunk-J6AG6JAU.js";import{a as U,b as X}from"./chunk-CKYVJWE2.js";import{a as W,b as q,c as H,d as J,e as Q}from"./chunk-JPGT6HBL.js";import{a as R,b as j}from"./chunk-45BKQ37Q.js";import{d as D}from"./chunk-LFVXFGPE.js";import{f as G,k as P}from"./chunk-RGYXGWNO.js";import{A as L,d as k,e as z,g as K,h as B,n as V,q as w,t as x,y as I,z as A}from"./chunk-7GKVL75V.js";import{h as _,j as E,k as M}from"./chunk-X5G25CLX.js";import{a as S,b as g,d as F,e as T}from"./chunk-2DZ25YRQ.js";import{Jd as v,Nb as r,Ob as o,Oh as y,Pb as a,Ph as b,Qb as l,_b as c,bb as n,gb as u,nb as f,qc as m,vc as h,wc as C,xc as N}from"./chunk-GM6XQ5SX.js";var p=class p{constructor(e,t,i,s){this.firebaseCrudService=e;this.modal=t;this.message=i;this.fb=s;this.treeData=[];this.expandedKeys=[];this.selectedKeys=[];this.isModalVisible=!1;this.modalTitle="\u65B0\u589E\u7BC0\u9EDE";this.isEditMode=!1;this.nodeForm=this.fb.group({title:["",z.required],parentKey:[""],author:["",z.required],isLeaf:[!1]})}ngOnInit(){this.loadTreeData()}loadTreeData(){this.firebaseCrudService.getNodes().subscribe(e=>{let t=this.firebaseCrudService.buildTree(e);this.treeData=this.convertToNzTreeData(t)})}convertToNzTreeData(e){return e.map(t=>({title:t.title,key:t.key,expanded:t.expanded||!1,isLeaf:t.isLeaf,children:t.children?this.convertToNzTreeData(t.children):void 0}))}showAddModal(e){this.isEditMode=!1,this.modalTitle="\u65B0\u589E\u7BC0\u9EDE",this.nodeForm.reset(),e&&this.nodeForm.patchValue({parentKey:e}),this.isModalVisible=!0}showEditModal(e){this.isEditMode=!0,this.modalTitle="\u7DE8\u8F2F\u7BC0\u9EDE",this.selectedNode=e,this.nodeForm.patchValue({title:e.title,parentKey:e.parentKey||"",author:e.author,isLeaf:e.isLeaf}),this.isModalVisible=!0}deleteNode(e){this.modal.confirm({nzTitle:"\u78BA\u8A8D\u522A\u9664",nzContent:`\u78BA\u5B9A\u8981\u522A\u9664\u7BC0\u9EDE "${e.title}" \u55CE\uFF1F`,nzOkText:"\u78BA\u5B9A",nzCancelText:"\u53D6\u6D88",nzOnOk:()=>{this.firebaseCrudService.deleteNode(e.id).then(()=>{this.message.success("\u7BC0\u9EDE\u522A\u9664\u6210\u529F")}).catch(t=>{this.message.error("\u522A\u9664\u5931\u6557: "+t.message)})}})}handleOk(){if(this.nodeForm.valid){let e=this.nodeForm.value;if(this.isEditMode&&this.selectedNode)this.firebaseCrudService.updateNode(this.selectedNode.id,{title:e.title,parentKey:e.parentKey||void 0,author:e.author,isLeaf:e.isLeaf}).then(()=>{this.message.success("\u7BC0\u9EDE\u66F4\u65B0\u6210\u529F"),this.handleCancel()}).catch(t=>{this.message.error("\u66F4\u65B0\u5931\u6557: "+t.message)});else{let t={title:e.title,key:this.generateKey(),parentKey:e.parentKey||void 0,author:e.author,isLeaf:e.isLeaf};this.firebaseCrudService.addNode(t).then(()=>{this.message.success("\u7BC0\u9EDE\u65B0\u589E\u6210\u529F"),this.handleCancel()}).catch(i=>{this.message.error("\u65B0\u589E\u5931\u6557: "+i.message)})}}}handleCancel(){this.isModalVisible=!1,this.selectedNode=void 0}onNodeClick(e){this.selectedKeys=[e.node.key]}onExpand(e){this.expandedKeys=e.keys}addRootNode(){let e=new Date().toISOString(),t={title:"\u6839\u7D50\u9EDE",key:this.generateKey(),name:"\u6839\u7D50\u9EDE",type:"root",status:"active",createdAt:e,updatedAt:e};this.firebaseCrudService.addNode(t).then(()=>{this.message.success("\u6839\u7D50\u9EDE\u5EFA\u7ACB\u6210\u529F"),this.loadTreeData()}).catch(i=>{this.message.error("\u5EFA\u7ACB\u5931\u6557: "+i.message)})}generateKey(){return"node-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}};p.\u0275fac=function(t){return new(t||p)(u(O),u(_),u(D),u(I))},p.\u0275cmp=f({type:p,selectors:[["app-firebase-crud"]],decls:35,vars:19,consts:[[1,"crud-container"],[1,"toolbar"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","plus"],["nz-button","","nzType","default",2,"margin-left","8px",3,"click"],["nz-icon","","nzType","cluster"],["nzBlockNode","",3,"nzClick","nzExpandChange","nzData","nzExpandedKeys","nzSelectedKeys"],[3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzTitle"],["nz-form","","nz-row","",3,"formGroup","nzGutter"],["nz-col","",3,"nzSpan"],["nzRequired","",3,"nzSpan"],[3,"nzSpan"],["nz-input","","formControlName","title","placeholder","\u8ACB\u8F38\u5165\u7BC0\u9EDE\u6A19\u984C"],["nz-input","","formControlName","parentKey","placeholder","\u7236\u7BC0\u9EDE key\uFF08\u53EF\u9078\uFF09"],["nz-input","","formControlName","author","placeholder","\u8ACB\u8F38\u5165\u4F5C\u8005"],["formControlName","isLeaf"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"button",2),c("click",function(){return i.showAddModal()}),l(3,"span",3),m(4,"\u65B0\u589E\u7BC0\u9EDE "),a(),o(5,"button",4),c("click",function(){return i.addRootNode()}),l(6,"span",5),m(7,"\u5EFA\u7ACB\u6839\u7D50\u9EDE "),a()(),o(8,"nz-tree",6),c("nzClick",function(d){return i.onNodeClick(d)})("nzExpandChange",function(d){return i.onExpand(d)}),a()(),o(9,"nz-modal",7),N("nzVisibleChange",function(d){return C(i.isModalVisible,d)||(i.isModalVisible=d),d}),c("nzOnCancel",function(){return i.handleCancel()})("nzOnOk",function(){return i.handleOk()}),o(10,"form",8)(11,"div",9)(12,"nz-form-item")(13,"nz-form-label",10),m(14,"\u7BC0\u9EDE\u6A19\u984C"),a(),o(15,"nz-form-control",11),l(16,"input",12),a()()(),o(17,"div",9)(18,"nz-form-item")(19,"nz-form-label",11),m(20,"\u7236\u7BC0\u9EDE"),a(),o(21,"nz-form-control",11),l(22,"input",13),a()()(),o(23,"div",9)(24,"nz-form-item")(25,"nz-form-label",11),m(26,"\u4F5C\u8005"),a(),o(27,"nz-form-control",11),l(28,"input",14),a()()(),o(29,"div",9)(30,"nz-form-item")(31,"nz-form-label",11),m(32,"\u662F\u5426\u70BA\u8449\u7BC0\u9EDE"),a(),o(33,"nz-form-control",11),l(34,"nz-switch",15),a()()()()()),t&2&&(n(8),r("nzData",i.treeData)("nzExpandedKeys",i.expandedKeys)("nzSelectedKeys",i.selectedKeys),n(),h("nzVisible",i.isModalVisible),r("nzTitle",i.modalTitle),n(),r("formGroup",i.nodeForm)("nzGutter",24),n(),r("nzSpan",24),n(2),r("nzSpan",6),n(2),r("nzSpan",18),n(2),r("nzSpan",24),n(2),r("nzSpan",6),n(2),r("nzSpan",18),n(2),r("nzSpan",24),n(2),r("nzSpan",6),n(2),r("nzSpan",18),n(2),r("nzSpan",24),n(2),r("nzSpan",6),n(2),r("nzSpan",18))},dependencies:[v,A,V,k,K,B,L,w,x,Z,Y,M,E,Q,j,R,q,W,J,H,P,G,T,F,S,g,b,y,X,U],styles:[".crud-container[_ngcontent-%COMP%]{padding:16px}.toolbar[_ngcontent-%COMP%]{margin-bottom:16px}nz-tree[_ngcontent-%COMP%]{border:1px solid #d9d9d9;border-radius:6px;padding:8px}"]});var $=p;export{$ as a};
