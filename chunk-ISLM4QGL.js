import{a as W,b as J,c as K,d as Q,e as U}from"./chunk-D5PHB2FG.js";import{f as k,k as q}from"./chunk-4JVOCDVL.js";import{a as V,b as H}from"./chunk-J7YN77AB.js";import"./chunk-MFG6XL3Q.js";import{a as G,f as P,k as j}from"./chunk-OETAK3GR.js";import"./chunk-JYBAKELG.js";import{d as _}from"./chunk-GHD2FGWK.js";import"./chunk-DNAKBF6E.js";import"./chunk-GXVUYNK4.js";import{A as x,d as g,e as l,g as B,h as M,n as R,q as T,t as I,y as w}from"./chunk-BQVMEIZ5.js";import{a as L,b as O}from"./chunk-FKZEB7ER.js";import{d as E}from"./chunk-3UXJQ3KI.js";import{m as N}from"./chunk-EXZNONST.js";import"./chunk-FWGM4PSC.js";import"./chunk-L6VFZVUC.js";import{f as X,g as Y}from"./chunk-5G6BXQUB.js";import{a as b,b as h,d as y,e as A}from"./chunk-L3XAXJTY.js";import"./chunk-SUWO6CW6.js";import"./chunk-PV63DGP2.js";import"./chunk-EOTHDIY5.js";import"./chunk-6W2MZKTD.js";import"./chunk-TWOZTKVL.js";import"./chunk-27W33B5M.js";import"./chunk-VF6IKWU5.js";import{Cc as S,Fd as F,Jb as t,Kb as n,Lb as r,Mb as p,Vd as D,Wb as d,Za as e,cb as s,jb as v,mc as m}from"./chunk-BJGZKRME.js";import"./chunk-PMZOYKO3.js";import{a as f,b as C}from"./chunk-57BLH6QZ.js";var re=()=>({minRows:3,maxRows:5}),c=class c{constructor(o,i,a,u){this.fb=o;this.router=i;this.message=a;this.http=u;this.contractForm=this.fb.group({title:["",[l.required]],client:["",[l.required]],amount:[null,[l.required,l.min(0)]],startDate:[null,[l.required]],endDate:[null,[l.required]],description:[""]})}onSubmit(){if(this.contractForm.valid){let o=this.contractForm.value,i=o.amount,a=this.calculatePaymentRounds(i),u=C(f({},o),{originalAmount:i,currentAmount:i,changeAmount:0,version:"1.0",changeVersion:"1.0",progress:0,paymentRounds:a,changes:[]});this.http.post("/contract",u).subscribe($=>{this.message.success("\u5408\u7D04\u5275\u5EFA\u6210\u529F"),this.router.navigate(["/contract/list"])})}else Object.values(this.contractForm.controls).forEach(o=>{o.invalid&&o.markAsTouched()})}calculatePaymentRounds(o){let i=[],a=Math.ceil(o/5e4);for(let u=1;u<=a;u++){let z=u===a?o-i.reduce((te,ne)=>te+ne.amount,0):Math.floor(o/a),ee=Math.round(z/o*100);i.push({round:u,amount:z,status:"pending",date:new Date(Date.now()+u*30*24*60*60*1e3),paymentStatus:"draft",progress:ee})}return i}onCancel(){this.router.navigate(["/contract/list"])}};c.\u0275fac=function(i){return new(i||c)(s(w),s(N),s(E),s(D))},c.\u0275cmp=v({type:c,selectors:[["app-contract-create"]],decls:38,vars:20,consts:[["title","\u5275\u5EFA\u5408\u7D04"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","",3,"nzSpan"],["nzErrorTip","\u8ACB\u8F38\u5165\u5408\u7D04\u6A19\u984C",3,"nzSpan"],["nz-input","","formControlName","title","placeholder","\u8ACB\u8F38\u5165\u5408\u7D04\u6A19\u984C"],["nzErrorTip","\u8ACB\u8F38\u5165\u5BA2\u6236\u540D\u7A31",3,"nzSpan"],["nz-input","","formControlName","client","placeholder","\u8ACB\u8F38\u5165\u5BA2\u6236\u540D\u7A31"],["nzErrorTip","\u8ACB\u8F38\u5165\u5408\u7D04\u91D1\u984D",3,"nzSpan"],["formControlName","amount","placeholder","\u8ACB\u8F38\u5165\u5408\u7D04\u91D1\u984D",2,"width","100%",3,"nzMin","nzStep"],["nzErrorTip","\u8ACB\u9078\u64C7\u958B\u59CB\u65E5\u671F",3,"nzSpan"],["formControlName","startDate","placeholder","\u8ACB\u9078\u64C7\u958B\u59CB\u65E5\u671F",2,"width","100%"],["nzErrorTip","\u8ACB\u9078\u64C7\u7D50\u675F\u65E5\u671F",3,"nzSpan"],["formControlName","endDate","placeholder","\u8ACB\u9078\u64C7\u7D50\u675F\u65E5\u671F",2,"width","100%"],[3,"nzSpan"],["nz-input","","formControlName","description","placeholder","\u8ACB\u8F38\u5165\u5408\u7D04\u63CF\u8FF0",3,"nzAutosize"],[3,"nzOffset","nzSpan"],["nz-button","","nzType","primary","type","submit",3,"disabled"],["nz-button","",2,"margin-left","8px",3,"click"]],template:function(i,a){i&1&&(n(0,"nz-card",0)(1,"form",1),d("ngSubmit",function(){return a.onSubmit()}),n(2,"nz-form-item")(3,"nz-form-label",2),m(4,"\u5408\u7D04\u6A19\u984C"),r(),n(5,"nz-form-control",3),p(6,"input",4),r()(),n(7,"nz-form-item")(8,"nz-form-label",2),m(9,"\u5BA2\u6236\u540D\u7A31"),r(),n(10,"nz-form-control",5),p(11,"input",6),r()(),n(12,"nz-form-item")(13,"nz-form-label",2),m(14,"\u5408\u7D04\u91D1\u984D"),r(),n(15,"nz-form-control",7),p(16,"nz-input-number",8),r()(),n(17,"nz-form-item")(18,"nz-form-label",2),m(19,"\u958B\u59CB\u65E5\u671F"),r(),n(20,"nz-form-control",9),p(21,"nz-date-picker",10),r()(),n(22,"nz-form-item")(23,"nz-form-label",2),m(24,"\u7D50\u675F\u65E5\u671F"),r(),n(25,"nz-form-control",11),p(26,"nz-date-picker",12),r()(),n(27,"nz-form-item")(28,"nz-form-label",13),m(29,"\u5408\u7D04\u63CF\u8FF0"),r(),n(30,"nz-form-control",13),p(31,"textarea",14),r()(),n(32,"nz-form-item")(33,"nz-form-control",15)(34,"button",16),m(35," \u5275\u5EFA\u5408\u7D04 "),r(),n(36,"button",17),d("click",function(){return a.onCancel()}),m(37," \u53D6\u6D88 "),r()()()()()),i&2&&(e(),t("formGroup",a.contractForm),e(2),t("nzSpan",4),e(2),t("nzSpan",20),e(3),t("nzSpan",4),e(2),t("nzSpan",20),e(3),t("nzSpan",4),e(2),t("nzSpan",20),e(),t("nzMin",0)("nzStep",1e3),e(2),t("nzSpan",4),e(2),t("nzSpan",20),e(3),t("nzSpan",4),e(2),t("nzSpan",20),e(3),t("nzSpan",4),e(2),t("nzSpan",20),e(),t("nzAutosize",S(19,re)),e(2),t("nzOffset",4)("nzSpan",20),e(),t("disabled",!a.contractForm.valid))},dependencies:[F,x,R,g,B,M,T,I,U,O,L,J,W,Q,K,j,P,G,q,k,H,V,_,A,y,b,h,Y,X],encapsulation:2});var Z=c;export{Z as ContractCreateComponent};
