import{b as Be,c as Ne}from"./chunk-YQ4C6CO3.js";import{$ as b}from"./chunk-I2RAQBWN.js";import"./chunk-AF73PXIT.js";import"./chunk-LRIKAP6Q.js";import{a as xe,b as Te}from"./chunk-HQS2YTI7.js";import{b as ke,c as De,d as Ee}from"./chunk-T5MCIH7C.js";import{a as ye,b as Ae}from"./chunk-R6IL4IF5.js";import{a as te,b as ie,c as ne}from"./chunk-J6PITLOE.js";import{a as Ce,b as we,c as he,d as Se,e as ve}from"./chunk-Y5XW6TKY.js";import"./chunk-XY7ZTW3N.js";import{f as fe,k as ze}from"./chunk-2QP5ASAP.js";import{c as le,f as se,h as me,j as ue,k as pe,l as ce,n as de}from"./chunk-P65TELVZ.js";import"./chunk-7Y7RPWKD.js";import"./chunk-4YTDYDIC.js";import"./chunk-L7MYJ753.js";import{a as Z,b as ee}from"./chunk-NB2WFYBW.js";import"./chunk-2SMWRKZV.js";import{a as ge,b as _e}from"./chunk-CQZDDL6X.js";import{d as P}from"./chunk-2WTG2XMQ.js";import"./chunk-OBGYZQEU.js";import{b as re,c as oe,d as ae}from"./chunk-AW7N2FUZ.js";import"./chunk-SVONCNS6.js";import"./chunk-VKW3WH5F.js";import{d as L,e as F,g as G,h as $,m as q,n as R,q as j,r as J,s as K,t as Q,x as U,y as X,z as Y}from"./chunk-75AQQ352.js";import"./chunk-BB66XR64.js";import"./chunk-2M5CHBKO.js";import"./chunk-AHBW3B6E.js";import"./chunk-23I64B73.js";import"./chunk-PCDTQVOY.js";import"./chunk-OW7234XQ.js";import"./chunk-OG6J75NL.js";import"./chunk-QJMKMVSR.js";import"./chunk-ZYDPBZFO.js";import"./chunk-QESUVVYF.js";import{f as be,g as Fe}from"./chunk-VKEWEKUN.js";import{h as I,q as M,s as H,t as O}from"./chunk-3RRHG5WX.js";import{Jc as W,Kc as V}from"./chunk-LRVALGQA.js";import"./chunk-LBUPYOOJ.js";import"./chunk-YIOOD6AO.js";import{A as N,q as T,r as B}from"./chunk-7CV657US.js";import{Ba as p,Ca as c,Gb as D,Jc as E,La as C,Mb as _,Oc as l,Pc as y,Qc as A,gc as a,hc as i,ic as r,jc as z,ld as x,qc as w,qd as k,tb as o,ua as v,wc as d,zc as f}from"./chunk-ARNVYSUA.js";import{i as g}from"./chunk-57BLH6QZ.js";function Ve(m,t){if(m&1&&z(0,"nz-option",23),m&2){let e=t.$implicit;a("nzValue",e)("nzLabel",e)}}function Ie(m,t){if(m&1){let e=w();i(0,"tr")(1,"td"),l(2),r(),i(3,"td")(4,"nz-tag",24),l(5),r()(),i(6,"td")(7,"button",25),d("click",function(){let s=p(e).$implicit,u=f();return c(u.setDefaultClient(s))}),l(8," \u8A2D\u70BA\u9810\u8A2D "),r(),i(9,"nz-popconfirm",26),d("nzOnConfirm",function(){let s=p(e).$implicit,u=f();return c(u.removeClient(s))}),i(10,"button",27),l(11," \u522A\u9664 "),r()()()()}if(m&2){let e=t.$implicit,n=f();o(2),y(e),o(2),a("nzColor",e===n.defaultClient()?"blue":"default"),o(),A(" ",e===n.defaultClient()?"\u9810\u8A2D":"\u4E00\u822C"," "),o(2),a("disabled",e===n.defaultClient())}}function Me(m,t){m&1&&(i(0,"div",28),z(1,"nz-alert",29),r())}function He(m,t){if(m&1){let e=w();i(0,"tr")(1,"td"),l(2),r(),i(3,"td")(4,"nz-tag",30),l(5),r()(),i(6,"td"),l(7),r(),i(8,"td")(9,"nz-switch",31),d("ngModelChange",function(s){let u=p(e).$implicit,S=f();return c(S.toggleWorkflowStatus(u.key,s))}),r()(),i(10,"td")(11,"button",32),d("click",function(){let s=p(e).$implicit,u=f();return c(u.editWorkflow(s))}),l(12," \u7DE8\u8F2F "),r(),i(13,"nz-popconfirm",33),d("nzOnConfirm",function(){let s=p(e).$implicit,u=f();return c(u.deleteWorkflow(s.key))}),i(14,"button",27),l(15," \u522A\u9664 "),r()()()()}if(m&2){let e=t.$implicit;o(2),y(e.name),o(3),y(e.clientId),o(2),A("",e.steps.length," \u6B65\u9A5F"),o(2),a("ngModel",e.isActive)}}function Oe(m,t){if(m&1&&z(0,"nz-option",23),m&2){let e=t.$implicit;a("nzValue",e)("nzLabel",e)}}function Pe(m,t){if(m&1){let e=w();i(0,"button",54),d("click",function(){p(e);let s=f(2).index,u=f(2);return c(u.removeStep(s))}),z(1,"span",55),r()}}function Le(m,t){if(m&1&&_(0,Pe,2,0,"button",53),m&2){let e=f(3);a("ngIf",e.stepsFormArray.length>1)}}function Ge(m,t){if(m&1&&(i(0,"nz-card",48),_(1,Le,1,1,"ng-template",null,2,x),i(3,"nz-form-item")(4,"nz-form-label",36),l(5,"\u6B65\u9A5F\u540D\u7A31"),r(),i(6,"nz-form-control",49),z(7,"input",50),r()(),i(8,"nz-form-item")(9,"nz-form-label",36),l(10,"\u5BE9\u6279\u4EBA"),r(),i(11,"nz-form-control",51),z(12,"input",52),r()()()),m&2){let e=t.index,n=E(2);a("formGroupName",e)("nzTitle","\u6B65\u9A5F "+(e+1))("nzExtra",n),o(4),a("nzSpan",8),o(2),a("nzSpan",16),o(3),a("nzSpan",8),o(2),a("nzSpan",16)}}function $e(m,t){if(m&1){let e=w();i(0,"nz-card",34)(1,"form",35),d("ngSubmit",function(){p(e);let s=f();return c(s.onSubmitWorkflow())}),i(2,"nz-form-item")(3,"nz-form-label",36),l(4,"\u6A21\u677F\u540D\u7A31"),r(),i(5,"nz-form-control",37),z(6,"input",38),r()(),i(7,"nz-form-item")(8,"nz-form-label",36),l(9,"\u5C0D\u61C9\u696D\u4E3B"),r(),i(10,"nz-form-control",39)(11,"nz-select",40),_(12,Oe,1,2,"nz-option",14),r()()(),i(13,"nz-form-item")(14,"nz-form-label",41),l(15,"\u5BE9\u6279\u6B65\u9A5F"),r(),i(16,"nz-form-control",41)(17,"div",42),_(18,Ge,13,7,"nz-card",43),r(),i(19,"button",44),d("click",function(){p(e);let s=f();return c(s.addStep())}),z(20,"span",11),l(21," \u6DFB\u52A0\u6B65\u9A5F "),r()()(),i(22,"nz-form-item")(23,"nz-form-control",45)(24,"button",46),l(25),r(),i(26,"button",47),d("click",function(){p(e);let s=f();return c(s.cancelWorkflowEdit())}),l(27," \u53D6\u6D88 "),r()()()()()}if(m&2){let e=f();a("nzTitle",e.editingWorkflow()?"\u7DE8\u8F2F\u6D41\u7A0B\u6A21\u677F":"\u65B0\u589E\u6D41\u7A0B\u6A21\u677F"),o(),a("formGroup",e.workflowForm),o(2),a("nzSpan",6),o(2),a("nzSpan",18),o(3),a("nzSpan",6),o(2),a("nzSpan",18),o(2),a("ngForOf",e.availableClients()),o(2),a("nzSpan",6),o(2),a("nzSpan",18),o(2),a("ngForOf",e.stepsFormArray.controls),o(5),a("nzOffset",6)("nzSpan",18),o(),a("nzLoading",e.isSubmitting())("disabled",!e.workflowForm.valid),o(),A(" ",e.editingWorkflow()?"\u66F4\u65B0":"\u5275\u5EFA","\u6A21\u677F ")}}var h=class h{constructor(){this.contractService=v(Ne);this.workflowService=v(Be);this.message=v(P);this.fb=v(U);this.clients=C([]);this.defaultClient=C("");this.clientInput=C("");this.workflows=C([]);this.isLoading=C(!1);this.isSubmitting=C(!1);this.showWorkflowForm=C(!1);this.editingWorkflow=C(null);this.availableClients=k(()=>this.clients());this.hasClients=k(()=>this.clients().length>0);this.workflowForm=this.createWorkflowForm()}ngOnInit(){this.loadClients(),this.loadWorkflows()}get stepsFormArray(){return this.workflowForm.get("steps")}loadClients(){return g(this,null,function*(){this.isLoading.set(!0);try{let t=yield this.contractService.getClientsSettings();this.clients.set(t?.list||[]),this.defaultClient.set(t?.default||"")}catch{this.message.error("\u8F09\u5165\u696D\u4E3B\u6E05\u55AE\u5931\u6557")}finally{this.isLoading.set(!1)}})}addClient(){return g(this,null,function*(){let t=this.clientInput().trim();if(!t||this.clients().includes(t))return;let e=[...this.clients(),t];this.clients.set(e),this.clientInput.set(""),yield this.saveClients()})}removeClient(t){return g(this,null,function*(){let e=this.clients().filter(n=>n!==t);this.clients.set(e),this.defaultClient()===t&&this.defaultClient.set(e[0]||""),yield this.saveClients()})}setDefaultClient(t){return g(this,null,function*(){this.defaultClient.set(t),yield this.saveClients()})}saveClients(){return g(this,null,function*(){try{yield this.contractService.setClientsSettings({list:this.clients(),default:this.defaultClient()}),this.message.success("\u696D\u4E3B\u8A2D\u5B9A\u5DF2\u4FDD\u5B58")}catch{this.message.error("\u4FDD\u5B58\u5931\u6557")}})}createWorkflowForm(){return this.fb.group({name:["",[F.required]],clientId:["",[F.required]],steps:this.fb.array([this.createStepForm()])})}createStepForm(){return this.fb.group({name:["",[F.required]],approver:["",[F.required]],order:[0]})}loadWorkflows(){return g(this,null,function*(){try{this.workflowService.listTemplates().subscribe(t=>{this.workflows.set(t)})}catch{this.message.error("\u8F09\u5165\u6D41\u7A0B\u6A21\u677F\u5931\u6557")}})}showCreateWorkflowForm(){this.editingWorkflow.set(null),this.workflowForm.reset(),this.resetStepsArray(),this.showWorkflowForm.set(!0)}editWorkflow(t){this.editingWorkflow.set(t),this.populateWorkflowForm(t),this.showWorkflowForm.set(!0)}populateWorkflowForm(t){this.workflowForm.patchValue({name:t.name,clientId:t.clientId}),this.resetStepsArray(),t.steps.forEach((e,n)=>{n>0&&this.addStep(),this.stepsFormArray.at(n).patchValue({name:e.name,approver:e.approver,order:e.order})})}resetStepsArray(){for(;this.stepsFormArray.length>1;)this.stepsFormArray.removeAt(1);this.stepsFormArray.at(0).reset()}addStep(){let t=this.createStepForm();t.patchValue({order:this.stepsFormArray.length}),this.stepsFormArray.push(t)}removeStep(t){this.stepsFormArray.length>1&&(this.stepsFormArray.removeAt(t),this.stepsFormArray.controls.forEach((e,n)=>{e.patchValue({order:n})}))}onSubmitWorkflow(){return g(this,null,function*(){if(this.workflowForm.valid&&!this.isSubmitting()){this.isSubmitting.set(!0);try{let t=this.workflowForm.value,e={name:t.name,clientId:t.clientId,steps:t.steps.map((n,s)=>({name:n.name,approver:n.approver,order:s,conditions:[]})),isActive:!0,createdAt:b(),updatedAt:b()};this.editingWorkflow()?(yield this.workflowService.updateTemplate(this.editingWorkflow().key,{name:e.name,clientId:e.clientId,steps:e.steps,isActive:e.isActive,createdAt:this.editingWorkflow().createdAt,updatedAt:b()}),this.message.success("\u6D41\u7A0B\u6A21\u677F\u66F4\u65B0\u6210\u529F")):(yield this.workflowService.createTemplate(e),this.message.success("\u6D41\u7A0B\u6A21\u677F\u5275\u5EFA\u6210\u529F")),this.cancelWorkflowEdit(),this.loadWorkflows()}catch(t){this.message.error("\u64CD\u4F5C\u5931\u6557\uFF1A"+t.message)}finally{this.isSubmitting.set(!1)}}})}toggleWorkflowStatus(t,e){return g(this,null,function*(){try{yield this.workflowService.updateTemplate(t,{isActive:e,updatedAt:b()}),this.message.success(`\u6D41\u7A0B\u6A21\u677F\u5DF2${e?"\u555F\u7528":"\u505C\u7528"}`),this.loadWorkflows()}catch{this.message.error("\u72C0\u614B\u66F4\u65B0\u5931\u6557")}})}deleteWorkflow(t){return g(this,null,function*(){try{yield this.workflowService.deleteTemplate(t),this.message.success("\u6D41\u7A0B\u6A21\u677F\u522A\u9664\u6210\u529F"),this.loadWorkflows()}catch(e){this.message.error("\u522A\u9664\u5931\u6557\uFF1A"+e.message)}})}cancelWorkflowEdit(){this.showWorkflowForm.set(!1),this.editingWorkflow.set(null),this.workflowForm.reset()}updateClientInput(t){this.clientInput.set(t)}};h.\u0275fac=function(e){return new(e||h)},h.\u0275cmp=D({type:h,selectors:[["hub-settings"]],decls:52,vars:15,consts:[["clientTable",""],["workflowTable",""],["stepExtra",""],[1,"settings-page"],["nzType","card"],["nzTitle","\u696D\u4E3B\u7BA1\u7406"],["nzTitle","\u696D\u4E3B\u6E05\u55AE\u7BA1\u7406",3,"nzLoading"],[2,"margin-bottom","16px"],[2,"display","flex","gap","8px","align-items","center","margin-bottom","16px"],["nz-input","","placeholder","\u65B0\u589E\u696D\u4E3B",2,"width","200px",3,"input","keyup.enter","value"],["nz-button","","nzType","primary",3,"click","disabled"],["nz-icon","","nzType","plus"],[2,"margin-right","8px"],["nzPlaceHolder","\u8ACB\u9078\u64C7\u9810\u8A2D\u696D\u4E3B",2,"width","200px",3,"ngModelChange","ngModel"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzSize","small",3,"nzData","nzShowPagination"],[4,"ngFor","ngForOf"],["nzTitle","\u6D41\u7A0B\u6A21\u677F"],["nzTitle","\u5DE5\u4F5C\u6D41\u7A0B\u6A21\u677F\u7BA1\u7406"],["style","margin-top: 8px;",4,"ngIf"],["nzSize","middle",3,"nzData","nzLoading"],["nzTitle","\u7DE8\u8F2F\u6A21\u677F",3,"nzDisabled"],[3,"nzTitle",4,"ngIf"],[3,"nzValue","nzLabel"],[3,"nzColor"],["nz-button","","nzType","link","nzSize","small",3,"click","disabled"],["nzTitle","\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u696D\u4E3B\u55CE\uFF1F",3,"nzOnConfirm"],["nz-button","","nzType","link","nzSize","small","nzDanger","","nz-popconfirm",""],[2,"margin-top","8px"],["nzType","warning","nzMessage","\u8ACB\u5148\u5728\u696D\u4E3B\u7BA1\u7406\u4E2D\u6DFB\u52A0\u696D\u4E3B\uFF0C\u624D\u80FD\u5275\u5EFA\u6D41\u7A0B\u6A21\u677F","nzShowIcon",""],["nzColor","blue"],[3,"ngModelChange","ngModel"],["nz-button","","nzType","link","nzSize","small",3,"click"],["nzTitle","\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u6D41\u7A0B\u6A21\u677F\u55CE\uFF1F","nzOkText","\u78BA\u5B9A","nzCancelText","\u53D6\u6D88",3,"nzOnConfirm"],[3,"nzTitle"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","",3,"nzSpan"],["nzErrorTip","\u8ACB\u8F38\u5165\u6A21\u677F\u540D\u7A31",3,"nzSpan"],["nz-input","","formControlName","name","placeholder","\u8ACB\u8F38\u5165\u6D41\u7A0B\u6A21\u677F\u540D\u7A31"],["nzErrorTip","\u8ACB\u9078\u64C7\u696D\u4E3B",3,"nzSpan"],["formControlName","clientId","nzPlaceHolder","\u8ACB\u9078\u64C7\u696D\u4E3B"],[3,"nzSpan"],["formArrayName","steps"],["nzSize","small","style","margin-bottom: 16px;",3,"formGroupName","nzTitle","nzExtra",4,"ngFor","ngForOf"],["nz-button","","nzType","dashed","type","button",2,"width","100%","margin-top","8px",3,"click"],[3,"nzOffset","nzSpan"],["nz-button","","nzType","primary","type","submit",3,"nzLoading","disabled"],["nz-button","","type","button",2,"margin-left","8px",3,"click"],["nzSize","small",2,"margin-bottom","16px",3,"formGroupName","nzTitle","nzExtra"],["nzErrorTip","\u8ACB\u8F38\u5165\u6B65\u9A5F\u540D\u7A31",3,"nzSpan"],["nz-input","","formControlName","name","placeholder","\u8ACB\u8F38\u5165\u6B65\u9A5F\u540D\u7A31"],["nzErrorTip","\u8ACB\u8F38\u5165\u5BE9\u6279\u4EBA",3,"nzSpan"],["nz-input","","formControlName","approver","placeholder","\u8ACB\u8F38\u5165\u5BE9\u6279\u4EBA"],["nz-button","","nzType","text","nzDanger","","nzSize","small","type","button",3,"click",4,"ngIf"],["nz-button","","nzType","text","nzDanger","","nzSize","small","type","button",3,"click"],["nz-icon","","nzType","delete"]],template:function(e,n){if(e&1){let s=w();i(0,"div",3)(1,"nz-tabset",4)(2,"nz-tab",5)(3,"nz-card",6)(4,"div",7)(5,"div",8)(6,"input",9),d("input",function(S){return p(s),c(n.updateClientInput(S.target.value))})("keyup.enter",function(){return p(s),c(n.addClient())}),r(),i(7,"button",10),d("click",function(){return p(s),c(n.addClient())}),z(8,"span",11),l(9," \u65B0\u589E\u696D\u4E3B "),r()(),i(10,"div",7)(11,"label",12),l(12,"\u9810\u8A2D\u696D\u4E3B\uFF1A"),r(),i(13,"nz-select",13),d("ngModelChange",function(S){return p(s),c(n.setDefaultClient(S))}),_(14,Ve,1,2,"nz-option",14),r()()(),i(15,"nz-table",15,0)(17,"thead")(18,"tr")(19,"th"),l(20,"\u696D\u4E3B\u540D\u7A31"),r(),i(21,"th"),l(22,"\u72C0\u614B"),r(),i(23,"th"),l(24,"\u64CD\u4F5C"),r()()(),i(25,"tbody"),_(26,Ie,12,4,"tr",16),r()()()(),i(27,"nz-tab",17)(28,"nz-card",18)(29,"div",7)(30,"button",10),d("click",function(){return p(s),c(n.showCreateWorkflowForm())}),z(31,"span",11),l(32," \u65B0\u589E\u6D41\u7A0B\u6A21\u677F "),r(),_(33,Me,2,0,"div",19),r(),i(34,"nz-table",20,1)(36,"thead")(37,"tr")(38,"th"),l(39,"\u6A21\u677F\u540D\u7A31"),r(),i(40,"th"),l(41,"\u5C0D\u61C9\u696D\u4E3B"),r(),i(42,"th"),l(43,"\u6B65\u9A5F\u6578\u91CF"),r(),i(44,"th"),l(45,"\u72C0\u614B"),r(),i(46,"th"),l(47,"\u64CD\u4F5C"),r()()(),i(48,"tbody"),_(49,He,16,4,"tr",16),r()()()(),i(50,"nz-tab",21),_(51,$e,28,15,"nz-card",22),r()()()}e&2&&(o(3),a("nzLoading",n.isLoading()),o(3),a("value",n.clientInput()),o(),a("disabled",!n.clientInput().trim()),o(6),a("ngModel",n.defaultClient()),o(),a("ngForOf",n.clients()),o(),a("nzData",n.clients())("nzShowPagination",!1),o(11),a("ngForOf",n.clients()),o(4),a("disabled",!n.hasClients()),o(3),a("ngIf",!n.hasClients()),o(),a("nzData",n.workflows())("nzLoading",n.isLoading()),o(15),a("ngForOf",n.workflows()),o(),a("nzDisabled",!n.showWorkflowForm()),o(),a("ngIf",n.showWorkflowForm()))},dependencies:[N,T,B,X,R,L,G,$,q,Y,j,Q,J,K,Ee,De,ke,ae,re,oe,ze,fe,O,H,I,M,de,ue,le,se,ce,me,pe,ve,_e,ge,we,Ce,Se,he,ne,ie,te,Ae,ye,V,W,Fe,be,ee,Z,Te,xe],encapsulation:2,changeDetection:0});var We=h;export{We as HubSettingsComponent};
