<nz-card nzTitle="PDF 文字提取" [nzExtra]="extraTemplate">
  <div class="pdf-scan-container">
    <!-- Upload Section -->
    <nz-card nzSize="small" nzTitle="上傳 PDF 文件">
      <nz-upload
        nzType="drag"
        [nzMultiple]="false"
        [nzAccept]="'.pdf'"
        [nzBeforeUpload]="beforeUpload"
        (nzChange)="handleUploadChange($event)"
        [nzFileList]="fileList"
      >
        <p class="ant-upload-drag-icon">
          <span nz-icon nzType="inbox"></span>
        </p>
        <p class="ant-upload-text">點擊或拖拽 PDF 文件到此區域上傳</p>
        <p class="ant-upload-hint">支援單個 PDF 文件上傳，文件將使用 Google Cloud Vision API 進行文字提取</p>
      </nz-upload>
    </nz-card>

    <!-- Page Range Selection -->
    <div *ngIf="pdfDocument && !isProcessing" class="page-range-section">
      <nz-card nzSize="small" nzTitle="頁數範圍設定">
        <div class="pdf-info">
          <p>總頁數：{{ totalPages }} 頁</p>
        </div>

        <nz-form-item>
          <nz-form-label>選擇頁數範圍</nz-form-label>
          <nz-form-control>
            <div class="page-range-inputs">
              <nz-input-number
                [(ngModel)]="startPage"
                [nzMin]="1"
                [nzMax]="totalPages"
                placeholder="起始頁"
                style="width: 120px;">
              </nz-input-number>
              <span class="page-range-separator">至</span>
              <nz-input-number
                [(ngModel)]="endPage"
                [nzMin]="1"
                [nzMax]="totalPages"
                placeholder="結束頁"
                style="width: 120px;">
              </nz-input-number>
            </div>
          </nz-form-control>
        </nz-form-item>

        <div class="page-range-info">
          <span *ngIf="startPage && endPage">
            將提取第 {{ startPage }} 至 {{ endPage }} 頁 (共 {{ endPage - startPage + 1 }} 頁)
          </span>
        </div>

        <div class="extract-actions">
          <button nz-button nzType="primary" (click)="extractSelectedPages()"
                  [disabled]="!isValidPageRange()">
            <span nz-icon nzType="file-text"></span>
            提取選中頁面文字
          </button>
          <button nz-button (click)="selectAllPages()">
            <span nz-icon nzType="check-square"></span>
            全選
          </button>
        </div>
      </nz-card>
    </div>

    <!-- Processing Section -->
    <div *ngIf="isProcessing" class="processing-section">
      <nz-card nzSize="small">
        <div class="text-center">
          <nz-spin nzSize="large" [nzTip]="processingTip">
            <div class="processing-content">
              <span nz-icon nzType="file-text" nzTheme="outline" class="processing-icon"></span>
              <p>正在處理您的 PDF 文件...</p>
              <p class="processing-detail">{{ processingTip }}</p>
            </div>
          </nz-spin>
        </div>
      </nz-card>
    </div>

    <!-- Results Section -->
    <div *ngIf="extractedText && !isProcessing" class="results-section">
      <nz-card nzSize="small" nzTitle="提取結果">
        <div class="extracted-text-container">
          <nz-typography>
            <pre nz-typography nzCopyable [nzContent]="extractedText" class="extracted-text">{{ extractedText }}</pre>
          </nz-typography>
        </div>
        <nz-divider></nz-divider>
        <div class="result-actions">
          <button nz-button nzType="primary" (click)="downloadText()">
            <span nz-icon nzType="download"></span>
            下載文字
          </button>
          <button nz-button (click)="reset()" class="ml-2">
            <span nz-icon nzType="reload"></span>
            重新開始
          </button>
        </div>
      </nz-card>
    </div>

    <!-- Error Section -->
    <div *ngIf="errorMessage && !isProcessing" class="error-section">
      <nz-result nzStatus="error" nzTitle="處理失敗" [nzSubTitle]="errorMessage">
        <div nz-result-extra>
          <button nz-button nzType="primary" (click)="reset()">重試</button>
        </div>
      </nz-result>
    </div>
  </div>
</nz-card>

<ng-template #extraTemplate>
  <button nz-button nzType="link" (click)="showHelp()">
    <span nz-icon nzType="question-circle"></span>
    說明
  </button>
</ng-template>
