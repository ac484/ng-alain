import{h as Et,l as Gt}from"./chunk-WJU6MFAW.js";import{a as Pe,b as Ye,c as Ae}from"./chunk-CLP47KK6.js";import"./chunk-IHCGOK5I.js";import"./chunk-V6WIK557.js";import"./chunk-4UUXU2YI.js";import{a as qt,b as Wt,c as jt}from"./chunk-UYXFCDCY.js";import{ha as Ft,la as wt,oa as Je,pa as Tt,ta as Bt}from"./chunk-KTLCGEID.js";import{n as M,s as Ct,u as yt,v as Nt,w as bt,x as St,y as Mt,z as Dt}from"./chunk-LZHHB3SB.js";import{u as vt}from"./chunk-SIZM2XL7.js";import"./chunk-2DVOMO4J.js";import{b as Ie,c as xe,d as Re,e as Ot}from"./chunk-WEMTSO3C.js";import"./chunk-TF23B7B6.js";import{a as Le,b as Oe}from"./chunk-JEGYFCNI.js";import"./chunk-DIDUPPIN.js";import{B as Ee,u as Be,y as K}from"./chunk-RQ4F7AJ3.js";import"./chunk-LI7UBDJM.js";import"./chunk-IZSVHWVC.js";import{a as x,b as R,c as L,d as Lt,e as O}from"./chunk-D5PHB2FG.js";import"./chunk-J7YN77AB.js";import{c as ke,e as _e}from"./chunk-MFG6XL3Q.js";import{f as A,h as q,k}from"./chunk-OETAK3GR.js";import{b as kt,d as _t}from"./chunk-QI74WDX5.js";import"./chunk-VX6VXK6P.js";import"./chunk-JYBAKELG.js";import"./chunk-DNAKBF6E.js";import"./chunk-GXVUYNK4.js";import{A as P,d as D,e as c,g as F,h as w,j as Pt,l as At,n as T,q as B,t as E,y as G}from"./chunk-BQVMEIZ5.js";import{a as Vt,c as Ut}from"./chunk-EJPHIAHG.js";import{g as ft,i as gt,j as zt,k as ht}from"./chunk-6SLSOK3G.js";import"./chunk-ZEZPGFWG.js";import{a as It,b as xt}from"./chunk-PUGKNFED.js";import{a as _,b as I,c as Rt}from"./chunk-FKZEB7ER.js";import{d as N}from"./chunk-3UXJQ3KI.js";import"./chunk-SUWO6CW6.js";import"./chunk-6W2MZKTD.js";import{i as dt,m as v,n as $}from"./chunk-EXZNONST.js";import"./chunk-FWGM4PSC.js";import"./chunk-L6VFZVUC.js";import"./chunk-5G6BXQUB.js";import{a as z,b as C,d as y,e as h}from"./chunk-L3XAXJTY.js";import"./chunk-PV63DGP2.js";import"./chunk-EOTHDIY5.js";import"./chunk-TWOZTKVL.js";import"./chunk-27W33B5M.js";import"./chunk-VF6IKWU5.js";import{Bc as lt,Cb as Me,Dc as pt,Eb as De,Hc as d,Ic as g,Jb as m,Jc as ut,Jh as ee,Kb as o,Kh as te,Lb as r,Lc as ct,Mb as l,Pd as Te,Qb as it,R as Ne,Rb as ot,Tb as rt,Wb as f,Za as a,Zb as Z,cb as tt,cd as we,hc as nt,jb as p,jc as Fe,mc as u,nc as W,oa as n,oc as j,pb as be,q as Xe,rb as Se,rc as at,sc as st,tc as mt,ua as $e,va as et,w as Ze}from"./chunk-BJGZKRME.js";import"./chunk-PMZOYKO3.js";import{a as Ke,i as b}from"./chunk-57BLH6QZ.js";var ie=class ie{constructor(){this.router=n(v);this.route=n(dt);this.auth=n(M);this.firestore=n(wt);this.socialService=n(Ye);this.settingsSrv=n(Be);this.tokenService=n(Pe);this.reuseTabService=n(Ot,{optional:!0});this.startupSrv=n(Et);this.message=n(N);this.type="";this.isProcessing=!1}ngOnInit(){this.route.params.subscribe(t=>{this.type=t.type||"",this.handleCallback()})}handleCallback(){this.isProcessing||(this.type==="firebase"?this.handleFirebaseAuthCallback():this.handleSocialCallback())}handleSocialCallback(){this.isProcessing=!0,this.socialService.callback().subscribe(t=>{t?(this.settingsSrv.setUser(t),this.reuseTabService?.clear(),this.router.navigateByUrl("/"),this.message.success("\u767B\u5165\u6210\u529F\uFF01")):(this.message.error("\u767B\u5165\u5931\u6557"),this.router.navigateByUrl("/passport/login")),this.isProcessing=!1},t=>{console.error("\u7B2C\u4E09\u65B9\u767B\u5165\u56DE\u8ABF\u5931\u6557:",t),this.message.error("\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),this.router.navigateByUrl("/passport/login"),this.isProcessing=!1})}handleFirebaseAuthCallback(){this.isProcessing=!0,new Promise(t=>{let e=yt(this.auth,i=>{e(),t(i)})}).then(t=>b(this,null,function*(){if(t)try{yield this.saveUserToFirestore(t);let e=yield this.getUserProfile(t.uid).toPromise(),i={token:t.uid,name:e?.displayName||t.displayName||t.email||"Anonymous",email:t.email||"",id:t.uid,time:+new Date,role:e?.role||"user",permissions:e?.permissions||["dashboard"],expired:+new Date+1e3*60*60*24*7};this.settingsSrv.setUser(Ke(Ke({},this.settingsSrv.user),i)),this.socialService.callback(i),console.log("Firebase Auth \u56DE\u8ABF\u6210\u529F\uFF0C\u8A2D\u5B9A\u7528\u6236\u8CC7\u8A0A:",i),this.message.success("\u767B\u5165\u6210\u529F\uFF01")}catch(e){console.error("Firebase Auth \u56DE\u8ABF\u8655\u7406\u5931\u6557:",e),this.message.error("\u767B\u5165\u8655\u7406\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),this.router.navigateByUrl("/passport/login")}else console.log("Firebase Auth \u56DE\u8ABF\uFF1A\u7121\u7528\u6236\u72C0\u614B"),this.router.navigateByUrl("/passport/login");this.isProcessing=!1}))}saveUserToFirestore(t){return b(this,null,function*(){let e=Je(this.firestore,"acl_users",t.uid),i=Ft(),s={uid:t.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,emailVerified:t.emailVerified,roles:["user"],permissions:["dashboard"],lastLoginAt:i,updatedAt:i,loginMethod:this.determineLoginMethod(t),isActive:!0};yield Bt(e,s,{merge:!0})})}getUserProfile(t){let e=Je(this.firestore,"acl_users",t);return Xe(Tt(e)).pipe(Ze(i=>{if(i.exists()){let s=i.data();return{uid:s.uid,email:s.email,displayName:s.displayName,photoURL:s.photoURL,emailVerified:s.emailVerified,role:s.roles?.[0]||"user",permissions:s.permissions||["dashboard"],createdAt:s.createdAt,updatedAt:s.updatedAt,lastLoginAt:s.lastLoginAt,loginMethod:s.loginMethod,isActive:s.isActive}}return null}))}determineLoginMethod(t){return t.isAnonymous?"anonymous":t.providerData.some(e=>e.providerId==="google.com")?"google":"email"}};ie.\u0275fac=function(e){return new(e||ie)},ie.\u0275cmp=p({type:ie,selectors:[["app-callback"]],inputs:{type:"type"},features:[lt([Ye])],decls:2,vars:0,consts:[[1,"callback-loading"],["nzSize","large","nzTip","\u8655\u7406\u767B\u5165\u4E2D..."]],template:function(e,i){e&1&&(o(0,"div",0),l(1,"nz-spin",1),r())},dependencies:[xt,It],styles:[".callback-loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh}"]});var Ve=ie;var oe=class oe{constructor(){this.tokenService=n(Pe);this.settings=n(Be);this.router=n(v);this.f=new Pt({password:new At("",{nonNullable:!0,validators:[c.required]})})}get user(){return this.settings.user}submit(){this.f.controls.password.markAsDirty(),this.f.controls.password.updateValueAndValidity(),this.f.valid&&(console.log("Valid!"),console.log(this.f.value),this.tokenService.set({token:"123"}),this.router.navigate(["dashboard"]))}};oe.\u0275fac=function(e){return new(e||oe)},oe.\u0275cmp=p({type:oe,selectors:[["passport-lock"]],decls:15,vars:11,consts:[[1,"ant-card","width-lg",2,"margin","0 auto"],[1,"ant-card-body"],[1,"avatar"],["nzIcon","user","nzSize","large",3,"nzSrc"],["nz-form","","role","form",1,"mt-md",3,"ngSubmit","formGroup"],[3,"nzErrorTip"],["nzSuffixIcon","lock"],["type","password","nz-input","","formControlName","password"],["nz-row","","nzType","flex","nzAlign","middle"],["nz-col","",2,"text-align","right",3,"nzOffset","nzSpan"],["nz-button","","nzType","primary",3,"disabled"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),l(3,"nz-avatar",3),r(),o(4,"form",4),f("ngSubmit",function(){return i.submit()}),o(5,"nz-form-item")(6,"nz-form-control",5),d(7,"i18n"),o(8,"nz-input-group",6),l(9,"input",7),r()()(),o(10,"div",8)(11,"div",9)(12,"button",10),u(13),d(14,"i18n"),r()()()()()()),e&2&&(a(3),m("nzSrc",i.user.avatar),a(),m("formGroup",i.f),a(2),m("nzErrorTip",g(7,7,"validation.password.required")),a(5),m("nzOffset",12)("nzSpan",12),a(),m("disabled",!i.f.valid),a(),W(g(14,9,"app.lock")))},dependencies:[P,T,D,F,w,B,E,Ut,Vt,O,I,_,R,x,L,Rt,h,y,z,C,k,A,q,K],styles:["[_nghost-%COMP%]     .ant-card-body{position:relative;margin-top:80px}[_nghost-%COMP%]     .avatar{position:absolute;top:-20px;left:50%;margin-left:-20px}"]});var Ue=oe;var ae=class ae{constructor(){this.router=n(v);this.message=n(N);this.auth=n(M);this.loading=!1}loginAnonymously(){return b(this,null,function*(){this.loading=!0;try{yield St(this.auth),this.router.navigateByUrl("/passport/callback/firebase")}catch(t){console.error("\u533F\u540D\u767B\u5165\u5931\u6557:",t),this.message.error("\u533F\u540D\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};ae.\u0275fac=function(e){return new(e||ae)},ae.\u0275cmp=p({type:ae,selectors:[["app-anonymous-login"]],decls:1,vars:2,consts:[["nz-tooltip","","nzTooltipTitle","\u533F\u540D\u767B\u5165","nz-icon","","nzType","user",1,"icon",3,"click"]],template:function(e,i){e&1&&(o(0,"i",0),f("click",function(){return i.loginAnonymously()}),r()),e&2&&Fe("loading",i.loading)},dependencies:[h,z,te,ee,_e,ke],styles:[".icon[_ngcontent-%COMP%]{font-size:24px;color:#666;cursor:pointer;transition:color .3s}.icon[_ngcontent-%COMP%]:hover{color:#1890ff}.icon.loading[_ngcontent-%COMP%]{color:#d9d9d9;cursor:not-allowed}"]});var Ge=ae;var se=class se{constructor(){this.router=n(v);this.message=n(N);this.auth=n(M);this.fb=n(G);this.loading=!1;this.loginForm=this.fb.nonNullable.group({email:["",[c.required,c.email]],password:["",[c.required,c.minLength(6)]]})}onSubmit(){return b(this,null,function*(){if(this.loginForm.invalid)return;this.loading=!0;let{email:t,password:e}=this.loginForm.value;try{yield Mt(this.auth,t,e),this.router.navigateByUrl("/passport/callback/firebase")}catch(i){console.error("\u90F5\u7BB1\u767B\u5165\u5931\u6557:",i);let s="\u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";i.code==="auth/user-not-found"?s="\u7528\u6236\u4E0D\u5B58\u5728":i.code==="auth/wrong-password"?s="\u5BC6\u78BC\u932F\u8AA4":i.code==="auth/invalid-email"&&(s="\u90F5\u7BB1\u683C\u5F0F\u7121\u6548"),this.message.error(s)}finally{this.loading=!1}})}};se.\u0275fac=function(e){return new(e||se)},se.\u0275cmp=p({type:se,selectors:[["app-email-login-form"]],decls:15,vars:9,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","",3,"nzSpan"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740",3,"nzSpan"],["nz-input","","formControlName","email","placeholder","\u8ACB\u8F38\u5165\u90F5\u7BB1\u5730\u5740"],["nzErrorTip","\u8ACB\u8F38\u5165\u5BC6\u78BC",3,"nzSpan"],["nz-input","","type","password","formControlName","password","placeholder","\u8ACB\u8F38\u5165\u5BC6\u78BC"],[3,"nzOffset","nzSpan"],["nz-button","","nzType","primary",3,"nzLoading","disabled"]],template:function(e,i){e&1&&(o(0,"form",0),f("ngSubmit",function(){return i.onSubmit()}),o(1,"nz-form-item")(2,"nz-form-label",1),u(3,"\u90F5\u7BB1"),r(),o(4,"nz-form-control",2),l(5,"input",3),r()(),o(6,"nz-form-item")(7,"nz-form-label",1),u(8,"\u5BC6\u78BC"),r(),o(9,"nz-form-control",4),l(10,"input",5),r()(),o(11,"nz-form-item")(12,"nz-form-control",6)(13,"button",7),u(14," \u767B\u5165 "),r()()()()),e&2&&(m("formGroup",i.loginForm),a(2),m("nzSpan",6),a(2),m("nzSpan",18),a(3),m("nzSpan",6),a(2),m("nzSpan",18),a(3),m("nzOffset",6)("nzSpan",18),a(),m("nzLoading",i.loading)("disabled",i.loginForm.invalid))},dependencies:[P,T,D,F,w,B,E,O,I,_,R,x,Lt,L,k,A,h,y,z,C],encapsulation:2});var J=se;var me=class me{constructor(){this.message=n(N);this.auth=n(M);this.fb=n(G);this.registerSuccess=new Se;this.loading=!1;this.registerForm=this.fb.nonNullable.group({email:["",[c.required,c.email]],password:["",[c.required,c.minLength(6)]],confirmPassword:["",[c.required]]},{validators:this.passwordMatchValidator})}passwordMatchValidator(t){let e=t.get("password"),i=t.get("confirmPassword");return e&&i&&e.value!==i.value?{passwordMismatch:!0}:null}register(){return b(this,null,function*(){if(this.registerForm.invalid){this.markFormGroupTouched(this.registerForm);return}this.loading=!0;let{email:t,password:e}=this.registerForm.value;try{let s=(yield Ct(this.auth,t,e)).user;yield Nt(s),this.message.success("\u90F5\u7BB1\u8A3B\u518A\u6210\u529F\uFF01\u8ACB\u6AA2\u67E5\u90F5\u7BB1\u9032\u884C\u9A57\u8B49\u3002"),this.registerSuccess.emit()}catch(i){console.error("\u8A3B\u518A\u5931\u6557:",i),this.message.error(this.getErrorMessage(i.code))}finally{this.loading=!1}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let i=t.controls[e];i.markAsTouched(),i.controls&&this.markFormGroupTouched(i)})}getErrorMessage(t){switch(t){case"auth/email-already-in-use":return"\u90F5\u7BB1\u5DF2\u88AB\u4F7F\u7528";case"auth/weak-password":return"\u5BC6\u78BC\u5F37\u5EA6\u592A\u5F31";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u8A3B\u518A\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};me.\u0275fac=function(e){return new(e||me)},me.\u0275cmp=p({type:me,selectors:[["app-email-register-form"]],outputs:{registerSuccess:"registerSuccess"},decls:16,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nzErrorTip","\u5BC6\u78BC\u81F3\u5C116\u4F4D"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","\u5BC6\u78BC"],["nzErrorTip","\u8ACB\u78BA\u8A8D\u5BC6\u78BC"],["nz-input","","type","password","formControlName","confirmPassword","placeholder","\u78BA\u8A8D\u5BC6\u78BC"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,i){e&1&&(o(0,"form",0),f("ngSubmit",function(){return i.register()}),o(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),l(4,"input",3),r()()(),o(5,"nz-form-item")(6,"nz-form-control",4)(7,"nz-input-group",5),l(8,"input",6),r()()(),o(9,"nz-form-item")(10,"nz-form-control",7)(11,"nz-input-group",5),l(12,"input",8),r()()(),o(13,"nz-form-item")(14,"button",9),u(15," \u8A3B\u518A "),r()()()),e&2&&(m("formGroup",i.registerForm),a(14),m("nzLoading",i.loading))},dependencies:[P,T,D,F,w,B,E,O,I,_,R,x,L,k,A,q,h,y,z,C],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var Q=me;var le=class le{constructor(){this.message=n(N);this.auth=n(M);this.fb=n(G);this.resetSuccess=new Se;this.loading=!1;this.resetForm=this.fb.nonNullable.group({email:["",[c.required,c.email]]})}resetPassword(){return b(this,null,function*(){if(this.resetForm.invalid){this.markFormGroupTouched(this.resetForm);return}this.loading=!0;let{email:t}=this.resetForm.value;try{yield bt(this.auth,t),this.message.success("\u5BC6\u78BC\u91CD\u7F6E\u90F5\u7BB1\u5DF2\u767C\u9001\uFF0C\u8ACB\u6AA2\u67E5\u90F5\u7BB1\u3002"),this.resetSuccess.emit()}catch(e){console.error("\u767C\u9001\u91CD\u7F6E\u90F5\u7BB1\u5931\u6557:",e),this.message.error(this.getErrorMessage(e.code))}finally{this.loading=!1}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let i=t.controls[e];i.markAsTouched(),i.controls&&this.markFormGroupTouched(i)})}getErrorMessage(t){switch(t){case"auth/user-not-found":return"\u7528\u6236\u4E0D\u5B58\u5728";case"auth/invalid-email":return"\u90F5\u7BB1\u683C\u5F0F\u7121\u6548";case"auth/too-many-requests":return"\u8ACB\u6C42\u904E\u65BC\u983B\u7E41\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66";default:return"\u767C\u9001\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"}}};le.\u0275fac=function(e){return new(e||le)},le.\u0275cmp=p({type:le,selectors:[["app-email-reset-form"]],outputs:{resetSuccess:"resetSuccess"},decls:8,vars:2,consts:[["nz-form","",3,"ngSubmit","formGroup"],["nzErrorTip","\u8ACB\u8F38\u5165\u6709\u6548\u7684\u90F5\u7BB1\u5730\u5740"],["nzSize","large","nzPrefixIcon","mail"],["nz-input","","formControlName","email","placeholder","\u90F5\u7BB1\u5730\u5740"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"]],template:function(e,i){e&1&&(o(0,"form",0),f("ngSubmit",function(){return i.resetPassword()}),o(1,"nz-form-item")(2,"nz-form-control",1)(3,"nz-input-group",2),l(4,"input",3),r()()(),o(5,"nz-form-item")(6,"button",4),u(7," \u767C\u9001\u91CD\u7F6E\u90F5\u7BB1 "),r()()()),e&2&&(m("formGroup",i.resetForm),a(6),m("nzLoading",i.loading))},dependencies:[P,T,D,F,w,B,E,O,I,_,R,x,L,k,A,q,h,y,z,C],styles:["nz-form-item[_ngcontent-%COMP%]{margin-bottom:16px}"]});var X=le;function Qt(S,t){S&1&&(it(0),o(1,"nz-tabset")(2,"nz-tab",3),l(3,"app-email-login-form"),r(),o(4,"nz-tab",4),l(5,"app-email-register-form"),r(),o(6,"nz-tab",5),l(7,"app-email-reset-form"),r()(),ot())}var pe=class pe{constructor(){this.isVisible=!1}showModal(){this.isVisible=!0}handleCancel(){this.isVisible=!1}};pe.\u0275fac=function(e){return new(e||pe)},pe.\u0275cmp=p({type:pe,selectors:[["app-email-login"]],decls:3,vars:2,consts:[["nz-icon","","nzType","mail","nzTheme","outline",1,"icon",3,"click"],["nzTitle","\u90F5\u7BB1\u767B\u5165",3,"nzVisibleChange","nzOnCancel","nzVisible","nzFooter"],[4,"nzModalContent"],["nzTitle","\u767B\u5165"],["nzTitle","\u8A3B\u518A"],["nzTitle","\u91CD\u8A2D\u5BC6\u78BC"]],template:function(e,i){e&1&&(o(0,"i",0),f("click",function(){return i.showModal()}),r(),o(1,"nz-modal",1),mt("nzVisibleChange",function(Y){return st(i.isVisible,Y)||(i.isVisible=Y),Y}),f("nzOnCancel",function(){return i.handleCancel()}),be(2,Qt,8,0,"ng-container",2),r()),e&2&&(a(),at("nzVisible",i.isVisible),m("nzFooter",null))},dependencies:[h,z,te,ee,ht,zt,gt,Re,xe,Ie,J,Q,X],encapsulation:2});var ye=pe;var ue=class ue{constructor(t){this.modalRef=t}closeModal(){this.modalRef.close()}};ue.\u0275fac=function(e){return new(e||ue)(tt(ft))},ue.\u0275cmp=p({type:ue,selectors:[["app-email-login-modal"]],decls:7,vars:0,consts:[["nzTitle","\u767B\u5165"],["nzTitle","\u8A3B\u518A"],["nzTitle","\u91CD\u8A2D\u5BC6\u78BC"]],template:function(e,i){e&1&&(o(0,"nz-tabset")(1,"nz-tab",0),l(2,"app-email-login-form"),r(),o(3,"nz-tab",1),l(4,"app-email-register-form"),r(),o(5,"nz-tab",2),l(6,"app-email-reset-form"),r()())},dependencies:[Re,xe,Ie,J,Q,X],encapsulation:2});var Qe=ue;var ce=class ce{constructor(){this.router=n(v);this.message=n(N);this.auth=n(M);this.loading=!1}loginWithGoogle(){return b(this,null,function*(){this.loading=!0;try{let t=new vt;yield Dt(this.auth,t),this.router.navigateByUrl("/passport/callback/firebase")}catch(t){console.error("Google \u767B\u5165\u5931\u6557:",t),this.message.error("Google \u767B\u5165\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66")}finally{this.loading=!1}})}};ce.\u0275fac=function(e){return new(e||ce)},ce.\u0275cmp=p({type:ce,selectors:[["app-google-auth"]],decls:1,vars:2,consts:[["nz-tooltip","","nzTooltipTitle","Google \u767B\u5165","nz-icon","","nzType","google",1,"icon",3,"click"]],template:function(e,i){e&1&&(o(0,"i",0),f("click",function(){return i.loginWithGoogle()}),r()),e&2&&Fe("loading",i.loading)},dependencies:[h,z,te,ee,_e,ke],styles:[".icon[_ngcontent-%COMP%]{font-size:24px;color:#666;cursor:pointer;transition:color .3s}.icon[_ngcontent-%COMP%]:hover{color:#1890ff}.icon.loading[_ngcontent-%COMP%]{color:#d9d9d9;cursor:not-allowed}"]});var qe=ce;function Zt(S,t){if(S&1&&l(0,"nz-alert",1),S&2){let e=Z();m("nzType","error")("nzMessage",e.error)("nzShowIcon",!0)}}var de=class de{constructor(){this.router=n(v);this.http=n(Ee);this.cdr=n(we);this.form=n(G).nonNullable.group({userName:["",[]],password:["",[]],remember:[!0]});this.error="";this.loading=!1}submit(){this.error="";let{userName:t,password:e}=this.form.controls;t.markAsDirty(),t.updateValueAndValidity(),e.markAsDirty(),e.updateValueAndValidity(),!(t.invalid||e.invalid)&&(this.loading=!0,this.cdr.detectChanges(),this.http.post("/login/account",{userName:this.form.value.userName,password:this.form.value.password},null,{context:new Te().set(Ae,!0)}).pipe(Ne(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(i=>{if(i.msg!=="ok"){this.error=i.msg,this.cdr.detectChanges();return}i.user.expired=+new Date+1e3*60*5;let s="/";s.includes("/passport")&&(s="/"),this.router.navigateByUrl(s)}))}ngOnDestroy(){}};de.\u0275fac=function(e){return new(e||de)},de.\u0275cmp=p({type:de,selectors:[["app-login"]],decls:32,vars:20,consts:[["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],["nzErrorTip","Please enter mobile number, muse be: admin or user"],["nzSize","large","nzPrefixIcon","user"],["nz-input","","formControlName","userName","placeholder","username: admin or user"],["nzErrorTip","Please enter password, muse be: ng-alain.com"],["nzSize","large","nzPrefixIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","password: ng-alain.com"],[3,"nzSpan"],["nz-checkbox","","formControlName","remember"],[1,"text-right",3,"nzSpan"],["routerLink","/passport/register",1,"forgot"],["nz-button","","type","submit","nzType","primary","nzSize","large","nzBlock","",3,"nzLoading"],[1,"other"],["routerLink","/passport/register",1,"register"]],template:function(e,i){e&1&&(o(0,"form",0),f("ngSubmit",function(){return i.submit()}),Me(1,Zt,1,3,"nz-alert",1),o(2,"nz-form-item")(3,"nz-form-control",2)(4,"nz-input-group",3),l(5,"input",4),r()()(),o(6,"nz-form-item")(7,"nz-form-control",5)(8,"nz-input-group",6),l(9,"input",7),r()()(),o(10,"nz-form-item")(11,"nz-col",8)(12,"label",9),u(13),d(14,"i18n"),r()(),o(15,"nz-col",10)(16,"a",11),u(17),d(18,"i18n"),r()()(),o(19,"nz-form-item")(20,"button",12),u(21),d(22,"i18n"),r()()(),o(23,"div",13),u(24),d(25,"i18n"),l(26,"app-google-auth")(27,"app-anonymous-login")(28,"app-email-login"),o(29,"a",14),u(30),d(31,"i18n"),r()()),e&2&&(m("formGroup",i.form),a(),De(i.error?1:-1),a(10),m("nzSpan",12),a(2),W(g(14,10,"app.login.remember-me")),a(2),m("nzSpan",12),a(2),W(g(18,12,"app.login.forgot-password")),a(3),m("nzLoading",i.loading),a(),j(" ",g(22,14,"app.login.login")," "),a(3),j(" ",g(25,16,"app.login.sign-in-with")," "),a(6),W(g(31,18,"app.login.signup")))},dependencies:[$,P,T,D,F,w,B,E,_t,kt,Oe,Le,O,I,_,R,x,L,k,A,q,h,y,z,C,Ge,ye,qe,K],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     .ant-input-affix-wrapper .ant-input:not(:first-child){padding-left:4px}[_nghost-%COMP%]     .icon{cursor:pointer;margin-left:16px;font-size:24px;color:#0003;vertical-align:middle;transition:color .3s}[_nghost-%COMP%]     .icon:hover{color:#1890ff}[_nghost-%COMP%]     app-anonymous-login, [_nghost-%COMP%]     app-email-login, [_nghost-%COMP%]     app-logout{margin-left:16px;display:inline-block;vertical-align:middle}[_nghost-%COMP%]     .other{margin-top:24px;line-height:22px;text-align:left}[_nghost-%COMP%]     .other nz-tooltip{vertical-align:middle}[_nghost-%COMP%]     .other .register{float:right}[data-theme=dark]   [_nghost-%COMP%]     .icon{color:#fff3}[data-theme=dark]   [_nghost-%COMP%]     .icon:hover{color:#fff}"]});var We=de;function $t(S,t){if(S&1&&l(0,"nz-alert",1),S&2){let e=Z();m("nzType","error")("nzMessage",e.error)("nzShowIcon",!0)}}var fe=class fe{constructor(){this.router=n(v);this.http=n(Ee);this.cdr=n(we);this.form=n(G).nonNullable.group({email:["",[c.required,c.email]],password:["",[c.required,c.minLength(6)]],confirm:["",[c.required]],userName:["",[c.required]]});this.error="";this.loading=!1}submit(){this.error="";let{email:t,password:e,confirm:i,userName:s}=this.form.controls;if(t.markAsDirty(),t.updateValueAndValidity(),e.markAsDirty(),e.updateValueAndValidity(),i.markAsDirty(),i.updateValueAndValidity(),s.markAsDirty(),s.updateValueAndValidity(),!(t.invalid||e.invalid||i.invalid||s.invalid)){if(e.value!==i.value){this.error="\u5BC6\u78BC\u78BA\u8A8D\u4E0D\u5339\u914D";return}this.loading=!0,this.cdr.detectChanges(),this.http.post("/register",{email:this.form.value.email,password:this.form.value.password,userName:this.form.value.userName},null,{context:new Te().set(Ae,!0)}).pipe(Ne(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(Y=>{if(Y.msg!=="ok"){this.error=Y.msg,this.cdr.detectChanges();return}this.router.navigateByUrl("/passport/register-result")})}}ngOnDestroy(){}};fe.\u0275fac=function(e){return new(e||fe)},fe.\u0275cmp=p({type:fe,selectors:[["app-register"]],decls:32,vars:24,consts:[["nz-form","","role","form",3,"ngSubmit","formGroup"],[1,"mb-lg",3,"nzType","nzMessage","nzShowIcon"],[3,"nzErrorTip"],["nzSize","large","nzAddonBeforeIcon","user"],["nz-input","","formControlName","email","placeholder","Email"],["nz-input","","formControlName","userName","placeholder","Username"],["nzSize","large","nzAddonBeforeIcon","lock"],["nz-input","","type","password","formControlName","password","placeholder","Password"],["nz-input","","type","password","formControlName","confirm","placeholder","Confirm Password"],["nz-button","","nzType","primary","nzSize","large","type","submit",1,"submit",3,"nzLoading"],["routerLink","/passport/login",1,"login"]],template:function(e,i){e&1&&(o(0,"h3"),u(1),d(2,"i18n"),r(),o(3,"form",0),f("ngSubmit",function(){return i.submit()}),Me(4,$t,1,3,"nz-alert",1),o(5,"nz-form-item")(6,"nz-form-control",2),d(7,"i18n"),o(8,"nz-input-group",3),l(9,"input",4),r()()(),o(10,"nz-form-item")(11,"nz-form-control",2),d(12,"i18n"),o(13,"nz-input-group",3),l(14,"input",5),r()()(),o(15,"nz-form-item")(16,"nz-form-control",2),d(17,"i18n"),o(18,"nz-input-group",6),l(19,"input",7),r()()(),o(20,"nz-form-item")(21,"nz-form-control",2),d(22,"i18n"),o(23,"nz-input-group",6),l(24,"input",8),r()()(),o(25,"nz-form-item")(26,"button",9),u(27),d(28,"i18n"),r(),o(29,"a",10),u(30),d(31,"i18n"),r()()()),e&2&&(a(),W(g(2,10,"app.register.register")),a(2),m("formGroup",i.form),a(),De(i.error?4:-1),a(2),m("nzErrorTip",g(7,12,"validation.email.required")),a(5),m("nzErrorTip",g(12,14,"validation.userName.required")),a(5),m("nzErrorTip",g(17,16,"validation.password.required")),a(5),m("nzErrorTip",g(22,18,"validation.confirm-password.required")),a(5),m("nzLoading",i.loading),a(),j(" ",g(28,20,"app.register.register")," "),a(3),W(g(31,22,"app.register.sign-in")))},dependencies:[P,T,D,F,w,B,E,$,Oe,Le,O,I,_,R,x,L,k,A,q,h,y,z,C,K],styles:["[_nghost-%COMP%]{display:block;width:368px;margin:0 auto}[_nghost-%COMP%]     h3{margin-bottom:20px;font-size:16px}[_nghost-%COMP%]     .submit{width:50%}[_nghost-%COMP%]     .login{float:right;line-height:40px}  .register-password-cdk .success,   .register-password-cdk .warning,   .register-password-cdk .error{transition:color .3s}  .register-password-cdk .success{color:#52c41a}  .register-password-cdk .warning{color:#faad14}  .register-password-cdk .error{color:#ff4d4f}  .register-password-cdk .progress-pass>.progress .ant-progress-bg{background-color:#faad14}"]});var je=fe;var ei=S=>({email:S});function ti(S,t){if(S&1&&(o(0,"div",5),u(1),d(2,"i18n"),r()),S&2){let e=Z();a(),j(" ",ut(2,1,"app.register-result.msg",pt(4,ei,e.email))," ")}}var ge=class ge{constructor(){this.msg=n(N);this.email=""}};ge.\u0275fac=function(e){return new(e||ge)},ge.\u0275cmp=p({type:ge,selectors:[["passport-register-result"]],inputs:{email:"email"},decls:11,vars:11,consts:[["title",""],["nzStatus","success",3,"nzTitle","nzSubTitle"],["nz-result-extra",""],["nz-button","","nzSize","large",3,"click","nzType"],["routerLink","/","nz-button","","nzSize","large"],[1,"title",2,"font-size","20px"]],template:function(e,i){if(e&1){let s=rt();o(0,"nz-result",1),d(1,"i18n"),be(2,ti,3,6,"ng-template",null,0,ct),o(4,"div",2)(5,"button",3),f("click",function(){return $e(s),et(i.msg.success("email"))}),u(6),d(7,"i18n"),r(),o(8,"button",4),u(9),d(10,"i18n"),r()()()}if(e&2){let s=nt(3);m("nzTitle",s)("nzSubTitle",g(1,5,"app.register-result.activation-email")),a(5),m("nzType","primary"),a(),j(" ",g(7,7,"app.register-result.view-mailbox")," "),a(3),j(" ",g(10,9,"app.register-result.back-home")," ")}},dependencies:[$,h,y,z,C,jt,Wt,qt,K],encapsulation:2});var He=ge;var Zr=[{path:"passport",component:Gt,children:[{path:"login",component:We,data:{title:"\u767B\u5F55",titleI18n:"app.login.login"}},{path:"register",component:je,data:{title:"\u6CE8\u518C",titleI18n:"app.register.register"}},{path:"register-result",component:He,data:{title:"\u6CE8\u518C\u7ED3\u679C",titleI18n:"app.register.register"}},{path:"lock",component:Ue,data:{title:"\u9501\u5C4F",titleI18n:"app.lock"}}]},{path:"passport/callback/:type",component:Ve}];export{Zr as routes};
