import{I as Pc}from"./chunk-57QRFGKS.js";import{a as lt,b as $s,h as C}from"./chunk-HN2SGUN4.js";var Cc=()=>{};var xc=function(n){let t=[],e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Kh=function(n){let t=[],e=0,r=0;for(;e<n.length;){let s=n[e++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){let o=n[e++];t[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){let o=n[e++],c=n[e++],l=n[e++],h=((s&7)<<18|(o&63)<<12|(c&63)<<6|l&63)-65536;t[r++]=String.fromCharCode(55296+(h>>10)),t[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[e++],c=n[e++];t[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|c&63)}}return t.join("")},Nc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){let o=n[s],c=s+1<n.length,l=c?n[s+1]:0,h=s+2<n.length,f=h?n[s+2]:0,g=o>>2,T=(o&3)<<4|l>>4,E=(l&15)<<2|f>>6,R=f&63;h||(R=64,c||(E=64)),r.push(e[g],e[T],e[E],e[R])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(xc(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Kh(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){let o=e[n.charAt(s++)],l=s<n.length?e[n.charAt(s)]:0;++s;let f=s<n.length?e[n.charAt(s)]:64;++s;let T=s<n.length?e[n.charAt(s)]:64;if(++s,o==null||l==null||f==null||T==null)throw new Ks;let E=o<<2|l>>4;if(r.push(E),f!==64){let R=l<<4&240|f>>2;if(r.push(R),T!==64){let x=f<<6&192|T;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Ks=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Qh=function(n){let t=xc(n);return Nc.encodeByteArray(t,!0)},Pn=function(n){return Qh(n).replace(/\./g,"")},kc=function(n){try{return Nc.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Oc(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Hh=()=>Oc().__FIREBASE_DEFAULTS__,Wh=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Jh=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=n&&kc(n[1]);return t&&JSON.parse(t)},Qs=()=>{try{return Cc()||Hh()||Wh()||Jh()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Xh=n=>Qs()?.emulatorHosts?.[n],Mc=n=>{let t=Xh(n);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},Hs=()=>Qs()?.config;var vr=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}};function Tr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function Fc(n){return C(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Lc(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},r=t||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let c=lt({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Pn(JSON.stringify(e)),Pn(JSON.stringify(c)),""].join(".")}var Rn={};function Yh(){let n={prod:[],emulator:[]};for(let t of Object.keys(Rn))Rn[t]?n.emulator.push(t):n.prod.push(t);return n}function Zh(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}var Vc=!1;function Bc(n,t){if(typeof window>"u"||typeof document>"u"||!Tr(window.location.host)||Rn[n]===t||Rn[n]||Vc)return;Rn[n]=t;function e(E){return`__firebase__banner__${E}`}let r="__firebase__banner",o=Yh().prod.length>0;function c(){let E=document.getElementById(r);E&&E.remove()}function l(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function h(E,R){E.setAttribute("width","24"),E.setAttribute("id",R),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function f(){let E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{Vc=!0,c()},E}function g(E,R){E.setAttribute("id",R),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function T(){let E=Zh(r),R=e("text"),x=document.getElementById(R)||document.createElement("span"),O=e("learnmore"),D=document.getElementById(O)||document.createElement("a"),Q=e("preprendIcon"),j=document.getElementById(Q)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){let z=E.element;l(z),g(D,O);let ct=f();h(j,Q),z.append(j,x,D,ct),document.body.appendChild(z)}o?(x.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",T):T()}function Uc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function td(){let n=Qs()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function qc(){return!td()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ws(){try{return typeof indexedDB=="object"}catch{return!1}}function jc(){return new Promise((n,t)=>{try{let e=!0,r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}var ed="FirebaseError",Ut=class n extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=ed,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Cn.prototype.create)}},Cn=class{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){let r=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],c=o?nd(o,r):"Error",l=`${this.serviceName}: ${c} (${s}).`;return new Ut(s,l,r)}};function nd(n,t){return n.replace(rd,(e,r)=>{let s=t[r];return s!=null?String(s):`<${r}?>`})}var rd=/\{\$([^}]+)}/g;function Ce(n,t){if(n===t)return!0;let e=Object.keys(n),r=Object.keys(t);for(let s of e){if(!r.includes(s))return!1;let o=n[s],c=t[s];if(Dc(o)&&Dc(c)){if(!Ce(o,c))return!1}else if(o!==c)return!1}for(let s of r)if(!e.includes(s))return!1;return!0}function Dc(n){return n!==null&&typeof n=="object"}var hp=4*60*60*1e3;function qt(n){return n&&n._delegate?n._delegate:n}var jt=class{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var pe="[DEFAULT]";var Js=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let r=new vr;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:e});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){let e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(id(t))try{this.getOrInitializeService({instanceIdentifier:pe})}catch{}for(let[e,r]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(e);try{let o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(t=pe){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return C(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=pe){return this.instances.has(t)}getOptions(t=pe){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:r,options:e});for(let[o,c]of this.instancesDeferred.entries()){let l=this.normalizeInstanceIdentifier(o);r===l&&c.resolve(s)}return s}onInit(t,e){let r=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(r)??new Set;s.add(t),this.onInitCallbacks.set(r,s);let o=this.instances.get(r);return o&&t(o,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){let r=this.onInitCallbacks.get(e);if(r)for(let s of r)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:sd(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=pe){return this.component?this.component.multipleInstances?t:pe:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function sd(n){return n===pe?void 0:n}function id(n){return n.instantiationMode==="EAGER"}var Ar=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new Js(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var od=[],G=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(G||{}),ad={debug:G.DEBUG,verbose:G.VERBOSE,info:G.INFO,warn:G.WARN,error:G.ERROR,silent:G.SILENT},cd=G.INFO,ud={[G.DEBUG]:"log",[G.VERBOSE]:"log",[G.INFO]:"info",[G.WARN]:"warn",[G.ERROR]:"error"},ld=(n,t,...e)=>{if(t<n.logLevel)return;let r=new Date().toISOString(),s=ud[t];if(s)console[s](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},Ve=class{constructor(t){this.name=t,this._logLevel=cd,this._logHandler=ld,this._userLogHandler=null,od.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in G))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?ad[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,G.DEBUG,...t),this._logHandler(this,G.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,G.VERBOSE,...t),this._logHandler(this,G.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,G.INFO,...t),this._logHandler(this,G.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,G.WARN,...t),this._logHandler(this,G.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,G.ERROR,...t),this._logHandler(this,G.ERROR,...t)}};var Ys=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(hd(e)){let r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}};function hd(n){return n.getComponent()?.type==="VERSION"}var Zs="@firebase/app",zc="0.14.0";var zt=new Ve("@firebase/app"),dd="@firebase/app-compat",fd="@firebase/analytics-compat",md="@firebase/analytics",pd="@firebase/app-check-compat",gd="@firebase/app-check",yd="@firebase/auth",_d="@firebase/auth-compat",wd="@firebase/database",Ed="@firebase/data-connect",Id="@firebase/database-compat",vd="@firebase/functions",Td="@firebase/functions-compat",Ad="@firebase/installations",bd="@firebase/installations-compat",Sd="@firebase/messaging",Rd="@firebase/messaging-compat",Pd="@firebase/performance",Cd="@firebase/performance-compat",Vd="@firebase/remote-config",Dd="@firebase/remote-config-compat",xd="@firebase/storage",Nd="@firebase/storage-compat",kd="@firebase/firestore",Od="@firebase/ai",Md="@firebase/firestore-compat",Fd="firebase",Ld="12.0.0";var ti="[DEFAULT]",Bd={[Zs]:"fire-core",[dd]:"fire-core-compat",[md]:"fire-analytics",[fd]:"fire-analytics-compat",[gd]:"fire-app-check",[pd]:"fire-app-check-compat",[yd]:"fire-auth",[_d]:"fire-auth-compat",[wd]:"fire-rtdb",[Ed]:"fire-data-connect",[Id]:"fire-rtdb-compat",[vd]:"fire-fn",[Td]:"fire-fn-compat",[Ad]:"fire-iid",[bd]:"fire-iid-compat",[Sd]:"fire-fcm",[Rd]:"fire-fcm-compat",[Pd]:"fire-perf",[Cd]:"fire-perf-compat",[Vd]:"fire-rc",[Dd]:"fire-rc-compat",[xd]:"fire-gcs",[Nd]:"fire-gcs-compat",[kd]:"fire-fst",[Md]:"fire-fst-compat",[Od]:"fire-vertex","fire-js":"fire-js",[Fd]:"fire-js-all"};var br=new Map,Ud=new Map,ei=new Map;function Gc(n,t){try{n.container.addComponent(t)}catch(e){zt.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function Vn(n){let t=n.name;if(ei.has(t))return zt.debug(`There were multiple attempts to register component ${t}.`),!1;ei.set(t,n);for(let e of br.values())Gc(e,n);for(let e of Ud.values())Gc(e,n);return!0}function Hc(n,t){let e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Wc(n){return n==null?!1:n.settings!==void 0}var qd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ne=new Cn("app","Firebase",qd);var ni=class{constructor(t,e,r){this._isDeleted=!1,this._options=lt({},t),this._config=lt({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new jt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ne.create("app-deleted",{appName:this._name})}};var Jc=Ld;function jd(n,t={}){let e=n;typeof t!="object"&&(t={name:t});let r=lt({name:ti,automaticDataCollectionEnabled:!0},t),s=r.name;if(typeof s!="string"||!s)throw ne.create("bad-app-name",{appName:String(s)});if(e||(e=Hs()),!e)throw ne.create("no-options");let o=br.get(s);if(o){if(Ce(e,o.options)&&Ce(r,o.config))return o;throw ne.create("duplicate-app",{appName:s})}let c=new Ar(s);for(let h of ei.values())c.addComponent(h);let l=new ni(e,r,c);return br.set(s,l),l}function Xc(n=ti){let t=br.get(n);if(!t&&n===ti&&Hs())return jd();if(!t)throw ne.create("no-app",{appName:n});return t}function De(n,t,e){let r=Bd[n]??n;e&&(r+=`-${e}`);let s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let c=[`Unable to register library "${r}" with version "${t}":`];s&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&c.push("and"),o&&c.push(`version name "${t}" contains illegal characters (whitespace or "/")`),zt.warn(c.join(" "));return}Vn(new jt(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}var zd="firebase-heartbeat-database",Gd=1,Dn="firebase-heartbeat-store",Xs=null;function Yc(){return Xs||(Xs=Pc(zd,Gd,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Dn)}catch(e){console.warn(e)}}}}).catch(n=>{throw ne.create("idb-open",{originalErrorMessage:n.message})})),Xs}function $d(n){return C(this,null,function*(){try{let e=(yield Yc()).transaction(Dn),r=yield e.objectStore(Dn).get(Zc(n));return yield e.done,r}catch(t){if(t instanceof Ut)zt.warn(t.message);else{let e=ne.create("idb-get",{originalErrorMessage:t?.message});zt.warn(e.message)}}})}function $c(n,t){return C(this,null,function*(){try{let r=(yield Yc()).transaction(Dn,"readwrite");yield r.objectStore(Dn).put(t,Zc(n)),yield r.done}catch(e){if(e instanceof Ut)zt.warn(e.message);else{let r=ne.create("idb-set",{originalErrorMessage:e?.message});zt.warn(r.message)}}})}function Zc(n){return`${n.name}!${n.options.appId}`}var Kd=1024,Qd=30,ri=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new si(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return C(this,null,function*(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Kc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>Qd){let s=Wd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){zt.warn(t)}})}getHeartbeatsHeader(){return C(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Kc(),{heartbeatsToSend:e,unsentEntries:r}=Hd(this._heartbeatsCache.heartbeats),s=Pn(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return zt.warn(t),""}})}};function Kc(){return new Date().toISOString().substring(0,10)}function Hd(n,t=Kd){let e=[],r=n.slice();for(let s of n){let o=e.find(c=>c.agent===s.agent);if(o){if(o.dates.push(s.date),Qc(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Qc(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}var si=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return C(this,null,function*(){return Ws()?jc().then(()=>!0).catch(()=>!1):!1})}read(){return C(this,null,function*(){if(yield this._canUseIndexedDBPromise){let e=yield $d(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return C(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return $c(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return C(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return $c(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return})}};function Qc(n){return Pn(JSON.stringify({version:2,heartbeats:n})).length}function Wd(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function Jd(n){Vn(new jt("platform-logger",t=>new Ys(t),"PRIVATE")),Vn(new jt("heartbeat",t=>new ri(t),"PRIVATE")),De(Zs,zc,n),De(Zs,zc,"esm2020"),De("fire-js","")}Jd("");var tu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},eu={};var Gt,ii;(function(){var n;function t(v,m){function y(){}y.prototype=m.prototype,v.D=m.prototype,v.prototype=new y,v.prototype.constructor=v,v.C=function(_,w,A){for(var p=Array(arguments.length-2),Ft=2;Ft<arguments.length;Ft++)p[Ft-2]=arguments[Ft];return m.prototype[w].apply(_,p)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,m,y){y||(y=0);var _=Array(16);if(typeof m=="string")for(var w=0;16>w;++w)_[w]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(w=0;16>w;++w)_[w]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=v.g[0],y=v.g[1],w=v.g[2];var A=v.g[3],p=m+(A^y&(w^A))+_[0]+3614090360&4294967295;m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[1]+3905402710&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[2]+606105819&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[3]+3250441966&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(A^y&(w^A))+_[4]+4118548399&4294967295,m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[5]+1200080426&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[6]+2821735955&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[7]+4249261313&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(A^y&(w^A))+_[8]+1770035416&4294967295,m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[9]+2336552879&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[10]+4294925233&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[11]+2304563134&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(A^y&(w^A))+_[12]+1804603682&4294967295,m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[13]+4254626195&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[14]+2792965006&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[15]+1236535329&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(w^A&(y^w))+_[1]+4129170786&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[6]+3225465664&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[11]+643717713&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[0]+3921069994&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(w^A&(y^w))+_[5]+3593408605&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[10]+38016083&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[15]+3634488961&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[4]+3889429448&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(w^A&(y^w))+_[9]+568446438&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[14]+3275163606&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[3]+4107603335&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[8]+1163531501&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(w^A&(y^w))+_[13]+2850285829&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[2]+4243563512&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[7]+1735328473&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[12]+2368359562&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(y^w^A)+_[5]+4294588738&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[8]+2272392833&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[11]+1839030562&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[14]+4259657740&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(y^w^A)+_[1]+2763975236&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[4]+1272893353&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[7]+4139469664&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[10]+3200236656&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(y^w^A)+_[13]+681279174&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[0]+3936430074&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[3]+3572445317&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[6]+76029189&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(y^w^A)+_[9]+3654602809&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[12]+3873151461&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[15]+530742520&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[2]+3299628645&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(w^(y|~A))+_[0]+4096336452&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[7]+1126891415&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[14]+2878612391&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[5]+4237533241&4294967295,y=w+(p<<21&4294967295|p>>>11),p=m+(w^(y|~A))+_[12]+1700485571&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[3]+2399980690&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[10]+4293915773&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[1]+2240044497&4294967295,y=w+(p<<21&4294967295|p>>>11),p=m+(w^(y|~A))+_[8]+1873313359&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[15]+4264355552&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[6]+2734768916&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[13]+1309151649&4294967295,y=w+(p<<21&4294967295|p>>>11),p=m+(w^(y|~A))+_[4]+4149444226&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[11]+3174756917&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[2]+718787259&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[9]+3951481745&4294967295,v.g[0]=v.g[0]+m&4294967295,v.g[1]=v.g[1]+(w+(p<<21&4294967295|p>>>11))&4294967295,v.g[2]=v.g[2]+w&4294967295,v.g[3]=v.g[3]+A&4294967295}r.prototype.u=function(v,m){m===void 0&&(m=v.length);for(var y=m-this.blockSize,_=this.B,w=this.h,A=0;A<m;){if(w==0)for(;A<=y;)s(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<m;)if(_[w++]=v.charCodeAt(A++),w==this.blockSize){s(this,_),w=0;break}}else for(;A<m;)if(_[w++]=v[A++],w==this.blockSize){s(this,_),w=0;break}}this.h=w,this.o+=m},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var m=1;m<v.length-8;++m)v[m]=0;var y=8*this.o;for(m=v.length-8;m<v.length;++m)v[m]=y&255,y/=256;for(this.u(v),v=Array(16),m=y=0;4>m;++m)for(var _=0;32>_;_+=8)v[y++]=this.g[m]>>>_&255;return v};function o(v,m){var y=l;return Object.prototype.hasOwnProperty.call(y,v)?y[v]:y[v]=m(v)}function c(v,m){this.h=m;for(var y=[],_=!0,w=v.length-1;0<=w;w--){var A=v[w]|0;_&&A==m||(y[w]=A,_=!1)}this.g=y}var l={};function h(v){return-128<=v&&128>v?o(v,function(m){return new c([m|0],0>m?-1:0)}):new c([v|0],0>v?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return T;if(0>v)return D(f(-v));for(var m=[],y=1,_=0;v>=y;_++)m[_]=v/y|0,y*=4294967296;return new c(m,0)}function g(v,m){if(v.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(v.charAt(0)=="-")return D(g(v.substring(1),m));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=f(Math.pow(m,8)),_=T,w=0;w<v.length;w+=8){var A=Math.min(8,v.length-w),p=parseInt(v.substring(w,w+A),m);8>A?(A=f(Math.pow(m,A)),_=_.j(A).add(f(p))):(_=_.j(y),_=_.add(f(p)))}return _}var T=h(0),E=h(1),R=h(16777216);n=c.prototype,n.m=function(){if(O(this))return-D(this).m();for(var v=0,m=1,y=0;y<this.g.length;y++){var _=this.i(y);v+=(0<=_?_:4294967296+_)*m,m*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(x(this))return"0";if(O(this))return"-"+D(this).toString(v);for(var m=f(Math.pow(v,6)),y=this,_="";;){var w=ct(y,m).g;y=Q(y,w.j(m));var A=((0<y.g.length?y.g[0]:y.h)>>>0).toString(v);if(y=w,x(y))return A+_;for(;6>A.length;)A="0"+A;_=A+_}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function x(v){if(v.h!=0)return!1;for(var m=0;m<v.g.length;m++)if(v.g[m]!=0)return!1;return!0}function O(v){return v.h==-1}n.l=function(v){return v=Q(this,v),O(v)?-1:x(v)?0:1};function D(v){for(var m=v.g.length,y=[],_=0;_<m;_++)y[_]=~v.g[_];return new c(y,~v.h).add(E)}n.abs=function(){return O(this)?D(this):this},n.add=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0,w=0;w<=m;w++){var A=_+(this.i(w)&65535)+(v.i(w)&65535),p=(A>>>16)+(this.i(w)>>>16)+(v.i(w)>>>16);_=p>>>16,A&=65535,p&=65535,y[w]=p<<16|A}return new c(y,y[y.length-1]&-2147483648?-1:0)};function Q(v,m){return v.add(D(m))}n.j=function(v){if(x(this)||x(v))return T;if(O(this))return O(v)?D(this).j(D(v)):D(D(this).j(v));if(O(v))return D(this.j(D(v)));if(0>this.l(R)&&0>v.l(R))return f(this.m()*v.m());for(var m=this.g.length+v.g.length,y=[],_=0;_<2*m;_++)y[_]=0;for(_=0;_<this.g.length;_++)for(var w=0;w<v.g.length;w++){var A=this.i(_)>>>16,p=this.i(_)&65535,Ft=v.i(w)>>>16,cn=v.i(w)&65535;y[2*_+2*w]+=p*cn,j(y,2*_+2*w),y[2*_+2*w+1]+=A*cn,j(y,2*_+2*w+1),y[2*_+2*w+1]+=p*Ft,j(y,2*_+2*w+1),y[2*_+2*w+2]+=A*Ft,j(y,2*_+2*w+2)}for(_=0;_<m;_++)y[_]=y[2*_+1]<<16|y[2*_];for(_=m;_<2*m;_++)y[_]=0;return new c(y,0)};function j(v,m){for(;(v[m]&65535)!=v[m];)v[m+1]+=v[m]>>>16,v[m]&=65535,m++}function z(v,m){this.g=v,this.h=m}function ct(v,m){if(x(m))throw Error("division by zero");if(x(v))return new z(T,T);if(O(v))return m=ct(D(v),m),new z(D(m.g),D(m.h));if(O(m))return m=ct(v,D(m)),new z(D(m.g),m.h);if(30<v.g.length){if(O(v)||O(m))throw Error("slowDivide_ only works with positive integers.");for(var y=E,_=m;0>=_.l(v);)y=Dt(y),_=Dt(_);var w=ht(y,1),A=ht(_,1);for(_=ht(_,2),y=ht(y,2);!x(_);){var p=A.add(_);0>=p.l(v)&&(w=w.add(y),A=p),_=ht(_,1),y=ht(y,1)}return m=Q(v,w.j(m)),new z(w,m)}for(w=T;0<=v.l(m);){for(y=Math.max(1,Math.floor(v.m()/m.m())),_=Math.ceil(Math.log(y)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),A=f(y),p=A.j(m);O(p)||0<p.l(v);)y-=_,A=f(y),p=A.j(m);x(A)&&(A=E),w=w.add(A),v=Q(v,p)}return new z(w,v)}n.A=function(v){return ct(this,v).h},n.and=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)&v.i(_);return new c(y,this.h&v.h)},n.or=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)|v.i(_);return new c(y,this.h|v.h)},n.xor=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)^v.i(_);return new c(y,this.h^v.h)};function Dt(v){for(var m=v.g.length+1,y=[],_=0;_<m;_++)y[_]=v.i(_)<<1|v.i(_-1)>>>31;return new c(y,v.h)}function ht(v,m){var y=m>>5;m%=32;for(var _=v.g.length-y,w=[],A=0;A<_;A++)w[A]=0<m?v.i(A+y)>>>m|v.i(A+y+1)<<32-m:v.i(A+y);return new c(w,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,ii=eu.Md5=r,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.A,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=f,c.fromString=g,Gt=eu.Integer=c}).apply(typeof tu<"u"?tu:typeof self<"u"?self:typeof window<"u"?window:{});var Sr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$t={};var oi,Xd,xe,ai,xn,Rr,ci,ui,li;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(i,a,u){return i==Array.prototype||i==Object.prototype||(i[a]=u.value),i};function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Sr=="object"&&Sr];for(var a=0;a<i.length;++a){var u=i[a];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=e(this);function s(i,a){if(a)t:{var u=r;i=i.split(".");for(var d=0;d<i.length-1;d++){var I=i[d];if(!(I in u))break t;u=u[I]}i=i[i.length-1],d=u[i],a=a(d),a!=d&&a!=null&&t(u,i,{configurable:!0,writable:!0,value:a})}}function o(i,a){i instanceof String&&(i+="");var u=0,d=!1,I={next:function(){if(!d&&u<i.length){var b=u++;return{value:a(b,i[b]),done:!1}}return d=!0,{done:!0,value:void 0}}};return I[Symbol.iterator]=function(){return I},I}s("Array.prototype.values",function(i){return i||function(){return o(this,function(a,u){return u})}});var c=c||{},l=this||self;function h(i){var a=typeof i;return a=a!="object"?a:i?Array.isArray(i)?"array":a:"null",a=="array"||a=="object"&&typeof i.length=="number"}function f(i){var a=typeof i;return a=="object"&&i!=null||a=="function"}function g(i,a,u){return i.call.apply(i.bind,arguments)}function T(i,a,u){if(!i)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var I=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(I,d),i.apply(a,I)}}return function(){return i.apply(a,arguments)}}function E(i,a,u){return E=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:T,E.apply(null,arguments)}function R(i,a){var u=Array.prototype.slice.call(arguments,1);return function(){var d=u.slice();return d.push.apply(d,arguments),i.apply(this,d)}}function x(i,a){function u(){}u.prototype=a.prototype,i.aa=a.prototype,i.prototype=new u,i.prototype.constructor=i,i.Qb=function(d,I,b){for(var V=Array(arguments.length-2),W=2;W<arguments.length;W++)V[W-2]=arguments[W];return a.prototype[I].apply(d,V)}}function O(i){let a=i.length;if(0<a){let u=Array(a);for(let d=0;d<a;d++)u[d]=i[d];return u}return[]}function D(i,a){for(let u=1;u<arguments.length;u++){let d=arguments[u];if(h(d)){let I=i.length||0,b=d.length||0;i.length=I+b;for(let V=0;V<b;V++)i[I+V]=d[V]}else i.push(d)}}class Q{constructor(a,u){this.i=a,this.j=u,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}function j(i){return/^[\s\xa0]*$/.test(i)}function z(){var i=l.navigator;return i&&(i=i.userAgent)?i:""}function ct(i){return ct[" "](i),i}ct[" "]=function(){};var Dt=z().indexOf("Gecko")!=-1&&!(z().toLowerCase().indexOf("webkit")!=-1&&z().indexOf("Edge")==-1)&&!(z().indexOf("Trident")!=-1||z().indexOf("MSIE")!=-1)&&z().indexOf("Edge")==-1;function ht(i,a,u){for(let d in i)a.call(u,i[d],d,i)}function v(i,a){for(let u in i)a.call(void 0,i[u],u,i)}function m(i){let a={};for(let u in i)a[u]=i[u];return a}let y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(i,a){let u,d;for(let I=1;I<arguments.length;I++){d=arguments[I];for(u in d)i[u]=d[u];for(let b=0;b<y.length;b++)u=y[b],Object.prototype.hasOwnProperty.call(d,u)&&(i[u]=d[u])}}function w(i){var a=1;i=i.split(":");let u=[];for(;0<a&&i.length;)u.push(i.shift()),a--;return i.length&&u.push(i.join(":")),u}function A(i){l.setTimeout(()=>{throw i},0)}function p(){var i=Es;let a=null;return i.g&&(a=i.g,i.g=i.g.next,i.g||(i.h=null),a.next=null),a}class Ft{constructor(){this.h=this.g=null}add(a,u){let d=cn.get();d.set(a,u),this.h?this.h.next=d:this.g=d,this.h=d}}var cn=new Q(()=>new dh,i=>i.reset());class dh{constructor(){this.next=this.g=this.h=null}set(a,u){this.h=a,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let un,ln=!1,Es=new Ft,Ra=()=>{let i=l.Promise.resolve(void 0);un=()=>{i.then(fh)}};var fh=()=>{for(var i;i=p();){try{i.h.call(i.g)}catch(u){A(u)}var a=cn;a.j(i),100>a.h&&(a.h++,i.next=a.g,a.g=i)}ln=!1};function Yt(){this.s=this.s,this.C=this.C}Yt.prototype.s=!1,Yt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Yt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function dt(i,a){this.type=i,this.g=this.target=a,this.defaultPrevented=!1}dt.prototype.h=function(){this.defaultPrevented=!0};var mh=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,a=Object.defineProperty({},"passive",{get:function(){i=!0}});try{let u=()=>{};l.addEventListener("test",u,a),l.removeEventListener("test",u,a)}catch{}return i}();function hn(i,a){if(dt.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var u=this.type=i.type,d=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=a,a=i.relatedTarget){if(Dt){t:{try{ct(a.nodeName);var I=!0;break t}catch{}I=!1}I||(a=null)}}else u=="mouseover"?a=i.fromElement:u=="mouseout"&&(a=i.toElement);this.relatedTarget=a,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:ph[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&hn.aa.h.call(this)}}x(hn,dt);var ph={2:"touch",3:"pen",4:"mouse"};hn.prototype.h=function(){hn.aa.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var dn="closure_listenable_"+(1e6*Math.random()|0),gh=0;function yh(i,a,u,d,I){this.listener=i,this.proxy=null,this.src=a,this.type=u,this.capture=!!d,this.ha=I,this.key=++gh,this.da=this.fa=!1}function ir(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function or(i){this.src=i,this.g={},this.h=0}or.prototype.add=function(i,a,u,d,I){var b=i.toString();i=this.g[b],i||(i=this.g[b]=[],this.h++);var V=vs(i,a,d,I);return-1<V?(a=i[V],u||(a.fa=!1)):(a=new yh(a,this.src,b,!!d,I),a.fa=u,i.push(a)),a};function Is(i,a){var u=a.type;if(u in i.g){var d=i.g[u],I=Array.prototype.indexOf.call(d,a,void 0),b;(b=0<=I)&&Array.prototype.splice.call(d,I,1),b&&(ir(a),i.g[u].length==0&&(delete i.g[u],i.h--))}}function vs(i,a,u,d){for(var I=0;I<i.length;++I){var b=i[I];if(!b.da&&b.listener==a&&b.capture==!!u&&b.ha==d)return I}return-1}var Ts="closure_lm_"+(1e6*Math.random()|0),As={};function Pa(i,a,u,d,I){if(d&&d.once)return Va(i,a,u,d,I);if(Array.isArray(a)){for(var b=0;b<a.length;b++)Pa(i,a[b],u,d,I);return null}return u=Ps(u),i&&i[dn]?i.K(a,u,f(d)?!!d.capture:!!d,I):Ca(i,a,u,!1,d,I)}function Ca(i,a,u,d,I,b){if(!a)throw Error("Invalid event type");var V=f(I)?!!I.capture:!!I,W=Ss(i);if(W||(i[Ts]=W=new or(i)),u=W.add(a,u,d,V,b),u.proxy)return u;if(d=_h(),u.proxy=d,d.src=i,d.listener=u,i.addEventListener)mh||(I=V),I===void 0&&(I=!1),i.addEventListener(a.toString(),d,I);else if(i.attachEvent)i.attachEvent(xa(a.toString()),d);else if(i.addListener&&i.removeListener)i.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return u}function _h(){function i(u){return a.call(i.src,i.listener,u)}let a=wh;return i}function Va(i,a,u,d,I){if(Array.isArray(a)){for(var b=0;b<a.length;b++)Va(i,a[b],u,d,I);return null}return u=Ps(u),i&&i[dn]?i.L(a,u,f(d)?!!d.capture:!!d,I):Ca(i,a,u,!0,d,I)}function Da(i,a,u,d,I){if(Array.isArray(a))for(var b=0;b<a.length;b++)Da(i,a[b],u,d,I);else d=f(d)?!!d.capture:!!d,u=Ps(u),i&&i[dn]?(i=i.i,a=String(a).toString(),a in i.g&&(b=i.g[a],u=vs(b,u,d,I),-1<u&&(ir(b[u]),Array.prototype.splice.call(b,u,1),b.length==0&&(delete i.g[a],i.h--)))):i&&(i=Ss(i))&&(a=i.g[a.toString()],i=-1,a&&(i=vs(a,u,d,I)),(u=-1<i?a[i]:null)&&bs(u))}function bs(i){if(typeof i!="number"&&i&&!i.da){var a=i.src;if(a&&a[dn])Is(a.i,i);else{var u=i.type,d=i.proxy;a.removeEventListener?a.removeEventListener(u,d,i.capture):a.detachEvent?a.detachEvent(xa(u),d):a.addListener&&a.removeListener&&a.removeListener(d),(u=Ss(a))?(Is(u,i),u.h==0&&(u.src=null,a[Ts]=null)):ir(i)}}}function xa(i){return i in As?As[i]:As[i]="on"+i}function wh(i,a){if(i.da)i=!0;else{a=new hn(a,this);var u=i.listener,d=i.ha||i.src;i.fa&&bs(i),i=u.call(d,a)}return i}function Ss(i){return i=i[Ts],i instanceof or?i:null}var Rs="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ps(i){return typeof i=="function"?i:(i[Rs]||(i[Rs]=function(a){return i.handleEvent(a)}),i[Rs])}function ft(){Yt.call(this),this.i=new or(this),this.M=this,this.F=null}x(ft,Yt),ft.prototype[dn]=!0,ft.prototype.removeEventListener=function(i,a,u,d){Da(this,i,a,u,d)};function wt(i,a){var u,d=i.F;if(d)for(u=[];d;d=d.F)u.push(d);if(i=i.M,d=a.type||a,typeof a=="string")a=new dt(a,i);else if(a instanceof dt)a.target=a.target||i;else{var I=a;a=new dt(d,i),_(a,I)}if(I=!0,u)for(var b=u.length-1;0<=b;b--){var V=a.g=u[b];I=ar(V,d,!0,a)&&I}if(V=a.g=i,I=ar(V,d,!0,a)&&I,I=ar(V,d,!1,a)&&I,u)for(b=0;b<u.length;b++)V=a.g=u[b],I=ar(V,d,!1,a)&&I}ft.prototype.N=function(){if(ft.aa.N.call(this),this.i){var i=this.i,a;for(a in i.g){for(var u=i.g[a],d=0;d<u.length;d++)ir(u[d]);delete i.g[a],i.h--}}this.F=null},ft.prototype.K=function(i,a,u,d){return this.i.add(String(i),a,!1,u,d)},ft.prototype.L=function(i,a,u,d){return this.i.add(String(i),a,!0,u,d)};function ar(i,a,u,d){if(a=i.i.g[String(a)],!a)return!0;a=a.concat();for(var I=!0,b=0;b<a.length;++b){var V=a[b];if(V&&!V.da&&V.capture==u){var W=V.listener,ut=V.ha||V.src;V.fa&&Is(i.i,V),I=W.call(ut,d)!==!1&&I}}return I&&!d.defaultPrevented}function Na(i,a,u){if(typeof i=="function")u&&(i=E(i,u));else if(i&&typeof i.handleEvent=="function")i=E(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(a)?-1:l.setTimeout(i,a||0)}function ka(i){i.g=Na(()=>{i.g=null,i.i&&(i.i=!1,ka(i))},i.l);let a=i.h;i.h=null,i.m.apply(null,a)}class Eh extends Yt{constructor(a,u){super(),this.m=a,this.l=u,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:ka(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function fn(i){Yt.call(this),this.h=i,this.g={}}x(fn,Yt);var Oa=[];function Ma(i){ht(i.g,function(a,u){this.g.hasOwnProperty(u)&&bs(a)},i),i.g={}}fn.prototype.N=function(){fn.aa.N.call(this),Ma(this)},fn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Cs=l.JSON.stringify,Ih=l.JSON.parse,vh=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function Vs(){}Vs.prototype.h=null;function Fa(i){return i.h||(i.h=i.i())}function La(){}var mn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ds(){dt.call(this,"d")}x(Ds,dt);function xs(){dt.call(this,"c")}x(xs,dt);var he={},Ba=null;function cr(){return Ba=Ba||new ft}he.La="serverreachability";function Ua(i){dt.call(this,he.La,i)}x(Ua,dt);function pn(i){let a=cr();wt(a,new Ua(a))}he.STAT_EVENT="statevent";function qa(i,a){dt.call(this,he.STAT_EVENT,i),this.stat=a}x(qa,dt);function Et(i){let a=cr();wt(a,new qa(a,i))}he.Ma="timingevent";function ja(i,a){dt.call(this,he.Ma,i),this.size=a}x(ja,dt);function gn(i,a){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},a)}function yn(){this.g=!0}yn.prototype.xa=function(){this.g=!1};function Th(i,a,u,d,I,b){i.info(function(){if(i.g)if(b)for(var V="",W=b.split("&"),ut=0;ut<W.length;ut++){var H=W[ut].split("=");if(1<H.length){var mt=H[0];H=H[1];var pt=mt.split("_");V=2<=pt.length&&pt[1]=="type"?V+(mt+"="+H+"&"):V+(mt+"=redacted&")}}else V=null;else V=b;return"XMLHTTP REQ ("+d+") [attempt "+I+"]: "+a+`
`+u+`
`+V})}function Ah(i,a,u,d,I,b,V){i.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+I+"]: "+a+`
`+u+`
`+b+" "+V})}function be(i,a,u,d){i.info(function(){return"XMLHTTP TEXT ("+a+"): "+Sh(i,u)+(d?" "+d:"")})}function bh(i,a){i.info(function(){return"TIMEOUT: "+a})}yn.prototype.info=function(){};function Sh(i,a){if(!i.g)return a;if(!a)return null;try{var u=JSON.parse(a);if(u){for(i=0;i<u.length;i++)if(Array.isArray(u[i])){var d=u[i];if(!(2>d.length)){var I=d[1];if(Array.isArray(I)&&!(1>I.length)){var b=I[0];if(b!="noop"&&b!="stop"&&b!="close")for(var V=1;V<I.length;V++)I[V]=""}}}}return Cs(u)}catch{return a}}var ur={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},za={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ns;function lr(){}x(lr,Vs),lr.prototype.g=function(){return new XMLHttpRequest},lr.prototype.i=function(){return{}},Ns=new lr;function Zt(i,a,u,d){this.j=i,this.i=a,this.l=u,this.R=d||1,this.U=new fn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ga}function Ga(){this.i=null,this.g="",this.h=!1}var $a={},ks={};function Os(i,a,u){i.L=1,i.v=mr(Lt(a)),i.m=u,i.P=!0,Ka(i,null)}function Ka(i,a){i.F=Date.now(),hr(i),i.A=Lt(i.v);var u=i.A,d=i.R;Array.isArray(d)||(d=[String(d)]),oc(u.i,"t",d),i.C=0,u=i.j.J,i.h=new Ga,i.g=Ac(i.j,u?a:null,!i.m),0<i.O&&(i.M=new Eh(E(i.Y,i,i.g),i.O)),a=i.U,u=i.g,d=i.ca;var I="readystatechange";Array.isArray(I)||(I&&(Oa[0]=I.toString()),I=Oa);for(var b=0;b<I.length;b++){var V=Pa(u,I[b],d||a.handleEvent,!1,a.h||a);if(!V)break;a.g[V.key]=V}a=i.H?m(i.H):{},i.m?(i.u||(i.u="POST"),a["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.A,i.u,i.m,a)):(i.u="GET",i.g.ea(i.A,i.u,null,a)),pn(),Th(i.i,i.u,i.A,i.l,i.R,i.m)}Zt.prototype.ca=function(i){i=i.target;let a=this.M;a&&Bt(i)==3?a.j():this.Y(i)},Zt.prototype.Y=function(i){try{if(i==this.g)t:{let pt=Bt(this.g);var a=this.g.Ba();let Pe=this.g.Z();if(!(3>pt)&&(pt!=3||this.g&&(this.h.h||this.g.oa()||fc(this.g)))){this.J||pt!=4||a==7||(a==8||0>=Pe?pn(3):pn(2)),Ms(this);var u=this.g.Z();this.X=u;e:if(Qa(this)){var d=fc(this.g);i="";var I=d.length,b=Bt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){de(this),_n(this);var V="";break e}this.h.i=new l.TextDecoder}for(a=0;a<I;a++)this.h.h=!0,i+=this.h.i.decode(d[a],{stream:!(b&&a==I-1)});d.length=0,this.h.g+=i,this.C=0,V=this.h.g}else V=this.g.oa();if(this.o=u==200,Ah(this.i,this.u,this.A,this.l,this.R,pt,u),this.o){if(this.T&&!this.K){e:{if(this.g){var W,ut=this.g;if((W=ut.g?ut.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(W)){var H=W;break e}}H=null}if(u=H)be(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Fs(this,u);else{this.o=!1,this.s=3,Et(12),de(this),_n(this);break t}}if(this.P){u=!0;let Ct;for(;!this.J&&this.C<V.length;)if(Ct=Rh(this,V),Ct==ks){pt==4&&(this.s=4,Et(14),u=!1),be(this.i,this.l,null,"[Incomplete Response]");break}else if(Ct==$a){this.s=4,Et(15),be(this.i,this.l,V,"[Invalid Chunk]"),u=!1;break}else be(this.i,this.l,Ct,null),Fs(this,Ct);if(Qa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),pt!=4||V.length!=0||this.h.h||(this.s=1,Et(16),u=!1),this.o=this.o&&u,!u)be(this.i,this.l,V,"[Invalid Chunked Response]"),de(this),_n(this);else if(0<V.length&&!this.W){this.W=!0;var mt=this.j;mt.g==this&&mt.ba&&!mt.M&&(mt.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),zs(mt),mt.M=!0,Et(11))}}else be(this.i,this.l,V,null),Fs(this,V);pt==4&&de(this),this.o&&!this.J&&(pt==4?Ec(this.j,this):(this.o=!1,hr(this)))}else Gh(this.g),u==400&&0<V.indexOf("Unknown SID")?(this.s=3,Et(12)):(this.s=0,Et(13)),de(this),_n(this)}}}catch{}finally{}};function Qa(i){return i.g?i.u=="GET"&&i.L!=2&&i.j.Ca:!1}function Rh(i,a){var u=i.C,d=a.indexOf(`
`,u);return d==-1?ks:(u=Number(a.substring(u,d)),isNaN(u)?$a:(d+=1,d+u>a.length?ks:(a=a.slice(d,d+u),i.C=d+u,a)))}Zt.prototype.cancel=function(){this.J=!0,de(this)};function hr(i){i.S=Date.now()+i.I,Ha(i,i.I)}function Ha(i,a){if(i.B!=null)throw Error("WatchDog timer not null");i.B=gn(E(i.ba,i),a)}function Ms(i){i.B&&(l.clearTimeout(i.B),i.B=null)}Zt.prototype.ba=function(){this.B=null;let i=Date.now();0<=i-this.S?(bh(this.i,this.A),this.L!=2&&(pn(),Et(17)),de(this),this.s=2,_n(this)):Ha(this,this.S-i)};function _n(i){i.j.G==0||i.J||Ec(i.j,i)}function de(i){Ms(i);var a=i.M;a&&typeof a.ma=="function"&&a.ma(),i.M=null,Ma(i.U),i.g&&(a=i.g,i.g=null,a.abort(),a.ma())}function Fs(i,a){try{var u=i.j;if(u.G!=0&&(u.g==i||Ls(u.h,i))){if(!i.K&&Ls(u.h,i)&&u.G==3){try{var d=u.Da.g.parse(a)}catch{d=null}if(Array.isArray(d)&&d.length==3){var I=d;if(I[0]==0){t:if(!u.u){if(u.g)if(u.g.F+3e3<i.F)wr(u),yr(u);else break t;js(u),Et(18)}}else u.za=I[1],0<u.za-u.T&&37500>I[2]&&u.F&&u.v==0&&!u.C&&(u.C=gn(E(u.Za,u),6e3));if(1>=Xa(u.h)&&u.ca){try{u.ca()}catch{}u.ca=void 0}}else me(u,11)}else if((i.K||u.g==i)&&wr(u),!j(a))for(I=u.Da.g.parse(a),a=0;a<I.length;a++){let H=I[a];if(u.T=H[0],H=H[1],u.G==2)if(H[0]=="c"){u.K=H[1],u.ia=H[2];let mt=H[3];mt!=null&&(u.la=mt,u.j.info("VER="+u.la));let pt=H[4];pt!=null&&(u.Aa=pt,u.j.info("SVER="+u.Aa));let Pe=H[5];Pe!=null&&typeof Pe=="number"&&0<Pe&&(d=1.5*Pe,u.L=d,u.j.info("backChannelRequestTimeoutMs_="+d)),d=u;let Ct=i.g;if(Ct){let Ir=Ct.g?Ct.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ir){var b=d.h;b.g||Ir.indexOf("spdy")==-1&&Ir.indexOf("quic")==-1&&Ir.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(Bs(b,b.h),b.h=null))}if(d.D){let Gs=Ct.g?Ct.g.getResponseHeader("X-HTTP-Session-Id"):null;Gs&&(d.ya=Gs,J(d.I,d.D,Gs))}}u.G=3,u.l&&u.l.ua(),u.ba&&(u.R=Date.now()-i.F,u.j.info("Handshake RTT: "+u.R+"ms")),d=u;var V=i;if(d.qa=Tc(d,d.J?d.ia:null,d.W),V.K){Ya(d.h,V);var W=V,ut=d.L;ut&&(W.I=ut),W.B&&(Ms(W),hr(W)),d.g=V}else _c(d);0<u.i.length&&_r(u)}else H[0]!="stop"&&H[0]!="close"||me(u,7);else u.G==3&&(H[0]=="stop"||H[0]=="close"?H[0]=="stop"?me(u,7):qs(u):H[0]!="noop"&&u.l&&u.l.ta(H),u.v=0)}}pn(4)}catch{}}var Ph=class{constructor(i,a){this.g=i,this.map=a}};function Wa(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ja(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Xa(i){return i.h?1:i.g?i.g.size:0}function Ls(i,a){return i.h?i.h==a:i.g?i.g.has(a):!1}function Bs(i,a){i.g?i.g.add(a):i.h=a}function Ya(i,a){i.h&&i.h==a?i.h=null:i.g&&i.g.has(a)&&i.g.delete(a)}Wa.prototype.cancel=function(){if(this.i=Za(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let i of this.g.values())i.cancel();this.g.clear()}};function Za(i){if(i.h!=null)return i.i.concat(i.h.D);if(i.g!=null&&i.g.size!==0){let a=i.i;for(let u of i.g.values())a=a.concat(u.D);return a}return O(i.i)}function Ch(i){if(i.V&&typeof i.V=="function")return i.V();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(h(i)){for(var a=[],u=i.length,d=0;d<u;d++)a.push(i[d]);return a}a=[],u=0;for(d in i)a[u++]=i[d];return a}function Vh(i){if(i.na&&typeof i.na=="function")return i.na();if(!i.V||typeof i.V!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(h(i)||typeof i=="string"){var a=[];i=i.length;for(var u=0;u<i;u++)a.push(u);return a}a=[],u=0;for(let d in i)a[u++]=d;return a}}}function tc(i,a){if(i.forEach&&typeof i.forEach=="function")i.forEach(a,void 0);else if(h(i)||typeof i=="string")Array.prototype.forEach.call(i,a,void 0);else for(var u=Vh(i),d=Ch(i),I=d.length,b=0;b<I;b++)a.call(void 0,d[b],u&&u[b],i)}var ec=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Dh(i,a){if(i){i=i.split("&");for(var u=0;u<i.length;u++){var d=i[u].indexOf("="),I=null;if(0<=d){var b=i[u].substring(0,d);I=i[u].substring(d+1)}else b=i[u];a(b,I?decodeURIComponent(I.replace(/\+/g," ")):"")}}}function fe(i){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,i instanceof fe){this.h=i.h,dr(this,i.j),this.o=i.o,this.g=i.g,fr(this,i.s),this.l=i.l;var a=i.i,u=new In;u.i=a.i,a.g&&(u.g=new Map(a.g),u.h=a.h),nc(this,u),this.m=i.m}else i&&(a=String(i).match(ec))?(this.h=!1,dr(this,a[1]||"",!0),this.o=wn(a[2]||""),this.g=wn(a[3]||"",!0),fr(this,a[4]),this.l=wn(a[5]||"",!0),nc(this,a[6]||"",!0),this.m=wn(a[7]||"")):(this.h=!1,this.i=new In(null,this.h))}fe.prototype.toString=function(){var i=[],a=this.j;a&&i.push(En(a,rc,!0),":");var u=this.g;return(u||a=="file")&&(i.push("//"),(a=this.o)&&i.push(En(a,rc,!0),"@"),i.push(encodeURIComponent(String(u)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.s,u!=null&&i.push(":",String(u))),(u=this.l)&&(this.g&&u.charAt(0)!="/"&&i.push("/"),i.push(En(u,u.charAt(0)=="/"?kh:Nh,!0))),(u=this.i.toString())&&i.push("?",u),(u=this.m)&&i.push("#",En(u,Mh)),i.join("")};function Lt(i){return new fe(i)}function dr(i,a,u){i.j=u?wn(a,!0):a,i.j&&(i.j=i.j.replace(/:$/,""))}function fr(i,a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);i.s=a}else i.s=null}function nc(i,a,u){a instanceof In?(i.i=a,Fh(i.i,i.h)):(u||(a=En(a,Oh)),i.i=new In(a,i.h))}function J(i,a,u){i.i.set(a,u)}function mr(i){return J(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function wn(i,a){return i?a?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function En(i,a,u){return typeof i=="string"?(i=encodeURI(i).replace(a,xh),u&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function xh(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var rc=/[#\/\?@]/g,Nh=/[#\?:]/g,kh=/[#\?]/g,Oh=/[#\?@]/g,Mh=/#/g;function In(i,a){this.h=this.g=null,this.i=i||null,this.j=!!a}function te(i){i.g||(i.g=new Map,i.h=0,i.i&&Dh(i.i,function(a,u){i.add(decodeURIComponent(a.replace(/\+/g," ")),u)}))}n=In.prototype,n.add=function(i,a){te(this),this.i=null,i=Se(this,i);var u=this.g.get(i);return u||this.g.set(i,u=[]),u.push(a),this.h+=1,this};function sc(i,a){te(i),a=Se(i,a),i.g.has(a)&&(i.i=null,i.h-=i.g.get(a).length,i.g.delete(a))}function ic(i,a){return te(i),a=Se(i,a),i.g.has(a)}n.forEach=function(i,a){te(this),this.g.forEach(function(u,d){u.forEach(function(I){i.call(a,I,d,this)},this)},this)},n.na=function(){te(this);let i=Array.from(this.g.values()),a=Array.from(this.g.keys()),u=[];for(let d=0;d<a.length;d++){let I=i[d];for(let b=0;b<I.length;b++)u.push(a[d])}return u},n.V=function(i){te(this);let a=[];if(typeof i=="string")ic(this,i)&&(a=a.concat(this.g.get(Se(this,i))));else{i=Array.from(this.g.values());for(let u=0;u<i.length;u++)a=a.concat(i[u])}return a},n.set=function(i,a){return te(this),this.i=null,i=Se(this,i),ic(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[a]),this.h+=1,this},n.get=function(i,a){return i?(i=this.V(i),0<i.length?String(i[0]):a):a};function oc(i,a,u){sc(i,a),0<u.length&&(i.i=null,i.g.set(Se(i,a),O(u)),i.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let i=[],a=Array.from(this.g.keys());for(var u=0;u<a.length;u++){var d=a[u];let b=encodeURIComponent(String(d)),V=this.V(d);for(d=0;d<V.length;d++){var I=b;V[d]!==""&&(I+="="+encodeURIComponent(String(V[d]))),i.push(I)}}return this.i=i.join("&")};function Se(i,a){return a=String(a),i.j&&(a=a.toLowerCase()),a}function Fh(i,a){a&&!i.j&&(te(i),i.i=null,i.g.forEach(function(u,d){var I=d.toLowerCase();d!=I&&(sc(this,d),oc(this,I,u))},i)),i.j=a}function Lh(i,a){let u=new yn;if(l.Image){let d=new Image;d.onload=R(ee,u,"TestLoadImage: loaded",!0,a,d),d.onerror=R(ee,u,"TestLoadImage: error",!1,a,d),d.onabort=R(ee,u,"TestLoadImage: abort",!1,a,d),d.ontimeout=R(ee,u,"TestLoadImage: timeout",!1,a,d),l.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=i}else a(!1)}function Bh(i,a){let u=new yn,d=new AbortController,I=setTimeout(()=>{d.abort(),ee(u,"TestPingServer: timeout",!1,a)},1e4);fetch(i,{signal:d.signal}).then(b=>{clearTimeout(I),b.ok?ee(u,"TestPingServer: ok",!0,a):ee(u,"TestPingServer: server error",!1,a)}).catch(()=>{clearTimeout(I),ee(u,"TestPingServer: error",!1,a)})}function ee(i,a,u,d,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),d(u)}catch{}}function Uh(){this.g=new vh}function qh(i,a,u){let d=u||"";try{tc(i,function(I,b){let V=I;f(I)&&(V=Cs(I)),a.push(d+b+"="+encodeURIComponent(V))})}catch(I){throw a.push(d+"type="+encodeURIComponent("_badmap")),I}}function vn(i){this.l=i.Ub||null,this.j=i.eb||!1}x(vn,Vs),vn.prototype.g=function(){return new pr(this.l,this.j)},vn.prototype.i=function(i){return function(){return i}}({});function pr(i,a){ft.call(this),this.D=i,this.o=a,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(pr,ft),n=pr.prototype,n.open=function(i,a){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=i,this.A=a,this.readyState=1,An(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let a={headers:this.u,method:this.B,credentials:this.m,cache:void 0};i&&(a.body=i),(this.D||l).fetch(new Request(this.A,a)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Tn(this)),this.readyState=0},n.Sa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,An(this)),this.g&&(this.readyState=3,An(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ac(this)}else i.text().then(this.Ra.bind(this),this.ga.bind(this))};function ac(i){i.j.read().then(i.Pa.bind(i)).catch(i.ga.bind(i))}n.Pa=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var a=i.value?i.value:new Uint8Array(0);(a=this.v.decode(a,{stream:!i.done}))&&(this.response=this.responseText+=a)}i.done?Tn(this):An(this),this.readyState==3&&ac(this)}},n.Ra=function(i){this.g&&(this.response=this.responseText=i,Tn(this))},n.Qa=function(i){this.g&&(this.response=i,Tn(this))},n.ga=function(){this.g&&Tn(this)};function Tn(i){i.readyState=4,i.l=null,i.j=null,i.v=null,An(i)}n.setRequestHeader=function(i,a){this.u.append(i,a)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let i=[],a=this.h.entries();for(var u=a.next();!u.done;)u=u.value,i.push(u[0]+": "+u[1]),u=a.next();return i.join(`\r
`)};function An(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(pr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function cc(i){let a="";return ht(i,function(u,d){a+=d,a+=":",a+=u,a+=`\r
`}),a}function Us(i,a,u){t:{for(d in u){var d=!1;break t}d=!0}d||(u=cc(u),typeof i=="string"?u!=null&&encodeURIComponent(String(u)):J(i,a,u))}function Z(i){ft.call(this),this.headers=new Map,this.o=i||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(Z,ft);var jh=/^https?$/i,zh=["POST","PUT"];n=Z.prototype,n.Ha=function(i){this.J=i},n.ea=function(i,a,u,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);a=a?a.toUpperCase():"GET",this.D=i,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ns.g(),this.v=this.o?Fa(this.o):Fa(Ns),this.g.onreadystatechange=E(this.Ea,this);try{this.B=!0,this.g.open(a,String(i),!0),this.B=!1}catch(b){uc(this,b);return}if(i=u||"",u=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var I in d)u.set(I,d[I]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(let b of d.keys())u.set(b,d.get(b));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(u.keys()).find(b=>b.toLowerCase()=="content-type"),I=l.FormData&&i instanceof l.FormData,!(0<=Array.prototype.indexOf.call(zh,a,void 0))||d||I||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[b,V]of u)this.g.setRequestHeader(b,V);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{dc(this),this.u=!0,this.g.send(i),this.u=!1}catch(b){uc(this,b)}};function uc(i,a){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=a,i.m=5,lc(i),gr(i)}function lc(i){i.A||(i.A=!0,wt(i,"complete"),wt(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=i||7,wt(this,"complete"),wt(this,"abort"),gr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),gr(this,!0)),Z.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?hc(this):this.bb())},n.bb=function(){hc(this)};function hc(i){if(i.h&&typeof c<"u"&&(!i.v[1]||Bt(i)!=4||i.Z()!=2)){if(i.u&&Bt(i)==4)Na(i.Ea,0,i);else if(wt(i,"readystatechange"),Bt(i)==4){i.h=!1;try{let V=i.Z();t:switch(V){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break t;default:a=!1}var u;if(!(u=a)){var d;if(d=V===0){var I=String(i.D).match(ec)[1]||null;!I&&l.self&&l.self.location&&(I=l.self.location.protocol.slice(0,-1)),d=!jh.test(I?I.toLowerCase():"")}u=d}if(u)wt(i,"complete"),wt(i,"success");else{i.m=6;try{var b=2<Bt(i)?i.g.statusText:""}catch{b=""}i.l=b+" ["+i.Z()+"]",lc(i)}}finally{gr(i)}}}}function gr(i,a){if(i.g){dc(i);let u=i.g,d=i.v[0]?()=>{}:null;i.g=null,i.v=null,a||wt(i,"ready");try{u.onreadystatechange=d}catch{}}}function dc(i){i.I&&(l.clearTimeout(i.I),i.I=null)}n.isActive=function(){return!!this.g};function Bt(i){return i.g?i.g.readyState:0}n.Z=function(){try{return 2<Bt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(i){if(this.g){var a=this.g.responseText;return i&&a.indexOf(i)==0&&(a=a.substring(i.length)),Ih(a)}};function fc(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.H){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Gh(i){let a={};i=(i.g&&2<=Bt(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<i.length;d++){if(j(i[d]))continue;var u=w(i[d]);let I=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();let b=a[I]||[];a[I]=b,b.push(u)}v(a,function(d){return d.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function bn(i,a,u){return u&&u.internalChannelParams&&u.internalChannelParams[i]||a}function mc(i){this.Aa=0,this.i=[],this.j=new yn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=bn("failFast",!1,i),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=bn("baseRetryDelayMs",5e3,i),this.cb=bn("retryDelaySeedMs",1e4,i),this.Wa=bn("forwardChannelMaxRetries",2,i),this.wa=bn("forwardChannelRequestTimeoutMs",2e4,i),this.pa=i&&i.xmlHttpFactory||void 0,this.Xa=i&&i.Tb||void 0,this.Ca=i&&i.useFetchStreams||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.h=new Wa(i&&i.concurrentRequestLimit),this.Da=new Uh,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=i&&i.Rb||!1,i&&i.xa&&this.j.xa(),i&&i.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&i&&i.detectBufferingProxy||!1,this.ja=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.ja=i.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=mc.prototype,n.la=8,n.G=1,n.connect=function(i,a,u,d){Et(0),this.W=i,this.H=a||{},u&&d!==void 0&&(this.H.OSID=u,this.H.OAID=d),this.F=this.X,this.I=Tc(this,null,this.W),_r(this)};function qs(i){if(pc(i),i.G==3){var a=i.U++,u=Lt(i.I);if(J(u,"SID",i.K),J(u,"RID",a),J(u,"TYPE","terminate"),Sn(i,u),a=new Zt(i,i.j,a),a.L=2,a.v=mr(Lt(u)),u=!1,l.navigator&&l.navigator.sendBeacon)try{u=l.navigator.sendBeacon(a.v.toString(),"")}catch{}!u&&l.Image&&(new Image().src=a.v,u=!0),u||(a.g=Ac(a.j,null),a.g.ea(a.v)),a.F=Date.now(),hr(a)}vc(i)}function yr(i){i.g&&(zs(i),i.g.cancel(),i.g=null)}function pc(i){yr(i),i.u&&(l.clearTimeout(i.u),i.u=null),wr(i),i.h.cancel(),i.s&&(typeof i.s=="number"&&l.clearTimeout(i.s),i.s=null)}function _r(i){if(!Ja(i.h)&&!i.s){i.s=!0;var a=i.Ga;un||Ra(),ln||(un(),ln=!0),Es.add(a,i),i.B=0}}function $h(i,a){return Xa(i.h)>=i.h.j-(i.s?1:0)?!1:i.s?(i.i=a.D.concat(i.i),!0):i.G==1||i.G==2||i.B>=(i.Va?0:i.Wa)?!1:(i.s=gn(E(i.Ga,i,a),Ic(i,i.B)),i.B++,!0)}n.Ga=function(i){if(this.s)if(this.s=null,this.G==1){if(!i){this.U=Math.floor(1e5*Math.random()),i=this.U++;let I=new Zt(this,this.j,i),b=this.o;if(this.S&&(b?(b=m(b),_(b,this.S)):b=this.S),this.m!==null||this.O||(I.H=b,b=null),this.P)t:{for(var a=0,u=0;u<this.i.length;u++){e:{var d=this.i[u];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break e}d=void 0}if(d===void 0)break;if(a+=d,4096<a){a=u;break t}if(a===4096||u===this.i.length-1){a=u+1;break t}}a=1e3}else a=1e3;a=yc(this,I,a),u=Lt(this.I),J(u,"RID",i),J(u,"CVER",22),this.D&&J(u,"X-HTTP-Session-Id",this.D),Sn(this,u),b&&(this.O?a="headers="+encodeURIComponent(String(cc(b)))+"&"+a:this.m&&Us(u,this.m,b)),Bs(this.h,I),this.Ua&&J(u,"TYPE","init"),this.P?(J(u,"$req",a),J(u,"SID","null"),I.T=!0,Os(I,u,null)):Os(I,u,a),this.G=2}}else this.G==3&&(i?gc(this,i):this.i.length==0||Ja(this.h)||gc(this))};function gc(i,a){var u;a?u=a.l:u=i.U++;let d=Lt(i.I);J(d,"SID",i.K),J(d,"RID",u),J(d,"AID",i.T),Sn(i,d),i.m&&i.o&&Us(d,i.m,i.o),u=new Zt(i,i.j,u,i.B+1),i.m===null&&(u.H=i.o),a&&(i.i=a.D.concat(i.i)),a=yc(i,u,1e3),u.I=Math.round(.5*i.wa)+Math.round(.5*i.wa*Math.random()),Bs(i.h,u),Os(u,d,a)}function Sn(i,a){i.H&&ht(i.H,function(u,d){J(a,d,u)}),i.l&&tc({},function(u,d){J(a,d,u)})}function yc(i,a,u){u=Math.min(i.i.length,u);var d=i.l?E(i.l.Na,i.l,i):null;t:{var I=i.i;let b=-1;for(;;){let V=["count="+u];b==-1?0<u?(b=I[0].g,V.push("ofs="+b)):b=0:V.push("ofs="+b);let W=!0;for(let ut=0;ut<u;ut++){let H=I[ut].g,mt=I[ut].map;if(H-=b,0>H)b=Math.max(0,I[ut].g-100),W=!1;else try{qh(mt,V,"req"+H+"_")}catch{d&&d(mt)}}if(W){d=V.join("&");break t}}}return i=i.i.splice(0,u),a.D=i,d}function _c(i){if(!i.g&&!i.u){i.Y=1;var a=i.Fa;un||Ra(),ln||(un(),ln=!0),Es.add(a,i),i.v=0}}function js(i){return i.g||i.u||3<=i.v?!1:(i.Y++,i.u=gn(E(i.Fa,i),Ic(i,i.v)),i.v++,!0)}n.Fa=function(){if(this.u=null,wc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var i=2*this.R;this.j.info("BP detection timer enabled: "+i),this.A=gn(E(this.ab,this),i)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Et(10),yr(this),wc(this))};function zs(i){i.A!=null&&(l.clearTimeout(i.A),i.A=null)}function wc(i){i.g=new Zt(i,i.j,"rpc",i.Y),i.m===null&&(i.g.H=i.o),i.g.O=0;var a=Lt(i.qa);J(a,"RID","rpc"),J(a,"SID",i.K),J(a,"AID",i.T),J(a,"CI",i.F?"0":"1"),!i.F&&i.ja&&J(a,"TO",i.ja),J(a,"TYPE","xmlhttp"),Sn(i,a),i.m&&i.o&&Us(a,i.m,i.o),i.L&&(i.g.I=i.L);var u=i.g;i=i.ia,u.L=1,u.v=mr(Lt(a)),u.m=null,u.P=!0,Ka(u,i)}n.Za=function(){this.C!=null&&(this.C=null,yr(this),js(this),Et(19))};function wr(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function Ec(i,a){var u=null;if(i.g==a){wr(i),zs(i),i.g=null;var d=2}else if(Ls(i.h,a))u=a.D,Ya(i.h,a),d=1;else return;if(i.G!=0){if(a.o)if(d==1){u=a.m?a.m.length:0,a=Date.now()-a.F;var I=i.B;d=cr(),wt(d,new ja(d,u)),_r(i)}else _c(i);else if(I=a.s,I==3||I==0&&0<a.X||!(d==1&&$h(i,a)||d==2&&js(i)))switch(u&&0<u.length&&(a=i.h,a.i=a.i.concat(u)),I){case 1:me(i,5);break;case 4:me(i,10);break;case 3:me(i,6);break;default:me(i,2)}}}function Ic(i,a){let u=i.Ta+Math.floor(Math.random()*i.cb);return i.isActive()||(u*=2),u*a}function me(i,a){if(i.j.info("Error code "+a),a==2){var u=E(i.fb,i),d=i.Xa;let I=!d;d=new fe(d||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||dr(d,"https"),mr(d),I?Lh(d.toString(),u):Bh(d.toString(),u)}else Et(2);i.G=0,i.l&&i.l.sa(a),vc(i),pc(i)}n.fb=function(i){i?(this.j.info("Successfully pinged google.com"),Et(2)):(this.j.info("Failed to ping google.com"),Et(1))};function vc(i){if(i.G=0,i.ka=[],i.l){let a=Za(i.h);(a.length!=0||i.i.length!=0)&&(D(i.ka,a),D(i.ka,i.i),i.h.i.length=0,O(i.i),i.i.length=0),i.l.ra()}}function Tc(i,a,u){var d=u instanceof fe?Lt(u):new fe(u);if(d.g!="")a&&(d.g=a+"."+d.g),fr(d,d.s);else{var I=l.location;d=I.protocol,a=a?a+"."+I.hostname:I.hostname,I=+I.port;var b=new fe(null);d&&dr(b,d),a&&(b.g=a),I&&fr(b,I),u&&(b.l=u),d=b}return u=i.D,a=i.ya,u&&a&&J(d,u,a),J(d,"VER",i.la),Sn(i,d),d}function Ac(i,a,u){if(a&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return a=i.Ca&&!i.pa?new Z(new vn({eb:u})):new Z(i.pa),a.Ha(i.J),a}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function bc(){}n=bc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Er(){}Er.prototype.g=function(i,a){return new vt(i,a)};function vt(i,a){ft.call(this),this.g=new mc(a),this.l=i,this.h=a&&a.messageUrlParams||null,i=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(i?i["X-WebChannel-Content-Type"]=a.messageContentType:i={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.va&&(i?i["X-WebChannel-Client-Profile"]=a.va:i={"X-WebChannel-Client-Profile":a.va}),this.g.S=i,(i=a&&a.Sb)&&!j(i)&&(this.g.m=i),this.v=a&&a.supportsCrossDomainXhr||!1,this.u=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!j(a)&&(this.g.D=a,i=this.h,i!==null&&a in i&&(i=this.h,a in i&&delete i[a])),this.j=new Re(this)}x(vt,ft),vt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},vt.prototype.close=function(){qs(this.g)},vt.prototype.o=function(i){var a=this.g;if(typeof i=="string"){var u={};u.__data__=i,i=u}else this.u&&(u={},u.__data__=Cs(i),i=u);a.i.push(new Ph(a.Ya++,i)),a.G==3&&_r(a)},vt.prototype.N=function(){this.g.l=null,delete this.j,qs(this.g),delete this.g,vt.aa.N.call(this)};function Sc(i){Ds.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var a=i.__sm__;if(a){t:{for(let u in a){i=u;break t}i=void 0}(this.i=i)&&(i=this.i,a=a!==null&&i in a?a[i]:void 0),this.data=a}else this.data=i}x(Sc,Ds);function Rc(){xs.call(this),this.status=1}x(Rc,xs);function Re(i){this.g=i}x(Re,bc),Re.prototype.ua=function(){wt(this.g,"a")},Re.prototype.ta=function(i){wt(this.g,new Sc(i))},Re.prototype.sa=function(i){wt(this.g,new Rc)},Re.prototype.ra=function(){wt(this.g,"b")},Er.prototype.createWebChannel=Er.prototype.g,vt.prototype.send=vt.prototype.o,vt.prototype.open=vt.prototype.m,vt.prototype.close=vt.prototype.close,li=$t.createWebChannelTransport=function(){return new Er},ui=$t.getStatEventTarget=function(){return cr()},ci=$t.Event=he,Rr=$t.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ur.NO_ERROR=0,ur.TIMEOUT=8,ur.HTTP_ERROR=6,xn=$t.ErrorCode=ur,za.COMPLETE="complete",ai=$t.EventType=za,La.EventType=mn,mn.OPEN="a",mn.CLOSE="b",mn.ERROR="c",mn.MESSAGE="d",ft.prototype.listen=ft.prototype.K,xe=$t.WebChannel=La,Xd=$t.FetchXmlHttpFactory=vn,Z.prototype.listenOnce=Z.prototype.L,Z.prototype.getLastError=Z.prototype.Ka,Z.prototype.getLastErrorCode=Z.prototype.Ba,Z.prototype.getStatus=Z.prototype.Z,Z.prototype.getResponseJson=Z.prototype.Oa,Z.prototype.getResponseText=Z.prototype.oa,Z.prototype.send=Z.prototype.ea,Z.prototype.setWithCredentials=Z.prototype.Ha,oi=$t.XhrIo=Z}).apply(typeof Sr<"u"?Sr:typeof self<"u"?self:typeof window<"u"?window:{});var nu="@firebase/firestore",ru="4.9.0";var ot=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};ot.UNAUTHENTICATED=new ot(null),ot.GOOGLE_CREDENTIALS=new ot("google-credentials-uid"),ot.FIRST_PARTY=new ot("first-party-uid"),ot.MOCK_USER=new ot("mock-user");var rn="12.0.0";var _e=new Ve("@firebase/firestore");function Ne(){return _e.logLevel}function N(n,...t){if(_e.logLevel<=G.DEBUG){let e=t.map(ea);_e.debug(`Firestore (${rn}): ${n}`,...e)}}function Qt(n,...t){if(_e.logLevel<=G.ERROR){let e=t.map(ea);_e.error(`Firestore (${rn}): ${n}`,...e)}}function Ue(n,...t){if(_e.logLevel<=G.WARN){let e=t.map(ea);_e.warn(`Firestore (${rn}): ${n}`,...e)}}function ea(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function M(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,ju(n,r,e)}function ju(n,t,e){let r=`FIRESTORE (${rn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw Qt(r),new Error(r)}function K(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||ju(t,s,r)}function B(n,t){return n}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},k=class extends Ut{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Vt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var kr=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},pi=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(ot.UNAUTHENTICATED))}shutdown(){}},gi=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},yi=class{constructor(t){this.t=t,this.currentUser=ot.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){K(this.o===void 0,42304);let r=this.i,s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve(),o=new Vt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Vt,t.enqueueRetryable(()=>s(this.currentUser))};let c=()=>{let h=o;t.enqueueRetryable(()=>C(this,null,function*(){yield h.promise,yield s(this.currentUser)}))},l=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?l(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Vt)}},0),c()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(K(typeof r.accessToken=="string",31837,{l:r}),new kr(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return K(t===null||typeof t=="string",2055,{h:t}),new ot(t)}},_i=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=ot.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},wi=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new _i(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(ot.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Or=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ei=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Wc(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){K(this.o===void 0,3512);let r=o=>{o.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let c=o.token!==this.m;return this.m=o.token,N("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>r(o))};let s=o=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?s(o):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Or(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(K(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Or(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Yd(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var qn=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let s=Yd(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}};function U(n,t){return n<t?-1:n>t?1:0}function Ii(n,t){let e=Math.min(n.length,t.length);for(let r=0;r<e;r++){let s=n.charAt(r),o=t.charAt(r);if(s!==o)return hi(s)===hi(o)?U(s,o):hi(s)?1:-1}return U(n.length,t.length)}var Zd=55296,tf=57343;function hi(n){let t=n.charCodeAt(0);return t>=Zd&&t<=tf}function qe(n,t,e){return n.length===t.length&&n.every((r,s)=>e(r,t[s]))}var su="__name__",Mr=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&M(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&M(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let s=0;s<r;s++){let o=n.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return U(t.length,e.length)}static compareSegments(t,e){let r=n.isNumericId(t),s=n.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?n.extractNumericId(t).compare(n.extractNumericId(e)):Ii(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Gt.fromString(t.substring(4,t.length-2))}},Y=class n extends Mr{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new k(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(s=>s.length>0))}return new n(e)}static emptyPath(){return new n([])}},ef=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Tt=class n extends Mr{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return ef.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===su}static keyField(){return new n([su])}static fromServerFormat(t){let e=[],r="",s=0,o=()=>{if(r.length===0)throw new k(S.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},c=!1;for(;s<t.length;){let l=t[s];if(l==="\\"){if(s+1===t.length)throw new k(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new k(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else l==="`"?(c=!c,s++):l!=="."||c?(r+=l,s++):(o(),s++)}if(o(),c)throw new k(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var F=class n{constructor(t){this.path=t}static fromPath(t){return new n(Y.fromString(t))}static fromName(t){return new n(Y.fromString(t).popFirst(5))}static empty(){return new n(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new Y(t.slice()))}};function nf(n,t,e){if(!e)throw new k(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function rf(n,t,e,r){if(t===!0&&r===!0)throw new k(S.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function iu(n){if(!F.isDocumentKey(n))throw new k(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function zu(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function na(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":M(12329,{type:typeof n})}function je(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new k(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=na(n);throw new k(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function rt(n,t){let e={typeString:n};return t&&(e.value=t),e}function er(n,t){if(!zu(n))throw new k(S.INVALID_ARGUMENT,"JSON must be an object");let e;for(let r in t)if(t[r]){let s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}let c=n[r];if(s&&typeof c!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&c!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new k(S.INVALID_ARGUMENT,e);return!0}var ou=-62135596800,au=1e6,st=class n{static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*au);return new n(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new k(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new k(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<ou)throw new k(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new k(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/au}_compareTo(t){return this.seconds===t.seconds?U(this.nanoseconds,t.nanoseconds):U(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(er(t,n._jsonSchema))return new n(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-ou;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};st._jsonSchemaVersion="firestore/timestamp/1.0",st._jsonSchema={type:rt("string",st._jsonSchemaVersion),seconds:rt("number"),nanoseconds:rt("number")};var L=class n{static fromTimestamp(t){return new n(t)}static min(){return new n(new st(0,0))}static max(){return new n(new st(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var jn=-1,vi=class{constructor(t,e,r,s){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=s}};vi.UNKNOWN_ID=-1;function sf(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=L.fromTimestamp(r===1e9?new st(e+1,0):new st(e,r));return new we(s,F.empty(),t)}function of(n){return new we(n.readTime,n.key,jn)}var we=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(L.min(),F.empty(),jn)}static max(){return new n(L.max(),F.empty(),jn)}};function af(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=F.comparator(n.documentKey,t.documentKey),e!==0?e:U(n.largestBatchId,t.largestBatchId))}var cf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ti=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function sn(n){return C(this,null,function*(){if(n.code!==S.FAILED_PRECONDITION||n.message!==cf)throw n;N("LocalStore","Unexpectedly lost primary lease")})}var P=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let s=0,o=0,c=!1;t.forEach(l=>{++s,l.next(()=>{++o,c&&o===s&&e()},h=>r(h))}),c=!0,o===s&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(s=>s?n.resolve(s):r());return e}static forEach(t,e){let r=[];return t.forEach((s,o)=>{r.push(e.call(this,s,o))}),this.waitFor(r)}static mapArray(t,e){return new n((r,s)=>{let o=t.length,c=new Array(o),l=0;for(let h=0;h<o;h++){let f=h;e(t[f]).next(g=>{c[f]=g,++l,l===o&&r(c)},g=>s(g))}})}static doWhile(t,e){return new n((r,s)=>{let o=()=>{t()===!0?e().next(()=>{o()},s):r()};o()})}};function uf(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function on(n){return n.name==="IndexedDbTransactionError"}var ra=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>r.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}n.ce=-1;return n})(),sa=-1;function nr(n){return n==null}function zn(n){return n===0&&1/n==-1/0}function lf(n){return typeof n=="number"&&Number.isInteger(n)&&!zn(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Gu="";function hf(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=cu(t)),t=df(n.get(e),t);return cu(t)}function df(n,t){let e=t,r=n.length;for(let s=0;s<r;s++){let o=n.charAt(s);switch(o){case"\0":e+="";break;case Gu:e+="";break;default:e+=o}}return e}function cu(n){return n+Gu+""}var ff="remoteDocuments",$u="owner";var Ku="mutationQueues";var Qu="mutations";var Hu="documentMutations",mf="remoteDocumentsV14";var Wu="remoteDocumentGlobal";var Ju="targets";var Xu="targetDocuments";var Yu="targetGlobal",Zu="collectionParents";var tl="clientMetadata";var el="bundles";var nl="namedQueries";var pf="indexConfiguration";var gf="indexState";var yf="indexEntries";var rl="documentOverlays";var _f="globals";var wf=[Ku,Qu,Hu,ff,Ju,$u,Yu,Xu,tl,Wu,Zu,el,nl],jp=[...wf,rl],Ef=[Ku,Qu,Hu,mf,Ju,$u,Yu,Xu,tl,Wu,Zu,el,nl,rl],If=Ef,vf=[...If,pf,gf,yf];var zp=[...vf,_f];function uu(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function le(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function sl(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var tt=class n{constructor(t,e){this.comparator=t,this.root=e||xt.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,xt.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,xt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Fe(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Fe(this.root,t,this.comparator,!1)}getReverseIterator(){return new Fe(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Fe(this.root,t,this.comparator,!0)}},Fe=class{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},xt=class n{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new n(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this,o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw M(27949);return t+(this.isRed()?0:1)}};xt.EMPTY=null,xt.RED=!0,xt.BLACK=!1;xt.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new xt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var at=class n{constructor(t){this.comparator=t,this.data=new tt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Fr(this.data.getIterator())}getIteratorFrom(t){return new Fr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},Fr=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Pt=class n{constructor(t){this.fields=t,t.sort(Tt.comparator)}static empty(){return new n([])}unionWith(t){let e=new at(Tt.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return qe(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var Lr=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var _t=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Lr("Invalid base64 string: "+o):o}}(t);return new n(e)}static fromUint8Array(t){let e=function(s){let o="";for(let c=0;c<s.length;++c)o+=String.fromCharCode(s[c]);return o}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return U(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};_t.EMPTY_BYTE_STRING=new _t("");var Tf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ht(n){if(K(!!n,39018),typeof n=="string"){let t=0,e=Tf.exec(n);if(K(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:X(n.seconds),nanos:X(n.nanos)}}function X(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Wt(n){return typeof n=="string"?_t.fromBase64String(n):_t.fromUint8Array(n)}var il="server_timestamp",ol="__type__",al="__previous_value__",cl="__local_write_time__";function ia(n){return(n?.mapValue?.fields||{})[ol]?.stringValue===il}function fs(n){let t=n.mapValue.fields[al];return ia(t)?fs(t):t}function Gn(n){let t=Ht(n.mapValue.fields[cl].timestampValue);return new st(t.seconds,t.nanos)}var Ai=class{constructor(t,e,r,s,o,c,l,h,f,g){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=c,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=g}},Br="(default)",Ur=class n{constructor(t,e){this.projectId=t,this.database=e||Br}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Br}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var oa="__type__",ul="__max__",Pr={mapValue:{fields:{__type__:{stringValue:ul}}}},aa="__vector__",ze="value";function ae(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ia(n)?4:hl(n)?9007199254740991:ll(n)?10:11:M(28295,{value:n})}function kt(n,t){if(n===t)return!0;let e=ae(n);if(e!==ae(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Gn(n).isEqual(Gn(t));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;let c=Ht(s.timestampValue),l=Ht(o.timestampValue);return c.seconds===l.seconds&&c.nanos===l.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(s,o){return Wt(s.bytesValue).isEqual(Wt(o.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(s,o){return X(s.geoPointValue.latitude)===X(o.geoPointValue.latitude)&&X(s.geoPointValue.longitude)===X(o.geoPointValue.longitude)}(n,t);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return X(s.integerValue)===X(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){let c=X(s.doubleValue),l=X(o.doubleValue);return c===l?zn(c)===zn(l):isNaN(c)&&isNaN(l)}return!1}(n,t);case 9:return qe(n.arrayValue.values||[],t.arrayValue.values||[],kt);case 10:case 11:return function(s,o){let c=s.mapValue.fields||{},l=o.mapValue.fields||{};if(uu(c)!==uu(l))return!1;for(let h in c)if(c.hasOwnProperty(h)&&(l[h]===void 0||!kt(c[h],l[h])))return!1;return!0}(n,t);default:return M(52216,{left:n})}}function $n(n,t){return(n.values||[]).find(e=>kt(e,t))!==void 0}function Ge(n,t){if(n===t)return 0;let e=ae(n),r=ae(t);if(e!==r)return U(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return U(n.booleanValue,t.booleanValue);case 2:return function(o,c){let l=X(o.integerValue||o.doubleValue),h=X(c.integerValue||c.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1}(n,t);case 3:return lu(n.timestampValue,t.timestampValue);case 4:return lu(Gn(n),Gn(t));case 5:return Ii(n.stringValue,t.stringValue);case 6:return function(o,c){let l=Wt(o),h=Wt(c);return l.compareTo(h)}(n.bytesValue,t.bytesValue);case 7:return function(o,c){let l=o.split("/"),h=c.split("/");for(let f=0;f<l.length&&f<h.length;f++){let g=U(l[f],h[f]);if(g!==0)return g}return U(l.length,h.length)}(n.referenceValue,t.referenceValue);case 8:return function(o,c){let l=U(X(o.latitude),X(c.latitude));return l!==0?l:U(X(o.longitude),X(c.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return hu(n.arrayValue,t.arrayValue);case 10:return function(o,c){let l=o.fields||{},h=c.fields||{},f=l[ze]?.arrayValue,g=h[ze]?.arrayValue,T=U(f?.values?.length||0,g?.values?.length||0);return T!==0?T:hu(f,g)}(n.mapValue,t.mapValue);case 11:return function(o,c){if(o===Pr.mapValue&&c===Pr.mapValue)return 0;if(o===Pr.mapValue)return 1;if(c===Pr.mapValue)return-1;let l=o.fields||{},h=Object.keys(l),f=c.fields||{},g=Object.keys(f);h.sort(),g.sort();for(let T=0;T<h.length&&T<g.length;++T){let E=Ii(h[T],g[T]);if(E!==0)return E;let R=Ge(l[h[T]],f[g[T]]);if(R!==0)return R}return U(h.length,g.length)}(n.mapValue,t.mapValue);default:throw M(23264,{he:e})}}function lu(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return U(n,t);let e=Ht(n),r=Ht(t),s=U(e.seconds,r.seconds);return s!==0?s:U(e.nanos,r.nanos)}function hu(n,t){let e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){let o=Ge(e[s],r[s]);if(o)return o}return U(e.length,r.length)}function $e(n){return bi(n)}function bi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=Ht(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Wt(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return F.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",s=!0;for(let o of e.values||[])s?s=!1:r+=",",r+=bi(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),s="{",o=!0;for(let c of r)o?o=!1:s+=",",s+=`${c}:${bi(e.fields[c])}`;return s+"}"}(n.mapValue):M(61005,{value:n})}function Dr(n){switch(ae(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=fs(n);return t?16+Dr(t):16;case 5:return 2*n.stringValue.length;case 6:return Wt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,o)=>s+Dr(o),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return le(r.fields,(o,c)=>{s+=o.length+Dr(c)}),s}(n.mapValue);default:throw M(13486,{value:n})}}function Si(n){return!!n&&"integerValue"in n}function ca(n){return!!n&&"arrayValue"in n}function du(n){return!!n&&"nullValue"in n}function fu(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function xr(n){return!!n&&"mapValue"in n}function ll(n){return(n?.mapValue?.fields||{})[oa]?.stringValue===aa}function On(n){if(n.geoPointValue)return{geoPointValue:lt({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:lt({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return le(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=On(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=On(n.arrayValue.values[e]);return t}return lt({},n)}function hl(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===ul}var $p={mapValue:{fields:{[oa]:{stringValue:aa},[ze]:{arrayValue:{}}}}};var It=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!xr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=On(e)}setAll(t){let e=Tt.emptyPath(),r={},s=[];t.forEach((c,l)=>{if(!e.isImmediateParentOf(l)){let h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=l.popLast()}c?r[l.lastSegment()]=On(c):s.push(l.lastSegment())});let o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){let e=this.field(t.popLast());xr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return kt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];xr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){le(e,(s,o)=>t[s]=o);for(let s of r)delete t[s]}clone(){return new n(On(this.value))}};function dl(n){let t=[];return le(n.fields,(e,r)=>{let s=new Tt([e]);if(xr(r)){let o=dl(r.mapValue).fields;if(o.length===0)t.push(s);else for(let c of o)t.push(s.child(c))}else t.push(s)}),new Pt(t)}var bt=class n{constructor(t,e,r,s,o,c,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=c,this.documentState=l}static newInvalidDocument(t){return new n(t,0,L.min(),L.min(),L.min(),It.empty(),0)}static newFoundDocument(t,e,r,s){return new n(t,1,e,L.min(),r,s,0)}static newNoDocument(t,e){return new n(t,2,e,L.min(),L.min(),It.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,L.min(),L.min(),It.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(L.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=It.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=It.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=L.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Ke=class{constructor(t,e){this.position=t,this.inclusive=e}};function mu(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){let o=t[s],c=n.position[s];if(o.field.isKeyField()?r=F.comparator(F.fromName(c.referenceValue),e.key):r=Ge(c,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function pu(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!kt(n.position[e],t.position[e]))return!1;return!0}var Qe=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Af(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var qr=class{},it=class n extends qr{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Pi(t,e,r):e==="array-contains"?new Di(t,r):e==="in"?new xi(t,r):e==="not-in"?new Ni(t,r):e==="array-contains-any"?new ki(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Ci(t,r):new Vi(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ge(e,this.value)):e!==null&&ae(this.value)===ae(e)&&this.matchesComparison(Ge(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ot=class n extends qr{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new n(t,e)}matches(t){return fl(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function fl(n){return n.op==="and"}function ml(n){return bf(n)&&fl(n)}function bf(n){for(let t of n.filters)if(t instanceof Ot)return!1;return!0}function Ri(n){if(n instanceof it)return n.field.canonicalString()+n.op.toString()+$e(n.value);if(ml(n))return n.filters.map(t=>Ri(t)).join(",");{let t=n.filters.map(e=>Ri(e)).join(",");return`${n.op}(${t})`}}function pl(n,t){return n instanceof it?function(r,s){return s instanceof it&&r.op===s.op&&r.field.isEqual(s.field)&&kt(r.value,s.value)}(n,t):n instanceof Ot?function(r,s){return s instanceof Ot&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,c,l)=>o&&pl(c,s.filters[l]),!0):!1}(n,t):void M(19439)}function gl(n){return n instanceof it?function(e){return`${e.field.canonicalString()} ${e.op} ${$e(e.value)}`}(n):n instanceof Ot?function(e){return e.op.toString()+" {"+e.getFilters().map(gl).join(" ,")+"}"}(n):"Filter"}var Pi=class extends it{constructor(t,e,r){super(t,e,r),this.key=F.fromName(r.referenceValue)}matches(t){let e=F.comparator(t.key,this.key);return this.matchesComparison(e)}},Ci=class extends it{constructor(t,e){super(t,"in",e),this.keys=yl("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Vi=class extends it{constructor(t,e){super(t,"not-in",e),this.keys=yl("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function yl(n,t){return(t.arrayValue?.values||[]).map(e=>F.fromName(e.referenceValue))}var Di=class extends it{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return ca(e)&&$n(e.arrayValue,this.value)}},xi=class extends it{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&$n(this.value.arrayValue,e)}},Ni=class extends it{constructor(t,e){super(t,"not-in",e)}matches(t){if($n(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!$n(this.value.arrayValue,e)}},ki=class extends it{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!ca(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>$n(this.value.arrayValue,r))}};var Oi=class{constructor(t,e=null,r=[],s=[],o=null,c=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=c,this.endAt=l,this.Te=null}};function gu(n,t=null,e=[],r=[],s=null,o=null,c=null){return new Oi(n,t,e,r,s,o,c)}function ua(n){let t=B(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>Ri(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),nr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>$e(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>$e(r)).join(",")),t.Te=e}return t.Te}function la(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!Af(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!pl(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!pu(n.startAt,t.startAt)&&pu(n.endAt,t.endAt)}function Mi(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var He=class{constructor(t,e=null,r=[],s=[],o=null,c="F",l=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=c,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function Sf(n,t,e,r,s,o,c,l){return new He(n,t,e,r,s,o,c,l)}function ha(n){return new He(n)}function yu(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Rf(n){return n.collectionGroup!==null}function Mn(n){let t=B(n);if(t.Ie===null){t.Ie=[];let e=new Set;for(let o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(c){let l=new at(Tt.comparator);return c.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new Qe(o,r))}),e.has(Tt.keyField().canonicalString())||t.Ie.push(new Qe(Tt.keyField(),r))}return t.Ie}function Nt(n){let t=B(n);return t.Ee||(t.Ee=Pf(t,Mn(n))),t.Ee}function Pf(n,t){if(n.limitType==="F")return gu(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(s=>{let o=s.dir==="desc"?"asc":"desc";return new Qe(s.field,o)});let e=n.endAt?new Ke(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ke(n.startAt.position,n.startAt.inclusive):null;return gu(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Fi(n,t,e){return new He(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function ms(n,t){return la(Nt(n),Nt(t))&&n.limitType===t.limitType}function _l(n){return`${ua(Nt(n))}|lt:${n.limitType}`}function ke(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(s=>gl(s)).join(", ")}]`),nr(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(s=>function(c){return`${c.field.canonicalString()} (${c.dir})`}(s)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>$e(s)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>$e(s)).join(",")),`Target(${r})`}(Nt(n))}; limitType=${n.limitType})`}function ps(n,t){return t.isFoundDocument()&&function(r,s){let o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):F.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,t)&&function(r,s){for(let o of Mn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(n,t)&&function(r,s){for(let o of r.filters)if(!o.matches(s))return!1;return!0}(n,t)&&function(r,s){return!(r.startAt&&!function(c,l,h){let f=mu(c,l,h);return c.inclusive?f<=0:f<0}(r.startAt,Mn(r),s)||r.endAt&&!function(c,l,h){let f=mu(c,l,h);return c.inclusive?f>=0:f>0}(r.endAt,Mn(r),s))}(n,t)}function Cf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function wl(n){return(t,e)=>{let r=!1;for(let s of Mn(n)){let o=Vf(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function Vf(n,t,e){let r=n.field.isKeyField()?F.comparator(t.key,e.key):function(o,c,l){let h=c.data.field(o),f=l.data.field(o);return h!==null&&f!==null?Ge(h,f):M(42886)}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M(19790,{direction:n.dir})}}var Jt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){le(this.inner,(e,r)=>{for(let[s,o]of r)t(s,o)})}isEmpty(){return sl(this.inner)}size(){return this.innerSize}};var Df=new tt(F.comparator);function Xt(){return Df}var El=new tt(F.comparator);function Nn(...n){let t=El;for(let e of n)t=t.insert(e.key,e);return t}function Il(n){let t=El;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function ge(){return Fn()}function vl(){return Fn()}function Fn(){return new Jt(n=>n.toString(),(n,t)=>n.isEqual(t))}var xf=new tt(F.comparator),Nf=new at(F.comparator);function q(...n){let t=Nf;for(let e of n)t=t.add(e);return t}var kf=new at(U);function Of(){return kf}function da(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zn(t)?"-0":t}}function Tl(n){return{integerValue:""+n}}function Mf(n,t){return lf(t)?Tl(t):da(n,t)}var We=class{constructor(){this._=void 0}};function Ff(n,t,e){return n instanceof Je?function(s,o){let c={fields:{[ol]:{stringValue:il},[cl]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&ia(o)&&(o=fs(o)),o&&(c.fields[al]=o),{mapValue:c}}(e,t):n instanceof Ee?bl(n,t):n instanceof Ie?Sl(n,t):function(s,o){let c=Al(s,o),l=_u(c)+_u(s.Ae);return Si(c)&&Si(s.Ae)?Tl(l):da(s.serializer,l)}(n,t)}function Lf(n,t,e){return n instanceof Ee?bl(n,t):n instanceof Ie?Sl(n,t):e}function Al(n,t){return n instanceof Xe?function(r){return Si(r)||function(o){return!!o&&"doubleValue"in o}(r)}(t)?t:{integerValue:0}:null}var Je=class extends We{},Ee=class extends We{constructor(t){super(),this.elements=t}};function bl(n,t){let e=Rl(t);for(let r of n.elements)e.some(s=>kt(s,r))||e.push(r);return{arrayValue:{values:e}}}var Ie=class extends We{constructor(t){super(),this.elements=t}};function Sl(n,t){let e=Rl(t);for(let r of n.elements)e=e.filter(s=>!kt(s,r));return{arrayValue:{values:e}}}var Xe=class extends We{constructor(t,e){super(),this.serializer=t,this.Ae=e}};function _u(n){return X(n.integerValue||n.doubleValue)}function Rl(n){return ca(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Bf(n,t){return n.field.isEqual(t.field)&&function(r,s){return r instanceof Ee&&s instanceof Ee||r instanceof Ie&&s instanceof Ie?qe(r.elements,s.elements,kt):r instanceof Xe&&s instanceof Xe?kt(r.Ae,s.Ae):r instanceof Je&&s instanceof Je}(n.transform,t.transform)}var Li=class{constructor(t,e){this.version=t,this.transformResults=e}},Rt=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Nr(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var Ye=class{};function Pl(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Kn(n.key,Rt.none()):new ve(n.key,n.data,Rt.none());{let e=n.data,r=It.empty(),s=new at(Tt.comparator);for(let o of t.fields)if(!s.has(o)){let c=e.field(o);c===null&&o.length>1&&(o=o.popLast(),c=e.field(o)),c===null?r.delete(o):r.set(o,c),s=s.add(o)}return new Mt(n.key,r,new Pt(s.toArray()),Rt.none())}}function Uf(n,t,e){n instanceof ve?function(s,o,c){let l=s.value.clone(),h=Eu(s.fieldTransforms,o,c.transformResults);l.setAll(h),o.convertToFoundDocument(c.version,l).setHasCommittedMutations()}(n,t,e):n instanceof Mt?function(s,o,c){if(!Nr(s.precondition,o))return void o.convertToUnknownDocument(c.version);let l=Eu(s.fieldTransforms,o,c.transformResults),h=o.data;h.setAll(Cl(s)),h.setAll(l),o.convertToFoundDocument(c.version,h).setHasCommittedMutations()}(n,t,e):function(s,o,c){o.convertToNoDocument(c.version).setHasCommittedMutations()}(0,t,e)}function Ln(n,t,e,r){return n instanceof ve?function(o,c,l,h){if(!Nr(o.precondition,c))return l;let f=o.value.clone(),g=Iu(o.fieldTransforms,h,c);return f.setAll(g),c.convertToFoundDocument(c.version,f).setHasLocalMutations(),null}(n,t,e,r):n instanceof Mt?function(o,c,l,h){if(!Nr(o.precondition,c))return l;let f=Iu(o.fieldTransforms,h,c),g=c.data;return g.setAll(Cl(o)),g.setAll(f),c.convertToFoundDocument(c.version,g).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(T=>T.field))}(n,t,e,r):function(o,c,l){return Nr(o.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):l}(n,t,e)}function qf(n,t){let e=null;for(let r of n.fieldTransforms){let s=t.data.field(r.field),o=Al(r.transform,s||null);o!=null&&(e===null&&(e=It.empty()),e.set(r.field,o))}return e||null}function wu(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&qe(r,s,(o,c)=>Bf(o,c))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var ve=class extends Ye{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Mt=class extends Ye{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function Cl(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function Eu(n,t,e){let r=new Map;K(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let s=0;s<e.length;s++){let o=n[s],c=o.transform,l=t.data.field(o.field);r.set(o.field,Lf(c,l,e[s]))}return r}function Iu(n,t,e){let r=new Map;for(let s of n){let o=s.transform,c=e.data.field(s.field);r.set(s.field,Ff(o,c,t))}return r}var Kn=class extends Ye{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},jr=class extends Ye{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Bi=class{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let o=this.mutations[s];o.key.isEqual(t.key)&&Uf(o,t,r[s])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=Ln(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=Ln(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=vl();return this.mutations.forEach(s=>{let o=t.get(s.key),c=o.overlayedDocument,l=this.applyToLocalView(c,o.mutatedFields);l=e.has(s.key)?null:l;let h=Pl(c,l);h!==null&&r.set(s.key,h),c.isValidDocument()||c.convertToNoDocument(L.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),q())}isEqual(t){return this.batchId===t.batchId&&qe(this.mutations,t.mutations,(e,r)=>wu(e,r))&&qe(this.baseMutations,t.baseMutations,(e,r)=>wu(e,r))}},Ui=class n{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){K(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let s=function(){return xf}(),o=t.mutations;for(let c=0;c<o.length;c++)s=s.insert(o[c].key,r[c].version);return new n(t,e,r,s)}};var qi=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ji=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var et,$;function Vl(n){switch(n){case S.OK:return M(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return M(15467,{code:n})}}function Dl(n){if(n===void 0)return Qt("GRPC error has no .code"),S.UNKNOWN;switch(n){case et.OK:return S.OK;case et.CANCELLED:return S.CANCELLED;case et.UNKNOWN:return S.UNKNOWN;case et.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case et.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case et.INTERNAL:return S.INTERNAL;case et.UNAVAILABLE:return S.UNAVAILABLE;case et.UNAUTHENTICATED:return S.UNAUTHENTICATED;case et.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case et.NOT_FOUND:return S.NOT_FOUND;case et.ALREADY_EXISTS:return S.ALREADY_EXISTS;case et.PERMISSION_DENIED:return S.PERMISSION_DENIED;case et.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case et.ABORTED:return S.ABORTED;case et.OUT_OF_RANGE:return S.OUT_OF_RANGE;case et.UNIMPLEMENTED:return S.UNIMPLEMENTED;case et.DATA_LOSS:return S.DATA_LOSS;default:return M(39323,{code:n})}}($=et||(et={}))[$.OK=0]="OK",$[$.CANCELLED=1]="CANCELLED",$[$.UNKNOWN=2]="UNKNOWN",$[$.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$[$.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$[$.NOT_FOUND=5]="NOT_FOUND",$[$.ALREADY_EXISTS=6]="ALREADY_EXISTS",$[$.PERMISSION_DENIED=7]="PERMISSION_DENIED",$[$.UNAUTHENTICATED=16]="UNAUTHENTICATED",$[$.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$[$.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$[$.ABORTED=10]="ABORTED",$[$.OUT_OF_RANGE=11]="OUT_OF_RANGE",$[$.UNIMPLEMENTED=12]="UNIMPLEMENTED",$[$.INTERNAL=13]="INTERNAL",$[$.UNAVAILABLE=14]="UNAVAILABLE",$[$.DATA_LOSS=15]="DATA_LOSS";var jf=null;function zf(){return new TextEncoder}var Gf=new Gt([4294967295,4294967295],0);function vu(n){let t=zf().encode(n),e=new ii;return e.update(t),new Uint8Array(e.digest())}function Tu(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new Gt([e,r],0),new Gt([s,o],0)]}var zi=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new ye(`Invalid padding: ${e}`);if(r<0)throw new ye(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new ye(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new ye(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=Gt.fromNumber(this.ge)}ye(t,e,r){let s=t.add(e.multiply(Gt.fromNumber(r)));return s.compare(Gf)===1&&(s=new Gt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;let e=vu(t),[r,s]=Tu(e);for(let o=0;o<this.hashCount;o++){let c=this.ye(r,s,o);if(!this.we(c))return!1}return!0}static create(t,e,r){let s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),c=new n(o,s,e);return r.forEach(l=>c.insert(l)),c}insert(t){if(this.ge===0)return;let e=vu(t),[r,s]=Tu(e);for(let o=0;o<this.hashCount;o++){let c=this.ye(r,s,o);this.Se(c)}}Se(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},ye=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var zr=class n{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let s=new Map;return s.set(t,Qn.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(L.min(),s,new tt(U),Xt(),q())}},Qn=class n{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,q(),q(),q())}};var Le=class{constructor(t,e,r,s){this.be=t,this.removedTargetIds=e,this.key=r,this.De=s}},Gr=class{constructor(t,e){this.targetId=t,this.Ce=e}},$r=class{constructor(t,e,r=_t.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}},Kr=class{constructor(){this.ve=0,this.Fe=Au(),this.Me=_t.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=q(),e=q(),r=q();return this.Fe.forEach((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:M(38017,{changeType:o})}}),new Qn(this.Me,this.xe,t,e,r)}qe(){this.Oe=!1,this.Fe=Au()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,K(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},Gi=class{constructor(t){this.Ge=t,this.ze=new Map,this.je=Xt(),this.Je=Cr(),this.He=Cr(),this.Ye=new tt(U)}Ze(t){for(let e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(let e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{let r=this.nt(e);switch(t.state){case 0:this.rt(e)&&r.Le(t.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(t.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(r.We(),r.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),r.Le(t.resumeToken));break;default:M(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((r,s)=>{this.rt(s)&&e(s)})}st(t){let e=t.targetId,r=t.Ce.count,s=this.ot(e);if(s){let o=s.target;if(Mi(o))if(r===0){let c=new F(o.path);this.et(e,c,bt.newNoDocument(c,L.min()))}else K(r===1,20013,{expectedCount:r});else{let c=this._t(e);if(c!==r){let l=this.ut(t),h=l?this.ct(l,t,c):1;if(h!==0){this.it(e);let f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,f)}jf?.lt(function(g,T,E,R,x){let O={localCacheCount:g,existenceFilterCount:T.count,databaseId:E.database,projectId:E.projectId},D=T.unchangedNames;return D&&(O.bloomFilter={applied:x===0,hashCount:D?.hashCount??0,bitmapLength:D?.bits?.bitmap?.length??0,padding:D?.bits?.padding??0,mightContain:Q=>R?.mightContain(Q)??!1}),O}(c,t.Ce,this.Ge.ht(),l,h))}}}}ut(t){let e=t.Ce.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e,c,l;try{c=Wt(r).toUint8Array()}catch(h){if(h instanceof Lr)return Ue("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new zi(c,s,o)}catch(h){return Ue(h instanceof ye?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(t,e,r){return e.Ce.count===r-this.Pt(t,e.targetId)?0:2}Pt(t,e){let r=this.Ge.getRemoteKeysForTarget(e),s=0;return r.forEach(o=>{let c=this.Ge.ht(),l=`projects/${c.projectId}/databases/${c.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.et(e,o,null),s++)}),s}Tt(t){let e=new Map;this.ze.forEach((o,c)=>{let l=this.ot(c);if(l){if(o.current&&Mi(l.target)){let h=new F(l.target.path);this.It(h).has(c)||this.Et(c,h)||this.et(c,h,bt.newNoDocument(h,t))}o.Be&&(e.set(c,o.ke()),o.qe())}});let r=q();this.He.forEach((o,c)=>{let l=!0;c.forEachWhile(h=>{let f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.je.forEach((o,c)=>c.setReadTime(t));let s=new zr(t,e,this.Ye,this.je,r);return this.je=Xt(),this.Je=Cr(),this.He=Cr(),this.Ye=new tt(U),s}Xe(t,e){if(!this.rt(t))return;let r=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,r),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,r){if(!this.rt(t))return;let s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),r&&(this.je=this.je.insert(e,r))}removeTarget(t){this.ze.delete(t)}_t(t){let e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Kr,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new at(U),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new at(U),this.Je=this.Je.insert(t,e)),e}rt(t){let e=this.ot(t)!==null;return e||N("WatchChangeAggregator","Detected inactive target",t),e}ot(t){let e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Kr),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}};function Cr(){return new tt(F.comparator)}function Au(){return new tt(F.comparator)}var $f={asc:"ASCENDING",desc:"DESCENDING"},Kf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Qf={and:"AND",or:"OR"},$i=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Ki(n,t){return n.useProto3Json||nr(t)?t:{value:t}}function Qr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function xl(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Hf(n,t){return Qr(n,t.toTimestamp())}function At(n){return K(!!n,49232),L.fromTimestamp(function(e){let r=Ht(e);return new st(r.seconds,r.nanos)}(n))}function fa(n,t){return Qi(n,t).canonicalString()}function Qi(n,t){let e=function(s){return new Y(["projects",s.projectId,"databases",s.database])}(n).child("documents");return t===void 0?e:e.child(t)}function Nl(n){let t=Y.fromString(n);return K(Bl(t),10190,{key:t.toString()}),t}function Hr(n,t){return fa(n.databaseId,t.path)}function Bn(n,t){let e=Nl(t);if(e.get(1)!==n.databaseId.projectId)throw new k(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new k(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new F(Ol(e))}function kl(n,t){return fa(n.databaseId,t)}function Wf(n){let t=Nl(n);return t.length===4?Y.emptyPath():Ol(t)}function Hi(n){return new Y(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ol(n){return K(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function bu(n,t,e){return{name:Hr(n,t),fields:e.value.mapValue.fields}}function Jf(n,t){return"found"in t?function(r,s){K(!!s.found,43571),s.found.name,s.found.updateTime;let o=Bn(r,s.found.name),c=At(s.found.updateTime),l=s.found.createTime?At(s.found.createTime):L.min(),h=new It({mapValue:{fields:s.found.fields}});return bt.newFoundDocument(o,c,l,h)}(n,t):"missing"in t?function(r,s){K(!!s.missing,3894),K(!!s.readTime,22933);let o=Bn(r,s.missing),c=At(s.readTime);return bt.newNoDocument(o,c)}(n,t):M(7234,{result:t})}function Xf(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:M(39313,{state:f})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=function(f,g){return f.useProto3Json?(K(g===void 0||typeof g=="string",58123),_t.fromBase64String(g||"")):(K(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),_t.fromUint8Array(g||new Uint8Array))}(n,t.targetChange.resumeToken),c=t.targetChange.cause,l=c&&function(f){let g=f.code===void 0?S.UNKNOWN:Dl(f.code);return new k(g,f.message||"")}(c);e=new $r(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let s=Bn(n,r.document.name),o=At(r.document.updateTime),c=r.document.createTime?At(r.document.createTime):L.min(),l=new It({mapValue:{fields:r.document.fields}}),h=bt.newFoundDocument(s,o,c,l),f=r.targetIds||[],g=r.removedTargetIds||[];e=new Le(f,g,h.key,h)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let s=Bn(n,r.document),o=r.readTime?At(r.readTime):L.min(),c=bt.newNoDocument(s,o),l=r.removedTargetIds||[];e=new Le([],l,c.key,c)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let s=Bn(n,r.document),o=r.removedTargetIds||[];e=new Le([],o,s,null)}else{if(!("filter"in t))return M(11601,{Rt:t});{t.filter;let r=t.filter;r.targetId;let{count:s=0,unchangedNames:o}=r,c=new ji(s,o),l=r.targetId;e=new Gr(l,c)}}return e}function Ml(n,t){let e;if(t instanceof ve)e={update:bu(n,t.key,t.value)};else if(t instanceof Kn)e={delete:Hr(n,t.key)};else if(t instanceof Mt)e={update:bu(n,t.key,t.data),updateMask:om(t.fieldMask)};else{if(!(t instanceof jr))return M(16599,{Vt:t.type});e={verify:Hr(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(o,c){let l=c.transform;if(l instanceof Je)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Ee)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ie)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Xe)return{fieldPath:c.field.canonicalString(),increment:l.Ae};throw M(20930,{transform:c.transform})}(0,r))),t.precondition.isNone||(e.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:Hf(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:M(27497)}(n,t.precondition)),e}function Yf(n,t){return n&&n.length>0?(K(t!==void 0,14353),n.map(e=>function(s,o){let c=s.updateTime?At(s.updateTime):At(o);return c.isEqual(L.min())&&(c=At(o)),new Li(c,s.transformResults||[])}(e,t))):[]}function Zf(n,t){return{documents:[kl(n,t.path)]}}function tm(n,t){let e={structuredQuery:{}},r=t.path,s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=kl(n,s);let o=function(f){if(f.length!==0)return Ll(Ot.create(f,"and"))}(t.filters);o&&(e.structuredQuery.where=o);let c=function(f){if(f.length!==0)return f.map(g=>function(E){return{field:Oe(E.field),direction:rm(E.dir)}}(g))}(t.orderBy);c&&(e.structuredQuery.orderBy=c);let l=Ki(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(t.endAt)),{ft:e,parent:s}}function em(n){let t=Wf(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,s=null;if(r>0){K(r===1,65062);let g=e.from[0];g.allDescendants?s=g.collectionId:t=t.child(g.collectionId)}let o=[];e.where&&(o=function(T){let E=Fl(T);return E instanceof Ot&&ml(E)?E.getFilters():[E]}(e.where));let c=[];e.orderBy&&(c=function(T){return T.map(E=>function(x){return new Qe(Me(x.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(E))}(e.orderBy));let l=null;e.limit&&(l=function(T){let E;return E=typeof T=="object"?T.value:T,nr(E)?null:E}(e.limit));let h=null;e.startAt&&(h=function(T){let E=!!T.before,R=T.values||[];return new Ke(R,E)}(e.startAt));let f=null;return e.endAt&&(f=function(T){let E=!T.before,R=T.values||[];return new Ke(R,E)}(e.endAt)),Sf(t,s,c,o,l,"F",h,f)}function nm(n,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:s})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Fl(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=Me(e.unaryFilter.field);return it.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=Me(e.unaryFilter.field);return it.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=Me(e.unaryFilter.field);return it.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let c=Me(e.unaryFilter.field);return it.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}}(n):n.fieldFilter!==void 0?function(e){return it.create(Me(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return Ot.create(e.compositeFilter.filters.map(r=>Fl(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return M(1026)}}(e.compositeFilter.op))}(n):M(30097,{filter:n})}function rm(n){return $f[n]}function sm(n){return Kf[n]}function im(n){return Qf[n]}function Oe(n){return{fieldPath:n.canonicalString()}}function Me(n){return Tt.fromServerFormat(n.fieldPath)}function Ll(n){return n instanceof it?function(e){if(e.op==="=="){if(fu(e.value))return{unaryFilter:{field:Oe(e.field),op:"IS_NAN"}};if(du(e.value))return{unaryFilter:{field:Oe(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(fu(e.value))return{unaryFilter:{field:Oe(e.field),op:"IS_NOT_NAN"}};if(du(e.value))return{unaryFilter:{field:Oe(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Oe(e.field),op:sm(e.op),value:e.value}}}(n):n instanceof Ot?function(e){let r=e.getFilters().map(s=>Ll(s));return r.length===1?r[0]:{compositeFilter:{op:im(e.op),filters:r}}}(n):M(54877,{filter:n})}function om(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Bl(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Hn=class n{constructor(t,e,r,s,o=L.min(),c=L.min(),l=_t.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Wi=class{constructor(t){this.yt=t}};function am(n){let t=em({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Fi(t,t.limit,"L"):t}var Wr=class{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(X(t.integerValue));else if("doubleValue"in t){let r=X(t.doubleValue);isNaN(r)?this.Ft(e,13):(this.Ft(e,15),zn(r)?e.Mt(0):e.Mt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Ft(e,20),typeof r=="string"&&(r=Ht(r)),e.xt(`${r.seconds||""}`),e.Mt(r.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(Wt(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Ft(e,45),e.Mt(r.latitude||0),e.Mt(r.longitude||0)}else"mapValue"in t?hl(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):ll(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):M(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){let r=t.fields||{};this.Ft(e,55);for(let s of Object.keys(r))this.Ot(s,e),this.Ct(r[s],e)}kt(t,e){let r=t.fields||{};this.Ft(e,53);let s=ze,o=r[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(X(o)),this.Ot(s,e),this.Ct(r[s],e)}Qt(t,e){let r=t.values||[];this.Ft(e,50);for(let s of r)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),F.fromName(t).path.forEach(r=>{this.Ft(e,60),this.Ut(r,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}};Wr.Kt=new Wr;var Ji=class{constructor(){this.Cn=new Xi}addToCollectionParentIndex(t,e){return this.Cn.add(e),P.resolve()}getCollectionParents(t,e){return P.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return P.resolve()}deleteFieldIndex(t,e){return P.resolve()}deleteAllFieldIndexes(t){return P.resolve()}createTargetIndexes(t,e){return P.resolve()}getDocumentsMatchingTarget(t,e){return P.resolve(null)}getIndexType(t,e){return P.resolve(0)}getFieldIndexes(t,e){return P.resolve([])}getNextCollectionGroupToUpdate(t){return P.resolve(null)}getMinOffset(t,e){return P.resolve(we.min())}getMinOffsetFromCollectionGroup(t,e){return P.resolve(we.min())}updateCollectionGroup(t,e,r){return P.resolve()}updateIndexEntries(t,e){return P.resolve()}},Xi=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new at(Y.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new at(Y.comparator)).toArray()}};var Kp=new Uint8Array(0);var Su={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ul=41943040,St=class n{static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}};St.DEFAULT_COLLECTION_PERCENTILE=10,St.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,St.DEFAULT=new St(Ul,St.DEFAULT_COLLECTION_PERCENTILE,St.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),St.DISABLED=new St(-1,0,0);var Wn=class n{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new n(0)}static cr(){return new n(-1)}};var Ru="LruGarbageCollector",cm=1048576;function Pu([n,t],[e,r]){let s=U(n,e);return s===0?U(t,r):s}var Yi=class{constructor(t){this.Ir=t,this.buffer=new at(Pu),this.Er=0}dr(){return++this.Er}Ar(t){let e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();Pu(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},Zi=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){N(Ru,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>C(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){on(e)?N(Ru,"Ignoring IndexedDB error during garbage collection: ",e):yield sn(e)}yield this.Vr(3e5)}))}},to=class{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return P.resolve(ra.ce);let r=new Yi(e);return this.mr.forEachTarget(t,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(t,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.mr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(N("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Su)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Su):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let r,s,o,c,l,h,f,g=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(T=>(T>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${T}`),s=this.params.maximumSequenceNumbersToCollect):s=T,c=Date.now(),this.nthSequenceNumber(t,s))).next(T=>(r=T,l=Date.now(),this.removeTargets(t,r,e))).next(T=>(o=T,h=Date.now(),this.removeOrphanedDocuments(t,r))).next(T=>(f=Date.now(),Ne()<=G.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-g}ms
	Determined least recently used ${s} in `+(l-c)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${T} documents in `+(f-h)+`ms
Total Duration: ${f-g}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:T})))}};function um(n,t){return new to(n,t)}var eo=class{constructor(){this.changes=new Jt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,bt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?P.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var no=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var ro=class{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(r!==null&&Ln(r.mutation,s,Pt.empty(),st.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,q()).next(()=>r))}getLocalViewOfDocuments(t,e,r=q()){let s=ge();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,r).next(o=>{let c=Nn();return o.forEach((l,h)=>{c=c.insert(l,h.overlayedDocument)}),c}))}getOverlayedDocuments(t,e){let r=ge();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,q()))}populateOverlays(t,e,r){let s=[];return r.forEach(o=>{e.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(t,s).next(o=>{o.forEach((c,l)=>{e.set(c,l)})})}computeViews(t,e,r,s){let o=Xt(),c=Fn(),l=function(){return Fn()}();return e.forEach((h,f)=>{let g=r.get(f.key);s.has(f.key)&&(g===void 0||g.mutation instanceof Mt)?o=o.insert(f.key,f):g!==void 0?(c.set(f.key,g.mutation.getFieldMask()),Ln(g.mutation,f,g.mutation.getFieldMask(),st.now())):c.set(f.key,Pt.empty())}),this.recalculateAndSaveOverlays(t,o).next(h=>(h.forEach((f,g)=>c.set(f,g)),e.forEach((f,g)=>l.set(f,new no(g,c.get(f)??null))),l))}recalculateAndSaveOverlays(t,e){let r=Fn(),s=new tt((c,l)=>c-l),o=q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(c=>{for(let l of c)l.keys().forEach(h=>{let f=e.get(h);if(f===null)return;let g=r.get(h)||Pt.empty();g=l.applyToLocalView(f,g),r.set(h,g);let T=(s.get(l.batchId)||q()).add(h);s=s.insert(l.batchId,T)})}).next(()=>{let c=[],l=s.getReverseIterator();for(;l.hasNext();){let h=l.getNext(),f=h.key,g=h.value,T=vl();g.forEach(E=>{if(!o.has(E)){let R=Pl(e.get(E),r.get(E));R!==null&&T.set(E,R),o=o.add(E)}}),c.push(this.documentOverlayCache.saveOverlays(t,f,T))}return P.waitFor(c)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,s){return function(c){return F.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Rf(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next(o=>{let c=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):P.resolve(ge()),l=jn,h=o;return c.next(f=>P.forEach(f,(g,T)=>(l<T.largestBatchId&&(l=T.largestBatchId),o.get(g)?P.resolve():this.remoteDocumentCache.getEntry(t,g).next(E=>{h=h.insert(g,E)}))).next(()=>this.populateOverlays(t,f,o)).next(()=>this.computeViews(t,h,f,q())).next(g=>({batchId:l,changes:Il(g)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new F(e)).next(r=>{let s=Nn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){let o=e.collectionGroup,c=Nn();return this.indexManager.getCollectionParents(t,o).next(l=>P.forEach(l,h=>{let f=function(T,E){return new He(E,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt)}(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,f,r,s).next(g=>{g.forEach((T,E)=>{c=c.insert(T,E)})})}).next(()=>c))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(c=>(o=c,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s))).next(c=>{o.forEach((h,f)=>{let g=f.getKey();c.get(g)===null&&(c=c.insert(g,bt.newInvalidDocument(g)))});let l=Nn();return c.forEach((h,f)=>{let g=o.get(h);g!==void 0&&Ln(g.mutation,f,Pt.empty(),st.now()),ps(e,f)&&(l=l.insert(h,f))}),l})}};var so=class{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return P.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:At(s.createTime)}}(e)),P.resolve()}getNamedQuery(t,e){return P.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(s){return{name:s.name,query:am(s.bundledQuery),readTime:At(s.readTime)}}(e)),P.resolve()}};var io=class{constructor(){this.overlays=new tt(F.comparator),this.qr=new Map}getOverlay(t,e){return P.resolve(this.overlays.get(e))}getOverlays(t,e){let r=ge();return P.forEach(e,s=>this.getOverlay(t,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((s,o)=>{this.St(t,e,o)}),P.resolve()}removeOverlaysForBatchId(t,e,r){let s=this.qr.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.qr.delete(r)),P.resolve()}getOverlaysForCollection(t,e,r){let s=ge(),o=e.length+1,c=new F(e.child("")),l=this.overlays.getIteratorFrom(c);for(;l.hasNext();){let h=l.getNext().value,f=h.getKey();if(!e.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return P.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new tt((f,g)=>f-g),c=this.overlays.getIterator();for(;c.hasNext();){let f=c.getNext().value;if(f.getKey().getCollectionGroup()===e&&f.largestBatchId>r){let g=o.get(f.largestBatchId);g===null&&(g=ge(),o=o.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}let l=ge(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,g)=>l.set(f,g)),!(l.size()>=s)););return P.resolve(l)}St(t,e,r){let s=this.overlays.get(r.key);if(s!==null){let c=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,c)}this.overlays=this.overlays.insert(r.key,new qi(e,r));let o=this.qr.get(e);o===void 0&&(o=q(),this.qr.set(e,o)),this.qr.set(e,o.add(r.key))}};var oo=class{constructor(){this.sessionToken=_t.EMPTY_BYTE_STRING}getSessionToken(t){return P.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,P.resolve()}};var Jn=class{constructor(){this.Qr=new at(nt.$r),this.Ur=new at(nt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){let r=new nt(t,e);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Gr(new nt(t,e))}zr(t,e){t.forEach(r=>this.removeReference(r,e))}jr(t){let e=new F(new Y([])),r=new nt(e,t),s=new nt(e,t+1),o=[];return this.Ur.forEachInRange([r,s],c=>{this.Gr(c),o.push(c.key)}),o}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){let e=new F(new Y([])),r=new nt(e,t),s=new nt(e,t+1),o=q();return this.Ur.forEachInRange([r,s],c=>{o=o.add(c.key)}),o}containsKey(t){let e=new nt(t,0),r=this.Qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},nt=class{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return F.comparator(t.key,e.key)||U(t.Yr,e.Yr)}static Kr(t,e){return U(t.Yr,e.Yr)||F.comparator(t.key,e.key)}};var ao=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new at(nt.$r)}checkEmpty(t){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){let o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let c=new Bi(o,e,r,s);this.mutationQueue.push(c);for(let l of s)this.Zr=this.Zr.add(new nt(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return P.resolve(c)}lookupMutationBatch(t,e){return P.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,s=this.ei(r),o=s<0?0:s;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?sa:this.tr-1)}getAllMutationBatches(t){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new nt(e,0),s=new nt(e,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],c=>{let l=this.Xr(c.Yr);o.push(l)}),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new at(U);return e.forEach(s=>{let o=new nt(s,0),c=new nt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,c],l=>{r=r.add(l.Yr)})}),P.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,s=r.length+1,o=r;F.isDocumentKey(o)||(o=o.child(""));let c=new nt(new F(o),0),l=new at(U);return this.Zr.forEachWhile(h=>{let f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(l=l.add(h.Yr)),!0)},c),P.resolve(this.ti(l))}ti(t){let e=[];return t.forEach(r=>{let s=this.Xr(r);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){K(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return P.forEach(e.mutations,s=>{let o=new nt(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Zr=r})}ir(t){}containsKey(t,e){let r=new nt(e,0),s=this.Zr.firstAfterOrEqual(r);return P.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,P.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){let e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var co=class{constructor(t){this.ri=t,this.docs=function(){return new tt(F.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,s=this.docs.get(r),o=s?s.size:0,c=this.ri(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:c}),this.size+=c-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return P.resolve(r?r.document.mutableCopy():bt.newInvalidDocument(e))}getEntries(t,e){let r=Xt();return e.forEach(s=>{let o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():bt.newInvalidDocument(s))}),P.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Xt(),c=e.path,l=new F(c.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){let{key:f,value:{document:g}}=h.getNext();if(!c.isPrefixOf(f.path))break;f.path.length>c.length+1||af(of(g),r)<=0||(s.has(g.key)||ps(e,g))&&(o=o.insert(g.key,g.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(t,e,r,s){M(9500)}ii(t,e){return P.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new uo(this)}getSize(t){return P.resolve(this.size)}},uo=class extends eo{constructor(t){super(),this.Nr=t}applyChanges(t){let e=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(r)}),P.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}};var lo=class{constructor(t){this.persistence=t,this.si=new Jt(e=>ua(e),la),this.lastRemoteSnapshotVersion=L.min(),this.highestTargetId=0,this.oi=0,this._i=new Jn,this.targetCount=0,this.ai=Wn.ur()}forEachTarget(t,e){return this.si.forEach((r,s)=>e(s)),P.resolve()}getLastRemoteSnapshotVersion(t){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return P.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.oi&&(this.oi=e),P.resolve()}Pr(t){this.si.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.ai=new Wn(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,P.resolve()}updateTargetData(t,e){return this.Pr(e),P.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,P.resolve()}removeTargets(t,e,r){let s=0,o=[];return this.si.forEach((c,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.si.delete(c),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)}),P.waitFor(o).next(()=>s)}getTargetCount(t){return P.resolve(this.targetCount)}getTargetData(t,e){let r=this.si.get(e)||null;return P.resolve(r)}addMatchingKeys(t,e,r){return this._i.Wr(e,r),P.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);let s=this.persistence.referenceDelegate,o=[];return s&&e.forEach(c=>{o.push(s.markPotentiallyOrphaned(t,c))}),P.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),P.resolve()}getMatchingKeysForTargetId(t,e){let r=this._i.Hr(e);return P.resolve(r)}containsKey(t,e){return P.resolve(this._i.containsKey(e))}};var Jr=class{constructor(t,e){this.ui={},this.overlays={},this.ci=new ra(0),this.li=!1,this.li=!0,this.hi=new oo,this.referenceDelegate=t(this),this.Pi=new lo(this),this.indexManager=new Ji,this.remoteDocumentCache=function(s){return new co(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new Wi(e),this.Ii=new so(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new io,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ui[t.toKey()];return r||(r=new ao(e,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,r){N("MemoryPersistence","Starting transaction:",t);let s=new ho(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(o=>this.referenceDelegate.di(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Ai(t,e){return P.or(Object.values(this.ui).map(r=>()=>r.containsKey(t,e)))}},ho=class extends Ti{constructor(t){super(),this.currentSequenceNumber=t}},fo=class n{constructor(t){this.persistence=t,this.Ri=new Jn,this.Vi=null}static mi(t){return new n(t)}get fi(){if(this.Vi)return this.Vi;throw M(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.fi.delete(r.toString()),P.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.fi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),P.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(s=>this.fi.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(o=>this.fi.add(o.toString()))}).next(()=>r.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,r=>{let s=F.fromPath(r);return this.gi(t,s).next(o=>{o||e.removeEntry(s,L.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(r=>{r?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return P.or([()=>P.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}},Xr=class n{constructor(t,e){this.persistence=t,this.pi=new Jt(r=>hf(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=um(this,e)}static mi(t,e){return new n(t,e)}Ei(){}di(t){return P.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){let e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>e.next(s=>r+s))}wr(t){let e=0;return this.pr(t,r=>{e++}).next(()=>e)}pr(t,e){return P.forEach(this.pi,(r,s)=>this.br(t,r,s).next(o=>o?P.resolve():e(s)))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0,s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(t,c=>this.br(t,c,e).next(l=>{l||(r++,o.removeEntry(c,L.min()))})).next(()=>o.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),P.resolve()}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),P.resolve()}removeReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),P.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),P.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Dr(t.data.value)),e}br(t,e,r){return P.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.pi.get(e);return P.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var mo=class n{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Es=r,this.ds=s}static As(t,e){let r=q(),s=q();for(let o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new n(t,e.fromCache,r,s)}};var po=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var go=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return qc()?8:uf(Uc())>0?6:4}()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,s){let o={result:null};return this.ys(t,e).next(c=>{o.result=c}).next(()=>{if(!o.result)return this.ws(t,e,s,r).next(c=>{o.result=c})}).next(()=>{if(o.result)return;let c=new po;return this.Ss(t,e,c).next(l=>{if(o.result=l,this.Vs)return this.bs(t,e,c,l.size)})}).next(()=>o.result)}bs(t,e,r,s){return r.documentReadCount<this.fs?(Ne()<=G.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",ke(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(Ne()<=G.DEBUG&&N("QueryEngine","Query:",ke(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Ne()<=G.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",ke(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Nt(e))):P.resolve())}ys(t,e){if(yu(e))return P.resolve(null);let r=Nt(e);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Fi(e,null,"F"),r=Nt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(o=>{let c=q(...o);return this.ps.getDocuments(t,c).next(l=>this.indexManager.getMinOffset(t,r).next(h=>{let f=this.Ds(e,l);return this.Cs(e,f,c,h.readTime)?this.ys(t,Fi(e,null,"F")):this.vs(t,f,e,h)}))})))}ws(t,e,r,s){return yu(e)||s.isEqual(L.min())?P.resolve(null):this.ps.getDocuments(t,r).next(o=>{let c=this.Ds(e,o);return this.Cs(e,c,r,s)?P.resolve(null):(Ne()<=G.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ke(e)),this.vs(t,c,e,sf(s,jn)).next(l=>l))})}Ds(t,e){let r=new at(wl(t));return e.forEach((s,o)=>{ps(t,o)&&(r=r.add(o))}),r}Cs(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(t,e,r){return Ne()<=G.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",ke(e)),this.ps.getDocumentsMatchingQuery(t,e,we.min(),r)}vs(t,e,r,s){return this.ps.getDocumentsMatchingQuery(t,r,s).next(o=>(e.forEach(c=>{o=o.insert(c.key,c)}),o))}};var ma="LocalStore",lm=3e8,yo=class{constructor(t,e,r,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new tt(U),this.xs=new Jt(o=>ua(o),la),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ro(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}};function hm(n,t,e,r){return new yo(n,t,e,r)}function ql(n,t){return C(this,null,function*(){let e=B(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,e.Bs(t),e.mutationQueue.getAllMutationBatches(r))).next(o=>{let c=[],l=[],h=q();for(let f of s){c.push(f.batchId);for(let g of f.mutations)h=h.add(g.key)}for(let f of o){l.push(f.batchId);for(let g of f.mutations)h=h.add(g.key)}return e.localDocuments.getDocuments(r,h).next(f=>({Ls:f,removedBatchIds:c,addedBatchIds:l}))})})})}function dm(n,t){let e=B(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=t.batch.keys(),o=e.Ns.newChangeBuffer({trackRemovals:!0});return function(l,h,f,g){let T=f.batch,E=T.keys(),R=P.resolve();return E.forEach(x=>{R=R.next(()=>g.getEntry(h,x)).next(O=>{let D=f.docVersions.get(x);K(D!==null,48541),O.version.compareTo(D)<0&&(T.applyToRemoteDocument(O,f),O.isValidDocument()&&(O.setReadTime(f.commitVersion),g.addEntry(O)))})}),R.next(()=>l.mutationQueue.removeMutationBatch(h,T))}(e,r,t,o).next(()=>o.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let h=q();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h}(t))).next(()=>e.localDocuments.getDocuments(r,s))})}function jl(n){let t=B(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function fm(n,t){let e=B(n),r=t.snapshotVersion,s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let c=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;let l=[];t.targetChanges.forEach((g,T)=>{let E=s.get(T);if(!E)return;l.push(e.Pi.removeMatchingKeys(o,g.removedDocuments,T).next(()=>e.Pi.addMatchingKeys(o,g.addedDocuments,T)));let R=E.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(T)!==null?R=R.withResumeToken(_t.EMPTY_BYTE_STRING,L.min()).withLastLimboFreeSnapshotVersion(L.min()):g.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(g.resumeToken,r)),s=s.insert(T,R),function(O,D,Q){return O.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=lm?!0:Q.addedDocuments.size+Q.modifiedDocuments.size+Q.removedDocuments.size>0}(E,R,g)&&l.push(e.Pi.updateTargetData(o,R))});let h=Xt(),f=q();if(t.documentUpdates.forEach(g=>{t.resolvedLimboDocuments.has(g)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,g))}),l.push(mm(o,c,t.documentUpdates).next(g=>{h=g.ks,f=g.qs})),!r.isEqual(L.min())){let g=e.Pi.getLastRemoteSnapshotVersion(o).next(T=>e.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(g)}return P.waitFor(l).next(()=>c.apply(o)).next(()=>e.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(e.Ms=s,o))}function mm(n,t,e){let r=q(),s=q();return e.forEach(o=>r=r.add(o)),t.getEntries(n,r).next(o=>{let c=Xt();return e.forEach((l,h)=>{let f=o.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(L.min())?(t.removeEntry(l,h.readTime),c=c.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(t.addEntry(h),c=c.insert(l,h)):N(ma,"Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)}),{ks:c,qs:s}})}function pm(n,t){let e=B(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=sa),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function gm(n,t){let e=B(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return e.Pi.getTargetData(r,t).next(o=>o?(s=o,P.resolve(s)):e.Pi.allocateTargetId(r).next(c=>(s=new Hn(t,c,"TargetPurposeListen",r.currentSequenceNumber),e.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=e.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(r.targetId,r),e.xs.set(t,r.targetId)),r})}function _o(n,t,e){return C(this,null,function*(){let r=B(n),s=r.Ms.get(t),o=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",o,c=>r.persistence.referenceDelegate.removeTarget(c,s)))}catch(c){if(!on(c))throw c;N(ma,`Failed to update sequence numbers for target ${t}: ${c}`)}r.Ms=r.Ms.remove(t),r.xs.delete(s.target)})}function Cu(n,t,e){let r=B(n),s=L.min(),o=q();return r.persistence.runTransaction("Execute query","readwrite",c=>function(h,f,g){let T=B(h),E=T.xs.get(g);return E!==void 0?P.resolve(T.Ms.get(E)):T.Pi.getTargetData(f,g)}(r,c,Nt(t)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(c,l.targetId).next(h=>{o=h})}).next(()=>r.Fs.getDocumentsMatchingQuery(c,t,e?s:L.min(),e?o:q())).next(l=>(ym(r,Cf(t),l),{documents:l,Qs:o})))}function ym(n,t,e){let r=n.Os.get(t)||L.min();e.forEach((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Os.set(t,r)}var Yr=class{constructor(){this.activeTargetIds=Of()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var wo=class{constructor(){this.Mo=new Yr,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,r){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Yr,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Eo=class{Oo(t){}shutdown(){}};var Vu="ConnectivityMonitor",Zr=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){N(Vu,"Network connectivity changed: AVAILABLE");for(let t of this.qo)t(0)}ko(){N(Vu,"Network connectivity changed: UNAVAILABLE");for(let t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Vr=null;function Io(){return Vr===null?Vr=function(){return 268435456+Math.round(2147483648*Math.random())}():Vr++,"0x"+Vr.toString(16)}var di="RestConnection",_m={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},vo=class{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Br?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(t,e,r,s,o){let c=Io(),l=this.zo(t,e.toUriEncodedString());N(di,`Sending RPC '${t}' ${c}:`,l,r);let h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);let{host:f}=new URL(l),g=Tr(f);return this.Jo(t,l,h,r,g).then(T=>(N(di,`Received RPC '${t}' ${c}: `,T),T),T=>{throw Ue(di,`RPC '${t}' ${c} failed with error: `,T,"url: ",l,"request:",r),T})}Ho(t,e,r,s,o,c){return this.Go(t,e,r,s,o)}jo(t,e,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+rn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}zo(t,e){let r=_m[t];return`${this.Uo}/v1/${e}:${r}`}terminate(){}};var To=class{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}};var gt="WebChannelConnection",Ao=class extends vo{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,s,o){let c=Io();return new Promise((l,h)=>{let f=new oi;f.setWithCredentials(!0),f.listenOnce(ai.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case xn.NO_ERROR:let T=f.getResponseJson();N(gt,`XHR for RPC '${t}' ${c} received:`,JSON.stringify(T)),l(T);break;case xn.TIMEOUT:N(gt,`RPC '${t}' ${c} timed out`),h(new k(S.DEADLINE_EXCEEDED,"Request time out"));break;case xn.HTTP_ERROR:let E=f.getStatus();if(N(gt,`RPC '${t}' ${c} failed with status:`,E,"response text:",f.getResponseText()),E>0){let R=f.getResponseJson();Array.isArray(R)&&(R=R[0]);let x=R?.error;if(x&&x.status&&x.message){let O=function(Q){let j=Q.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(j)>=0?j:S.UNKNOWN}(x.status);h(new k(O,x.message))}else h(new k(S.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new k(S.UNAVAILABLE,"Connection failed."));break;default:M(9055,{l_:t,streamId:c,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{N(gt,`RPC '${t}' ${c} completed.`)}});let g=JSON.stringify(s);N(gt,`RPC '${t}' ${c} sending request:`,s),f.send(e,"POST",g,r,15)})}T_(t,e,r){let s=Io(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],c=li(),l=ui(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;let g=o.join("");N(gt,`Creating RPC '${t}' stream ${s}: ${g}`,h);let T=c.createWebChannel(g,h);this.I_(T);let E=!1,R=!1,x=new To({Yo:D=>{R?N(gt,`Not sending because RPC '${t}' stream ${s} is closed:`,D):(E||(N(gt,`Opening RPC '${t}' stream ${s} transport.`),T.open(),E=!0),N(gt,`RPC '${t}' stream ${s} sending:`,D),T.send(D))},Zo:()=>T.close()}),O=(D,Q,j)=>{D.listen(Q,z=>{try{j(z)}catch(ct){setTimeout(()=>{throw ct},0)}})};return O(T,xe.EventType.OPEN,()=>{R||(N(gt,`RPC '${t}' stream ${s} transport opened.`),x.o_())}),O(T,xe.EventType.CLOSE,()=>{R||(R=!0,N(gt,`RPC '${t}' stream ${s} transport closed`),x.a_(),this.E_(T))}),O(T,xe.EventType.ERROR,D=>{R||(R=!0,Ue(gt,`RPC '${t}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),x.a_(new k(S.UNAVAILABLE,"The operation could not be completed")))}),O(T,xe.EventType.MESSAGE,D=>{if(!R){let Q=D.data[0];K(!!Q,16349);let j=Q,z=j?.error||j[0]?.error;if(z){N(gt,`RPC '${t}' stream ${s} received error:`,z);let ct=z.status,Dt=function(m){let y=et[m];if(y!==void 0)return Dl(y)}(ct),ht=z.message;Dt===void 0&&(Dt=S.INTERNAL,ht="Unknown error status: "+ct+" with message "+z.message),R=!0,x.a_(new k(Dt,ht)),T.close()}else N(gt,`RPC '${t}' stream ${s} received:`,Q),x.u_(Q)}}),O(l,ci.STAT_EVENT,D=>{D.stat===Rr.PROXY?N(gt,`RPC '${t}' stream ${s} detected buffering proxy`):D.stat===Rr.NOPROXY&&N(gt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{x.__()},0),x}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}};function fi(){return typeof document<"u"?document:null}function gs(n){return new $i(n,!0)}var Xn=class{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Mi=t,this.timerId=e,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();let e=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-r);s>0&&N("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var Du="PersistentStream",ts=class{constructor(t,e,r,s,o,c,l,h){this.Mi=t,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Xn(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return C(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}k_(){return C(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(t,e){return C(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===S.RESOURCE_EXHAUSTED?(Qt(e.toString()),Qt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.r_(e)})}K_(){}auth(){this.state=1;let t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===e&&this.G_(r,s)},r=>{t(()=>{let s=new k(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(t,e){let r=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(()=>C(this,null,function*(){this.state=0,this.start()}))}z_(t){return N(Du,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(N(Du,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},bo=class extends ts{constructor(t,e,r,s,o,c){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,c),this.serializer=o}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();let e=Xf(this.serializer,t),r=function(o){if(!("targetChange"in o))return L.min();let c=o.targetChange;return c.targetIds&&c.targetIds.length?L.min():c.readTime?At(c.readTime):L.min()}(t);return this.listener.H_(e,r)}Y_(t){let e={};e.database=Hi(this.serializer),e.addTarget=function(o,c){let l,h=c.target;if(l=Mi(h)?{documents:Zf(o,h)}:{query:tm(o,h).ft},l.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){l.resumeToken=xl(o,c.resumeToken);let f=Ki(o,c.expectedCount);f!==null&&(l.expectedCount=f)}else if(c.snapshotVersion.compareTo(L.min())>0){l.readTime=Qr(o,c.snapshotVersion.toTimestamp());let f=Ki(o,c.expectedCount);f!==null&&(l.expectedCount=f)}return l}(this.serializer,t);let r=nm(this.serializer,t);r&&(e.labels=r),this.q_(e)}Z_(t){let e={};e.database=Hi(this.serializer),e.removeTarget=t,this.q_(e)}},So=class extends ts{constructor(t,e,r,s,o,c){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,c),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return K(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,K(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){K(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();let e=Yf(t.writeResults,t.commitTime),r=At(t.commitTime);return this.listener.na(r,e)}ra(){let t={};t.database=Hi(this.serializer),this.q_(t)}ea(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>Ml(this.serializer,r))};this.q_(e)}};var Ro=class{},Po=class extends Ro{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new k(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Go(t,Qi(e,r),s,o,c)).catch(o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(S.UNKNOWN,o.toString())})}Ho(t,e,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,l])=>this.connection.Ho(t,Qi(e,r),s,c,l,o)).catch(c=>{throw c.name==="FirebaseError"?(c.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new k(S.UNKNOWN,c.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},Co=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Qt(e),this.aa=!1):N("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var Te="RemoteStore",Vo=class{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo(c=>{r.enqueueAndForget(()=>C(this,null,function*(){Ae(this)&&(N(Te,"Restarting streams for network reachability change."),yield function(h){return C(this,null,function*(){let f=B(h);f.Ea.add(4),yield rr(f),f.Ra.set("Unknown"),f.Ea.delete(4),yield ys(f)})}(this))}))}),this.Ra=new Co(r,s)}};function ys(n){return C(this,null,function*(){if(Ae(n))for(let t of n.da)yield t(!0)})}function rr(n){return C(this,null,function*(){for(let t of n.da)yield t(!1)})}function zl(n,t){let e=B(n);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),_a(e)?ya(e):an(e).O_()&&ga(e,t))}function pa(n,t){let e=B(n),r=an(e);e.Ia.delete(t),r.O_()&&Gl(e,t),e.Ia.size===0&&(r.O_()?r.L_():Ae(e)&&e.Ra.set("Unknown"))}function ga(n,t){if(n.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(L.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}an(n).Y_(t)}function Gl(n,t){n.Va.Ue(t),an(n).Z_(t)}function ya(n){n.Va=new Gi({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),At:t=>n.Ia.get(t)||null,ht:()=>n.datastore.serializer.databaseId}),an(n).start(),n.Ra.ua()}function _a(n){return Ae(n)&&!an(n).x_()&&n.Ia.size>0}function Ae(n){return B(n).Ea.size===0}function $l(n){n.Va=void 0}function wm(n){return C(this,null,function*(){n.Ra.set("Online")})}function Em(n){return C(this,null,function*(){n.Ia.forEach((t,e)=>{ga(n,t)})})}function Im(n,t){return C(this,null,function*(){$l(n),_a(n)?(n.Ra.ha(t),ya(n)):n.Ra.set("Unknown")})}function vm(n,t,e){return C(this,null,function*(){if(n.Ra.set("Online"),t instanceof $r&&t.state===2&&t.cause)try{yield function(s,o){return C(this,null,function*(){let c=o.cause;for(let l of o.targetIds)s.Ia.has(l)&&(yield s.remoteSyncer.rejectListen(l,c),s.Ia.delete(l),s.Va.removeTarget(l))})}(n,t)}catch(r){N(Te,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield es(n,r)}else if(t instanceof Le?n.Va.Ze(t):t instanceof Gr?n.Va.st(t):n.Va.tt(t),!e.isEqual(L.min()))try{let r=yield jl(n.localStore);e.compareTo(r)>=0&&(yield function(o,c){let l=o.Va.Tt(c);return l.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){let g=o.Ia.get(f);g&&o.Ia.set(f,g.withResumeToken(h.resumeToken,c))}}),l.targetMismatches.forEach((h,f)=>{let g=o.Ia.get(h);if(!g)return;o.Ia.set(h,g.withResumeToken(_t.EMPTY_BYTE_STRING,g.snapshotVersion)),Gl(o,h);let T=new Hn(g.target,h,f,g.sequenceNumber);ga(o,T)}),o.remoteSyncer.applyRemoteEvent(l)}(n,e))}catch(r){N(Te,"Failed to raise snapshot:",r),yield es(n,r)}})}function es(n,t,e){return C(this,null,function*(){if(!on(t))throw t;n.Ea.add(1),yield rr(n),n.Ra.set("Offline"),e||(e=()=>jl(n.localStore)),n.asyncQueue.enqueueRetryable(()=>C(null,null,function*(){N(Te,"Retrying IndexedDB access"),yield e(),n.Ea.delete(1),yield ys(n)}))})}function Kl(n,t){return t().catch(e=>es(n,e,t))}function _s(n){return C(this,null,function*(){let t=B(n),e=ce(t),r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:sa;for(;Tm(t);)try{let s=yield pm(t.localStore,r);if(s===null){t.Ta.length===0&&e.L_();break}r=s.batchId,Am(t,s)}catch(s){yield es(t,s)}Ql(t)&&Hl(t)})}function Tm(n){return Ae(n)&&n.Ta.length<10}function Am(n,t){n.Ta.push(t);let e=ce(n);e.O_()&&e.X_&&e.ea(t.mutations)}function Ql(n){return Ae(n)&&!ce(n).x_()&&n.Ta.length>0}function Hl(n){ce(n).start()}function bm(n){return C(this,null,function*(){ce(n).ra()})}function Sm(n){return C(this,null,function*(){let t=ce(n);for(let e of n.Ta)t.ea(e.mutations)})}function Rm(n,t,e){return C(this,null,function*(){let r=n.Ta.shift(),s=Ui.from(r,t,e);yield Kl(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield _s(n)})}function Pm(n,t){return C(this,null,function*(){t&&ce(n).X_&&(yield function(r,s){return C(this,null,function*(){if(function(c){return Vl(c)&&c!==S.ABORTED}(s.code)){let o=r.Ta.shift();ce(r).B_(),yield Kl(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield _s(r)}})}(n,t)),Ql(n)&&Hl(n)})}function xu(n,t){return C(this,null,function*(){let e=B(n);e.asyncQueue.verifyOperationInProgress(),N(Te,"RemoteStore received new credentials");let r=Ae(e);e.Ea.add(3),yield rr(e),r&&e.Ra.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),yield ys(e)})}function Cm(n,t){return C(this,null,function*(){let e=B(n);t?(e.Ea.delete(2),yield ys(e)):t||(e.Ea.add(2),yield rr(e),e.Ra.set("Unknown"))})}function an(n){return n.ma||(n.ma=function(e,r,s){let o=B(e);return o.sa(),new bo(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Xo:wm.bind(null,n),t_:Em.bind(null,n),r_:Im.bind(null,n),H_:vm.bind(null,n)}),n.da.push(t=>C(null,null,function*(){t?(n.ma.B_(),_a(n)?ya(n):n.Ra.set("Unknown")):(yield n.ma.stop(),$l(n))}))),n.ma}function ce(n){return n.fa||(n.fa=function(e,r,s){let o=B(e);return o.sa(),new So(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:bm.bind(null,n),r_:Pm.bind(null,n),ta:Sm.bind(null,n),na:Rm.bind(null,n)}),n.da.push(t=>C(null,null,function*(){t?(n.fa.B_(),yield _s(n)):(yield n.fa.stop(),n.Ta.length>0&&(N(Te,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}var Do=class n{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new Vt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(c=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){let c=Date.now()+r,l=new n(t,e,c,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function wa(n,t){if(Qt("AsyncQueue",`${t}: ${n}`),on(n))return new k(S.UNAVAILABLE,`${t}: ${n}`);throw n}var ns=class n{static emptySet(t){return new n(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||F.comparator(e.key,r.key):(e,r)=>F.comparator(e.key,r.key),this.keyedMap=Nn(),this.sortedSet=new tt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var rs=class{constructor(){this.ga=new tt(F.comparator)}track(t){let e=t.doc.key,r=this.ga.get(e);r?t.type!==0&&r.type===3?this.ga=this.ga.insert(e,t):t.type===3&&r.type!==1?this.ga=this.ga.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.ga=this.ga.remove(e):t.type===1&&r.type===2?this.ga=this.ga.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):M(63341,{Rt:t,pa:r}):this.ga=this.ga.insert(e,t)}ya(){let t=[];return this.ga.inorderTraversal((e,r)=>{t.push(r)}),t}},Ze=class n{constructor(t,e,r,s,o,c,l,h,f){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=c,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(t,e,r,s,o){let c=[];return e.forEach(l=>{c.push({type:0,doc:l})}),new n(t,e,ns.emptySet(e),c,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ms(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}};var xo=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}},No=class{constructor(){this.queries=Nu(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){let s=B(e),o=s.queries;s.queries=Nu(),o.forEach((c,l)=>{for(let h of l.Sa)h.onError(r)})})(this,new k(S.ABORTED,"Firestore shutting down"))}};function Nu(){return new Jt(n=>_l(n),ms)}function Vm(n,t){return C(this,null,function*(){let e=B(n),r=3,s=t.query,o=e.queries.get(s);o?!o.ba()&&t.Da()&&(r=2):(o=new xo,r=t.Da()?0:1);try{switch(r){case 0:o.wa=yield e.onListen(s,!0);break;case 1:o.wa=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(c){let l=wa(c,`Initialization of query '${ke(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.Sa.push(t),t.va(e.onlineState),o.wa&&t.Fa(o.wa)&&Ea(e)})}function Dm(n,t){return C(this,null,function*(){let e=B(n),r=t.query,s=3,o=e.queries.get(r);if(o){let c=o.Sa.indexOf(t);c>=0&&(o.Sa.splice(c,1),o.Sa.length===0?s=t.Da()?0:1:!o.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function xm(n,t){let e=B(n),r=!1;for(let s of t){let o=s.query,c=e.queries.get(o);if(c){for(let l of c.Sa)l.Fa(s)&&(r=!0);c.wa=s}}r&&Ea(e)}function Nm(n,t,e){let r=B(n),s=r.queries.get(t);if(s)for(let o of s.Sa)o.onError(e);r.queries.delete(t)}function Ea(n){n.Ca.forEach(t=>{t.next()})}var ko,ku;(ku=ko||(ko={})).Ma="default",ku.Cache="cache";var Oo=class{constructor(t,e,r){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){let r=[];for(let s of t.docChanges)s.type!==3&&r.push(s);t=new Ze(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;let r=e!=="Offline";return(!this.options.qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;let e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=Ze.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==ko.Cache}};var ss=class{constructor(t){this.key=t}},is=class{constructor(t){this.key=t}},Mo=class{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=q(),this.mutatedKeys=q(),this.eu=wl(t),this.tu=new ns(this.eu)}get nu(){return this.Ya}ru(t,e){let r=e?e.iu:new rs,s=e?e.tu:this.tu,o=e?e.mutatedKeys:this.mutatedKeys,c=s,l=!1,h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((g,T)=>{let E=s.get(g),R=ps(this.query,T)?T:null,x=!!E&&this.mutatedKeys.has(E.key),O=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),D=!1;E&&R?E.data.isEqual(R.data)?x!==O&&(r.track({type:3,doc:R}),D=!0):this.su(E,R)||(r.track({type:2,doc:R}),D=!0,(h&&this.eu(R,h)>0||f&&this.eu(R,f)<0)&&(l=!0)):!E&&R?(r.track({type:0,doc:R}),D=!0):E&&!R&&(r.track({type:1,doc:E}),D=!0,(h||f)&&(l=!0)),D&&(R?(c=c.add(R),o=O?o.add(g):o.delete(g)):(c=c.delete(g),o=o.delete(g)))}),this.query.limit!==null)for(;c.size>this.query.limit;){let g=this.query.limitType==="F"?c.last():c.first();c=c.delete(g.key),o=o.delete(g.key),r.track({type:1,doc:g})}return{tu:c,iu:r,Cs:l,mutatedKeys:o}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){let o=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;let c=t.iu.ya();c.sort((g,T)=>function(R,x){let O=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{Rt:D})}};return O(R)-O(x)}(g.type,T.type)||this.eu(g.doc,T.doc)),this.ou(r),s=s??!1;let l=e&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,f=h!==this.Za;return this.Za=h,c.length!==0||f?{snapshot:new Ze(this.query,t.tu,o,c,t.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new rs,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=t.current)}_u(){if(!this.current)return[];let t=this.Xa;this.Xa=q(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});let e=[];return t.forEach(r=>{this.Xa.has(r)||e.push(new is(r))}),this.Xa.forEach(r=>{t.has(r)||e.push(new ss(r))}),e}cu(t){this.Ya=t.Qs,this.Xa=q();let e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return Ze.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},Ia="SyncEngine",Fo=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},Lo=class{constructor(t){this.key=t,this.hu=!1}},Bo=class{constructor(t,e,r,s,o,c){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=c,this.Pu={},this.Tu=new Jt(l=>_l(l),ms),this.Iu=new Map,this.Eu=new Set,this.du=new tt(F.comparator),this.Au=new Map,this.Ru=new Jn,this.Vu={},this.mu=new Map,this.fu=Wn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function km(n,t,e=!0){return C(this,null,function*(){let r=th(n),s,o=r.Tu.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=yield Wl(r,t,e,!0),s})}function Om(n,t){return C(this,null,function*(){let e=th(n);yield Wl(e,t,!0,!1)})}function Wl(n,t,e,r){return C(this,null,function*(){let s=yield gm(n.localStore,Nt(t)),o=s.targetId,c=n.sharedClientState.addLocalQueryTarget(o,e),l;return r&&(l=yield Mm(n,t,o,c==="current",s.resumeToken)),n.isPrimaryClient&&e&&zl(n.remoteStore,s),l})}function Mm(n,t,e,r,s){return C(this,null,function*(){n.pu=(T,E,R)=>function(O,D,Q,j){return C(this,null,function*(){let z=D.view.ru(Q);z.Cs&&(z=yield Cu(O.localStore,D.query,!1).then(({documents:v})=>D.view.ru(v,z)));let ct=j&&j.targetChanges.get(D.targetId),Dt=j&&j.targetMismatches.get(D.targetId)!=null,ht=D.view.applyChanges(z,O.isPrimaryClient,ct,Dt);return Mu(O,D.targetId,ht.au),ht.snapshot})}(n,T,E,R);let o=yield Cu(n.localStore,t,!0),c=new Mo(t,o.Qs),l=c.ru(o.documents),h=Qn.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),f=c.applyChanges(l,n.isPrimaryClient,h);Mu(n,e,f.au);let g=new Fo(t,e,c);return n.Tu.set(t,g),n.Iu.has(e)?n.Iu.get(e).push(t):n.Iu.set(e,[t]),f.snapshot})}function Fm(n,t,e){return C(this,null,function*(){let r=B(n),s=r.Tu.get(t),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter(c=>!ms(c,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||(yield _o(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),e&&pa(r.remoteStore,s.targetId),Uo(r,s.targetId)}).catch(sn))):(Uo(r,s.targetId),yield _o(r.localStore,s.targetId,!0))})}function Lm(n,t){return C(this,null,function*(){let e=B(n),r=e.Tu.get(t),s=e.Iu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),pa(e.remoteStore,r.targetId))})}function Bm(n,t,e){return C(this,null,function*(){let r=Km(n);try{let s=yield function(c,l){let h=B(c),f=st.now(),g=l.reduce((R,x)=>R.add(x.key),q()),T,E;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let x=Xt(),O=q();return h.Ns.getEntries(R,g).next(D=>{x=D,x.forEach((Q,j)=>{j.isValidDocument()||(O=O.add(Q))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,x)).next(D=>{T=D;let Q=[];for(let j of l){let z=qf(j,T.get(j.key).overlayedDocument);z!=null&&Q.push(new Mt(j.key,z,dl(z.value.mapValue),Rt.exists(!0)))}return h.mutationQueue.addMutationBatch(R,f,Q,l)}).next(D=>{E=D;let Q=D.applyToLocalDocumentSet(T,O);return h.documentOverlayCache.saveOverlays(R,D.batchId,Q)})}).then(()=>({batchId:E.batchId,changes:Il(T)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),function(c,l,h){let f=c.Vu[c.currentUser.toKey()];f||(f=new tt(U)),f=f.insert(l,h),c.Vu[c.currentUser.toKey()]=f}(r,s.batchId,e),yield sr(r,s.changes),yield _s(r.remoteStore)}catch(s){let o=wa(s,"Failed to persist write");e.reject(o)}})}function Jl(n,t){return C(this,null,function*(){let e=B(n);try{let r=yield fm(e.localStore,t);t.targetChanges.forEach((s,o)=>{let c=e.Au.get(o);c&&(K(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?c.hu=!0:s.modifiedDocuments.size>0?K(c.hu,14607):s.removedDocuments.size>0&&(K(c.hu,42227),c.hu=!1))}),yield sr(e,r,t)}catch(r){yield sn(r)}})}function Ou(n,t,e){let r=B(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let s=[];r.Tu.forEach((o,c)=>{let l=c.view.va(t);l.snapshot&&s.push(l.snapshot)}),function(c,l){let h=B(c);h.onlineState=l;let f=!1;h.queries.forEach((g,T)=>{for(let E of T.Sa)E.va(l)&&(f=!0)}),f&&Ea(h)}(r.eventManager,t),s.length&&r.Pu.H_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Um(n,t,e){return C(this,null,function*(){let r=B(n);r.sharedClientState.updateQueryState(t,"rejected",e);let s=r.Au.get(t),o=s&&s.key;if(o){let c=new tt(F.comparator);c=c.insert(o,bt.newNoDocument(o,L.min()));let l=q().add(o),h=new zr(L.min(),new Map,new tt(U),c,l);yield Jl(r,h),r.du=r.du.remove(o),r.Au.delete(t),va(r)}else yield _o(r.localStore,t,!1).then(()=>Uo(r,t,e)).catch(sn)})}function qm(n,t){return C(this,null,function*(){let e=B(n),r=t.batch.batchId;try{let s=yield dm(e.localStore,t);Yl(e,r,null),Xl(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield sr(e,s)}catch(s){yield sn(s)}})}function jm(n,t,e){return C(this,null,function*(){let r=B(n);try{let s=yield function(c,l){let h=B(c);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let g;return h.mutationQueue.lookupMutationBatch(f,l).next(T=>(K(T!==null,37113),g=T.keys(),h.mutationQueue.removeMutationBatch(f,T))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,g,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,g)).next(()=>h.localDocuments.getDocuments(f,g))})}(r.localStore,t);Yl(r,t,e),Xl(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield sr(r,s)}catch(s){yield sn(s)}})}function Xl(n,t){(n.mu.get(t)||[]).forEach(e=>{e.resolve()}),n.mu.delete(t)}function Yl(n,t,e){let r=B(n),s=r.Vu[r.currentUser.toKey()];if(s){let o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Vu[r.currentUser.toKey()]=s}}function Uo(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Iu.get(t))n.Tu.delete(r),e&&n.Pu.yu(r,e);n.Iu.delete(t),n.isPrimaryClient&&n.Ru.jr(t).forEach(r=>{n.Ru.containsKey(r)||Zl(n,r)})}function Zl(n,t){n.Eu.delete(t.path.canonicalString());let e=n.du.get(t);e!==null&&(pa(n.remoteStore,e),n.du=n.du.remove(t),n.Au.delete(e),va(n))}function Mu(n,t,e){for(let r of e)r instanceof ss?(n.Ru.addReference(r.key,t),zm(n,r)):r instanceof is?(N(Ia,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,t),n.Ru.containsKey(r.key)||Zl(n,r.key)):M(19791,{wu:r})}function zm(n,t){let e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Eu.has(r)||(N(Ia,"New document in limbo: "+e),n.Eu.add(r),va(n))}function va(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let t=n.Eu.values().next().value;n.Eu.delete(t);let e=new F(Y.fromString(t)),r=n.fu.next();n.Au.set(r,new Lo(e)),n.du=n.du.insert(e,r),zl(n.remoteStore,new Hn(Nt(ha(e.path)),r,"TargetPurposeLimboResolution",ra.ce))}}function sr(n,t,e){return C(this,null,function*(){let r=B(n),s=[],o=[],c=[];r.Tu.isEmpty()||(r.Tu.forEach((l,h)=>{c.push(r.pu(h,t,e).then(f=>{if((f||e)&&r.isPrimaryClient){let g=f?!f.fromCache:e?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,g?"current":"not-current")}if(f){s.push(f);let g=mo.As(h.targetId,f);o.push(g)}}))}),yield Promise.all(c),r.Pu.H_(s),yield function(h,f){return C(this,null,function*(){let g=B(h);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",T=>P.forEach(f,E=>P.forEach(E.Es,R=>g.persistence.referenceDelegate.addReference(T,E.targetId,R)).next(()=>P.forEach(E.ds,R=>g.persistence.referenceDelegate.removeReference(T,E.targetId,R)))))}catch(T){if(!on(T))throw T;N(ma,"Failed to update sequence numbers: "+T)}for(let T of f){let E=T.targetId;if(!T.fromCache){let R=g.Ms.get(E),x=R.snapshotVersion,O=R.withLastLimboFreeSnapshotVersion(x);g.Ms=g.Ms.insert(E,O)}}})}(r.localStore,o))})}function Gm(n,t){return C(this,null,function*(){let e=B(n);if(!e.currentUser.isEqual(t)){N(Ia,"User change. New user:",t.toKey());let r=yield ql(e.localStore,t);e.currentUser=t,function(o,c){o.mu.forEach(l=>{l.forEach(h=>{h.reject(new k(S.CANCELLED,c))})}),o.mu.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield sr(e,r.Ls)}})}function $m(n,t){let e=B(n),r=e.Au.get(t);if(r&&r.hu)return q().add(r.key);{let s=q(),o=e.Iu.get(t);if(!o)return s;for(let c of o){let l=e.Tu.get(c);s=s.unionWith(l.view.nu)}return s}}function th(n){let t=B(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Jl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=$m.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Um.bind(null,t),t.Pu.H_=xm.bind(null,t.eventManager),t.Pu.yu=Nm.bind(null,t.eventManager),t}function Km(n){let t=B(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=qm.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=jm.bind(null,t),t}var eh=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){this.serializer=gs(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)})}Fu(e,r){return null}Mu(e,r){return null}vu(e){return hm(this.persistence,new go,e.initialUser,this.serializer)}Cu(e){return new Jr(fo.mi,this.serializer)}Du(e){return new wo}terminate(){return C(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),qo=class extends eh{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){K(this.persistence.referenceDelegate instanceof Xr,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Zi(r,t.asyncQueue,e)}Cu(t){let e=this.cacheSizeBytes!==void 0?St.withCacheSize(this.cacheSizeBytes):St.DEFAULT;return new Jr(r=>Xr.mi(r,e),this.serializer)}};var Qm=(()=>{class n{initialize(e,r){return C(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Ou(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Gm.bind(null,this.syncEngine),yield Cm(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new No}()}createDatastore(e){let r=gs(e.databaseInfo.databaseId),s=function(c){return new Ao(c)}(e.databaseInfo);return function(c,l,h,f){return new Po(c,l,h,f)}(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return function(s,o,c,l,h){return new Vo(s,o,c,l,h)}(this.localStore,this.datastore,e.asyncQueue,r=>Ou(this.syncEngine,r,0),function(){return Zr.v()?new Zr:new Eo}())}createSyncEngine(e,r){return function(o,c,l,h,f,g,T){let E=new Bo(o,c,l,h,f,g);return T&&(E.gu=!0),E}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}terminate(){return C(this,null,function*(){yield function(r){return C(this,null,function*(){let s=B(r);N(Te,"RemoteStore shutting down."),s.Ea.add(5),yield rr(s),s.Aa.shutdown(),s.Ra.set("Unknown")})}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return n.provider={build:()=>new n},n})();var jo=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Qt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var zo=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new k(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(s,o){return C(this,null,function*(){let c=B(s),l={documents:o.map(T=>Hr(c.serializer,T))},h=yield c.Ho("BatchGetDocuments",c.serializer.databaseId,Y.emptyPath(),l,o.length),f=new Map;h.forEach(T=>{let E=Jf(c.serializer,T);f.set(E.key.toString(),E)});let g=[];return o.forEach(T=>{let E=f.get(T.toString());K(!!E,55234,{key:T}),g.push(E)}),g})}(this.datastore,t);return e.forEach(r=>this.recordVersion(r)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new Kn(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,r)=>{let s=F.fromPath(r);this.mutations.push(new jr(s,this.precondition(s)))}),yield function(r,s){return C(this,null,function*(){let o=B(r),c={writes:s.map(l=>Ml(o.serializer,l))};yield o.Go("Commit",o.serializer.databaseId,Y.emptyPath(),c)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw M(50498,{Gu:t.constructor.name});e=L.min()}let r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new k(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(L.min())?Rt.exists(!1):Rt.updateTime(e):Rt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(L.min()))throw new k(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Rt.updateTime(e)}return Rt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var Go=class{constructor(t,e,r,s,o){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=s,this.deferred=o,this.zu=r.maxAttempts,this.M_=new Xn(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(()=>C(this,null,function*(){let t=new zo(this.datastore),e=this.Hu(t);e&&e.then(r=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})}))}Hu(t){try{let e=this.updateFunction(t);return!nr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Yu(t){this.zu>0&&this.Zu(t)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(t)}Zu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Vl(e)}return!1}};var ue="FirestoreClient",$o=class{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=ot.UNAUTHENTICATED,this.clientId=qn.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,c=>C(this,null,function*(){N(ue,"Received user=",c.uid),yield this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(r,c=>(N(ue,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new Vt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=wa(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function mi(n,t){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),N(ue,"Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(s=>C(null,null,function*(){r.isEqual(s)||(yield ql(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function Fu(n,t){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield Hm(n);N(ue,"Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>xu(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>xu(t.remoteStore,s)),n._onlineComponents=t})}function Hm(n){return C(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){N(ue,"Using user provided OfflineComponentProvider");try{yield mi(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;Ue("Error using user provided cache. Falling back to memory cache: "+e),yield mi(n,new eh)}}else N(ue,"Using default OfflineComponentProvider"),yield mi(n,new qo(void 0));return n._offlineComponents})}function Ta(n){return C(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(N(ue,"Using user provided OnlineComponentProvider"),yield Fu(n,n._uninitializedComponentsProvider._online)):(N(ue,"Using default OnlineComponentProvider"),yield Fu(n,new Qm))),n._onlineComponents})}function Wm(n){return Ta(n).then(t=>t.syncEngine)}function Jm(n){return Ta(n).then(t=>t.datastore)}function Xm(n){return C(this,null,function*(){let t=yield Ta(n),e=t.eventManager;return e.onListen=km.bind(null,t.syncEngine),e.onUnlisten=Fm.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Om.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Lm.bind(null,t.syncEngine),e})}function Ym(n,t,e={}){let r=new Vt;return n.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return function(o,c,l,h,f){let g=new jo({next:E=>{g.Nu(),c.enqueueAndForget(()=>Dm(o,T));let R=E.docs.has(l);!R&&E.fromCache?f.reject(new k(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&E.fromCache&&h&&h.source==="server"?f.reject(new k(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(E)},error:E=>f.reject(E)}),T=new Oo(ha(l.path),g,{includeMetadataChanges:!0,qa:!0});return Vm(o,T)}(yield Xm(n),n.asyncQueue,t,e,r)})),r.promise}function nh(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Lu=new Map;var rh="firestore.googleapis.com",Bu=!0,os=class{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new k(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=rh,this.ssl=Bu}else this.host=t.host,this.ssl=t.ssl??Bu;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Ul;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<cm)throw new k(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}rf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nh(t.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new k(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new k(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new k(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Yn=class{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new os({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new k(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new k(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new os(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new pi;switch(r.type){case"firstParty":return new wi(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new k(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return C(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=Lu.get(e);r&&(N("ComponentProvider","Removing Datastore"),Lu.delete(e),r.terminate())}(this),Promise.resolve()}};function Zm(n,t,e,r={}){n=je(n,Yn);let s=Tr(t),o=n._getSettings(),c=$s(lt({},o),{emulatorOptions:n._getEmulatorOptions()}),l=`${t}:${e}`;s&&(Fc(`https://${l}`),Bc("Firestore",!0)),o.host!==rh&&o.host!==l&&Ue("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=$s(lt({},o),{host:l,ssl:s,emulatorOptions:r});if(!Ce(h,c)&&(n._setSettings(h),r.mockUserToken)){let f,g;if(typeof r.mockUserToken=="string")f=r.mockUserToken,g=ot.MOCK_USER;else{f=Lc(r.mockUserToken,n._app?.options.projectId);let T=r.mockUserToken.sub||r.mockUserToken.user_id;if(!T)throw new k(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new ot(T)}n._authCredentials=new gi(new kr(f,g))}}var Ko=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},yt=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Zn(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(er(e,n._jsonSchema))return new n(t,r||null,new F(Y.fromString(e.referencePath)))}};yt._jsonSchemaVersion="firestore/documentReference/1.0",yt._jsonSchema={type:rt("string",yt._jsonSchemaVersion),referencePath:rt("string")};var Zn=class n extends Ko{constructor(t,e,r){super(t,e,ha(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new yt(this.firestore,null,new F(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function Qp(n,t,...e){if(n=qt(n),arguments.length===1&&(t=qn.newId()),nf("doc","path",t),n instanceof Yn){let r=Y.fromString(t,...e);return iu(r),new yt(n,null,new F(r))}{if(!(n instanceof yt||n instanceof Zn))throw new k(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Y.fromString(t,...e));return iu(r),new yt(n.firestore,n instanceof Zn?n.converter:null,new F(r))}}var Uu="AsyncQueue",as=class{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Xn(this,"async_queue_retry"),this._c=()=>{let r=fi();r&&N(Uu,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;let e=fi();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;let e=fi();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});let e=new Vt;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}lc(){return C(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!on(t))throw t;N(Uu,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(t){let e=this.ac.then(()=>(this.rc=!0,t().catch(r=>{throw this.nc=r,this.rc=!1,Qt("INTERNAL UNHANDLED ERROR: ",qu(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);let s=Do.createAndSchedule(this,t,e,r,o=>this.hc(o));return this.tc.push(s),s}uc(){this.nc&&M(47125,{Pc:qu(this.nc)})}verifyOperationInProgress(){}Tc(){return C(this,null,function*(){let t;do t=this.ac,yield t;while(t!==this.ac)})}Ic(t){for(let e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){let e=this.tc.indexOf(t);this.tc.splice(e,1)}};function qu(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}var tn=class extends Yn{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new as,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return C(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new as(t),this._firestoreClient=void 0,yield t}})}};function Hp(n,t){let e=typeof n=="object"?n:Xc(),r=typeof n=="string"?n:t||Br,s=Hc(e,"firestore").getImmediate({identifier:r});if(!s._initialized){let o=Mc("firestore");o&&Zm(s,...o)}return s}function Aa(n){if(n._terminated)throw new k(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||tp(n),n._firestoreClient}function tp(n){let t=n._freezeSettings(),e=function(s,o,c,l){return new Ai(s,o,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,nh(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)}(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new $o(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&function(s){let o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}}(n._componentsProvider))}var Kt=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(_t.fromBase64String(t))}catch(e){throw new k(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(_t.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(er(t,n._jsonSchema))return n.fromBase64String(t.bytes)}};Kt._jsonSchemaVersion="firestore/bytes/1.0",Kt._jsonSchema={type:rt("string",Kt._jsonSchemaVersion),bytes:rt("string")};var en=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new k(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Tt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var tr=class{constructor(t){this._methodName=t}};var se=class n{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new k(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new k(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return U(this._lat,t._lat)||U(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(t){if(er(t,n._jsonSchema))return new n(t.latitude,t.longitude)}};se._jsonSchemaVersion="firestore/geoPoint/1.0",se._jsonSchema={type:rt("string",se._jsonSchemaVersion),latitude:rt("number"),longitude:rt("number")};var ie=class n{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}(this._values,t._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(er(t,n._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new n(t.vectorValues);throw new k(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};ie._jsonSchemaVersion="firestore/vectorValue/1.0",ie._jsonSchema={type:rt("string",ie._jsonSchemaVersion),vectorValues:rt("object")};var ep=/^__.*__$/,Qo=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Mt(t,this.data,this.fieldMask,e,this.fieldTransforms):new ve(t,this.data,e,this.fieldTransforms)}},cs=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Mt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function sh(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{Ac:n})}}var Ho=class n{constructor(t,e,r,s,o,c){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=c||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new n(lt(lt({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){let e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.gc(t),r}yc(t){let e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return ls(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(sh(this.Ac)&&ep.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}},Wo=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||gs(t)}Cc(t,e,r,s=!1){return new Ho({Ac:t,methodName:e,Dc:r,path:Tt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function ih(n){let t=n._freezeSettings(),e=gs(n._databaseId);return new Wo(n._databaseId,!!t.ignoreUndefinedProperties,e)}function oh(n,t,e,r,s,o={}){let c=n.Cc(o.merge||o.mergeFields?2:0,t,e,s);ba("Data must be an object, but it was:",c,r);let l=ah(r,c),h,f;if(o.merge)h=new Pt(c.fieldMask),f=c.fieldTransforms;else if(o.mergeFields){let g=[];for(let T of o.mergeFields){let E=Jo(t,T,e);if(!c.contains(E))throw new k(S.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);uh(g,E)||g.push(E)}h=new Pt(g),f=c.fieldTransforms.filter(T=>h.covers(T.field))}else h=null,f=c.fieldTransforms;return new Qo(new It(l),h,f)}var us=class n extends tr{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function np(n,t,e,r){let s=n.Cc(1,t,e);ba("Data must be an object, but it was:",s,r);let o=[],c=It.empty();le(r,(h,f)=>{let g=Sa(t,h,e);f=qt(f);let T=s.yc(g);if(f instanceof us)o.push(g);else{let E=ws(f,T);E!=null&&(o.push(g),c.set(g,E))}});let l=new Pt(o);return new cs(c,l,s.fieldTransforms)}function rp(n,t,e,r,s,o){let c=n.Cc(1,t,e),l=[Jo(t,r,e)],h=[s];if(o.length%2!=0)throw new k(S.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<o.length;E+=2)l.push(Jo(t,o[E])),h.push(o[E+1]);let f=[],g=It.empty();for(let E=l.length-1;E>=0;--E)if(!uh(f,l[E])){let R=l[E],x=h[E];x=qt(x);let O=c.yc(R);if(x instanceof us)f.push(R);else{let D=ws(x,O);D!=null&&(f.push(R),g.set(R,D))}}let T=new Pt(f);return new cs(g,T,c.fieldTransforms)}function ws(n,t){if(ch(n=qt(n)))return ba("Unsupported field value:",t,n),ah(n,t);if(n instanceof tr)return function(r,s){if(!sh(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return function(r,s){let o=[],c=0;for(let l of r){let h=ws(l,s.wc(c));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),c++}return{arrayValue:{values:o}}}(n,t)}return function(r,s){if((r=qt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Mf(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=st.fromDate(r);return{timestampValue:Qr(s.serializer,o)}}if(r instanceof st){let o=new st(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Qr(s.serializer,o)}}if(r instanceof se)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Kt)return{bytesValue:xl(s.serializer,r._byteString)};if(r instanceof yt){let o=s.databaseId,c=r.firestore._databaseId;if(!c.isEqual(o))throw s.Sc(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:fa(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof ie)return function(c,l){return{mapValue:{fields:{[oa]:{stringValue:aa},[ze]:{arrayValue:{values:c.toArray().map(f=>{if(typeof f!="number")throw l.Sc("VectorValues must only contain numeric values.");return da(l.serializer,f)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${na(r)}`)}(n,t)}function ah(n,t){let e={};return sl(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):le(n,(r,s)=>{let o=ws(s,t.mc(r));o!=null&&(e[r]=o)}),{mapValue:{fields:e}}}function ch(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof st||n instanceof se||n instanceof Kt||n instanceof yt||n instanceof tr||n instanceof ie)}function ba(n,t,e){if(!ch(e)||!zu(e)){let r=na(e);throw r==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+r)}}function Jo(n,t,e){if((t=qt(t))instanceof en)return t._internalPath;if(typeof t=="string")return Sa(n,t);throw ls("Field path arguments must be of type string or ",n,!1,void 0,e)}var sp=new RegExp("[~\\*/\\[\\]]");function Sa(n,t,e){if(t.search(sp)>=0)throw ls(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new en(...t.split("."))._internalPath}catch{throw ls(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function ls(n,t,e,r,s){let o=r&&!r.isEmpty(),c=s!==void 0,l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||c)&&(h+=" (found",o&&(h+=` in field ${r}`),c&&(h+=` in document ${s}`),h+=")"),new k(S.INVALID_ARGUMENT,l+n+h)}function uh(n,t){return n.some(e=>e.isEqual(t))}var nn=class{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new yt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Xo(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(lh("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Xo=class extends nn{data(){return super.data()}};function lh(n,t){return typeof t=="string"?Sa(n,t):t instanceof en?t._internalPath:t._delegate._internalPath}var hs=class{convertValue(t,e="none"){switch(ae(t)){case 0:return null;case 1:return t.booleanValue;case 2:return X(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Wt(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw M(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return le(t,(s,o)=>{r[s]=this.convertValue(o,e)}),r}convertVectorValue(t){let e=t.fields?.[ze].arrayValue?.values?.map(r=>X(r.doubleValue));return new ie(e)}convertGeoPoint(t){return new se(X(t.latitude),X(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=fs(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Gn(t));default:return null}}convertTimestamp(t){let e=Ht(t);return new st(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=Y.fromString(t);K(Bl(r),9688,{name:t});let s=new Ur(r.get(1),r.get(3)),o=new F(r.popFirst(5));return s.isEqual(e)||Qt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}};function hh(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var Yo=class extends hs{constructor(t){super(),this.firestore=t}convertBytes(t){return new Kt(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new yt(this.firestore,null,e)}};var re=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},oe=class n extends nn{constructor(t,e,r,s,o,c){super(t,e,r,s,c),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Be(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(lh("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new k(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=n._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};oe._jsonSchemaVersion="firestore/documentSnapshot/1.0",oe._jsonSchema={type:rt("string",oe._jsonSchemaVersion),bundleSource:rt("string","DocumentSnapshot"),bundleName:rt("string"),bundle:rt("string")};var Be=class extends oe{data(t={}){return super.data(t)}},Un=class n{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new re(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new Be(this._firestore,this._userDataWriter,r.key,r,new re(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new k(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let c=0;return s._snapshot.docChanges.map(l=>{let h=new Be(s._firestore,s._userDataWriter,l.doc.key,l.doc,new re(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:c++}})}{let c=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{let h=new Be(s._firestore,s._userDataWriter,l.doc.key,l.doc,new re(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter),f=-1,g=-1;return l.type!==0&&(f=c.indexOf(l.doc.key),c=c.delete(l.doc.key)),l.type!==1&&(c=c.add(l.doc),g=c.indexOf(l.doc.key)),{type:ip(l.type),doc:h,oldIndex:f,newIndex:g}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new k(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=n._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=qn.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],r=[],s=[];return this.docs.forEach(o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function ip(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:n})}}function Wp(n){n=je(n,yt);let t=je(n.firestore,tn);return Ym(Aa(t),n._key).then(e=>ap(t,n,e))}Un._jsonSchemaVersion="firestore/querySnapshot/1.0",Un._jsonSchema={type:rt("string",Un._jsonSchemaVersion),bundleSource:rt("string","QuerySnapshot"),bundleName:rt("string"),bundle:rt("string")};var ds=class extends hs{constructor(t){super(),this.firestore=t}convertBytes(t){return new Kt(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new yt(this.firestore,null,e)}};function Jp(n,t,e){n=je(n,yt);let r=je(n.firestore,tn),s=hh(n.converter,t,e);return op(r,[oh(ih(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,Rt.none())])}function op(n,t){return function(r,s){let o=new Vt;return r.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return Bm(yield Wm(r),s,o)})),o.promise}(Aa(n),t)}function ap(n,t,e){let r=e.docs.get(t._key),s=new ds(n);return new oe(n,s,t._key,r,new re(e.hasPendingWrites,e.fromCache),t.converter)}var cp={maxAttempts:5};function kn(n,t){if((n=qt(n)).firestore!==t)throw new k(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Zo=class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=ih(t)}get(t){let e=kn(t,this._firestore),r=new Yo(this._firestore);return this._transaction.lookup([e._key]).then(s=>{if(!s||s.length!==1)return M(24041);let o=s[0];if(o.isFoundDocument())return new nn(this._firestore,r,o.key,o,e.converter);if(o.isNoDocument())return new nn(this._firestore,r,e._key,null,e.converter);throw M(18433,{doc:o})})}set(t,e,r){let s=kn(t,this._firestore),o=hh(s.converter,e,r),c=oh(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,r);return this._transaction.set(s._key,c),this}update(t,e,r,...s){let o=kn(t,this._firestore),c;return c=typeof(e=qt(e))=="string"||e instanceof en?rp(this._dataReader,"Transaction.update",o._key,e,r,s):np(this._dataReader,"Transaction.update",o._key,e),this._transaction.update(o._key,c),this}delete(t){let e=kn(t,this._firestore);return this._transaction.delete(e._key),this}};var ta=class extends Zo{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=kn(t,this._firestore),r=new ds(this._firestore);return super.get(t).then(s=>new oe(this._firestore,r,e._key,s._document,new re(!1,!1),e.converter))}};function Xp(n,t,e){n=je(n,tn);let r=lt(lt({},cp),e);return function(o){if(o.maxAttempts<1)throw new k(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(o,c,l){let h=new Vt;return o.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){let f=yield Jm(o);new Go(o.asyncQueue,f,l,c,h).ju()})),h.promise}(Aa(n),s=>t(new ta(n,s)),r)}(function(t,e=!0){(function(s){rn=s})(Jc),Vn(new jt("firestore",(r,{instanceIdentifier:s,options:o})=>{let c=r.getProvider("app").getImmediate(),l=new tn(new yi(r.getProvider("auth-internal")),new Ei(c,r.getProvider("app-check-internal")),function(f,g){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new k(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ur(f.options.projectId,g)}(c,s),c);return o=lt({useFetchStreams:e},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),De(nu,ru,t),De(nu,ru,"esm2020")})();export{Qp as a,Hp as b,Wp as c,Jp as d,Xp as e};
