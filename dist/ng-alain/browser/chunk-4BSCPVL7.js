import{a as u,c as x,d as k,e as p}from"./chunk-22JOMLV4.js";import{b as y,d as T,e as D,f as P,g as h,h as w,i as f,o as S}from"./chunk-22S67FWE.js";import{oa as d,sa as v,ta as C}from"./chunk-ONJQPJYD.js";import{h as i}from"./chunk-HN2SGUN4.js";var c=class c{constructor(){this.firestore=C(y)}useCollection(e){let t=h(this.firestore,e);return T(t,{idField:"key"})}useDoc(e,t){let r=f(this.firestore,e,t);return D(r,{idField:"key"})}add(e,t){return i(this,null,function*(){let r=h(this.firestore,e);return(yield P(r,t)).id})}update(e,t,r){return i(this,null,function*(){let a=f(this.firestore,e,t);yield S(a,r)})}delete(e,t){return i(this,null,function*(){let r=f(this.firestore,e,t);yield w(r)})}};c.\u0275fac=function(t){return new(t||c)},c.\u0275prov=d({token:c,factory:c.\u0275fac,providedIn:"root"});var b=c;var l=class l{constructor(e){this.hubCrud=e}list(){return this.hubCrud.useCollection("hub_contract")}add(e){return this.hubCrud.add("hub_contract",e)}update(e,t){return this.hubCrud.update("hub_contract",e,t)}delete(e){return this.hubCrud.delete("hub_contract",e)}getNextContractSerial(){return i(this,null,function*(){let e=u(this.hubCrud.firestore,"hub/meta/counters/contractSerial"),t=1;return yield p(this.hubCrud.firestore,r=>i(this,null,function*(){let a=yield r.get(e),n=0,s=[];if(!a.exists())n=1,s=[],r.set(e,{value:n,available:s}),t=n;else{let o=a.data();n=o.value||0,s=Array.isArray(o.available)?[...o.available]:[],s.length>0?(s.sort((m,g)=>m-g),t=s.shift(),r.update(e,{available:s})):(t=n+1,r.update(e,{value:t}))}})),"C"+String(t).padStart(5,"0")})}recycleContractSerial(e){return i(this,null,function*(){let t=Number(e.replace(/^C/,""));if(!t||isNaN(t))return;let r=u(this.hubCrud.firestore,"hub/meta/counters/contractSerial");yield p(this.hubCrud.firestore,a=>i(this,null,function*(){let n=yield a.get(r);if(!n.exists())a.set(r,{value:t,available:[t]});else{let s=n.data(),o=Array.isArray(s.available)?[...s.available]:[];o.includes(t)||(o.push(t),o.sort((m,g)=>m-g),a.update(r,{available:o}))}}))})}getClientsSettings(){return i(this,null,function*(){let e=u(this.hubCrud.firestore,"hub/meta/settings/clients"),t=yield x(e);return t.exists()?t.data():null})}setClientsSettings(e){return i(this,null,function*(){let t=u(this.hubCrud.firestore,"hub/meta/settings/clients");yield k(t,e)})}getDefaultClient(){return i(this,null,function*(){return(yield this.getClientsSettings())?.default||""})}};l.\u0275fac=function(t){return new(t||l)(v(b))},l.\u0275prov=d({token:l,factory:l.\u0275fac,providedIn:"root"});var O=l;export{b as a,O as b};
