import{b as ce}from"./chunk-FGZ6ITCH.js";import{a as re,b as ae,c as le}from"./chunk-UYXFCDCY.js";import{la as $,na as j,qa as q,sa as G,ta as K}from"./chunk-X36VYPCJ.js";import"./chunk-LZHHB3SB.js";import"./chunk-SIZM2XL7.js";import"./chunk-2DVOMO4J.js";import"./chunk-MFG6XL3Q.js";import"./chunk-OETAK3GR.js";import"./chunk-DNAKBF6E.js";import"./chunk-GXVUYNK4.js";import"./chunk-BQVMEIZ5.js";import{d as Z,e as ee,f as te,j as ne,k as ie,l as oe}from"./chunk-EJPHIAHG.js";import{a as W,b as X}from"./chunk-ZEZPGFWG.js";import"./chunk-PUGKNFED.js";import"./chunk-FKZEB7ER.js";import{d as U}from"./chunk-3UXJQ3KI.js";import{m as V}from"./chunk-EXZNONST.js";import{a as H,c as J}from"./chunk-FWGM4PSC.js";import"./chunk-L6VFZVUC.js";import{f as Q,g as Y}from"./chunk-5G6BXQUB.js";import{a as L,b as I,d as A,e as B}from"./chunk-L3XAXJTY.js";import"./chunk-SUWO6CW6.js";import"./chunk-PV63DGP2.js";import"./chunk-EOTHDIY5.js";import"./chunk-6W2MZKTD.js";import"./chunk-TWOZTKVL.js";import{j as O}from"./chunk-27W33B5M.js";import"./chunk-VF6IKWU5.js";import{Cb as S,Da as h,Eb as b,Fd as D,Gc as N,Jb as z,Jh as F,Kb as a,Kh as P,Lb as r,Lc as g,Mb as s,Qc as v,Tb as _,Wb as d,Za as x,Zb as m,hc as f,jb as E,mc as l,nc as y,oa as w,oc as T,pb as R,ua as p,va as u}from"./chunk-BJGZKRME.js";import"./chunk-PMZOYKO3.js";import{a as M,b as k}from"./chunk-57BLH6QZ.js";var ue=(o,n,e,i)=>[o,n,e,i];function de(o,n){if(o&1){let e=_();a(0,"nz-result",14)(1,"div",16)(2,"button",10),d("click",function(){p(e);let t=m();return u(t.refresh())}),l(3,"\u91CD\u8A66"),r()()()}if(o&2){let e=m();z("nzSubTitle",e.error())}}function _e(o,n){o&1&&(a(0,"span",20),s(1,"span",25),l(2," \u5DF2\u4FDD\u5B58\u81F3 Storage "),r())}function fe(o,n){if(o&1){let e=_();a(0,"nz-list-item",17)(1,"nz-list-item-meta")(2,"nz-list-item-meta-title")(3,"a",18),d("click",function(){let t=p(e).$implicit,c=m(2);return u(c.viewResult(t))}),l(4),r()(),a(5,"nz-list-item-meta-description")(6,"div",19)(7,"span",20),s(8,"span",21),l(9),r(),a(10,"span",20),s(11,"span",22),l(12," \u9801\u6578\u7BC4\u570D\uFF1A"),a(13,"nz-tag",23),l(14),r()(),a(15,"span",20),s(16,"span",24),l(17),r(),S(18,_e,3,0,"span",20),r()()()()}if(o&2){let e=n.$implicit,i=m(2),t=f(16),c=f(18),me=f(20),pe=f(22);z("nzActions",N(6,ue,t,me,pe,c)),x(4),y(e.fileName),x(5),T(" \u6A94\u6848\u5927\u5C0F\uFF1A",i.formatFileSize(e.fileSize)," "),x(5),y(e.pageRange),x(3),T(" \u63D0\u53D6\u6642\u9593\uFF1A",i.formatDate(e.createdAt)," "),x(),b(e.pdfUrl||e.txtUrl?18:-1)}}function ge(o,n){if(o&1&&(a(0,"nz-list",15),R(1,fe,19,11,"ng-template",null,6,g),r()),o&2){let e=f(2),i=m(),t=f(14);z("nzDataSource",i.scanResults())("nzRenderItem",e)("nzItemLayout","horizontal")("nzLoading",i.isLoading())("nzNoResult",t)}}function xe(o,n){if(o&1){let e=_();a(0,"button",26),d("click",function(){p(e);let t=m();return u(t.goToScan())}),s(1,"span",11),l(2," \u6383\u63CF "),r()}}function Ce(o,n){if(o&1){let e=_();a(0,"nz-empty",27)(1,"button",10),d("click",function(){p(e);let t=m();return u(t.goToScan())}),s(2,"span",11),l(3," \u958B\u59CB\u6383\u63CF "),r()()}}function ze(o,n){if(o&1){let e=_();a(0,"button",26),d("click",function(){let t=p(e).$implicit,c=m();return u(c.viewResult(t))}),s(1,"span",28),l(2," \u67E5\u770B "),r()}}function we(o,n){if(o&1){let e=_();a(0,"button",26),d("click",function(){let t=p(e).$implicit,c=m();return u(c.downloadMarkdown(t))}),s(1,"span",22),l(2," MD "),r()}}function he(o,n){if(o&1){let e=_();a(0,"button",26),d("click",function(){let t=p(e).$implicit,c=m();return u(c.downloadPdf(t))}),s(1,"span",21),l(2," PDF "),r()}}function Re(o,n){if(o&1){let e=_();a(0,"button",26),d("click",function(){let t=p(e).$implicit,c=m();return u(c.downloadText(t))}),s(1,"span",22),l(2," TXT "),r()}}var C=class C{constructor(){this.firestore=w($);this.router=w(V);this.message=w(U);this.isLoading=h(!0);this.error=h("");this.scanResults=h([]);this.hasResults=v(()=>this.scanResults().length>0);this.hasError=v(()=>this.error()!=="")}ngOnInit(){this.loadScanResults()}loadScanResults(){this.isLoading.set(!0),this.error.set("");let n=K(j(this.firestore,"scan-results"),G("createdAt","desc"));q(n).then(e=>{let i=[];e.forEach(t=>{let c=t.data();i.push(k(M({},c),{id:t.id}))}),this.scanResults.set(i)}).catch(e=>{console.error("Error loading scan results:",e),this.error.set("\u8F09\u5165\u6383\u63CF\u7D50\u679C\u5931\u6557"),this.scanResults.set([])}).finally(()=>{this.isLoading.set(!1)})}formatFileSize(n){if(n===0)return"0 Bytes";let e=1024,i=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(n)/Math.log(e));return parseFloat((n/Math.pow(e,t)).toFixed(2))+" "+i[t]}formatDate(n){return new Date(n).toLocaleString()}viewResult(n){n.id&&this.router.navigate(["/tree/scan-result",n.id])}downloadMarkdown(n){let e=new Blob([n.markdownContent],{type:"text/markdown;charset=utf-8"}),i=window.URL.createObjectURL(e),t=document.createElement("a");t.href=i,t.download=`${n.fileName.replace(".pdf","")}_extracted.md`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(i),this.message.success("Markdown \u6587\u4EF6\u5DF2\u4E0B\u8F09")}downloadText(n){if(n.txtUrl){let e=document.createElement("a");e.href=n.txtUrl,e.download=`${n.fileName.replace(".pdf","")}_extracted.txt`,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),this.message.success("\u6587\u5B57\u6587\u4EF6\u5DF2\u4E0B\u8F09")}else{let e=new Blob([n.extractedText],{type:"text/plain;charset=utf-8"}),i=window.URL.createObjectURL(e),t=document.createElement("a");t.href=i,t.download=`${n.fileName.replace(".pdf","")}_extracted.txt`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(i),this.message.success("\u6587\u5B57\u6587\u4EF6\u5DF2\u4E0B\u8F09")}}downloadPdf(n){if(n.pdfUrl){let e=document.createElement("a");e.href=n.pdfUrl,e.download=n.fileName,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),this.message.success("PDF \u6587\u4EF6\u5DF2\u4E0B\u8F09")}else this.message.warning("PDF \u6587\u4EF6\u9023\u7D50\u4E0D\u53EF\u7528")}goToScan(){this.router.navigate(["/tree/pdf-scan"])}refresh(){this.loadScanResults()}};C.\u0275fac=function(e){return new(e||C)},C.\u0275cmp=E({type:C,selectors:[["app-scan-result"]],decls:23,vars:2,consts:[["extraTemplate",""],["emptyTemplate",""],["viewAction",""],["downloadMdAction",""],["downloadPdfAction",""],["downloadTxtAction",""],["item",""],["nzTitle","\u6383\u63CF\u7D50\u679C\u5217\u8868",3,"nzExtra"],[1,"results-container"],[1,"header-actions"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","scan"],["nz-button","",3,"click"],["nz-icon","","nzType","reload"],["nzStatus","error","nzTitle","\u8F09\u5165\u5931\u6557",3,"nzSubTitle"],[3,"nzDataSource","nzRenderItem","nzItemLayout","nzLoading","nzNoResult"],["nz-result-extra",""],[3,"nzActions"],[1,"file-name",3,"click"],[1,"file-info"],[1,"info-item"],["nz-icon","","nzType","file-pdf"],["nz-icon","","nzType","file-text"],["nzColor","blue"],["nz-icon","","nzType","clock-circle"],["nz-icon","","nzType","cloud"],["nz-button","","nzType","link",3,"click"],["nzNotFoundImage","simple","nzNotFoundContent","\u76EE\u524D\u6C92\u6709\u6383\u63CF\u7D50\u679C"],["nz-icon","","nzType","eye"]],template:function(e,i){if(e&1){let t=_();a(0,"nz-card",7)(1,"div",8)(2,"div",9)(3,"button",10),d("click",function(){return p(t),u(i.goToScan())}),s(4,"span",11),l(5," \u65B0\u589E\u6383\u63CF "),r(),a(6,"button",12),d("click",function(){return p(t),u(i.refresh())}),s(7,"span",13),l(8," \u91CD\u65B0\u6574\u7406 "),r()(),S(9,de,4,1,"nz-result",14)(10,ge,3,5,"nz-list",15),r()(),R(11,xe,3,0,"ng-template",null,0,g)(13,Ce,4,0,"ng-template",null,1,g)(15,ze,3,0,"ng-template",null,2,g)(17,we,3,0,"ng-template",null,3,g)(19,he,3,0,"ng-template",null,4,g)(21,Re,3,0,"ng-template",null,5,g)}if(e&2){let t=f(12);z("nzExtra",t),x(9),b(i.hasError()?9:10)}},dependencies:[D,Y,Q,B,A,L,I,P,F,le,ae,re,ce,X,W,O,oe,ne,ie,te,Z,ee,J,H],styles:[".results-container[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto}.header-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px;justify-content:flex-end}.file-name[_ngcontent-%COMP%]{color:#1890ff;cursor:pointer;font-weight:500}.file-name[_ngcontent-%COMP%]:hover{color:#40a9ff;text-decoration:underline}.file-info[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;margin-top:8px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:#666;font-size:14px}.info-item[_ngcontent-%COMP%]   span[nz-icon][_ngcontent-%COMP%]{color:#999}[_nghost-%COMP%]     .ant-list-item{padding:16px;border-radius:6px;margin-bottom:8px;border:1px solid #f0f0f0;transition:all .3s}[_nghost-%COMP%]     .ant-list-item:hover{border-color:#d9d9d9;box-shadow:0 2px 8px #0000001a}[_nghost-%COMP%]     .ant-list-item-meta-title{margin-bottom:8px}[_nghost-%COMP%]     .ant-list-item-action{margin-left:16px}@media (max-width: 768px){.results-container[_ngcontent-%COMP%]{max-width:100%;padding:0 16px}.header-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.file-info[_ngcontent-%COMP%]{flex-direction:column;gap:8px}[_nghost-%COMP%]     .ant-list-item{flex-direction:column;align-items:stretch}[_nghost-%COMP%]     .ant-list-item .ant-list-item-action{margin-left:0;margin-top:12px;justify-content:flex-start}}"],changeDetection:0});var se=C;export{se as ScanResultComponent};
