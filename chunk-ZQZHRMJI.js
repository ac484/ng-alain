import{a as ie,c as oe,d as re,e as ae,g as le,h}from"./chunk-KF5HXNO5.js";import{a as ee,b as te,c as ne}from"./chunk-UYXFCDCY.js";import"./chunk-LZHHB3SB.js";import"./chunk-SIZM2XL7.js";import"./chunk-2DVOMO4J.js";import{d as q,e as H,f as J,h as Q,j as X,k as Y,l as Z}from"./chunk-EJPHIAHG.js";import{a as $,b as U}from"./chunk-ZEZPGFWG.js";import"./chunk-PUGKNFED.js";import"./chunk-FKZEB7ER.js";import{d as P}from"./chunk-3UXJQ3KI.js";import{m as F}from"./chunk-EXZNONST.js";import{a as j,c as W}from"./chunk-FWGM4PSC.js";import"./chunk-L6VFZVUC.js";import{f as G,g as K}from"./chunk-5G6BXQUB.js";import{a as V,b as B,d as O,e as A}from"./chunk-L3XAXJTY.js";import"./chunk-PV63DGP2.js";import"./chunk-EOTHDIY5.js";import"./chunk-TWOZTKVL.js";import"./chunk-27W33B5M.js";import"./chunk-VF6IKWU5.js";import{Cb as w,Da as C,Eb as R,Fd as E,Hb as N,Ib as M,Jb as x,Jh as I,Kb as r,Kh as L,Lb as o,Mb as c,Qc as k,Tb as y,Wb as u,Za as p,Zb as m,jb as v,mc as a,nc as D,oa as z,oc as S,ua as d,va as f}from"./chunk-BJGZKRME.js";import"./chunk-PMZOYKO3.js";import{i as T}from"./chunk-57BLH6QZ.js";var ue=(l,t)=>t.id;function de(l,t){if(l&1){let e=y();r(0,"nz-result",7)(1,"div",9)(2,"button",3),u("click",function(){d(e);let i=m();return f(i.refresh())}),a(3,"\u91CD\u8A66"),o()()()}if(l&2){let e=m();x("nzSubTitle",e.error())}}function fe(l,t){if(l&1){let e=y();r(0,"nz-list-item")(1,"nz-list-item-meta")(2,"nz-list-item-meta-title")(3,"span",11),a(4),o()(),r(5,"nz-list-item-meta-description")(6,"div",12)(7,"nz-tag",13),a(8),o(),r(9,"span",14),c(10,"span",15),a(11),o(),r(12,"span",14),c(13,"span",16),a(14),o()()()(),r(15,"ul",17)(16,"li")(17,"button",18),u("click",function(){let i=d(e).$implicit,s=m(2);return f(s.previewFile(i))}),c(18,"span",19),a(19," \u9810\u89BD "),o()(),r(20,"li")(21,"button",18),u("click",function(){let i=d(e).$implicit,s=m(2);return f(s.downloadFile(i))}),c(22,"span",20),a(23," \u4E0B\u8F09 "),o()(),r(24,"li")(25,"button",21),u("click",function(){let i=d(e).$implicit,s=m(2);return f(s.deleteFile(i))}),c(26,"span",22),a(27," \u522A\u9664 "),o()()()()}if(l&2){let e=t.$implicit,n=m(2);p(4),D(e.fileName),p(3),x("nzColor",e.fileType==="pdf"?"blue":"green"),p(),S(" ",e.fileType.toUpperCase()," "),p(3),S(" ",n.formatFileSize(e.fileSize)," "),p(3),S(" ",n.formatDate(e.createdAt)," ")}}function _e(l,t){if(l&1){let e=y();r(0,"nz-empty",10)(1,"button",3),u("click",function(){d(e);let i=m(2);return f(i.goToScan())}),c(2,"span",4),a(3," \u958B\u59CB\u6383\u63CF "),o()()}}function ge(l,t){if(l&1&&(r(0,"nz-list",8),N(1,fe,28,5,"nz-list-item",null,ue,!1,_e,4,0,"nz-empty",10),o()),l&2){let e=m();x("nzDataSource",e.scanResults())("nzItemLayout","horizontal")("nzLoading",e.isLoading()),p(),M(e.scanResults())}}var _=class _{constructor(){this.storage=z(ie);this.router=z(F);this.message=z(P);this.isLoading=C(!0);this.error=C("");this.scanResults=C([]);this.hasError=k(()=>this.error()!=="")}ngOnInit(){this.loadScanResults()}loadScanResults(){return T(this,null,function*(){this.isLoading.set(!0),this.error.set("");try{let t=h(this.storage,"pdf-uploads"),e=yield le(t),n=[];for(let i of e.items){let s=yield ae(i),ce=yield re(i),g=s.name,me=g.endsWith(".pdf")?"pdf":"txt",b=g.match(/(\d+)_pages-(\d+)-(\d+)\.(pdf|txt)$/),pe=b?new Date(parseInt(b[1])):new Date;n.push({id:g,fileName:g,fileType:me,createdAt:pe,fileSize:s.size,url:ce})}n.sort((i,s)=>s.createdAt.getTime()-i.createdAt.getTime()),this.scanResults.set(n)}catch(t){console.error("Error loading scan results:",t),this.error.set("\u8F09\u5165\u6383\u63CF\u7D50\u679C\u5931\u6557"),this.scanResults.set([])}finally{this.isLoading.set(!1)}})}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,n=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,i)).toFixed(2))+" "+n[i]}formatDate(t){return new Date(t).toLocaleString()}downloadFile(t){let e=document.createElement("a");e.href=t.url,e.download=t.fileName,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e),this.message.success(`${t.fileType.toUpperCase()} \u6587\u4EF6\u5DF2\u4E0B\u8F09`)}deleteFile(t){let e=h(this.storage,`pdf-uploads/${t.fileName}`);oe(e).then(()=>{this.message.success("\u6A94\u6848\u5DF2\u522A\u9664"),this.loadScanResults()}).catch(n=>{console.error("\u522A\u9664\u6A94\u6848\u5931\u6557:",n),this.message.error("\u522A\u9664\u6A94\u6848\u5931\u6557")})}previewFile(t){if(t.fileType==="pdf"){let n=`https://docs.google.com/viewer?url=${encodeURIComponent(t.url)}&embedded=true`;window.open(n,"_blank")}else window.open(t.url,"_blank")}goToScan(){this.router.navigate(["/tree/pdf-scan"])}refresh(){this.loadScanResults()}};_.\u0275fac=function(e){return new(e||_)},_.\u0275cmp=v({type:_,selectors:[["app-scan-result"]],decls:11,vars:1,consts:[["nzTitle","\u6A94\u6848\u5217\u8868"],[1,"results-container"],[1,"header-actions"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","scan"],["nz-button","",3,"click"],["nz-icon","","nzType","reload"],["nzStatus","error","nzTitle","\u8F09\u5165\u5931\u6557",3,"nzSubTitle"],[3,"nzDataSource","nzItemLayout","nzLoading"],["nz-result-extra",""],["nzNotFoundImage","simple","nzNotFoundContent","\u76EE\u524D\u6C92\u6709\u6A94\u6848"],[1,"file-name"],[1,"file-info"],[3,"nzColor"],[1,"info-item"],["nz-icon","","nzType","file"],["nz-icon","","nzType","clock-circle"],["nz-list-item-actions",""],["nz-button","","nzType","link",3,"click"],["nz-icon","","nzType","eye"],["nz-icon","","nzType","download"],["nz-button","","nzType","link","nzDanger","",3,"click"],["nz-icon","","nzType","delete"]],template:function(e,n){e&1&&(r(0,"nz-card",0)(1,"div",1)(2,"div",2)(3,"button",3),u("click",function(){return n.goToScan()}),c(4,"span",4),a(5," \u6383\u63CF "),o(),r(6,"button",5),u("click",function(){return n.refresh()}),c(7,"span",6),a(8," \u91CD\u65B0\u6574\u7406 "),o()(),w(9,de,4,1,"nz-result",7)(10,ge,4,4,"nz-list",8),o()()),e&2&&(p(9),R(n.hasError()?9:10))},dependencies:[E,K,G,A,O,V,B,L,I,ne,te,ee,U,$,Z,X,Y,J,q,H,Q,W,j],styles:[".results-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.header-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:16px;justify-content:flex-end}.file-name[_ngcontent-%COMP%]{font-weight:500;color:#333}.file-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-top:8px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:#666;font-size:13px}@media (max-width: 768px){.results-container[_ngcontent-%COMP%]{max-width:100%;padding:0 16px}.header-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.file-info[_ngcontent-%COMP%]{flex-direction:column;gap:8px}}"],changeDetection:0});var se=_;export{se as ScanResultComponent};
